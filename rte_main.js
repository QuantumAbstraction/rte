var ft=Object.defineProperty;var ht=(H,B,t)=>B in H?ft(H,B,{enumerable:!0,configurable:!0,writable:!0,value:t}):H[B]=t;var mt=(H,B)=>()=>(B||H((B={exports:{}}).exports,B),B.exports);var ee=(H,B,t)=>ht(H,typeof B!="symbol"?B+"":B,t);var gt=mt((exports,module)=>{function _mergeNamespaces(H,B){for(var t=0;t<B.length;t++){const V=B[t];if(typeof V!="string"&&!Array.isArray(V)){for(const N in V)if(N!=="default"&&!(N in H)){const W=Object.getOwnPropertyDescriptor(V,N);W&&Object.defineProperty(H,N,W.get?W:{enumerable:!0,get:()=>V[N]})}}}return Object.freeze(Object.defineProperty(H,Symbol.toStringTag,{value:"Module"}))}(function(){const B=document.createElement("link").relList;if(B&&B.supports&&B.supports("modulepreload"))return;for(const N of document.querySelectorAll('link[rel="modulepreload"]'))V(N);new MutationObserver(N=>{for(const W of N)if(W.type==="childList")for(const K of W.addedNodes)K.tagName==="LINK"&&K.rel==="modulepreload"&&V(K)}).observe(document,{childList:!0,subtree:!0});function t(N){const W={};return N.integrity&&(W.integrity=N.integrity),N.referrerPolicy&&(W.referrerPolicy=N.referrerPolicy),N.crossOrigin==="use-credentials"?W.credentials="include":N.crossOrigin==="anonymous"?W.credentials="omit":W.credentials="same-origin",W}function V(N){if(N.ep)return;N.ep=!0;const W=t(N);fetch(N.href,W)}})();var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$1=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root$1.Symbol,objectProto$f=Object.prototype,hasOwnProperty$c=objectProto$f.hasOwnProperty,nativeObjectToString$1=objectProto$f.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(H){var B=hasOwnProperty$c.call(H,symToStringTag$1),t=H[symToStringTag$1];try{H[symToStringTag$1]=void 0;var V=!0}catch{}var N=nativeObjectToString$1.call(H);return V&&(B?H[symToStringTag$1]=t:delete H[symToStringTag$1]),N}var objectProto$e=Object.prototype,nativeObjectToString=objectProto$e.toString;function objectToString(H){return nativeObjectToString.call(H)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(H){return H==null?H===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(H)?getRawTag(H):objectToString(H)}function isObjectLike(H){return H!=null&&typeof H=="object"}var symbolTag$3="[object Symbol]";function isSymbol(H){return typeof H=="symbol"||isObjectLike(H)&&baseGetTag(H)==symbolTag$3}function arrayMap(H,B){for(var t=-1,V=H==null?0:H.length,N=Array(V);++t<V;)N[t]=B(H[t],t,H);return N}var isArray=Array.isArray,INFINITY$1=1/0,symbolProto$2=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto$2?symbolProto$2.toString:void 0;function baseToString(H){if(typeof H=="string")return H;if(isArray(H))return arrayMap(H,baseToString)+"";if(isSymbol(H))return symbolToString?symbolToString.call(H):"";var B=H+"";return B=="0"&&1/H==-INFINITY$1?"-0":B}var reWhitespace=/\s/;function trimmedEndIndex(H){for(var B=H.length;B--&&reWhitespace.test(H.charAt(B)););return B}var reTrimStart=/^\s+/;function baseTrim(H){return H&&H.slice(0,trimmedEndIndex(H)+1).replace(reTrimStart,"")}function isObject$2(H){var B=typeof H;return H!=null&&(B=="object"||B=="function")}var NAN=NaN,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(H){if(typeof H=="number")return H;if(isSymbol(H))return NAN;if(isObject$2(H)){var B=typeof H.valueOf=="function"?H.valueOf():H;H=isObject$2(B)?B+"":B}if(typeof H!="string")return H===0?H:+H;H=baseTrim(H);var t=reIsBinary.test(H);return t||reIsOctal.test(H)?freeParseInt(H.slice(2),t?2:8):reIsBadHex.test(H)?NAN:+H}function identity(H){return H}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(H){if(!isObject$2(H))return!1;var B=baseGetTag(H);return B==funcTag$2||B==genTag$1||B==asyncTag||B==proxyTag}var coreJsData=root$1["__core-js_shared__"],maskSrcKey=function(){var H=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return H?"Symbol(src)_1."+H:""}();function isMasked(H){return!!maskSrcKey&&maskSrcKey in H}var funcProto$2=Function.prototype,funcToString$2=funcProto$2.toString;function toSource(H){if(H!=null){try{return funcToString$2.call(H)}catch{}try{return H+""}catch{}}return""}var reRegExpChar$1=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$d=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$b=objectProto$d.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$b).replace(reRegExpChar$1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(H){if(!isObject$2(H)||isMasked(H))return!1;var B=isFunction(H)?reIsNative:reIsHostCtor;return B.test(toSource(H))}function getValue(H,B){return H==null?void 0:H[B]}function getNative(H,B){var t=getValue(H,B);return baseIsNative(t)?t:void 0}var WeakMap$1=getNative(root$1,"WeakMap"),objectCreate=Object.create,baseCreate=function(){function H(){}return function(B){if(!isObject$2(B))return{};if(objectCreate)return objectCreate(B);H.prototype=B;var t=new H;return H.prototype=void 0,t}}();function apply(H,B,t){switch(t.length){case 0:return H.call(B);case 1:return H.call(B,t[0]);case 2:return H.call(B,t[0],t[1]);case 3:return H.call(B,t[0],t[1],t[2])}return H.apply(B,t)}function copyArray(H,B){var t=-1,V=H.length;for(B||(B=Array(V));++t<V;)B[t]=H[t];return B}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(H){var B=0,t=0;return function(){var V=nativeNow(),N=HOT_SPAN-(V-t);if(t=V,N>0){if(++B>=HOT_COUNT)return arguments[0]}else B=0;return H.apply(void 0,arguments)}}function constant(H){return function(){return H}}var defineProperty=function(){try{var H=getNative(Object,"defineProperty");return H({},"",{}),H}catch{}}(),baseSetToString=defineProperty?function(H,B){return defineProperty(H,"toString",{configurable:!0,enumerable:!1,value:constant(B),writable:!0})}:identity,setToString=shortOut(baseSetToString);function arrayEach(H,B){for(var t=-1,V=H==null?0:H.length;++t<V&&B(H[t],t,H)!==!1;);return H}var MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(H,B){var t=typeof H;return B=B??MAX_SAFE_INTEGER$1,!!B&&(t=="number"||t!="symbol"&&reIsUint.test(H))&&H>-1&&H%1==0&&H<B}function baseAssignValue(H,B,t){B=="__proto__"&&defineProperty?defineProperty(H,B,{configurable:!0,enumerable:!0,value:t,writable:!0}):H[B]=t}function eq(H,B){return H===B||H!==H&&B!==B}var objectProto$c=Object.prototype,hasOwnProperty$a=objectProto$c.hasOwnProperty;function assignValue(H,B,t){var V=H[B];(!(hasOwnProperty$a.call(H,B)&&eq(V,t))||t===void 0&&!(B in H))&&baseAssignValue(H,B,t)}function copyObject(H,B,t,V){var N=!t;t||(t={});for(var W=-1,K=B.length;++W<K;){var G=B[W],Z=void 0;Z===void 0&&(Z=H[G]),N?baseAssignValue(t,G,Z):assignValue(t,G,Z)}return t}var nativeMax$1=Math.max;function overRest(H,B,t){return B=nativeMax$1(B===void 0?H.length-1:B,0),function(){for(var V=arguments,N=-1,W=nativeMax$1(V.length-B,0),K=Array(W);++N<W;)K[N]=V[B+N];N=-1;for(var G=Array(B+1);++N<B;)G[N]=V[N];return G[B]=t(K),apply(H,this,G)}}function baseRest(H,B){return setToString(overRest(H,B,identity),H+"")}var MAX_SAFE_INTEGER=9007199254740991;function isLength$1(H){return typeof H=="number"&&H>-1&&H%1==0&&H<=MAX_SAFE_INTEGER}function isArrayLike(H){return H!=null&&isLength$1(H.length)&&!isFunction(H)}function isIterateeCall(H,B,t){if(!isObject$2(t))return!1;var V=typeof B;return(V=="number"?isArrayLike(t)&&isIndex(B,t.length):V=="string"&&B in t)?eq(t[B],H):!1}function createAssigner(H){return baseRest(function(B,t){var V=-1,N=t.length,W=N>1?t[N-1]:void 0,K=N>2?t[2]:void 0;for(W=H.length>3&&typeof W=="function"?(N--,W):void 0,K&&isIterateeCall(t[0],t[1],K)&&(W=N<3?void 0:W,N=1),B=Object(B);++V<N;){var G=t[V];G&&H(B,G,V,W)}return B})}var objectProto$b=Object.prototype;function isPrototype(H){var B=H&&H.constructor,t=typeof B=="function"&&B.prototype||objectProto$b;return H===t}function baseTimes(H,B){for(var t=-1,V=Array(H);++t<H;)V[t]=B(t);return V}var argsTag$3="[object Arguments]";function baseIsArguments(H){return isObjectLike(H)&&baseGetTag(H)==argsTag$3}var objectProto$a=Object.prototype,hasOwnProperty$9=objectProto$a.hasOwnProperty,propertyIsEnumerable$1=objectProto$a.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(H){return isObjectLike(H)&&hasOwnProperty$9.call(H,"callee")&&!propertyIsEnumerable$1.call(H,"callee")};function stubFalse(){return!1}var freeExports$2=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$1=moduleExports$2?root$1.Buffer:void 0,nativeIsBuffer=Buffer$1?Buffer$1.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,argsTag$2="[object Arguments]",arrayTag$2="[object Array]",boolTag$3="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$1="[object Function]",mapTag$5="[object Map]",numberTag$3="[object Number]",objectTag$4="[object Object]",regexpTag$3="[object RegExp]",setTag$5="[object Set]",stringTag$4="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0;typedArrayTags[argsTag$2]=typedArrayTags[arrayTag$2]=typedArrayTags[arrayBufferTag$3]=typedArrayTags[boolTag$3]=typedArrayTags[dataViewTag$4]=typedArrayTags[dateTag$3]=typedArrayTags[errorTag$2]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$5]=typedArrayTags[numberTag$3]=typedArrayTags[objectTag$4]=typedArrayTags[regexpTag$3]=typedArrayTags[setTag$5]=typedArrayTags[stringTag$4]=typedArrayTags[weakMapTag$2]=!1;function baseIsTypedArray(H){return isObjectLike(H)&&isLength$1(H.length)&&!!typedArrayTags[baseGetTag(H)]}function baseUnary(H){return function(B){return H(B)}}var freeExports$1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=function(){try{var H=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return H||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch{}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$9=Object.prototype,hasOwnProperty$8=objectProto$9.hasOwnProperty;function arrayLikeKeys(H,B){var t=isArray(H),V=!t&&isArguments(H),N=!t&&!V&&isBuffer(H),W=!t&&!V&&!N&&isTypedArray(H),K=t||V||N||W,G=K?baseTimes(H.length,String):[],Z=G.length;for(var Y in H)(B||hasOwnProperty$8.call(H,Y))&&!(K&&(Y=="length"||N&&(Y=="offset"||Y=="parent")||W&&(Y=="buffer"||Y=="byteLength"||Y=="byteOffset")||isIndex(Y,Z)))&&G.push(Y);return G}function overArg(H,B){return function(t){return H(B(t))}}var nativeKeys=overArg(Object.keys,Object),objectProto$8=Object.prototype,hasOwnProperty$7=objectProto$8.hasOwnProperty;function baseKeys(H){if(!isPrototype(H))return nativeKeys(H);var B=[];for(var t in Object(H))hasOwnProperty$7.call(H,t)&&t!="constructor"&&B.push(t);return B}function keys(H){return isArrayLike(H)?arrayLikeKeys(H):baseKeys(H)}function nativeKeysIn(H){var B=[];if(H!=null)for(var t in Object(H))B.push(t);return B}var objectProto$7=Object.prototype,hasOwnProperty$6=objectProto$7.hasOwnProperty;function baseKeysIn(H){if(!isObject$2(H))return nativeKeysIn(H);var B=isPrototype(H),t=[];for(var V in H)V=="constructor"&&(B||!hasOwnProperty$6.call(H,V))||t.push(V);return t}function keysIn(H){return isArrayLike(H)?arrayLikeKeys(H,!0):baseKeysIn(H)}var assignIn=createAssigner(function(H,B){copyObject(B,keysIn(B),H)}),reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(H,B){if(isArray(H))return!1;var t=typeof H;return t=="number"||t=="symbol"||t=="boolean"||H==null||isSymbol(H)?!0:reIsPlainProp.test(H)||!reIsDeepProp.test(H)||B!=null&&H in Object(B)}var nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(H){var B=this.has(H)&&delete this.__data__[H];return this.size-=B?1:0,B}var HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty;function hashGet(H){var B=this.__data__;if(nativeCreate){var t=B[H];return t===HASH_UNDEFINED$2?void 0:t}return hasOwnProperty$5.call(B,H)?B[H]:void 0}var objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty;function hashHas(H){var B=this.__data__;return nativeCreate?B[H]!==void 0:hasOwnProperty$4.call(B,H)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(H,B){var t=this.__data__;return this.size+=this.has(H)?0:1,t[H]=nativeCreate&&B===void 0?HASH_UNDEFINED$1:B,this}function Hash(H){var B=-1,t=H==null?0:H.length;for(this.clear();++B<t;){var V=H[B];this.set(V[0],V[1])}}Hash.prototype.clear=hashClear;Hash.prototype.delete=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(H,B){for(var t=H.length;t--;)if(eq(H[t][0],B))return t;return-1}var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(H){var B=this.__data__,t=assocIndexOf(B,H);if(t<0)return!1;var V=B.length-1;return t==V?B.pop():splice.call(B,t,1),--this.size,!0}function listCacheGet(H){var B=this.__data__,t=assocIndexOf(B,H);return t<0?void 0:B[t][1]}function listCacheHas(H){return assocIndexOf(this.__data__,H)>-1}function listCacheSet(H,B){var t=this.__data__,V=assocIndexOf(t,H);return V<0?(++this.size,t.push([H,B])):t[V][1]=B,this}function ListCache(H){var B=-1,t=H==null?0:H.length;for(this.clear();++B<t;){var V=H[B];this.set(V[0],V[1])}}ListCache.prototype.clear=listCacheClear;ListCache.prototype.delete=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;var Map$1=getNative(root$1,"Map");function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(H){var B=typeof H;return B=="string"||B=="number"||B=="symbol"||B=="boolean"?H!=="__proto__":H===null}function getMapData(H,B){var t=H.__data__;return isKeyable(B)?t[typeof B=="string"?"string":"hash"]:t.map}function mapCacheDelete(H){var B=getMapData(this,H).delete(H);return this.size-=B?1:0,B}function mapCacheGet(H){return getMapData(this,H).get(H)}function mapCacheHas(H){return getMapData(this,H).has(H)}function mapCacheSet(H,B){var t=getMapData(this,H),V=t.size;return t.set(H,B),this.size+=t.size==V?0:1,this}function MapCache(H){var B=-1,t=H==null?0:H.length;for(this.clear();++B<t;){var V=H[B];this.set(V[0],V[1])}}MapCache.prototype.clear=mapCacheClear;MapCache.prototype.delete=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT$2="Expected a function";function memoize(H,B){if(typeof H!="function"||B!=null&&typeof B!="function")throw new TypeError(FUNC_ERROR_TEXT$2);var t=function(){var V=arguments,N=B?B.apply(this,V):V[0],W=t.cache;if(W.has(N))return W.get(N);var K=H.apply(this,V);return t.cache=W.set(N,K)||W,K};return t.cache=new(memoize.Cache||MapCache),t}memoize.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(H){var B=memoize(H,function(V){return t.size===MAX_MEMOIZE_SIZE&&t.clear(),V}),t=B.cache;return B}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped(function(H){var B=[];return H.charCodeAt(0)===46&&B.push(""),H.replace(rePropName,function(t,V,N,W){B.push(N?W.replace(reEscapeChar,"$1"):V||t)}),B});function toString$2(H){return H==null?"":baseToString(H)}function castPath(H,B){return isArray(H)?H:isKey(H,B)?[H]:stringToPath(toString$2(H))}var INFINITY=1/0;function toKey(H){if(typeof H=="string"||isSymbol(H))return H;var B=H+"";return B=="0"&&1/H==-INFINITY?"-0":B}function baseGet(H,B){B=castPath(B,H);for(var t=0,V=B.length;H!=null&&t<V;)H=H[toKey(B[t++])];return t&&t==V?H:void 0}function get(H,B,t){var V=H==null?void 0:baseGet(H,B);return V===void 0?t:V}function arrayPush(H,B){for(var t=-1,V=B.length,N=H.length;++t<V;)H[N+t]=B[t];return H}var getPrototype=overArg(Object.getPrototypeOf,Object),objectTag$3="[object Object]",funcProto=Function.prototype,objectProto$4=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$3=objectProto$4.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject(H){if(!isObjectLike(H)||baseGetTag(H)!=objectTag$3)return!1;var B=getPrototype(H);if(B===null)return!0;var t=hasOwnProperty$3.call(B,"constructor")&&B.constructor;return typeof t=="function"&&t instanceof t&&funcToString.call(t)==objectCtorString}function baseSlice(H,B,t){var V=-1,N=H.length;B<0&&(B=-B>N?0:N+B),t=t>N?N:t,t<0&&(t+=N),N=B>t?0:t-B>>>0,B>>>=0;for(var W=Array(N);++V<N;)W[V]=H[V+B];return W}function castSlice(H,B,t){var V=H.length;return t=t===void 0?V:t,!B&&t>=V?H:baseSlice(H,B,t)}var rsAstralRange$2="\\ud800-\\udfff",rsComboMarksRange$3="\\u0300-\\u036f",reComboHalfMarksRange$3="\\ufe20-\\ufe2f",rsComboSymbolsRange$3="\\u20d0-\\u20ff",rsComboRange$3=rsComboMarksRange$3+reComboHalfMarksRange$3+rsComboSymbolsRange$3,rsVarRange$2="\\ufe0e\\ufe0f",rsZWJ$2="\\u200d",reHasUnicode=RegExp("["+rsZWJ$2+rsAstralRange$2+rsComboRange$3+rsVarRange$2+"]");function hasUnicode(H){return reHasUnicode.test(H)}function asciiToArray(H){return H.split("")}var rsAstralRange$1="\\ud800-\\udfff",rsComboMarksRange$2="\\u0300-\\u036f",reComboHalfMarksRange$2="\\ufe20-\\ufe2f",rsComboSymbolsRange$2="\\u20d0-\\u20ff",rsComboRange$2=rsComboMarksRange$2+reComboHalfMarksRange$2+rsComboSymbolsRange$2,rsVarRange$1="\\ufe0e\\ufe0f",rsAstral="["+rsAstralRange$1+"]",rsCombo$2="["+rsComboRange$2+"]",rsFitz$1="\\ud83c[\\udffb-\\udfff]",rsModifier$1="(?:"+rsCombo$2+"|"+rsFitz$1+")",rsNonAstral$1="[^"+rsAstralRange$1+"]",rsRegional$1="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair$1="[\\ud800-\\udbff][\\udc00-\\udfff]",rsZWJ$1="\\u200d",reOptMod$1=rsModifier$1+"?",rsOptVar$1="["+rsVarRange$1+"]?",rsOptJoin$1="(?:"+rsZWJ$1+"(?:"+[rsNonAstral$1,rsRegional$1,rsSurrPair$1].join("|")+")"+rsOptVar$1+reOptMod$1+")*",rsSeq$1=rsOptVar$1+reOptMod$1+rsOptJoin$1,rsSymbol="(?:"+[rsNonAstral$1+rsCombo$2+"?",rsCombo$2,rsRegional$1,rsSurrPair$1,rsAstral].join("|")+")",reUnicode=RegExp(rsFitz$1+"(?="+rsFitz$1+")|"+rsSymbol+rsSeq$1,"g");function unicodeToArray(H){return H.match(reUnicode)||[]}function stringToArray(H){return hasUnicode(H)?unicodeToArray(H):asciiToArray(H)}function createCaseFirst(H){return function(B){B=toString$2(B);var t=hasUnicode(B)?stringToArray(B):void 0,V=t?t[0]:B.charAt(0),N=t?castSlice(t,1).join(""):B.slice(1);return V[H]()+N}}var upperFirst=createCaseFirst("toUpperCase");function arrayReduce(H,B,t,V){for(var N=-1,W=H==null?0:H.length;++N<W;)t=B(t,H[N],N,H);return t}function basePropertyOf(H){return function(B){return H==null?void 0:H[B]}}var deburredLetters={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},deburrLetter=basePropertyOf(deburredLetters),reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,rsComboMarksRange$1="\\u0300-\\u036f",reComboHalfMarksRange$1="\\ufe20-\\ufe2f",rsComboSymbolsRange$1="\\u20d0-\\u20ff",rsComboRange$1=rsComboMarksRange$1+reComboHalfMarksRange$1+rsComboSymbolsRange$1,rsCombo$1="["+rsComboRange$1+"]",reComboMark=RegExp(rsCombo$1,"g");function deburr(H){return H=toString$2(H),H&&H.replace(reLatin,deburrLetter).replace(reComboMark,"")}var reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function asciiWords(H){return H.match(reAsciiWord)||[]}var reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function hasUnicodeWord(H){return reHasUnicodeWord.test(H)}var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange,rsApos$1="['’]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d",rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",rsOptContrLower="(?:"+rsApos$1+"(?:d|ll|m|re|s|t|ve))?",rsOptContrUpper="(?:"+rsApos$1+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsOrdLower="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rsOrdUpper="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptContrLower+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+"+rsOptContrUpper+"(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+"+rsOptContrLower,rsUpper+"+"+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join("|"),"g");function unicodeWords(H){return H.match(reUnicodeWord)||[]}function words(H,B,t){return H=toString$2(H),B=B,B===void 0?hasUnicodeWord(H)?unicodeWords(H):asciiWords(H):H.match(B)||[]}var rsApos="['’]",reApos=RegExp(rsApos,"g");function createCompounder(H){return function(B){return arrayReduce(words(deburr(B).replace(reApos,"")),H,"")}}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(H){var B=this.__data__,t=B.delete(H);return this.size=B.size,t}function stackGet(H){return this.__data__.get(H)}function stackHas(H){return this.__data__.has(H)}var LARGE_ARRAY_SIZE=200;function stackSet(H,B){var t=this.__data__;if(t instanceof ListCache){var V=t.__data__;if(!Map$1||V.length<LARGE_ARRAY_SIZE-1)return V.push([H,B]),this.size=++t.size,this;t=this.__data__=new MapCache(V)}return t.set(H,B),this.size=t.size,this}function Stack(H){var B=this.__data__=new ListCache(H);this.size=B.size}Stack.prototype.clear=stackClear;Stack.prototype.delete=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function baseAssign(H,B){return H&&copyObject(B,keys(B),H)}function baseAssignIn(H,B){return H&&copyObject(B,keysIn(B),H)}var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer=moduleExports?root$1.Buffer:void 0,allocUnsafe=Buffer?Buffer.allocUnsafe:void 0;function cloneBuffer(H,B){if(B)return H.slice();var t=H.length,V=allocUnsafe?allocUnsafe(t):new H.constructor(t);return H.copy(V),V}function arrayFilter(H,B){for(var t=-1,V=H==null?0:H.length,N=0,W=[];++t<V;){var K=H[t];B(K,t,H)&&(W[N++]=K)}return W}function stubArray(){return[]}var objectProto$3=Object.prototype,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols$1?function(H){return H==null?[]:(H=Object(H),arrayFilter(nativeGetSymbols$1(H),function(B){return propertyIsEnumerable.call(H,B)}))}:stubArray;function copySymbols(H,B){return copyObject(H,getSymbols(H),B)}var nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn=nativeGetSymbols?function(H){for(var B=[];H;)arrayPush(B,getSymbols(H)),H=getPrototype(H);return B}:stubArray;function copySymbolsIn(H,B){return copyObject(H,getSymbolsIn(H),B)}function baseGetAllKeys(H,B,t){var V=B(H);return isArray(H)?V:arrayPush(V,t(H))}function getAllKeys(H){return baseGetAllKeys(H,keys,getSymbols)}function getAllKeysIn(H){return baseGetAllKeys(H,keysIn,getSymbolsIn)}var DataView$1=getNative(root$1,"DataView"),Promise$1=getNative(root$1,"Promise"),Set$1=getNative(root$1,"Set"),mapTag$4="[object Map]",objectTag$2="[object Object]",promiseTag="[object Promise]",setTag$4="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$3="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag=baseGetTag;(DataView$1&&getTag(new DataView$1(new ArrayBuffer(1)))!=dataViewTag$3||Map$1&&getTag(new Map$1)!=mapTag$4||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set$1&&getTag(new Set$1)!=setTag$4||WeakMap$1&&getTag(new WeakMap$1)!=weakMapTag$1)&&(getTag=function(H){var B=baseGetTag(H),t=B==objectTag$2?H.constructor:void 0,V=t?toSource(t):"";if(V)switch(V){case dataViewCtorString:return dataViewTag$3;case mapCtorString:return mapTag$4;case promiseCtorString:return promiseTag;case setCtorString:return setTag$4;case weakMapCtorString:return weakMapTag$1}return B});var objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function initCloneArray(H){var B=H.length,t=new H.constructor(B);return B&&typeof H[0]=="string"&&hasOwnProperty$2.call(H,"index")&&(t.index=H.index,t.input=H.input),t}var Uint8Array$1=root$1.Uint8Array;function cloneArrayBuffer(H){var B=new H.constructor(H.byteLength);return new Uint8Array$1(B).set(new Uint8Array$1(H)),B}function cloneDataView(H,B){var t=B?cloneArrayBuffer(H.buffer):H.buffer;return new H.constructor(t,H.byteOffset,H.byteLength)}var reFlags=/\w*$/;function cloneRegExp(H){var B=new H.constructor(H.source,reFlags.exec(H));return B.lastIndex=H.lastIndex,B}var symbolProto$1=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf$1=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol(H){return symbolValueOf$1?Object(symbolValueOf$1.call(H)):{}}function cloneTypedArray(H,B){var t=B?cloneArrayBuffer(H.buffer):H.buffer;return new H.constructor(t,H.byteOffset,H.length)}var boolTag$2="[object Boolean]",dateTag$2="[object Date]",mapTag$3="[object Map]",numberTag$2="[object Number]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$3="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(H,B,t){var V=H.constructor;switch(B){case arrayBufferTag$2:return cloneArrayBuffer(H);case boolTag$2:case dateTag$2:return new V(+H);case dataViewTag$2:return cloneDataView(H,t);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(H,t);case mapTag$3:return new V;case numberTag$2:case stringTag$3:return new V(H);case regexpTag$2:return cloneRegExp(H);case setTag$3:return new V;case symbolTag$2:return cloneSymbol(H)}}function initCloneObject(H){return typeof H.constructor=="function"&&!isPrototype(H)?baseCreate(getPrototype(H)):{}}var mapTag$2="[object Map]";function baseIsMap(H){return isObjectLike(H)&&getTag(H)==mapTag$2}var nodeIsMap=nodeUtil&&nodeUtil.isMap,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,setTag$2="[object Set]";function baseIsSet(H){return isObjectLike(H)&&getTag(H)==setTag$2}var nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,CLONE_DEEP_FLAG$2=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG$3=4,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag$1="[object Map]",numberTag$1="[object Number]",objectTag$1="[object Object]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$2="[object String]",symbolTag$1="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};cloneableTags[argsTag$1]=cloneableTags[arrayTag$1]=cloneableTags[arrayBufferTag$1]=cloneableTags[dataViewTag$1]=cloneableTags[boolTag$1]=cloneableTags[dateTag$1]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag$1]=cloneableTags[numberTag$1]=cloneableTags[objectTag$1]=cloneableTags[regexpTag$1]=cloneableTags[setTag$1]=cloneableTags[stringTag$2]=cloneableTags[symbolTag$1]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0;cloneableTags[errorTag$1]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;function baseClone(H,B,t,V,N,W){var K,G=B&CLONE_DEEP_FLAG$2,Z=B&CLONE_FLAT_FLAG,Y=B&CLONE_SYMBOLS_FLAG$3;if(t&&(K=N?t(H,V,N,W):t(H)),K!==void 0)return K;if(!isObject$2(H))return H;var X=isArray(H);if(X){if(K=initCloneArray(H),!G)return copyArray(H,K)}else{var Q=getTag(H),te=Q==funcTag||Q==genTag;if(isBuffer(H))return cloneBuffer(H,G);if(Q==objectTag$1||Q==argsTag$1||te&&!N){if(K=Z||te?{}:initCloneObject(H),!G)return Z?copySymbolsIn(H,baseAssignIn(K,H)):copySymbols(H,baseAssign(K,H))}else{if(!cloneableTags[Q])return N?H:{};K=initCloneByTag(H,Q,G)}}W||(W=new Stack);var ie=W.get(H);if(ie)return ie;W.set(H,K),isSet(H)?H.forEach(function(ae){K.add(baseClone(ae,B,t,ae,H,W))}):isMap(H)&&H.forEach(function(ae,de){K.set(de,baseClone(ae,B,t,de,H,W))});var ne=Y?Z?getAllKeysIn:getAllKeys:Z?keysIn:keys,le=X?void 0:ne(H);return arrayEach(le||H,function(ae,de){le&&(de=ae,ae=H[de]),assignValue(K,de,baseClone(ae,B,t,de,H,W))}),K}var CLONE_SYMBOLS_FLAG$2=4;function clone$1(H){return baseClone(H,CLONE_SYMBOLS_FLAG$2)}var CLONE_DEEP_FLAG$1=1,CLONE_SYMBOLS_FLAG$1=4;function cloneDeep(H){return baseClone(H,CLONE_DEEP_FLAG$1|CLONE_SYMBOLS_FLAG$1)}var CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeepWith(H,B){return B=typeof B=="function"?B:void 0,baseClone(H,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,B)}var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(H){return this.__data__.set(H,HASH_UNDEFINED),this}function setCacheHas(H){return this.__data__.has(H)}function SetCache(H){var B=-1,t=H==null?0:H.length;for(this.__data__=new MapCache;++B<t;)this.add(H[B])}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;function arraySome(H,B){for(var t=-1,V=H==null?0:H.length;++t<V;)if(B(H[t],t,H))return!0;return!1}function cacheHas(H,B){return H.has(B)}var COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays(H,B,t,V,N,W){var K=t&COMPARE_PARTIAL_FLAG$5,G=H.length,Z=B.length;if(G!=Z&&!(K&&Z>G))return!1;var Y=W.get(H),X=W.get(B);if(Y&&X)return Y==B&&X==H;var Q=-1,te=!0,ie=t&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(W.set(H,B),W.set(B,H);++Q<G;){var ne=H[Q],le=B[Q];if(V)var ae=K?V(le,ne,Q,B,H,W):V(ne,le,Q,H,B,W);if(ae!==void 0){if(ae)continue;te=!1;break}if(ie){if(!arraySome(B,function(de,ce){if(!cacheHas(ie,ce)&&(ne===de||N(ne,de,t,V,W)))return ie.push(ce)})){te=!1;break}}else if(!(ne===le||N(ne,le,t,V,W))){te=!1;break}}return W.delete(H),W.delete(B),te}function mapToArray(H){var B=-1,t=Array(H.size);return H.forEach(function(V,N){t[++B]=[N,V]}),t}function setToArray(H){var B=-1,t=Array(H.size);return H.forEach(function(V){t[++B]=V}),t}var COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag$1="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(H,B,t,V,N,W,K){switch(t){case dataViewTag:if(H.byteLength!=B.byteLength||H.byteOffset!=B.byteOffset)return!1;H=H.buffer,B=B.buffer;case arrayBufferTag:return!(H.byteLength!=B.byteLength||!W(new Uint8Array$1(H),new Uint8Array$1(B)));case boolTag:case dateTag:case numberTag:return eq(+H,+B);case errorTag:return H.name==B.name&&H.message==B.message;case regexpTag:case stringTag$1:return H==B+"";case mapTag:var G=mapToArray;case setTag:var Z=V&COMPARE_PARTIAL_FLAG$4;if(G||(G=setToArray),H.size!=B.size&&!Z)return!1;var Y=K.get(H);if(Y)return Y==B;V|=COMPARE_UNORDERED_FLAG$2,K.set(H,B);var X=equalArrays(G(H),G(B),V,N,W,K);return K.delete(H),X;case symbolTag:if(symbolValueOf)return symbolValueOf.call(H)==symbolValueOf.call(B)}return!1}var COMPARE_PARTIAL_FLAG$3=1,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function equalObjects(H,B,t,V,N,W){var K=t&COMPARE_PARTIAL_FLAG$3,G=getAllKeys(H),Z=G.length,Y=getAllKeys(B),X=Y.length;if(Z!=X&&!K)return!1;for(var Q=Z;Q--;){var te=G[Q];if(!(K?te in B:hasOwnProperty$1.call(B,te)))return!1}var ie=W.get(H),ne=W.get(B);if(ie&&ne)return ie==B&&ne==H;var le=!0;W.set(H,B),W.set(B,H);for(var ae=K;++Q<Z;){te=G[Q];var de=H[te],ce=B[te];if(V)var we=K?V(ce,de,te,B,H,W):V(de,ce,te,H,B,W);if(!(we===void 0?de===ce||N(de,ce,t,V,W):we)){le=!1;break}ae||(ae=te=="constructor")}if(le&&!ae){var be=H.constructor,ge=B.constructor;be!=ge&&"constructor"in H&&"constructor"in B&&!(typeof be=="function"&&be instanceof be&&typeof ge=="function"&&ge instanceof ge)&&(le=!1)}return W.delete(H),W.delete(B),le}var COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseIsEqualDeep(H,B,t,V,N,W){var K=isArray(H),G=isArray(B),Z=K?arrayTag:getTag(H),Y=G?arrayTag:getTag(B);Z=Z==argsTag?objectTag:Z,Y=Y==argsTag?objectTag:Y;var X=Z==objectTag,Q=Y==objectTag,te=Z==Y;if(te&&isBuffer(H)){if(!isBuffer(B))return!1;K=!0,X=!1}if(te&&!X)return W||(W=new Stack),K||isTypedArray(H)?equalArrays(H,B,t,V,N,W):equalByTag(H,B,Z,t,V,N,W);if(!(t&COMPARE_PARTIAL_FLAG$2)){var ie=X&&hasOwnProperty.call(H,"__wrapped__"),ne=Q&&hasOwnProperty.call(B,"__wrapped__");if(ie||ne){var le=ie?H.value():H,ae=ne?B.value():B;return W||(W=new Stack),N(le,ae,t,V,W)}}return te?(W||(W=new Stack),equalObjects(H,B,t,V,N,W)):!1}function baseIsEqual(H,B,t,V,N){return H===B?!0:H==null||B==null||!isObjectLike(H)&&!isObjectLike(B)?H!==H&&B!==B:baseIsEqualDeep(H,B,t,V,baseIsEqual,N)}var COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch(H,B,t,V){var N=t.length,W=N;if(H==null)return!W;for(H=Object(H);N--;){var K=t[N];if(K[2]?K[1]!==H[K[0]]:!(K[0]in H))return!1}for(;++N<W;){K=t[N];var G=K[0],Z=H[G],Y=K[1];if(K[2]){if(Z===void 0&&!(G in H))return!1}else{var X=new Stack,Q;if(!(Q===void 0?baseIsEqual(Y,Z,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,V,X):Q))return!1}}return!0}function isStrictComparable(H){return H===H&&!isObject$2(H)}function getMatchData(H){for(var B=keys(H),t=B.length;t--;){var V=B[t],N=H[V];B[t]=[V,N,isStrictComparable(N)]}return B}function matchesStrictComparable(H,B){return function(t){return t==null?!1:t[H]===B&&(B!==void 0||H in Object(t))}}function baseMatches(H){var B=getMatchData(H);return B.length==1&&B[0][2]?matchesStrictComparable(B[0][0],B[0][1]):function(t){return t===H||baseIsMatch(t,H,B)}}function baseHasIn(H,B){return H!=null&&B in Object(H)}function hasPath(H,B,t){B=castPath(B,H);for(var V=-1,N=B.length,W=!1;++V<N;){var K=toKey(B[V]);if(!(W=H!=null&&t(H,K)))break;H=H[K]}return W||++V!=N?W:(N=H==null?0:H.length,!!N&&isLength$1(N)&&isIndex(K,N)&&(isArray(H)||isArguments(H)))}function hasIn(H,B){return H!=null&&hasPath(H,B,baseHasIn)}var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty(H,B){return isKey(H)&&isStrictComparable(B)?matchesStrictComparable(toKey(H),B):function(t){var V=get(t,H);return V===void 0&&V===B?hasIn(t,H):baseIsEqual(B,V,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseProperty(H){return function(B){return B==null?void 0:B[H]}}function basePropertyDeep(H){return function(B){return baseGet(B,H)}}function property(H){return isKey(H)?baseProperty(toKey(H)):basePropertyDeep(H)}function baseIteratee(H){return typeof H=="function"?H:H==null?identity:typeof H=="object"?isArray(H)?baseMatchesProperty(H[0],H[1]):baseMatches(H):property(H)}function createBaseFor(H){return function(B,t,V){for(var N=-1,W=Object(B),K=V(B),G=K.length;G--;){var Z=K[++N];if(t(W[Z],Z,W)===!1)break}return B}}var baseFor=createBaseFor();function baseForOwn(H,B){return H&&baseFor(H,B,keys)}function createBaseEach(H,B){return function(t,V){if(t==null)return t;if(!isArrayLike(t))return H(t,V);for(var N=t.length,W=-1,K=Object(t);++W<N&&V(K[W],W,K)!==!1;);return t}}var baseEach=createBaseEach(baseForOwn),now=function(){return root$1.Date.now()},FUNC_ERROR_TEXT$1="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce(H,B,t){var V,N,W,K,G,Z,Y=0,X=!1,Q=!1,te=!0;if(typeof H!="function")throw new TypeError(FUNC_ERROR_TEXT$1);B=toNumber(B)||0,isObject$2(t)&&(X=!!t.leading,Q="maxWait"in t,W=Q?nativeMax(toNumber(t.maxWait)||0,B):W,te="trailing"in t?!!t.trailing:te);function ie(Ce){var he=V,me=N;return V=N=void 0,Y=Ce,K=H.apply(me,he),K}function ne(Ce){return Y=Ce,G=setTimeout(de,B),X?ie(Ce):K}function le(Ce){var he=Ce-Z,me=Ce-Y,pe=B-he;return Q?nativeMin(pe,W-me):pe}function ae(Ce){var he=Ce-Z,me=Ce-Y;return Z===void 0||he>=B||he<0||Q&&me>=W}function de(){var Ce=now();if(ae(Ce))return ce(Ce);G=setTimeout(de,le(Ce))}function ce(Ce){return G=void 0,te&&V?ie(Ce):(V=N=void 0,K)}function we(){G!==void 0&&clearTimeout(G),Y=0,V=Z=N=G=void 0}function be(){return G===void 0?K:ce(now())}function ge(){var Ce=now(),he=ae(Ce);if(V=arguments,N=this,Z=Ce,he){if(G===void 0)return ne(Z);if(Q)return clearTimeout(G),G=setTimeout(de,B),ie(Z)}return G===void 0&&(G=setTimeout(de,B)),K}return ge.cancel=we,ge.flush=be,ge}function assignMergeValue(H,B,t){(t!==void 0&&!eq(H[B],t)||t===void 0&&!(B in H))&&baseAssignValue(H,B,t)}function isArrayLikeObject(H){return isObjectLike(H)&&isArrayLike(H)}function safeGet(H,B){if(!(B==="constructor"&&typeof H[B]=="function")&&B!="__proto__")return H[B]}function toPlainObject(H){return copyObject(H,keysIn(H))}function baseMergeDeep(H,B,t,V,N,W,K){var G=safeGet(H,t),Z=safeGet(B,t),Y=K.get(Z);if(Y){assignMergeValue(H,t,Y);return}var X=W?W(G,Z,t+"",H,B,K):void 0,Q=X===void 0;if(Q){var te=isArray(Z),ie=!te&&isBuffer(Z),ne=!te&&!ie&&isTypedArray(Z);X=Z,te||ie||ne?isArray(G)?X=G:isArrayLikeObject(G)?X=copyArray(G):ie?(Q=!1,X=cloneBuffer(Z,!0)):ne?(Q=!1,X=cloneTypedArray(Z,!0)):X=[]:isPlainObject(Z)||isArguments(Z)?(X=G,isArguments(G)?X=toPlainObject(G):(!isObject$2(G)||isFunction(G))&&(X=initCloneObject(Z))):Q=!1}Q&&(K.set(Z,X),N(X,Z,V,W,K),K.delete(Z)),assignMergeValue(H,t,X)}function baseMerge(H,B,t,V,N){H!==B&&baseFor(B,function(W,K){if(N||(N=new Stack),isObject$2(W))baseMergeDeep(H,B,K,t,baseMerge,V,N);else{var G=V?V(safeGet(H,K),W,K+"",H,B,N):void 0;G===void 0&&(G=W),assignMergeValue(H,K,G)}},keysIn)}var mergeWith=createAssigner(function(H,B,t,V){baseMerge(H,B,t,V)});function last(H){var B=H==null?0:H.length;return B?H[B-1]:void 0}var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},escapeHtmlChar=basePropertyOf(htmlEscapes),reUnescapedHtml=/[&<>"']/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source);function escape$1(H){return H=toString$2(H),H&&reHasUnescapedHtml.test(H)?H.replace(reUnescapedHtml,escapeHtmlChar):H}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);function escapeRegExp(H){return H=toString$2(H),H&&reHasRegExpChar.test(H)?H.replace(reRegExpChar,"\\$&"):H}function baseMap(H,B){var t=-1,V=isArrayLike(H)?Array(H.length):[];return baseEach(H,function(N,W,K){V[++t]=B(N,W,K)}),V}function map$1(H,B){var t=isArray(H)?arrayMap:baseMap;return t(H,baseIteratee(B))}var stringTag="[object String]";function isString(H){return typeof H=="string"||!isArray(H)&&isObjectLike(H)&&baseGetTag(H)==stringTag}function parent(H,B){return B.length<2?H:baseGet(H,baseSlice(B,0,-1))}function isElement$1(H){return isObjectLike(H)&&H.nodeType===1&&!isPlainObject(H)}function isEqual(H,B){return baseIsEqual(H,B)}function isEqualWith(H,B,t){t=typeof t=="function"?t:void 0;var V=t?t(H,B):void 0;return V===void 0?baseIsEqual(H,B,void 0,t):!!V}function mapValues(H,B){var t={};return B=baseIteratee(B),baseForOwn(H,function(V,N,W){baseAssignValue(t,N,B(V,N,W))}),t}var merge$1=createAssigner(function(H,B,t){baseMerge(H,B,t)});function baseUnset(H,B){return B=castPath(B,H),H=parent(H,B),H==null||delete H[toKey(last(B))]}function baseSet(H,B,t,V){if(!isObject$2(H))return H;B=castPath(B,H);for(var N=-1,W=B.length,K=W-1,G=H;G!=null&&++N<W;){var Z=toKey(B[N]),Y=t;if(Z==="__proto__"||Z==="constructor"||Z==="prototype")return H;if(N!=K){var X=G[Z];Y=void 0,Y===void 0&&(Y=isObject$2(X)?X:isIndex(B[N+1])?[]:{})}assignValue(G,Z,Y),G=G[Z]}return H}function set$1(H,B,t){return H==null?H:baseSet(H,B,t)}var startCase=createCompounder(function(H,B,t){return H+(t?" ":"")+upperFirst(B)}),FUNC_ERROR_TEXT="Expected a function";function throttle(H,B,t){var V=!0,N=!0;if(typeof H!="function")throw new TypeError(FUNC_ERROR_TEXT);return isObject$2(t)&&(V="leading"in t?!!t.leading:V,N="trailing"in t?!!t.trailing:N),debounce(H,B,{leading:V,maxWait:B,trailing:N})}function unset(H,B){return H==null?!0:baseUnset(H,B)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let globalVar;try{globalVar={window,document}}catch{/* istanbul ignore next -- @preserve */globalVar={window:{},document:{}}}var global$1=globalVar;function getUserAgent(){try{return navigator.userAgent.toLowerCase()}catch{return""}}const userAgent=getUserAgent(),env={isMac:isMac(userAgent),isWindows:isWindows(userAgent),isGecko:isGecko(userAgent),isSafari:isSafari(userAgent),isiOS:isiOS(userAgent),isAndroid:isAndroid(userAgent),isBlink:isBlink(userAgent),get isMediaForcedColors(){return isMediaForcedColors()},get isMotionReduced(){return isMotionReduced()},features:{isRegExpUnicodePropertySupported:isRegExpUnicodePropertySupported()}};function isMac(H){return H.indexOf("macintosh")>-1}function isWindows(H){return H.indexOf("windows")>-1}function isGecko(H){return!!H.match(/gecko\/\d+/)}function isSafari(H){return H.indexOf(" applewebkit/")>-1&&H.indexOf("chrome")===-1}function isiOS(H){return!!H.match(/iphone|ipad/i)||isMac(H)&&navigator.maxTouchPoints>0}function isAndroid(H){return H.indexOf("android")>-1}function isBlink(H){return H.indexOf("chrome/")>-1&&H.indexOf("edge/")<0}function isRegExpUnicodePropertySupported(){let H=!1;try{H="ć".search(new RegExp("[\\p{L}]","u"))===0}catch{}return H}function isMediaForcedColors(){return global$1.window.matchMedia?global$1.window.matchMedia("(forced-colors: active)").matches:!1}function isMotionReduced(){return global$1.window.matchMedia?global$1.window.matchMedia("(prefers-reduced-motion)").matches:!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function fastDiff(H,B,t,V){t=t||function(Z,Y){return Z===Y};const N=Array.isArray(H)?H:Array.prototype.slice.call(H),W=Array.isArray(B)?B:Array.prototype.slice.call(B),K=findChangeBoundaryIndexes(N,W,t);return V?changeIndexesToAtomicChanges(K,W.length):changeIndexesToChanges(W,K)}function findChangeBoundaryIndexes(H,B,t){const V=findFirstDifferenceIndex(H,B,t);if(V===-1)return{firstIndex:-1,lastIndexOld:-1,lastIndexNew:-1};const N=cutAndReverse(H,V),W=cutAndReverse(B,V),K=findFirstDifferenceIndex(N,W,t),G=H.length-K,Z=B.length-K;return{firstIndex:V,lastIndexOld:G,lastIndexNew:Z}}function findFirstDifferenceIndex(H,B,t){for(let V=0;V<Math.max(H.length,B.length);V++)if(H[V]===void 0||B[V]===void 0||!t(H[V],B[V]))return V;return-1}function cutAndReverse(H,B){return H.slice(B).reverse()}function changeIndexesToChanges(H,B){const t=[],{firstIndex:V,lastIndexOld:N,lastIndexNew:W}=B;return W-V>0&&t.push({index:V,type:"insert",values:H.slice(V,W)}),N-V>0&&t.push({index:V+(W-V),type:"delete",howMany:N-V}),t}function changeIndexesToAtomicChanges(H,B){const{firstIndex:t,lastIndexOld:V,lastIndexNew:N}=H;if(t===-1)return Array(B).fill("equal");let W=[];return t>0&&(W=W.concat(Array(t).fill("equal"))),N-t>0&&(W=W.concat(Array(N-t).fill("insert"))),V-t>0&&(W=W.concat(Array(V-t).fill("delete"))),N<B&&(W=W.concat(Array(B-N).fill("equal"))),W}function diff(H,B,t){t=t||function(le,ae){return le===ae};const V=H.length,N=B.length;if(V>200||N>200||V+N>300)return diff.fastDiff(H,B,t,!0);let W,K;if(N<V){const le=H;H=B,B=le,W="delete",K="insert"}else W="insert",K="delete";const G=H.length,Z=B.length,Y=Z-G,X={},Q={};function te(le){const ae=(Q[le-1]!==void 0?Q[le-1]:-1)+1,de=Q[le+1]!==void 0?Q[le+1]:-1,ce=ae>de?-1:1;X[le+ce]&&(X[le]=X[le+ce].slice(0)),X[le]||(X[le]=[]),X[le].push(ae>de?W:K);let we=Math.max(ae,de),be=we-le;for(;be<G&&we<Z&&t(H[be],B[we]);)be++,we++,X[le].push("equal");return we}let ie=0,ne;do{for(ne=-ie;ne<Y;ne++)Q[ne]=te(ne);for(ne=Y+ie;ne>Y;ne--)Q[ne]=te(ne);Q[Y]=te(Y),ie++}while(Q[Y]!==Z);return X[Y].slice(1)}diff.fastDiff=fastDiff;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function spy(){return function H(){H.called=!0}}class EventInfo{constructor(B,t){ee(this,"source");ee(this,"name");ee(this,"path");ee(this,"stop");ee(this,"off");ee(this,"return");this.source=B,this.name=t,this.path=[],this.stop=spy(),this.off=spy()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const HEX_NUMBERS=new Array(256).fill("").map((H,B)=>("0"+B.toString(16)).slice(-2));function uid(){const[H,B,t,V]=crypto.getRandomValues(new Uint32Array(4));return"e"+HEX_NUMBERS[H>>0&255]+HEX_NUMBERS[H>>8&255]+HEX_NUMBERS[H>>16&255]+HEX_NUMBERS[H>>24&255]+HEX_NUMBERS[B>>0&255]+HEX_NUMBERS[B>>8&255]+HEX_NUMBERS[B>>16&255]+HEX_NUMBERS[B>>24&255]+HEX_NUMBERS[t>>0&255]+HEX_NUMBERS[t>>8&255]+HEX_NUMBERS[t>>16&255]+HEX_NUMBERS[t>>24&255]+HEX_NUMBERS[V>>0&255]+HEX_NUMBERS[V>>8&255]+HEX_NUMBERS[V>>16&255]+HEX_NUMBERS[V>>24&255]}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const priorities={get(H="normal"){return typeof H!="number"?this[H]||this.normal:H},highest:1e5,high:1e3,normal:0,low:-1e3,lowest:-1e5};function insertToPriorityArray(H,B){const t=priorities.get(B.priority);for(let V=0;V<H.length;V++)if(priorities.get(H[V].priority)<t){H.splice(V,0,B);return}H.push(B)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const DOCUMENTATION_URL="https://ckeditor.com/docs/ckeditor5/latest/support/error-codes.html";class CKEditorError extends Error{constructor(t,V,N){super(getErrorMessage(t,N));ee(this,"context");ee(this,"data");this.name="CKEditorError",this.context=V,this.data=N}is(t){return t==="CKEditorError"}static rethrowUnexpectedError(t,V){if(t.is&&t.is("CKEditorError"))throw t;const N=new CKEditorError(t.message,V);throw N.stack=t.stack,N}}function logWarning(H,B){console.warn(...formatConsoleArguments(H,B))}function logError(H,B){console.error(...formatConsoleArguments(H,B))}function getLinkToDocumentationMessage(H){return`
Read more: ${DOCUMENTATION_URL}#error-${H}`}function getErrorMessage(H,B){const t=new WeakSet,N=B?` ${JSON.stringify(B,(K,G)=>{if(typeof G=="object"&&G!==null){if(t.has(G))return`[object ${G.constructor.name}]`;t.add(G)}return G})}`:"",W=getLinkToDocumentationMessage(H);return H+N+W}function formatConsoleArguments(H,B){const t=getLinkToDocumentationMessage(H);return B?[H,B,t]:[H,t]}const version="43.2.0",releaseDate=new Date(2024,9,2);/* istanbul ignore next -- @preserve */if(globalThis.CKEDITOR_VERSION)throw new CKEditorError("ckeditor-duplicated-modules",null);globalThis.CKEDITOR_VERSION=version;const _listeningTo=Symbol("listeningTo"),_emitterId=Symbol("emitterId"),_delegations=Symbol("delegations"),defaultEmitterClass$1=EmitterMixin(Object);function EmitterMixin(H){if(!H)return defaultEmitterClass$1;class B extends H{on(V,N,W){this.listenTo(this,V,N,W)}once(V,N,W){let K=!1;const G=(Z,...Y)=>{K||(K=!0,Z.off(),N.call(this,Z,...Y))};this.listenTo(this,V,G,W)}off(V,N){this.stopListening(this,V,N)}listenTo(V,N,W,K={}){let G,Z;this[_listeningTo]||(this[_listeningTo]={});const Y=this[_listeningTo];_getEmitterId(V)||_setEmitterId(V);const X=_getEmitterId(V);(G=Y[X])||(G=Y[X]={emitter:V,callbacks:{}}),(Z=G.callbacks[N])||(Z=G.callbacks[N]=[]),Z.push(W),addEventListener$1(this,V,N,W,K)}stopListening(V,N,W){const K=this[_listeningTo];let G=V&&_getEmitterId(V);const Z=K&&G?K[G]:void 0,Y=Z&&N?Z.callbacks[N]:void 0;if(!(!K||V&&!Z||N&&!Y))if(W)removeEventListener$1(this,V,N,W),Y.indexOf(W)!==-1&&(Y.length===1?delete Z.callbacks[N]:removeEventListener$1(this,V,N,W));else if(Y){for(;W=Y.pop();)removeEventListener$1(this,V,N,W);delete Z.callbacks[N]}else if(Z){for(N in Z.callbacks)this.stopListening(V,N);delete K[G]}else{for(G in K)this.stopListening(K[G].emitter);delete this[_listeningTo]}}fire(V,...N){try{const W=V instanceof EventInfo?V:new EventInfo(this,V),K=W.name;let G=getCallbacksForEvent(this,K);if(W.path.push(this),G){const Y=[W,...N];G=Array.from(G);for(let X=0;X<G.length&&(G[X].callback.apply(this,Y),W.off.called&&(delete W.off.called,this._removeEventListener(K,G[X].callback)),!W.stop.called);X++);}const Z=this[_delegations];if(Z){const Y=Z.get(K),X=Z.get("*");Y&&fireDelegatedEvents(Y,W,N),X&&fireDelegatedEvents(X,W,N)}return W.return}catch(W){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(W,this)}}delegate(...V){return{to:(N,W)=>{this[_delegations]||(this[_delegations]=new Map),V.forEach(K=>{const G=this[_delegations].get(K);G?G.set(N,W):this[_delegations].set(K,new Map([[N,W]]))})}}}stopDelegating(V,N){if(this[_delegations])if(!V)this[_delegations].clear();else if(!N)this[_delegations].delete(V);else{const W=this[_delegations].get(V);W&&W.delete(N)}}_addEventListener(V,N,W){createEventNamespace(this,V);const K=getCallbacksListsForNamespace(this,V),G=priorities.get(W.priority),Z={callback:N,priority:G};for(const Y of K)insertToPriorityArray(Y,Z)}_removeEventListener(V,N){const W=getCallbacksListsForNamespace(this,V);for(const K of W)for(let G=0;G<K.length;G++)K[G].callback==N&&(K.splice(G,1),G--)}}return B}["on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(H=>{EmitterMixin[H]=defaultEmitterClass$1.prototype[H]});function _getEmitterListenedTo(H,B){const t=H[_listeningTo];return t&&t[B]?t[B].emitter:null}function _setEmitterId(H,B){H[_emitterId]||(H[_emitterId]=B||uid())}function _getEmitterId(H){return H[_emitterId]}function getEvents(H){return H._events||Object.defineProperty(H,"_events",{value:{}}),H._events}function makeEventNode(){return{callbacks:[],childEvents:[]}}function createEventNamespace(H,B){const t=getEvents(H);if(t[B])return;let V=B,N=null;const W=[];for(;V!==""&&!t[V];)t[V]=makeEventNode(),W.push(t[V]),N&&t[V].childEvents.push(N),N=V,V=V.substr(0,V.lastIndexOf(":"));if(V!==""){for(const K of W)K.callbacks=t[V].callbacks.slice();t[V].childEvents.push(N)}}function getCallbacksListsForNamespace(H,B){const t=getEvents(H)[B];if(!t)return[];let V=[t.callbacks];for(let N=0;N<t.childEvents.length;N++){const W=getCallbacksListsForNamespace(H,t.childEvents[N]);V=V.concat(W)}return V}function getCallbacksForEvent(H,B){let t;return!H._events||!(t=H._events[B])||!t.callbacks.length?B.indexOf(":")>-1?getCallbacksForEvent(H,B.substr(0,B.lastIndexOf(":"))):null:t.callbacks}function fireDelegatedEvents(H,B,t){for(let[V,N]of H){N?typeof N=="function"&&(N=N(B.name)):N=B.name;const W=new EventInfo(B.source,N);W.path=[...B.path],V.fire(W,...t)}}function addEventListener$1(H,B,t,V,N){B._addEventListener?B._addEventListener(t,V,N):H._addEventListener.call(B,t,V,N)}function removeEventListener$1(H,B,t,V){B._removeEventListener?B._removeEventListener(t,V):H._removeEventListener.call(B,t,V)}const observablePropertiesSymbol=Symbol("observableProperties"),boundObservablesSymbol=Symbol("boundObservables"),boundPropertiesSymbol=Symbol("boundProperties"),decoratedMethods=Symbol("decoratedMethods"),decoratedOriginal=Symbol("decoratedOriginal"),defaultObservableClass=ObservableMixin(EmitterMixin());function ObservableMixin(H){var t,V,N,W,K;if(!H)return defaultObservableClass;class B extends(K=H,W=observablePropertiesSymbol,N=decoratedMethods,V=boundPropertiesSymbol,t=boundObservablesSymbol,K){constructor(){super(...arguments);ee(this,W);ee(this,N);ee(this,V);ee(this,t)}set(Y,X){if(isObject$2(Y)){Object.keys(Y).forEach(te=>{this.set(te,Y[te])},this);return}initObservable(this);const Q=this[observablePropertiesSymbol];if(Y in this&&!Q.has(Y))throw new CKEditorError("observable-set-cannot-override",this);Object.defineProperty(this,Y,{enumerable:!0,configurable:!0,get(){return Q.get(Y)},set(te){const ie=Q.get(Y);let ne=this.fire(`set:${Y}`,Y,te,ie);ne===void 0&&(ne=te),(ie!==ne||!Q.has(Y))&&(Q.set(Y,ne),this.fire(`change:${Y}`,Y,ne,ie))}}),this[Y]=X}bind(...Y){if(!Y.length||!isStringArray$1(Y))throw new CKEditorError("observable-bind-wrong-properties",this);if(new Set(Y).size!==Y.length)throw new CKEditorError("observable-bind-duplicate-properties",this);initObservable(this);const X=this[boundPropertiesSymbol];Y.forEach(te=>{if(X.has(te))throw new CKEditorError("observable-bind-rebind",this)});const Q=new Map;return Y.forEach(te=>{const ie={property:te,to:[]};X.set(te,ie),Q.set(te,ie)}),{to:bindTo,toMany:bindToMany,_observable:this,_bindProperties:Y,_to:[],_bindings:Q}}unbind(...Y){if(!this[observablePropertiesSymbol])return;const X=this[boundPropertiesSymbol],Q=this[boundObservablesSymbol];if(Y.length){if(!isStringArray$1(Y))throw new CKEditorError("observable-unbind-wrong-properties",this);Y.forEach(te=>{const ie=X.get(te);ie&&(ie.to.forEach(([ne,le])=>{const ae=Q.get(ne),de=ae[le];de.delete(ie),de.size||delete ae[le],Object.keys(ae).length||(Q.delete(ne),this.stopListening(ne,"change"))}),X.delete(te))})}else Q.forEach((te,ie)=>{this.stopListening(ie,"change")}),Q.clear(),X.clear()}decorate(Y){initObservable(this);const X=this[Y];if(!X)throw new CKEditorError("observablemixin-cannot-decorate-undefined",this,{object:this,methodName:Y});this.on(Y,(Q,te)=>{Q.return=X.apply(this,te)}),this[Y]=function(...Q){return this.fire(Y,Q)},this[Y][decoratedOriginal]=X,this[decoratedMethods]||(this[decoratedMethods]=[]),this[decoratedMethods].push(Y)}stopListening(Y,X,Q){if(!Y&&this[decoratedMethods]){for(const te of this[decoratedMethods])this[te]=this[te][decoratedOriginal];delete this[decoratedMethods]}super.stopListening(Y,X,Q)}}return B}["set","bind","unbind","decorate","on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(H=>{ObservableMixin[H]=defaultObservableClass.prototype[H]});function initObservable(H){H[observablePropertiesSymbol]||(Object.defineProperty(H,observablePropertiesSymbol,{value:new Map}),Object.defineProperty(H,boundObservablesSymbol,{value:new Map}),Object.defineProperty(H,boundPropertiesSymbol,{value:new Map}))}function bindTo(...H){const B=parseBindToArgs(...H),t=Array.from(this._bindings.keys()),V=t.length;if(!B.callback&&B.to.length>1)throw new CKEditorError("observable-bind-to-no-callback",this);if(V>1&&B.callback)throw new CKEditorError("observable-bind-to-extra-callback",this);B.to.forEach(N=>{if(N.properties.length&&N.properties.length!==V)throw new CKEditorError("observable-bind-to-properties-length",this);N.properties.length||(N.properties=this._bindProperties)}),this._to=B.to,B.callback&&(this._bindings.get(t[0]).callback=B.callback),attachBindToListeners(this._observable,this._to),updateBindToBound(this),this._bindProperties.forEach(N=>{updateBoundObservableProperty(this._observable,N)})}function bindToMany(H,B,t){if(this._bindings.size>1)throw new CKEditorError("observable-bind-to-many-not-one-binding",this);this.to(...getBindingTargets(H,B),t)}function getBindingTargets(H,B){const t=H.map(V=>[V,B]);return Array.prototype.concat.apply([],t)}function isStringArray$1(H){return H.every(B=>typeof B=="string")}function parseBindToArgs(...H){if(!H.length)throw new CKEditorError("observable-bind-to-parse-error",null);const B={to:[]};let t;return typeof H[H.length-1]=="function"&&(B.callback=H.pop()),H.forEach(V=>{if(typeof V=="string")t.properties.push(V);else if(typeof V=="object")t={observable:V,properties:[]},B.to.push(t);else throw new CKEditorError("observable-bind-to-parse-error",null)}),B}function updateBoundObservables(H,B,t,V){const N=H[boundObservablesSymbol],W=N.get(t),K=W||{};K[V]||(K[V]=new Set),K[V].add(B),W||N.set(t,K)}function updateBindToBound(H){let B;H._bindings.forEach((t,V)=>{H._to.forEach(N=>{B=N.properties[t.callback?0:H._bindProperties.indexOf(V)],t.to.push([N.observable,B]),updateBoundObservables(H._observable,t,N.observable,B)})})}function updateBoundObservableProperty(H,B){const V=H[boundPropertiesSymbol].get(B);let N;V.callback?N=V.callback.apply(H,V.to.map(W=>W[0][W[1]])):(N=V.to[0],N=N[0][N[1]]),Object.prototype.hasOwnProperty.call(H,B)?H[B]=N:H.set(B,N)}function attachBindToListeners(H,B){B.forEach(t=>{const V=H[boundObservablesSymbol];let N;V.get(t.observable)||H.listenTo(t.observable,"change",(W,K)=>{N=V.get(t.observable)[K],N&&N.forEach(G=>{updateBoundObservableProperty(H,G.property)})})})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ElementReplacer{constructor(){ee(this,"_replacedElements");this._replacedElements=[]}replace(B,t){this._replacedElements.push({element:B,newElement:t}),B.style.display="none",t&&B.parentNode.insertBefore(t,B.nextSibling)}restore(){this._replacedElements.forEach(({element:B,newElement:t})=>{B.style.display="",t&&t.remove()}),this._replacedElements=[]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function abortableDebounce(H){let B=new AbortController;function t(...V){return B.abort(),B=new AbortController,H(B.signal,...V)}return t.abort=()=>B.abort(),t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function count(H){let B=0;for(const t of H)B++;return B}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function compareArrays(H,B){const t=Math.min(H.length,B.length);for(let V=0;V<t;V++)if(H[V]!=B[V])return V;return H.length==B.length?"same":H.length<B.length?"prefix":"extension"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isIterable(H){return!!(H&&H[Symbol.iterator])}function createElement(H,B,t={},V=[]){const N=t&&t.xmlns,W=N?H.createElementNS(N,B):H.createElement(B);for(const K in t)W.setAttribute(K,t[K]);(isString(V)||!isIterable(V))&&(V=[V]);for(let K of V)isString(K)&&(K=H.createTextNode(K)),W.appendChild(K);return W}class Config{constructor(B,t){ee(this,"_config");this._config=Object.create(null),t&&this.define(cloneConfig(t)),B&&this._setObjectToTarget(this._config,B)}set(B,t){this._setToTarget(this._config,B,t)}define(B,t){this._setToTarget(this._config,B,t,!0)}get(B){return this._getFromSource(this._config,B)}*names(){for(const B of Object.keys(this._config))yield B}_setToTarget(B,t,V,N=!1){if(isPlainObject(t)){this._setObjectToTarget(B,t,N);return}const W=t.split(".");t=W.pop();for(const K of W)isPlainObject(B[K])||(B[K]=Object.create(null)),B=B[K];if(isPlainObject(V)){isPlainObject(B[t])||(B[t]=Object.create(null)),B=B[t],this._setObjectToTarget(B,V,N);return}N&&typeof B[t]<"u"||(B[t]=V)}_getFromSource(B,t){const V=t.split(".");t=V.pop();for(const N of V){if(!isPlainObject(B[N])){B=null;break}B=B[N]}return B?cloneConfig(B[t]):void 0}_setObjectToTarget(B,t,V){Object.keys(t).forEach(N=>{this._setToTarget(B,N,t[N],V)})}}function cloneConfig(H){return cloneDeepWith(H,leaveItemReferences)}function leaveItemReferences(H){return isElement$1(H)||typeof H=="function"?H:void 0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isNode(H){if(H){if(H.defaultView)return H instanceof H.defaultView.Document;if(H.ownerDocument&&H.ownerDocument.defaultView)return H instanceof H.ownerDocument.defaultView.Node}return!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isWindow(H){const B=Object.prototype.toString.apply(H);return B=="[object Window]"||B=="[object global]"}const defaultEmitterClass=DomEmitterMixin(EmitterMixin());function DomEmitterMixin(H){if(!H)return defaultEmitterClass;class B extends H{listenTo(V,N,W,K={}){if(isNode(V)||isWindow(V)){const G={capture:!!K.useCapture,passive:!!K.usePassive},Z=this._getProxyEmitter(V,G)||new ProxyEmitter(V,G);this.listenTo(Z,N,W,K)}else super.listenTo(V,N,W,K)}stopListening(V,N,W){if(isNode(V)||isWindow(V)){const K=this._getAllProxyEmitters(V);for(const G of K)this.stopListening(G,N,W)}else super.stopListening(V,N,W)}_getProxyEmitter(V,N){return _getEmitterListenedTo(this,getProxyEmitterId(V,N))}_getAllProxyEmitters(V){return[{capture:!1,passive:!1},{capture:!1,passive:!0},{capture:!0,passive:!1},{capture:!0,passive:!0}].map(N=>this._getProxyEmitter(V,N)).filter(N=>!!N)}}return B}["_getProxyEmitter","_getAllProxyEmitters","on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(H=>{DomEmitterMixin[H]=defaultEmitterClass.prototype[H]});class ProxyEmitter extends EmitterMixin(){constructor(t,V){super();ee(this,"_domNode");ee(this,"_options");ee(this,"_domListeners");_setEmitterId(this,getProxyEmitterId(t,V)),this._domNode=t,this._options=V}attach(t){if(this._domListeners&&this._domListeners[t])return;const V=this._createDomListener(t);this._domNode.addEventListener(t,V,this._options),this._domListeners||(this._domListeners={}),this._domListeners[t]=V}detach(t){let V;this._domListeners[t]&&(!(V=this._events[t])||!V.callbacks.length)&&this._domListeners[t].removeListener()}_addEventListener(t,V,N){this.attach(t),EmitterMixin().prototype._addEventListener.call(this,t,V,N)}_removeEventListener(t,V){EmitterMixin().prototype._removeEventListener.call(this,t,V),this.detach(t)}_createDomListener(t){const V=N=>{this.fire(t,N)};return V.removeListener=()=>{this._domNode.removeEventListener(t,V,this._options),delete this._domListeners[t]},V}}function getNodeUID(H){return H["data-ck-expando"]||(H["data-ck-expando"]=uid())}function getProxyEmitterId(H,B){let t=getNodeUID(H);for(const V of Object.keys(B).sort())B[V]&&(t+="-"+V);return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getAncestors(H){const B=[];let t=H;for(;t&&t.nodeType!=Node.DOCUMENT_NODE;)B.unshift(t),t=t.parentNode;return B}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getDataFromElement(H){return H instanceof HTMLTextAreaElement?H.value:H.innerHTML}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getBorderWidths(H){const B=H.ownerDocument.defaultView.getComputedStyle(H);return{top:parseInt(B.borderTopWidth,10),right:parseInt(B.borderRightWidth,10),bottom:parseInt(B.borderBottomWidth,10),left:parseInt(B.borderLeftWidth,10)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getRangeFromMouseEvent(H){if(!H.target)return null;const B=H.target.ownerDocument,t=H.clientX,V=H.clientY;let N=null;return B.caretRangeFromPoint&&B.caretRangeFromPoint(t,V)?N=B.caretRangeFromPoint(t,V):H.rangeParent&&(N=B.createRange(),N.setStart(H.rangeParent,H.rangeOffset),N.collapse(!0)),N}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isText(H){return Object.prototype.toString.call(H)=="[object Text]"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isRange(H){return Object.prototype.toString.apply(H)=="[object Range]"}function getPositionedAncestor(H){return!H||!H.parentNode||H.offsetParent===global$1.document.body?null:H.offsetParent}const rectProperties=["top","right","bottom","left","width","height"];class Rect{constructor(B){ee(this,"top");ee(this,"right");ee(this,"bottom");ee(this,"left");ee(this,"width");ee(this,"height");ee(this,"_source");const t=isRange(B);if(Object.defineProperty(this,"_source",{value:B._source||B,writable:!0,enumerable:!1}),isDomElement(B)||t)if(t){const V=Rect.getDomRangeRects(B);copyRectProperties(this,Rect.getBoundingRect(V))}else copyRectProperties(this,B.getBoundingClientRect());else if(isWindow(B)){const{innerWidth:V,innerHeight:N}=B;copyRectProperties(this,{top:0,right:V,bottom:N,left:0,width:V,height:N})}else copyRectProperties(this,B)}clone(){return new Rect(this)}moveTo(B,t){return this.top=t,this.right=B+this.width,this.bottom=t+this.height,this.left=B,this}moveBy(B,t){return this.top+=t,this.right+=B,this.left+=B,this.bottom+=t,this}getIntersection(B){const t={top:Math.max(this.top,B.top),right:Math.min(this.right,B.right),bottom:Math.min(this.bottom,B.bottom),left:Math.max(this.left,B.left),width:0,height:0};if(t.width=t.right-t.left,t.height=t.bottom-t.top,t.width<0||t.height<0)return null;{const V=new Rect(t);return V._source=this._source,V}}getIntersectionArea(B){const t=this.getIntersection(B);return t?t.getArea():0}getArea(){return this.width*this.height}getVisible(){const B=this._source;let t=this.clone();if(isBody(B))return t;let V=B,N=B.parentNode||B.commonAncestorContainer,W;for(;N&&!isBody(N);){const K=getElementOverflow(N)==="visible";V instanceof HTMLElement&&getElementPosition(V)==="absolute"&&(W=V);const G=getElementPosition(N);if(K||W&&(G==="relative"&&K||G!=="relative")){V=N,N=N.parentNode;continue}const Z=new Rect(N),Y=t.getIntersection(Z);if(Y)Y.getArea()<t.getArea()&&(t=Y);else return null;V=N,N=N.parentNode}return t}isEqual(B){for(const t of rectProperties)if(this[t]!==B[t])return!1;return!0}contains(B){const t=this.getIntersection(B);return!!(t&&t.isEqual(B))}toAbsoluteRect(){const{scrollX:B,scrollY:t}=global$1.window,V=this.clone().moveBy(B,t);if(isDomElement(V._source)){const N=getPositionedAncestor(V._source);N&&shiftRectToCompensatePositionedAncestor(V,N)}return V}excludeScrollbarsAndBorders(){const B=this._source;let t,V,N;if(isWindow(B))t=B.innerWidth-B.document.documentElement.clientWidth,V=B.innerHeight-B.document.documentElement.clientHeight,N=B.getComputedStyle(B.document.documentElement).direction;else{const W=getBorderWidths(B);t=B.offsetWidth-B.clientWidth-W.left-W.right,V=B.offsetHeight-B.clientHeight-W.top-W.bottom,N=B.ownerDocument.defaultView.getComputedStyle(B).direction,this.left+=W.left,this.top+=W.top,this.right-=W.right,this.bottom-=W.bottom,this.width=this.right-this.left,this.height=this.bottom-this.top}return this.width-=t,N==="ltr"?this.right-=t:this.left+=t,this.height-=V,this.bottom-=V,this}static getDomRangeRects(B){const t=[],V=Array.from(B.getClientRects());if(V.length)for(const N of V)t.push(new Rect(N));else{let N=B.startContainer;isText(N)&&(N=N.parentNode);const W=new Rect(N.getBoundingClientRect());W.right=W.left,W.width=0,t.push(W)}return t}static getBoundingRect(B){const t={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:0,height:0};let V=0;for(const N of B)V++,t.left=Math.min(t.left,N.left),t.top=Math.min(t.top,N.top),t.right=Math.max(t.right,N.right),t.bottom=Math.max(t.bottom,N.bottom);return V==0?null:(t.width=t.right-t.left,t.height=t.bottom-t.top,new Rect(t))}}function copyRectProperties(H,B){for(const t of rectProperties)H[t]=B[t]}function isBody(H){return isDomElement(H)?H===H.ownerDocument.body:!1}function isDomElement(H){return H!==null&&typeof H=="object"&&H.nodeType===1&&typeof H.getBoundingClientRect=="function"}function getElementPosition(H){return H instanceof HTMLElement?H.ownerDocument.defaultView.getComputedStyle(H).position:"static"}function getElementOverflow(H){return H instanceof HTMLElement?H.ownerDocument.defaultView.getComputedStyle(H).overflow:"visible"}function shiftRectToCompensatePositionedAncestor(H,B){const t=new Rect(B),V=getBorderWidths(B);let N=0,W=0;N-=t.left,W-=t.top,N+=B.scrollLeft,W+=B.scrollTop,N-=V.left,W-=V.top,H.moveBy(N,W)}const Fe=class Fe{constructor(B,t){ee(this,"_element");ee(this,"_callback");Fe._observerInstance||Fe._createObserver(),this._element=B,this._callback=t,Fe._addElementCallback(B,t),Fe._observerInstance.observe(B)}get element(){return this._element}destroy(){Fe._deleteElementCallback(this._element,this._callback)}static _addElementCallback(B,t){Fe._elementCallbacks||(Fe._elementCallbacks=new Map);let V=Fe._elementCallbacks.get(B);V||(V=new Set,Fe._elementCallbacks.set(B,V)),V.add(t)}static _deleteElementCallback(B,t){const V=Fe._getElementCallbacks(B);V&&(V.delete(t),V.size||(Fe._elementCallbacks.delete(B),Fe._observerInstance.unobserve(B))),Fe._elementCallbacks&&!Fe._elementCallbacks.size&&(Fe._observerInstance=null,Fe._elementCallbacks=null)}static _getElementCallbacks(B){return Fe._elementCallbacks?Fe._elementCallbacks.get(B):null}static _createObserver(){Fe._observerInstance=new global$1.window.ResizeObserver(B=>{for(const t of B){const V=Fe._getElementCallbacks(t.target);if(V)for(const N of V)N(t)}})}};ee(Fe,"_observerInstance",null),ee(Fe,"_elementCallbacks",null);let ResizeObserver=Fe;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function setDataInElement(H,B){H instanceof HTMLTextAreaElement&&(H.value=B),H.innerHTML=B}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function toUnit(H){return B=>B+H}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function indexOf(H){let B=0;for(;H.previousSibling;)H=H.previousSibling,B++;return B}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function insertAt(H,B,t){H.insertBefore(t,H.childNodes[B]||null)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isComment(H){return H&&H.nodeType===Node.COMMENT_NODE}function isValidAttributeName(H){try{global$1.document.createAttribute(H)}catch{return!1}return!0}function isVisible(H){return H?isText(H)?isVisible(H.parentElement):H.getClientRects?!!H.getClientRects().length:!1:!1}function getOptimalPosition({element:H,target:B,positions:t,limiter:V,fitInViewport:N,viewportOffsetConfig:W}){isFunction(B)&&(B=B()),isFunction(V)&&(V=V());const K=getPositionedAncestor(H),G=getConstrainedViewportRect$1(W),Z=new Rect(H),Y=getVisibleViewportIntersectionRect(B,G);let X;if(!Y||!G.getIntersection(Y))return null;const Q={targetRect:Y,elementRect:Z,positionedElementAncestor:K,viewportRect:G};if(!V&&!N)X=new PositionObject(t[0],Q);else{if(V){const te=getVisibleViewportIntersectionRect(V,G);te&&(Q.limiterRect=te)}X=getBestPosition(t,Q)}return X}function getVisibleViewportIntersectionRect(H,B){const t=new Rect(H).getVisible();return t?t.getIntersection(B):null}function getConstrainedViewportRect$1(H){H=Object.assign({top:0,bottom:0,left:0,right:0},H);const B=new Rect(global$1.window);return B.top+=H.top,B.height-=H.top,B.bottom-=H.bottom,B.height-=H.bottom,B}function getBestPosition(H,B){const{elementRect:t}=B,V=t.getArea(),N=H.map(G=>new PositionObject(G,B)).filter(G=>!!G.name);let W=0,K=null;for(const G of N){const{limiterIntersectionArea:Z,viewportIntersectionArea:Y}=G;if(Z===V)return G;const X=Y**2+Z**2;X>W&&(W=X,K=G)}return K}class PositionObject{constructor(B,t){ee(this,"name");ee(this,"config");ee(this,"_positioningFunctionCoordinates");ee(this,"_options");ee(this,"_cachedRect");ee(this,"_cachedAbsoluteRect");const V=B(t.targetRect,t.elementRect,t.viewportRect,t.limiterRect);if(!V)return;const{left:N,top:W,name:K,config:G}=V;this.name=K,this.config=G,this._positioningFunctionCoordinates={left:N,top:W},this._options=t}get left(){return this._absoluteRect.left}get top(){return this._absoluteRect.top}get limiterIntersectionArea(){const B=this._options.limiterRect;return B?B.getIntersectionArea(this._rect):0}get viewportIntersectionArea(){return this._options.viewportRect.getIntersectionArea(this._rect)}get _rect(){return this._cachedRect?this._cachedRect:(this._cachedRect=this._options.elementRect.clone().moveTo(this._positioningFunctionCoordinates.left,this._positioningFunctionCoordinates.top),this._cachedRect)}get _absoluteRect(){return this._cachedAbsoluteRect?this._cachedAbsoluteRect:(this._cachedAbsoluteRect=this._rect.toAbsoluteRect(),this._cachedAbsoluteRect)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function remove$1(H){const B=H.parentNode;B&&B.removeChild(H)}function scrollViewportToShowTarget({target:H,viewportOffset:B=0,ancestorOffset:t=0,alignToTop:V,forceScroll:N}){const W=getWindow(H);let K=W,G=null;for(B=normalizeViewportOffset(B);K;){let Z;K==W?Z=getParentElement(H):Z=getParentElement(G),scrollAncestorsToShowRect({parent:Z,getRect:()=>getRectRelativeToWindow(H,K),alignToTop:V,ancestorOffset:t,forceScroll:N});const Y=getRectRelativeToWindow(H,K);if(scrollWindowToShowRect({window:K,rect:Y,viewportOffset:B,alignToTop:V,forceScroll:N}),K.parent!=K){if(G=K.frameElement,K=K.parent,!G)return}else K=null}}function scrollWindowToShowRect({window:H,rect:B,alignToTop:t,forceScroll:V,viewportOffset:N}){const W=B.clone().moveBy(0,N.bottom),K=B.clone().moveBy(0,-N.top),G=new Rect(H).excludeScrollbarsAndBorders(),Z=[K,W],Y=t&&V,X=Z.every(le=>G.contains(le));let{scrollX:Q,scrollY:te}=H;const ie=Q,ne=te;Y?te-=G.top-B.top+N.top:X||(isAbove(K,G)?te-=G.top-B.top+N.top:isBelow(W,G)&&(t?te+=B.top-G.top-N.top:te+=B.bottom-G.bottom+N.bottom)),X||(isLeftOf(B,G)?Q-=G.left-B.left+N.left:isRightOf(B,G)&&(Q+=B.right-G.right+N.right)),(Q!=ie||te!==ne)&&H.scrollTo(Q,te)}function scrollAncestorsToShowRect({parent:H,getRect:B,alignToTop:t,forceScroll:V,ancestorOffset:N=0,limiterElement:W}){const K=getWindow(H),G=t&&V;let Z,Y,X;const Q=W||K.document.body;for(;H!=Q;)Y=B(),Z=new Rect(H).excludeScrollbarsAndBorders(),X=Z.contains(Y),G?H.scrollTop-=Z.top-Y.top+N:X||(isAbove(Y,Z)?H.scrollTop-=Z.top-Y.top+N:isBelow(Y,Z)&&(t?H.scrollTop+=Y.top-Z.top-N:H.scrollTop+=Y.bottom-Z.bottom+N)),X||(isLeftOf(Y,Z)?H.scrollLeft-=Z.left-Y.left+N:isRightOf(Y,Z)&&(H.scrollLeft+=Y.right-Z.right+N)),H=H.parentNode}function isBelow(H,B){return H.bottom>B.bottom}function isAbove(H,B){return H.top<B.top}function isLeftOf(H,B){return H.left<B.left}function isRightOf(H,B){return H.right>B.right}function getWindow(H){return isRange(H)?H.startContainer.ownerDocument.defaultView:H.ownerDocument.defaultView}function getParentElement(H){if(isRange(H)){let B=H.commonAncestorContainer;return isText(B)&&(B=B.parentNode),B}else return H.parentNode}function getRectRelativeToWindow(H,B){const t=getWindow(H),V=new Rect(H);if(t===B)return V;{let N=t;for(;N!=B;){const W=N.frameElement,K=new Rect(W).excludeScrollbarsAndBorders();V.moveBy(K.left,K.top),N=N.parent}}return V}function normalizeViewportOffset(H){return typeof H=="number"?{top:H,bottom:H,left:H,right:H}:H}const modifiersToGlyphsMac={ctrl:"⌃",cmd:"⌘",alt:"⌥",shift:"⇧"},modifiersToGlyphsNonMac={ctrl:"Ctrl+",alt:"Alt+",shift:"Shift+"},keyCodesToGlyphs={37:"←",38:"↑",39:"→",40:"↓",9:"⇥",33:"Page Up",34:"Page Down"},keyCodes=generateKnownKeyCodes(),keyCodeNames=Object.fromEntries(Object.entries(keyCodes).map(([H,B])=>{let t;return B in keyCodesToGlyphs?t=keyCodesToGlyphs[B]:t=H.charAt(0).toUpperCase()+H.slice(1),[B,t]}));function getCode(H){let B;if(typeof H=="string"){if(B=keyCodes[H.toLowerCase()],!B)throw new CKEditorError("keyboard-unknown-key",null,{key:H})}else B=H.keyCode+(H.altKey?keyCodes.alt:0)+(H.ctrlKey?keyCodes.ctrl:0)+(H.shiftKey?keyCodes.shift:0)+(H.metaKey?keyCodes.cmd:0);return B}function parseKeystroke(H){return typeof H=="string"&&(H=splitKeystrokeText(H)),H.map(B=>typeof B=="string"?getEnvKeyCode(B):B).reduce((B,t)=>t+B,0)}function getEnvKeystrokeText(H){let B=parseKeystroke(H);return Object.entries(env.isMac||env.isiOS?modifiersToGlyphsMac:modifiersToGlyphsNonMac).reduce((N,[W,K])=>(B&keyCodes[W]&&(B&=~keyCodes[W],N+=K),N),"")+(B?keyCodeNames[B]:"")}function isArrowKeyCode(H){return H==keyCodes.arrowright||H==keyCodes.arrowleft||H==keyCodes.arrowup||H==keyCodes.arrowdown}function getLocalizedArrowKeyCodeDirection(H,B){const t=B==="ltr";switch(H){case keyCodes.arrowleft:return t?"left":"right";case keyCodes.arrowright:return t?"right":"left";case keyCodes.arrowup:return"up";case keyCodes.arrowdown:return"down"}}function getEnvKeyCode(H){if(H.endsWith("!"))return getCode(H.slice(0,-1));const B=getCode(H);return(env.isMac||env.isiOS)&&B==keyCodes.ctrl?keyCodes.cmd:B}function isForwardArrowKeyCode(H,B){const t=getLocalizedArrowKeyCodeDirection(H,B);return t==="down"||t==="right"}function generateKnownKeyCodes(){const H={pageup:33,pagedown:34,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,backspace:8,delete:46,enter:13,space:32,esc:27,tab:9,ctrl:1114112,shift:2228224,alt:4456448,cmd:8912896};for(let B=65;B<=90;B++){const t=String.fromCharCode(B);H[t.toLowerCase()]=B}for(let B=48;B<=57;B++)H[B-48]=B;for(let B=112;B<=123;B++)H["f"+(B-111)]=B;return Object.assign(H,{"'":222,",":108,"-":109,".":110,"/":111,";":186,"=":187,"[":219,"\\":220,"]":221,"`":223}),H}function splitKeystrokeText(H){return H.split("+").map(B=>B.trim())}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const RTL_LANGUAGE_CODES=["ar","ara","dv","div","fa","per","fas","he","heb","ku","kur","ug","uig"];function getLanguageDirection(H){return RTL_LANGUAGE_CODES.includes(H)?"rtl":"ltr"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function toArray$2(H){return Array.isArray(H)?H:[H]}/* istanbul ignore else -- @preserve */global$1.window.CKEDITOR_TRANSLATIONS||(global$1.window.CKEDITOR_TRANSLATIONS={});function _translate(H,B,t=1,V){if(typeof t!="number")throw new CKEditorError("translation-service-quantity-not-a-number",null,{quantity:t});const N=V||global$1.window.CKEDITOR_TRANSLATIONS,W=getNumberOfLanguages(N);W===1&&(H=Object.keys(N)[0]);const K=B.id||B.string;if(W===0||!hasTranslation(H,K,N))return t!==1?B.plural:B.string;const G=N[H].dictionary,Z=N[H].getPluralForm||(Q=>Q===1?0:1),Y=G[K];if(typeof Y=="string")return Y;const X=Number(Z(t));return Y[X]}function _unifyTranslations(H){return Array.isArray(H)?H.reduce((B,t)=>merge$1(B,t)):H}function hasTranslation(H,B,t){return!!t[H]&&!!t[H].dictionary[B]}function getNumberOfLanguages(H){return Object.keys(H).length}class Locale{constructor({uiLanguage:B="en",contentLanguage:t,translations:V}={}){ee(this,"uiLanguage");ee(this,"uiLanguageDirection");ee(this,"contentLanguage");ee(this,"contentLanguageDirection");ee(this,"t");ee(this,"translations");this.uiLanguage=B,this.contentLanguage=t||this.uiLanguage,this.uiLanguageDirection=getLanguageDirection(this.uiLanguage),this.contentLanguageDirection=getLanguageDirection(this.contentLanguage),this.translations=_unifyTranslations(V),this.t=(N,W)=>this._t(N,W)}get language(){return console.warn("locale-deprecated-language-property: The Locale#language property has been deprecated and will be removed in the near future. Please use #uiLanguage and #contentLanguage properties instead."),this.uiLanguage}_t(B,t=[]){t=toArray$2(t),typeof B=="string"&&(B={string:B});const N=!!B.plural?t[0]:1,W=_translate(this.uiLanguage,B,N,this.translations);return interpolateString(W,t)}}function interpolateString(H,B){return H.replace(/%(\d+)/g,(t,V)=>V<B.length?B[V]:t)}class Collection extends EmitterMixin(){constructor(t={},V={}){super();ee(this,"_items");ee(this,"_itemMap");ee(this,"_idProperty");ee(this,"_bindToCollection");ee(this,"_bindToExternalToInternalMap");ee(this,"_bindToInternalToExternalMap");ee(this,"_skippedIndexesFromExternal");const N=isIterable(t);if(N||(V=t),this._items=[],this._itemMap=new Map,this._idProperty=V.idProperty||"id",this._bindToExternalToInternalMap=new WeakMap,this._bindToInternalToExternalMap=new WeakMap,this._skippedIndexesFromExternal=[],N)for(const W of t)this._items.push(W),this._itemMap.set(this._getItemIdBeforeAdding(W),W)}get length(){return this._items.length}get first(){return this._items[0]||null}get last(){return this._items[this.length-1]||null}add(t,V){return this.addMany([t],V)}addMany(t,V){if(V===void 0)V=this._items.length;else if(V>this._items.length||V<0)throw new CKEditorError("collection-add-item-invalid-index",this);let N=0;for(const W of t){const K=this._getItemIdBeforeAdding(W),G=V+N;this._items.splice(G,0,W),this._itemMap.set(K,W),this.fire("add",W,G),N++}return this.fire("change",{added:t,removed:[],index:V}),this}get(t){let V;if(typeof t=="string")V=this._itemMap.get(t);else if(typeof t=="number")V=this._items[t];else throw new CKEditorError("collection-get-invalid-arg",this);return V||null}has(t){if(typeof t=="string")return this._itemMap.has(t);{const V=this._idProperty,N=t[V];return N&&this._itemMap.has(N)}}getIndex(t){let V;return typeof t=="string"?V=this._itemMap.get(t):V=t,V?this._items.indexOf(V):-1}remove(t){const[V,N]=this._remove(t);return this.fire("change",{added:[],removed:[V],index:N}),V}map(t,V){return this._items.map(t,V)}forEach(t,V){this._items.forEach(t,V)}find(t,V){return this._items.find(t,V)}filter(t,V){return this._items.filter(t,V)}clear(){this._bindToCollection&&(this.stopListening(this._bindToCollection),this._bindToCollection=null);const t=Array.from(this._items);for(;this.length;)this._remove(0);this.fire("change",{added:[],removed:t,index:0})}bindTo(t){if(this._bindToCollection)throw new CKEditorError("collection-bind-to-rebind",this);return this._bindToCollection=t,{as:V=>{this._setUpBindToBinding(N=>new V(N))},using:V=>{typeof V=="function"?this._setUpBindToBinding(V):this._setUpBindToBinding(N=>N[V])}}}_setUpBindToBinding(t){const V=this._bindToCollection,N=(W,K,G)=>{const Z=V._bindToCollection==this,Y=V._bindToInternalToExternalMap.get(K);if(Z&&Y)this._bindToExternalToInternalMap.set(K,Y),this._bindToInternalToExternalMap.set(Y,K);else{const X=t(K);if(!X){this._skippedIndexesFromExternal.push(G);return}let Q=G;for(const te of this._skippedIndexesFromExternal)G>te&&Q--;for(const te of V._skippedIndexesFromExternal)Q>=te&&Q++;this._bindToExternalToInternalMap.set(K,X),this._bindToInternalToExternalMap.set(X,K),this.add(X,Q);for(let te=0;te<V._skippedIndexesFromExternal.length;te++)Q<=V._skippedIndexesFromExternal[te]&&V._skippedIndexesFromExternal[te]++}};for(const W of V)N(null,W,V.getIndex(W));this.listenTo(V,"add",N),this.listenTo(V,"remove",(W,K,G)=>{const Z=this._bindToExternalToInternalMap.get(K);Z&&this.remove(Z),this._skippedIndexesFromExternal=this._skippedIndexesFromExternal.reduce((Y,X)=>(G<X&&Y.push(X-1),G>X&&Y.push(X),Y),[])})}_getItemIdBeforeAdding(t){const V=this._idProperty;let N;if(V in t){if(N=t[V],typeof N!="string")throw new CKEditorError("collection-add-invalid-id",this);if(this.get(N))throw new CKEditorError("collection-add-item-already-exists",this)}else t[V]=N=uid();return N}_remove(t){let V,N,W,K=!1;const G=this._idProperty;if(typeof t=="string"?(N=t,W=this._itemMap.get(N),K=!W,W&&(V=this._items.indexOf(W))):typeof t=="number"?(V=t,W=this._items[V],K=!W,W&&(N=W[G])):(W=t,N=W[G],V=this._items.indexOf(W),K=V==-1||!this._itemMap.get(N)),K)throw new CKEditorError("collection-remove-404",this);this._items.splice(V,1),this._itemMap.delete(N);const Z=this._bindToInternalToExternalMap.get(W);return this._bindToInternalToExternalMap.delete(W),this._bindToExternalToInternalMap.delete(Z),this.fire("remove",W,V),[W,V]}[Symbol.iterator](){return this._items[Symbol.iterator]()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function first(H){const B=H.next();return B.done?null:B.value}class FocusTracker extends DomEmitterMixin(ObservableMixin()){constructor(){super();ee(this,"_elements",new Set);ee(this,"_nextEventLoopTimeout",null);this.set("isFocused",!1),this.set("focusedElement",null)}get elements(){return Array.from(this._elements.values())}add(t){if(this._elements.has(t))throw new CKEditorError("focustracker-add-element-already-exist",this);this.listenTo(t,"focus",()=>this._focus(t),{useCapture:!0}),this.listenTo(t,"blur",()=>this._blur(),{useCapture:!0}),this._elements.add(t)}remove(t){t===this.focusedElement&&this._blur(),this._elements.has(t)&&(this.stopListening(t),this._elements.delete(t))}destroy(){this.stopListening()}_focus(t){clearTimeout(this._nextEventLoopTimeout),this.focusedElement=t,this.isFocused=!0}_blur(){clearTimeout(this._nextEventLoopTimeout),this._nextEventLoopTimeout=setTimeout(()=>{this.focusedElement=null,this.isFocused=!1},0)}}class KeystrokeHandler{constructor(){ee(this,"_listener");this._listener=new(DomEmitterMixin())}listenTo(B){this._listener.listenTo(B,"keydown",(t,V)=>{this._listener.fire("_keydown:"+getCode(V),V)})}set(B,t,V={}){const N=parseKeystroke(B),W=V.priority;this._listener.listenTo(this._listener,"_keydown:"+N,(K,G)=>{V.filter&&!V.filter(G)||(t(G,()=>{G.preventDefault(),G.stopPropagation(),K.stop()}),K.return=!0)},{priority:W})}press(B){return!!this._listener.fire("_keydown:"+getCode(B),B)}stopListening(B){this._listener.stopListening(B)}destroy(){this.stopListening()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function objectToMap(H){const B=new Map;for(const t in H)B.set(t,H[t]);return B}function toMap(H){return isIterable(H)?new Map(H):objectToMap(H)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function wait(H,B={}){return new Promise((t,V)=>{const N=B.signal||new AbortController().signal;N.throwIfAborted();const W=setTimeout(K,H);N.addEventListener("abort",G,{once:!0});function K(){N.removeEventListener("abort",G),t()}function G(){clearTimeout(W),V(N.reason)}})}async function retry(H,B={}){const{maxAttempts:t=4,retryDelay:V=exponentialDelay(),signal:N=new AbortController().signal}=B;N.throwIfAborted();for(let W=0;;W++){try{return await H()}catch(K){if(W+1>=t)throw K}await wait(V(W),{signal:N})}}function exponentialDelay(H={}){const{delay:B=1e3,factor:t=2,maxDelay:V=1e4}=H;return N=>Math.min(t**N*B,V)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const BIG_CHUNK_SIZE=1e4;function spliceArray(H,B,t,V){if(Math.max(B.length,H.length)>BIG_CHUNK_SIZE)return H.slice(0,t).concat(B).concat(H.slice(t+V,H.length));{const N=Array.from(H);return N.splice(t,V,...B),N}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function delay(H,B){let t;function V(...N){V.cancel(),t=setTimeout(()=>H(...N),B)}return V.cancel=()=>{clearTimeout(t)},V}function verifyLicense(H){function B(Q){return Q.length>=40&&Q.length<=255?"VALID":"INVALID"}if(!H)return"INVALID";let t="";try{t=atob(H)}catch{return"INVALID"}const V=t.split("-"),N=V[0],W=V[1];if(!W)return B(H);try{atob(W)}catch{try{if(atob(N),!atob(N).length)return B(H)}catch{return B(H)}}if(N.length<40||N.length>255)return"INVALID";let K="";try{atob(N),K=atob(W)}catch{return"INVALID"}if(K.length!==8)return"INVALID";const G=Number(K.substring(0,4)),Z=Number(K.substring(4,6))-1,Y=Number(K.substring(6,8)),X=new Date(G,Z,Y);return X<releaseDate||isNaN(Number(X))?"INVALID":"VALID"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isCombiningMark(H){return!!H&&H.length==1&&/[\u0300-\u036f\u1ab0-\u1aff\u1dc0-\u1dff\u20d0-\u20ff\ufe20-\ufe2f]/.test(H)}function isHighSurrogateHalf(H){return!!H&&H.length==1&&/[\ud800-\udbff]/.test(H)}function isLowSurrogateHalf(H){return!!H&&H.length==1&&/[\udc00-\udfff]/.test(H)}function isInsideSurrogatePair(H,B){return isHighSurrogateHalf(H.charAt(B-1))&&isLowSurrogateHalf(H.charAt(B))}function isInsideCombinedSymbol(H,B){return isCombiningMark(H.charAt(B))}const EMOJI_PATTERN=buildEmojiRegexp();function isInsideEmojiSequence(H,B){const t=String(H).matchAll(EMOJI_PATTERN);return Array.from(t).some(V=>V.index<B&&B<V.index+V[0].length)}function buildEmojiRegexp(){const H=[new RegExp("\\p{Emoji}[\\u{E0020}-\\u{E007E}]+\\u{E007F}","u"),new RegExp("\\p{Emoji}\\u{FE0F}?\\u{20E3}","u"),new RegExp("\\p{Emoji}\\u{FE0F}","u"),new RegExp("(?=\\p{General_Category=Other_Symbol})\\p{Emoji}\\p{Emoji_Modifier}*","u")],B=new RegExp("\\p{Regional_Indicator}{2}","u").source,t="(?:"+H.map(N=>N.source).join("|")+")",V=`${B}|${t}(?:‍${t})*`;return new RegExp(V,"ug")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const documentPlaceholders=new WeakMap;let hasDisplayedPlaceholderDeprecationWarning=!1;function enablePlaceholder({view:H,element:B,text:t,isDirectHost:V=!0,keepOnFocus:N=!1}){const W=H.document;documentPlaceholders.has(W)||(documentPlaceholders.set(W,new Map),W.registerPostFixer(G=>updateDocumentPlaceholders(W,G)),W.on("change:isComposing",()=>{H.change(G=>updateDocumentPlaceholders(W,G))},{priority:"high"})),B.is("editableElement")&&B.on("change:placeholder",(G,Z,Y)=>{K(Y)}),B.placeholder?K(B.placeholder):t&&K(t),t&&showPlaceholderTextDeprecationWarning();function K(G){documentPlaceholders.get(W).set(B,{text:G,isDirectHost:V,keepOnFocus:N,hostElement:V?B:null}),H.change(Z=>updateDocumentPlaceholders(W,Z))}}function showPlaceholder(H,B){return B.hasClass("ck-placeholder")?!1:(H.addClass("ck-placeholder",B),!0)}function hidePlaceholder(H,B){return B.hasClass("ck-placeholder")?(H.removeClass("ck-placeholder",B),!0):!1}function needsPlaceholder(H,B){if(!H.isAttached()||Array.from(H.getChildren()).some(K=>!K.is("uiElement")))return!1;const V=H.document,W=V.selection.anchor;return V.isComposing&&W&&W.parent===H?!1:B||!V.isFocused?!0:!!W&&W.parent!==H}function updateDocumentPlaceholders(H,B){const t=documentPlaceholders.get(H),V=[];let N=!1;for(const[W,K]of t)K.isDirectHost&&(V.push(W),updatePlaceholder(B,W,K)&&(N=!0));for(const[W,K]of t){if(K.isDirectHost)continue;const G=getChildPlaceholderHostSubstitute(W);G&&(V.includes(G)||(K.hostElement=G,updatePlaceholder(B,W,K)&&(N=!0)))}return N}function updatePlaceholder(H,B,t){const{text:V,isDirectHost:N,hostElement:W}=t;let K=!1;return W.getAttribute("data-placeholder")!==V&&(H.setAttribute("data-placeholder",V,W),K=!0),(N||B.childCount==1)&&needsPlaceholder(W,t.keepOnFocus)?showPlaceholder(H,W)&&(K=!0):hidePlaceholder(H,W)&&(K=!0),K}function getChildPlaceholderHostSubstitute(H){if(H.childCount){const B=H.getChild(0);if(B.is("element")&&!B.is("uiElement")&&!B.is("attributeElement"))return B}return null}function showPlaceholderTextDeprecationWarning(){hasDisplayedPlaceholderDeprecationWarning||logWarning("enableplaceholder-deprecated-text-option"),hasDisplayedPlaceholderDeprecationWarning=!0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let TypeCheckable$1=class{is(){throw new Error("is() method is abstract")}},Node$2=class extends EmitterMixin(TypeCheckable$1){constructor(t){super();ee(this,"document");ee(this,"parent");this.document=t,this.parent=null}get index(){let t;if(!this.parent)return null;if((t=this.parent.getChildIndex(this))==-1)throw new CKEditorError("view-node-not-found-in-parent",this);return t}get nextSibling(){const t=this.index;return t!==null&&this.parent.getChild(t+1)||null}get previousSibling(){const t=this.index;return t!==null&&this.parent.getChild(t-1)||null}get root(){let t=this;for(;t.parent;)t=t.parent;return t}isAttached(){return this.root.is("rootElement")}getPath(){const t=[];let V=this;for(;V.parent;)t.unshift(V.index),V=V.parent;return t}getAncestors(t={}){const V=[];let N=t.includeSelf?this:this.parent;for(;N;)V[t.parentFirst?"push":"unshift"](N),N=N.parent;return V}getCommonAncestor(t,V={}){const N=this.getAncestors(V),W=t.getAncestors(V);let K=0;for(;N[K]==W[K]&&N[K];)K++;return K===0?null:N[K-1]}isBefore(t){if(this==t||this.root!==t.root)return!1;const V=this.getPath(),N=t.getPath(),W=compareArrays(V,N);switch(W){case"prefix":return!0;case"extension":return!1;default:return V[W]<N[W]}}isAfter(t){return this==t||this.root!==t.root?!1:!this.isBefore(t)}_remove(){this.parent._removeChildren(this.index)}_fireChange(t,V){this.fire(`change:${t}`,V),this.parent&&this.parent._fireChange(t,V)}toJSON(){const t=clone$1(this);return delete t.parent,t}};Node$2.prototype.is=function(H){return H==="node"||H==="view:node"};let Text$1=class ct extends Node$2{constructor(t,V){super(t);ee(this,"_textData");this._textData=V}get data(){return this._textData}get _data(){return this.data}set _data(t){this._fireChange("text",this),this._textData=t}isSimilar(t){return t instanceof ct?this===t||this.data===t.data:!1}_clone(){return new ct(this.document,this.data)}};Text$1.prototype.is=function(H){return H==="$text"||H==="view:$text"||H==="text"||H==="view:text"||H==="node"||H==="view:node"};let TextProxy$1=class extends TypeCheckable$1{constructor(t,V,N){super();ee(this,"textNode");ee(this,"data");ee(this,"offsetInText");if(this.textNode=t,V<0||V>t.data.length)throw new CKEditorError("view-textproxy-wrong-offsetintext",this);if(N<0||V+N>t.data.length)throw new CKEditorError("view-textproxy-wrong-length",this);this.data=t.data.substring(V,V+N),this.offsetInText=V}get offsetSize(){return this.data.length}get isPartial(){return this.data.length!==this.textNode.data.length}get parent(){return this.textNode.parent}get root(){return this.textNode.root}get document(){return this.textNode.document}getAncestors(t={}){const V=[];let N=t.includeSelf?this.textNode:this.parent;for(;N!==null;)V[t.parentFirst?"push":"unshift"](N),N=N.parent;return V}};TextProxy$1.prototype.is=function(H){return H==="$textProxy"||H==="view:$textProxy"||H==="textProxy"||H==="view:textProxy"};class Matcher{constructor(...B){ee(this,"_patterns",[]);this.add(...B)}add(...B){for(let t of B)(typeof t=="string"||t instanceof RegExp)&&(t={name:t}),this._patterns.push(t)}match(...B){for(const t of B)for(const V of this._patterns){const N=isElementMatching(t,V);if(N)return{element:t,pattern:V,match:N}}return null}matchAll(...B){const t=[];for(const V of B)for(const N of this._patterns){const W=isElementMatching(V,N);W&&t.push({element:V,pattern:N,match:W})}return t.length>0?t:null}getElementName(){if(this._patterns.length!==1)return null;const B=this._patterns[0],t=B.name;return typeof B!="function"&&t&&!(t instanceof RegExp)?t:null}}function isElementMatching(H,B){if(typeof B=="function")return B(H);const t={};return B.name&&(t.name=matchName(B.name,H.name),!t.name)||B.attributes&&(t.attributes=matchAttributes(B.attributes,H),!t.attributes)||B.classes&&(t.classes=matchClasses(B.classes,H),!t.classes)||B.styles&&(t.styles=matchStyles(B.styles,H),!t.styles)?null:t}function matchName(H,B){return H instanceof RegExp?!!B.match(H):H===B}function matchPatterns(H,B,t){const V=normalizePatterns(H),N=Array.from(B),W=[];if(V.forEach(([K,G])=>{N.forEach(Z=>{isKeyMatched(K,Z)&&isValueMatched(G,Z,t)&&W.push(Z)})}),!(!V.length||W.length<V.length))return W}function normalizePatterns(H){return Array.isArray(H)?H.map(B=>isPlainObject(B)?((B.key===void 0||B.value===void 0)&&logWarning("matcher-pattern-missing-key-or-value",B),[B.key,B.value]):[B,!0]):isPlainObject(H)?Object.entries(H):[[H,!0]]}function isKeyMatched(H,B){return H===!0||H===B||H instanceof RegExp&&B.match(H)}function isValueMatched(H,B,t){if(H===!0)return!0;const V=t(B);return H===V||H instanceof RegExp&&!!String(V).match(H)}function matchAttributes(H,B){const t=new Set(B.getAttributeKeys());return isPlainObject(H)?(H.style!==void 0&&logWarning("matcher-pattern-deprecated-attributes-style-key",H),H.class!==void 0&&logWarning("matcher-pattern-deprecated-attributes-class-key",H)):(t.delete("style"),t.delete("class")),matchPatterns(H,t,V=>B.getAttribute(V))}function matchClasses(H,B){return matchPatterns(H,B.getClassNames(),()=>{})}function matchStyles(H,B){return matchPatterns(H,B.getStyleNames(!0),t=>B.getStyle(t))}class StylesMap{constructor(B){ee(this,"_styles");ee(this,"_styleProcessor");this._styles={},this._styleProcessor=B}get isEmpty(){return!Object.entries(this._styles).length}get size(){return this.isEmpty?0:this.getStyleNames().length}setTo(B){this.clear();const t=parseInlineStyles(B);for(const[V,N]of t)this._styleProcessor.toNormalizedForm(V,N,this._styles)}has(B){if(this.isEmpty)return!1;const V=this._styleProcessor.getReducedForm(B,this._styles).find(([N])=>N===B);return Array.isArray(V)}set(B,t){if(isObject$2(B))for(const[V,N]of Object.entries(B))this._styleProcessor.toNormalizedForm(V,N,this._styles);else this._styleProcessor.toNormalizedForm(B,t,this._styles)}remove(B){const t=toPath(B);unset(this._styles,t),delete this._styles[B],this._cleanEmptyObjectsOnPath(t)}getNormalized(B){return this._styleProcessor.getNormalized(B,this._styles)}toString(){return this.isEmpty?"":this.getStylesEntries().map(B=>B.join(":")).sort().join(";")+";"}getAsString(B){if(this.isEmpty)return;if(this._styles[B]&&!isObject$2(this._styles[B]))return this._styles[B];const V=this._styleProcessor.getReducedForm(B,this._styles).find(([N])=>N===B);if(Array.isArray(V))return V[1]}getStyleNames(B=!1){return this.isEmpty?[]:B?this._styleProcessor.getStyleNames(this._styles):this.getStylesEntries().map(([V])=>V)}clear(){this._styles={}}getStylesEntries(){const B=[],t=Object.keys(this._styles);for(const V of t)B.push(...this._styleProcessor.getReducedForm(V,this._styles));return B}_cleanEmptyObjectsOnPath(B){const t=B.split(".");if(!(t.length>1))return;const N=t.splice(0,t.length-1).join("."),W=get(this._styles,N);if(!W)return;!Object.keys(W).length&&this.remove(N)}}class StylesProcessor{constructor(){ee(this,"_normalizers");ee(this,"_extractors");ee(this,"_reducers");ee(this,"_consumables");this._normalizers=new Map,this._extractors=new Map,this._reducers=new Map,this._consumables=new Map}toNormalizedForm(B,t,V){if(isObject$2(t)){appendStyleValue(V,toPath(B),t);return}if(this._normalizers.has(B)){const N=this._normalizers.get(B),{path:W,value:K}=N(t);appendStyleValue(V,W,K)}else appendStyleValue(V,B,t)}getNormalized(B,t){if(!B)return merge$1({},t);if(t[B]!==void 0)return t[B];if(this._extractors.has(B)){const V=this._extractors.get(B);if(typeof V=="string")return get(t,V);const N=V(B,t);if(N)return N}return get(t,toPath(B))}getReducedForm(B,t){const V=this.getNormalized(B,t);return V===void 0?[]:this._reducers.has(B)?this._reducers.get(B)(V):[[B,V]]}getStyleNames(B){const t=new Set;for(const V of this._consumables.keys()){const N=this.getNormalized(V,B);N&&(typeof N!="object"||Object.keys(N).length)&&t.add(V)}for(const V of Object.keys(B))t.add(V);return Array.from(t)}getRelatedStyles(B){return this._consumables.get(B)||[]}setNormalizer(B,t){this._normalizers.set(B,t)}setExtractor(B,t){this._extractors.set(B,t)}setReducer(B,t){this._reducers.set(B,t)}setStyleRelation(B,t){this._mapStyleNames(B,t);for(const V of t)this._mapStyleNames(V,[B])}_mapStyleNames(B,t){this._consumables.has(B)||this._consumables.set(B,[]),this._consumables.get(B).push(...t)}}function parseInlineStyles(H){let B=null,t=0,V=0,N=null;const W=new Map;if(H==="")return W;H.charAt(H.length-1)!=";"&&(H=H+";");for(let K=0;K<H.length;K++){const G=H.charAt(K);if(B===null)switch(G){case":":N||(N=H.substr(t,K-t),V=K+1);break;case'"':case"'":B=G;break;case";":{const Z=H.substr(V,K-V);N&&W.set(N.trim(),Z.trim()),N=null,t=K+1;break}}else G===B&&(B=null)}return W}function toPath(H){return H.replace("-",".")}function appendStyleValue(H,B,t){let V=t;isObject$2(t)&&(V=merge$1({},get(H,B),t)),set$1(H,B,V)}let Element$1=class xt extends Node$2{constructor(t,V,N,W){super(t);ee(this,"name");ee(this,"_unsafeAttributesToRender",[]);ee(this,"_attrs");ee(this,"_children");ee(this,"_classes");ee(this,"_styles");ee(this,"_customProperties",new Map);if(this.name=V,this._attrs=parseAttributes(N),this._children=[],W&&this._insertChild(0,W),this._classes=new Set,this._attrs.has("class")){const K=this._attrs.get("class");parseClasses(this._classes,K),this._attrs.delete("class")}this._styles=new StylesMap(this.document.stylesProcessor),this._attrs.has("style")&&(this._styles.setTo(this._attrs.get("style")),this._attrs.delete("style"))}get childCount(){return this._children.length}get isEmpty(){return this._children.length===0}getChild(t){return this._children[t]}getChildIndex(t){return this._children.indexOf(t)}getChildren(){return this._children[Symbol.iterator]()}*getAttributeKeys(){this._classes.size>0&&(yield"class"),this._styles.isEmpty||(yield"style"),yield*this._attrs.keys()}*getAttributes(){yield*this._attrs.entries(),this._classes.size>0&&(yield["class",this.getAttribute("class")]),this._styles.isEmpty||(yield["style",this.getAttribute("style")])}getAttribute(t){if(t=="class")return this._classes.size>0?[...this._classes].join(" "):void 0;if(t=="style"){const V=this._styles.toString();return V==""?void 0:V}return this._attrs.get(t)}hasAttribute(t){return t=="class"?this._classes.size>0:t=="style"?!this._styles.isEmpty:this._attrs.has(t)}isSimilar(t){if(!(t instanceof xt))return!1;if(this===t)return!0;if(this.name!=t.name||this._attrs.size!==t._attrs.size||this._classes.size!==t._classes.size||this._styles.size!==t._styles.size)return!1;for(const[V,N]of this._attrs)if(!t._attrs.has(V)||t._attrs.get(V)!==N)return!1;for(const V of this._classes)if(!t._classes.has(V))return!1;for(const V of this._styles.getStyleNames())if(!t._styles.has(V)||t._styles.getAsString(V)!==this._styles.getAsString(V))return!1;return!0}hasClass(...t){for(const V of t)if(!this._classes.has(V))return!1;return!0}getClassNames(){return this._classes.keys()}getStyle(t){return this._styles.getAsString(t)}getNormalizedStyle(t){return this._styles.getNormalized(t)}getStyleNames(t){return this._styles.getStyleNames(t)}hasStyle(...t){for(const V of t)if(!this._styles.has(V))return!1;return!0}findAncestor(...t){const V=new Matcher(...t);let N=this.parent;for(;N&&!N.is("documentFragment");){if(V.match(N))return N;N=N.parent}return null}getCustomProperty(t){return this._customProperties.get(t)}*getCustomProperties(){yield*this._customProperties.entries()}getIdentity(){const t=Array.from(this._classes).sort().join(","),V=this._styles.toString(),N=Array.from(this._attrs).map(W=>`${W[0]}="${W[1]}"`).sort().join(" ");return this.name+(t==""?"":` class="${t}"`)+(V?` style="${V}"`:"")+(N==""?"":` ${N}`)}shouldRenderUnsafeAttribute(t){return this._unsafeAttributesToRender.includes(t)}_clone(t=!1){const V=[];if(t)for(const W of this.getChildren())V.push(W._clone(t));const N=new this.constructor(this.document,this.name,this._attrs,V);return N._classes=new Set(this._classes),N._styles.set(this._styles.getNormalized()),N._customProperties=new Map(this._customProperties),N.getFillerOffset=this.getFillerOffset,N._unsafeAttributesToRender=this._unsafeAttributesToRender,N}_appendChild(t){return this._insertChild(this.childCount,t)}_insertChild(t,V){this._fireChange("children",this);let N=0;const W=normalize$3(this.document,V);for(const K of W)K.parent!==null&&K._remove(),K.parent=this,K.document=this.document,this._children.splice(t,0,K),t++,N++;return N}_removeChildren(t,V=1){this._fireChange("children",this);for(let N=t;N<t+V;N++)this._children[N].parent=null;return this._children.splice(t,V)}_setAttribute(t,V){const N=String(V);this._fireChange("attributes",this),t=="class"?parseClasses(this._classes,N):t=="style"?this._styles.setTo(N):this._attrs.set(t,N)}_removeAttribute(t){return this._fireChange("attributes",this),t=="class"?this._classes.size>0?(this._classes.clear(),!0):!1:t=="style"?this._styles.isEmpty?!1:(this._styles.clear(),!0):this._attrs.delete(t)}_addClass(t){this._fireChange("attributes",this);for(const V of toArray$2(t))this._classes.add(V)}_removeClass(t){this._fireChange("attributes",this);for(const V of toArray$2(t))this._classes.delete(V)}_setStyle(t,V){this._fireChange("attributes",this),typeof t!="string"?this._styles.set(t):this._styles.set(t,V)}_removeStyle(t){this._fireChange("attributes",this);for(const V of toArray$2(t))this._styles.remove(V)}_setCustomProperty(t,V){this._customProperties.set(t,V)}_removeCustomProperty(t){return this._customProperties.delete(t)}};Element$1.prototype.is=function(H,B){return B?B===this.name&&(H==="element"||H==="view:element"):H==="element"||H==="view:element"||H==="node"||H==="view:node"};function parseAttributes(H){const B=toMap(H);for(const[t,V]of B)V===null?B.delete(t):typeof V!="string"&&B.set(t,String(V));return B}function parseClasses(H,B){const t=B.split(/\s+/);H.clear(),t.forEach(V=>H.add(V))}function normalize$3(H,B){return typeof B=="string"?[new Text$1(H,B)]:(isIterable(B)||(B=[B]),Array.from(B).map(t=>typeof t=="string"?new Text$1(H,t):t instanceof TextProxy$1?new Text$1(H,t.data):t))}class ContainerElement extends Element$1{constructor(B,t,V,N){super(B,t,V,N),this.getFillerOffset=getFillerOffset$4}}ContainerElement.prototype.is=function(H,B){return B?B===this.name&&(H==="containerElement"||H==="view:containerElement"||H==="element"||H==="view:element"):H==="containerElement"||H==="view:containerElement"||H==="element"||H==="view:element"||H==="node"||H==="view:node"};function getFillerOffset$4(){const H=[...this.getChildren()],B=H[this.childCount-1];if(B&&B.is("element","br"))return this.childCount;for(const t of H)if(!t.is("uiElement"))return null;return this.childCount}class EditableElement extends ObservableMixin(ContainerElement){constructor(B,t,V,N){super(B,t,V,N),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("placeholder",void 0),this.bind("isReadOnly").to(B),this.bind("isFocused").to(B,"isFocused",W=>W&&B.selection.editableElement==this),this.listenTo(B.selection,"change",()=>{this.isFocused=B.isFocused&&B.selection.editableElement==this})}destroy(){this.stopListening()}}EditableElement.prototype.is=function(H,B){return B?B===this.name&&(H==="editableElement"||H==="view:editableElement"||H==="containerElement"||H==="view:containerElement"||H==="element"||H==="view:element"):H==="editableElement"||H==="view:editableElement"||H==="containerElement"||H==="view:containerElement"||H==="element"||H==="view:element"||H==="node"||H==="view:node"};const rootNameSymbol=Symbol("rootName");class RootEditableElement extends EditableElement{constructor(B,t){super(B,t),this.rootName="main"}get rootName(){return this.getCustomProperty(rootNameSymbol)}set rootName(B){this._setCustomProperty(rootNameSymbol,B)}set _name(B){this.name=B}}RootEditableElement.prototype.is=function(H,B){return B?B===this.name&&(H==="rootElement"||H==="view:rootElement"||H==="editableElement"||H==="view:editableElement"||H==="containerElement"||H==="view:containerElement"||H==="element"||H==="view:element"):H==="rootElement"||H==="view:rootElement"||H==="editableElement"||H==="view:editableElement"||H==="containerElement"||H==="view:containerElement"||H==="element"||H==="view:element"||H==="node"||H==="view:node"};let TreeWalker$1=class{constructor(B={}){ee(this,"direction");ee(this,"boundaries");ee(this,"singleCharacters");ee(this,"shallow");ee(this,"ignoreElementEnd");ee(this,"_position");ee(this,"_boundaryStartParent");ee(this,"_boundaryEndParent");if(!B.boundaries&&!B.startPosition)throw new CKEditorError("view-tree-walker-no-start-position",null);if(B.direction&&B.direction!="forward"&&B.direction!="backward")throw new CKEditorError("view-tree-walker-unknown-direction",B.startPosition,{direction:B.direction});this.boundaries=B.boundaries||null,B.startPosition?this._position=Position$1._createAt(B.startPosition):this._position=Position$1._createAt(B.boundaries[B.direction=="backward"?"end":"start"]),this.direction=B.direction||"forward",this.singleCharacters=!!B.singleCharacters,this.shallow=!!B.shallow,this.ignoreElementEnd=!!B.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}[Symbol.iterator](){return this}get position(){return this._position}skip(B){let t,V;do V=this.position,t=this.next();while(!t.done&&B(t.value));t.done||(this._position=V)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){let B=this.position.clone();const t=this.position,V=B.parent;if(V.parent===null&&B.offset===V.childCount)return{done:!0,value:void 0};if(V===this._boundaryEndParent&&B.offset==this.boundaries.end.offset)return{done:!0,value:void 0};let N;if(V instanceof Text$1){if(B.isAtEnd)return this._position=Position$1._createAfter(V),this._next();N=V.data[B.offset]}else N=V.getChild(B.offset);if(N instanceof Element$1){if(!this.shallow)B=new Position$1(N,0);else{if(this.boundaries&&this.boundaries.end.isBefore(B))return{done:!0,value:void 0};B.offset++}return this._position=B,this._formatReturnValue("elementStart",N,t,B,1)}if(N instanceof Text$1){if(this.singleCharacters)return B=new Position$1(N,0),this._position=B,this._next();let W=N.data.length,K;return N==this._boundaryEndParent?(W=this.boundaries.end.offset,K=new TextProxy$1(N,0,W),B=Position$1._createAfter(K)):(K=new TextProxy$1(N,0,N.data.length),B.offset++),this._position=B,this._formatReturnValue("text",K,t,B,W)}if(typeof N=="string"){let W;this.singleCharacters?W=1:W=(V===this._boundaryEndParent?this.boundaries.end.offset:V.data.length)-B.offset;const K=new TextProxy$1(V,B.offset,W);return B.offset+=W,this._position=B,this._formatReturnValue("text",K,t,B,W)}return B=Position$1._createAfter(V),this._position=B,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",V,t,B)}_previous(){let B=this.position.clone();const t=this.position,V=B.parent;if(V.parent===null&&B.offset===0)return{done:!0,value:void 0};if(V==this._boundaryStartParent&&B.offset==this.boundaries.start.offset)return{done:!0,value:void 0};let N;if(V instanceof Text$1){if(B.isAtStart)return this._position=Position$1._createBefore(V),this._previous();N=V.data[B.offset-1]}else N=V.getChild(B.offset-1);if(N instanceof Element$1)return this.shallow?(B.offset--,this._position=B,this._formatReturnValue("elementStart",N,t,B,1)):(B=new Position$1(N,N.childCount),this._position=B,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",N,t,B));if(N instanceof Text$1){if(this.singleCharacters)return B=new Position$1(N,N.data.length),this._position=B,this._previous();let W=N.data.length,K;if(N==this._boundaryStartParent){const G=this.boundaries.start.offset;K=new TextProxy$1(N,G,N.data.length-G),W=K.data.length,B=Position$1._createBefore(K)}else K=new TextProxy$1(N,0,N.data.length),B.offset--;return this._position=B,this._formatReturnValue("text",K,t,B,W)}if(typeof N=="string"){let W;if(this.singleCharacters)W=1;else{const G=V===this._boundaryStartParent?this.boundaries.start.offset:0;W=B.offset-G}B.offset-=W;const K=new TextProxy$1(V,B.offset,W);return this._position=B,this._formatReturnValue("text",K,t,B,W)}return B=Position$1._createBefore(V),this._position=B,this._formatReturnValue("elementStart",V,t,B,1)}_formatReturnValue(B,t,V,N,W){return t instanceof TextProxy$1&&(t.offsetInText+t.data.length==t.textNode.data.length&&(this.direction=="forward"&&!(this.boundaries&&this.boundaries.end.isEqual(this.position))?(N=Position$1._createAfter(t.textNode),this._position=N):V=Position$1._createAfter(t.textNode)),t.offsetInText===0&&(this.direction=="backward"&&!(this.boundaries&&this.boundaries.start.isEqual(this.position))?(N=Position$1._createBefore(t.textNode),this._position=N):V=Position$1._createBefore(t.textNode))),{done:!1,value:{type:B,item:t,previousPosition:V,nextPosition:N,length:W}}}},Position$1=class et extends TypeCheckable$1{constructor(t,V){super();ee(this,"parent");ee(this,"offset");this.parent=t,this.offset=V}get nodeAfter(){return this.parent.is("$text")?null:this.parent.getChild(this.offset)||null}get nodeBefore(){return this.parent.is("$text")?null:this.parent.getChild(this.offset-1)||null}get isAtStart(){return this.offset===0}get isAtEnd(){const t=this.parent.is("$text")?this.parent.data.length:this.parent.childCount;return this.offset===t}get root(){return this.parent.root}get editableElement(){let t=this.parent;for(;!(t instanceof EditableElement);)if(t.parent)t=t.parent;else return null;return t}getShiftedBy(t){const V=et._createAt(this),N=V.offset+t;return V.offset=N<0?0:N,V}getLastMatchingPosition(t,V={}){V.startPosition=this;const N=new TreeWalker$1(V);return N.skip(t),N.position}getAncestors(){return this.parent.is("documentFragment")?[this.parent]:this.parent.getAncestors({includeSelf:!0})}getCommonAncestor(t){const V=this.getAncestors(),N=t.getAncestors();let W=0;for(;V[W]==N[W]&&V[W];)W++;return W===0?null:V[W-1]}isEqual(t){return this.parent==t.parent&&this.offset==t.offset}isBefore(t){return this.compareWith(t)=="before"}isAfter(t){return this.compareWith(t)=="after"}compareWith(t){if(this.root!==t.root)return"different";if(this.isEqual(t))return"same";const V=this.parent.is("node")?this.parent.getPath():[],N=t.parent.is("node")?t.parent.getPath():[];V.push(this.offset),N.push(t.offset);const W=compareArrays(V,N);switch(W){case"prefix":return"before";case"extension":return"after";default:return V[W]<N[W]?"before":"after"}}getWalker(t={}){return t.startPosition=this,new TreeWalker$1(t)}clone(){return new et(this.parent,this.offset)}static _createAt(t,V){if(t instanceof et)return new this(t.parent,t.offset);{const N=t;if(V=="end")V=N.is("$text")?N.data.length:N.childCount;else{if(V=="before")return this._createBefore(N);if(V=="after")return this._createAfter(N);if(V!==0&&!V)throw new CKEditorError("view-createpositionat-offset-required",N)}return new et(N,V)}}static _createAfter(t){if(t.is("$textProxy"))return new et(t.textNode,t.offsetInText+t.data.length);if(!t.parent)throw new CKEditorError("view-position-after-root",t,{root:t});return new et(t.parent,t.index+1)}static _createBefore(t){if(t.is("$textProxy"))return new et(t.textNode,t.offsetInText);if(!t.parent)throw new CKEditorError("view-position-before-root",t,{root:t});return new et(t.parent,t.index)}};Position$1.prototype.is=function(H){return H==="position"||H==="view:position"};let Range$1=class tt extends TypeCheckable$1{constructor(t,V=null){super();ee(this,"start");ee(this,"end");this.start=t.clone(),this.end=V?V.clone():t.clone()}*[Symbol.iterator](){yield*new TreeWalker$1({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){return this.start.parent===this.end.parent}get root(){return this.start.root}getEnlarged(){let t=this.start.getLastMatchingPosition(enlargeTrimSkip,{direction:"backward"}),V=this.end.getLastMatchingPosition(enlargeTrimSkip);return t.parent.is("$text")&&t.isAtStart&&(t=Position$1._createBefore(t.parent)),V.parent.is("$text")&&V.isAtEnd&&(V=Position$1._createAfter(V.parent)),new tt(t,V)}getTrimmed(){let t=this.start.getLastMatchingPosition(enlargeTrimSkip);if(t.isAfter(this.end)||t.isEqual(this.end))return new tt(t,t);let V=this.end.getLastMatchingPosition(enlargeTrimSkip,{direction:"backward"});const N=t.nodeAfter,W=V.nodeBefore;return N&&N.is("$text")&&(t=new Position$1(N,0)),W&&W.is("$text")&&(V=new Position$1(W,W.data.length)),new tt(t,V)}isEqual(t){return this==t||this.start.isEqual(t.start)&&this.end.isEqual(t.end)}containsPosition(t){return t.isAfter(this.start)&&t.isBefore(this.end)}containsRange(t,V=!1){t.isCollapsed&&(V=!1);const N=this.containsPosition(t.start)||V&&this.start.isEqual(t.start),W=this.containsPosition(t.end)||V&&this.end.isEqual(t.end);return N&&W}getDifference(t){const V=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&V.push(new tt(this.start,t.start)),this.containsPosition(t.end)&&V.push(new tt(t.end,this.end))):V.push(this.clone()),V}getIntersection(t){if(this.isIntersecting(t)){let V=this.start,N=this.end;return this.containsPosition(t.start)&&(V=t.start),this.containsPosition(t.end)&&(N=t.end),new tt(V,N)}return null}getWalker(t={}){return t.boundaries=this,new TreeWalker$1(t)}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;let t=this.start.nodeAfter,V=this.end.nodeBefore;return this.start.parent.is("$text")&&this.start.isAtEnd&&this.start.parent.nextSibling&&(t=this.start.parent.nextSibling),this.end.parent.is("$text")&&this.end.isAtStart&&this.end.parent.previousSibling&&(V=this.end.parent.previousSibling),t&&t.is("element")&&t===V?t:null}clone(){return new tt(this.start,this.end)}*getItems(t={}){t.boundaries=this,t.ignoreElementEnd=!0;const V=new TreeWalker$1(t);for(const N of V)yield N.item}*getPositions(t={}){t.boundaries=this;const V=new TreeWalker$1(t);yield V.position;for(const N of V)yield N.nextPosition}isIntersecting(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}static _createFromParentsAndOffsets(t,V,N,W){return new this(new Position$1(t,V),new Position$1(N,W))}static _createFromPositionAndShift(t,V){const N=t,W=t.getShiftedBy(V);return V>0?new this(N,W):new this(W,N)}static _createIn(t){return this._createFromParentsAndOffsets(t,0,t,t.childCount)}static _createOn(t){const V=t.is("$textProxy")?t.offsetSize:1;return this._createFromPositionAndShift(Position$1._createBefore(t),V)}};Range$1.prototype.is=function(H){return H==="range"||H==="view:range"};function enlargeTrimSkip(H){return!!(H.item.is("attributeElement")||H.item.is("uiElement"))}let Selection$1=class dt extends EmitterMixin(TypeCheckable$1){constructor(...t){super();ee(this,"_ranges");ee(this,"_lastRangeBackward");ee(this,"_isFake");ee(this,"_fakeSelectionLabel");this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel="",t.length&&this.setTo(...t)}get isFake(){return this._isFake}get fakeSelectionLabel(){return this._fakeSelectionLabel}get anchor(){if(!this._ranges.length)return null;const t=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?t.end:t.start).clone()}get focus(){if(!this._ranges.length)return null;const t=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?t.start:t.end).clone()}get isCollapsed(){return this.rangeCount===1&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}get editableElement(){return this.anchor?this.anchor.editableElement:null}*getRanges(){for(const t of this._ranges)yield t.clone()}getFirstRange(){let t=null;for(const V of this._ranges)(!t||V.start.isBefore(t.start))&&(t=V);return t?t.clone():null}getLastRange(){let t=null;for(const V of this._ranges)(!t||V.end.isAfter(t.end))&&(t=V);return t?t.clone():null}getFirstPosition(){const t=this.getFirstRange();return t?t.start.clone():null}getLastPosition(){const t=this.getLastRange();return t?t.end.clone():null}isEqual(t){if(this.isFake!=t.isFake||this.isFake&&this.fakeSelectionLabel!=t.fakeSelectionLabel||this.rangeCount!=t.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;for(const V of this._ranges){let N=!1;for(const W of t._ranges)if(V.isEqual(W)){N=!0;break}if(!N)return!1}return!0}isSimilar(t){if(this.isBackward!=t.isBackward)return!1;const V=count(this.getRanges()),N=count(t.getRanges());if(V!=N)return!1;if(V==0)return!0;for(let W of this.getRanges()){W=W.getTrimmed();let K=!1;for(let G of t.getRanges())if(G=G.getTrimmed(),W.start.isEqual(G.start)&&W.end.isEqual(G.end)){K=!0;break}if(!K)return!1}return!0}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}setTo(...t){let[V,N,W]=t;if(typeof N=="object"&&(W=N,N=void 0),V===null)this._setRanges([]),this._setFakeOptions(W);else if(V instanceof dt||V instanceof DocumentSelection$1)this._setRanges(V.getRanges(),V.isBackward),this._setFakeOptions({fake:V.isFake,label:V.fakeSelectionLabel});else if(V instanceof Range$1)this._setRanges([V],W&&W.backward),this._setFakeOptions(W);else if(V instanceof Position$1)this._setRanges([new Range$1(V)]),this._setFakeOptions(W);else if(V instanceof Node$2){const K=!!W&&!!W.backward;let G;if(N===void 0)throw new CKEditorError("view-selection-setto-required-second-parameter",this);N=="in"?G=Range$1._createIn(V):N=="on"?G=Range$1._createOn(V):G=new Range$1(Position$1._createAt(V,N)),this._setRanges([G],K),this._setFakeOptions(W)}else if(isIterable(V))this._setRanges(V,W&&W.backward),this._setFakeOptions(W);else throw new CKEditorError("view-selection-setto-not-selectable",this);this.fire("change")}setFocus(t,V){if(this.anchor===null)throw new CKEditorError("view-selection-setfocus-no-ranges",this);const N=Position$1._createAt(t,V);if(N.compareWith(this.focus)=="same")return;const W=this.anchor;this._ranges.pop(),N.compareWith(W)=="before"?this._addRange(new Range$1(N,W),!0):this._addRange(new Range$1(W,N)),this.fire("change")}_setRanges(t,V=!1){t=Array.from(t),this._ranges=[];for(const N of t)this._addRange(N);this._lastRangeBackward=!!V}_setFakeOptions(t={}){this._isFake=!!t.fake,this._fakeSelectionLabel=t.fake&&t.label||""}_addRange(t,V=!1){if(!(t instanceof Range$1))throw new CKEditorError("view-selection-add-range-not-range",this);this._pushRange(t),this._lastRangeBackward=!!V}_pushRange(t){for(const V of this._ranges)if(t.isIntersecting(V))throw new CKEditorError("view-selection-range-intersects",this,{addedRange:t,intersectingRange:V});this._ranges.push(new Range$1(t.start,t.end))}};Selection$1.prototype.is=function(H){return H==="selection"||H==="view:selection"};let DocumentSelection$1=class extends EmitterMixin(TypeCheckable$1){constructor(...t){super();ee(this,"_selection");this._selection=new Selection$1,this._selection.delegate("change").to(this),t.length&&this._selection.setTo(...t)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(t){return this._selection.isEqual(t)}isSimilar(t){return this._selection.isSimilar(t)}_setTo(...t){this._selection.setTo(...t)}_setFocus(t,V){this._selection.setFocus(t,V)}};DocumentSelection$1.prototype.is=function(H){return H==="selection"||H=="documentSelection"||H=="view:selection"||H=="view:documentSelection"};class BubblingEventInfo extends EventInfo{constructor(t,V,N){super(t,V);ee(this,"startRange");ee(this,"_eventPhase");ee(this,"_currentTarget");this.startRange=N,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}const contextsSymbol=Symbol("bubbling contexts");function BubblingEmitterMixin(H){class B extends H{fire(V,...N){try{const W=V instanceof EventInfo?V:new EventInfo(this,V),K=getBubblingContexts(this);if(!K.size)return;if(updateEventInfo(W,"capturing",this),fireListenerFor(K,"$capture",W,...N))return W.return;const G=W.startRange||this.selection.getFirstRange(),Z=G?G.getContainedElement():null,Y=Z?!!getCustomContext(K,Z):!1;let X=Z||getDeeperRangeParent(G);if(updateEventInfo(W,"atTarget",X),!Y){if(fireListenerFor(K,"$text",W,...N))return W.return;updateEventInfo(W,"bubbling",X)}for(;X;){if(X.is("rootElement")){if(fireListenerFor(K,"$root",W,...N))return W.return}else if(X.is("element")&&fireListenerFor(K,X.name,W,...N))return W.return;if(fireListenerFor(K,X,W,...N))return W.return;X=X.parent,updateEventInfo(W,"bubbling",X)}return updateEventInfo(W,"bubbling",this),fireListenerFor(K,"$document",W,...N),W.return}catch(W){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(W,this)}}_addEventListener(V,N,W){const K=toArray$2(W.context||"$document"),G=getBubblingContexts(this);for(const Z of K){let Y=G.get(Z);Y||(Y=new(EmitterMixin()),G.set(Z,Y)),this.listenTo(Y,V,N,W)}}_removeEventListener(V,N){const W=getBubblingContexts(this);for(const K of W.values())this.stopListening(K,V,N)}}return B}{const H=BubblingEmitterMixin(Object);["fire","_addEventListener","_removeEventListener"].forEach(B=>{BubblingEmitterMixin[B]=H.prototype[B]})}function updateEventInfo(H,B,t){H instanceof BubblingEventInfo&&(H._eventPhase=B,H._currentTarget=t)}function fireListenerFor(H,B,t,...V){const N=typeof B=="string"?H.get(B):getCustomContext(H,B);return N?(N.fire(t,...V),t.stop.called):!1}function getCustomContext(H,B){for(const[t,V]of H)if(typeof t=="function"&&t(B))return V;return null}function getBubblingContexts(H){return H[contextsSymbol]||(H[contextsSymbol]=new Map),H[contextsSymbol]}function getDeeperRangeParent(H){if(!H)return null;const B=H.start.parent,t=H.end.parent,V=B.getPath(),N=t.getPath();return V.length>N.length?B:t}let Document$1=class extends BubblingEmitterMixin(ObservableMixin()){constructor(t){super();ee(this,"selection");ee(this,"roots");ee(this,"stylesProcessor");ee(this,"_postFixers",new Set);this.selection=new DocumentSelection$1,this.roots=new Collection({idProperty:"rootName"}),this.stylesProcessor=t,this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1)}getRoot(t="main"){return this.roots.get(t)}registerPostFixer(t){this._postFixers.add(t)}destroy(){this.roots.forEach(t=>t.destroy()),this.stopListening()}_callPostFixers(t){let V=!1;do for(const N of this._postFixers)if(V=N(t),V)break;while(V)}};const DEFAULT_PRIORITY=10;class AttributeElement extends Element$1{constructor(t,V,N,W){super(t,V,N,W);ee(this,"_priority",DEFAULT_PRIORITY);ee(this,"_id",null);ee(this,"_clonesGroup",null);this.getFillerOffset=getFillerOffset$3}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(this.id===null)throw new CKEditorError("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}isSimilar(t){return this.id!==null||t.id!==null?this.id===t.id:super.isSimilar(t)&&this.priority==t.priority}_clone(t=!1){const V=super._clone(t);return V._priority=this._priority,V._id=this._id,V}}ee(AttributeElement,"DEFAULT_PRIORITY",DEFAULT_PRIORITY);AttributeElement.prototype.is=function(H,B){return B?B===this.name&&(H==="attributeElement"||H==="view:attributeElement"||H==="element"||H==="view:element"):H==="attributeElement"||H==="view:attributeElement"||H==="element"||H==="view:element"||H==="node"||H==="view:node"};function getFillerOffset$3(){if(nonUiChildrenCount(this))return null;let H=this.parent;for(;H&&H.is("attributeElement");){if(nonUiChildrenCount(H)>1)return null;H=H.parent}return!H||nonUiChildrenCount(H)>1?null:this.childCount}function nonUiChildrenCount(H){return Array.from(H.getChildren()).filter(B=>!B.is("uiElement")).length}class EmptyElement extends Element$1{constructor(B,t,V,N){super(B,t,V,N),this.getFillerOffset=getFillerOffset$2}_insertChild(B,t){if(t&&(t instanceof Node$2||Array.from(t).length>0))throw new CKEditorError("view-emptyelement-cannot-add",[this,t]);return 0}}EmptyElement.prototype.is=function(H,B){return B?B===this.name&&(H==="emptyElement"||H==="view:emptyElement"||H==="element"||H==="view:element"):H==="emptyElement"||H==="view:emptyElement"||H==="element"||H==="view:element"||H==="node"||H==="view:node"};function getFillerOffset$2(){return null}class UIElement extends Element$1{constructor(B,t,V,N){super(B,t,V,N),this.getFillerOffset=getFillerOffset$1}_insertChild(B,t){if(t&&(t instanceof Node$2||Array.from(t).length>0))throw new CKEditorError("view-uielement-cannot-add",[this,t]);return 0}render(B,t){return this.toDomElement(B)}toDomElement(B){const t=B.createElement(this.name);for(const V of this.getAttributeKeys())t.setAttribute(V,this.getAttribute(V));return t}}UIElement.prototype.is=function(H,B){return B?B===this.name&&(H==="uiElement"||H==="view:uiElement"||H==="element"||H==="view:element"):H==="uiElement"||H==="view:uiElement"||H==="element"||H==="view:element"||H==="node"||H==="view:node"};function injectUiElementHandling(H){H.document.on("arrowKey",(B,t)=>jumpOverUiElement(B,t,H.domConverter),{priority:"low"})}function getFillerOffset$1(){return null}function jumpOverUiElement(H,B,t){if(B.keyCode==keyCodes.arrowright){const V=B.domTarget.ownerDocument.defaultView.getSelection(),N=V.rangeCount==1&&V.getRangeAt(0).collapsed;if(N||B.shiftKey){const W=V.focusNode,K=V.focusOffset,G=t.domPositionToView(W,K);if(G===null)return;let Z=!1;const Y=G.getLastMatchingPosition(X=>(X.item.is("uiElement")&&(Z=!0),!!(X.item.is("uiElement")||X.item.is("attributeElement"))));if(Z){const X=t.viewPositionToDom(Y);N?V.collapse(X.parent,X.offset):V.extend(X.parent,X.offset)}}}}class RawElement extends Element$1{constructor(B,t,V,N){super(B,t,V,N),this.getFillerOffset=getFillerOffset$5}_insertChild(B,t){if(t&&(t instanceof Node$2||Array.from(t).length>0))throw new CKEditorError("view-rawelement-cannot-add",[this,t]);return 0}render(B,t){}}RawElement.prototype.is=function(H,B){return B?B===this.name&&(H==="rawElement"||H==="view:rawElement"||H==="element"||H==="view:element"):H==="rawElement"||H==="view:rawElement"||H===this.name||H==="view:"+this.name||H==="element"||H==="view:element"||H==="node"||H==="view:node"};function getFillerOffset$5(){return null}let DocumentFragment$1=class extends EmitterMixin(TypeCheckable$1){constructor(t,V){super();ee(this,"document");ee(this,"_children",[]);ee(this,"_customProperties",new Map);this.document=t,V&&this._insertChild(0,V)}[Symbol.iterator](){return this._children[Symbol.iterator]()}get childCount(){return this._children.length}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}get name(){}get getFillerOffset(){}getCustomProperty(t){return this._customProperties.get(t)}*getCustomProperties(){yield*this._customProperties.entries()}_appendChild(t){return this._insertChild(this.childCount,t)}getChild(t){return this._children[t]}getChildIndex(t){return this._children.indexOf(t)}getChildren(){return this._children[Symbol.iterator]()}_insertChild(t,V){this._fireChange("children",this);let N=0;const W=normalize$2(this.document,V);for(const K of W)K.parent!==null&&K._remove(),K.parent=this,this._children.splice(t,0,K),t++,N++;return N}_removeChildren(t,V=1){this._fireChange("children",this);for(let N=t;N<t+V;N++)this._children[N].parent=null;return this._children.splice(t,V)}_fireChange(t,V){this.fire("change:"+t,V)}_setCustomProperty(t,V){this._customProperties.set(t,V)}_removeCustomProperty(t){return this._customProperties.delete(t)}};DocumentFragment$1.prototype.is=function(H){return H==="documentFragment"||H==="view:documentFragment"};function normalize$2(H,B){return typeof B=="string"?[new Text$1(H,B)]:(isIterable(B)||(B=[B]),Array.from(B).map(t=>typeof t=="string"?new Text$1(H,t):t instanceof TextProxy$1?new Text$1(H,t.data):t))}class DowncastWriter{constructor(B){ee(this,"document");ee(this,"_cloneGroups",new Map);ee(this,"_slotFactory",null);this.document=B}setSelection(...B){this.document.selection._setTo(...B)}setSelectionFocus(B,t){this.document.selection._setFocus(B,t)}createDocumentFragment(B){return new DocumentFragment$1(this.document,B)}createText(B){return new Text$1(this.document,B)}createAttributeElement(B,t,V={}){const N=new AttributeElement(this.document,B,t);return typeof V.priority=="number"&&(N._priority=V.priority),V.id&&(N._id=V.id),V.renderUnsafeAttributes&&N._unsafeAttributesToRender.push(...V.renderUnsafeAttributes),N}createContainerElement(B,t,V={},N={}){let W=null;isPlainObject(V)?N=V:W=V;const K=new ContainerElement(this.document,B,t,W);return N.renderUnsafeAttributes&&K._unsafeAttributesToRender.push(...N.renderUnsafeAttributes),K}createEditableElement(B,t,V={}){const N=new EditableElement(this.document,B,t);return V.renderUnsafeAttributes&&N._unsafeAttributesToRender.push(...V.renderUnsafeAttributes),N}createEmptyElement(B,t,V={}){const N=new EmptyElement(this.document,B,t);return V.renderUnsafeAttributes&&N._unsafeAttributesToRender.push(...V.renderUnsafeAttributes),N}createUIElement(B,t,V){const N=new UIElement(this.document,B,t);return V&&(N.render=V),N}createRawElement(B,t,V,N={}){const W=new RawElement(this.document,B,t);return V&&(W.render=V),N.renderUnsafeAttributes&&W._unsafeAttributesToRender.push(...N.renderUnsafeAttributes),W}setAttribute(B,t,V){V._setAttribute(B,t)}removeAttribute(B,t){t._removeAttribute(B)}addClass(B,t){t._addClass(B)}removeClass(B,t){t._removeClass(B)}setStyle(B,t,V){isPlainObject(B)&&V===void 0?t._setStyle(B):V._setStyle(B,t)}removeStyle(B,t){t._removeStyle(B)}setCustomProperty(B,t,V){V._setCustomProperty(B,t)}removeCustomProperty(B,t){return t._removeCustomProperty(B)}breakAttributes(B){return B instanceof Position$1?this._breakAttributes(B):this._breakAttributesRange(B)}breakContainer(B){const t=B.parent;if(!t.is("containerElement"))throw new CKEditorError("view-writer-break-non-container-element",this.document);if(!t.parent)throw new CKEditorError("view-writer-break-root",this.document);if(B.isAtStart)return Position$1._createBefore(t);if(!B.isAtEnd){const V=t._clone(!1);this.insert(Position$1._createAfter(t),V);const N=new Range$1(B,Position$1._createAt(t,"end")),W=new Position$1(V,0);this.move(N,W)}return Position$1._createAfter(t)}mergeAttributes(B){const t=B.offset,V=B.parent;if(V.is("$text"))return B;if(V.is("attributeElement")&&V.childCount===0){const K=V.parent,G=V.index;return V._remove(),this._removeFromClonedElementsGroup(V),this.mergeAttributes(new Position$1(K,G))}const N=V.getChild(t-1),W=V.getChild(t);if(!N||!W)return B;if(N.is("$text")&&W.is("$text"))return mergeTextNodes(N,W);if(N.is("attributeElement")&&W.is("attributeElement")&&N.isSimilar(W)){const K=N.childCount;return N._appendChild(W.getChildren()),W._remove(),this._removeFromClonedElementsGroup(W),this.mergeAttributes(new Position$1(N,K))}return B}mergeContainers(B){const t=B.nodeBefore,V=B.nodeAfter;if(!t||!V||!t.is("containerElement")||!V.is("containerElement"))throw new CKEditorError("view-writer-merge-containers-invalid-position",this.document);const N=t.getChild(t.childCount-1),W=N instanceof Text$1?Position$1._createAt(N,"end"):Position$1._createAt(t,"end");return this.move(Range$1._createIn(V),Position$1._createAt(t,"end")),this.remove(Range$1._createOn(V)),W}insert(B,t){t=isIterable(t)?[...t]:[t],validateNodesToInsert(t,this.document);const V=t.reduce((K,G)=>{const Z=K[K.length-1],Y=!G.is("uiElement");return!Z||Z.breakAttributes!=Y?K.push({breakAttributes:Y,nodes:[G]}):Z.nodes.push(G),K},[]);let N=null,W=B;for(const{nodes:K,breakAttributes:G}of V){const Z=this._insertNodes(W,K,G);N||(N=Z.start),W=Z.end}return N?new Range$1(N,W):new Range$1(B)}remove(B){const t=B instanceof Range$1?B:Range$1._createOn(B);if(validateRangeContainer(t,this.document),t.isCollapsed)return new DocumentFragment$1(this.document);const{start:V,end:N}=this._breakAttributesRange(t,!0),W=V.parent,K=N.offset-V.offset,G=W._removeChildren(V.offset,K);for(const Y of G)this._removeFromClonedElementsGroup(Y);const Z=this.mergeAttributes(V);return t.start=Z,t.end=Z.clone(),new DocumentFragment$1(this.document,G)}clear(B,t){validateRangeContainer(B,this.document);const V=B.getWalker({direction:"backward",ignoreElementEnd:!0});for(const N of V){const W=N.item;let K;if(W.is("element")&&t.isSimilar(W))K=Range$1._createOn(W);else if(!N.nextPosition.isAfter(B.start)&&W.is("$textProxy")){const G=W.getAncestors().find(Z=>Z.is("element")&&t.isSimilar(Z));G&&(K=Range$1._createIn(G))}K&&(K.end.isAfter(B.end)&&(K.end=B.end),K.start.isBefore(B.start)&&(K.start=B.start),this.remove(K))}}move(B,t){let V;if(t.isAfter(B.end)){t=this._breakAttributes(t,!0);const N=t.parent,W=N.childCount;B=this._breakAttributesRange(B,!0),V=this.remove(B),t.offset+=N.childCount-W}else V=this.remove(B);return this.insert(t,V)}wrap(B,t){if(!(t instanceof AttributeElement))throw new CKEditorError("view-writer-wrap-invalid-attribute",this.document);if(validateRangeContainer(B,this.document),B.isCollapsed){let V=B.start;V.parent.is("element")&&!_hasNonUiChildren(V.parent)&&(V=V.getLastMatchingPosition(W=>W.item.is("uiElement"))),V=this._wrapPosition(V,t);const N=this.document.selection;return N.isCollapsed&&N.getFirstPosition().isEqual(B.start)&&this.setSelection(V),new Range$1(V)}else return this._wrapRange(B,t)}unwrap(B,t){if(!(t instanceof AttributeElement))throw new CKEditorError("view-writer-unwrap-invalid-attribute",this.document);if(validateRangeContainer(B,this.document),B.isCollapsed)return B;const{start:V,end:N}=this._breakAttributesRange(B,!0),W=V.parent,K=this._unwrapChildren(W,V.offset,N.offset,t),G=this.mergeAttributes(K.start);G.isEqual(K.start)||K.end.offset--;const Z=this.mergeAttributes(K.end);return new Range$1(G,Z)}rename(B,t){const V=new ContainerElement(this.document,B,t.getAttributes());return this.insert(Position$1._createAfter(t),V),this.move(Range$1._createIn(t),Position$1._createAt(V,0)),this.remove(Range$1._createOn(t)),V}clearClonedElementsGroup(B){this._cloneGroups.delete(B)}createPositionAt(B,t){return Position$1._createAt(B,t)}createPositionAfter(B){return Position$1._createAfter(B)}createPositionBefore(B){return Position$1._createBefore(B)}createRange(B,t){return new Range$1(B,t)}createRangeOn(B){return Range$1._createOn(B)}createRangeIn(B){return Range$1._createIn(B)}createSelection(...B){return new Selection$1(...B)}createSlot(B="children"){if(!this._slotFactory)throw new CKEditorError("view-writer-invalid-create-slot-context",this.document);return this._slotFactory(this,B)}_registerSlotFactory(B){this._slotFactory=B}_clearSlotFactory(){this._slotFactory=null}_insertNodes(B,t,V){let N;if(V?N=getParentContainer(B):N=B.parent.is("$text")?B.parent.parent:B.parent,!N)throw new CKEditorError("view-writer-invalid-position-container",this.document);let W;V?W=this._breakAttributes(B,!0):W=B.parent.is("$text")?breakTextNode(B):B;const K=N._insertChild(W.offset,t);for(const X of t)this._addToClonedElementsGroup(X);const G=W.getShiftedBy(K),Z=this.mergeAttributes(W);Z.isEqual(W)||G.offset--;const Y=this.mergeAttributes(G);return new Range$1(Z,Y)}_wrapChildren(B,t,V,N){let W=t;const K=[];for(;W<V;){const Z=B.getChild(W),Y=Z.is("$text"),X=Z.is("attributeElement");if(X&&this._wrapAttributeElement(N,Z))K.push(new Position$1(B,W));else if(Y||!X||shouldABeOutsideB(N,Z)){const Q=N._clone();Z._remove(),Q._appendChild(Z),B._insertChild(W,Q),this._addToClonedElementsGroup(Q),K.push(new Position$1(B,W))}else this._wrapChildren(Z,0,Z.childCount,N);W++}let G=0;for(const Z of K){if(Z.offset-=G,Z.offset==t)continue;this.mergeAttributes(Z).isEqual(Z)||(G++,V--)}return Range$1._createFromParentsAndOffsets(B,t,B,V)}_unwrapChildren(B,t,V,N){let W=t;const K=[];for(;W<V;){const Z=B.getChild(W);if(!Z.is("attributeElement")){W++;continue}if(Z.isSimilar(N)){const Y=Z.getChildren(),X=Z.childCount;Z._remove(),B._insertChild(W,Y),this._removeFromClonedElementsGroup(Z),K.push(new Position$1(B,W),new Position$1(B,W+X)),W+=X,V+=X-1;continue}if(this._unwrapAttributeElement(N,Z)){K.push(new Position$1(B,W),new Position$1(B,W+1)),W++;continue}this._unwrapChildren(Z,0,Z.childCount,N),W++}let G=0;for(const Z of K){if(Z.offset-=G,Z.offset==t||Z.offset==V)continue;this.mergeAttributes(Z).isEqual(Z)||(G++,V--)}return Range$1._createFromParentsAndOffsets(B,t,B,V)}_wrapRange(B,t){const{start:V,end:N}=this._breakAttributesRange(B,!0),W=V.parent,K=this._wrapChildren(W,V.offset,N.offset,t),G=this.mergeAttributes(K.start);G.isEqual(K.start)||K.end.offset--;const Z=this.mergeAttributes(K.end);return new Range$1(G,Z)}_wrapPosition(B,t){if(t.isSimilar(B.parent))return movePositionToTextNode(B.clone());B.parent.is("$text")&&(B=breakTextNode(B));const V=this.createAttributeElement("_wrapPosition-fake-element");V._priority=Number.POSITIVE_INFINITY,V.isSimilar=()=>!1,B.parent._insertChild(B.offset,V);const N=new Range$1(B,B.getShiftedBy(1));this.wrap(N,t);const W=new Position$1(V.parent,V.index);V._remove();const K=W.nodeBefore,G=W.nodeAfter;return K instanceof Text$1&&G instanceof Text$1?mergeTextNodes(K,G):movePositionToTextNode(W)}_wrapAttributeElement(B,t){if(!canBeJoined(B,t)||B.name!==t.name||B.priority!==t.priority)return!1;for(const V of B.getAttributeKeys())if(!(V==="class"||V==="style")&&t.hasAttribute(V)&&t.getAttribute(V)!==B.getAttribute(V))return!1;for(const V of B.getStyleNames())if(t.hasStyle(V)&&t.getStyle(V)!==B.getStyle(V))return!1;for(const V of B.getAttributeKeys())V==="class"||V==="style"||t.hasAttribute(V)||this.setAttribute(V,B.getAttribute(V),t);for(const V of B.getStyleNames())t.hasStyle(V)||this.setStyle(V,B.getStyle(V),t);for(const V of B.getClassNames())t.hasClass(V)||this.addClass(V,t);return!0}_unwrapAttributeElement(B,t){if(!canBeJoined(B,t)||B.name!==t.name||B.priority!==t.priority)return!1;for(const V of B.getAttributeKeys())if(!(V==="class"||V==="style")&&(!t.hasAttribute(V)||t.getAttribute(V)!==B.getAttribute(V)))return!1;if(!t.hasClass(...B.getClassNames()))return!1;for(const V of B.getStyleNames())if(!t.hasStyle(V)||t.getStyle(V)!==B.getStyle(V))return!1;for(const V of B.getAttributeKeys())V==="class"||V==="style"||this.removeAttribute(V,t);return this.removeClass(Array.from(B.getClassNames()),t),this.removeStyle(Array.from(B.getStyleNames()),t),!0}_breakAttributesRange(B,t=!1){const V=B.start,N=B.end;if(validateRangeContainer(B,this.document),B.isCollapsed){const Z=this._breakAttributes(B.start,t);return new Range$1(Z,Z)}const W=this._breakAttributes(N,t),K=W.parent.childCount,G=this._breakAttributes(V,t);return W.offset+=W.parent.childCount-K,new Range$1(G,W)}_breakAttributes(B,t=!1){const V=B.offset,N=B.parent;if(B.parent.is("emptyElement"))throw new CKEditorError("view-writer-cannot-break-empty-element",this.document);if(B.parent.is("uiElement"))throw new CKEditorError("view-writer-cannot-break-ui-element",this.document);if(B.parent.is("rawElement"))throw new CKEditorError("view-writer-cannot-break-raw-element",this.document);if(!t&&N.is("$text")&&isContainerOrFragment(N.parent)||isContainerOrFragment(N))return B.clone();if(N.is("$text"))return this._breakAttributes(breakTextNode(B),t);const W=N.childCount;if(V==W){const K=new Position$1(N.parent,N.index+1);return this._breakAttributes(K,t)}else if(V===0){const K=new Position$1(N.parent,N.index);return this._breakAttributes(K,t)}else{const K=N.index+1,G=N._clone();N.parent._insertChild(K,G),this._addToClonedElementsGroup(G);const Z=N.childCount-V,Y=N._removeChildren(V,Z);G._appendChild(Y);const X=new Position$1(N.parent,K);return this._breakAttributes(X,t)}}_addToClonedElementsGroup(B){if(!B.root.is("rootElement"))return;if(B.is("element"))for(const N of B.getChildren())this._addToClonedElementsGroup(N);const t=B.id;if(!t)return;let V=this._cloneGroups.get(t);V||(V=new Set,this._cloneGroups.set(t,V)),V.add(B),B._clonesGroup=V}_removeFromClonedElementsGroup(B){if(B.is("element"))for(const N of B.getChildren())this._removeFromClonedElementsGroup(N);const t=B.id;if(!t)return;const V=this._cloneGroups.get(t);V&&V.delete(B)}}function _hasNonUiChildren(H){return Array.from(H.getChildren()).some(B=>!B.is("uiElement"))}function getParentContainer(H){let B=H.parent;for(;!isContainerOrFragment(B);){if(!B)return;B=B.parent}return B}function shouldABeOutsideB(H,B){return H.priority<B.priority?!0:H.priority>B.priority?!1:H.getIdentity()<B.getIdentity()}function movePositionToTextNode(H){const B=H.nodeBefore;if(B&&B.is("$text"))return new Position$1(B,B.data.length);const t=H.nodeAfter;return t&&t.is("$text")?new Position$1(t,0):H}function breakTextNode(H){if(H.offset==H.parent.data.length)return new Position$1(H.parent.parent,H.parent.index+1);if(H.offset===0)return new Position$1(H.parent.parent,H.parent.index);const B=H.parent.data.slice(H.offset);return H.parent._data=H.parent.data.slice(0,H.offset),H.parent.parent._insertChild(H.parent.index+1,new Text$1(H.root.document,B)),new Position$1(H.parent.parent,H.parent.index+1)}function mergeTextNodes(H,B){const t=H.data.length;return H._data+=B.data,B._remove(),new Position$1(H,t)}const validNodesToInsert=[Text$1,AttributeElement,ContainerElement,EmptyElement,RawElement,UIElement];function validateNodesToInsert(H,B){for(const t of H){if(!validNodesToInsert.some(V=>t instanceof V))throw new CKEditorError("view-writer-insert-invalid-node-type",B);t.is("$text")||validateNodesToInsert(t.getChildren(),B)}}function isContainerOrFragment(H){return H&&(H.is("containerElement")||H.is("documentFragment"))}function validateRangeContainer(H,B){const t=getParentContainer(H.start),V=getParentContainer(H.end);if(!t||!V||t!==V)throw new CKEditorError("view-writer-invalid-range-container",B)}function canBeJoined(H,B){return H.id===null&&B.id===null}const NBSP_FILLER=H=>H.createTextNode(" "),MARKED_NBSP_FILLER=H=>{const B=H.createElement("span");return B.dataset.ckeFiller="true",B.innerText=" ",B},BR_FILLER=H=>{const B=H.createElement("br");return B.dataset.ckeFiller="true",B},INLINE_FILLER_LENGTH=7,INLINE_FILLER="⁠".repeat(INLINE_FILLER_LENGTH);function startsWithFiller(H){return typeof H=="string"?H.substr(0,INLINE_FILLER_LENGTH)===INLINE_FILLER:isText(H)&&H.data.substr(0,INLINE_FILLER_LENGTH)===INLINE_FILLER}function isInlineFiller(H){return H.data.length==INLINE_FILLER_LENGTH&&startsWithFiller(H)}function getDataWithoutFiller(H){const B=typeof H=="string"?H:H.data;return startsWithFiller(H)?B.slice(INLINE_FILLER_LENGTH):B}function injectQuirksHandling(H){H.document.on("arrowKey",jumpOverInlineFiller,{priority:"low"})}function jumpOverInlineFiller(H,B){if(B.keyCode==keyCodes.arrowleft){const t=B.domTarget.ownerDocument.defaultView.getSelection();if(t.rangeCount==1&&t.getRangeAt(0).collapsed){const V=t.getRangeAt(0).startContainer,N=t.getRangeAt(0).startOffset;startsWithFiller(V)&&N<=INLINE_FILLER_LENGTH&&t.collapse(V,0)}}}let Renderer$1=class extends ObservableMixin(){constructor(t,V){super();ee(this,"domDocuments",new Set);ee(this,"domConverter");ee(this,"markedAttributes",new Set);ee(this,"markedChildren",new Set);ee(this,"markedTexts",new Set);ee(this,"selection");ee(this,"_inlineFiller",null);ee(this,"_fakeSelectionContainer",null);this.domConverter=t,this.selection=V,this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1),env.isBlink&&!env.isAndroid&&this.on("change:isSelecting",()=>{this.isSelecting||this.render()})}markToSync(t,V){if(t==="text")this.domConverter.mapViewToDom(V.parent)&&this.markedTexts.add(V);else{if(!this.domConverter.mapViewToDom(V))return;if(t==="attributes")this.markedAttributes.add(V);else if(t==="children")this.markedChildren.add(V);else throw new CKEditorError("view-renderer-unknown-type",this)}}render(){if(this.isComposing&&!env.isAndroid)return;let t=null;const V=env.isBlink&&!env.isAndroid?!this.isSelecting:!0;for(const N of this.markedChildren)this._updateChildrenMappings(N);V?(this._inlineFiller&&!this._isSelectionInInlineFiller()&&this._removeInlineFiller(),this._inlineFiller?t=this._getInlineFillerPosition():this._needsInlineFillerAtSelection()&&(t=this.selection.getFirstPosition(),this.markedChildren.add(t.parent))):this._inlineFiller&&this._inlineFiller.parentNode&&(t=this.domConverter.domPositionToView(this._inlineFiller),t&&t.parent.is("$text")&&(t=Position$1._createBefore(t.parent)));for(const N of this.markedAttributes)this._updateAttrs(N);for(const N of this.markedChildren)this._updateChildren(N,{inlineFillerPosition:t});for(const N of this.markedTexts)!this.markedChildren.has(N.parent)&&this.domConverter.mapViewToDom(N.parent)&&this._updateText(N,{inlineFillerPosition:t});if(V)if(t){const N=this.domConverter.viewPositionToDom(t),W=N.parent.ownerDocument;startsWithFiller(N.parent)?this._inlineFiller=N.parent:this._inlineFiller=addInlineFiller(W,N.parent,N.offset)}else this._inlineFiller=null;this._updateFocus(),this._updateSelection(),this.domConverter._clearTemporaryCustomProperties(),this.markedTexts.clear(),this.markedAttributes.clear(),this.markedChildren.clear()}_updateChildrenMappings(t){const V=this.domConverter.mapViewToDom(t);if(!V)return;const N=Array.from(V.childNodes),W=Array.from(this.domConverter.viewChildrenToDom(t,{withChildren:!1})),K=this._diffNodeLists(N,W),G=this._findUpdateActions(K,N,W,areSimilarElements);if(G.indexOf("update")!==-1){const Z={equal:0,insert:0,delete:0};for(const Y of G)if(Y==="update"){const X=Z.equal+Z.insert,Q=Z.equal+Z.delete,te=t.getChild(X);te&&!te.is("uiElement")&&!te.is("rawElement")&&this._updateElementMappings(te,N[Q]),remove$1(W[X]),Z.equal++}else Z[Y]++}}_updateElementMappings(t,V){this.domConverter.unbindDomElement(V),this.domConverter.bindElements(V,t),this.markedChildren.add(t),this.markedAttributes.add(t)}_getInlineFillerPosition(){const t=this.selection.getFirstPosition();return t.parent.is("$text")?Position$1._createBefore(t.parent):t}_isSelectionInInlineFiller(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const t=this.selection.getFirstPosition(),V=this.domConverter.viewPositionToDom(t);return!!(V&&isText(V.parent)&&startsWithFiller(V.parent))}_removeInlineFiller(){const t=this._inlineFiller;if(!startsWithFiller(t))throw new CKEditorError("view-renderer-filler-was-lost",this);isInlineFiller(t)?t.remove():t.data=t.data.substr(INLINE_FILLER_LENGTH),this._inlineFiller=null}_needsInlineFillerAtSelection(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const t=this.selection.getFirstPosition(),V=t.parent,N=t.offset;if(!this.domConverter.mapViewToDom(V.root)||!V.is("element")||!isEditable(V))return!1;const W=t.nodeBefore,K=t.nodeAfter;return!(W instanceof Text$1||K instanceof Text$1||N===V.getFillerOffset()&&(!W||!W.is("element","br"))||env.isAndroid&&(W||K))}_updateText(t,V){const N=this.domConverter.findCorrespondingDomText(t);let K=this.domConverter.viewToDom(t).data;const G=V.inlineFillerPosition;G&&G.parent==t.parent&&G.offset==t.index&&(K=INLINE_FILLER+K),this._updateTextNode(N,K)}_updateAttrs(t){const V=this.domConverter.mapViewToDom(t);if(V){for(const N of V.attributes){const W=N.name;t.hasAttribute(W)||this.domConverter.removeDomElementAttribute(V,W)}for(const N of t.getAttributeKeys())this.domConverter.setDomElementAttribute(V,N,t.getAttribute(N),t)}}_updateChildren(t,V){const N=this.domConverter.mapViewToDom(t);if(!N)return;if(env.isAndroid){let te=null;for(const ie of Array.from(N.childNodes)){if(te&&isText(te)&&isText(ie)){N.normalize();break}te=ie}}const W=V.inlineFillerPosition,K=N.childNodes,G=Array.from(this.domConverter.viewChildrenToDom(t,{bind:!0}));W&&W.parent===t&&addInlineFiller(N.ownerDocument,G,W.offset);const Z=this._diffNodeLists(K,G),Y=this._findUpdateActions(Z,K,G,areTextNodes);let X=0;const Q=new Set;for(const te of Y)te==="delete"?(Q.add(K[X]),remove$1(K[X])):(te==="equal"||te==="update")&&X++;X=0;for(const te of Y)te==="insert"?(insertAt(N,X,G[X]),X++):te==="update"?(this._updateTextNode(K[X],G[X].data),X++):te==="equal"&&(this._markDescendantTextToSync(this.domConverter.domToView(G[X])),X++);for(const te of Q)te.parentNode||this.domConverter.unbindDomElement(te)}_diffNodeLists(t,V){return t=filterOutFakeSelectionContainer(t,this._fakeSelectionContainer),diff(t,V,sameNodes$1.bind(null,this.domConverter))}_findUpdateActions(t,V,N,W){if(t.indexOf("insert")===-1||t.indexOf("delete")===-1)return t;let K=[],G=[],Z=[];const Y={equal:0,insert:0,delete:0};for(const X of t)X==="insert"?Z.push(N[Y.equal+Y.insert]):X==="delete"?G.push(V[Y.equal+Y.delete]):(K=K.concat(diff(G,Z,W).map(Q=>Q==="equal"?"update":Q)),K.push("equal"),G=[],Z=[]),Y[X]++;return K.concat(diff(G,Z,W).map(X=>X==="equal"?"update":X))}_updateTextNode(t,V){const N=t.data;N!=V&&(env.isAndroid&&this.isComposing&&N.replace(/\u00A0/g," ")==V.replace(/\u00A0/g," ")||this._updateTextNodeInternal(t,V))}_updateTextNodeInternal(t,V){const N=fastDiff(t.data,V);for(const W of N)W.type==="insert"?t.insertData(W.index,W.values.join("")):t.deleteData(W.index,W.howMany)}_markDescendantTextToSync(t){if(t){if(t.is("$text"))this.markedTexts.add(t);else if(t.is("element"))for(const V of t.getChildren())this._markDescendantTextToSync(V)}}_updateSelection(){if(env.isBlink&&!env.isAndroid&&this.isSelecting&&!this.markedChildren.size)return;if(this.selection.rangeCount===0){this._removeDomSelection(),this._removeFakeSelection();return}const t=this.domConverter.mapViewToDom(this.selection.editableElement);!this.isFocused||!t||(this.selection.isFake?this._updateFakeSelection(t):this._fakeSelectionContainer&&this._fakeSelectionContainer.isConnected?(this._removeFakeSelection(),this._updateDomSelection(t)):this.isComposing&&env.isAndroid||this._updateDomSelection(t))}_updateFakeSelection(t){const V=t.ownerDocument;this._fakeSelectionContainer||(this._fakeSelectionContainer=createFakeSelectionContainer(V));const N=this._fakeSelectionContainer;if(this.domConverter.bindFakeSelection(N,this.selection),!this._fakeSelectionNeedsUpdate(t))return;(!N.parentElement||N.parentElement!=t)&&t.appendChild(N),N.textContent=this.selection.fakeSelectionLabel||" ";const W=V.getSelection(),K=V.createRange();W.removeAllRanges(),K.selectNodeContents(N),W.addRange(K)}_updateDomSelection(t){const V=t.ownerDocument.defaultView.getSelection();if(!this._domSelectionNeedsUpdate(V))return;const N=this.domConverter.viewPositionToDom(this.selection.anchor),W=this.domConverter.viewPositionToDom(this.selection.focus);V.setBaseAndExtent(N.parent,N.offset,W.parent,W.offset),env.isGecko&&fixGeckoSelectionAfterBr(W,V)}_domSelectionNeedsUpdate(t){if(!this.domConverter.isDomSelectionCorrect(t))return!0;const V=t&&this.domConverter.domSelectionToView(t);return!(V&&this.selection.isEqual(V)||!this.selection.isCollapsed&&this.selection.isSimilar(V))}_fakeSelectionNeedsUpdate(t){const V=this._fakeSelectionContainer,N=t.ownerDocument.getSelection();return!V||V.parentElement!==t||N.anchorNode!==V&&!V.contains(N.anchorNode)?!0:V.textContent!==this.selection.fakeSelectionLabel}_removeDomSelection(){for(const t of this.domDocuments){const V=t.getSelection();if(V.rangeCount){const N=t.activeElement,W=this.domConverter.mapDomToView(N);N&&W&&V.removeAllRanges()}}}_removeFakeSelection(){const t=this._fakeSelectionContainer;t&&t.remove()}_updateFocus(){if(this.isFocused){const t=this.selection.editableElement;t&&this.domConverter.focus(t)}}};function isEditable(H){if(H.getAttribute("contenteditable")=="false")return!1;const B=H.findAncestor(t=>t.hasAttribute("contenteditable"));return!B||B.getAttribute("contenteditable")=="true"}function addInlineFiller(H,B,t){const V=B instanceof Array?B:B.childNodes,N=V[t];if(isText(N))return N.data=INLINE_FILLER+N.data,N;{const W=H.createTextNode(INLINE_FILLER);return Array.isArray(B)?V.splice(t,0,W):insertAt(B,t,W),W}}function areSimilarElements(H,B){return isNode(H)&&isNode(B)&&!isText(H)&&!isText(B)&&!isComment(H)&&!isComment(B)&&H.tagName.toLowerCase()===B.tagName.toLowerCase()}function areTextNodes(H,B){return isNode(H)&&isNode(B)&&isText(H)&&isText(B)}function sameNodes$1(H,B,t){return B===t?!0:isText(B)&&isText(t)?B.data===t.data:!!(H.isBlockFiller(B)&&H.isBlockFiller(t))}function fixGeckoSelectionAfterBr(H,B){let t=H.parent,V=H.offset;if(isText(t)&&isInlineFiller(t)&&(V=indexOf(t)+1,t=t.parentNode),t.nodeType!=Node.ELEMENT_NODE||V!=t.childNodes.length-1)return;const N=t.childNodes[V];N&&N.tagName=="BR"&&B.addRange(B.getRangeAt(0))}function filterOutFakeSelectionContainer(H,B){const t=Array.from(H);return t.length==0||!B||t[t.length-1]==B&&t.pop(),t}function createFakeSelectionContainer(H){const B=H.createElement("div");return B.className="ck-fake-selection-container",Object.assign(B.style,{position:"fixed",top:0,left:"-9999px",width:"42px"}),B.textContent=" ",B}const BR_FILLER_REF=BR_FILLER(global$1.document),NBSP_FILLER_REF=NBSP_FILLER(global$1.document),MARKED_NBSP_FILLER_REF=MARKED_NBSP_FILLER(global$1.document),UNSAFE_ATTRIBUTE_NAME_PREFIX="data-ck-unsafe-attribute-",UNSAFE_ELEMENT_REPLACEMENT_ATTRIBUTE="data-ck-unsafe-element";class DomConverter{constructor(B,{blockFillerMode:t,renderingMode:V="editing"}={}){ee(this,"document");ee(this,"renderingMode");ee(this,"blockFillerMode");ee(this,"preElements");ee(this,"blockElements");ee(this,"inlineObjectElements");ee(this,"unsafeElements");ee(this,"_domDocument");ee(this,"_domToViewMapping",new WeakMap);ee(this,"_viewToDomMapping",new WeakMap);ee(this,"_fakeSelectionMapping",new WeakMap);ee(this,"_rawContentElementMatcher",new Matcher);ee(this,"_inlineObjectElementMatcher",new Matcher);ee(this,"_elementsWithTemporaryCustomProperties",new Set);this.document=B,this.renderingMode=V,this.blockFillerMode=t||(V==="editing"?"br":"nbsp"),this.preElements=["pre"],this.blockElements=["address","article","aside","blockquote","caption","center","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","legend","li","main","menu","nav","ol","p","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul"],this.inlineObjectElements=["object","iframe","input","button","textarea","select","option","video","embed","audio","img","canvas"],this.unsafeElements=["script","style"],this._domDocument=this.renderingMode==="editing"?global$1.document:global$1.document.implementation.createHTMLDocument("")}bindFakeSelection(B,t){this._fakeSelectionMapping.set(B,new Selection$1(t))}fakeSelectionToView(B){return this._fakeSelectionMapping.get(B)}bindElements(B,t){this._domToViewMapping.set(B,t),this._viewToDomMapping.set(t,B)}unbindDomElement(B){const t=this._domToViewMapping.get(B);if(t){this._domToViewMapping.delete(B),this._viewToDomMapping.delete(t);for(const V of B.children)this.unbindDomElement(V)}}bindDocumentFragments(B,t){this._domToViewMapping.set(B,t),this._viewToDomMapping.set(t,B)}shouldRenderAttribute(B,t,V){return this.renderingMode==="data"?!0:(B=B.toLowerCase(),B.startsWith("on")||B==="srcdoc"&&t.match(/\bon\S+\s*=|javascript:|<\s*\/*script/i)?!1:V==="img"&&(B==="src"||B==="srcset")||V==="source"&&B==="srcset"?!0:!t.match(/^\s*(javascript:|data:(image\/svg|text\/x?html))/i))}setContentOf(B,t){if(this.renderingMode==="data"){B.innerHTML=t;return}const V=new DOMParser().parseFromString(t,"text/html"),N=V.createDocumentFragment(),W=V.body.childNodes;for(;W.length>0;)N.appendChild(W[0]);const K=V.createTreeWalker(N,NodeFilter.SHOW_ELEMENT),G=[];let Z;for(;Z=K.nextNode();)G.push(Z);for(const Y of G){for(const Q of Y.getAttributeNames())this.setDomElementAttribute(Y,Q,Y.getAttribute(Q));const X=Y.tagName.toLowerCase();this._shouldRenameElement(X)&&(_logUnsafeElement(X),Y.replaceWith(this._createReplacementDomElement(X,Y)))}for(;B.firstChild;)B.firstChild.remove();B.append(N)}viewToDom(B,t={}){if(B.is("$text")){const V=this._processDataFromViewText(B);return this._domDocument.createTextNode(V)}else{const V=B;if(this.mapViewToDom(V))if(V.getCustomProperty("editingPipeline:doNotReuseOnce"))this._elementsWithTemporaryCustomProperties.add(V);else return this.mapViewToDom(V);let N;if(V.is("documentFragment"))N=this._domDocument.createDocumentFragment(),t.bind&&this.bindDocumentFragments(N,V);else{if(V.is("uiElement"))return V.name==="$comment"?N=this._domDocument.createComment(V.getCustomProperty("$rawContent")):N=V.render(this._domDocument,this),t.bind&&this.bindElements(N,V),N;this._shouldRenameElement(V.name)?(_logUnsafeElement(V.name),N=this._createReplacementDomElement(V.name)):V.hasAttribute("xmlns")?N=this._domDocument.createElementNS(V.getAttribute("xmlns"),V.name):N=this._domDocument.createElement(V.name),V.is("rawElement")&&V.render(N,this),t.bind&&this.bindElements(N,V);for(const W of V.getAttributeKeys())this.setDomElementAttribute(N,W,V.getAttribute(W),V)}if(t.withChildren!==!1)for(const W of this.viewChildrenToDom(V,t))N instanceof HTMLTemplateElement?N.content.appendChild(W):N.appendChild(W);return N}}setDomElementAttribute(B,t,V,N){const W=this.shouldRenderAttribute(t,V,B.tagName.toLowerCase())||N&&N.shouldRenderUnsafeAttribute(t);if(W||logWarning("domconverter-unsafe-attribute-detected",{domElement:B,key:t,value:V}),!isValidAttributeName(t)){logWarning("domconverter-invalid-attribute-detected",{domElement:B,key:t,value:V});return}B.hasAttribute(t)&&!W?B.removeAttribute(t):B.hasAttribute(UNSAFE_ATTRIBUTE_NAME_PREFIX+t)&&W&&B.removeAttribute(UNSAFE_ATTRIBUTE_NAME_PREFIX+t),B.setAttribute(W?t:UNSAFE_ATTRIBUTE_NAME_PREFIX+t,V)}removeDomElementAttribute(B,t){t!=UNSAFE_ELEMENT_REPLACEMENT_ATTRIBUTE&&(B.removeAttribute(t),B.removeAttribute(UNSAFE_ATTRIBUTE_NAME_PREFIX+t))}*viewChildrenToDom(B,t={}){const V=B.getFillerOffset&&B.getFillerOffset();let N=0;for(const W of B.getChildren()){V===N&&(yield this._getBlockFiller());const K=W.is("element")&&!!W.getCustomProperty("dataPipeline:transparentRendering")&&!first(W.getAttributes());if(K&&this.renderingMode=="data")if(W.is("rawElement")){const G=this._domDocument.createElement(W.name);W.render(G,this),yield*[...G.childNodes]}else yield*this.viewChildrenToDom(W,t);else K&&logWarning("domconverter-transparent-rendering-unsupported-in-editing-pipeline",{viewElement:W}),yield this.viewToDom(W,t);N++}V===N&&(yield this._getBlockFiller())}viewRangeToDom(B){const t=this.viewPositionToDom(B.start),V=this.viewPositionToDom(B.end),N=this._domDocument.createRange();return N.setStart(t.parent,t.offset),N.setEnd(V.parent,V.offset),N}viewPositionToDom(B){const t=B.parent;if(t.is("$text")){const V=this.findCorrespondingDomText(t);if(!V)return null;let N=B.offset;return startsWithFiller(V)&&(N+=INLINE_FILLER_LENGTH),{parent:V,offset:N}}else{let V,N,W;if(B.offset===0){if(V=this.mapViewToDom(t),!V)return null;W=V.childNodes[0]}else{const G=B.nodeBefore;if(N=G.is("$text")?this.findCorrespondingDomText(G):this.mapViewToDom(G),!N)return null;V=N.parentNode,W=N.nextSibling}if(isText(W)&&startsWithFiller(W))return{parent:W,offset:INLINE_FILLER_LENGTH};const K=N?indexOf(N)+1:0;return{parent:V,offset:K}}}domToView(B,t={}){const V=[],N=this._domToView(B,t,V),W=N.next().value;return!W||(N.next(),this._processDomInlineNodes(null,V,t),W.is("$text")&&W.data.length==0)?null:W}*domChildrenToView(B,t={},V=[]){let N=[];B instanceof HTMLTemplateElement?N=[...B.content.childNodes]:N=[...B.childNodes];for(let W=0;W<N.length;W++){const K=N[W],G=this._domToView(K,t,V),Z=G.next().value;Z!==null&&(this._isBlockViewElement(Z)&&this._processDomInlineNodes(B,V,t),yield Z,G.next())}this._processDomInlineNodes(B,V,t)}domSelectionToView(B){if(isGeckoRestrictedDomSelection(B))return new Selection$1([]);if(B.rangeCount===1){let N=B.getRangeAt(0).startContainer;isText(N)&&(N=N.parentNode);const W=this.fakeSelectionToView(N);if(W)return W}const t=this.isDomSelectionBackward(B),V=[];for(let N=0;N<B.rangeCount;N++){const W=B.getRangeAt(N),K=this.domRangeToView(W);K&&V.push(K)}return new Selection$1(V,{backward:t})}domRangeToView(B){const t=this.domPositionToView(B.startContainer,B.startOffset),V=this.domPositionToView(B.endContainer,B.endOffset);return t&&V?new Range$1(t,V):null}domPositionToView(B,t=0){if(this.isBlockFiller(B))return this.domPositionToView(B.parentNode,indexOf(B));const V=this.mapDomToView(B);if(V&&(V.is("uiElement")||V.is("rawElement")))return Position$1._createBefore(V);if(isText(B)){if(isInlineFiller(B))return this.domPositionToView(B.parentNode,indexOf(B));const N=this.findCorrespondingViewText(B);let W=t;return N?(startsWithFiller(B)&&(W-=INLINE_FILLER_LENGTH,W=W<0?0:W),new Position$1(N,W)):null}else{if(t===0){const N=this.mapDomToView(B);if(N)return new Position$1(N,0)}else{const N=B.childNodes[t-1];if(isText(N)&&isInlineFiller(N)||N&&this.isBlockFiller(N))return this.domPositionToView(N.parentNode,indexOf(N));const W=isText(N)?this.findCorrespondingViewText(N):this.mapDomToView(N);if(W&&W.parent)return new Position$1(W.parent,W.index+1)}return null}}mapDomToView(B){return this.getHostViewElement(B)||this._domToViewMapping.get(B)}findCorrespondingViewText(B){if(isInlineFiller(B))return null;const t=this.getHostViewElement(B);if(t)return t;const V=B.previousSibling;if(V){if(!this.isElement(V))return null;const N=this.mapDomToView(V);if(N){const W=N.nextSibling;return W instanceof Text$1?W:null}}else{const N=this.mapDomToView(B.parentNode);if(N){const W=N.getChild(0);return W instanceof Text$1?W:null}}return null}mapViewToDom(B){return this._viewToDomMapping.get(B)}findCorrespondingDomText(B){const t=B.previousSibling;return t&&this.mapViewToDom(t)?this.mapViewToDom(t).nextSibling:!t&&B.parent&&this.mapViewToDom(B.parent)?this.mapViewToDom(B.parent).childNodes[0]:null}focus(B){const t=this.mapViewToDom(B);if(t&&t.ownerDocument.activeElement!==t){const{scrollX:V,scrollY:N}=global$1.window,W=[];forEachDomElementAncestor(t,K=>{const{scrollLeft:G,scrollTop:Z}=K;W.push([G,Z])}),t.focus(),forEachDomElementAncestor(t,K=>{const[G,Z]=W.shift();K.scrollLeft=G,K.scrollTop=Z}),global$1.window.scrollTo(V,N)}}_clearDomSelection(){const B=this.mapViewToDom(this.document.selection.editableElement);if(!B)return;const t=B.ownerDocument.defaultView.getSelection(),V=this.domSelectionToView(t);V&&V.rangeCount>0&&t.removeAllRanges()}isElement(B){return B&&B.nodeType==Node.ELEMENT_NODE}isDocumentFragment(B){return B&&B.nodeType==Node.DOCUMENT_FRAGMENT_NODE}isBlockFiller(B){return this.blockFillerMode=="br"?B.isEqualNode(BR_FILLER_REF):B.tagName==="BR"&&hasBlockParent(B,this.blockElements)&&B.parentNode.childNodes.length===1?!0:B.isEqualNode(MARKED_NBSP_FILLER_REF)||isNbspBlockFiller(B,this.blockElements)}isDomSelectionBackward(B){if(B.isCollapsed)return!1;const t=this._domDocument.createRange();try{t.setStart(B.anchorNode,B.anchorOffset),t.setEnd(B.focusNode,B.focusOffset)}catch{return!1}const V=t.collapsed;return t.detach(),V}getHostViewElement(B){const t=getAncestors(B);for(t.pop();t.length;){const V=t.pop(),N=this._domToViewMapping.get(V);if(N&&(N.is("uiElement")||N.is("rawElement")))return N}return null}isDomSelectionCorrect(B){return this._isDomSelectionPositionCorrect(B.anchorNode,B.anchorOffset)&&this._isDomSelectionPositionCorrect(B.focusNode,B.focusOffset)}registerRawContentMatcher(B){this._rawContentElementMatcher.add(B)}registerInlineObjectMatcher(B){this._inlineObjectElementMatcher.add(B)}_clearTemporaryCustomProperties(){for(const B of this._elementsWithTemporaryCustomProperties)B._removeCustomProperty("editingPipeline:doNotReuseOnce");this._elementsWithTemporaryCustomProperties.clear()}_getBlockFiller(){switch(this.blockFillerMode){case"nbsp":return NBSP_FILLER(this._domDocument);case"markedNbsp":return MARKED_NBSP_FILLER(this._domDocument);case"br":return BR_FILLER(this._domDocument)}}_isDomSelectionPositionCorrect(B,t){if(isText(B)&&startsWithFiller(B)&&t<INLINE_FILLER_LENGTH||this.isElement(B)&&startsWithFiller(B.childNodes[t]))return!1;const V=this.mapDomToView(B);return!(V&&(V.is("uiElement")||V.is("rawElement")))}*_domToView(B,t,V){if(this.isBlockFiller(B))return null;const N=this.getHostViewElement(B);if(N)return N;if(isComment(B)&&t.skipComments)return null;if(isText(B)){if(isInlineFiller(B))return null;{const W=B.data;if(W==="")return null;const K=new Text$1(this.document,W);return V.push(K),K}}else{let W=this.mapDomToView(B);if(W)return this._isInlineObjectElement(W)&&V.push(W),W;if(this.isDocumentFragment(B))W=new DocumentFragment$1(this.document),t.bind&&this.bindDocumentFragments(B,W);else{W=this._createViewElement(B,t),t.bind&&this.bindElements(B,W);const G=B.attributes;if(G)for(let Z=G.length,Y=0;Y<Z;Y++)W._setAttribute(G[Y].name,G[Y].value);if(this._isViewElementWithRawContent(W,t))return W._setCustomProperty("$rawContent",B.innerHTML),this._isBlockViewElement(W)||V.push(W),W;if(isComment(B))return W._setCustomProperty("$rawContent",B.data),W}yield W;const K=[];if(t.withChildren!==!1)for(const G of this.domChildrenToView(B,t,K))W._appendChild(G);if(this._isInlineObjectElement(W))V.push(W);else for(const G of K)V.push(G)}}_processDomInlineNodes(B,t,V){if(!t.length||B&&!this.isDocumentFragment(B)&&!this._isBlockDomElement(B))return;let N=!1;for(let W=0;W<t.length;W++){const K=t[W];if(!K.is("$text")){N=!1;continue}let G,Z=!1;if(this._isPreFormatted(K))G=getDataWithoutFiller(K.data);else{G=K.data.replace(/[ \n\t\r]{1,}/g," "),Z=/[^\S\u00A0]/.test(G.charAt(G.length-1));const Y=W>0?t[W-1]:null,X=W+1<t.length?t[W+1]:null,Q=!Y||Y.is("element")&&Y.name=="br"||N,te=X?!1:!startsWithFiller(K.data);V.withChildren!==!1&&(Q&&(G=G.replace(/^ /,"")),te&&(G=G.replace(/ $/,""))),G=getDataWithoutFiller(G),G=G.replace(/ \u00A0/g,"  ");const ie=X&&X.is("element")&&X.name!="br",ne=X&&X.is("$text")&&X.data.charAt(0)==" ";(/[ \u00A0]\u00A0$/.test(G)||!X||ie||ne)&&(G=G.replace(/\u00A0$/," ")),(Q||Y&&Y.is("element")&&Y.name!="br")&&(G=G.replace(/^\u00A0/," "))}G.length==0&&K.parent?(K._remove(),t.splice(W,1),W--):(K._data=G,N=Z)}t.length=0}_processDataFromViewText(B){let t=B.data;if(this._isPreFormatted(B))return t;if(t.charAt(0)==" "){const V=this._getTouchingInlineViewNode(B,!1);(V&&V.is("$textProxy")&&this._nodeEndsWithSpace(V)||!V)&&(t=" "+t.substr(1))}if(t.charAt(t.length-1)==" "){const V=this._getTouchingInlineViewNode(B,!0),N=V&&V.is("$textProxy")&&V.data.charAt(0)==" ";(t.charAt(t.length-2)==" "||!V||N)&&(t=t.substr(0,t.length-1)+" ")}return t.replace(/ {2}/g,"  ")}_nodeEndsWithSpace(B){if(this._isPreFormatted(B))return!1;const t=this._processDataFromViewText(B);return t.charAt(t.length-1)==" "}_isPreFormatted(B){if(_hasViewParentOfType(B,this.preElements))return!0;for(const t of B.getAncestors({parentFirst:!0}))if(!(!t.is("element")||!t.hasStyle("white-space")||t.getStyle("white-space")==="inherit"))return["pre","pre-wrap","break-spaces"].includes(t.getStyle("white-space"));return!1}_getTouchingInlineViewNode(B,t){const V=new TreeWalker$1({startPosition:t?Position$1._createAfter(B):Position$1._createBefore(B),direction:t?"forward":"backward"});for(const{item:N}of V){if(N.is("$textProxy"))return N;if(N.is("element")&&N.getCustomProperty("dataPipeline:transparentRendering"))continue;if(N.is("element","br"))return null;if(this._isInlineObjectElement(N))return N;if(N.is("containerElement"))return null}return null}_isBlockDomElement(B){return this.isElement(B)&&this.blockElements.includes(B.tagName.toLowerCase())}_isBlockViewElement(B){return B.is("element")&&this.blockElements.includes(B.name)}_isInlineObjectElement(B){return B.is("element")?B.name=="br"||this.inlineObjectElements.includes(B.name)||!!this._inlineObjectElementMatcher.match(B):!1}_createViewElement(B,t){if(isComment(B))return new UIElement(this.document,"$comment");const V=t.keepOriginalCase?B.tagName:B.tagName.toLowerCase();return new Element$1(this.document,V)}_isViewElementWithRawContent(B,t){return t.withChildren!==!1&&B.is("element")&&!!this._rawContentElementMatcher.match(B)}_shouldRenameElement(B){const t=B.toLowerCase();return this.renderingMode==="editing"&&this.unsafeElements.includes(t)}_createReplacementDomElement(B,t){const V=this._domDocument.createElement("span");if(V.setAttribute(UNSAFE_ELEMENT_REPLACEMENT_ATTRIBUTE,B),t){for(;t.firstChild;)V.appendChild(t.firstChild);for(const N of t.getAttributeNames())V.setAttribute(N,t.getAttribute(N))}return V}}function _hasViewParentOfType(H,B){return H.getAncestors().some(t=>t.is("element")&&B.includes(t.name))}function forEachDomElementAncestor(H,B){let t=H;for(;t;)B(t),t=t.parentElement}function isNbspBlockFiller(H,B){return H.isEqualNode(NBSP_FILLER_REF)&&hasBlockParent(H,B)&&H.parentNode.childNodes.length===1}function hasBlockParent(H,B){const t=H.parentNode;return!!t&&!!t.tagName&&B.includes(t.tagName.toLowerCase())}function _logUnsafeElement(H){H==="script"&&logWarning("domconverter-unsafe-script-element-detected"),H==="style"&&logWarning("domconverter-unsafe-style-element-detected")}function isGeckoRestrictedDomSelection(H){if(!env.isGecko||!H.rangeCount)return!1;const B=H.getRangeAt(0).startContainer;try{Object.prototype.toString.call(B)}catch{return!0}return!1}class Observer extends DomEmitterMixin(){constructor(t){super();ee(this,"view");ee(this,"document");ee(this,"_isEnabled",!1);this.view=t,this.document=t.document}get isEnabled(){return this._isEnabled}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}destroy(){this.disable(),this.stopListening()}checkShouldIgnoreEventFromTarget(t){return t&&t.nodeType===3&&(t=t.parentNode),!t||t.nodeType!==1?!1:t.matches("[data-cke-ignore-events], [data-cke-ignore-events] *")}}class DomEventData{constructor(B,t,V){ee(this,"view");ee(this,"document");ee(this,"domEvent");ee(this,"domTarget");this.view=B,this.document=B.document,this.domEvent=t,this.domTarget=t.target,assignIn(this,V)}get target(){return this.view.domConverter.mapDomToView(this.domTarget)}preventDefault(){this.domEvent.preventDefault()}stopPropagation(){this.domEvent.stopPropagation()}}class DomEventObserver extends Observer{constructor(){super(...arguments);ee(this,"useCapture",!1);ee(this,"usePassive",!1)}observe(t){(typeof this.domEventType=="string"?[this.domEventType]:this.domEventType).forEach(N=>{this.listenTo(t,N,(W,K)=>{this.isEnabled&&!this.checkShouldIgnoreEventFromTarget(K.target)&&this.onDomEvent(K)},{useCapture:this.useCapture,usePassive:this.usePassive})})}stopObserving(t){this.stopListening(t)}fire(t,V,N){this.isEnabled&&this.document.fire(t,new DomEventData(this.view,V,N))}}class KeyObserver extends DomEventObserver{constructor(){super(...arguments);ee(this,"domEventType",["keydown","keyup"])}onDomEvent(t){const V={keyCode:t.keyCode,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,get keystroke(){return getCode(this)}};this.fire(t.type,t,V)}}class FakeSelectionObserver extends Observer{constructor(t){super(t);ee(this,"_fireSelectionChangeDoneDebounced");this._fireSelectionChangeDoneDebounced=debounce(V=>{this.document.fire("selectionChangeDone",V)},200)}observe(){const t=this.document;t.on("arrowKey",(V,N)=>{t.selection.isFake&&this.isEnabled&&N.preventDefault()},{context:"$capture"}),t.on("arrowKey",(V,N)=>{t.selection.isFake&&this.isEnabled&&this._handleSelectionMove(N.keyCode)},{priority:"lowest"})}stopObserving(){}destroy(){super.destroy(),this._fireSelectionChangeDoneDebounced.cancel()}_handleSelectionMove(t){const V=this.document.selection,N=new Selection$1(V.getRanges(),{backward:V.isBackward,fake:!1});(t==keyCodes.arrowleft||t==keyCodes.arrowup)&&N.setTo(N.getFirstPosition()),(t==keyCodes.arrowright||t==keyCodes.arrowdown)&&N.setTo(N.getLastPosition());const W={oldSelection:V,newSelection:N,domSelection:null};this.document.fire("selectionChange",W),this._fireSelectionChangeDoneDebounced(W)}}let MutationObserver$1=class extends Observer{constructor(t){super(t);ee(this,"domConverter");ee(this,"_config");ee(this,"_domElements");ee(this,"_mutationObserver");this._config={childList:!0,characterData:!0,subtree:!0},this.domConverter=t.domConverter,this._domElements=new Set,this._mutationObserver=new window.MutationObserver(this._onMutations.bind(this))}flush(){this._onMutations(this._mutationObserver.takeRecords())}observe(t){this._domElements.add(t),this.isEnabled&&this._mutationObserver.observe(t,this._config)}stopObserving(t){if(this._domElements.delete(t),this.isEnabled){this._mutationObserver.disconnect();for(const V of this._domElements)this._mutationObserver.observe(V,this._config)}}enable(){super.enable();for(const t of this._domElements)this._mutationObserver.observe(t,this._config)}disable(){super.disable(),this._mutationObserver.disconnect()}destroy(){super.destroy(),this._mutationObserver.disconnect()}_onMutations(t){if(t.length===0)return;const V=this.domConverter,N=new Set,W=new Set;for(const G of t){const Z=V.mapDomToView(G.target);Z&&(Z.is("uiElement")||Z.is("rawElement")||G.type==="childList"&&!this._isBogusBrMutation(G)&&W.add(Z))}for(const G of t){const Z=V.mapDomToView(G.target);if(!(Z&&(Z.is("uiElement")||Z.is("rawElement")))&&G.type==="characterData"){const Y=V.findCorrespondingViewText(G.target);Y&&!W.has(Y.parent)?N.add(Y):!Y&&startsWithFiller(G.target)&&W.add(V.mapDomToView(G.target.parentNode))}}const K=[];for(const G of N)K.push({type:"text",node:G});for(const G of W){const Z=V.mapViewToDom(G),Y=Array.from(G.getChildren()),X=Array.from(V.domChildrenToView(Z,{withChildren:!1}));isEqualWith(Y,X,sameNodes)||K.push({type:"children",node:G})}K.length&&this.document.fire("mutations",{mutations:K})}_isBogusBrMutation(t){let V=null;return t.nextSibling===null&&t.removedNodes.length===0&&t.addedNodes.length==1&&(V=this.domConverter.domToView(t.addedNodes[0],{withChildren:!1})),V&&V.is("element","br")}};function sameNodes(H,B){if(!Array.isArray(H))return H===B?!0:H.is("$text")&&B.is("$text")?H.data===B.data:!1}class FocusObserver extends DomEventObserver{constructor(t){super(t);ee(this,"_renderTimeoutId",null);ee(this,"_isFocusChanging",!1);ee(this,"domEventType",["focus","blur"]);this.useCapture=!0;const V=this.document;V.on("focus",()=>this._handleFocus()),V.on("blur",(N,W)=>this._handleBlur(W)),V.on("beforeinput",()=>{V.isFocused||this._handleFocus()},{priority:"highest"})}flush(){this._isFocusChanging&&(this._isFocusChanging=!1,this.document.isFocused=!0)}onDomEvent(t){this.fire(t.type,t)}destroy(){this._clearTimeout(),super.destroy()}_handleFocus(){this._clearTimeout(),this._isFocusChanging=!0,this._renderTimeoutId=setTimeout(()=>{this._renderTimeoutId=null,this.flush(),this.view.change(()=>{})},50)}_handleBlur(t){const V=this.document.selection.editableElement;(V===null||V===t.target)&&(this.document.isFocused=!1,this._isFocusChanging=!1,this.view.change(()=>{}))}_clearTimeout(){this._renderTimeoutId&&(clearTimeout(this._renderTimeoutId),this._renderTimeoutId=null)}}class SelectionObserver extends Observer{constructor(t){super(t);ee(this,"mutationObserver");ee(this,"focusObserver");ee(this,"selection");ee(this,"domConverter");ee(this,"_documents");ee(this,"_fireSelectionChangeDoneDebounced");ee(this,"_clearInfiniteLoopInterval");ee(this,"_documentIsSelectingInactivityTimeoutDebounced");ee(this,"_loopbackCounter");this.mutationObserver=t.getObserver(MutationObserver$1),this.focusObserver=t.getObserver(FocusObserver),this.selection=this.document.selection,this.domConverter=t.domConverter,this._documents=new WeakSet,this._fireSelectionChangeDoneDebounced=debounce(V=>{this.document.fire("selectionChangeDone",V)},200),this._clearInfiniteLoopInterval=setInterval(()=>this._clearInfiniteLoop(),1e3),this._documentIsSelectingInactivityTimeoutDebounced=debounce(()=>this.document.isSelecting=!1,5e3),this._loopbackCounter=0}observe(t){const V=t.ownerDocument,N=()=>{this.document.isSelecting=!0,this._documentIsSelectingInactivityTimeoutDebounced()},W=()=>{this.document.isSelecting&&(this._handleSelectionChange(V),this.document.isSelecting=!1,this._documentIsSelectingInactivityTimeoutDebounced.cancel())};this.listenTo(t,"selectstart",N,{priority:"highest"}),this.listenTo(t,"keydown",W,{priority:"highest",useCapture:!0}),this.listenTo(t,"keyup",W,{priority:"highest",useCapture:!0}),!this._documents.has(V)&&(this.listenTo(V,"mouseup",W,{priority:"highest",useCapture:!0}),this.listenTo(V,"selectionchange",()=>{this.document.isComposing&&!env.isAndroid||(this._handleSelectionChange(V),this._documentIsSelectingInactivityTimeoutDebounced())}),this.listenTo(this.view.document,"compositionstart",()=>{this._handleSelectionChange(V)},{priority:"lowest"}),this._documents.add(V))}stopObserving(t){this.stopListening(t)}destroy(){super.destroy(),clearInterval(this._clearInfiniteLoopInterval),this._fireSelectionChangeDoneDebounced.cancel(),this._documentIsSelectingInactivityTimeoutDebounced.cancel()}_reportInfiniteLoop(){}_handleSelectionChange(t){if(!this.isEnabled)return;const V=t.defaultView.getSelection();if(this.checkShouldIgnoreEventFromTarget(V.anchorNode))return;this.mutationObserver.flush();const N=this.domConverter.domSelectionToView(V);if(N.rangeCount==0){this.view.hasDomSelection=!1;return}if(this.view.hasDomSelection=!0,this.focusObserver.flush(),!(this.selection.isEqual(N)&&this.domConverter.isDomSelectionCorrect(V))){if(++this._loopbackCounter>60){this._reportInfiniteLoop();return}if(this.selection.isSimilar(N))this.view.forceRender();else{const W={oldSelection:this.selection,newSelection:N,domSelection:V};this.document.fire("selectionChange",W),this._fireSelectionChangeDoneDebounced(W)}}}_clearInfiniteLoop(){this._loopbackCounter=0}}class CompositionObserver extends DomEventObserver{constructor(t){super(t);ee(this,"domEventType",["compositionstart","compositionupdate","compositionend"]);const V=this.document;V.on("compositionstart",()=>{V.isComposing=!0},{priority:"low"}),V.on("compositionend",()=>{V.isComposing=!1},{priority:"low"})}onDomEvent(t){this.fire(t.type,t,{data:t.data})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let DataTransfer$1=class{constructor(B,t={}){ee(this,"_files");ee(this,"_native");this._files=t.cacheFiles?getFiles(B):null,this._native=B}get files(){return this._files||(this._files=getFiles(this._native)),this._files}get types(){return this._native.types}getData(B){return this._native.getData(B)}setData(B,t){this._native.setData(B,t)}set effectAllowed(B){this._native.effectAllowed=B}get effectAllowed(){return this._native.effectAllowed}set dropEffect(B){this._native.dropEffect=B}get dropEffect(){return this._native.dropEffect}setDragImage(B,t,V){this._native.setDragImage(B,t,V)}get isCanceled(){return this._native.dropEffect=="none"||!!this._native.mozUserCancelled}};function getFiles(H){const B=Array.from(H.files||[]),t=Array.from(H.items||[]);return B.length?B:t.filter(V=>V.kind==="file").map(V=>V.getAsFile())}class InputObserver extends DomEventObserver{constructor(){super(...arguments);ee(this,"domEventType","beforeinput")}onDomEvent(t){const V=t.getTargetRanges(),N=this.view,W=N.document;let K=null,G=null,Z=[];if(t.dataTransfer&&(K=new DataTransfer$1(t.dataTransfer)),t.data!==null?G=t.data:K&&(G=K.getData("text/plain")),W.selection.isFake)Z=Array.from(W.selection.getRanges());else if(V.length)Z=V.map(Y=>{const X=N.domConverter.domPositionToView(Y.startContainer,Y.startOffset),Q=N.domConverter.domPositionToView(Y.endContainer,Y.endOffset);if(X)return N.createRange(X,Q);if(Q)return N.createRange(Q)}).filter(Y=>!!Y);else if(env.isAndroid){const Y=t.target.ownerDocument.defaultView.getSelection();Z=Array.from(N.domConverter.domSelectionToView(Y).getRanges())}if(env.isAndroid&&t.inputType=="insertCompositionText"&&G&&G.endsWith(`
`)){this.fire(t.type,t,{inputType:"insertParagraph",targetRanges:[N.createRange(Z[0].end)]});return}if(t.inputType=="insertText"&&G&&G.includes(`
`)){const Y=G.split(/\n{1,2}/g);let X=Z;for(let Q=0;Q<Y.length;Q++){const te=Y[Q];te!=""&&(this.fire(t.type,t,{data:te,dataTransfer:K,targetRanges:X,inputType:t.inputType,isComposing:t.isComposing}),X=[W.selection.getFirstRange()]),Q+1<Y.length&&(this.fire(t.type,t,{inputType:"insertParagraph",targetRanges:X}),X=[W.selection.getFirstRange()])}return}this.fire(t.type,t,{data:G,dataTransfer:K,targetRanges:Z,inputType:t.inputType,isComposing:t.isComposing})}}class ArrowKeysObserver extends Observer{constructor(B){super(B),this.document.on("keydown",(t,V)=>{if(this.isEnabled&&isArrowKeyCode(V.keyCode)){const N=new BubblingEventInfo(this.document,"arrowKey",this.document.selection.getFirstRange());this.document.fire(N,V),N.stop.called&&t.stop()}})}observe(){}stopObserving(){}}class TabObserver extends Observer{constructor(B){super(B);const t=this.document;t.on("keydown",(V,N)=>{if(!this.isEnabled||N.keyCode!=keyCodes.tab||N.ctrlKey)return;const W=new BubblingEventInfo(t,"tab",t.selection.getFirstRange());t.fire(W,N),W.stop.called&&V.stop()})}observe(){}stopObserving(){}}let View$1=class extends ObservableMixin(){constructor(t){super();ee(this,"document");ee(this,"domConverter");ee(this,"domRoots",new Map);ee(this,"_renderer");ee(this,"_initialDomRootAttributes",new WeakMap);ee(this,"_observers",new Map);ee(this,"_writer");ee(this,"_ongoingChange",!1);ee(this,"_postFixersInProgress",!1);ee(this,"_renderingDisabled",!1);ee(this,"_hasChangedSinceTheLastRendering",!1);this.document=new Document$1(t),this.domConverter=new DomConverter(this.document),this.set("isRenderingInProgress",!1),this.set("hasDomSelection",!1),this._renderer=new Renderer$1(this.domConverter,this.document.selection),this._renderer.bind("isFocused","isSelecting","isComposing").to(this.document,"isFocused","isSelecting","isComposing"),this._writer=new DowncastWriter(this.document),this.addObserver(MutationObserver$1),this.addObserver(FocusObserver),this.addObserver(SelectionObserver),this.addObserver(KeyObserver),this.addObserver(FakeSelectionObserver),this.addObserver(CompositionObserver),this.addObserver(ArrowKeysObserver),this.addObserver(InputObserver),this.addObserver(TabObserver),injectQuirksHandling(this),injectUiElementHandling(this),this.on("render",()=>{this._render(),this.document.fire("layoutChanged"),this._hasChangedSinceTheLastRendering=!1}),this.listenTo(this.document.selection,"change",()=>{this._hasChangedSinceTheLastRendering=!0}),this.listenTo(this.document,"change:isFocused",()=>{this._hasChangedSinceTheLastRendering=!0}),env.isiOS&&this.listenTo(this.document,"blur",(V,N)=>{this.domConverter.mapDomToView(N.domEvent.relatedTarget)||this.domConverter._clearDomSelection()}),this.listenTo(this.document,"mutations",(V,{mutations:N})=>{N.forEach(W=>this._renderer.markToSync(W.type,W.node))},{priority:"low"}),this.listenTo(this.document,"mutations",()=>{this.forceRender()},{priority:"lowest"})}attachDomRoot(t,V="main"){const N=this.document.getRoot(V);N._name=t.tagName.toLowerCase();const W={};for(const{name:G,value:Z}of Array.from(t.attributes))W[G]=Z,G==="class"?this._writer.addClass(Z.split(" "),N):N.hasAttribute(G)||this._writer.setAttribute(G,Z,N);this._initialDomRootAttributes.set(t,W);const K=()=>{this._writer.setAttribute("contenteditable",(!N.isReadOnly).toString(),N),N.isReadOnly?this._writer.addClass("ck-read-only",N):this._writer.removeClass("ck-read-only",N)};K(),this.domRoots.set(V,t),this.domConverter.bindElements(t,N),this._renderer.markToSync("children",N),this._renderer.markToSync("attributes",N),this._renderer.domDocuments.add(t.ownerDocument),N.on("change:children",(G,Z)=>this._renderer.markToSync("children",Z)),N.on("change:attributes",(G,Z)=>this._renderer.markToSync("attributes",Z)),N.on("change:text",(G,Z)=>this._renderer.markToSync("text",Z)),N.on("change:isReadOnly",()=>this.change(K)),N.on("change",()=>{this._hasChangedSinceTheLastRendering=!0});for(const G of this._observers.values())G.observe(t,V)}detachDomRoot(t){const V=this.domRoots.get(t);Array.from(V.attributes).forEach(({name:W})=>V.removeAttribute(W));const N=this._initialDomRootAttributes.get(V);for(const W in N)V.setAttribute(W,N[W]);this.domRoots.delete(t),this.domConverter.unbindDomElement(V);for(const W of this._observers.values())W.stopObserving(V)}getDomRoot(t="main"){return this.domRoots.get(t)}addObserver(t){let V=this._observers.get(t);if(V)return V;V=new t(this),this._observers.set(t,V);for(const[N,W]of this.domRoots)V.observe(W,N);return V.enable(),V}getObserver(t){return this._observers.get(t)}disableObservers(){for(const t of this._observers.values())t.disable()}enableObservers(){for(const t of this._observers.values())t.enable()}scrollToTheSelection({alignToTop:t,forceScroll:V,viewportOffset:N=20,ancestorOffset:W=20}={}){const K=this.document.selection.getFirstRange();if(!K)return;const G=cloneDeep({alignToTop:t,forceScroll:V,viewportOffset:N,ancestorOffset:W});typeof N=="number"&&(N={top:N,bottom:N,left:N,right:N});const Z={target:this.domConverter.viewRangeToDom(K),viewportOffset:N,ancestorOffset:W,alignToTop:t,forceScroll:V};this.fire("scrollToTheSelection",Z,G),scrollViewportToShowTarget(Z)}focus(){if(!this.document.isFocused){const t=this.document.selection.editableElement;t&&(this.domConverter.focus(t),this.forceRender())}}change(t){if(this.isRenderingInProgress||this._postFixersInProgress)throw new CKEditorError("cannot-change-view-tree",this);try{if(this._ongoingChange)return t(this._writer);this._ongoingChange=!0;const V=t(this._writer);return this._ongoingChange=!1,!this._renderingDisabled&&this._hasChangedSinceTheLastRendering&&(this._postFixersInProgress=!0,this.document._callPostFixers(this._writer),this._postFixersInProgress=!1,this.fire("render")),V}catch(V){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(V,this)}}forceRender(){this._hasChangedSinceTheLastRendering=!0,this.getObserver(FocusObserver).flush(),this.change(()=>{})}destroy(){for(const t of this._observers.values())t.destroy();this.document.destroy(),this.stopListening()}createPositionAt(t,V){return Position$1._createAt(t,V)}createPositionAfter(t){return Position$1._createAfter(t)}createPositionBefore(t){return Position$1._createBefore(t)}createRange(t,V){return new Range$1(t,V)}createRangeOn(t){return Range$1._createOn(t)}createRangeIn(t){return Range$1._createIn(t)}createSelection(...t){return new Selection$1(...t)}_disableRendering(t){this._renderingDisabled=t,t==!1&&this.change(()=>{})}_render(){this.isRenderingInProgress=!0,this.disableObservers(),this._renderer.render(),this.enableObservers(),this.isRenderingInProgress=!1}};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TypeCheckable{is(){throw new Error("is() method is abstract")}}let Node$1=class extends TypeCheckable{constructor(t){super();ee(this,"parent",null);ee(this,"_attrs");this._attrs=toMap(t)}get document(){return null}get index(){let t;if(!this.parent)return null;if((t=this.parent.getChildIndex(this))===null)throw new CKEditorError("model-node-not-found-in-parent",this);return t}get startOffset(){let t;if(!this.parent)return null;if((t=this.parent.getChildStartOffset(this))===null)throw new CKEditorError("model-node-not-found-in-parent",this);return t}get offsetSize(){return 1}get endOffset(){return this.parent?this.startOffset+this.offsetSize:null}get nextSibling(){const t=this.index;return t!==null&&this.parent.getChild(t+1)||null}get previousSibling(){const t=this.index;return t!==null&&this.parent.getChild(t-1)||null}get root(){let t=this;for(;t.parent;)t=t.parent;return t}isAttached(){return this.parent===null?!1:this.root.isAttached()}getPath(){const t=[];let V=this;for(;V.parent;)t.unshift(V.startOffset),V=V.parent;return t}getAncestors(t={}){const V=[];let N=t.includeSelf?this:this.parent;for(;N;)V[t.parentFirst?"push":"unshift"](N),N=N.parent;return V}getCommonAncestor(t,V={}){const N=this.getAncestors(V),W=t.getAncestors(V);let K=0;for(;N[K]==W[K]&&N[K];)K++;return K===0?null:N[K-1]}isBefore(t){if(this==t||this.root!==t.root)return!1;const V=this.getPath(),N=t.getPath(),W=compareArrays(V,N);switch(W){case"prefix":return!0;case"extension":return!1;default:return V[W]<N[W]}}isAfter(t){return this==t||this.root!==t.root?!1:!this.isBefore(t)}hasAttribute(t){return this._attrs.has(t)}getAttribute(t){return this._attrs.get(t)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}toJSON(){const t={};return this._attrs.size&&(t.attributes=Array.from(this._attrs).reduce((V,N)=>(V[N[0]]=N[1],V),{})),t}_clone(t){return new this.constructor(this._attrs)}_remove(){this.parent._removeChildren(this.index)}_setAttribute(t,V){this._attrs.set(t,V)}_setAttributesTo(t){this._attrs=toMap(t)}_removeAttribute(t){return this._attrs.delete(t)}_clearAttributes(){this._attrs.clear()}};Node$1.prototype.is=function(H){return H==="node"||H==="model:node"};class NodeList{constructor(B){ee(this,"_nodes",[]);B&&this._insertNodes(0,B)}[Symbol.iterator](){return this._nodes[Symbol.iterator]()}get length(){return this._nodes.length}get maxOffset(){return this._nodes.reduce((B,t)=>B+t.offsetSize,0)}getNode(B){return this._nodes[B]||null}getNodeIndex(B){const t=this._nodes.indexOf(B);return t==-1?null:t}getNodeStartOffset(B){const t=this.getNodeIndex(B);if(t===null)return null;let V=0;for(let N=0;N<t;N++)V+=this._nodes[N].offsetSize;return V}indexToOffset(B){if(B==this._nodes.length)return this.maxOffset;const t=this._nodes[B];if(!t)throw new CKEditorError("model-nodelist-index-out-of-bounds",this);return this.getNodeStartOffset(t)}offsetToIndex(B){let t=0;for(const V of this._nodes){if(B>=t&&B<t+V.offsetSize)return this.getNodeIndex(V);t+=V.offsetSize}if(t!=B)throw new CKEditorError("model-nodelist-offset-out-of-bounds",this,{offset:B,nodeList:this});return this.length}_insertNodes(B,t){for(const V of t)if(!(V instanceof Node$1))throw new CKEditorError("model-nodelist-insertnodes-not-node",this);this._nodes=spliceArray(this._nodes,Array.from(t),B,0)}_removeNodes(B,t=1){return this._nodes.splice(B,t)}toJSON(){return this._nodes.map(B=>B.toJSON())}}class Text extends Node$1{constructor(t,V){super(V);ee(this,"_data");this._data=t||""}get offsetSize(){return this.data.length}get data(){return this._data}toJSON(){const t=super.toJSON();return t.data=this.data,t}_clone(){return new Text(this.data,this.getAttributes())}static fromJSON(t){return new Text(t.data,t.attributes)}}Text.prototype.is=function(H){return H==="$text"||H==="model:$text"||H==="text"||H==="model:text"||H==="node"||H==="model:node"};class TextProxy extends TypeCheckable{constructor(t,V,N){super();ee(this,"textNode");ee(this,"data");ee(this,"offsetInText");if(this.textNode=t,V<0||V>t.offsetSize)throw new CKEditorError("model-textproxy-wrong-offsetintext",this);if(N<0||V+N>t.offsetSize)throw new CKEditorError("model-textproxy-wrong-length",this);this.data=t.data.substring(V,V+N),this.offsetInText=V}get startOffset(){return this.textNode.startOffset!==null?this.textNode.startOffset+this.offsetInText:null}get offsetSize(){return this.data.length}get endOffset(){return this.startOffset!==null?this.startOffset+this.offsetSize:null}get isPartial(){return this.offsetSize!==this.textNode.offsetSize}get parent(){return this.textNode.parent}get root(){return this.textNode.root}getPath(){const t=this.textNode.getPath();return t.length>0&&(t[t.length-1]+=this.offsetInText),t}getAncestors(t={}){const V=[];let N=t.includeSelf?this:this.parent;for(;N;)V[t.parentFirst?"push":"unshift"](N),N=N.parent;return V}hasAttribute(t){return this.textNode.hasAttribute(t)}getAttribute(t){return this.textNode.getAttribute(t)}getAttributes(){return this.textNode.getAttributes()}getAttributeKeys(){return this.textNode.getAttributeKeys()}}TextProxy.prototype.is=function(H){return H==="$textProxy"||H==="model:$textProxy"||H==="textProxy"||H==="model:textProxy"};class Element extends Node$1{constructor(t,V,N){super(V);ee(this,"name");ee(this,"_children",new NodeList);this.name=t,N&&this._insertChild(0,N)}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}getChild(t){return this._children.getNode(t)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(t){return this._children.getNodeIndex(t)}getChildStartOffset(t){return this._children.getNodeStartOffset(t)}offsetToIndex(t){return this._children.offsetToIndex(t)}getNodeByPath(t){let V=this;for(const N of t)V=V.getChild(V.offsetToIndex(N));return V}findAncestor(t,V={}){let N=V.includeSelf?this:this.parent;for(;N;){if(N.name===t)return N;N=N.parent}return null}toJSON(){const t=super.toJSON();if(t.name=this.name,this._children.length>0){t.children=[];for(const V of this._children)t.children.push(V.toJSON())}return t}_clone(t=!1){const V=t?Array.from(this._children).map(N=>N._clone(!0)):void 0;return new Element(this.name,this.getAttributes(),V)}_appendChild(t){this._insertChild(this.childCount,t)}_insertChild(t,V){const N=normalize$1(V);for(const W of N)W.parent!==null&&W._remove(),W.parent=this;this._children._insertNodes(t,N)}_removeChildren(t,V=1){const N=this._children._removeNodes(t,V);for(const W of N)W.parent=null;return N}static fromJSON(t){let V;if(t.children){V=[];for(const N of t.children)N.name?V.push(Element.fromJSON(N)):V.push(Text.fromJSON(N))}return new Element(t.name,t.attributes,V)}}Element.prototype.is=function(H,B){return B?B===this.name&&(H==="element"||H==="model:element"):H==="element"||H==="model:element"||H==="node"||H==="model:node"};function normalize$1(H){return typeof H=="string"?[new Text(H)]:(isIterable(H)||(H=[H]),Array.from(H).map(B=>typeof B=="string"?new Text(B):B instanceof TextProxy?new Text(B.data,B.getAttributes()):B))}class TreeWalker{constructor(B){ee(this,"direction");ee(this,"boundaries");ee(this,"singleCharacters");ee(this,"shallow");ee(this,"ignoreElementEnd");ee(this,"_position");ee(this,"_boundaryStartParent");ee(this,"_boundaryEndParent");ee(this,"_visitedParent");if(!B||!B.boundaries&&!B.startPosition)throw new CKEditorError("model-tree-walker-no-start-position",null);const t=B.direction||"forward";if(t!="forward"&&t!="backward")throw new CKEditorError("model-tree-walker-unknown-direction",B,{direction:t});this.direction=t,this.boundaries=B.boundaries||null,B.startPosition?this._position=B.startPosition.clone():this._position=Position._createAt(this.boundaries[this.direction=="backward"?"end":"start"]),this.position.stickiness="toNone",this.singleCharacters=!!B.singleCharacters,this.shallow=!!B.shallow,this.ignoreElementEnd=!!B.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}[Symbol.iterator](){return this}get position(){return this._position}skip(B){let t,V,N,W;do N=this.position,W=this._visitedParent,{done:t,value:V}=this.next();while(!t&&B(V));t||(this._position=N,this._visitedParent=W)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){const B=this.position,t=this.position.clone(),V=this._visitedParent;if(V.parent===null&&t.offset===V.maxOffset)return{done:!0,value:void 0};if(V===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0,value:void 0};const N=getTextNodeAtPosition(t,V),W=N||getNodeAfterPosition(t,V,N);if(W instanceof Element){if(!this.shallow)t.path.push(0),this._visitedParent=W;else{if(this.boundaries&&this.boundaries.end.isBefore(t))return{done:!0,value:void 0};t.offset++}return this._position=t,formatReturnValue("elementStart",W,B,t,1)}if(W instanceof Text){let K;if(this.singleCharacters)K=1;else{let Y=W.endOffset;this._boundaryEndParent==V&&this.boundaries.end.offset<Y&&(Y=this.boundaries.end.offset),K=Y-t.offset}const G=t.offset-W.startOffset,Z=new TextProxy(W,G,K);return t.offset+=K,this._position=t,formatReturnValue("text",Z,B,t,K)}return t.path.pop(),t.offset++,this._position=t,this._visitedParent=V.parent,this.ignoreElementEnd?this._next():formatReturnValue("elementEnd",V,B,t)}_previous(){const B=this.position,t=this.position.clone(),V=this._visitedParent;if(V.parent===null&&t.offset===0)return{done:!0,value:void 0};if(V==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0,value:void 0};const N=t.parent,W=getTextNodeAtPosition(t,N),K=W||getNodeBeforePosition(t,N,W);if(K instanceof Element)return t.offset--,this.shallow?(this._position=t,formatReturnValue("elementStart",K,B,t,1)):(t.path.push(K.maxOffset),this._position=t,this._visitedParent=K,this.ignoreElementEnd?this._previous():formatReturnValue("elementEnd",K,B,t));if(K instanceof Text){let G;if(this.singleCharacters)G=1;else{let X=K.startOffset;this._boundaryStartParent==V&&this.boundaries.start.offset>X&&(X=this.boundaries.start.offset),G=t.offset-X}const Z=t.offset-K.startOffset,Y=new TextProxy(K,Z-G,G);return t.offset-=G,this._position=t,formatReturnValue("text",Y,B,t,G)}return t.path.pop(),this._position=t,this._visitedParent=V.parent,formatReturnValue("elementStart",V,B,t,1)}}function formatReturnValue(H,B,t,V,N){return{done:!1,value:{type:H,item:B,previousPosition:t,nextPosition:V,length:N}}}class Position extends TypeCheckable{constructor(t,V,N="toNone"){super();ee(this,"root");ee(this,"path");ee(this,"stickiness");if(!t.is("element")&&!t.is("documentFragment"))throw new CKEditorError("model-position-root-invalid",t);if(!(V instanceof Array)||V.length===0)throw new CKEditorError("model-position-path-incorrect-format",t,{path:V});t.is("rootElement")?V=V.slice():(V=[...t.getPath(),...V],t=t.root),this.root=t,this.path=V,this.stickiness=N}get offset(){return this.path[this.path.length-1]}set offset(t){this.path[this.path.length-1]=t}get parent(){let t=this.root;for(let V=0;V<this.path.length-1;V++)if(t=t.getChild(t.offsetToIndex(this.path[V])),!t)throw new CKEditorError("model-position-path-incorrect",this,{position:this});if(t.is("$text"))throw new CKEditorError("model-position-path-incorrect",this,{position:this});return t}get index(){return this.parent.offsetToIndex(this.offset)}get textNode(){return getTextNodeAtPosition(this,this.parent)}get nodeAfter(){const t=this.parent;return getNodeAfterPosition(this,t,getTextNodeAtPosition(this,t))}get nodeBefore(){const t=this.parent;return getNodeBeforePosition(this,t,getTextNodeAtPosition(this,t))}get isAtStart(){return this.offset===0}get isAtEnd(){return this.offset==this.parent.maxOffset}compareWith(t){if(this.root!=t.root)return"different";const V=compareArrays(this.path,t.path);switch(V){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[V]<t.path[V]?"before":"after"}}getLastMatchingPosition(t,V={}){V.startPosition=this;const N=new TreeWalker(V);return N.skip(t),N.position}getParentPath(){return this.path.slice(0,-1)}getAncestors(){const t=this.parent;return t.is("documentFragment")?[t]:t.getAncestors({includeSelf:!0})}findAncestor(t){const V=this.parent;return V.is("element")?V.findAncestor(t,{includeSelf:!0}):null}getCommonPath(t){if(this.root!=t.root)return[];const V=compareArrays(this.path,t.path),N=typeof V=="string"?Math.min(this.path.length,t.path.length):V;return this.path.slice(0,N)}getCommonAncestor(t){const V=this.getAncestors(),N=t.getAncestors();let W=0;for(;V[W]==N[W]&&V[W];)W++;return W===0?null:V[W-1]}getShiftedBy(t){const V=this.clone(),N=V.offset+t;return V.offset=N<0?0:N,V}isAfter(t){return this.compareWith(t)=="after"}isBefore(t){return this.compareWith(t)=="before"}isEqual(t){return this.compareWith(t)=="same"}isTouching(t){if(this.root!==t.root)return!1;const V=Math.min(this.path.length,t.path.length);for(let N=0;N<V;N++){const W=this.path[N]-t.path[N];if(W<-1||W>1)return!1;if(W===1)return checkTouchingBranch(t,this,N);if(W===-1)return checkTouchingBranch(this,t,N)}return this.path.length===t.path.length?!0:this.path.length>t.path.length?checkOnlyZeroes(this.path,V):checkOnlyZeroes(t.path,V)}hasSameParentAs(t){if(this.root!==t.root)return!1;const V=this.getParentPath(),N=t.getParentPath();return compareArrays(V,N)=="same"}getTransformedByOperation(t){let V;switch(t.type){case"insert":V=this._getTransformedByInsertOperation(t);break;case"move":case"remove":case"reinsert":V=this._getTransformedByMoveOperation(t);break;case"split":V=this._getTransformedBySplitOperation(t);break;case"merge":V=this._getTransformedByMergeOperation(t);break;default:V=Position._createAt(this);break}return V}_getTransformedByInsertOperation(t){return this._getTransformedByInsertion(t.position,t.howMany)}_getTransformedByMoveOperation(t){return this._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany)}_getTransformedBySplitOperation(t){const V=t.movedRange;return V.containsPosition(this)||V.start.isEqual(this)&&this.stickiness=="toNext"?this._getCombined(t.splitPosition,t.moveTargetPosition):t.graveyardPosition?this._getTransformedByMove(t.graveyardPosition,t.insertionPosition,1):this._getTransformedByInsertion(t.insertionPosition,1)}_getTransformedByMergeOperation(t){const V=t.movedRange,N=V.containsPosition(this)||V.start.isEqual(this);let W;return N?(W=this._getCombined(t.sourcePosition,t.targetPosition),t.sourcePosition.isBefore(t.targetPosition)&&(W=W._getTransformedByDeletion(t.deletionPosition,1))):this.isEqual(t.deletionPosition)?W=Position._createAt(t.deletionPosition):W=this._getTransformedByMove(t.deletionPosition,t.graveyardPosition,1),W}_getTransformedByDeletion(t,V){const N=Position._createAt(this);if(this.root!=t.root)return N;if(compareArrays(t.getParentPath(),this.getParentPath())=="same"){if(t.offset<this.offset){if(t.offset+V>this.offset)return null;N.offset-=V}}else if(compareArrays(t.getParentPath(),this.getParentPath())=="prefix"){const W=t.path.length-1;if(t.offset<=this.path[W]){if(t.offset+V>this.path[W])return null;N.path[W]-=V}}return N}_getTransformedByInsertion(t,V){const N=Position._createAt(this);if(this.root!=t.root)return N;if(compareArrays(t.getParentPath(),this.getParentPath())=="same")(t.offset<this.offset||t.offset==this.offset&&this.stickiness!="toPrevious")&&(N.offset+=V);else if(compareArrays(t.getParentPath(),this.getParentPath())=="prefix"){const W=t.path.length-1;t.offset<=this.path[W]&&(N.path[W]+=V)}return N}_getTransformedByMove(t,V,N){if(V=V._getTransformedByDeletion(t,N),t.isEqual(V))return Position._createAt(this);const W=this._getTransformedByDeletion(t,N);return W===null||t.isEqual(this)&&this.stickiness=="toNext"||t.getShiftedBy(N).isEqual(this)&&this.stickiness=="toPrevious"?this._getCombined(t,V):W._getTransformedByInsertion(V,N)}_getCombined(t,V){const N=t.path.length-1,W=Position._createAt(V);return W.stickiness=this.stickiness,W.offset=W.offset+this.path[N]-t.offset,W.path=[...W.path,...this.path.slice(N+1)],W}toJSON(){return{root:this.root.toJSON(),path:Array.from(this.path),stickiness:this.stickiness}}clone(){return new this.constructor(this.root,this.path,this.stickiness)}static _createAt(t,V,N="toNone"){if(t instanceof Position)return new Position(t.root,t.path,t.stickiness);{const W=t;if(V=="end")V=W.maxOffset;else{if(V=="before")return this._createBefore(W,N);if(V=="after")return this._createAfter(W,N);if(V!==0&&!V)throw new CKEditorError("model-createpositionat-offset-required",[this,t])}if(!W.is("element")&&!W.is("documentFragment"))throw new CKEditorError("model-position-parent-incorrect",[this,t]);const K=W.getPath();return K.push(V),new this(W.root,K,N)}}static _createAfter(t,V){if(!t.parent)throw new CKEditorError("model-position-after-root",[this,t],{root:t});return this._createAt(t.parent,t.endOffset,V)}static _createBefore(t,V){if(!t.parent)throw new CKEditorError("model-position-before-root",t,{root:t});return this._createAt(t.parent,t.startOffset,V)}static fromJSON(t,V){if(t.root==="$graveyard"){const N=new Position(V.graveyard,t.path);return N.stickiness=t.stickiness,N}if(!V.getRoot(t.root))throw new CKEditorError("model-position-fromjson-no-root",V,{rootName:t.root});return new Position(V.getRoot(t.root),t.path,t.stickiness)}}Position.prototype.is=function(H){return H==="position"||H==="model:position"};function getTextNodeAtPosition(H,B){const t=B.getChild(B.offsetToIndex(H.offset));return t&&t.is("$text")&&t.startOffset<H.offset?t:null}function getNodeAfterPosition(H,B,t){return t!==null?null:B.getChild(B.offsetToIndex(H.offset))}function getNodeBeforePosition(H,B,t){return t!==null?null:B.getChild(B.offsetToIndex(H.offset)-1)}function checkTouchingBranch(H,B,t){return!(t+1===H.path.length||!checkOnlyZeroes(B.path,t+1)||!checkOnlyMaxOffset(H,t+1))}function checkOnlyZeroes(H,B){for(;B<H.length;){if(H[B]!==0)return!1;B++}return!0}function checkOnlyMaxOffset(H,B){let t=H.parent,V=H.path.length-1,N=0;for(;V>=B;){if(H.path[V]+N!==t.maxOffset)return!1;N=1,V--,t=t.parent}return!0}class Range extends TypeCheckable{constructor(t,V){super();ee(this,"start");ee(this,"end");this.start=Position._createAt(t),this.end=V?Position._createAt(V):Position._createAt(t),this.start.stickiness=this.isCollapsed?"toNone":"toNext",this.end.stickiness=this.isCollapsed?"toNone":"toPrevious"}*[Symbol.iterator](){yield*new TreeWalker({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){const t=this.start.getParentPath(),V=this.end.getParentPath();return compareArrays(t,V)=="same"}get root(){return this.start.root}containsPosition(t){return t.isAfter(this.start)&&t.isBefore(this.end)}containsRange(t,V=!1){t.isCollapsed&&(V=!1);const N=this.containsPosition(t.start)||V&&this.start.isEqual(t.start),W=this.containsPosition(t.end)||V&&this.end.isEqual(t.end);return N&&W}containsItem(t){const V=Position._createBefore(t);return this.containsPosition(V)||this.start.isEqual(V)}isEqual(t){return this.start.isEqual(t.start)&&this.end.isEqual(t.end)}isIntersecting(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}getDifference(t){const V=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&V.push(new Range(this.start,t.start)),this.containsPosition(t.end)&&V.push(new Range(t.end,this.end))):V.push(new Range(this.start,this.end)),V}getIntersection(t){if(this.isIntersecting(t)){let V=this.start,N=this.end;return this.containsPosition(t.start)&&(V=t.start),this.containsPosition(t.end)&&(N=t.end),new Range(V,N)}return null}getJoined(t,V=!1){let N=this.isIntersecting(t);if(N||(this.start.isBefore(t.start)?N=V?this.end.isTouching(t.start):this.end.isEqual(t.start):N=V?t.end.isTouching(this.start):t.end.isEqual(this.start)),!N)return null;let W=this.start,K=this.end;return t.start.isBefore(W)&&(W=t.start),t.end.isAfter(K)&&(K=t.end),new Range(W,K)}getMinimalFlatRanges(){const t=[],V=this.start.getCommonPath(this.end).length,N=Position._createAt(this.start);let W=N.parent;for(;N.path.length>V+1;){const K=W.maxOffset-N.offset;K!==0&&t.push(new Range(N,N.getShiftedBy(K))),N.path=N.path.slice(0,-1),N.offset++,W=W.parent}for(;N.path.length<=this.end.path.length;){const K=this.end.path[N.path.length-1],G=K-N.offset;G!==0&&t.push(new Range(N,N.getShiftedBy(G))),N.offset=K,N.path.push(0)}return t}getWalker(t={}){return t.boundaries=this,new TreeWalker(t)}*getItems(t={}){t.boundaries=this,t.ignoreElementEnd=!0;const V=new TreeWalker(t);for(const N of V)yield N.item}*getPositions(t={}){t.boundaries=this;const V=new TreeWalker(t);yield V.position;for(const N of V)yield N.nextPosition}getTransformedByOperation(t){switch(t.type){case"insert":return this._getTransformedByInsertOperation(t);case"move":case"remove":case"reinsert":return this._getTransformedByMoveOperation(t);case"split":return[this._getTransformedBySplitOperation(t)];case"merge":return[this._getTransformedByMergeOperation(t)]}return[new Range(this.start,this.end)]}getTransformedByOperations(t){const V=[new Range(this.start,this.end)];for(const N of t)for(let W=0;W<V.length;W++){const K=V[W].getTransformedByOperation(N);V.splice(W,1,...K),W+=K.length-1}for(let N=0;N<V.length;N++){const W=V[N];for(let K=N+1;K<V.length;K++){const G=V[K];(W.containsRange(G)||G.containsRange(W)||W.isEqual(G))&&V.splice(K,1)}}return V}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;const t=this.start.nodeAfter,V=this.end.nodeBefore;return t&&t.is("element")&&t===V?t:null}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}clone(){return new this.constructor(this.start,this.end)}_getTransformedByInsertOperation(t,V=!1){return this._getTransformedByInsertion(t.position,t.howMany,V)}_getTransformedByMoveOperation(t,V=!1){const N=t.sourcePosition,W=t.howMany,K=t.targetPosition;return this._getTransformedByMove(N,K,W,V)}_getTransformedBySplitOperation(t){const V=this.start._getTransformedBySplitOperation(t);let N=this.end._getTransformedBySplitOperation(t);return this.end.isEqual(t.insertionPosition)&&(N=this.end.getShiftedBy(1)),V.root!=N.root&&(N=this.end.getShiftedBy(-1)),new Range(V,N)}_getTransformedByMergeOperation(t){if(this.start.isEqual(t.targetPosition)&&this.end.isEqual(t.deletionPosition))return new Range(this.start);let V=this.start._getTransformedByMergeOperation(t),N=this.end._getTransformedByMergeOperation(t);return V.root!=N.root&&(N=this.end.getShiftedBy(-1)),V.isAfter(N)?(t.sourcePosition.isBefore(t.targetPosition)?(V=Position._createAt(N),V.offset=0):(t.deletionPosition.isEqual(V)||(N=t.deletionPosition),V=t.targetPosition),new Range(V,N)):new Range(V,N)}_getTransformedByInsertion(t,V,N=!1){if(N&&this.containsPosition(t))return[new Range(this.start,t),new Range(t.getShiftedBy(V),this.end._getTransformedByInsertion(t,V))];{const W=new Range(this.start,this.end);return W.start=W.start._getTransformedByInsertion(t,V),W.end=W.end._getTransformedByInsertion(t,V),[W]}}_getTransformedByMove(t,V,N,W=!1){if(this.isCollapsed){const te=this.start._getTransformedByMove(t,V,N);return[new Range(te)]}const K=Range._createFromPositionAndShift(t,N),G=V._getTransformedByDeletion(t,N);if(this.containsPosition(V)&&!W&&(K.containsPosition(this.start)||K.containsPosition(this.end))){const te=this.start._getTransformedByMove(t,V,N),ie=this.end._getTransformedByMove(t,V,N);return[new Range(te,ie)]}let Z;const Y=this.getDifference(K);let X=null;const Q=this.getIntersection(K);if(Y.length==1?X=new Range(Y[0].start._getTransformedByDeletion(t,N),Y[0].end._getTransformedByDeletion(t,N)):Y.length==2&&(X=new Range(this.start,this.end._getTransformedByDeletion(t,N))),X?Z=X._getTransformedByInsertion(G,N,Q!==null||W):Z=[],Q){const te=new Range(Q.start._getCombined(K.start,G),Q.end._getCombined(K.start,G));Z.length==2?Z.splice(1,0,te):Z.push(te)}return Z}_getTransformedByDeletion(t,V){let N=this.start._getTransformedByDeletion(t,V),W=this.end._getTransformedByDeletion(t,V);return N==null&&W==null?null:(N==null&&(N=t),W==null&&(W=t),new Range(N,W))}static _createFromPositionAndShift(t,V){const N=t,W=t.getShiftedBy(V);return V>0?new this(N,W):new this(W,N)}static _createIn(t){return new this(Position._createAt(t,0),Position._createAt(t,t.maxOffset))}static _createOn(t){return this._createFromPositionAndShift(Position._createBefore(t),t.offsetSize)}static _createFromRanges(t){if(t.length===0)throw new CKEditorError("range-create-from-ranges-empty-array",null);if(t.length==1)return t[0].clone();const V=t[0];t.sort((K,G)=>K.start.isAfter(G.start)?1:-1);const N=t.indexOf(V),W=new this(V.start,V.end);for(let K=N-1;K>=0&&t[K].end.isEqual(W.start);K--)W.start=Position._createAt(t[K].start);for(let K=N+1;K<t.length&&t[K].start.isEqual(W.end);K++)W.end=Position._createAt(t[K].end);return W}static fromJSON(t,V){return new this(Position.fromJSON(t.start,V),Position.fromJSON(t.end,V))}}Range.prototype.is=function(H){return H==="range"||H==="model:range"};class Mapper extends EmitterMixin(){constructor(){super();ee(this,"_modelToViewMapping",new WeakMap);ee(this,"_viewToModelMapping",new WeakMap);ee(this,"_viewToModelLengthCallbacks",new Map);ee(this,"_markerNameToElements",new Map);ee(this,"_elementToMarkerNames",new Map);ee(this,"_deferredBindingRemovals",new Map);ee(this,"_unboundMarkerNames",new Set);this.on("modelToViewPosition",(t,V)=>{if(V.viewPosition)return;const N=this._modelToViewMapping.get(V.modelPosition.parent);if(!N)throw new CKEditorError("mapping-model-position-view-parent-not-found",this,{modelPosition:V.modelPosition});V.viewPosition=this.findPositionIn(N,V.modelPosition.offset)},{priority:"low"}),this.on("viewToModelPosition",(t,V)=>{if(V.modelPosition)return;const N=this.findMappedViewAncestor(V.viewPosition),W=this._viewToModelMapping.get(N),K=this._toModelOffset(V.viewPosition.parent,V.viewPosition.offset,N);V.modelPosition=Position._createAt(W,K)},{priority:"low"})}bindElements(t,V){this._modelToViewMapping.set(t,V),this._viewToModelMapping.set(V,t)}unbindViewElement(t,V={}){const N=this.toModelElement(t);if(this._elementToMarkerNames.has(t))for(const W of this._elementToMarkerNames.get(t))this._unboundMarkerNames.add(W);V.defer?this._deferredBindingRemovals.set(t,t.root):(this._viewToModelMapping.delete(t),this._modelToViewMapping.get(N)==t&&this._modelToViewMapping.delete(N))}unbindModelElement(t){const V=this.toViewElement(t);this._modelToViewMapping.delete(t),this._viewToModelMapping.get(V)==t&&this._viewToModelMapping.delete(V)}bindElementToMarker(t,V){const N=this._markerNameToElements.get(V)||new Set;N.add(t);const W=this._elementToMarkerNames.get(t)||new Set;W.add(V),this._markerNameToElements.set(V,N),this._elementToMarkerNames.set(t,W)}unbindElementFromMarkerName(t,V){const N=this._markerNameToElements.get(V);N&&(N.delete(t),N.size==0&&this._markerNameToElements.delete(V));const W=this._elementToMarkerNames.get(t);W&&(W.delete(V),W.size==0&&this._elementToMarkerNames.delete(t))}flushUnboundMarkerNames(){const t=Array.from(this._unboundMarkerNames);return this._unboundMarkerNames.clear(),t}flushDeferredBindings(){for(const[t,V]of this._deferredBindingRemovals)t.root==V&&this.unbindViewElement(t);this._deferredBindingRemovals=new Map}clearBindings(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._unboundMarkerNames=new Set,this._deferredBindingRemovals=new Map}toModelElement(t){return this._viewToModelMapping.get(t)}toViewElement(t){return this._modelToViewMapping.get(t)}toModelRange(t){return new Range(this.toModelPosition(t.start),this.toModelPosition(t.end))}toViewRange(t){return new Range$1(this.toViewPosition(t.start),this.toViewPosition(t.end))}toModelPosition(t){const V={viewPosition:t,mapper:this};return this.fire("viewToModelPosition",V),V.modelPosition}toViewPosition(t,V={}){const N={modelPosition:t,mapper:this,isPhantom:V.isPhantom};return this.fire("modelToViewPosition",N),N.viewPosition}markerNameToElements(t){const V=this._markerNameToElements.get(t);if(!V)return null;const N=new Set;for(const W of V)if(W.is("attributeElement"))for(const K of W.getElementsWithSameId())N.add(K);else N.add(W);return N}registerViewToModelLength(t,V){this._viewToModelLengthCallbacks.set(t,V)}findMappedViewAncestor(t){let V=t.parent;for(;!this._viewToModelMapping.has(V);)V=V.parent;return V}_toModelOffset(t,V,N){if(N!=t){const K=this._toModelOffset(t.parent,t.index,N),G=this._toModelOffset(t,V,t);return K+G}if(t.is("$text"))return V;let W=0;for(let K=0;K<V;K++)W+=this.getModelLength(t.getChild(K));return W}getModelLength(t){if(this._viewToModelLengthCallbacks.get(t.name))return this._viewToModelLengthCallbacks.get(t.name)(t);if(this._viewToModelMapping.has(t))return 1;if(t.is("$text"))return t.data.length;if(t.is("uiElement"))return 0;{let V=0;for(const N of t.getChildren())V+=this.getModelLength(N);return V}}findPositionIn(t,V){let N,W=0,K=0,G=0;if(t.is("$text"))return new Position$1(t,V);for(;K<V;)N=t.getChild(G),W=this.getModelLength(N),K+=W,G++;return K==V?this._moveViewPositionToTextNode(new Position$1(t,G)):this.findPositionIn(N,V-(K-W))}_moveViewPositionToTextNode(t){const V=t.nodeBefore,N=t.nodeAfter;return V instanceof Text$1?new Position$1(V,V.data.length):N instanceof Text$1?new Position$1(N,0):t}}class ModelConsumable{constructor(){ee(this,"_consumable",new Map);ee(this,"_textProxyRegistry",new Map)}add(B,t){t=_normalizeConsumableType(t),B instanceof TextProxy&&(B=this._getSymbolForTextProxy(B)),this._consumable.has(B)||this._consumable.set(B,new Map),this._consumable.get(B).set(t,!0)}consume(B,t){return t=_normalizeConsumableType(t),B instanceof TextProxy&&(B=this._getSymbolForTextProxy(B)),this.test(B,t)?(this._consumable.get(B).set(t,!1),!0):!1}test(B,t){t=_normalizeConsumableType(t),B instanceof TextProxy&&(B=this._getSymbolForTextProxy(B));const V=this._consumable.get(B);if(V===void 0)return null;const N=V.get(t);return N===void 0?null:N}revert(B,t){t=_normalizeConsumableType(t),B instanceof TextProxy&&(B=this._getSymbolForTextProxy(B));const V=this.test(B,t);return V===!1?(this._consumable.get(B).set(t,!0),!0):V===!0?!1:null}verifyAllConsumed(B){const t=[];for(const[V,N]of this._consumable)for(const[W,K]of N){const G=W.split(":")[0];K&&B==G&&t.push({event:W,item:V.name||V.description})}if(t.length)throw new CKEditorError("conversion-model-consumable-not-consumed",null,{items:t})}_getSymbolForTextProxy(B){let t=null;const V=this._textProxyRegistry.get(B.startOffset);if(V){const N=V.get(B.endOffset);N&&(t=N.get(B.parent))}return t||(t=this._addSymbolForTextProxy(B)),t}_addSymbolForTextProxy(B){const t=B.startOffset,V=B.endOffset,N=B.parent,W=Symbol("$textProxy:"+B.data);let K,G;return K=this._textProxyRegistry.get(t),K||(K=new Map,this._textProxyRegistry.set(t,K)),G=K.get(V),G||(G=new Map,K.set(V,G)),G.set(N,W),W}}function _normalizeConsumableType(H){const B=H.split(":");return B[0]=="insert"?B[0]:B[0]=="addMarker"||B[0]=="removeMarker"?H:B.length>1?B[0]+":"+B[1]:B[0]}class DowncastDispatcher extends EmitterMixin(){constructor(t){super();ee(this,"_conversionApi");ee(this,"_firedEventsMap");this._conversionApi={dispatcher:this,...t},this._firedEventsMap=new WeakMap}convertChanges(t,V,N){const W=this._createConversionApi(N,t.getRefreshedItems());for(const G of t.getMarkersToRemove())this._convertMarkerRemove(G.name,G.range,W);const K=this._reduceChanges(t.getChanges());for(const G of K)G.type==="insert"?this._convertInsert(Range._createFromPositionAndShift(G.position,G.length),W):G.type==="reinsert"?this._convertReinsert(Range._createFromPositionAndShift(G.position,G.length),W):G.type==="remove"?this._convertRemove(G.position,G.length,G.name,W):this._convertAttribute(G.range,G.attributeKey,G.attributeOldValue,G.attributeNewValue,W);W.mapper.flushDeferredBindings();for(const G of W.mapper.flushUnboundMarkerNames()){const Z=V.get(G).getRange();this._convertMarkerRemove(G,Z,W),this._convertMarkerAdd(G,Z,W)}for(const G of t.getMarkersToAdd())this._convertMarkerAdd(G.name,G.range,W);W.consumable.verifyAllConsumed("insert")}convert(t,V,N,W={}){const K=this._createConversionApi(N,void 0,W);this._convertInsert(t,K);for(const[G,Z]of V)this._convertMarkerAdd(G,Z,K);K.consumable.verifyAllConsumed("insert")}convertSelection(t,V,N){const W=this._createConversionApi(N);this.fire("cleanSelection",{selection:t},W);const K=t.getFirstPosition().root;if(!W.mapper.toViewElement(K))return;const G=Array.from(V.getMarkersAtPosition(t.getFirstPosition()));if(this._addConsumablesForSelection(W.consumable,t,G),this.fire("selection",{selection:t},W),!!t.isCollapsed){for(const Z of G)if(W.consumable.test(t,"addMarker:"+Z.name)){const Y=Z.getRange();if(!shouldMarkerChangeBeConverted(t.getFirstPosition(),Z,W.mapper))continue;const X={item:t,markerName:Z.name,markerRange:Y};this.fire(`addMarker:${Z.name}`,X,W)}for(const Z of t.getAttributeKeys())if(W.consumable.test(t,"attribute:"+Z)){const Y={item:t,range:t.getFirstRange(),attributeKey:Z,attributeOldValue:null,attributeNewValue:t.getAttribute(Z)};this.fire(`attribute:${Z}:$text`,Y,W)}}}_convertInsert(t,V,N={}){N.doNotAddConsumables||this._addConsumablesForInsert(V.consumable,t);for(const W of Array.from(t.getWalker({shallow:!0})).map(walkerValueToEventData))this._testAndFire("insert",W,V)}_convertRemove(t,V,N,W){this.fire(`remove:${N}`,{position:t,length:V},W)}_convertAttribute(t,V,N,W,K){this._addConsumablesForRange(K.consumable,t,`attribute:${V}`);for(const G of t){const Z={item:G.item,range:Range._createFromPositionAndShift(G.previousPosition,G.length),attributeKey:V,attributeOldValue:N,attributeNewValue:W};this._testAndFire(`attribute:${V}`,Z,K)}}_convertReinsert(t,V){const N=Array.from(t.getWalker({shallow:!0}));this._addConsumablesForInsert(V.consumable,N);for(const W of N.map(walkerValueToEventData))this._testAndFire("insert",{...W,reconversion:!0},V)}_convertMarkerAdd(t,V,N){if(V.root.rootName=="$graveyard")return;const W=`addMarker:${t}`;if(N.consumable.add(V,W),this.fire(W,{markerName:t,markerRange:V},N),!!N.consumable.consume(V,W)){this._addConsumablesForRange(N.consumable,V,W);for(const K of V.getItems()){if(!N.consumable.test(K,W))continue;const G={item:K,range:Range._createOn(K),markerName:t,markerRange:V};this.fire(W,G,N)}}}_convertMarkerRemove(t,V,N){V.root.rootName!="$graveyard"&&this.fire(`removeMarker:${t}`,{markerName:t,markerRange:V},N)}_reduceChanges(t){const V={changes:t};return this.fire("reduceChanges",V),V.changes}_addConsumablesForInsert(t,V){for(const N of V){const W=N.item;if(t.test(W,"insert")===null){t.add(W,"insert");for(const K of W.getAttributeKeys())t.add(W,"attribute:"+K)}}return t}_addConsumablesForRange(t,V,N){for(const W of V.getItems())t.add(W,N);return t}_addConsumablesForSelection(t,V,N){t.add(V,"selection");for(const W of N)t.add(V,"addMarker:"+W.name);for(const W of V.getAttributeKeys())t.add(V,"attribute:"+W);return t}_testAndFire(t,V,N){const W=getEventName(t,V),K=V.item.is("$textProxy")?N.consumable._getSymbolForTextProxy(V.item):V.item,G=this._firedEventsMap.get(N),Z=G.get(K);if(!Z)G.set(K,new Set([W]));else if(!Z.has(W))Z.add(W);else return;this.fire(W,V,N)}_testAndFireAddAttributes(t,V){const N={item:t,range:Range._createOn(t)};for(const W of N.item.getAttributeKeys())N.attributeKey=W,N.attributeOldValue=null,N.attributeNewValue=N.item.getAttribute(W),this._testAndFire(`attribute:${W}`,N,V)}_createConversionApi(t,V=new Set,N={}){const W={...this._conversionApi,consumable:new ModelConsumable,writer:t,options:N,convertItem:K=>this._convertInsert(Range._createOn(K),W),convertChildren:K=>this._convertInsert(Range._createIn(K),W,{doNotAddConsumables:!0}),convertAttributes:K=>this._testAndFireAddAttributes(K,W),canReuseView:K=>!V.has(W.mapper.toModelElement(K))};return this._firedEventsMap.set(W,new Map),W}}function shouldMarkerChangeBeConverted(H,B,t){const V=B.getRange(),N=Array.from(H.getAncestors());return N.shift(),N.reverse(),!N.some(K=>{if(V.containsItem(K))return!!t.toViewElement(K).getCustomProperty("addHighlight")})}function getEventName(H,B){const t=B.item.is("element")?B.item.name:"$text";return`${H}:${t}`}function walkerValueToEventData(H){const B=H.item,t=Range._createFromPositionAndShift(H.previousPosition,H.length);return{item:B,range:t}}class Selection extends EmitterMixin(TypeCheckable){constructor(...t){super();ee(this,"_lastRangeBackward",!1);ee(this,"_attrs",new Map);ee(this,"_ranges",[]);t.length&&this.setTo(...t)}get anchor(){if(this._ranges.length>0){const t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.end:t.start}return null}get focus(){if(this._ranges.length>0){const t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.start:t.end}return null}get isCollapsed(){return this._ranges.length===1?this._ranges[0].isCollapsed:!1}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}isEqual(t){if(this.rangeCount!=t.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;for(const V of this._ranges){let N=!1;for(const W of t._ranges)if(V.isEqual(W)){N=!0;break}if(!N)return!1}return!0}*getRanges(){for(const t of this._ranges)yield new Range(t.start,t.end)}getFirstRange(){let t=null;for(const V of this._ranges)(!t||V.start.isBefore(t.start))&&(t=V);return t?new Range(t.start,t.end):null}getLastRange(){let t=null;for(const V of this._ranges)(!t||V.end.isAfter(t.end))&&(t=V);return t?new Range(t.start,t.end):null}getFirstPosition(){const t=this.getFirstRange();return t?t.start.clone():null}getLastPosition(){const t=this.getLastRange();return t?t.end.clone():null}setTo(...t){let[V,N,W]=t;if(typeof N=="object"&&(W=N,N=void 0),V===null)this._setRanges([]);else if(V instanceof Selection)this._setRanges(V.getRanges(),V.isBackward);else if(V&&typeof V.getRanges=="function")this._setRanges(V.getRanges(),V.isBackward);else if(V instanceof Range)this._setRanges([V],!!W&&!!W.backward);else if(V instanceof Position)this._setRanges([new Range(V)]);else if(V instanceof Node$1){const K=!!W&&!!W.backward;let G;if(N=="in")G=Range._createIn(V);else if(N=="on")G=Range._createOn(V);else if(N!==void 0)G=new Range(Position._createAt(V,N));else throw new CKEditorError("model-selection-setto-required-second-parameter",[this,V]);this._setRanges([G],K)}else if(isIterable(V))this._setRanges(V,W&&!!W.backward);else throw new CKEditorError("model-selection-setto-not-selectable",[this,V])}_setRanges(t,V=!1){const N=Array.from(t),W=N.some(K=>{if(!(K instanceof Range))throw new CKEditorError("model-selection-set-ranges-not-range",[this,t]);return this._ranges.every(G=>!G.isEqual(K))});N.length===this._ranges.length&&!W||(this._replaceAllRanges(N),this._lastRangeBackward=!!V,this.fire("change:range",{directChange:!0}))}setFocus(t,V){if(this.anchor===null)throw new CKEditorError("model-selection-setfocus-no-ranges",[this,t]);const N=Position._createAt(t,V);if(N.compareWith(this.focus)=="same")return;const W=this.anchor;this._ranges.length&&this._popRange(),N.compareWith(W)=="before"?(this._pushRange(new Range(N,W)),this._lastRangeBackward=!0):(this._pushRange(new Range(W,N)),this._lastRangeBackward=!1),this.fire("change:range",{directChange:!0})}getAttribute(t){return this._attrs.get(t)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}hasAttribute(t){return this._attrs.has(t)}removeAttribute(t){this.hasAttribute(t)&&(this._attrs.delete(t),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}setAttribute(t,V){this.getAttribute(t)!==V&&(this._attrs.set(t,V),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}*getSelectedBlocks(){const t=new WeakSet;for(const V of this.getRanges()){const N=getParentBlock$1(V.start,t);isStartBlockSelected(N,V)&&(yield N);for(const K of V.getWalker()){const G=K.item;K.type=="elementEnd"&&isUnvisitedTopBlock(G,t,V)&&(yield G)}const W=getParentBlock$1(V.end,t);isEndBlockSelected(W,V)&&(yield W)}}containsEntireContent(t=this.anchor.root){const V=Position._createAt(t,0),N=Position._createAt(t,"end");return V.isTouching(this.getFirstPosition())&&N.isTouching(this.getLastPosition())}_pushRange(t){this._checkRange(t),this._ranges.push(new Range(t.start,t.end))}_checkRange(t){for(let V=0;V<this._ranges.length;V++)if(t.isIntersecting(this._ranges[V]))throw new CKEditorError("model-selection-range-intersects",[this,t],{addedRange:t,intersectingRange:this._ranges[V]})}_replaceAllRanges(t){this._removeAllRanges();for(const V of t)this._pushRange(V)}_removeAllRanges(){for(;this._ranges.length>0;)this._popRange()}_popRange(){this._ranges.pop()}}Selection.prototype.is=function(H){return H==="selection"||H==="model:selection"};function isUnvisitedBlock(H,B){return B.has(H)?!1:(B.add(H),H.root.document.model.schema.isBlock(H)&&!!H.parent)}function isUnvisitedTopBlock(H,B,t){return isUnvisitedBlock(H,B)&&isTopBlockInRange(H,t)}function getParentBlock$1(H,B){const V=H.parent.root.document.model.schema,N=H.parent.getAncestors({parentFirst:!0,includeSelf:!0});let W=!1;const K=N.find(G=>W?!1:(W=V.isLimit(G),!W&&isUnvisitedBlock(G,B)));return N.forEach(G=>B.add(G)),K}function isTopBlockInRange(H,B){const t=findAncestorBlock(H);return t?!B.containsRange(Range._createOn(t),!0):!0}function isStartBlockSelected(H,B){return H?B.isCollapsed||H.isEmpty?!0:B.start.isTouching(Position._createAt(H,H.maxOffset))?!1:isTopBlockInRange(H,B):!1}function isEndBlockSelected(H,B){return H?B.isCollapsed||H.isEmpty?!0:B.end.isTouching(Position._createAt(H,0))?!1:isTopBlockInRange(H,B):!1}function findAncestorBlock(H){const B=H.root.document.model.schema;let t=H.parent;for(;t;){if(B.isBlock(t))return t;t=t.parent}}class LiveRange extends EmitterMixin(Range){constructor(B,t){super(B,t),bindWithDocument$1.call(this)}detach(){this.stopListening()}toRange(){return new Range(this.start,this.end)}static fromRange(B){return new LiveRange(B.start,B.end)}}LiveRange.prototype.is=function(H){return H==="liveRange"||H==="model:liveRange"||H=="range"||H==="model:range"};function bindWithDocument$1(){this.listenTo(this.root.document.model,"applyOperation",(H,B)=>{const t=B[0];t.isDocumentOperation&&transform$2.call(this,t)},{priority:"low"})}function transform$2(H){const B=this.getTransformedByOperation(H),t=Range._createFromRanges(B),V=!t.isEqual(this),N=doesOperationChangeRangeContent(this,H);let W=null;if(V){t.root.rootName=="$graveyard"&&(H.type=="remove"?W=H.sourcePosition:W=H.deletionPosition);const K=this.toRange();this.start=t.start,this.end=t.end,this.fire("change:range",K,{deletionPosition:W})}else N&&this.fire("change:content",this.toRange(),{deletionPosition:W})}function doesOperationChangeRangeContent(H,B){switch(B.type){case"insert":return H.containsPosition(B.position);case"move":case"remove":case"reinsert":case"merge":return H.containsPosition(B.sourcePosition)||H.start.isEqual(B.sourcePosition)||H.containsPosition(B.targetPosition);case"split":return H.containsPosition(B.splitPosition)||H.containsPosition(B.insertionPosition)}return!1}const storePrefix="selection:";class DocumentSelection extends EmitterMixin(TypeCheckable){constructor(t){super();ee(this,"_selection");this._selection=new LiveSelection(t),this._selection.delegate("change:range").to(this),this._selection.delegate("change:attribute").to(this),this._selection.delegate("change:marker").to(this)}get isCollapsed(){return this._selection.isCollapsed}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get rangeCount(){return this._selection.rangeCount}get hasOwnRange(){return this._selection.hasOwnRange}get isBackward(){return this._selection.isBackward}get isGravityOverridden(){return this._selection.isGravityOverridden}get markers(){return this._selection.markers}get _ranges(){return this._selection._ranges}getRanges(){return this._selection.getRanges()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getSelectedBlocks(){return this._selection.getSelectedBlocks()}getSelectedElement(){return this._selection.getSelectedElement()}containsEntireContent(t){return this._selection.containsEntireContent(t)}destroy(){this._selection.destroy()}getAttributeKeys(){return this._selection.getAttributeKeys()}getAttributes(){return this._selection.getAttributes()}getAttribute(t){return this._selection.getAttribute(t)}hasAttribute(t){return this._selection.hasAttribute(t)}refresh(){this._selection.updateMarkers(),this._selection._updateAttributes(!1)}observeMarkers(t){this._selection.observeMarkers(t)}_setFocus(t,V){this._selection.setFocus(t,V)}_setTo(...t){this._selection.setTo(...t)}_setAttribute(t,V){this._selection.setAttribute(t,V)}_removeAttribute(t){this._selection.removeAttribute(t)}_getStoredAttributes(){return this._selection.getStoredAttributes()}_overrideGravity(){return this._selection.overrideGravity()}_restoreGravity(t){this._selection.restoreGravity(t)}static _getStoreAttributeKey(t){return storePrefix+t}static _isStoreAttributeKey(t){return t.startsWith(storePrefix)}}DocumentSelection.prototype.is=function(H){return H==="selection"||H=="model:selection"||H=="documentSelection"||H=="model:documentSelection"};class LiveSelection extends Selection{constructor(t){super();ee(this,"markers",new Collection({idProperty:"name"}));ee(this,"_model");ee(this,"_document");ee(this,"_attributePriority",new Map);ee(this,"_selectionRestorePosition",null);ee(this,"_hasChangedRange",!1);ee(this,"_overriddenGravityRegister",new Set);ee(this,"_observedMarkers",new Set);this._model=t.model,this._document=t,this.listenTo(this._model,"applyOperation",(V,N)=>{const W=N[0];!W.isDocumentOperation||W.type=="marker"||W.type=="rename"||W.type=="noop"||(this._ranges.length==0&&this._selectionRestorePosition&&this._fixGraveyardSelection(this._selectionRestorePosition),this._selectionRestorePosition=null,this._hasChangedRange&&(this._hasChangedRange=!1,this.fire("change:range",{directChange:!1})))},{priority:"lowest"}),this.on("change:range",()=>{this._validateSelectionRanges(this.getRanges())}),this.listenTo(this._model.markers,"update",(V,N,W,K)=>{this._updateMarker(N,K)}),this.listenTo(this._document,"change",(V,N)=>{clearAttributesStoredInElement(this._model,N)})}get isCollapsed(){return this._ranges.length===0?this._document._getDefaultRange().isCollapsed:super.isCollapsed}get anchor(){return super.anchor||this._document._getDefaultRange().start}get focus(){return super.focus||this._document._getDefaultRange().end}get rangeCount(){return this._ranges.length?this._ranges.length:1}get hasOwnRange(){return this._ranges.length>0}get isGravityOverridden(){return!!this._overriddenGravityRegister.size}destroy(){for(let t=0;t<this._ranges.length;t++)this._ranges[t].detach();this.stopListening()}*getRanges(){this._ranges.length?yield*super.getRanges():yield this._document._getDefaultRange()}getFirstRange(){return super.getFirstRange()||this._document._getDefaultRange()}getLastRange(){return super.getLastRange()||this._document._getDefaultRange()}setTo(...t){super.setTo(...t),this._updateAttributes(!0),this.updateMarkers()}setFocus(t,V){super.setFocus(t,V),this._updateAttributes(!0),this.updateMarkers()}setAttribute(t,V){if(this._setAttribute(t,V)){const N=[t];this.fire("change:attribute",{attributeKeys:N,directChange:!0})}}removeAttribute(t){if(this._removeAttribute(t)){const V=[t];this.fire("change:attribute",{attributeKeys:V,directChange:!0})}}overrideGravity(){const t=uid();return this._overriddenGravityRegister.add(t),this._overriddenGravityRegister.size===1&&this._updateAttributes(!0),t}restoreGravity(t){if(!this._overriddenGravityRegister.has(t))throw new CKEditorError("document-selection-gravity-wrong-restore",this,{uid:t});this._overriddenGravityRegister.delete(t),this.isGravityOverridden||this._updateAttributes(!0)}observeMarkers(t){this._observedMarkers.add(t),this.updateMarkers()}_replaceAllRanges(t){this._validateSelectionRanges(t),super._replaceAllRanges(t)}_popRange(){this._ranges.pop().detach()}_pushRange(t){const V=this._prepareRange(t);V&&this._ranges.push(V)}_validateSelectionRanges(t){for(const V of t)if(!this._document._validateSelectionRange(V))throw new CKEditorError("document-selection-wrong-position",this,{range:V})}_prepareRange(t){if(this._checkRange(t),t.root==this._document.graveyard)return;const V=LiveRange.fromRange(t);return V.on("change:range",(N,W,K)=>{if(this._hasChangedRange=!0,V.root==this._document.graveyard){this._selectionRestorePosition=K.deletionPosition;const G=this._ranges.indexOf(V);this._ranges.splice(G,1),V.detach()}}),V}updateMarkers(){if(!this._observedMarkers.size)return;const t=[];let V=!1;for(const W of this._model.markers){const K=W.name.split(":",1)[0];if(!this._observedMarkers.has(K))continue;const G=W.getRange();for(const Z of this.getRanges())G.containsRange(Z,!Z.isCollapsed)&&t.push(W)}const N=Array.from(this.markers);for(const W of t)this.markers.has(W)||(this.markers.add(W),V=!0);for(const W of Array.from(this.markers))t.includes(W)||(this.markers.remove(W),V=!0);V&&this.fire("change:marker",{oldMarkers:N,directChange:!1})}_updateMarker(t,V){const N=t.name.split(":",1)[0];if(!this._observedMarkers.has(N))return;let W=!1;const K=Array.from(this.markers),G=this.markers.has(t);if(!V)G&&(this.markers.remove(t),W=!0);else{let Z=!1;for(const Y of this.getRanges())if(V.containsRange(Y,!Y.isCollapsed)){Z=!0;break}Z&&!G?(this.markers.add(t),W=!0):!Z&&G&&(this.markers.remove(t),W=!0)}W&&this.fire("change:marker",{oldMarkers:K,directChange:!1})}_updateAttributes(t){const V=toMap(this._getSurroundingAttributes()),N=toMap(this.getAttributes());if(t)this._attributePriority=new Map,this._attrs=new Map;else for(const[K,G]of this._attributePriority)G=="low"&&(this._attrs.delete(K),this._attributePriority.delete(K));this._setAttributesTo(V);const W=[];for(const[K,G]of this.getAttributes())(!N.has(K)||N.get(K)!==G)&&W.push(K);for(const[K]of N)this.hasAttribute(K)||W.push(K);W.length>0&&this.fire("change:attribute",{attributeKeys:W,directChange:!1})}_setAttribute(t,V,N=!0){const W=N?"normal":"low";return W=="low"&&this._attributePriority.get(t)=="normal"||super.getAttribute(t)===V?!1:(this._attrs.set(t,V),this._attributePriority.set(t,W),!0)}_removeAttribute(t,V=!0){const N=V?"normal":"low";return N=="low"&&this._attributePriority.get(t)=="normal"||(this._attributePriority.set(t,N),!super.hasAttribute(t))?!1:(this._attrs.delete(t),!0)}_setAttributesTo(t){const V=new Set;for(const[N,W]of this.getAttributes())t.get(N)!==W&&this._removeAttribute(N,!1);for(const[N,W]of t)this._setAttribute(N,W,!1)&&V.add(N);return V}*getStoredAttributes(){const t=this.getFirstPosition().parent;if(this.isCollapsed&&t.isEmpty)for(const V of t.getAttributeKeys())V.startsWith(storePrefix)&&(yield[V.substr(storePrefix.length),t.getAttribute(V)])}_getSurroundingAttributes(){const t=this.getFirstPosition(),V=this._model.schema;if(t.root.rootName=="$graveyard")return null;let N=null;if(this.isCollapsed){const W=t.textNode?t.textNode:t.nodeBefore,K=t.textNode?t.textNode:t.nodeAfter;if(this.isGravityOverridden||(N=getTextAttributes(W,V)),N||(N=getTextAttributes(K,V)),!this.isGravityOverridden&&!N){let G=W;for(;G&&!N;)G=G.previousSibling,N=getTextAttributes(G,V)}if(!N){let G=K;for(;G&&!N;)G=G.nextSibling,N=getTextAttributes(G,V)}N||(N=this.getStoredAttributes())}else{const W=this.getFirstRange();for(const K of W){if(K.item.is("element")&&V.isObject(K.item)){N=getTextAttributes(K.item,V);break}if(K.type=="text"){N=K.item.getAttributes();break}}}return N}_fixGraveyardSelection(t){const V=this._model.schema.getNearestSelectionRange(t);V&&this._pushRange(V)}}function getTextAttributes(H,B){if(!H)return null;if(H instanceof TextProxy||H instanceof Text)return H.getAttributes();if(!B.isInline(H))return null;if(!B.isObject(H))return[];const t=[];for(const[V,N]of H.getAttributes())B.checkAttribute("$text",V)&&B.getAttributeProperties(V).copyFromObject!==!1&&t.push([V,N]);return t}function clearAttributesStoredInElement(H,B){const t=H.document.differ;for(const V of t.getChanges()){if(V.type!="insert")continue;const N=V.position.parent;V.length===N.maxOffset&&H.enqueueChange(B,K=>{const G=Array.from(N.getAttributeKeys()).filter(Z=>Z.startsWith(storePrefix));for(const Z of G)K.removeAttribute(Z,N)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ConversionHelpers{constructor(B){ee(this,"_dispatchers");this._dispatchers=B}add(B){for(const t of this._dispatchers)B(t);return this}}class DowncastHelpers extends ConversionHelpers{elementToElement(B){return this.add(downcastElementToElement(B))}elementToStructure(B){return this.add(downcastElementToStructure(B))}attributeToElement(B){return this.add(downcastAttributeToElement(B))}attributeToAttribute(B){return this.add(downcastAttributeToAttribute(B))}markerToElement(B){return this.add(downcastMarkerToElement(B))}markerToHighlight(B){return this.add(downcastMarkerToHighlight(B))}markerToData(B){return this.add(downcastMarkerToData(B))}}function insertText(){return(H,B,t)=>{if(!t.consumable.consume(B.item,H.name))return;const V=t.writer,N=t.mapper.toViewPosition(B.range.start),W=V.createText(B.item.data);V.insert(N,W)}}function insertAttributesAndChildren(){return(H,B,t)=>{t.convertAttributes(B.item),!B.reconversion&&B.item.is("element")&&!B.item.isEmpty&&t.convertChildren(B.item)}}function remove(){return(H,B,t)=>{const V=t.mapper.toViewPosition(B.position),N=B.position.getShiftedBy(B.length),W=t.mapper.toViewPosition(N,{isPhantom:!0}),K=t.writer.createRange(V,W),G=t.writer.remove(K.getTrimmed());for(const Z of t.writer.createRangeIn(G).getItems())t.mapper.unbindViewElement(Z,{defer:!0})}}function createViewElementFromHighlightDescriptor(H,B){const t=H.createAttributeElement("span",B.attributes);return B.classes&&t._addClass(B.classes),typeof B.priority=="number"&&(t._priority=B.priority),t._id=B.id,t}function convertRangeSelection(){return(H,B,t)=>{const V=B.selection;if(V.isCollapsed||!t.consumable.consume(V,"selection"))return;const N=[];for(const W of V.getRanges())N.push(t.mapper.toViewRange(W));t.writer.setSelection(N,{backward:V.isBackward})}}function convertCollapsedSelection(){return(H,B,t)=>{const V=B.selection;if(!V.isCollapsed||!t.consumable.consume(V,"selection"))return;const N=t.writer,W=V.getFirstPosition(),K=t.mapper.toViewPosition(W),G=N.breakAttributes(K);N.setSelection(G)}}function cleanSelection(){return(H,B,t)=>{const V=t.writer,N=V.document.selection;for(const W of N.getRanges())W.isCollapsed&&W.end.parent.isAttached()&&t.writer.mergeAttributes(W.start);V.setSelection(null)}}function wrap(H){return(B,t,V)=>{if(!V.consumable.test(t.item,B.name))return;const N=H(t.attributeOldValue,V,t),W=H(t.attributeNewValue,V,t);if(!N&&!W)return;V.consumable.consume(t.item,B.name);const K=V.writer,G=K.document.selection;if(t.item instanceof Selection||t.item instanceof DocumentSelection)K.wrap(G.getFirstRange(),W);else{let Z=V.mapper.toViewRange(t.range);t.attributeOldValue!==null&&N&&(Z=K.unwrap(Z,N)),t.attributeNewValue!==null&&W&&K.wrap(Z,W)}}}function insertElement(H,B=defaultConsumer){return(t,V,N)=>{if(!B(V.item,N.consumable,{preflight:!0}))return;const W=H(V.item,N,V);if(!W)return;B(V.item,N.consumable);const K=N.mapper.toViewPosition(V.range.start);N.mapper.bindElements(V.item,W),N.writer.insert(K,W),N.convertAttributes(V.item),reinsertOrConvertNodes(W,V.item.getChildren(),N,{reconversion:V.reconversion})}}function insertStructure(H,B){return(t,V,N)=>{if(!B(V.item,N.consumable,{preflight:!0}))return;const W=new Map;N.writer._registerSlotFactory(createSlotFactory(V.item,W,N));const K=H(V.item,N,V);if(N.writer._clearSlotFactory(),!K)return;validateSlotsChildren(V.item,W,N),B(V.item,N.consumable);const G=N.mapper.toViewPosition(V.range.start);N.mapper.bindElements(V.item,K),N.writer.insert(G,K),N.convertAttributes(V.item),fillSlots(K,W,N,{reconversion:V.reconversion})}}function insertUIElement(H){return(B,t,V)=>{t.isOpening=!0;const N=H(t,V);t.isOpening=!1;const W=H(t,V);if(!N||!W)return;const K=t.markerRange;if(K.isCollapsed&&!V.consumable.consume(K,B.name))return;for(const Y of K)if(!V.consumable.consume(Y.item,B.name))return;const G=V.mapper,Z=V.writer;Z.insert(G.toViewPosition(K.start),N),V.mapper.bindElementToMarker(N,t.markerName),K.isCollapsed||(Z.insert(G.toViewPosition(K.end),W),V.mapper.bindElementToMarker(W,t.markerName)),B.stop()}}function removeUIElement(){return(H,B,t)=>{const V=t.mapper.markerNameToElements(B.markerName);if(V){for(const N of V)t.mapper.unbindElementFromMarkerName(N,B.markerName),t.writer.clear(t.writer.createRangeOn(N),N);t.writer.clearClonedElementsGroup(B.markerName),H.stop()}}}function insertMarkerData(H){return(B,t,V)=>{const N=H(t.markerName,V);if(!N)return;const W=t.markerRange;V.consumable.consume(W,B.name)&&(handleMarkerBoundary(W,!1,V,t,N),handleMarkerBoundary(W,!0,V,t,N),B.stop())}}function handleMarkerBoundary(H,B,t,V,N){const W=B?H.start:H.end,K=W.nodeAfter&&W.nodeAfter.is("element")?W.nodeAfter:null,G=W.nodeBefore&&W.nodeBefore.is("element")?W.nodeBefore:null;if(K||G){let Y,X;B&&K||!B&&!G?(Y=K,X=!0):(Y=G,X=!1);const Q=t.mapper.toViewElement(Y);if(Q){insertMarkerAsAttribute(Q,B,X,t,V,N);return}}const Z=t.mapper.toViewPosition(W);insertMarkerAsElement(Z,B,t,V,N)}function insertMarkerAsAttribute(H,B,t,V,N,W){const K=`data-${W.group}-${B?"start":"end"}-${t?"before":"after"}`,G=H.hasAttribute(K)?H.getAttribute(K).split(","):[];G.unshift(W.name),V.writer.setAttribute(K,G.join(","),H),V.mapper.bindElementToMarker(H,N.markerName)}function insertMarkerAsElement(H,B,t,V,N){const W=`${N.group}-${B?"start":"end"}`,K=N.name?{name:N.name}:null,G=t.writer.createUIElement(W,K);t.writer.insert(H,G),t.mapper.bindElementToMarker(G,V.markerName)}function removeMarkerData(H){return(B,t,V)=>{const N=H(t.markerName,V);if(!N)return;const W=V.mapper.markerNameToElements(t.markerName);if(!W)return;for(const G of W)V.mapper.unbindElementFromMarkerName(G,t.markerName),G.is("containerElement")?(K(`data-${N.group}-start-before`,G),K(`data-${N.group}-start-after`,G),K(`data-${N.group}-end-before`,G),K(`data-${N.group}-end-after`,G)):V.writer.clear(V.writer.createRangeOn(G),G);V.writer.clearClonedElementsGroup(t.markerName),B.stop();function K(G,Z){if(Z.hasAttribute(G)){const Y=new Set(Z.getAttribute(G).split(","));Y.delete(N.name),Y.size==0?V.writer.removeAttribute(G,Z):V.writer.setAttribute(G,Array.from(Y).join(","),Z)}}}}function changeAttribute(H){return(B,t,V)=>{if(!V.consumable.test(t.item,B.name))return;const N=H(t.attributeOldValue,V,t),W=H(t.attributeNewValue,V,t);if(!N&&!W)return;V.consumable.consume(t.item,B.name);const K=V.mapper.toViewElement(t.item),G=V.writer;if(!K)throw new CKEditorError("conversion-attribute-to-attribute-on-text",V.dispatcher,t);if(t.attributeOldValue!==null&&N)if(N.key=="class"){const Z=typeof N.value=="string"?N.value.split(/\s+/):N.value;for(const Y of Z)G.removeClass(Y,K)}else if(N.key=="style")if(typeof N.value=="string"){const Z=new StylesMap(G.document.stylesProcessor);Z.setTo(N.value);for(const[Y]of Z.getStylesEntries())G.removeStyle(Y,K)}else{const Z=Object.keys(N.value);for(const Y of Z)G.removeStyle(Y,K)}else G.removeAttribute(N.key,K);if(t.attributeNewValue!==null&&W)if(W.key=="class"){const Z=typeof W.value=="string"?W.value.split(/\s+/):W.value;for(const Y of Z)G.addClass(Y,K)}else if(W.key=="style")if(typeof W.value=="string"){const Z=new StylesMap(G.document.stylesProcessor);Z.setTo(W.value);for(const[Y,X]of Z.getStylesEntries())G.setStyle(Y,X,K)}else{const Z=Object.keys(W.value);for(const Y of Z)G.setStyle(Y,W.value[Y],K)}else G.setAttribute(W.key,W.value,K)}}function highlightText(H){return(B,t,V)=>{if(!t.item||!(t.item instanceof Selection||t.item instanceof DocumentSelection)&&!t.item.is("$textProxy"))return;const N=prepareDescriptor(H,t,V);if(!N||!V.consumable.consume(t.item,B.name))return;const W=V.writer,K=createViewElementFromHighlightDescriptor(W,N),G=W.document.selection;if(t.item instanceof Selection||t.item instanceof DocumentSelection)W.wrap(G.getFirstRange(),K);else{const Z=V.mapper.toViewRange(t.range),Y=W.wrap(Z,K);for(const X of Y.getItems())if(X.is("attributeElement")&&X.isSimilar(K)){V.mapper.bindElementToMarker(X,t.markerName);break}}}}function highlightElement(H){return(B,t,V)=>{if(!t.item||!(t.item instanceof Element))return;const N=prepareDescriptor(H,t,V);if(!N||!V.consumable.test(t.item,B.name))return;const W=V.mapper.toViewElement(t.item);if(W&&W.getCustomProperty("addHighlight")){V.consumable.consume(t.item,B.name);for(const G of Range._createIn(t.item))V.consumable.consume(G.item,B.name);W.getCustomProperty("addHighlight")(W,N,V.writer),V.mapper.bindElementToMarker(W,t.markerName)}}}function removeHighlight$1(H){return(B,t,V)=>{if(t.markerRange.isCollapsed)return;const N=prepareDescriptor(H,t,V);if(!N)return;const W=createViewElementFromHighlightDescriptor(V.writer,N),K=V.mapper.markerNameToElements(t.markerName);if(K){for(const G of K)V.mapper.unbindElementFromMarkerName(G,t.markerName),G.is("attributeElement")?V.writer.unwrap(V.writer.createRangeOn(G),W):G.getCustomProperty("removeHighlight")(G,N.id,V.writer);V.writer.clearClonedElementsGroup(t.markerName),B.stop()}}}function downcastElementToElement(H){const B=normalizeModelElementConfig(H.model),t=normalizeToElementConfig(H.view,"container");return B.attributes.length&&(B.children=!0),V=>{V.on(`insert:${B.name}`,insertElement(t,createConsumer(B)),{priority:H.converterPriority||"normal"}),(B.children||B.attributes.length)&&V.on("reduceChanges",createChangeReducer(B),{priority:"low"})}}function downcastElementToStructure(H){const B=normalizeModelElementConfig(H.model),t=normalizeToElementConfig(H.view,"container");return B.children=!0,V=>{if(V._conversionApi.schema.checkChild(B.name,"$text"))throw new CKEditorError("conversion-element-to-structure-disallowed-text",V,{elementName:B.name});V.on(`insert:${B.name}`,insertStructure(t,createConsumer(B)),{priority:H.converterPriority||"normal"}),V.on("reduceChanges",createChangeReducer(B),{priority:"low"})}}function downcastAttributeToElement(H){H=cloneDeep(H);let B=H.model;typeof B=="string"&&(B={key:B});let t=`attribute:${B.key}`;if(B.name&&(t+=":"+B.name),B.values)for(const N of B.values)H.view[N]=normalizeToElementConfig(H.view[N],"attribute");else H.view=normalizeToElementConfig(H.view,"attribute");const V=getFromAttributeCreator(H);return N=>{N.on(t,wrap(V),{priority:H.converterPriority||"normal"})}}function downcastAttributeToAttribute(H){H=cloneDeep(H);let B=H.model;typeof B=="string"&&(B={key:B});let t=`attribute:${B.key}`;if(B.name&&(t+=":"+B.name),B.values)for(const N of B.values)H.view[N]=normalizeToAttributeConfig(H.view[N]);else H.view=normalizeToAttributeConfig(H.view);const V=getFromAttributeCreator(H);return N=>{N.on(t,changeAttribute(V),{priority:H.converterPriority||"normal"})}}function downcastMarkerToElement(H){const B=normalizeToElementConfig(H.view,"ui");return t=>{t.on(`addMarker:${H.model}`,insertUIElement(B),{priority:H.converterPriority||"normal"}),t.on(`removeMarker:${H.model}`,removeUIElement(),{priority:H.converterPriority||"normal"})}}function downcastMarkerToData(H){H=cloneDeep(H);const B=H.model;let t=H.view;return t||(t=V=>({group:B,name:V.substr(H.model.length+1)})),V=>{V.on(`addMarker:${B}`,insertMarkerData(t),{priority:H.converterPriority||"normal"}),V.on(`removeMarker:${B}`,removeMarkerData(t),{priority:H.converterPriority||"normal"})}}function downcastMarkerToHighlight(H){return B=>{B.on(`addMarker:${H.model}`,highlightText(H.view),{priority:H.converterPriority||"normal"}),B.on(`addMarker:${H.model}`,highlightElement(H.view),{priority:H.converterPriority||"normal"}),B.on(`removeMarker:${H.model}`,removeHighlight$1(H.view),{priority:H.converterPriority||"normal"})}}function normalizeModelElementConfig(H){return typeof H=="string"&&(H={name:H}),{name:H.name,attributes:H.attributes?toArray$2(H.attributes):[],children:!!H.children}}function normalizeToElementConfig(H,B){return typeof H=="function"?H:(t,V)=>createViewElementFromDefinition(H,V,B)}function createViewElementFromDefinition(H,B,t){typeof H=="string"&&(H={name:H});let V;const N=B.writer,W=Object.assign({},H.attributes);if(t=="container")V=N.createContainerElement(H.name,W);else if(t=="attribute"){const K={priority:H.priority||AttributeElement.DEFAULT_PRIORITY};V=N.createAttributeElement(H.name,W,K)}else V=N.createUIElement(H.name,W);if(H.styles){const K=Object.keys(H.styles);for(const G of K)N.setStyle(G,H.styles[G],V)}if(H.classes){const K=H.classes;if(typeof K=="string")N.addClass(K,V);else for(const G of K)N.addClass(G,V)}return V}function getFromAttributeCreator(H){return H.model.values?(B,t,V)=>{const N=H.view[B];return N?N(B,t,V):null}:H.view}function normalizeToAttributeConfig(H){return typeof H=="string"?B=>({key:H,value:B}):typeof H=="object"?H.value?()=>H:B=>({key:H.key,value:B}):H}function prepareDescriptor(H,B,t){const V=typeof H=="function"?H(B,t):H;return V?(V.priority||(V.priority=10),V.id||(V.id=B.markerName),V):null}function createChangeReducerCallback(H){return(B,t)=>{if(!B.is("element",H.name))return!1;if(t.type=="attribute"){if(H.attributes.includes(t.attributeKey))return!0}else{/* istanbul ignore else: This is always true because otherwise it would not register a reducer callback. -- @preserve */if(H.children)return!0}return!1}}function createChangeReducer(H){const B=createChangeReducerCallback(H);return(t,V)=>{const N=[];V.reconvertedElements||(V.reconvertedElements=new Set);for(const W of V.changes){const K=W.type=="attribute"?W.range.start.nodeAfter:W.position.parent;if(!K||!B(K,W)){N.push(W);continue}if(!V.reconvertedElements.has(K)){V.reconvertedElements.add(K);const G=Position._createBefore(K);let Z=N.length;for(let Y=N.length-1;Y>=0;Y--){const X=N[Y],te=(X.type=="attribute"?X.range.start:X.position).compareWith(G);if(te=="before"||X.type=="remove"&&te=="same")break;Z=Y}N.splice(Z,0,{type:"remove",name:K.name,position:G,length:1},{type:"reinsert",name:K.name,position:G,length:1})}}V.changes=N}}function createConsumer(H){return(B,t,V={})=>{const N=["insert"];for(const W of H.attributes)B.hasAttribute(W)&&N.push(`attribute:${W}`);return N.every(W=>t.test(B,W))?(V.preflight||N.forEach(W=>t.consume(B,W)),!0):!1}}function createSlotFactory(H,B,t){return(V,N)=>{const W=V.createContainerElement("$slot");let K=null;if(N==="children")K=Array.from(H.getChildren());else if(typeof N=="function")K=Array.from(H.getChildren()).filter(G=>N(G));else throw new CKEditorError("conversion-slot-mode-unknown",t.dispatcher,{modeOrFilter:N});return B.set(W,K),W}}function validateSlotsChildren(H,B,t){const V=Array.from(B.values()).flat(),N=new Set(V);if(N.size!=V.length)throw new CKEditorError("conversion-slot-filter-overlap",t.dispatcher,{element:H});if(N.size!=H.childCount)throw new CKEditorError("conversion-slot-filter-incomplete",t.dispatcher,{element:H})}function fillSlots(H,B,t,V){t.mapper.on("modelToViewPosition",K,{priority:"highest"});let N=null,W=null;for([N,W]of B)reinsertOrConvertNodes(H,W,t,V),t.writer.move(t.writer.createRangeIn(N),t.writer.createPositionBefore(N)),t.writer.remove(N);t.mapper.off("modelToViewPosition",K);function K(G,Z){const Y=Z.modelPosition.nodeAfter,X=W.indexOf(Y);X<0||(Z.viewPosition=Z.mapper.findPositionIn(N,X))}}function reinsertOrConvertNodes(H,B,t,V){for(const N of B)reinsertNode(H.root,N,t,V)||t.convertItem(N)}function reinsertNode(H,B,t,V){const{writer:N,mapper:W}=t;if(!V.reconversion)return!1;const K=W.toViewElement(B);return!K||K.root==H||!t.canReuseView(K)?!1:(N.move(N.createRangeOn(K),W.toViewPosition(Position._createBefore(B))),!0)}function defaultConsumer(H,B,{preflight:t}={}){return t?B.test(H,"insert"):B.consume(H,"insert")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function autoParagraphEmptyRoots(H){const{schema:B,document:t}=H.model;for(const V of t.getRoots())if(V.isEmpty&&!B.checkChild(V,"$text")&&B.checkChild(V,"paragraph"))return H.insertElement("paragraph",V),!0;return!1}function isParagraphable(H,B,t){const V=t.createContext(H);return!(!t.checkChild(V,"paragraph")||!t.checkChild(V.push("paragraph"),B))}function wrapInParagraph(H,B){const t=B.createElement("paragraph");return B.insert(t,H),B.createPositionAt(t,0)}class UpcastHelpers extends ConversionHelpers{elementToElement(B){return this.add(upcastElementToElement(B))}elementToAttribute(B){return this.add(upcastElementToAttribute(B))}attributeToAttribute(B){return this.add(upcastAttributeToAttribute(B))}elementToMarker(B){return this.add(upcastElementToMarker(B))}dataToMarker(B){return this.add(upcastDataToMarker(B))}}function convertToModelFragment$1(){return(H,B,t)=>{if(!B.modelRange&&t.consumable.consume(B.viewItem,{name:!0})){const{modelRange:V,modelCursor:N}=t.convertChildren(B.viewItem,B.modelCursor);B.modelRange=V,B.modelCursor=N}}}function convertText(){return(H,B,{schema:t,consumable:V,writer:N})=>{let W=B.modelCursor;if(!V.test(B.viewItem))return;if(!t.checkChild(W,"$text")){if(!isParagraphable(W,"$text",t)||B.viewItem.data.trim().length==0)return;W=wrapInParagraph(W,N)}V.consume(B.viewItem);const K=N.createText(B.viewItem.data);N.insert(K,W),B.modelRange=N.createRange(W,W.getShiftedBy(K.offsetSize)),B.modelCursor=B.modelRange.end}}function convertSelectionChange(H,B){return(t,V)=>{const N=V.newSelection,W=[];for(const G of N.getRanges())W.push(B.toModelRange(G));const K=H.createSelection(W,{backward:N.isBackward});K.isEqual(H.document.selection)||H.change(G=>{G.setSelection(K)})}}function upcastElementToElement(H){H=cloneDeep(H);const B=prepareToElementConverter(H),t=getViewElementNameFromConfig(H.view),V=t?`element:${t}`:"element";return N=>{N.on(V,B,{priority:H.converterPriority||"normal"})}}function upcastElementToAttribute(H){H=cloneDeep(H),normalizeModelAttributeConfig(H);const B=prepareToAttributeConverter(H,!1),t=getViewElementNameFromConfig(H.view),V=t?`element:${t}`:"element";return N=>{N.on(V,B,{priority:H.converterPriority||"low"})}}function upcastAttributeToAttribute(H){H=cloneDeep(H);let B=null;(typeof H.view=="string"||H.view.key)&&(B=normalizeViewAttributeKeyValueConfig(H)),normalizeModelAttributeConfig(H,B);const t=prepareToAttributeConverter(H,!0);return V=>{V.on("element",t,{priority:H.converterPriority||"low"})}}function upcastElementToMarker(H){const B=normalizeElementToMarkerModelConfig(H.model);return upcastElementToElement({...H,model:B})}function upcastDataToMarker(H){H=cloneDeep(H),H.model||(H.model=N=>N?H.view+":"+N:H.view);const B={view:H.view,model:H.model},t=prepareToElementConverter(normalizeDataToMarkerConfig(B,"start")),V=prepareToElementConverter(normalizeDataToMarkerConfig(B,"end"));return N=>{N.on(`element:${H.view}-start`,t,{priority:H.converterPriority||"normal"}),N.on(`element:${H.view}-end`,V,{priority:H.converterPriority||"normal"});const W=priorities.low,K=priorities.highest,G=priorities.get(H.converterPriority)/K;N.on("element",upcastAttributeToMarker(B),{priority:W+G})}}function upcastAttributeToMarker(H){return(B,t,V)=>{const N=`data-${H.view}`;if(!V.consumable.test(t.viewItem,{attributes:N+"-end-after"})&&!V.consumable.test(t.viewItem,{attributes:N+"-start-after"})&&!V.consumable.test(t.viewItem,{attributes:N+"-end-before"})&&!V.consumable.test(t.viewItem,{attributes:N+"-start-before"}))return;t.modelRange||Object.assign(t,V.convertChildren(t.viewItem,t.modelCursor)),V.consumable.consume(t.viewItem,{attributes:N+"-end-after"})&&W(t.modelRange.end,t.viewItem.getAttribute(N+"-end-after").split(",")),V.consumable.consume(t.viewItem,{attributes:N+"-start-after"})&&W(t.modelRange.end,t.viewItem.getAttribute(N+"-start-after").split(",")),V.consumable.consume(t.viewItem,{attributes:N+"-end-before"})&&W(t.modelRange.start,t.viewItem.getAttribute(N+"-end-before").split(",")),V.consumable.consume(t.viewItem,{attributes:N+"-start-before"})&&W(t.modelRange.start,t.viewItem.getAttribute(N+"-start-before").split(","));function W(K,G){for(const Z of G){const Y=H.model(Z,V),X=V.writer.createElement("$marker",{"data-name":Y});V.writer.insert(X,K),t.modelCursor.isEqual(K)?t.modelCursor=t.modelCursor.getShiftedBy(1):t.modelCursor=t.modelCursor._getTransformedByInsertion(K,1),t.modelRange=t.modelRange._getTransformedByInsertion(K,1)[0]}}}}function getViewElementNameFromConfig(H){return typeof H=="string"?H:typeof H=="object"&&typeof H.name=="string"?H.name:null}function prepareToElementConverter(H){const B=new Matcher(H.view);return(t,V,N)=>{const W=B.match(V.viewItem);if(!W)return;const K=W.match;if(K.name=!0,!N.consumable.test(V.viewItem,K))return;const G=getModelElement(H.model,V.viewItem,N);G&&N.safeInsert(G,V.modelCursor)&&(N.consumable.consume(V.viewItem,K),N.convertChildren(V.viewItem,G),N.updateConversionResult(G,V))}}function getModelElement(H,B,t){return H instanceof Function?H(B,t):t.writer.createElement(H)}function normalizeViewAttributeKeyValueConfig(H){typeof H.view=="string"&&(H.view={key:H.view});const B=H.view.key,t=typeof H.view.value>"u"?/[\s\S]*/:H.view.value;let V;return B=="class"||B=="style"?V={[B=="class"?"classes":"styles"]:t}:V={attributes:{[B]:t}},H.view.name&&(V.name=H.view.name),H.view=V,B}function normalizeModelAttributeConfig(H,B=null){const t=B===null?!0:W=>W.getAttribute(B),V=typeof H.model!="object"?H.model:H.model.key,N=typeof H.model!="object"||typeof H.model.value>"u"?t:H.model.value;H.model={key:V,value:N}}function prepareToAttributeConverter(H,B){const t=new Matcher(H.view);return(V,N,W)=>{if(!N.modelRange&&B)return;const K=t.match(N.viewItem);if(!K||(onlyViewNameIsDefined(H.view,N.viewItem)?K.match.name=!0:delete K.match.name,!W.consumable.test(N.viewItem,K.match)))return;const G=H.model.key,Z=typeof H.model.value=="function"?H.model.value(N.viewItem,W):H.model.value;if(Z===null)return;N.modelRange||Object.assign(N,W.convertChildren(N.viewItem,N.modelCursor)),setAttributeOn(N.modelRange,{key:G,value:Z},B,W)&&(W.consumable.test(N.viewItem,{name:!0})&&(K.match.name=!0),W.consumable.consume(N.viewItem,K.match))}}function onlyViewNameIsDefined(H,B){const t=typeof H=="function"?H(B):H;return typeof t=="object"&&!getViewElementNameFromConfig(t)?!1:!t.classes&&!t.attributes&&!t.styles}function setAttributeOn(H,B,t,V){let N=!1;for(const W of Array.from(H.getItems({shallow:t})))V.schema.checkAttribute(W,B.key)&&(N=!0,!W.hasAttribute(B.key)&&V.writer.setAttribute(B.key,B.value,W));return N}function normalizeElementToMarkerModelConfig(H){return(B,t)=>{const V=typeof H=="string"?H:H(B,t);return t.writer.createElement("$marker",{"data-name":V})}}function normalizeDataToMarkerConfig(H,B){const t=(V,N)=>{const W=V.getAttribute("name"),K=H.model(W,N);return N.writer.createElement("$marker",{"data-name":K})};return{view:`${H.view}-${B}`,model:t}}function injectSelectionPostFixer$1(H){H.document.registerPostFixer(B=>selectionPostFixer(B,H))}function selectionPostFixer(H,B){const t=B.document.selection,V=B.schema,N=[];let W=!1;for(const K of t.getRanges()){const G=tryFixingRange(K,V);G&&!G.isEqual(K)?(N.push(G),W=!0):N.push(K)}return W&&H.setSelection(mergeIntersectingRanges(N),{backward:t.isBackward}),!1}function tryFixingRange(H,B){return H.isCollapsed?tryFixingCollapsedRange(H,B):tryFixingNonCollapsedRage(H,B)}function tryFixingCollapsedRange(H,B){const t=H.start,V=B.getNearestSelectionRange(t);if(!V){const W=t.getAncestors().reverse().find(K=>B.isObject(K));return W?Range._createOn(W):null}if(!V.isCollapsed)return V;const N=V.start;return t.isEqual(N)?null:new Range(N)}function tryFixingNonCollapsedRage(H,B){const{start:t,end:V}=H,N=B.checkChild(t,"$text"),W=B.checkChild(V,"$text"),K=B.getLimitElement(t),G=B.getLimitElement(V);if(K===G){if(N&&W)return null;if(checkSelectionOnNonLimitElements(t,V,B)){const Q=t.nodeAfter&&B.isSelectable(t.nodeAfter)?null:B.getNearestSelectionRange(t,"forward"),ie=V.nodeBefore&&B.isSelectable(V.nodeBefore)?null:B.getNearestSelectionRange(V,"backward"),ne=Q?Q.start:t,le=ie?ie.end:V;return new Range(ne,le)}}const Z=K&&!K.is("rootElement"),Y=G&&!G.is("rootElement");if(Z||Y){const X=t.nodeAfter&&V.nodeBefore&&t.nodeAfter.parent===V.nodeBefore.parent,Q=Z&&(!X||!isSelectable(t.nodeAfter,B)),te=Y&&(!X||!isSelectable(V.nodeBefore,B));let ie=t,ne=V;return Q&&(ie=Position._createBefore(findOutermostLimitAncestor(K,B))),te&&(ne=Position._createAfter(findOutermostLimitAncestor(G,B))),new Range(ie,ne)}return null}function findOutermostLimitAncestor(H,B){let t=H,V=t;for(;B.isLimit(V)&&V.parent;)t=V,V=V.parent;return t}function checkSelectionOnNonLimitElements(H,B,t){const V=H.nodeAfter&&!t.isLimit(H.nodeAfter)||t.checkChild(H,"$text"),N=B.nodeBefore&&!t.isLimit(B.nodeBefore)||t.checkChild(B,"$text");return V||N}function mergeIntersectingRanges(H){const B=[...H],t=new Set;let V=1;for(;V<B.length;){const W=B[V],K=B.slice(0,V);for(const[G,Z]of K.entries())if(!t.has(G)){if(W.isEqual(Z))t.add(G);else if(W.isIntersecting(Z)){t.add(G),t.add(V);const Y=W.getJoined(Z);B.push(Y)}}V++}return B.filter((W,K)=>!t.has(K))}function isSelectable(H,B){return H&&B.isSelectable(H)}class EditingController extends ObservableMixin(){constructor(t,V){super();ee(this,"model");ee(this,"view");ee(this,"mapper");ee(this,"downcastDispatcher");this.model=t,this.view=new View$1(V),this.mapper=new Mapper,this.downcastDispatcher=new DowncastDispatcher({mapper:this.mapper,schema:t.schema});const N=this.model.document,W=N.selection,K=this.model.markers;this.listenTo(this.model,"_beforeChanges",()=>{this.view._disableRendering(!0)},{priority:"highest"}),this.listenTo(this.model,"_afterChanges",()=>{this.view._disableRendering(!1)},{priority:"lowest"}),this.listenTo(N,"change",()=>{this.view.change(G=>{this.downcastDispatcher.convertChanges(N.differ,K,G),this.downcastDispatcher.convertSelection(W,K,G)})},{priority:"low"}),this.listenTo(this.view.document,"selectionChange",convertSelectionChange(this.model,this.mapper)),this.listenTo(this.view.document,"beforeinput",fixTargetRanges(this.mapper,this.model.schema,this.view),{priority:"high"}),this.downcastDispatcher.on("insert:$text",insertText(),{priority:"lowest"}),this.downcastDispatcher.on("insert",insertAttributesAndChildren(),{priority:"lowest"}),this.downcastDispatcher.on("remove",remove(),{priority:"low"}),this.downcastDispatcher.on("cleanSelection",cleanSelection()),this.downcastDispatcher.on("selection",convertRangeSelection(),{priority:"low"}),this.downcastDispatcher.on("selection",convertCollapsedSelection(),{priority:"low"}),this.view.document.roots.bindTo(this.model.document.roots).using(G=>{if(G.rootName=="$graveyard")return null;const Z=new RootEditableElement(this.view.document,G.name);return Z.rootName=G.rootName,this.mapper.bindElements(G,Z),Z})}destroy(){this.view.destroy(),this.stopListening()}reconvertMarker(t){const V=typeof t=="string"?t:t.name,N=this.model.markers.get(V);if(!N)throw new CKEditorError("editingcontroller-reconvertmarker-marker-not-exist",this,{markerName:V});this.model.change(()=>{this.model.markers._refresh(N)})}reconvertItem(t){this.model.change(()=>{this.model.document.differ._refreshItem(t)})}}function fixTargetRanges(H,B,t){return(V,N)=>{if(!(t.document.isComposing&&!env.isAndroid))for(let W=0;W<N.targetRanges.length;W++){const K=N.targetRanges[W],G=H.toModelRange(K),Z=tryFixingRange(G,B);!Z||Z.isEqual(G)||(N.targetRanges[W]=H.toViewRange(Z))}}}class ViewConsumable{constructor(){ee(this,"_consumables",new Map)}add(B,t){let V;if(B.is("$text")||B.is("documentFragment")){this._consumables.set(B,!0);return}this._consumables.has(B)?V=this._consumables.get(B):(V=new ViewElementConsumables(B),this._consumables.set(B,V)),V.add(t)}test(B,t){const V=this._consumables.get(B);return V===void 0?null:B.is("$text")||B.is("documentFragment")?V:V.test(t)}consume(B,t){return this.test(B,t)?(B.is("$text")||B.is("documentFragment")?this._consumables.set(B,!1):this._consumables.get(B).consume(t),!0):!1}revert(B,t){const V=this._consumables.get(B);V!==void 0&&(B.is("$text")||B.is("documentFragment")?this._consumables.set(B,!0):V.revert(t))}static consumablesFromElement(B){const t={element:B,name:!0,attributes:[],classes:[],styles:[]},V=B.getAttributeKeys();for(const K of V)K=="style"||K=="class"||t.attributes.push(K);const N=B.getClassNames();for(const K of N)t.classes.push(K);const W=B.getStyleNames();for(const K of W)t.styles.push(K);return t}static createFrom(B,t){if(t||(t=new ViewConsumable),B.is("$text"))return t.add(B),t;B.is("element")&&t.add(B,ViewConsumable.consumablesFromElement(B)),B.is("documentFragment")&&t.add(B);for(const V of B.getChildren())t=ViewConsumable.createFrom(V,t);return t}}const CONSUMABLE_TYPES=["attributes","classes","styles"];class ViewElementConsumables{constructor(B){ee(this,"element");ee(this,"_canConsumeName");ee(this,"_consumables");this.element=B,this._canConsumeName=null,this._consumables={attributes:new Map,styles:new Map,classes:new Map}}add(B){B.name&&(this._canConsumeName=!0);for(const t of CONSUMABLE_TYPES)t in B&&this._add(t,B[t])}test(B){if(B.name&&!this._canConsumeName)return this._canConsumeName;for(const t of CONSUMABLE_TYPES)if(t in B){const V=this._test(t,B[t]);if(V!==!0)return V}return!0}consume(B){B.name&&(this._canConsumeName=!1);for(const t of CONSUMABLE_TYPES)t in B&&this._consume(t,B[t])}revert(B){B.name&&(this._canConsumeName=!0);for(const t of CONSUMABLE_TYPES)t in B&&this._revert(t,B[t])}_add(B,t){const V=toArray$2(t),N=this._consumables[B];for(const W of V){if(B==="attributes"&&(W==="class"||W==="style"))throw new CKEditorError("viewconsumable-invalid-attribute",this);if(N.set(W,!0),B==="styles")for(const K of this.element.document.stylesProcessor.getRelatedStyles(W))N.set(K,!0)}}_test(B,t){const V=toArray$2(t),N=this._consumables[B];for(const W of V)if(B==="attributes"&&(W==="class"||W==="style")){const K=W=="class"?"classes":"styles",G=this._test(K,[...this._consumables[K].keys()]);if(G!==!0)return G}else{const K=N.get(W);if(K===void 0)return null;if(!K)return!1}return!0}_consume(B,t){const V=toArray$2(t),N=this._consumables[B];for(const W of V)if(B==="attributes"&&(W==="class"||W==="style")){const K=W=="class"?"classes":"styles";this._consume(K,[...this._consumables[K].keys()])}else if(N.set(W,!1),B=="styles")for(const K of this.element.document.stylesProcessor.getRelatedStyles(W))N.set(K,!1)}_revert(B,t){const V=toArray$2(t),N=this._consumables[B];for(const W of V)if(B==="attributes"&&(W==="class"||W==="style")){const K=W=="class"?"classes":"styles";this._revert(K,[...this._consumables[K].keys()])}else N.get(W)===!1&&N.set(W,!0)}}class Schema extends ObservableMixin(){constructor(){super();ee(this,"_sourceDefinitions",{});ee(this,"_attributeProperties",Object.create(null));ee(this,"_customChildChecks",new Map);ee(this,"_customAttributeChecks",new Map);ee(this,"_genericCheckSymbol",Symbol("$generic"));ee(this,"_compiledDefinitions");this.decorate("checkChild"),this.decorate("checkAttribute"),this.on("checkAttribute",(t,V)=>{V[0]=new SchemaContext(V[0])},{priority:"highest"}),this.on("checkChild",(t,V)=>{V[0]=new SchemaContext(V[0]),V[1]=this.getDefinition(V[1])},{priority:"highest"})}register(t,V){if(this._sourceDefinitions[t])throw new CKEditorError("schema-cannot-register-item-twice",this,{itemName:t});this._sourceDefinitions[t]=[Object.assign({},V)],this._clearCache()}extend(t,V){if(!this._sourceDefinitions[t])throw new CKEditorError("schema-cannot-extend-missing-item",this,{itemName:t});this._sourceDefinitions[t].push(Object.assign({},V)),this._clearCache()}getDefinitions(){return this._compiledDefinitions||this._compile(),this._compiledDefinitions}getDefinition(t){let V;return typeof t=="string"?V=t:"is"in t&&(t.is("$text")||t.is("$textProxy"))?V="$text":V=t.name,this.getDefinitions()[V]}isRegistered(t){return!!this.getDefinition(t)}isBlock(t){const V=this.getDefinition(t);return!!(V&&V.isBlock)}isLimit(t){const V=this.getDefinition(t);return V?!!(V.isLimit||V.isObject):!1}isObject(t){const V=this.getDefinition(t);return V?!!(V.isObject||V.isLimit&&V.isSelectable&&V.isContent):!1}isInline(t){const V=this.getDefinition(t);return!!(V&&V.isInline)}isSelectable(t){const V=this.getDefinition(t);return V?!!(V.isSelectable||V.isObject):!1}isContent(t){const V=this.getDefinition(t);return V?!!(V.isContent||V.isObject):!1}checkChild(t,V){return V?this._checkContextMatch(t,V):!1}checkAttribute(t,V){const N=this.getDefinition(t.last);if(!N)return!1;const W=this._evaluateAttributeChecks(t,V);return W!==void 0?W:N.allowAttributes.includes(V)}checkMerge(t,V){if(t instanceof Position){const N=t.nodeBefore,W=t.nodeAfter;if(!(N instanceof Element))throw new CKEditorError("schema-check-merge-no-element-before",this);if(!(W instanceof Element))throw new CKEditorError("schema-check-merge-no-element-after",this);return this.checkMerge(N,W)}if(this.isLimit(t)||this.isLimit(V))return!1;for(const N of V.getChildren())if(!this.checkChild(t,N))return!1;return!0}addChildCheck(t,V){const N=V!==void 0?V:this._genericCheckSymbol,W=this._customChildChecks.get(N)||[];W.push(t),this._customChildChecks.set(N,W)}addAttributeCheck(t,V){const N=V!==void 0?V:this._genericCheckSymbol,W=this._customAttributeChecks.get(N)||[];W.push(t),this._customAttributeChecks.set(N,W)}setAttributeProperties(t,V){this._attributeProperties[t]=Object.assign(this.getAttributeProperties(t),V)}getAttributeProperties(t){return this._attributeProperties[t]||Object.create(null)}getLimitElement(t){let V;for(t instanceof Position?V=t.parent:V=(t instanceof Range?[t]:Array.from(t.getRanges())).reduce((W,K)=>{const G=K.getCommonAncestor();return W?W.getCommonAncestor(G,{includeSelf:!0}):G},null);!this.isLimit(V)&&V.parent;)V=V.parent;return V}checkAttributeInSelection(t,V){if(t.isCollapsed){const W=[...t.getFirstPosition().getAncestors(),new Text("",t.getAttributes())];return this.checkAttribute(W,V)}else{const N=t.getRanges();for(const W of N)for(const K of W)if(this.checkAttribute(K.item,V))return!0}return!1}*getValidRanges(t,V){t=convertToMinimalFlatRanges(t);for(const N of t)yield*this._getValidRangesForRange(N,V)}getNearestSelectionRange(t,V="both"){if(t.root.rootName=="$graveyard")return null;if(this.checkChild(t,"$text"))return new Range(t);let N,W;const K=t.getAncestors().reverse().find(G=>this.isLimit(G))||t.root;(V=="both"||V=="backward")&&(N=new TreeWalker({boundaries:Range._createIn(K),startPosition:t,direction:"backward"})),(V=="both"||V=="forward")&&(W=new TreeWalker({boundaries:Range._createIn(K),startPosition:t}));for(const G of combineWalkers(N,W)){const Z=G.walker==N?"elementEnd":"elementStart",Y=G.value;if(Y.type==Z&&this.isObject(Y.item))return Range._createOn(Y.item);if(this.checkChild(Y.nextPosition,"$text"))return new Range(Y.nextPosition)}return null}findAllowedParent(t,V){let N=t.parent;for(;N;){if(this.checkChild(N,V))return N;if(this.isLimit(N))return null;N=N.parent}return null}setAllowedAttributes(t,V,N){const W=N.model;for(const[K,G]of Object.entries(V))W.schema.checkAttribute(t,K)&&N.setAttribute(K,G,t)}removeDisallowedAttributes(t,V){for(const N of t)if(N.is("$text"))removeDisallowedAttributeFromNode(this,N,V);else{const K=Range._createIn(N).getPositions();for(const G of K){const Z=G.nodeBefore||G.parent;removeDisallowedAttributeFromNode(this,Z,V)}}}getAttributesWithProperty(t,V,N){const W={};for(const[K,G]of t.getAttributes()){const Z=this.getAttributeProperties(K);Z[V]!==void 0&&(N===void 0||N===Z[V])&&(W[K]=G)}return W}createContext(t){return new SchemaContext(t)}_clearCache(){this._compiledDefinitions=null}_compile(){const t={},V=this._sourceDefinitions,N=Object.keys(V);for(const K of N)t[K]=compileBaseItemRule(V[K],K);const W=Object.values(t);for(const K of W)propagateAllowIn(t,K),propagateAllowChildren(t,K),propagateDisallowIn(t,K),propagateDisallowChildren(t,K);for(const K of W)resolveDisallows(t,K);for(const K of W)compileAllowContentOf(t,K);for(const K of W)compileAllowWhere(t,K);for(const K of W)compileAllowAttributesOf(t,K);for(const K of W)compileInheritPropertiesFrom(t,K);this._compiledDefinitions=compileDefinitions(t)}_checkContextMatch(t,V){const N=t.last;let W=this._evaluateChildChecks(t,V);if(W=W!==void 0?W:V.allowIn.includes(N.name),!W)return!1;const K=this.getDefinition(N),G=t.trimLast();return K?G.length==0?!0:this._checkContextMatch(G,K):!1}_evaluateChildChecks(t,V){const N=this._customChildChecks.get(this._genericCheckSymbol)||[],W=this._customChildChecks.get(V.name)||[];for(const K of[...N,...W]){const G=K(t,V);if(G!==void 0)return G}}_evaluateAttributeChecks(t,V){const N=this._customAttributeChecks.get(this._genericCheckSymbol)||[],W=this._customAttributeChecks.get(V)||[];for(const K of[...N,...W]){const G=K(t,V);if(G!==void 0)return G}}*_getValidRangesForRange(t,V){let N=t.start,W=t.start;for(const K of t.getItems({shallow:!0}))K.is("element")&&(yield*this._getValidRangesForRange(Range._createIn(K),V)),this.checkAttribute(K,V)||(N.isEqual(W)||(yield new Range(N,W)),N=Position._createAfter(K)),W=Position._createAfter(K);N.isEqual(W)||(yield new Range(N,W))}findOptimalInsertionRange(t,V){const N=t.getSelectedElement();if(N&&this.isObject(N)&&!this.isInline(N))return V=="before"||V=="after"?new Range(Position._createAt(N,V)):Range._createOn(N);const W=first(t.getSelectedBlocks());if(!W)return new Range(t.focus);if(W.isEmpty)return new Range(Position._createAt(W,0));const K=Position._createAfter(W);return t.focus.isTouching(K)?new Range(K):new Range(Position._createBefore(W))}}class SchemaContext{constructor(B){ee(this,"_items");if(B instanceof SchemaContext)return B;let t;typeof B=="string"?t=[B]:Array.isArray(B)?t=B:t=B.getAncestors({includeSelf:!0}),this._items=t.map(mapContextItem)}get length(){return this._items.length}get last(){return this._items[this._items.length-1]}[Symbol.iterator](){return this._items[Symbol.iterator]()}push(B){const t=new SchemaContext([B]);return t._items=[...this._items,...t._items],t}trimLast(){const B=new SchemaContext([]);return B._items=this._items.slice(0,-1),B}getItem(B){return this._items[B]}*getNames(){yield*this._items.map(B=>B.name)}endsWith(B){return Array.from(this.getNames()).join(" ").endsWith(B)}startsWith(B){return Array.from(this.getNames()).join(" ").startsWith(B)}}function compileBaseItemRule(H,B){const t={name:B,allowIn:new Set,allowChildren:new Set,disallowIn:new Set,disallowChildren:new Set,allowContentOf:new Set,allowWhere:new Set,allowAttributes:new Set,disallowAttributes:new Set,allowAttributesOf:new Set,inheritTypesFrom:new Set};return copyTypes(H,t),copyProperty(H,t,"allowIn"),copyProperty(H,t,"allowChildren"),copyProperty(H,t,"disallowIn"),copyProperty(H,t,"disallowChildren"),copyProperty(H,t,"allowContentOf"),copyProperty(H,t,"allowWhere"),copyProperty(H,t,"allowAttributes"),copyProperty(H,t,"disallowAttributes"),copyProperty(H,t,"allowAttributesOf"),copyProperty(H,t,"inheritTypesFrom"),resolveInheritAll(H,t),t}function propagateAllowIn(H,B){for(const t of B.allowIn){const V=H[t];V?V.allowChildren.add(B.name):B.allowIn.delete(t)}}function propagateAllowChildren(H,B){for(const t of B.allowChildren){const V=H[t];V?V.allowIn.add(B.name):B.allowChildren.delete(t)}}function propagateDisallowIn(H,B){for(const t of B.disallowIn){const V=H[t];V?V.disallowChildren.add(B.name):B.disallowIn.delete(t)}}function propagateDisallowChildren(H,B){for(const t of B.disallowChildren){const V=H[t];V?V.disallowIn.add(B.name):B.disallowChildren.delete(t)}}function resolveDisallows(H,B){for(const t of B.disallowChildren)B.allowChildren.delete(t);for(const t of B.disallowIn)B.allowIn.delete(t);for(const t of B.disallowAttributes)B.allowAttributes.delete(t)}function compileAllowContentOf(H,B){for(const t of B.allowContentOf){const V=H[t];V&&(V.disallowChildren.forEach(N=>{B.allowChildren.has(N)||(B.disallowChildren.add(N),H[N].disallowIn.add(B.name))}),V.allowChildren.forEach(N=>{B.disallowChildren.has(N)||(B.allowChildren.add(N),H[N].allowIn.add(B.name))}))}}function compileAllowWhere(H,B){for(const t of B.allowWhere){const V=H[t];V&&(V.disallowIn.forEach(N=>{B.allowIn.has(N)||(B.disallowIn.add(N),H[N].disallowChildren.add(B.name))}),V.allowIn.forEach(N=>{B.disallowIn.has(N)||(B.allowIn.add(N),H[N].allowChildren.add(B.name))}))}}function compileDefinitions(H){const B={};for(const t of Object.values(H))B[t.name]={name:t.name,isBlock:!!t.isBlock,isContent:!!t.isContent,isInline:!!t.isInline,isLimit:!!t.isLimit,isObject:!!t.isObject,isSelectable:!!t.isSelectable,allowIn:Array.from(t.allowIn).filter(V=>!!H[V]),allowChildren:Array.from(t.allowChildren).filter(V=>!!H[V]),allowAttributes:Array.from(t.allowAttributes)};return B}function compileAllowAttributesOf(H,B){for(const t of B.allowAttributesOf){const V=H[t];if(!V)return;V.allowAttributes.forEach(N=>{B.disallowAttributes.has(N)||B.allowAttributes.add(N)})}}function compileInheritPropertiesFrom(H,B){for(const t of B.inheritTypesFrom){const V=H[t];if(V){const N=Object.keys(V).filter(W=>W.startsWith("is"));for(const W of N)W in B||(B[W]=V[W])}}}function copyTypes(H,B){for(const t of H){const V=Object.keys(t).filter(N=>N.startsWith("is"));for(const N of V)B[N]=!!t[N]}}function copyProperty(H,B,t){for(const V of H){let N=V[t];typeof N=="string"&&(N=[N]),Array.isArray(N)&&N.forEach(W=>B[t].add(W))}}function resolveInheritAll(H,B){for(const t of H){const V=t.inheritAllFrom;V&&(B.allowContentOf.add(V),B.allowWhere.add(V),B.allowAttributesOf.add(V),B.inheritTypesFrom.add(V))}}function mapContextItem(H){return typeof H=="string"||H.is("documentFragment")?{name:typeof H=="string"?H:"$documentFragment",*getAttributeKeys(){},getAttribute(){}}:{name:H.is("element")?H.name:"$text",*getAttributeKeys(){yield*H.getAttributeKeys()},getAttribute(B){return H.getAttribute(B)}}}function*combineWalkers(H,B){let t=!1;for(;!t;){if(t=!0,H){const V=H.next();V.done||(t=!1,yield{walker:H,value:V.value})}if(B){const V=B.next();V.done||(t=!1,yield{walker:B,value:V.value})}}}function*convertToMinimalFlatRanges(H){for(const B of H)yield*B.getMinimalFlatRanges()}function removeDisallowedAttributeFromNode(H,B,t){for(const V of B.getAttributeKeys())H.checkAttribute(B,V)||t.removeAttribute(V,B)}class UpcastDispatcher extends EmitterMixin(){constructor(t){super();ee(this,"conversionApi");ee(this,"_splitParts",new Map);ee(this,"_cursorParents",new Map);ee(this,"_modelCursor",null);ee(this,"_emptyElementsToKeep",new Set);this.conversionApi={...t,consumable:null,writer:null,store:null,convertItem:(V,N)=>this._convertItem(V,N),convertChildren:(V,N)=>this._convertChildren(V,N),safeInsert:(V,N)=>this._safeInsert(V,N),updateConversionResult:(V,N)=>this._updateConversionResult(V,N),splitToAllowedParent:(V,N)=>this._splitToAllowedParent(V,N),getSplitParts:V=>this._getSplitParts(V),keepEmptyElement:V=>this._keepEmptyElement(V)}}convert(t,V,N=["$root"]){this.fire("viewCleanup",t),this._modelCursor=createContextTree(N,V),this.conversionApi.writer=V,this.conversionApi.consumable=ViewConsumable.createFrom(t),this.conversionApi.store={};const{modelRange:W}=this._convertItem(t,this._modelCursor),K=V.createDocumentFragment();if(W){this._removeEmptyElements();for(const G of Array.from(this._modelCursor.parent.getChildren()))V.append(G,K);K.markers=extractMarkersFromModelFragment(K,V)}return this._modelCursor=null,this._splitParts.clear(),this._cursorParents.clear(),this._emptyElementsToKeep.clear(),this.conversionApi.writer=null,this.conversionApi.store=null,K}_convertItem(t,V){const N={viewItem:t,modelCursor:V,modelRange:null};if(t.is("element")?this.fire(`element:${t.name}`,N,this.conversionApi):t.is("$text")?this.fire("text",N,this.conversionApi):this.fire("documentFragment",N,this.conversionApi),N.modelRange&&!(N.modelRange instanceof Range))throw new CKEditorError("view-conversion-dispatcher-incorrect-result",this);return{modelRange:N.modelRange,modelCursor:N.modelCursor}}_convertChildren(t,V){let N=V.is("position")?V:Position._createAt(V,0);const W=new Range(N);for(const K of Array.from(t.getChildren())){const G=this._convertItem(K,N);G.modelRange instanceof Range&&(W.end=G.modelRange.end,N=G.modelCursor)}return{modelRange:W,modelCursor:N}}_safeInsert(t,V){const N=this._splitToAllowedParent(t,V);return N?(this.conversionApi.writer.insert(t,N.position),!0):!1}_updateConversionResult(t,V){const N=this._getSplitParts(t),W=this.conversionApi.writer;V.modelRange||(V.modelRange=W.createRange(W.createPositionBefore(t),W.createPositionAfter(N[N.length-1])));const K=this._cursorParents.get(t);K?V.modelCursor=W.createPositionAt(K,0):V.modelCursor=V.modelRange.end}_splitToAllowedParent(t,V){const{schema:N,writer:W}=this.conversionApi;let K=N.findAllowedParent(V,t);if(K){if(K===V.parent)return{position:V};this._modelCursor.parent.getAncestors().includes(K)&&(K=null)}if(!K)return isParagraphable(V,t,N)?{position:wrapInParagraph(V,W)}:null;const G=this.conversionApi.writer.split(V,K),Z=[];for(const X of G.range.getWalker())if(X.type=="elementEnd")Z.push(X.item);else{const Q=Z.pop(),te=X.item;this._registerSplitPair(Q,te)}const Y=G.range.end.parent;return this._cursorParents.set(t,Y),{position:G.position,cursorParent:Y}}_registerSplitPair(t,V){this._splitParts.has(t)||this._splitParts.set(t,[t]);const N=this._splitParts.get(t);this._splitParts.set(V,N),N.push(V)}_getSplitParts(t){let V;return this._splitParts.has(t)?V=this._splitParts.get(t):V=[t],V}_keepEmptyElement(t){this._emptyElementsToKeep.add(t)}_removeEmptyElements(){let t=!1;for(const V of this._splitParts.keys())V.isEmpty&&!this._emptyElementsToKeep.has(V)&&(this.conversionApi.writer.remove(V),this._splitParts.delete(V),t=!0);t&&this._removeEmptyElements()}}function extractMarkersFromModelFragment(H,B){const t=new Set,V=new Map,N=Range._createIn(H).getItems();for(const W of N)W.is("element","$marker")&&t.add(W);for(const W of t){const K=W.getAttribute("data-name"),G=B.createPositionBefore(W);V.has(K)?V.get(K).end=G.clone():V.set(K,new Range(G.clone())),B.remove(W)}return V}function createContextTree(H,B){let t;for(const V of new SchemaContext(H)){const N={};for(const K of V.getAttributeKeys())N[K]=V.getAttribute(K);const W=B.createElement(V.name,N);t&&B.insert(W,t),t=Position._createAt(W,0)}return t}class BasicHtmlWriter{getHtml(B){const V=global$1.document.implementation.createHTMLDocument("").createElement("div");return V.appendChild(B),V.innerHTML}}class HtmlDataProcessor{constructor(B){ee(this,"domParser");ee(this,"domConverter");ee(this,"htmlWriter");ee(this,"skipComments",!0);this.domParser=new DOMParser,this.domConverter=new DomConverter(B,{renderingMode:"data"}),this.htmlWriter=new BasicHtmlWriter}toData(B){const t=this.domConverter.viewToDom(B);return this.htmlWriter.getHtml(t)}toView(B){const t=this._toDom(B);return this.domConverter.domToView(t,{skipComments:this.skipComments})}registerRawContentMatcher(B){this.domConverter.registerRawContentMatcher(B)}useFillerType(B){this.domConverter.blockFillerMode=B=="marked"?"markedNbsp":"nbsp"}_toDom(B){/<(?:html|body|head|meta)(?:\s[^>]*)?>/i.test(B.trim().slice(0,1e4))||(B=`<body>${B}</body>`);const t=this.domParser.parseFromString(B,"text/html"),V=t.createDocumentFragment(),N=t.body.childNodes;for(;N.length>0;)V.appendChild(N[0]);return V}}class DataController extends EmitterMixin(){constructor(t,V){super();ee(this,"model");ee(this,"mapper");ee(this,"downcastDispatcher");ee(this,"upcastDispatcher");ee(this,"viewDocument");ee(this,"stylesProcessor");ee(this,"htmlProcessor");ee(this,"processor");ee(this,"_viewWriter");this.model=t,this.mapper=new Mapper,this.downcastDispatcher=new DowncastDispatcher({mapper:this.mapper,schema:t.schema}),this.downcastDispatcher.on("insert:$text",insertText(),{priority:"lowest"}),this.downcastDispatcher.on("insert",insertAttributesAndChildren(),{priority:"lowest"}),this.upcastDispatcher=new UpcastDispatcher({schema:t.schema}),this.viewDocument=new Document$1(V),this.stylesProcessor=V,this.htmlProcessor=new HtmlDataProcessor(this.viewDocument),this.processor=this.htmlProcessor,this._viewWriter=new DowncastWriter(this.viewDocument),this.upcastDispatcher.on("text",convertText(),{priority:"lowest"}),this.upcastDispatcher.on("element",convertToModelFragment$1(),{priority:"lowest"}),this.upcastDispatcher.on("documentFragment",convertToModelFragment$1(),{priority:"lowest"}),ObservableMixin().prototype.decorate.call(this,"init"),ObservableMixin().prototype.decorate.call(this,"set"),ObservableMixin().prototype.decorate.call(this,"get"),ObservableMixin().prototype.decorate.call(this,"toView"),ObservableMixin().prototype.decorate.call(this,"toModel"),this.on("init",()=>{this.fire("ready")},{priority:"lowest"}),this.on("ready",()=>{this.model.enqueueChange({isUndoable:!1},autoParagraphEmptyRoots)},{priority:"lowest"})}get(t={}){const{rootName:V="main",trim:N="empty"}=t;if(!this._checkIfRootsExists([V]))throw new CKEditorError("datacontroller-get-non-existent-root",this);const W=this.model.document.getRoot(V);return W.isAttached()||logWarning("datacontroller-get-detached-root",this),N==="empty"&&!this.model.hasContent(W,{ignoreWhitespaces:!0})?"":this.stringify(W,t)}stringify(t,V={}){const N=this.toView(t,V);return this.processor.toData(N)}toView(t,V={}){const N=this.viewDocument,W=this._viewWriter;this.mapper.clearBindings();const K=Range._createIn(t),G=new DocumentFragment$1(N);this.mapper.bindElements(t,G);const Z=t.is("documentFragment")?t.markers:_getMarkersRelativeToElement(t);return this.downcastDispatcher.convert(K,Z,W,V),G}init(t){if(this.model.document.version)throw new CKEditorError("datacontroller-init-document-not-empty",this);let V={};if(typeof t=="string"?V.main=t:V=t,!this._checkIfRootsExists(Object.keys(V)))throw new CKEditorError("datacontroller-init-non-existent-root",this);return this.model.enqueueChange({isUndoable:!1},N=>{for(const W of Object.keys(V)){const K=this.model.document.getRoot(W);N.insert(this.parse(V[W],K),K,0)}}),Promise.resolve()}set(t,V={}){let N={};if(typeof t=="string"?N.main=t:N=t,!this._checkIfRootsExists(Object.keys(N)))throw new CKEditorError("datacontroller-set-non-existent-root",this);this.model.enqueueChange(V.batchType||{},W=>{W.setSelection(null),W.removeSelectionAttribute(this.model.document.selection.getAttributeKeys());for(const K of Object.keys(N)){const G=this.model.document.getRoot(K);W.remove(W.createRangeIn(G)),W.insert(this.parse(N[K],G),G,0)}})}parse(t,V="$root"){const N=this.processor.toView(t);return this.toModel(N,V)}toModel(t,V="$root"){return this.model.change(N=>this.upcastDispatcher.convert(t,N,V))}addStyleProcessorRules(t){t(this.stylesProcessor)}registerRawContentMatcher(t){this.processor&&this.processor!==this.htmlProcessor&&this.processor.registerRawContentMatcher(t),this.htmlProcessor.registerRawContentMatcher(t)}destroy(){this.stopListening()}_checkIfRootsExists(t){for(const V of t)if(!this.model.document.getRoot(V))return!1;return!0}}function _getMarkersRelativeToElement(H){const B=[],t=H.root.document;if(!t)return new Map;const V=Range._createIn(H);for(const N of t.model.markers){const W=N.getRange(),K=W.isCollapsed,G=W.start.isEqual(V.start)||W.end.isEqual(V.end);if(K&&G)B.push([N.name,W]);else{const Z=V.getIntersection(W);Z&&B.push([N.name,Z])}}return B.sort(([N,W],[K,G])=>{if(W.end.compareWith(G.start)!=="after")return 1;if(W.start.compareWith(G.end)!=="before")return-1;switch(W.start.compareWith(G.start)){case"before":return 1;case"after":return-1;default:switch(W.end.compareWith(G.end)){case"before":return 1;case"after":return-1;default:return K.localeCompare(N)}}}),new Map(B)}class Conversion{constructor(B,t){ee(this,"_helpers",new Map);ee(this,"_downcast");ee(this,"_upcast");this._downcast=toArray$2(B),this._createConversionHelpers({name:"downcast",dispatchers:this._downcast,isDowncast:!0}),this._upcast=toArray$2(t),this._createConversionHelpers({name:"upcast",dispatchers:this._upcast,isDowncast:!1})}addAlias(B,t){const V=this._downcast.includes(t);if(!this._upcast.includes(t)&&!V)throw new CKEditorError("conversion-add-alias-dispatcher-not-registered",this);this._createConversionHelpers({name:B,dispatchers:[t],isDowncast:V})}for(B){if(!this._helpers.has(B))throw new CKEditorError("conversion-for-unknown-group",this);return this._helpers.get(B)}elementToElement(B){this.for("downcast").elementToElement(B);for(const{model:t,view:V}of _getAllUpcastDefinitions(B))this.for("upcast").elementToElement({model:t,view:V,converterPriority:B.converterPriority})}attributeToElement(B){this.for("downcast").attributeToElement(B);for(const{model:t,view:V}of _getAllUpcastDefinitions(B))this.for("upcast").elementToAttribute({view:V,model:t,converterPriority:B.converterPriority})}attributeToAttribute(B){this.for("downcast").attributeToAttribute(B);for(const{model:t,view:V}of _getAllUpcastDefinitions(B))this.for("upcast").attributeToAttribute({view:V,model:t})}_createConversionHelpers({name:B,dispatchers:t,isDowncast:V}){if(this._helpers.has(B))throw new CKEditorError("conversion-group-exists",this);const N=V?new DowncastHelpers(t):new UpcastHelpers(t);this._helpers.set(B,N)}}function*_getAllUpcastDefinitions(H){if(H.model.values)for(const B of H.model.values){const t={key:H.model.key,value:B},V=H.view[B],N=H.upcastAlso?H.upcastAlso[B]:void 0;yield*_getUpcastDefinition(t,V,N)}else yield*_getUpcastDefinition(H.model,H.view,H.upcastAlso)}function*_getUpcastDefinition(H,B,t){if(yield{model:H,view:B},t)for(const V of toArray$2(t))yield{model:H,view:V}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Operation{constructor(B){ee(this,"baseVersion");ee(this,"isDocumentOperation");ee(this,"batch");this.baseVersion=B,this.isDocumentOperation=this.baseVersion!==null,this.batch=null}_validate(){}toJSON(){const B=Object.assign({},this);return B.__className=this.constructor.className,delete B.batch,delete B.isDocumentOperation,B}static get className(){return"Operation"}static fromJSON(B,t){return new this(B.baseVersion)}}function _insert(H,B){const t=_normalizeNodes(B),V=t.reduce((K,G)=>K+G.offsetSize,0),N=H.parent;_splitNodeAtPosition(H);const W=H.index;return N._insertChild(W,t),_mergeNodesAtIndex(N,W+t.length),_mergeNodesAtIndex(N,W),new Range(H,H.getShiftedBy(V))}function _remove(H){if(!H.isFlat)throw new CKEditorError("operation-utils-remove-range-not-flat",this);const B=H.start.parent;_splitNodeAtPosition(H.start),_splitNodeAtPosition(H.end);const t=B._removeChildren(H.start.index,H.end.index-H.start.index);return _mergeNodesAtIndex(B,H.start.index),t}function _move(H,B){if(!H.isFlat)throw new CKEditorError("operation-utils-move-range-not-flat",this);const t=_remove(H);return B=B._getTransformedByDeletion(H.start,H.end.offset-H.start.offset),_insert(B,t)}function _setAttribute(H,B,t){_splitNodeAtPosition(H.start),_splitNodeAtPosition(H.end);for(const V of H.getItems({shallow:!0})){const N=V.is("$textProxy")?V.textNode:V;t!==null?N._setAttribute(B,t):N._removeAttribute(B),_mergeNodesAtIndex(N.parent,N.index)}_mergeNodesAtIndex(H.end.parent,H.end.index)}function _normalizeNodes(H){const B=[];function t(V){if(typeof V=="string")B.push(new Text(V));else if(V instanceof TextProxy)B.push(new Text(V.data,V.getAttributes()));else if(V instanceof Node$1)B.push(V);else if(isIterable(V))for(const N of V)t(N)}t(H);for(let V=1;V<B.length;V++){const N=B[V],W=B[V-1];N instanceof Text&&W instanceof Text&&_haveSameAttributes(N,W)&&(B.splice(V-1,2,new Text(W.data+N.data,W.getAttributes())),V--)}return B}function _mergeNodesAtIndex(H,B){const t=H.getChild(B-1),V=H.getChild(B);if(t&&V&&t.is("$text")&&V.is("$text")&&_haveSameAttributes(t,V)){const N=new Text(t.data+V.data,t.getAttributes());H._removeChildren(B-1,2),H._insertChild(B-1,N)}}function _splitNodeAtPosition(H){const B=H.textNode,t=H.parent;if(B){const V=H.offset-B.startOffset,N=B.index;t._removeChildren(N,1);const W=new Text(B.data.substr(0,V),B.getAttributes()),K=new Text(B.data.substr(V),B.getAttributes());t._insertChild(N,[W,K])}}function _haveSameAttributes(H,B){const t=H.getAttributes(),V=B.getAttributes();for(const N of t){if(N[1]!==B.getAttribute(N[0]))return!1;V.next()}return V.next().done}class MoveOperation extends Operation{constructor(t,V,N,W){super(W);ee(this,"sourcePosition");ee(this,"howMany");ee(this,"targetPosition");this.sourcePosition=t.clone(),this.sourcePosition.stickiness="toNext",this.howMany=V,this.targetPosition=N.clone(),this.targetPosition.stickiness="toNone"}get type(){return this.targetPosition.root.rootName=="$graveyard"?"remove":this.sourcePosition.root.rootName=="$graveyard"?"reinsert":"move"}get affectedSelectable(){return[Range._createFromPositionAndShift(this.sourcePosition,this.howMany),Range._createFromPositionAndShift(this.targetPosition,0)]}clone(){return new MoveOperation(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion)}getMovedRangeStart(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}getReversed(){const t=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany);return new MoveOperation(this.getMovedRangeStart(),this.howMany,t,this.baseVersion+1)}_validate(){const t=this.sourcePosition.parent,V=this.targetPosition.parent,N=this.sourcePosition.offset,W=this.targetPosition.offset;if(N+this.howMany>t.maxOffset)throw new CKEditorError("move-operation-nodes-do-not-exist",this);if(t===V&&N<W&&W<N+this.howMany)throw new CKEditorError("move-operation-range-into-itself",this);if(this.sourcePosition.root==this.targetPosition.root&&compareArrays(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())=="prefix"){const K=this.sourcePosition.path.length-1;if(this.targetPosition.path[K]>=N&&this.targetPosition.path[K]<N+this.howMany)throw new CKEditorError("move-operation-node-into-itself",this)}}_execute(){_move(Range._createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition)}toJSON(){const t=super.toJSON();return t.sourcePosition=this.sourcePosition.toJSON(),t.targetPosition=this.targetPosition.toJSON(),t}static get className(){return"MoveOperation"}static fromJSON(t,V){const N=Position.fromJSON(t.sourcePosition,V),W=Position.fromJSON(t.targetPosition,V);return new this(N,t.howMany,W,t.baseVersion)}}class InsertOperation extends Operation{constructor(t,V,N){super(N);ee(this,"position");ee(this,"nodes");ee(this,"shouldReceiveAttributes");this.position=t.clone(),this.position.stickiness="toNone",this.nodes=new NodeList(_normalizeNodes(V)),this.shouldReceiveAttributes=!1}get type(){return"insert"}get howMany(){return this.nodes.maxOffset}get affectedSelectable(){return this.position.clone()}clone(){const t=new NodeList([...this.nodes].map(N=>N._clone(!0))),V=new InsertOperation(this.position,t,this.baseVersion);return V.shouldReceiveAttributes=this.shouldReceiveAttributes,V}getReversed(){const t=this.position.root.document.graveyard,V=new Position(t,[0]);return new MoveOperation(this.position,this.nodes.maxOffset,V,this.baseVersion+1)}_validate(){const t=this.position.parent;if(!t||t.maxOffset<this.position.offset)throw new CKEditorError("insert-operation-position-invalid",this)}_execute(){const t=this.nodes;this.nodes=new NodeList([...t].map(V=>V._clone(!0))),_insert(this.position,t)}toJSON(){const t=super.toJSON();return t.position=this.position.toJSON(),t.nodes=this.nodes.toJSON(),t}static get className(){return"InsertOperation"}static fromJSON(t,V){const N=[];for(const K of t.nodes)K.name?N.push(Element.fromJSON(K)):N.push(Text.fromJSON(K));const W=new InsertOperation(Position.fromJSON(t.position,V),N,t.baseVersion);return W.shouldReceiveAttributes=t.shouldReceiveAttributes,W}}class SplitOperation extends Operation{constructor(t,V,N,W,K){super(K);ee(this,"splitPosition");ee(this,"howMany");ee(this,"insertionPosition");ee(this,"graveyardPosition");this.splitPosition=t.clone(),this.splitPosition.stickiness="toNext",this.howMany=V,this.insertionPosition=N,this.graveyardPosition=W?W.clone():null,this.graveyardPosition&&(this.graveyardPosition.stickiness="toNext")}get type(){return"split"}get moveTargetPosition(){const t=this.insertionPosition.path.slice();return t.push(0),new Position(this.insertionPosition.root,t)}get movedRange(){const t=this.splitPosition.getShiftedBy(Number.POSITIVE_INFINITY);return new Range(this.splitPosition,t)}get affectedSelectable(){const t=[Range._createFromPositionAndShift(this.splitPosition,0),Range._createFromPositionAndShift(this.insertionPosition,0)];return this.graveyardPosition&&t.push(Range._createFromPositionAndShift(this.graveyardPosition,0)),t}clone(){return new SplitOperation(this.splitPosition,this.howMany,this.insertionPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const t=this.splitPosition.root.document.graveyard,V=new Position(t,[0]);return new MergeOperation(this.moveTargetPosition,this.howMany,this.splitPosition,V,this.baseVersion+1)}_validate(){const t=this.splitPosition.parent,V=this.splitPosition.offset;if(!t||t.maxOffset<V)throw new CKEditorError("split-operation-position-invalid",this);if(t.parent){if(this.howMany!=t.maxOffset-this.splitPosition.offset)throw new CKEditorError("split-operation-how-many-invalid",this);if(this.graveyardPosition&&!this.graveyardPosition.nodeAfter)throw new CKEditorError("split-operation-graveyard-position-invalid",this)}else throw new CKEditorError("split-operation-split-in-root",this)}_execute(){const t=this.splitPosition.parent;if(this.graveyardPosition)_move(Range._createFromPositionAndShift(this.graveyardPosition,1),this.insertionPosition);else{const N=t._clone();_insert(this.insertionPosition,N)}const V=new Range(Position._createAt(t,this.splitPosition.offset),Position._createAt(t,t.maxOffset));_move(V,this.moveTargetPosition)}toJSON(){const t=super.toJSON();return t.splitPosition=this.splitPosition.toJSON(),t.insertionPosition=this.insertionPosition.toJSON(),this.graveyardPosition&&(t.graveyardPosition=this.graveyardPosition.toJSON()),t}static get className(){return"SplitOperation"}static getInsertionPosition(t){const V=t.path.slice(0,-1);return V[V.length-1]++,new Position(t.root,V,"toPrevious")}static fromJSON(t,V){const N=Position.fromJSON(t.splitPosition,V),W=Position.fromJSON(t.insertionPosition,V),K=t.graveyardPosition?Position.fromJSON(t.graveyardPosition,V):null;return new this(N,t.howMany,W,K,t.baseVersion)}}class MergeOperation extends Operation{constructor(t,V,N,W,K){super(K);ee(this,"sourcePosition");ee(this,"howMany");ee(this,"targetPosition");ee(this,"graveyardPosition");this.sourcePosition=t.clone(),this.sourcePosition.stickiness="toPrevious",this.howMany=V,this.targetPosition=N.clone(),this.targetPosition.stickiness="toNext",this.graveyardPosition=W.clone()}get type(){return"merge"}get deletionPosition(){return new Position(this.sourcePosition.root,this.sourcePosition.path.slice(0,-1))}get movedRange(){const t=this.sourcePosition.getShiftedBy(Number.POSITIVE_INFINITY);return new Range(this.sourcePosition,t)}get affectedSelectable(){const t=this.sourcePosition.parent;return[Range._createOn(t),Range._createFromPositionAndShift(this.targetPosition,0),Range._createFromPositionAndShift(this.graveyardPosition,0)]}clone(){return new MergeOperation(this.sourcePosition,this.howMany,this.targetPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const t=this.targetPosition._getTransformedByMergeOperation(this),V=this.sourcePosition.path.slice(0,-1),N=new Position(this.sourcePosition.root,V)._getTransformedByMergeOperation(this);return new SplitOperation(t,this.howMany,N,this.graveyardPosition,this.baseVersion+1)}_validate(){const t=this.sourcePosition.parent,V=this.targetPosition.parent;if(t.parent)if(V.parent){if(this.howMany!=t.maxOffset)throw new CKEditorError("merge-operation-how-many-invalid",this)}else throw new CKEditorError("merge-operation-target-position-invalid",this);else throw new CKEditorError("merge-operation-source-position-invalid",this)}_execute(){const t=this.sourcePosition.parent,V=Range._createIn(t);_move(V,this.targetPosition),_move(Range._createOn(t),this.graveyardPosition)}toJSON(){const t=super.toJSON();return t.sourcePosition=t.sourcePosition.toJSON(),t.targetPosition=t.targetPosition.toJSON(),t.graveyardPosition=t.graveyardPosition.toJSON(),t}static get className(){return"MergeOperation"}static fromJSON(t,V){const N=Position.fromJSON(t.sourcePosition,V),W=Position.fromJSON(t.targetPosition,V),K=Position.fromJSON(t.graveyardPosition,V);return new this(N,t.howMany,W,K,t.baseVersion)}}class MarkerOperation extends Operation{constructor(t,V,N,W,K,G){super(G);ee(this,"name");ee(this,"oldRange");ee(this,"newRange");ee(this,"affectsData");ee(this,"_markers");this.name=t,this.oldRange=V?V.clone():null,this.newRange=N?N.clone():null,this.affectsData=K,this._markers=W}get type(){return"marker"}get affectedSelectable(){const t=[];return this.oldRange&&t.push(this.oldRange.clone()),this.newRange&&(this.oldRange?t.push(...this.newRange.getDifference(this.oldRange)):t.push(this.newRange.clone())),t}clone(){return new MarkerOperation(this.name,this.oldRange,this.newRange,this._markers,this.affectsData,this.baseVersion)}getReversed(){return new MarkerOperation(this.name,this.newRange,this.oldRange,this._markers,this.affectsData,this.baseVersion+1)}_execute(){this.newRange?this._markers._set(this.name,this.newRange,!0,this.affectsData):this._markers._remove(this.name)}toJSON(){const t=super.toJSON();return this.oldRange&&(t.oldRange=this.oldRange.toJSON()),this.newRange&&(t.newRange=this.newRange.toJSON()),delete t._markers,t}static get className(){return"MarkerOperation"}static fromJSON(t,V){return new MarkerOperation(t.name,t.oldRange?Range.fromJSON(t.oldRange,V):null,t.newRange?Range.fromJSON(t.newRange,V):null,V.model.markers,t.affectsData,t.baseVersion)}}class AttributeOperation extends Operation{constructor(t,V,N,W,K){super(K);ee(this,"range");ee(this,"key");ee(this,"oldValue");ee(this,"newValue");this.range=t.clone(),this.key=V,this.oldValue=N===void 0?null:N,this.newValue=W===void 0?null:W}get type(){return this.oldValue===null?"addAttribute":this.newValue===null?"removeAttribute":"changeAttribute"}get affectedSelectable(){return this.range.clone()}clone(){return new AttributeOperation(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new AttributeOperation(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}toJSON(){const t=super.toJSON();return t.range=this.range.toJSON(),t}_validate(){if(!this.range.isFlat)throw new CKEditorError("attribute-operation-range-not-flat",this);for(const t of this.range.getItems({shallow:!0})){if(this.oldValue!==null&&!isEqual(t.getAttribute(this.key),this.oldValue))throw new CKEditorError("attribute-operation-wrong-old-value",this,{item:t,key:this.key,value:this.oldValue});if(this.oldValue===null&&this.newValue!==null&&t.hasAttribute(this.key))throw new CKEditorError("attribute-operation-attribute-exists",this,{node:t,key:this.key})}}_execute(){isEqual(this.oldValue,this.newValue)||_setAttribute(this.range,this.key,this.newValue)}static get className(){return"AttributeOperation"}static fromJSON(t,V){return new AttributeOperation(Range.fromJSON(t.range,V),t.key,t.oldValue,t.newValue,t.baseVersion)}}class NoOperation extends Operation{get type(){return"noop"}get affectedSelectable(){return null}clone(){return new NoOperation(this.baseVersion)}getReversed(){return new NoOperation(this.baseVersion+1)}_execute(){}static get className(){return"NoOperation"}}class RenameOperation extends Operation{constructor(t,V,N,W){super(W);ee(this,"position");ee(this,"oldName");ee(this,"newName");this.position=t,this.position.stickiness="toNext",this.oldName=V,this.newName=N}get type(){return"rename"}get affectedSelectable(){return this.position.nodeAfter}clone(){return new RenameOperation(this.position.clone(),this.oldName,this.newName,this.baseVersion)}getReversed(){return new RenameOperation(this.position.clone(),this.newName,this.oldName,this.baseVersion+1)}_validate(){const t=this.position.nodeAfter;if(t instanceof Element){if(t.name!==this.oldName)throw new CKEditorError("rename-operation-wrong-name",this)}else throw new CKEditorError("rename-operation-wrong-position",this)}_execute(){const t=this.position.nodeAfter;t.name=this.newName}toJSON(){const t=super.toJSON();return t.position=this.position.toJSON(),t}static get className(){return"RenameOperation"}static fromJSON(t,V){return new RenameOperation(Position.fromJSON(t.position,V),t.oldName,t.newName,t.baseVersion)}}class RootAttributeOperation extends Operation{constructor(t,V,N,W,K){super(K);ee(this,"root");ee(this,"key");ee(this,"oldValue");ee(this,"newValue");this.root=t,this.key=V,this.oldValue=N===void 0?null:N,this.newValue=W===void 0?null:W}get type(){return this.oldValue===null?"addRootAttribute":this.newValue===null?"removeRootAttribute":"changeRootAttribute"}get affectedSelectable(){return this.root}clone(){return new RootAttributeOperation(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new RootAttributeOperation(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}_validate(){if(this.root!=this.root.root||this.root.is("documentFragment"))throw new CKEditorError("rootattribute-operation-not-a-root",this,{root:this.root,key:this.key});if(this.oldValue!==null&&this.root.getAttribute(this.key)!==this.oldValue)throw new CKEditorError("rootattribute-operation-wrong-old-value",this,{root:this.root,key:this.key});if(this.oldValue===null&&this.newValue!==null&&this.root.hasAttribute(this.key))throw new CKEditorError("rootattribute-operation-attribute-exists",this,{root:this.root,key:this.key})}_execute(){this.newValue!==null?this.root._setAttribute(this.key,this.newValue):this.root._removeAttribute(this.key)}toJSON(){const t=super.toJSON();return t.root=this.root.toJSON(),t}static get className(){return"RootAttributeOperation"}static fromJSON(t,V){if(!V.getRoot(t.root))throw new CKEditorError("rootattribute-operation-fromjson-no-root",this,{rootName:t.root});return new RootAttributeOperation(V.getRoot(t.root),t.key,t.oldValue,t.newValue,t.baseVersion)}}class RootOperation extends Operation{constructor(t,V,N,W,K){super(K);ee(this,"rootName");ee(this,"elementName");ee(this,"isAdd");ee(this,"_document");if(this.rootName=t,this.elementName=V,this.isAdd=N,this._document=W,!this._document.getRoot(this.rootName)){const G=this._document.createRoot(this.elementName,this.rootName);G._isAttached=!1}}get type(){return this.isAdd?"addRoot":"detachRoot"}get affectedSelectable(){return this._document.getRoot(this.rootName)}clone(){return new RootOperation(this.rootName,this.elementName,this.isAdd,this._document,this.baseVersion)}getReversed(){return new RootOperation(this.rootName,this.elementName,!this.isAdd,this._document,this.baseVersion+1)}_execute(){this._document.getRoot(this.rootName)._isAttached=this.isAdd}toJSON(){const t=super.toJSON();return delete t._document,t}static get className(){return"RootOperation"}static fromJSON(t,V){return new RootOperation(t.rootName,t.elementName,t.isAdd,V,t.baseVersion)}}const operations={};operations[AttributeOperation.className]=AttributeOperation;operations[InsertOperation.className]=InsertOperation;operations[MarkerOperation.className]=MarkerOperation;operations[MoveOperation.className]=MoveOperation;operations[NoOperation.className]=NoOperation;operations[Operation.className]=Operation;operations[RenameOperation.className]=RenameOperation;operations[RootAttributeOperation.className]=RootAttributeOperation;operations[RootOperation.className]=RootOperation;operations[SplitOperation.className]=SplitOperation;operations[MergeOperation.className]=MergeOperation;class OperationFactory{static fromJSON(B,t){return operations[B.__className].fromJSON(B,t)}}const transformations=new Map;function setTransformation(H,B,t){let V=transformations.get(H);V||(V=new Map,transformations.set(H,V)),V.set(B,t)}function getTransformation(H,B){const t=transformations.get(H);return t&&t.has(B)?t.get(B):noUpdateTransformation}function noUpdateTransformation(H){return[H]}function transform$1(H,B,t={}){const V=getTransformation(H.constructor,B.constructor);try{return H=H.clone(),V(H,B,t)}catch(N){throw N}}function transformSets(H,B,t){H=H.slice(),B=B.slice();const V=new ContextFactory(t.document,t.useRelations,t.forceWeakRemove);V.setOriginalOperations(H),V.setOriginalOperations(B);const N=V.originalOperations;if(H.length==0||B.length==0)return{operationsA:H,operationsB:B,originalOperations:N};const W=new WeakMap;for(const Z of H)W.set(Z,0);const K={nextBaseVersionA:H[H.length-1].baseVersion+1,nextBaseVersionB:B[B.length-1].baseVersion+1,originalOperationsACount:H.length,originalOperationsBCount:B.length};let G=0;for(;G<H.length;){const Z=H[G],Y=W.get(Z);if(Y==B.length){G++;continue}const X=B[Y],Q=transform$1(Z,X,V.getContext(Z,X,!0)),te=transform$1(X,Z,V.getContext(X,Z,!1));V.updateRelation(Z,X),V.setOriginalOperations(Q,Z),V.setOriginalOperations(te,X);for(const ie of Q)W.set(ie,Y+te.length);H.splice(G,1,...Q),B.splice(Y,1,...te)}return handlePartialMarkerOperations(H),handlePartialMarkerOperations(B),updateBaseVersions(H,K.nextBaseVersionB),updateBaseVersions(B,K.nextBaseVersionA),{operationsA:H,operationsB:B,originalOperations:N}}class ContextFactory{constructor(B,t,V=!1){ee(this,"originalOperations");ee(this,"_history");ee(this,"_useRelations");ee(this,"_forceWeakRemove");ee(this,"_relations");this.originalOperations=new Map,this._history=B.history,this._useRelations=t,this._forceWeakRemove=!!V,this._relations=new Map}setOriginalOperations(B,t=null){const V=t?this.originalOperations.get(t):null;for(const N of B)this.originalOperations.set(N,V||N)}updateRelation(B,t){if(B instanceof MoveOperation)t instanceof MergeOperation?B.targetPosition.isEqual(t.sourcePosition)||t.movedRange.containsPosition(B.targetPosition)?this._setRelation(B,t,"insertAtSource"):B.targetPosition.isEqual(t.deletionPosition)?this._setRelation(B,t,"insertBetween"):B.targetPosition.isAfter(t.sourcePosition)&&this._setRelation(B,t,"moveTargetAfter"):t instanceof MoveOperation&&(B.targetPosition.isEqual(t.sourcePosition)||B.targetPosition.isBefore(t.sourcePosition)?this._setRelation(B,t,"insertBefore"):this._setRelation(B,t,"insertAfter"));else if(B instanceof SplitOperation){if(t instanceof MergeOperation)B.splitPosition.isBefore(t.sourcePosition)&&this._setRelation(B,t,"splitBefore");else if(t instanceof MoveOperation)if(B.splitPosition.isEqual(t.sourcePosition)||B.splitPosition.isBefore(t.sourcePosition))this._setRelation(B,t,"splitBefore");else{const V=Range._createFromPositionAndShift(t.sourcePosition,t.howMany);if(B.splitPosition.hasSameParentAs(t.sourcePosition)&&V.containsPosition(B.splitPosition)){const N=V.end.offset-B.splitPosition.offset,W=B.splitPosition.offset-V.start.offset;this._setRelation(B,t,{howMany:N,offset:W})}}}else if(B instanceof MergeOperation)t instanceof MergeOperation?(B.targetPosition.isEqual(t.sourcePosition)||this._setRelation(B,t,"mergeTargetNotMoved"),B.sourcePosition.isEqual(t.targetPosition)&&this._setRelation(B,t,"mergeSourceNotMoved"),B.sourcePosition.isEqual(t.sourcePosition)&&this._setRelation(B,t,"mergeSameElement")):t instanceof SplitOperation?B.sourcePosition.isEqual(t.splitPosition)&&this._setRelation(B,t,"splitAtSource"):t instanceof MoveOperation&&t.howMany>0&&(B.sourcePosition.isEqual(t.sourcePosition.getShiftedBy(t.howMany))&&this._setRelation(B,t,"mergeSourceAffected"),B.targetPosition.isEqual(t.sourcePosition)&&this._setRelation(B,t,"mergeTargetWasBefore"));else if(B instanceof MarkerOperation){const V=B.newRange;if(!V)return;if(t instanceof MergeOperation){const N=V.start.isEqual(t.targetPosition),W=V.start.isEqual(t.deletionPosition),K=V.end.isEqual(t.deletionPosition),G=V.end.isEqual(t.sourcePosition);(N||W||K||G)&&this._setRelation(B,t,{wasInLeftElement:N,wasStartBeforeMergedElement:W,wasEndBeforeMergedElement:K,wasInRightElement:G})}}}getContext(B,t,V){return{aIsStrong:V,aWasUndone:this._wasUndone(B),bWasUndone:this._wasUndone(t),abRelation:this._useRelations?this._getRelation(B,t):null,baRelation:this._useRelations?this._getRelation(t,B):null,forceWeakRemove:this._forceWeakRemove}}_wasUndone(B){const t=this.originalOperations.get(B);return t.wasUndone||this._history.isUndoneOperation(t)}_getRelation(B,t){const V=this.originalOperations.get(t),N=this._history.getUndoneOperation(V);if(!N)return null;const W=this.originalOperations.get(B),K=this._relations.get(W);return K&&K.get(N)||null}_setRelation(B,t,V){const N=this.originalOperations.get(B),W=this.originalOperations.get(t);let K=this._relations.get(N);K||(K=new Map,this._relations.set(N,K)),K.set(W,V)}}function updateBaseVersions(H,B){for(const t of H)t.baseVersion=B++}function handlePartialMarkerOperations(H){const B=new Map;for(let t=0;t<H.length;t++){const V=H[t];V instanceof MarkerOperation&&(V.baseVersion!==-1?B.set(V.name,{op:V,ranges:V.newRange?[V.newRange]:[]}):(V.newRange&&B.get(V.name).ranges.push(V.newRange),H.splice(t,1),t--))}for(const{op:t,ranges:V}of B.values())V.length?t.newRange=Range._createFromRanges(V):t.newRange=null}setTransformation(AttributeOperation,AttributeOperation,(H,B,t)=>{if(H.key===B.key&&H.range.start.hasSameParentAs(B.range.start)){const V=H.range.getDifference(B.range).map(W=>new AttributeOperation(W,H.key,H.oldValue,H.newValue,0)),N=H.range.getIntersection(B.range);return N&&t.aIsStrong&&V.push(new AttributeOperation(N,B.key,B.newValue,H.newValue,0)),V.length==0?[new NoOperation(0)]:V}else return[H]});setTransformation(AttributeOperation,InsertOperation,(H,B)=>{if(H.range.start.hasSameParentAs(B.position)&&H.range.containsPosition(B.position)){const V=H.range._getTransformedByInsertion(B.position,B.howMany,!B.shouldReceiveAttributes).map(N=>new AttributeOperation(N,H.key,H.oldValue,H.newValue,H.baseVersion));if(B.shouldReceiveAttributes){const N=_getComplementaryAttributeOperations(B,H.key,H.oldValue);N&&V.unshift(N)}return V}return H.range=H.range._getTransformedByInsertion(B.position,B.howMany,!1)[0],[H]});function _getComplementaryAttributeOperations(H,B,t){const N=H.nodes.getNode(0).getAttribute(B);if(N==t)return null;const W=new Range(H.position,H.position.getShiftedBy(H.howMany));return new AttributeOperation(W,B,N,t,0)}setTransformation(AttributeOperation,MergeOperation,(H,B)=>{const t=[];H.range.start.hasSameParentAs(B.deletionPosition)&&(H.range.containsPosition(B.deletionPosition)||H.range.start.isEqual(B.deletionPosition))&&t.push(Range._createFromPositionAndShift(B.graveyardPosition,1));const V=H.range._getTransformedByMergeOperation(B);return V.isCollapsed||t.push(V),t.map(N=>new AttributeOperation(N,H.key,H.oldValue,H.newValue,H.baseVersion))});setTransformation(AttributeOperation,MoveOperation,(H,B)=>_breakRangeByMoveOperation(H.range,B).map(V=>new AttributeOperation(V,H.key,H.oldValue,H.newValue,H.baseVersion)));function _breakRangeByMoveOperation(H,B){const t=Range._createFromPositionAndShift(B.sourcePosition,B.howMany);let V=null,N=[];t.containsRange(H,!0)?V=H:H.start.hasSameParentAs(t.start)?(N=H.getDifference(t),V=H.getIntersection(t)):N=[H];const W=[];for(let K of N){K=K._getTransformedByDeletion(B.sourcePosition,B.howMany);const G=B.getMovedRangeStart(),Z=K.start.hasSameParentAs(G),Y=K._getTransformedByInsertion(G,B.howMany,Z);W.push(...Y)}return V&&W.push(V._getTransformedByMove(B.sourcePosition,B.targetPosition,B.howMany,!1)[0]),W}setTransformation(AttributeOperation,SplitOperation,(H,B)=>{if(H.range.end.isEqual(B.insertionPosition))return B.graveyardPosition||H.range.end.offset++,[H];if(H.range.start.hasSameParentAs(B.splitPosition)&&H.range.containsPosition(B.splitPosition)){const t=H.clone();return t.range=new Range(B.moveTargetPosition.clone(),H.range.end._getCombined(B.splitPosition,B.moveTargetPosition)),H.range.end=B.splitPosition.clone(),H.range.end.stickiness="toPrevious",[H,t]}return H.range=H.range._getTransformedBySplitOperation(B),[H]});setTransformation(InsertOperation,AttributeOperation,(H,B)=>{const t=[H];if(H.shouldReceiveAttributes&&H.position.hasSameParentAs(B.range.start)&&B.range.containsPosition(H.position)){const V=_getComplementaryAttributeOperations(H,B.key,B.newValue);V&&t.push(V)}return t});setTransformation(InsertOperation,InsertOperation,(H,B,t)=>H.position.isEqual(B.position)&&t.aIsStrong?[H]:(H.position=H.position._getTransformedByInsertOperation(B),[H]));setTransformation(InsertOperation,MoveOperation,(H,B)=>(H.position=H.position._getTransformedByMoveOperation(B),[H]));setTransformation(InsertOperation,SplitOperation,(H,B)=>(H.position=H.position._getTransformedBySplitOperation(B),[H]));setTransformation(InsertOperation,MergeOperation,(H,B)=>(H.position=H.position._getTransformedByMergeOperation(B),[H]));setTransformation(MarkerOperation,InsertOperation,(H,B)=>(H.oldRange&&(H.oldRange=H.oldRange._getTransformedByInsertOperation(B)[0]),H.newRange&&(H.newRange=H.newRange._getTransformedByInsertOperation(B)[0]),[H]));setTransformation(MarkerOperation,MarkerOperation,(H,B,t)=>{if(H.name==B.name)if(t.aIsStrong)H.oldRange=B.newRange?B.newRange.clone():null;else return[new NoOperation(0)];return[H]});setTransformation(MarkerOperation,MergeOperation,(H,B)=>(H.oldRange&&(H.oldRange=H.oldRange._getTransformedByMergeOperation(B)),H.newRange&&(H.newRange=H.newRange._getTransformedByMergeOperation(B)),[H]));setTransformation(MarkerOperation,MoveOperation,(H,B)=>{const t=[H];if(H.oldRange&&(H.oldRange=Range._createFromRanges(H.oldRange._getTransformedByMoveOperation(B))),H.newRange){const V=H.newRange._getTransformedByMoveOperation(B);H.newRange=V[0];for(let N=1;N<V.length;N++){const W=H.clone();W.oldRange=null,W.newRange=V[N],W.baseVersion=-1,t.push(W)}}return t});setTransformation(MarkerOperation,SplitOperation,(H,B,t)=>{if(H.oldRange&&(H.oldRange=H.oldRange._getTransformedBySplitOperation(B)),H.newRange){if(t.abRelation){const V=H.newRange._getTransformedBySplitOperation(B);return H.newRange.start.isEqual(B.splitPosition)&&t.abRelation.wasStartBeforeMergedElement?H.newRange.start=Position._createAt(B.insertionPosition):H.newRange.start.isEqual(B.splitPosition)&&!t.abRelation.wasInLeftElement?H.newRange.start=Position._createAt(B.moveTargetPosition):H.newRange.start=V.start,H.newRange.end.isEqual(B.splitPosition)&&t.abRelation.wasInRightElement?H.newRange.end=Position._createAt(B.moveTargetPosition):H.newRange.end.isEqual(B.splitPosition)&&t.abRelation.wasEndBeforeMergedElement?H.newRange.end=Position._createAt(B.insertionPosition):H.newRange.end=V.end,[H]}H.newRange=H.newRange._getTransformedBySplitOperation(B)}return[H]});setTransformation(MergeOperation,InsertOperation,(H,B)=>(H.sourcePosition.hasSameParentAs(B.position)&&(H.howMany+=B.howMany),H.sourcePosition=H.sourcePosition._getTransformedByInsertOperation(B),H.targetPosition=H.targetPosition._getTransformedByInsertOperation(B),[H]));setTransformation(MergeOperation,MergeOperation,(H,B,t)=>{if(H.sourcePosition.isEqual(B.sourcePosition)&&H.targetPosition.isEqual(B.targetPosition))if(t.bWasUndone){const V=B.graveyardPosition.path.slice();return V.push(0),H.sourcePosition=new Position(B.graveyardPosition.root,V),H.howMany=0,[H]}else return[new NoOperation(0)];if(H.sourcePosition.isEqual(B.sourcePosition)&&!H.targetPosition.isEqual(B.targetPosition)&&!t.bWasUndone&&t.abRelation!="splitAtSource"){const V=H.targetPosition.root.rootName=="$graveyard",N=B.targetPosition.root.rootName=="$graveyard";if(N&&!V||!(V&&!N)&&t.aIsStrong){const Z=B.targetPosition._getTransformedByMergeOperation(B),Y=H.targetPosition._getTransformedByMergeOperation(B);return[new MoveOperation(Z,H.howMany,Y,0)]}else return[new NoOperation(0)]}return H.sourcePosition.hasSameParentAs(B.targetPosition)&&(H.howMany+=B.howMany),H.sourcePosition=H.sourcePosition._getTransformedByMergeOperation(B),H.targetPosition=H.targetPosition._getTransformedByMergeOperation(B),(!H.graveyardPosition.isEqual(B.graveyardPosition)||!t.aIsStrong)&&(H.graveyardPosition=H.graveyardPosition._getTransformedByMergeOperation(B)),[H]});setTransformation(MergeOperation,MoveOperation,(H,B,t)=>{const V=Range._createFromPositionAndShift(B.sourcePosition,B.howMany);return B.type=="remove"&&!t.bWasUndone&&H.deletionPosition.hasSameParentAs(B.sourcePosition)&&V.containsPosition(H.sourcePosition)?[new NoOperation(0)]:(B.sourcePosition.getShiftedBy(B.howMany).isEqual(H.sourcePosition)?H.sourcePosition.stickiness="toNone":B.targetPosition.isEqual(H.sourcePosition)&&t.abRelation=="mergeSourceAffected"?H.sourcePosition.stickiness="toNext":B.sourcePosition.isEqual(H.targetPosition)?(H.targetPosition.stickiness="toNone",H.howMany-=B.howMany):B.targetPosition.isEqual(H.targetPosition)&&t.abRelation=="mergeTargetWasBefore"?(H.targetPosition.stickiness="toPrevious",H.howMany+=B.howMany):(H.sourcePosition.hasSameParentAs(B.targetPosition)&&(H.howMany+=B.howMany),H.sourcePosition.hasSameParentAs(B.sourcePosition)&&(H.howMany-=B.howMany)),H.sourcePosition=H.sourcePosition._getTransformedByMoveOperation(B),H.targetPosition=H.targetPosition._getTransformedByMoveOperation(B),H.sourcePosition.stickiness="toPrevious",H.targetPosition.stickiness="toNext",H.graveyardPosition.isEqual(B.targetPosition)||(H.graveyardPosition=H.graveyardPosition._getTransformedByMoveOperation(B)),[H])});setTransformation(MergeOperation,SplitOperation,(H,B,t)=>{if(B.graveyardPosition&&(H.graveyardPosition=H.graveyardPosition._getTransformedByDeletion(B.graveyardPosition,1),H.deletionPosition.isEqual(B.graveyardPosition)&&(H.howMany=B.howMany)),H.targetPosition.isEqual(B.splitPosition)&&(B.graveyardPosition&&H.deletionPosition.isEqual(B.graveyardPosition)||t.abRelation=="mergeTargetNotMoved"))return H.sourcePosition=H.sourcePosition._getTransformedBySplitOperation(B),[H];if(H.sourcePosition.isEqual(B.splitPosition)){if(t.abRelation=="mergeSourceNotMoved")return H.howMany=0,H.targetPosition=H.targetPosition._getTransformedBySplitOperation(B),[H];if(t.abRelation=="mergeSameElement"||H.sourcePosition.offset>0)return H.sourcePosition=B.moveTargetPosition.clone(),H.targetPosition=H.targetPosition._getTransformedBySplitOperation(B),[H]}return H.sourcePosition.hasSameParentAs(B.splitPosition)&&(H.howMany=B.splitPosition.offset),H.sourcePosition=H.sourcePosition._getTransformedBySplitOperation(B),H.targetPosition=H.targetPosition._getTransformedBySplitOperation(B),[H]});setTransformation(MoveOperation,InsertOperation,(H,B)=>{const V=Range._createFromPositionAndShift(H.sourcePosition,H.howMany)._getTransformedByInsertOperation(B,!1)[0];return H.sourcePosition=V.start,H.howMany=V.end.offset-V.start.offset,H.targetPosition.isEqual(B.position)||(H.targetPosition=H.targetPosition._getTransformedByInsertOperation(B)),[H]});setTransformation(MoveOperation,MoveOperation,(H,B,t)=>{const V=Range._createFromPositionAndShift(H.sourcePosition,H.howMany),N=Range._createFromPositionAndShift(B.sourcePosition,B.howMany);let W=t.aIsStrong,K=!t.aIsStrong;t.abRelation=="insertBefore"||t.baRelation=="insertAfter"?K=!0:(t.abRelation=="insertAfter"||t.baRelation=="insertBefore")&&(K=!1);let G;if(H.targetPosition.isEqual(B.targetPosition)&&K?G=H.targetPosition._getTransformedByDeletion(B.sourcePosition,B.howMany):G=H.targetPosition._getTransformedByMove(B.sourcePosition,B.targetPosition,B.howMany),_moveTargetIntoMovedRange(H,B)&&_moveTargetIntoMovedRange(B,H))return[B.getReversed()];if(V.containsPosition(B.targetPosition)&&V.containsRange(N,!0))return V.start=V.start._getTransformedByMove(B.sourcePosition,B.targetPosition,B.howMany),V.end=V.end._getTransformedByMove(B.sourcePosition,B.targetPosition,B.howMany),_makeMoveOperationsFromRanges([V],G);if(N.containsPosition(H.targetPosition)&&N.containsRange(V,!0))return V.start=V.start._getCombined(B.sourcePosition,B.getMovedRangeStart()),V.end=V.end._getCombined(B.sourcePosition,B.getMovedRangeStart()),_makeMoveOperationsFromRanges([V],G);const X=compareArrays(H.sourcePosition.getParentPath(),B.sourcePosition.getParentPath());if(X=="prefix"||X=="extension")return V.start=V.start._getTransformedByMove(B.sourcePosition,B.targetPosition,B.howMany),V.end=V.end._getTransformedByMove(B.sourcePosition,B.targetPosition,B.howMany),_makeMoveOperationsFromRanges([V],G);H.type=="remove"&&B.type!="remove"&&!t.aWasUndone&&!t.forceWeakRemove?W=!0:H.type!="remove"&&B.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&(W=!1);const Q=[],te=V.getDifference(N);for(const ne of te){ne.start=ne.start._getTransformedByDeletion(B.sourcePosition,B.howMany),ne.end=ne.end._getTransformedByDeletion(B.sourcePosition,B.howMany);const le=compareArrays(ne.start.getParentPath(),B.getMovedRangeStart().getParentPath())=="same",ae=ne._getTransformedByInsertion(B.getMovedRangeStart(),B.howMany,le);Q.push(...ae)}const ie=V.getIntersection(N);return ie!==null&&W&&(ie.start=ie.start._getCombined(B.sourcePosition,B.getMovedRangeStart()),ie.end=ie.end._getCombined(B.sourcePosition,B.getMovedRangeStart()),Q.length===0?Q.push(ie):Q.length==1?N.start.isBefore(V.start)||N.start.isEqual(V.start)?Q.unshift(ie):Q.push(ie):Q.splice(1,0,ie)),Q.length===0?[new NoOperation(H.baseVersion)]:_makeMoveOperationsFromRanges(Q,G)});setTransformation(MoveOperation,SplitOperation,(H,B,t)=>{let V=H.targetPosition.clone();(!H.targetPosition.isEqual(B.insertionPosition)||!B.graveyardPosition||t.abRelation=="moveTargetAfter")&&(V=H.targetPosition._getTransformedBySplitOperation(B));const N=Range._createFromPositionAndShift(H.sourcePosition,H.howMany);if(N.end.isEqual(B.insertionPosition))return B.graveyardPosition||H.howMany++,H.targetPosition=V,[H];if(N.start.hasSameParentAs(B.splitPosition)&&N.containsPosition(B.splitPosition)){let G=new Range(B.splitPosition,N.end);G=G._getTransformedBySplitOperation(B);const Z=[new Range(N.start,B.splitPosition),G];return _makeMoveOperationsFromRanges(Z,V)}H.targetPosition.isEqual(B.splitPosition)&&t.abRelation=="insertAtSource"&&(V=B.moveTargetPosition),H.targetPosition.isEqual(B.insertionPosition)&&t.abRelation=="insertBetween"&&(V=H.targetPosition);const K=[N._getTransformedBySplitOperation(B)];if(B.graveyardPosition){const G=N.start.isEqual(B.graveyardPosition)||N.containsPosition(B.graveyardPosition);H.howMany>1&&G&&!t.aWasUndone&&K.push(Range._createFromPositionAndShift(B.insertionPosition,1))}return _makeMoveOperationsFromRanges(K,V)});setTransformation(MoveOperation,MergeOperation,(H,B,t)=>{const V=Range._createFromPositionAndShift(H.sourcePosition,H.howMany);if(B.deletionPosition.hasSameParentAs(H.sourcePosition)&&V.containsPosition(B.sourcePosition)){if(H.type=="remove"&&!t.forceWeakRemove){if(!t.aWasUndone){const K=[];let G=B.graveyardPosition.clone(),Z=B.targetPosition._getTransformedByMergeOperation(B);const Y=H.targetPosition.getTransformedByOperation(B);H.howMany>1&&(K.push(new MoveOperation(H.sourcePosition,H.howMany-1,Y,0)),G=G._getTransformedByMove(H.sourcePosition,Y,H.howMany-1),Z=Z._getTransformedByMove(H.sourcePosition,Y,H.howMany-1));const X=B.deletionPosition._getCombined(H.sourcePosition,Y),Q=new MoveOperation(G,1,X,0),te=Q.getMovedRangeStart().path.slice();te.push(0);const ie=new Position(Q.targetPosition.root,te);Z=Z._getTransformedByMove(G,X,1);const ne=new MoveOperation(Z,B.howMany,ie,0);return K.push(Q),K.push(ne),K}}else if(H.howMany==1)return t.bWasUndone?(H.sourcePosition=B.graveyardPosition.clone(),H.targetPosition=H.targetPosition._getTransformedByMergeOperation(B),[H]):[new NoOperation(0)]}const W=Range._createFromPositionAndShift(H.sourcePosition,H.howMany)._getTransformedByMergeOperation(B);return H.sourcePosition=W.start,H.howMany=W.end.offset-W.start.offset,H.targetPosition=H.targetPosition._getTransformedByMergeOperation(B),[H]});setTransformation(RenameOperation,InsertOperation,(H,B)=>(H.position=H.position._getTransformedByInsertOperation(B),[H]));setTransformation(RenameOperation,MergeOperation,(H,B)=>H.position.isEqual(B.deletionPosition)?(H.position=B.graveyardPosition.clone(),H.position.stickiness="toNext",[H]):(H.position=H.position._getTransformedByMergeOperation(B),[H]));setTransformation(RenameOperation,MoveOperation,(H,B)=>(H.position=H.position._getTransformedByMoveOperation(B),[H]));setTransformation(RenameOperation,RenameOperation,(H,B,t)=>{if(H.position.isEqual(B.position))if(t.aIsStrong)H.oldName=B.newName;else return[new NoOperation(0)];return[H]});setTransformation(RenameOperation,SplitOperation,(H,B)=>{const t=H.position.path,V=B.splitPosition.getParentPath();if(compareArrays(t,V)=="same"&&!B.graveyardPosition){const N=new RenameOperation(H.position.getShiftedBy(1),H.oldName,H.newName,0);return[H,N]}return H.position=H.position._getTransformedBySplitOperation(B),[H]});setTransformation(RootAttributeOperation,RootAttributeOperation,(H,B,t)=>{if(H.root===B.root&&H.key===B.key){if(!t.aIsStrong||H.newValue===B.newValue)return[new NoOperation(0)];H.oldValue=B.newValue}return[H]});setTransformation(RootOperation,RootOperation,(H,B)=>H.rootName===B.rootName&&H.isAdd===B.isAdd?[new NoOperation(0)]:[H]);setTransformation(SplitOperation,InsertOperation,(H,B)=>(H.splitPosition.hasSameParentAs(B.position)&&H.splitPosition.offset<B.position.offset&&(H.howMany+=B.howMany),H.splitPosition=H.splitPosition._getTransformedByInsertOperation(B),H.insertionPosition=H.insertionPosition._getTransformedByInsertOperation(B),[H]));setTransformation(SplitOperation,MergeOperation,(H,B,t)=>{if(!H.graveyardPosition&&!t.bWasUndone&&H.splitPosition.hasSameParentAs(B.sourcePosition)){const V=B.graveyardPosition.path.slice();V.push(0);const N=new Position(B.graveyardPosition.root,V),W=SplitOperation.getInsertionPosition(new Position(B.graveyardPosition.root,V)),K=new SplitOperation(N,0,W,null,0);return H.splitPosition=H.splitPosition._getTransformedByMergeOperation(B),H.insertionPosition=SplitOperation.getInsertionPosition(H.splitPosition),H.graveyardPosition=K.insertionPosition.clone(),H.graveyardPosition.stickiness="toNext",[K,H]}return H.splitPosition.hasSameParentAs(B.deletionPosition)&&!H.splitPosition.isAfter(B.deletionPosition)&&H.howMany--,H.splitPosition.hasSameParentAs(B.targetPosition)&&(H.howMany+=B.howMany),H.splitPosition=H.splitPosition._getTransformedByMergeOperation(B),H.insertionPosition=SplitOperation.getInsertionPosition(H.splitPosition),H.graveyardPosition&&(H.graveyardPosition=H.graveyardPosition._getTransformedByMergeOperation(B)),[H]});setTransformation(SplitOperation,MoveOperation,(H,B,t)=>{const V=Range._createFromPositionAndShift(B.sourcePosition,B.howMany);if(H.graveyardPosition){const W=V.start.isEqual(H.graveyardPosition)||V.containsPosition(H.graveyardPosition);if(!t.bWasUndone&&W){const K=H.splitPosition._getTransformedByMoveOperation(B),G=H.graveyardPosition._getTransformedByMoveOperation(B),Z=G.path.slice();Z.push(0);const Y=new Position(G.root,Z);return[new MoveOperation(K,H.howMany,Y,0)]}H.graveyardPosition=H.graveyardPosition._getTransformedByMoveOperation(B)}const N=H.splitPosition.isEqual(B.targetPosition);if(N&&(t.baRelation=="insertAtSource"||t.abRelation=="splitBefore"))return H.howMany+=B.howMany,H.splitPosition=H.splitPosition._getTransformedByDeletion(B.sourcePosition,B.howMany),H.insertionPosition=SplitOperation.getInsertionPosition(H.splitPosition),[H];if(N&&t.abRelation&&t.abRelation.howMany){const{howMany:W,offset:K}=t.abRelation;return H.howMany+=W,H.splitPosition=H.splitPosition.getShiftedBy(K),[H]}if(H.splitPosition.hasSameParentAs(B.sourcePosition)&&V.containsPosition(H.splitPosition)){const W=B.howMany-(H.splitPosition.offset-B.sourcePosition.offset);return H.howMany-=W,H.splitPosition.hasSameParentAs(B.targetPosition)&&H.splitPosition.offset<B.targetPosition.offset&&(H.howMany+=B.howMany),H.splitPosition=B.sourcePosition.clone(),H.insertionPosition=SplitOperation.getInsertionPosition(H.splitPosition),[H]}return B.sourcePosition.isEqual(B.targetPosition)||(H.splitPosition.hasSameParentAs(B.sourcePosition)&&H.splitPosition.offset<=B.sourcePosition.offset&&(H.howMany-=B.howMany),H.splitPosition.hasSameParentAs(B.targetPosition)&&H.splitPosition.offset<B.targetPosition.offset&&(H.howMany+=B.howMany)),H.splitPosition.stickiness="toNone",H.splitPosition=H.splitPosition._getTransformedByMoveOperation(B),H.splitPosition.stickiness="toNext",H.graveyardPosition?H.insertionPosition=H.insertionPosition._getTransformedByMoveOperation(B):H.insertionPosition=SplitOperation.getInsertionPosition(H.splitPosition),[H]});setTransformation(SplitOperation,SplitOperation,(H,B,t)=>{if(H.splitPosition.isEqual(B.splitPosition)){if(!H.graveyardPosition&&!B.graveyardPosition)return[new NoOperation(0)];if(H.graveyardPosition&&B.graveyardPosition&&H.graveyardPosition.isEqual(B.graveyardPosition))return[new NoOperation(0)];if(t.abRelation=="splitBefore")return H.howMany=0,H.graveyardPosition=H.graveyardPosition._getTransformedBySplitOperation(B),[H]}if(H.graveyardPosition&&B.graveyardPosition&&H.graveyardPosition.isEqual(B.graveyardPosition)){const V=H.splitPosition.root.rootName=="$graveyard",N=B.splitPosition.root.rootName=="$graveyard";if(N&&!V||!(V&&!N)&&t.aIsStrong){const Z=[];return B.howMany&&Z.push(new MoveOperation(B.moveTargetPosition,B.howMany,B.splitPosition,0)),H.howMany&&Z.push(new MoveOperation(H.splitPosition,H.howMany,H.moveTargetPosition,0)),Z}else return[new NoOperation(0)]}if(H.graveyardPosition&&(H.graveyardPosition=H.graveyardPosition._getTransformedBySplitOperation(B)),H.splitPosition.isEqual(B.insertionPosition)&&t.abRelation=="splitBefore")return H.howMany++,[H];if(B.splitPosition.isEqual(H.insertionPosition)&&t.baRelation=="splitBefore"){const V=B.insertionPosition.path.slice();V.push(0);const N=new Position(B.insertionPosition.root,V),W=new MoveOperation(H.insertionPosition,1,N,0);return[H,W]}return H.splitPosition.hasSameParentAs(B.splitPosition)&&H.splitPosition.offset<B.splitPosition.offset&&(H.howMany-=B.howMany),H.splitPosition=H.splitPosition._getTransformedBySplitOperation(B),H.insertionPosition=SplitOperation.getInsertionPosition(H.splitPosition),[H]});function _moveTargetIntoMovedRange(H,B){return H.targetPosition._getTransformedByDeletion(B.sourcePosition,B.howMany)===null}function _makeMoveOperationsFromRanges(H,B){const t=[];for(let V=0;V<H.length;V++){const N=H[V],W=new MoveOperation(N.start,N.end.offset-N.start.offset,B,0);t.push(W);for(let K=V+1;K<H.length;K++)H[K]=H[K]._getTransformedByMove(W.sourcePosition,W.targetPosition,W.howMany)[0];B=B._getTransformedByMove(W.sourcePosition,W.targetPosition,W.howMany)}return t}class LivePosition extends EmitterMixin(Position){constructor(B,t,V="toNone"){if(super(B,t,V),!this.root.is("rootElement"))throw new CKEditorError("model-liveposition-root-not-rootelement",B);bindWithDocument.call(this)}detach(){this.stopListening()}toPosition(){return new Position(this.root,this.path.slice(),this.stickiness)}static fromPosition(B,t){return new this(B.root,B.path.slice(),t||B.stickiness)}}LivePosition.prototype.is=function(H){return H==="livePosition"||H==="model:livePosition"||H=="position"||H==="model:position"};function bindWithDocument(){this.listenTo(this.root.document.model,"applyOperation",(H,B)=>{const t=B[0];t.isDocumentOperation&&transform.call(this,t)},{priority:"low"})}function transform(H){const B=this.getTransformedByOperation(H);if(!this.isEqual(B)){const t=this.toPosition();this.path=B.path,this.root=B.root,this.fire("change",t)}}class Batch{constructor(B={}){ee(this,"operations");ee(this,"isUndoable");ee(this,"isLocal");ee(this,"isUndo");ee(this,"isTyping");typeof B=="string"&&(B=B==="transparent"?{isUndoable:!1}:{},logWarning("batch-constructor-deprecated-string-type"));const{isUndoable:t=!0,isLocal:V=!0,isUndo:N=!1,isTyping:W=!1}=B;this.operations=[],this.isUndoable=t,this.isLocal=V,this.isUndo=N,this.isTyping=W}get type(){return logWarning("batch-type-deprecated"),"default"}get baseVersion(){for(const B of this.operations)if(B.baseVersion!==null)return B.baseVersion;return null}addOperation(B){return B.batch=this,this.operations.push(B),B}}const st=class st{constructor(B){ee(this,"_markerCollection");ee(this,"_changesInElement",new Map);ee(this,"_elementsSnapshots",new Map);ee(this,"_elementChildrenSnapshots",new Map);ee(this,"_elementState",new Map);ee(this,"_changedMarkers",new Map);ee(this,"_changedRoots",new Map);ee(this,"_changeCount",0);ee(this,"_cachedChanges",null);ee(this,"_cachedChangesWithGraveyard",null);ee(this,"_refreshedItems",new Set);this._markerCollection=B}get isEmpty(){return this._changesInElement.size==0&&this._changedMarkers.size==0&&this._changedRoots.size==0}bufferOperation(B){const t=B;switch(t.type){case"insert":{if(this._isInInsertedElement(t.position.parent))return;this._markInsert(t.position.parent,t.position.offset,t.nodes.maxOffset);break}case"addAttribute":case"removeAttribute":case"changeAttribute":{for(const V of t.range.getItems({shallow:!0}))this._isInInsertedElement(V.parent)||this._markAttribute(V);break}case"remove":case"move":case"reinsert":{if(t.sourcePosition.isEqual(t.targetPosition)||t.sourcePosition.getShiftedBy(t.howMany).isEqual(t.targetPosition))return;const V=this._isInInsertedElement(t.sourcePosition.parent),N=this._isInInsertedElement(t.targetPosition.parent);V||this._markRemove(t.sourcePosition.parent,t.sourcePosition.offset,t.howMany),N||this._markInsert(t.targetPosition.parent,t.getMovedRangeStart().offset,t.howMany);const W=Range._createFromPositionAndShift(t.sourcePosition,t.howMany);for(const K of W.getItems({shallow:!0}))this._setElementState(K,"move");break}case"rename":{if(this._isInInsertedElement(t.position.parent))return;this._markRemove(t.position.parent,t.position.offset,1),this._markInsert(t.position.parent,t.position.offset,1);const V=Range._createFromPositionAndShift(t.position,1);for(const N of this._markerCollection.getMarkersIntersectingRange(V)){const W=N.getData();this.bufferMarkerChange(N.name,W,W)}this._setElementState(t.position.nodeAfter,"rename");break}case"split":{const V=t.splitPosition.parent;if(!this._isInInsertedElement(V)){this._markRemove(V,t.splitPosition.offset,t.howMany);const N=Range._createFromPositionAndShift(t.splitPosition,t.howMany);for(const W of N.getItems({shallow:!0}))this._setElementState(W,"move")}this._isInInsertedElement(t.insertionPosition.parent)||this._markInsert(t.insertionPosition.parent,t.insertionPosition.offset,1),t.graveyardPosition&&(this._markRemove(t.graveyardPosition.parent,t.graveyardPosition.offset,1),this._setElementState(t.graveyardPosition.nodeAfter,"move"));break}case"merge":{const V=t.sourcePosition.parent;this._isInInsertedElement(V.parent)||this._markRemove(V.parent,V.startOffset,1);const N=t.graveyardPosition.parent;this._markInsert(N,t.graveyardPosition.offset,1),this._setElementState(V,"move");const W=t.targetPosition.parent;if(!this._isInInsertedElement(W)){this._markInsert(W,t.targetPosition.offset,V.maxOffset);const K=Range._createFromPositionAndShift(t.sourcePosition,t.howMany);for(const G of K.getItems({shallow:!0}))this._setElementState(G,"move")}break}case"detachRoot":case"addRoot":{const V=t.affectedSelectable;if(!V._isLoaded||V.isAttached()==t.isAdd)return;this._bufferRootStateChange(t.rootName,t.isAdd);break}case"addRootAttribute":case"removeRootAttribute":case"changeRootAttribute":{if(!t.root._isLoaded)return;const V=t.root.rootName;this._bufferRootAttributeChange(V,t.key,t.oldValue,t.newValue);break}}this._cachedChanges=null}bufferMarkerChange(B,t,V){t.range&&t.range.root.is("rootElement")&&!t.range.root._isLoaded&&(t.range=null),V.range&&V.range.root.is("rootElement")&&!V.range.root._isLoaded&&(V.range=null);let N=this._changedMarkers.get(B);N?N.newMarkerData=V:(N={newMarkerData:V,oldMarkerData:t},this._changedMarkers.set(B,N)),N.oldMarkerData.range==null&&V.range==null&&this._changedMarkers.delete(B)}getMarkersToRemove(){const B=[];for(const[t,V]of this._changedMarkers)V.oldMarkerData.range!=null&&B.push({name:t,range:V.oldMarkerData.range});return B}getMarkersToAdd(){const B=[];for(const[t,V]of this._changedMarkers)V.newMarkerData.range!=null&&B.push({name:t,range:V.newMarkerData.range});return B}getChangedMarkers(){return Array.from(this._changedMarkers).map(([B,t])=>({name:B,data:{oldRange:t.oldMarkerData.range,newRange:t.newMarkerData.range}}))}hasDataChanges(){if(this.getChanges().length||this._changedRoots.size>0)return!0;for(const{newMarkerData:B,oldMarkerData:t}of this._changedMarkers.values()){if(B.affectsData!==t.affectsData)return!0;if(B.affectsData){const V=B.range&&!t.range,N=!B.range&&t.range,W=B.range&&t.range&&!B.range.isEqual(t.range);if(V||N||W)return!0}}return!1}getChanges(B={}){if(this._cachedChanges)return B.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice();let t=[];for(const V of this._changesInElement.keys()){const N=this._changesInElement.get(V).sort((X,Q)=>X.offset===Q.offset?X.type!=Q.type?X.type=="remove"?-1:1:0:X.offset<Q.offset?-1:1),W=this._elementChildrenSnapshots.get(V),K=_getChildrenSnapshots(V.getChildren()),G=_generateDiffInstructionsFromChanges(W.length,N);let Z=0,Y=0;for(const X of G)if(X==="i"){const Q=this._getDiffActionForNode(K[Z].node,"insert"),te=this._elementsSnapshots.get(K[Z].node),ie=this._getInsertDiff(V,Z,Q,K[Z],te);t.push(ie),Z++}else if(X==="r"){const Q=this._getDiffActionForNode(W[Y].node,"remove"),te=this._getRemoveDiff(V,Z,Q,W[Y]);t.push(te),Y++}else if(X==="a"){const Q=W[Y].attributes,te=K[Z].attributes;let ie;if(K[Z].name=="$text")ie=new Range(Position._createAt(V,Z),Position._createAt(V,Z+1));else{const le=V.offsetToIndex(Z);ie=new Range(Position._createAt(V,Z),Position._createAt(V.getChild(le),0))}const ne=this._getAttributesDiff(ie,Q,te);t.push(...ne),Z++,Y++}else Z++,Y++}t.sort((V,N)=>V.position.root!=N.position.root?V.position.root.rootName<N.position.root.rootName?-1:1:V.position.isEqual(N.position)?V.changeCount-N.changeCount:V.position.isBefore(N.position)?-1:1);for(let V=1,N=0;V<t.length;V++){const W=t[N],K=t[V],G=W.type=="remove"&&K.type=="remove"&&W.name=="$text"&&K.name=="$text"&&W.position.isEqual(K.position),Z=W.type=="insert"&&K.type=="insert"&&W.name=="$text"&&K.name=="$text"&&W.position.parent==K.position.parent&&W.position.offset+W.length==K.position.offset,Y=W.type=="attribute"&&K.type=="attribute"&&W.position.parent==K.position.parent&&W.range.isFlat&&K.range.isFlat&&W.position.offset+W.length==K.position.offset&&W.attributeKey==K.attributeKey&&W.attributeOldValue==K.attributeOldValue&&W.attributeNewValue==K.attributeNewValue;G||Z||Y?(W.length++,Y&&(W.range.end=W.range.end.getShiftedBy(1)),t[V]=null):N=V}t=t.filter(V=>V);for(const V of t)delete V.changeCount,V.type=="attribute"&&(delete V.position,delete V.length);return this._changeCount=0,this._cachedChangesWithGraveyard=t,this._cachedChanges=t.filter(_changesInGraveyardFilter),B.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice()}getChangedRoots(){return Array.from(this._changedRoots.values()).map(B=>{const t={...B};return t.state!==void 0&&delete t.attributes,t})}getRefreshedItems(){return new Set(this._refreshedItems)}reset(){this._changesInElement.clear(),this._elementChildrenSnapshots.clear(),this._elementsSnapshots.clear(),this._elementState.clear(),this._changedMarkers.clear(),this._changedRoots.clear(),this._refreshedItems.clear(),this._cachedChanges=null}_refreshItem(B){if(this._isInInsertedElement(B.parent))return;this._markRemove(B.parent,B.startOffset,B.offsetSize),this._markInsert(B.parent,B.startOffset,B.offsetSize),this._refreshedItems.add(B),this._setElementState(B,"refresh");const t=Range._createOn(B);for(const V of this._markerCollection.getMarkersIntersectingRange(t)){const N=V.getData();this.bufferMarkerChange(V.name,N,N)}this._cachedChanges=null}_bufferRootLoad(B){if(B.isAttached()){this._bufferRootStateChange(B.rootName,!0),this._markInsert(B,0,B.maxOffset);for(const t of B.getAttributeKeys())this._bufferRootAttributeChange(B.rootName,t,null,B.getAttribute(t));for(const t of this._markerCollection)if(t.getRange().root==B){const V=t.getData();this.bufferMarkerChange(t.name,{...V,range:null},V)}}}_bufferRootStateChange(B,t){if(!this._changedRoots.has(B)){this._changedRoots.set(B,{name:B,state:t?"attached":"detached"});return}const V=this._changedRoots.get(B);V.state!==void 0?(delete V.state,V.attributes===void 0&&this._changedRoots.delete(B)):V.state=t?"attached":"detached"}_bufferRootAttributeChange(B,t,V,N){const W=this._changedRoots.get(B)||{name:B},K=W.attributes||{};if(K[t]){const G=K[t];N===G.oldValue?delete K[t]:G.newValue=N}else K[t]={oldValue:V,newValue:N};Object.entries(K).length===0?(delete W.attributes,W.state===void 0&&this._changedRoots.delete(B)):(W.attributes=K,this._changedRoots.set(B,W))}_markInsert(B,t,V){if(B.root.is("rootElement")&&!B.root._isLoaded)return;const N={type:"insert",offset:t,howMany:V,count:this._changeCount++};this._markChange(B,N)}_markRemove(B,t,V){if(B.root.is("rootElement")&&!B.root._isLoaded)return;const N={type:"remove",offset:t,howMany:V,count:this._changeCount++};this._markChange(B,N),this._removeAllNestedChanges(B,t,V)}_markAttribute(B){if(B.root.is("rootElement")&&!B.root._isLoaded)return;const t={type:"attribute",offset:B.startOffset,howMany:B.offsetSize,count:this._changeCount++};this._markChange(B.parent,t)}_markChange(B,t){this._makeSnapshots(B);const V=this._getChangesForElement(B);this._handleChange(t,V),V.push(t);for(let N=0;N<V.length;N++)V[N].howMany<1&&(V.splice(N,1),N--)}_setElementState(B,t){if(!B.is("element"))return;const V=st._statesPriority.indexOf(this._elementState.get(B));st._statesPriority.indexOf(t)>V&&this._elementState.set(B,t)}_getDiffActionForNode(B,t){if(!B.is("element")||!this._elementsSnapshots.has(B))return t;const V=this._elementState.get(B);return!V||V=="move"?t:V}_getChangesForElement(B){let t;return this._changesInElement.has(B)?t=this._changesInElement.get(B):(t=[],this._changesInElement.set(B,t)),t}_makeSnapshots(B){if(this._elementChildrenSnapshots.has(B))return;const t=_getChildrenSnapshots(B.getChildren());this._elementChildrenSnapshots.set(B,t);for(const V of t)this._elementsSnapshots.set(V.node,V)}_handleChange(B,t){B.nodesToHandle=B.howMany;for(const V of t){const N=B.offset+B.howMany,W=V.offset+V.howMany;if(B.type=="insert"&&(V.type=="insert"&&(B.offset<=V.offset?V.offset+=B.howMany:B.offset<W&&(V.howMany+=B.nodesToHandle,B.nodesToHandle=0)),V.type=="remove"&&B.offset<V.offset&&(V.offset+=B.howMany),V.type=="attribute")){if(B.offset<=V.offset)V.offset+=B.howMany;else if(B.offset<W){const K=V.howMany;V.howMany=B.offset-V.offset,t.unshift({type:"attribute",offset:N,howMany:K-V.howMany,count:this._changeCount++})}}if(B.type=="remove"){if(V.type=="insert"){if(N<=V.offset)V.offset-=B.howMany;else if(N<=W)if(B.offset<V.offset){const K=N-V.offset;V.offset=B.offset,V.howMany-=K,B.nodesToHandle-=K}else V.howMany-=B.nodesToHandle,B.nodesToHandle=0;else if(B.offset<=V.offset)B.nodesToHandle-=V.howMany,V.howMany=0;else if(B.offset<W){const K=W-B.offset;V.howMany-=K,B.nodesToHandle-=K}}if(V.type=="remove"&&(N<=V.offset?V.offset-=B.howMany:B.offset<V.offset&&(B.nodesToHandle+=V.howMany,V.howMany=0)),V.type=="attribute"){if(N<=V.offset)V.offset-=B.howMany;else if(B.offset<V.offset){const K=N-V.offset;V.offset=B.offset,V.howMany-=K}else if(B.offset<W)if(N<=W){const K=V.howMany;V.howMany=B.offset-V.offset;const G=K-V.howMany-B.nodesToHandle;t.unshift({type:"attribute",offset:B.offset,howMany:G,count:this._changeCount++})}else V.howMany-=W-B.offset}}if(B.type=="attribute"){if(V.type=="insert")if(B.offset<V.offset&&N>V.offset){if(N>W){const K={type:"attribute",offset:W,howMany:N-W,count:this._changeCount++};this._handleChange(K,t),t.push(K)}B.nodesToHandle=V.offset-B.offset,B.howMany=B.nodesToHandle}else B.offset>=V.offset&&B.offset<W&&(N>W?(B.nodesToHandle=N-W,B.offset=W):B.nodesToHandle=0);if(V.type=="remove"&&B.offset<V.offset&&N>V.offset){const K={type:"attribute",offset:V.offset,howMany:N-V.offset,count:this._changeCount++};this._handleChange(K,t),t.push(K),B.nodesToHandle=V.offset-B.offset,B.howMany=B.nodesToHandle}V.type=="attribute"&&(B.offset>=V.offset&&N<=W?(B.nodesToHandle=0,B.howMany=0,B.offset=0):B.offset<=V.offset&&N>=W&&(V.howMany=0))}}B.howMany=B.nodesToHandle,delete B.nodesToHandle}_getInsertDiff(B,t,V,N,W){const K={type:"insert",position:Position._createAt(B,t),name:N.name,attributes:new Map(N.attributes),length:1,changeCount:this._changeCount++,action:V};return V!="insert"&&W&&(K.before={name:W.name,attributes:new Map(W.attributes)}),K}_getRemoveDiff(B,t,V,N){return{type:"remove",action:V,position:Position._createAt(B,t),name:N.name,attributes:new Map(N.attributes),length:1,changeCount:this._changeCount++}}_getAttributesDiff(B,t,V){const N=[];V=new Map(V);for(const[W,K]of t){const G=V.has(W)?V.get(W):null;G!==K&&N.push({type:"attribute",position:B.start,range:B.clone(),length:1,attributeKey:W,attributeOldValue:K,attributeNewValue:G,changeCount:this._changeCount++}),V.delete(W)}for(const[W,K]of V)N.push({type:"attribute",position:B.start,range:B.clone(),length:1,attributeKey:W,attributeOldValue:null,attributeNewValue:K,changeCount:this._changeCount++});return N}_isInInsertedElement(B){const t=B.parent;if(!t)return!1;const V=this._changesInElement.get(t),N=B.startOffset;if(V){for(const W of V)if(W.type=="insert"&&N>=W.offset&&N<W.offset+W.howMany)return!0}return this._isInInsertedElement(t)}_removeAllNestedChanges(B,t,V){const N=new Range(Position._createAt(B,t),Position._createAt(B,t+V));for(const W of N.getItems({shallow:!0}))W.is("element")&&(this._changesInElement.delete(W),this._removeAllNestedChanges(W,0,W.maxOffset))}};ee(st,"_statesPriority",[void 0,"refresh","rename","move"]);let Differ=st;function _getSingleNodeSnapshot(H){return{node:H,name:H.is("$text")?"$text":H.name,attributes:new Map(H.getAttributes())}}function _getChildrenSnapshots(H){const B=[];for(const t of H)if(t.is("$text"))for(let V=0;V<t.data.length;++V)B.push(_getSingleNodeSnapshot(t));else B.push(_getSingleNodeSnapshot(t));return B}function _generateDiffInstructionsFromChanges(H,B){const t=[];let V=0,N=0;for(const W of B){if(W.offset>V){for(let K=0;K<W.offset-V;K++)t.push("e");N+=W.offset-V}if(W.type=="insert"){for(let K=0;K<W.howMany;K++)t.push("i");V=W.offset+W.howMany}else if(W.type=="remove"){for(let K=0;K<W.howMany;K++)t.push("r");V=W.offset,N+=W.howMany}else{if(W.howMany>1500)for(let K=0;K<W.howMany;K++)t.push("a");else t.push(..."a".repeat(W.howMany).split(""));V=W.offset+W.howMany,N+=W.howMany}}if(N<H)for(let W=0;W<H-N-V;W++)t.push("e");return t}function _changesInGraveyardFilter(H){const B="position"in H&&H.position.root.rootName=="$graveyard",t="range"in H&&H.range.root.rootName=="$graveyard";return!B&&!t}class History{constructor(){ee(this,"_operations",[]);ee(this,"_undoPairs",new Map);ee(this,"_undoneOperations",new Set);ee(this,"_baseVersionToOperationIndex",new Map);ee(this,"_version",0);ee(this,"_gaps",new Map)}get version(){return this._version}set version(B){this._operations.length&&B>this._version+1&&this._gaps.set(this._version,B),this._version=B}get lastOperation(){return this._operations[this._operations.length-1]}addOperation(B){if(B.baseVersion!==this.version)throw new CKEditorError("model-document-history-addoperation-incorrect-version",this,{operation:B,historyVersion:this.version});this._operations.push(B),this._version++,this._baseVersionToOperationIndex.set(B.baseVersion,this._operations.length-1)}getOperations(B,t=this.version){if(!this._operations.length)return[];const V=this._operations[0];B===void 0&&(B=V.baseVersion);let N=t-1;for(const[G,Z]of this._gaps)B>G&&B<Z&&(B=Z),N>G&&N<Z&&(N=G-1);if(N<V.baseVersion||B>this.lastOperation.baseVersion)return[];let W=this._baseVersionToOperationIndex.get(B);W===void 0&&(W=0);let K=this._baseVersionToOperationIndex.get(N);return K===void 0&&(K=this._operations.length-1),this._operations.slice(W,K+1)}getOperation(B){const t=this._baseVersionToOperationIndex.get(B);if(t!==void 0)return this._operations[t]}setOperationAsUndone(B,t){this._undoPairs.set(t,B),this._undoneOperations.add(B)}isUndoingOperation(B){return this._undoPairs.has(B)}isUndoneOperation(B){return this._undoneOperations.has(B)}getUndoneOperation(B){return this._undoPairs.get(B)}reset(){this._version=0,this._undoPairs=new Map,this._operations=[],this._undoneOperations=new Set,this._gaps=new Map,this._baseVersionToOperationIndex=new Map}}class RootElement extends Element{constructor(t,V,N="main"){super(V);ee(this,"rootName");ee(this,"_document");ee(this,"_isAttached",!0);ee(this,"_isLoaded",!0);this._document=t,this.rootName=N}get document(){return this._document}isAttached(){return this._isAttached}toJSON(){return this.rootName}}RootElement.prototype.is=function(H,B){return B?B===this.name&&(H==="rootElement"||H==="model:rootElement"||H==="element"||H==="model:element"):H==="rootElement"||H==="model:rootElement"||H==="element"||H==="model:element"||H==="node"||H==="model:node"};const graveyardName="$graveyard";class Document extends EmitterMixin(){constructor(t){super();ee(this,"model");ee(this,"history");ee(this,"selection");ee(this,"roots");ee(this,"differ");ee(this,"isReadOnly");ee(this,"_postFixers");ee(this,"_hasSelectionChangedFromTheLastChangeBlock");this.model=t,this.history=new History,this.selection=new DocumentSelection(this),this.roots=new Collection({idProperty:"rootName"}),this.differ=new Differ(t.markers),this.isReadOnly=!1,this._postFixers=new Set,this._hasSelectionChangedFromTheLastChangeBlock=!1,this.createRoot("$root",graveyardName),this.listenTo(t,"applyOperation",(V,N)=>{const W=N[0];W.isDocumentOperation&&this.differ.bufferOperation(W)},{priority:"high"}),this.listenTo(t,"applyOperation",(V,N)=>{const W=N[0];W.isDocumentOperation&&this.history.addOperation(W)},{priority:"low"}),this.listenTo(this.selection,"change",()=>{this._hasSelectionChangedFromTheLastChangeBlock=!0}),this.listenTo(t.markers,"update",(V,N,W,K,G)=>{const Z={...N.getData(),range:K};this.differ.bufferMarkerChange(N.name,G,Z),W===null&&N.on("change",(Y,X)=>{const Q=N.getData();this.differ.bufferMarkerChange(N.name,{...Q,range:X},Q)})}),this.registerPostFixer(V=>{let N=!1;for(const W of this.roots)!W.isAttached()&&!W.isEmpty&&(V.remove(V.createRangeIn(W)),N=!0);for(const W of this.model.markers)W.getRange().root.isAttached()||(V.removeMarker(W),N=!0);return N})}get version(){return this.history.version}set version(t){this.history.version=t}get graveyard(){return this.getRoot(graveyardName)}createRoot(t="$root",V="main"){if(this.roots.get(V))throw new CKEditorError("model-document-createroot-name-exists",this,{name:V});const N=new RootElement(this,t,V);return this.roots.add(N),N}destroy(){this.selection.destroy(),this.stopListening()}getRoot(t="main"){return this.roots.get(t)}getRootNames(t=!1){return this.getRoots(t).map(V=>V.rootName)}getRoots(t=!1){return this.roots.filter(V=>V!=this.graveyard&&(t||V.isAttached())&&V._isLoaded)}registerPostFixer(t){this._postFixers.add(t)}toJSON(){const t=clone$1(this);return t.selection="[engine.model.DocumentSelection]",t.model="[engine.model.Model]",t}_handleChangeBlock(t){this._hasDocumentChangedFromTheLastChangeBlock()&&(this._callPostFixers(t),this.selection.refresh(),this.differ.hasDataChanges()?this.fire("change:data",t.batch):this.fire("change",t.batch),this.selection.refresh(),this.differ.reset()),this._hasSelectionChangedFromTheLastChangeBlock=!1}_hasDocumentChangedFromTheLastChangeBlock(){return!this.differ.isEmpty||this._hasSelectionChangedFromTheLastChangeBlock}_getDefaultRoot(){const t=this.getRoots();return t.length?t[0]:this.graveyard}_getDefaultRange(){const t=this._getDefaultRoot(),V=this.model,N=V.schema,W=V.createPositionFromPath(t,[0]);return N.getNearestSelectionRange(W)||V.createRange(W)}_validateSelectionRange(t){return validateTextNodePosition(t.start)&&validateTextNodePosition(t.end)}_callPostFixers(t){let V=!1;do for(const N of this._postFixers)if(this.selection.refresh(),V=N(t),V)break;while(V)}}function validateTextNodePosition(H){const B=H.textNode;if(B){const t=B.data,V=H.offset-B.startOffset;return!isInsideSurrogatePair(t,V)&&!isInsideCombinedSymbol(t,V)}return!0}class MarkerCollection extends EmitterMixin(){constructor(){super(...arguments);ee(this,"_markers",new Map)}[Symbol.iterator](){return this._markers.values()}has(t){const V=t instanceof Marker?t.name:t;return this._markers.has(V)}get(t){return this._markers.get(t)||null}_set(t,V,N=!1,W=!1){const K=t instanceof Marker?t.name:t;if(K.includes(","))throw new CKEditorError("markercollection-incorrect-marker-name",this);const G=this._markers.get(K);if(G){const X=G.getData(),Q=G.getRange();let te=!1;return Q.isEqual(V)||(G._attachLiveRange(LiveRange.fromRange(V)),te=!0),N!=G.managedUsingOperations&&(G._managedUsingOperations=N,te=!0),typeof W=="boolean"&&W!=G.affectsData&&(G._affectsData=W,te=!0),te&&this.fire(`update:${K}`,G,Q,V,X),G}const Z=LiveRange.fromRange(V),Y=new Marker(K,Z,N,W);return this._markers.set(K,Y),this.fire(`update:${K}`,Y,null,V,{...Y.getData(),range:null}),Y}_remove(t){const V=t instanceof Marker?t.name:t,N=this._markers.get(V);return N?(this._markers.delete(V),this.fire(`update:${V}`,N,N.getRange(),null,N.getData()),this._destroyMarker(N),!0):!1}_refresh(t){const V=t instanceof Marker?t.name:t,N=this._markers.get(V);if(!N)throw new CKEditorError("markercollection-refresh-marker-not-exists",this);const W=N.getRange();this.fire(`update:${V}`,N,W,W,N.getData())}*getMarkersAtPosition(t){for(const V of this)V.getRange().containsPosition(t)&&(yield V)}*getMarkersIntersectingRange(t){for(const V of this)V.getRange().getIntersection(t)!==null&&(yield V)}destroy(){for(const t of this._markers.values())this._destroyMarker(t);this._markers=null,this.stopListening()}*getMarkersGroup(t){for(const V of this._markers.values())V.name.startsWith(t+":")&&(yield V)}_destroyMarker(t){t.stopListening(),t._detachLiveRange()}}class Marker extends EmitterMixin(TypeCheckable){constructor(t,V,N,W){super();ee(this,"name");ee(this,"_managedUsingOperations");ee(this,"_affectsData");ee(this,"_liveRange");this.name=t,this._liveRange=this._attachLiveRange(V),this._managedUsingOperations=N,this._affectsData=W}get managedUsingOperations(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._managedUsingOperations}get affectsData(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._affectsData}getData(){return{range:this.getRange(),affectsData:this.affectsData,managedUsingOperations:this.managedUsingOperations}}getStart(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._liveRange.start.clone()}getEnd(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._liveRange.end.clone()}getRange(){if(!this._liveRange)throw new CKEditorError("marker-destroyed",this);return this._liveRange.toRange()}_attachLiveRange(t){return this._liveRange&&this._detachLiveRange(),t.delegate("change:range").to(this),t.delegate("change:content").to(this),this._liveRange=t,t}_detachLiveRange(){this._liveRange.stopDelegating("change:range",this),this._liveRange.stopDelegating("change:content",this),this._liveRange.detach(),this._liveRange=null}}Marker.prototype.is=function(H){return H==="marker"||H==="model:marker"};class DetachOperation extends Operation{constructor(t,V){super(null);ee(this,"sourcePosition");ee(this,"howMany");this.sourcePosition=t.clone(),this.howMany=V}get type(){return"detach"}get affectedSelectable(){return null}toJSON(){const t=super.toJSON();return t.sourcePosition=this.sourcePosition.toJSON(),t}_validate(){if(this.sourcePosition.root.document)throw new CKEditorError("detach-operation-on-document-node",this)}_execute(){_remove(Range._createFromPositionAndShift(this.sourcePosition,this.howMany))}static get className(){return"DetachOperation"}}class DocumentFragment extends TypeCheckable{constructor(t){super();ee(this,"markers",new Map);ee(this,"_children",new NodeList);t&&this._insertChild(0,t)}[Symbol.iterator](){return this.getChildren()}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}get nextSibling(){return null}get previousSibling(){return null}get root(){return this}get parent(){return null}get document(){return null}isAttached(){return!1}getAncestors(){return[]}getChild(t){return this._children.getNode(t)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(t){return this._children.getNodeIndex(t)}getChildStartOffset(t){return this._children.getNodeStartOffset(t)}getPath(){return[]}getNodeByPath(t){let V=this;for(const N of t)V=V.getChild(V.offsetToIndex(N));return V}offsetToIndex(t){return this._children.offsetToIndex(t)}toJSON(){const t=[];for(const V of this._children)t.push(V.toJSON());return t}static fromJSON(t){const V=[];for(const N of t)N.name?V.push(Element.fromJSON(N)):V.push(Text.fromJSON(N));return new DocumentFragment(V)}_appendChild(t){this._insertChild(this.childCount,t)}_insertChild(t,V){const N=normalize$4(V);for(const W of N)W.parent!==null&&W._remove(),W.parent=this;this._children._insertNodes(t,N)}_removeChildren(t,V=1){const N=this._children._removeNodes(t,V);for(const W of N)W.parent=null;return N}}DocumentFragment.prototype.is=function(H){return H==="documentFragment"||H==="model:documentFragment"};function normalize$4(H){return typeof H=="string"?[new Text(H)]:(isIterable(H)||(H=[H]),Array.from(H).map(B=>typeof B=="string"?new Text(B):B instanceof TextProxy?new Text(B.data,B.getAttributes()):B))}let Writer$2=class{constructor(B,t){ee(this,"model");ee(this,"batch");this.model=B,this.batch=t}createText(B,t){return new Text(B,t)}createElement(B,t){return new Element(B,t)}createDocumentFragment(){return new DocumentFragment}cloneElement(B,t=!0){return B._clone(t)}insert(B,t,V=0){if(this._assertWriterUsedCorrectly(),B instanceof Text&&B.data=="")return;const N=Position._createAt(t,V);if(B.parent)if(isSameTree(B.root,N.root)){this.move(Range._createOn(B),N);return}else{if(B.root.document)throw new CKEditorError("model-writer-insert-forbidden-move",this);this.remove(B)}const W=N.root.document?N.root.document.version:null,K=new InsertOperation(N,B,W);if(B instanceof Text&&(K.shouldReceiveAttributes=!0),this.batch.addOperation(K),this.model.applyOperation(K),B instanceof DocumentFragment)for(const[G,Z]of B.markers){const Y=Position._createAt(Z.root,0),Q={range:new Range(Z.start._getCombined(Y,N),Z.end._getCombined(Y,N)),usingOperation:!0,affectsData:!0};this.model.markers.has(G)?this.updateMarker(G,Q):this.addMarker(G,Q)}}insertText(B,t,V,N){t instanceof DocumentFragment||t instanceof Element||t instanceof Position?this.insert(this.createText(B),t,V):this.insert(this.createText(B,t),V,N)}insertElement(B,t,V,N){t instanceof DocumentFragment||t instanceof Element||t instanceof Position?this.insert(this.createElement(B),t,V):this.insert(this.createElement(B,t),V,N)}append(B,t){this.insert(B,t,"end")}appendText(B,t,V){t instanceof DocumentFragment||t instanceof Element?this.insert(this.createText(B),t,"end"):this.insert(this.createText(B,t),V,"end")}appendElement(B,t,V){t instanceof DocumentFragment||t instanceof Element?this.insert(this.createElement(B),t,"end"):this.insert(this.createElement(B,t),V,"end")}setAttribute(B,t,V){if(this._assertWriterUsedCorrectly(),V instanceof Range){const N=V.getMinimalFlatRanges();for(const W of N)setAttributeOnRange(this,B,t,W)}else setAttributeOnItem(this,B,t,V)}setAttributes(B,t){for(const[V,N]of toMap(B))this.setAttribute(V,N,t)}removeAttribute(B,t){if(this._assertWriterUsedCorrectly(),t instanceof Range){const V=t.getMinimalFlatRanges();for(const N of V)setAttributeOnRange(this,B,null,N)}else setAttributeOnItem(this,B,null,t)}clearAttributes(B){this._assertWriterUsedCorrectly();const t=V=>{for(const N of V.getAttributeKeys())this.removeAttribute(N,V)};if(!(B instanceof Range))t(B);else for(const V of B.getItems())t(V)}move(B,t,V){if(this._assertWriterUsedCorrectly(),!(B instanceof Range))throw new CKEditorError("writer-move-invalid-range",this);if(!B.isFlat)throw new CKEditorError("writer-move-range-not-flat",this);const N=Position._createAt(t,V);if(N.isEqual(B.start))return;if(this._addOperationForAffectedMarkers("move",B),!isSameTree(B.root,N.root))throw new CKEditorError("writer-move-different-document",this);const W=B.root.document?B.root.document.version:null,K=new MoveOperation(B.start,B.end.offset-B.start.offset,N,W);this.batch.addOperation(K),this.model.applyOperation(K)}remove(B){this._assertWriterUsedCorrectly();const V=(B instanceof Range?B:Range._createOn(B)).getMinimalFlatRanges().reverse();for(const N of V)this._addOperationForAffectedMarkers("move",N),applyRemoveOperation(N.start,N.end.offset-N.start.offset,this.batch,this.model)}merge(B){this._assertWriterUsedCorrectly();const t=B.nodeBefore,V=B.nodeAfter;if(this._addOperationForAffectedMarkers("merge",B),!(t instanceof Element))throw new CKEditorError("writer-merge-no-element-before",this);if(!(V instanceof Element))throw new CKEditorError("writer-merge-no-element-after",this);B.root.document?this._merge(B):this._mergeDetached(B)}createPositionFromPath(B,t,V){return this.model.createPositionFromPath(B,t,V)}createPositionAt(B,t){return this.model.createPositionAt(B,t)}createPositionAfter(B){return this.model.createPositionAfter(B)}createPositionBefore(B){return this.model.createPositionBefore(B)}createRange(B,t){return this.model.createRange(B,t)}createRangeIn(B){return this.model.createRangeIn(B)}createRangeOn(B){return this.model.createRangeOn(B)}createSelection(...B){return this.model.createSelection(...B)}_mergeDetached(B){const t=B.nodeBefore,V=B.nodeAfter;this.move(Range._createIn(V),Position._createAt(t,"end")),this.remove(V)}_merge(B){const t=Position._createAt(B.nodeBefore,"end"),V=Position._createAt(B.nodeAfter,0),N=B.root.document.graveyard,W=new Position(N,[0]),K=B.root.document.version,G=new MergeOperation(V,B.nodeAfter.maxOffset,t,W,K);this.batch.addOperation(G),this.model.applyOperation(G)}rename(B,t){if(this._assertWriterUsedCorrectly(),!(B instanceof Element))throw new CKEditorError("writer-rename-not-element-instance",this);const V=B.root.document?B.root.document.version:null,N=new RenameOperation(Position._createBefore(B),B.name,t,V);this.batch.addOperation(N),this.model.applyOperation(N)}split(B,t){this._assertWriterUsedCorrectly();let V=B.parent;if(!V.parent)throw new CKEditorError("writer-split-element-no-parent",this);if(t||(t=V.parent),!B.parent.getAncestors({includeSelf:!0}).includes(t))throw new CKEditorError("writer-split-invalid-limit-element",this);let N,W;do{const K=V.root.document?V.root.document.version:null,G=V.maxOffset-B.offset,Z=SplitOperation.getInsertionPosition(B),Y=new SplitOperation(B,G,Z,null,K);this.batch.addOperation(Y),this.model.applyOperation(Y),!N&&!W&&(N=V,W=B.parent.nextSibling),B=this.createPositionAfter(B.parent),V=B.parent}while(V!==t);return{position:B,range:new Range(Position._createAt(N,"end"),Position._createAt(W,0))}}wrap(B,t){if(this._assertWriterUsedCorrectly(),!B.isFlat)throw new CKEditorError("writer-wrap-range-not-flat",this);const V=t instanceof Element?t:new Element(t);if(V.childCount>0)throw new CKEditorError("writer-wrap-element-not-empty",this);if(V.parent!==null)throw new CKEditorError("writer-wrap-element-attached",this);this.insert(V,B.start);const N=new Range(B.start.getShiftedBy(1),B.end.getShiftedBy(1));this.move(N,Position._createAt(V,0))}unwrap(B){if(this._assertWriterUsedCorrectly(),B.parent===null)throw new CKEditorError("writer-unwrap-element-no-parent",this);this.move(Range._createIn(B),this.createPositionAfter(B)),this.remove(B)}addMarker(B,t){if(this._assertWriterUsedCorrectly(),!t||typeof t.usingOperation!="boolean")throw new CKEditorError("writer-addmarker-no-usingoperation",this);const V=t.usingOperation,N=t.range,W=t.affectsData===void 0?!1:t.affectsData;if(this.model.markers.has(B))throw new CKEditorError("writer-addmarker-marker-exists",this);if(!N)throw new CKEditorError("writer-addmarker-no-range",this);return V?(applyMarkerOperation(this,B,null,N,W),this.model.markers.get(B)):this.model.markers._set(B,N,V,W)}updateMarker(B,t){this._assertWriterUsedCorrectly();const V=typeof B=="string"?B:B.name,N=this.model.markers.get(V);if(!N)throw new CKEditorError("writer-updatemarker-marker-not-exists",this);if(!t){logWarning("writer-updatemarker-reconvert-using-editingcontroller",{markerName:V}),this.model.markers._refresh(N);return}const W=typeof t.usingOperation=="boolean",K=typeof t.affectsData=="boolean",G=K?t.affectsData:N.affectsData;if(!W&&!t.range&&!K)throw new CKEditorError("writer-updatemarker-wrong-options",this);const Z=N.getRange(),Y=t.range?t.range:Z;if(W&&t.usingOperation!==N.managedUsingOperations){t.usingOperation?applyMarkerOperation(this,V,null,Y,G):(applyMarkerOperation(this,V,Z,null,G),this.model.markers._set(V,Y,void 0,G));return}N.managedUsingOperations?applyMarkerOperation(this,V,Z,Y,G):this.model.markers._set(V,Y,void 0,G)}removeMarker(B){this._assertWriterUsedCorrectly();const t=typeof B=="string"?B:B.name;if(!this.model.markers.has(t))throw new CKEditorError("writer-removemarker-no-marker",this);const V=this.model.markers.get(t);if(!V.managedUsingOperations){this.model.markers._remove(t);return}const N=V.getRange();applyMarkerOperation(this,t,N,null,V.affectsData)}addRoot(B,t="$root"){this._assertWriterUsedCorrectly();const V=this.model.document.getRoot(B);if(V&&V.isAttached())throw new CKEditorError("writer-addroot-root-exists",this);const N=this.model.document,W=new RootOperation(B,t,!0,N,N.version);return this.batch.addOperation(W),this.model.applyOperation(W),this.model.document.getRoot(B)}detachRoot(B){this._assertWriterUsedCorrectly();const t=typeof B=="string"?this.model.document.getRoot(B):B;if(!t||!t.isAttached())throw new CKEditorError("writer-detachroot-no-root",this);for(const W of this.model.markers)W.getRange().root===t&&this.removeMarker(W);for(const W of t.getAttributeKeys())this.removeAttribute(W,t);this.remove(this.createRangeIn(t));const V=this.model.document,N=new RootOperation(t.rootName,t.name,!1,V,V.version);this.batch.addOperation(N),this.model.applyOperation(N)}setSelection(...B){this._assertWriterUsedCorrectly(),this.model.document.selection._setTo(...B)}setSelectionFocus(B,t){this._assertWriterUsedCorrectly(),this.model.document.selection._setFocus(B,t)}setSelectionAttribute(B,t){if(this._assertWriterUsedCorrectly(),typeof B=="string")this._setSelectionAttribute(B,t);else for(const[V,N]of toMap(B))this._setSelectionAttribute(V,N)}removeSelectionAttribute(B){if(this._assertWriterUsedCorrectly(),typeof B=="string")this._removeSelectionAttribute(B);else for(const t of B)this._removeSelectionAttribute(t)}overrideSelectionGravity(){return this.model.document.selection._overrideGravity()}restoreSelectionGravity(B){this.model.document.selection._restoreGravity(B)}_setSelectionAttribute(B,t){const V=this.model.document.selection;if(V.isCollapsed&&V.anchor.parent.isEmpty){const N=DocumentSelection._getStoreAttributeKey(B);this.setAttribute(N,t,V.anchor.parent)}V._setAttribute(B,t)}_removeSelectionAttribute(B){const t=this.model.document.selection;if(t.isCollapsed&&t.anchor.parent.isEmpty){const V=DocumentSelection._getStoreAttributeKey(B);this.removeAttribute(V,t.anchor.parent)}t._removeAttribute(B)}_assertWriterUsedCorrectly(){if(this.model._currentWriter!==this)throw new CKEditorError("writer-incorrect-use",this)}_addOperationForAffectedMarkers(B,t){for(const V of this.model.markers){if(!V.managedUsingOperations)continue;const N=V.getRange();let W=!1;if(B==="move"){const K=t;W=K.containsPosition(N.start)||K.start.isEqual(N.start)||K.containsPosition(N.end)||K.end.isEqual(N.end)}else{const K=t,G=K.nodeBefore,Z=K.nodeAfter,Y=N.start.parent==G&&N.start.isAtEnd,X=N.end.parent==Z&&N.end.offset==0,Q=N.end.nodeAfter==Z,te=N.start.nodeAfter==Z;W=Y||X||Q||te}W&&this.updateMarker(V.name,{range:N})}}};function setAttributeOnRange(H,B,t,V){const N=H.model,W=N.document;let K=V.start,G,Z,Y;for(const Q of V.getWalker({shallow:!0}))Y=Q.item.getAttribute(B),G&&Z!=Y&&(Z!=t&&X(),K=G),G=Q.nextPosition,Z=Y;G instanceof Position&&G!=K&&Z!=t&&X();function X(){const Q=new Range(K,G),te=Q.root.document?W.version:null,ie=new AttributeOperation(Q,B,Z,t,te);H.batch.addOperation(ie),N.applyOperation(ie)}}function setAttributeOnItem(H,B,t,V){const N=H.model,W=N.document,K=V.getAttribute(B);let G,Z;if(K!=t){if(V.root===V){const X=V.document?W.version:null;Z=new RootAttributeOperation(V,B,K,t,X)}else{G=new Range(Position._createBefore(V),H.createPositionAfter(V));const X=G.root.document?W.version:null;Z=new AttributeOperation(G,B,K,t,X)}H.batch.addOperation(Z),N.applyOperation(Z)}}function applyMarkerOperation(H,B,t,V,N){const W=H.model,K=W.document,G=new MarkerOperation(B,t,V,W.markers,!!N,K.version);H.batch.addOperation(G),W.applyOperation(G)}function applyRemoveOperation(H,B,t,V){let N;if(H.root.document){const W=V.document,K=new Position(W.graveyard,[0]);N=new MoveOperation(H,B,K,W.version)}else N=new DetachOperation(H,B);t.addOperation(N),V.applyOperation(N)}function isSameTree(H,B){return H===B||H instanceof RootElement&&B instanceof RootElement}function deleteContent(H,B,t={}){if(B.isCollapsed)return;const V=B.getFirstRange();if(V.root.rootName=="$graveyard")return;const N=H.schema;H.change(W=>{if(!t.doNotResetEntireContent&&shouldEntireContentBeReplacedWithParagraph(N,B)){replaceEntireContentWithParagraph(W,B);return}const K={};if(!t.doNotAutoparagraph){const Y=B.getSelectedElement();Y&&Object.assign(K,N.getAttributesWithProperty(Y,"copyOnReplace",!0))}const[G,Z]=getLivePositionsForSelectedBlocks(V);G.isTouching(Z)||W.remove(W.createRange(G,Z)),t.leaveUnmerged||(mergeBranches(W,G,Z),N.removeDisallowedAttributes(G.parent.getChildren(),W)),collapseSelectionAt(W,B,G),!t.doNotAutoparagraph&&shouldAutoparagraph(N,G)&&insertParagraph(W,G,B,K),G.detach(),Z.detach()})}function getLivePositionsForSelectedBlocks(H){const B=H.root.document.model,t=H.start;let V=H.end;if(B.hasContent(H,{ignoreMarkers:!0})){const N=getParentBlock(V);if(N&&V.isTouching(B.createPositionAt(N,0))){const W=B.createSelection(H);B.modifySelection(W,{direction:"backward"});const K=W.getLastPosition(),G=B.createRange(K,V);B.hasContent(G,{ignoreMarkers:!0})||(V=K)}}return[LivePosition.fromPosition(t,"toPrevious"),LivePosition.fromPosition(V,"toNext")]}function getParentBlock(H){const B=H.parent,t=B.root.document.model.schema,V=B.getAncestors({parentFirst:!0,includeSelf:!0});for(const N of V){if(t.isLimit(N))return null;if(t.isBlock(N))return N}}function mergeBranches(H,B,t){const V=H.model;if(!checkShouldMerge(H.model.schema,B,t))return;const[N,W]=getAncestorsJustBelowCommonAncestor(B,t);!N||!W||(!V.hasContent(N,{ignoreMarkers:!0})&&V.hasContent(W,{ignoreMarkers:!0})?mergeBranchesRight(H,B,t,N.parent):mergeBranchesLeft(H,B,t,N.parent))}function mergeBranchesLeft(H,B,t,V){const N=B.parent,W=t.parent;if(!(N==V||W==V)){for(B=H.createPositionAfter(N),t=H.createPositionBefore(W),t.isEqual(B)||H.insert(W,B),H.merge(B);t.parent.isEmpty;){const K=t.parent;t=H.createPositionBefore(K),H.remove(K)}checkShouldMerge(H.model.schema,B,t)&&mergeBranchesLeft(H,B,t,V)}}function mergeBranchesRight(H,B,t,V){const N=B.parent,W=t.parent;if(!(N==V||W==V)){for(B=H.createPositionAfter(N),t=H.createPositionBefore(W),t.isEqual(B)||H.insert(N,t);B.parent.isEmpty;){const K=B.parent;B=H.createPositionBefore(K),H.remove(K)}t=H.createPositionBefore(W),mergeRight(H,t),checkShouldMerge(H.model.schema,B,t)&&mergeBranchesRight(H,B,t,V)}}function mergeRight(H,B){const t=B.nodeBefore,V=B.nodeAfter;t.name!=V.name&&H.rename(t,V.name),H.clearAttributes(t),H.setAttributes(Object.fromEntries(V.getAttributes()),t),H.merge(B)}function checkShouldMerge(H,B,t){const V=B.parent,N=t.parent;return V==N||H.isLimit(V)||H.isLimit(N)?!1:isCrossingLimitElement(B,t,H)}function getAncestorsJustBelowCommonAncestor(H,B){const t=H.getAncestors(),V=B.getAncestors();let N=0;for(;t[N]&&t[N]==V[N];)N++;return[t[N],V[N]]}function shouldAutoparagraph(H,B){const t=H.checkChild(B,"$text"),V=H.checkChild(B,"paragraph");return!t&&V}function isCrossingLimitElement(H,B,t){const V=new Range(H,B);for(const N of V.getWalker())if(t.isLimit(N.item))return!1;return!0}function insertParagraph(H,B,t,V={}){const N=H.createElement("paragraph");H.model.schema.setAllowedAttributes(N,V,H),H.insert(N,B),collapseSelectionAt(H,t,H.createPositionAt(N,0))}function replaceEntireContentWithParagraph(H,B){const t=H.model.schema.getLimitElement(B);H.remove(H.createRangeIn(t)),insertParagraph(H,H.createPositionAt(t,0),B)}function shouldEntireContentBeReplacedWithParagraph(H,B){const t=H.getLimitElement(B);if(!B.containsEntireContent(t))return!1;const V=B.getFirstRange();return V.start.parent==V.end.parent?!1:H.checkChild(t,"paragraph")}function collapseSelectionAt(H,B,t){B instanceof DocumentSelection?H.setSelection(t):B.setTo(t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getSelectedContent(H,B){return H.change(t=>{const V=t.createDocumentFragment(),N=B.getFirstRange();if(!N||N.isCollapsed)return V;const W=N.start.root,K=N.start.getCommonPath(N.end),G=W.getNodeByPath(K);let Z;N.start.parent==N.end.parent?Z=N:Z=t.createRange(t.createPositionAt(G,N.start.path[K.length]),t.createPositionAt(G,N.end.path[K.length]+1));const Y=Z.end.offset-Z.start.offset;for(const X of Z.getItems({shallow:!0}))X.is("$textProxy")?t.appendText(X.data,X.getAttributes(),V):t.append(t.cloneElement(X,!0),V);if(Z!=N){const X=N._getTransformedByMove(Z.start,t.createPositionAt(V,0),Y)[0],Q=t.createRange(t.createPositionAt(V,0),X.start),te=t.createRange(X.end,t.createPositionAt(V,"end"));removeRangeContent(te,t),removeRangeContent(Q,t)}return V})}function removeRangeContent(H,B){const t=[];Array.from(H.getItems({direction:"backward"})).map(V=>B.createRangeOn(V)).filter(V=>(V.start.isAfter(H.start)||V.start.isEqual(H.start))&&(V.end.isBefore(H.end)||V.end.isEqual(H.end))).forEach(V=>{t.push(V.start.parent),B.remove(V)}),t.forEach(V=>{let N=V;for(;N.parent&&N.isEmpty;){const W=B.createRangeOn(N);N=N.parent,B.remove(W)}})}function insertContent(H,B,t){return H.change(V=>{const N=t||H.document.selection;N.isCollapsed||H.deleteContent(N,{doNotAutoparagraph:!0});const W=new Insertion(H,V,N.anchor),K=[];let G;if(B.is("documentFragment")){if(B.markers.size){const X=[];for(const[Q,te]of B.markers){const{start:ie,end:ne}=te,le=ie.isEqual(ne);X.push({position:ie,name:Q,isCollapsed:le},{position:ne,name:Q,isCollapsed:le})}X.sort(({position:Q},{position:te})=>Q.isBefore(te)?1:-1);for(const{position:Q,name:te,isCollapsed:ie}of X){let ne=null,le=null;const ae=Q.parent===B&&Q.isAtStart,de=Q.parent===B&&Q.isAtEnd;!ae&&!de?(ne=V.createElement("$marker"),V.insert(ne,Q)):ie&&(le=ae?"start":"end"),K.push({name:te,element:ne,collapsed:le})}}G=B.getChildren()}else G=[B];W.handleNodes(G);let Z=W.getSelectionRange();if(B.is("documentFragment")&&K.length){const X=Z?LiveRange.fromRange(Z):null,Q={};for(let te=K.length-1;te>=0;te--){const{name:ie,element:ne,collapsed:le}=K[te],ae=!Q[ie];if(ae&&(Q[ie]=[]),ne){const de=V.createPositionAt(ne,"before");Q[ie].push(de),V.remove(ne)}else{const de=W.getAffectedRange();if(!de){le&&Q[ie].push(W.position);continue}le?Q[ie].push(de[le]):Q[ie].push(ae?de.start:de.end)}}for(const[te,[ie,ne]]of Object.entries(Q))ie&&ne&&ie.root===ne.root&&ie.root.document&&!V.model.markers.has(te)&&V.addMarker(te,{usingOperation:!0,affectsData:!0,range:new Range(ie,ne)});X&&(Z=X.toRange(),X.detach())}/* istanbul ignore else -- @preserve */Z&&(N instanceof DocumentSelection?V.setSelection(Z):N.setTo(Z));const Y=W.getAffectedRange()||H.createRange(N.anchor);return W.destroy(),Y})}class Insertion{constructor(B,t,V){ee(this,"model");ee(this,"writer");ee(this,"position");ee(this,"canMergeWith");ee(this,"schema");ee(this,"_documentFragment");ee(this,"_documentFragmentPosition");ee(this,"_firstNode",null);ee(this,"_lastNode",null);ee(this,"_lastAutoParagraph",null);ee(this,"_filterAttributesOf",[]);ee(this,"_affectedStart",null);ee(this,"_affectedEnd",null);ee(this,"_nodeToSelect",null);this.model=B,this.writer=t,this.position=V,this.canMergeWith=new Set([this.position.parent]),this.schema=B.schema,this._documentFragment=t.createDocumentFragment(),this._documentFragmentPosition=t.createPositionAt(this._documentFragment,0)}handleNodes(B){for(const t of Array.from(B))this._handleNode(t);this._insertPartialFragment(),this._lastAutoParagraph&&this._updateLastNodeFromAutoParagraph(this._lastAutoParagraph),this._mergeOnRight(),this.schema.removeDisallowedAttributes(this._filterAttributesOf,this.writer),this._filterAttributesOf=[]}_updateLastNodeFromAutoParagraph(B){const t=this.writer.createPositionAfter(this._lastNode),V=this.writer.createPositionAfter(B);if(V.isAfter(t)){this._lastNode=B;/* istanbul ignore if -- @preserve */if(this.position.parent!=B||!this.position.isAtEnd)throw new CKEditorError("insertcontent-invalid-insertion-position",this);this.position=V,this._setAffectedBoundaries(this.position)}}getSelectionRange(){return this._nodeToSelect?Range._createOn(this._nodeToSelect):this.model.schema.getNearestSelectionRange(this.position)}getAffectedRange(){return this._affectedStart?new Range(this._affectedStart,this._affectedEnd):null}destroy(){this._affectedStart&&this._affectedStart.detach(),this._affectedEnd&&this._affectedEnd.detach()}_handleNode(B){if(!this._checkAndSplitToAllowedPosition(B)){this.schema.isObject(B)||this._handleDisallowedNode(B);return}this._appendToFragment(B),this._firstNode||(this._firstNode=B),this._lastNode=B}_insertPartialFragment(){if(this._documentFragment.isEmpty)return;const B=LivePosition.fromPosition(this.position,"toNext");this._setAffectedBoundaries(this.position),this._documentFragment.getChild(0)==this._firstNode&&(this.writer.insert(this._firstNode,this.position),this._mergeOnLeft(),this.position=B.toPosition()),this._documentFragment.isEmpty||this.writer.insert(this._documentFragment,this.position),this._documentFragmentPosition=this.writer.createPositionAt(this._documentFragment,0),this.position=B.toPosition(),B.detach()}_handleDisallowedNode(B){B.is("element")&&this.handleNodes(B.getChildren())}_appendToFragment(B){/* istanbul ignore if -- @preserve */if(!this.schema.checkChild(this.position,B))throw new CKEditorError("insertcontent-wrong-position",this,{node:B,position:this.position});this.writer.insert(B,this._documentFragmentPosition),this._documentFragmentPosition=this._documentFragmentPosition.getShiftedBy(B.offsetSize),this.schema.isObject(B)&&!this.schema.checkChild(this.position,"$text")?this._nodeToSelect=B:this._nodeToSelect=null,this._filterAttributesOf.push(B)}_setAffectedBoundaries(B){this._affectedStart||(this._affectedStart=LivePosition.fromPosition(B,"toPrevious")),(!this._affectedEnd||this._affectedEnd.isBefore(B))&&(this._affectedEnd&&this._affectedEnd.detach(),this._affectedEnd=LivePosition.fromPosition(B,"toNext"))}_mergeOnLeft(){const B=this._firstNode;if(!(B instanceof Element)||!this._canMergeLeft(B))return;const t=LivePosition._createBefore(B);t.stickiness="toNext";const V=LivePosition.fromPosition(this.position,"toNext");this._affectedStart.isEqual(t)&&(this._affectedStart.detach(),this._affectedStart=LivePosition._createAt(t.nodeBefore,"end","toPrevious")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.isEqual(this._affectedEnd)&&this._firstNode===this._lastNode&&(this._affectedEnd.detach(),this._affectedEnd=LivePosition._createAt(t.nodeBefore,"end","toNext")),this.position=V.toPosition(),V.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_mergeOnRight(){const B=this._lastNode;if(!(B instanceof Element)||!this._canMergeRight(B))return;const t=LivePosition._createAfter(B);t.stickiness="toNext";/* istanbul ignore if -- @preserve */if(!this.position.isEqual(t))throw new CKEditorError("insertcontent-invalid-insertion-position",this);this.position=Position._createAt(t.nodeBefore,"end");const V=LivePosition.fromPosition(this.position,"toPrevious");this._affectedEnd.isEqual(t)&&(this._affectedEnd.detach(),this._affectedEnd=LivePosition._createAt(t.nodeBefore,"end","toNext")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.getShiftedBy(-1).isEqual(this._affectedStart)&&this._firstNode===this._lastNode&&(this._affectedStart.detach(),this._affectedStart=LivePosition._createAt(t.nodeBefore,0,"toPrevious")),this.position=V.toPosition(),V.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_canMergeLeft(B){const t=B.previousSibling;return t instanceof Element&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(t,B)}_canMergeRight(B){const t=B.nextSibling;return t instanceof Element&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(B,t)}_insertAutoParagraph(){this._insertPartialFragment();const B=this.writer.createElement("paragraph");this.writer.insert(B,this.position),this._setAffectedBoundaries(this.position),this._lastAutoParagraph=B,this.position=this.writer.createPositionAt(B,0)}_checkAndSplitToAllowedPosition(B){const t=this._getAllowedIn(this.position.parent,B);if(!t)return!1;for(t!=this.position.parent&&this._insertPartialFragment();t!=this.position.parent;)if(this.position.isAtStart){const V=this.position.parent;this.position=this.writer.createPositionBefore(V),V.isEmpty&&V.parent===t&&this.writer.remove(V)}else if(this.position.isAtEnd)this.position=this.writer.createPositionAfter(this.position.parent);else{const V=this.writer.createPositionAfter(this.position.parent);this._setAffectedBoundaries(this.position),this.writer.split(this.position),this.position=V,this.canMergeWith.add(this.position.nodeAfter)}return this.schema.checkChild(this.position.parent,B)||this._insertAutoParagraph(),!0}_getAllowedIn(B,t){return this.schema.checkChild(B,t)||this.schema.checkChild(B,"paragraph")&&this.schema.checkChild("paragraph",t)?B:this.schema.isLimit(B)?null:this._getAllowedIn(B.parent,t)}}function insertObject(H,B,t,V={}){if(!H.schema.isObject(B))throw new CKEditorError("insertobject-element-not-an-object",H,{object:B});const N=t||H.document.selection;let W=N;V.findOptimalPosition&&H.schema.isBlock(B)&&(W=H.createSelection(H.schema.findOptimalInsertionRange(N,V.findOptimalPosition)));const K=first(N.getSelectedBlocks()),G={};return K&&Object.assign(G,H.schema.getAttributesWithProperty(K,"copyOnReplace",!0)),H.change(Z=>{W.isCollapsed||H.deleteContent(W,{doNotAutoparagraph:!0});let Y=B;const X=W.anchor.parent;!H.schema.checkChild(X,B)&&H.schema.checkChild(X,"paragraph")&&H.schema.checkChild("paragraph",B)&&(Y=Z.createElement("paragraph"),Z.insert(B,Y)),H.schema.setAllowedAttributes(Y,G,Z);const Q=H.insertContent(Y,W);return Q.isCollapsed||V.setSelection&&updateSelection(Z,B,V.setSelection,G),Q})}function updateSelection(H,B,t,V){const N=H.model;if(t=="on"){H.setSelection(B,"on");return}if(t!="after")throw new CKEditorError("insertobject-invalid-place-parameter-value",N);let W=B.nextSibling;if(N.schema.isInline(B)){H.setSelection(B,"after");return}!(W&&N.schema.checkChild(W,"$text"))&&N.schema.checkChild(B.parent,"paragraph")&&(W=H.createElement("paragraph"),N.schema.setAllowedAttributes(W,V,H),N.insertContent(W,H.createPositionAfter(B))),W&&H.setSelection(W,0)}const wordBoundaryCharacters=' ,.?!:;"-()';function modifySelection(H,B,t={}){const V=H.schema,N=t.direction!="backward",W=t.unit?t.unit:"character",K=!!t.treatEmojiAsSingleUnit,G=B.focus,Z=new TreeWalker({boundaries:getSearchRange(G,N),singleCharacters:!0,direction:N?"forward":"backward"}),Y={walker:Z,schema:V,isForward:N,unit:W,treatEmojiAsSingleUnit:K};let X;for(;X=Z.next();){if(X.done)return;const Q=tryExtendingTo(Y,X.value);if(Q){B instanceof DocumentSelection?H.change(te=>{te.setSelectionFocus(Q)}):B.setFocus(Q);return}}}function tryExtendingTo(H,B){const{isForward:t,walker:V,unit:N,schema:W,treatEmojiAsSingleUnit:K}=H,{type:G,item:Z,nextPosition:Y}=B;if(G=="text")return H.unit==="word"?getCorrectWordBreakPosition(V,t):getCorrectPosition(V,N,K);if(G==(t?"elementStart":"elementEnd")){if(W.isSelectable(Z))return Position._createAt(Z,t?"after":"before");if(W.checkChild(Y,"$text"))return Y}else{if(W.isLimit(Z)){V.skip(()=>!0);return}if(W.checkChild(Y,"$text"))return Y}}function getCorrectPosition(H,B,t){const V=H.position.textNode;if(V){const N=V.data;let W=H.position.offset-V.startOffset;for(;isInsideSurrogatePair(N,W)||B=="character"&&isInsideCombinedSymbol(N,W)||t&&isInsideEmojiSequence(N,W);)H.next(),W=H.position.offset-V.startOffset}return H.position}function getCorrectWordBreakPosition(H,B){let t=H.position.textNode;for(t||(t=B?H.position.nodeAfter:H.position.nodeBefore);t&&t.is("$text");){const V=H.position.offset-t.startOffset;if(isAtNodeBoundary(t,V,B))t=B?H.position.nodeAfter:H.position.nodeBefore;else{if(isAtWordBoundary(t.data,V,B))break;H.next()}}return H.position}function getSearchRange(H,B){const t=H.root,V=Position._createAt(t,B?"end":0);return B?new Range(H,V):new Range(V,H)}function isAtWordBoundary(H,B,t){const V=B+(t?0:-1);return wordBoundaryCharacters.includes(H.charAt(V))}function isAtNodeBoundary(H,B,t){return B===(t?H.offsetSize:0)}let Model$1=class extends ObservableMixin(){constructor(){super();ee(this,"markers");ee(this,"document");ee(this,"schema");ee(this,"_pendingChanges");ee(this,"_currentWriter");this.markers=new MarkerCollection,this.document=new Document(this),this.schema=new Schema,this._pendingChanges=[],this._currentWriter=null,["deleteContent","modifySelection","getSelectedContent","applyOperation"].forEach(t=>this.decorate(t)),this.on("applyOperation",(t,V)=>{V[0]._validate()},{priority:"highest"}),this.schema.register("$root",{isLimit:!0}),this.schema.register("$container",{allowIn:["$root","$container"]}),this.schema.register("$block",{allowIn:["$root","$container"],isBlock:!0}),this.schema.register("$blockObject",{allowWhere:"$block",isBlock:!0,isObject:!0}),this.schema.register("$inlineObject",{allowWhere:"$text",allowAttributesOf:"$text",isInline:!0,isObject:!0}),this.schema.register("$text",{allowIn:"$block",isInline:!0,isContent:!0}),this.schema.register("$clipboardHolder",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$documentFragment",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$marker"),this.schema.addChildCheck(()=>!0,"$marker"),injectSelectionPostFixer$1(this),this.document.registerPostFixer(autoParagraphEmptyRoots),this.on("insertContent",(t,[V,N])=>{t.return=insertContent(this,V,N)}),this.on("insertObject",(t,[V,N,W])=>{t.return=insertObject(this,V,N,W)}),this.on("canEditAt",t=>{const V=!this.document.isReadOnly;t.return=V,V||t.stop()})}change(t){try{return this._pendingChanges.length===0?(this._pendingChanges.push({batch:new Batch,callback:t}),this._runPendingChanges()[0]):t(this._currentWriter)}catch(V){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(V,this)}}enqueueChange(t,V){try{t?typeof t=="function"?(V=t,t=new Batch):t instanceof Batch||(t=new Batch(t)):t=new Batch,this._pendingChanges.push({batch:t,callback:V}),this._pendingChanges.length==1&&this._runPendingChanges()}catch(N){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(N,this)}}applyOperation(t){t._execute()}insertContent(t,V,N,...W){const K=normalizeSelectable(V,N);return this.fire("insertContent",[t,K,N,...W])}insertObject(t,V,N,W,...K){const G=normalizeSelectable(V,N);return this.fire("insertObject",[t,G,W,W,...K])}deleteContent(t,V){deleteContent(this,t,V)}modifySelection(t,V){modifySelection(this,t,V)}getSelectedContent(t){return getSelectedContent(this,t)}hasContent(t,V={}){const N=t instanceof Range?t:Range._createIn(t);if(N.isCollapsed)return!1;const{ignoreWhitespaces:W=!1,ignoreMarkers:K=!1}=V;if(!K){for(const G of this.markers.getMarkersIntersectingRange(N))if(G.affectsData)return!0}for(const G of N.getItems())if(this.schema.isContent(G))if(G.is("$textProxy"))if(W){if(G.data.search(/\S/)!==-1)return!0}else return!0;else return!0;return!1}canEditAt(t){const V=normalizeSelectable(t);return this.fire("canEditAt",[V])}createPositionFromPath(t,V,N){return new Position(t,V,N)}createPositionAt(t,V){return Position._createAt(t,V)}createPositionAfter(t){return Position._createAfter(t)}createPositionBefore(t){return Position._createBefore(t)}createRange(t,V){return new Range(t,V)}createRangeIn(t){return Range._createIn(t)}createRangeOn(t){return Range._createOn(t)}createSelection(...t){return new Selection(...t)}createBatch(t){return new Batch(t)}createOperationFromJSON(t){return OperationFactory.fromJSON(t,this.document)}destroy(){this.document.destroy(),this.stopListening()}_runPendingChanges(){const t=[];this.fire("_beforeChanges");try{for(;this._pendingChanges.length;){const V=this._pendingChanges[0].batch;this._currentWriter=new Writer$2(this,V);const N=this._pendingChanges[0].callback(this._currentWriter);t.push(N),this.document._handleChangeBlock(this._currentWriter),this._pendingChanges.shift(),this._currentWriter=null}}finally{this._pendingChanges.length=0,this._currentWriter=null,this.fire("_afterChanges")}return t}};function normalizeSelectable(H,B){if(H)return H instanceof Selection||H instanceof DocumentSelection?H:H instanceof Node$1?B||B===0?new Selection(H,B):H.is("rootElement")?new Selection(H,"in"):new Selection(H,"on"):new Selection(H)}class ClickObserver extends DomEventObserver{constructor(){super(...arguments);ee(this,"domEventType","click")}onDomEvent(t){this.fire(t.type,t)}}class MouseObserver extends DomEventObserver{constructor(){super(...arguments);ee(this,"domEventType",["mousedown","mouseup","mouseover","mouseout"])}onDomEvent(t){this.fire(t.type,t)}}class UpcastWriter{constructor(B){ee(this,"document");this.document=B}createDocumentFragment(B){return new DocumentFragment$1(this.document,B)}createElement(B,t,V){return new Element$1(this.document,B,t,V)}createText(B){return new Text$1(this.document,B)}clone(B,t=!1){return B._clone(t)}appendChild(B,t){return t._appendChild(B)}insertChild(B,t,V){return V._insertChild(B,t)}removeChildren(B,t,V){return V._removeChildren(B,t)}remove(B){const t=B.parent;return t?this.removeChildren(t.getChildIndex(B),1,t):[]}replace(B,t){const V=B.parent;if(V){const N=V.getChildIndex(B);return this.removeChildren(N,1,V),this.insertChild(N,t,V),!0}return!1}unwrapElement(B){const t=B.parent;if(t){const V=t.getChildIndex(B);this.remove(B),this.insertChild(V,B.getChildren(),t)}}rename(B,t){const V=new Element$1(this.document,B,t.getAttributes(),t.getChildren());return this.replace(t,V)?V:null}setAttribute(B,t,V){V._setAttribute(B,t)}removeAttribute(B,t){t._removeAttribute(B)}addClass(B,t){t._addClass(B)}removeClass(B,t){t._removeClass(B)}setStyle(B,t,V){isPlainObject(B)&&V===void 0?t._setStyle(B):V._setStyle(B,t)}removeStyle(B,t){t._removeStyle(B)}setCustomProperty(B,t,V){V._setCustomProperty(B,t)}removeCustomProperty(B,t){return t._removeCustomProperty(B)}createPositionAt(B,t){return Position$1._createAt(B,t)}createPositionAfter(B){return Position$1._createAfter(B)}createPositionBefore(B){return Position$1._createBefore(B)}createRange(B,t){return new Range$1(B,t)}createRangeOn(B){return Range$1._createOn(B)}createRangeIn(B){return Range$1._createIn(B)}createSelection(...B){return new Selection$1(...B)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const HEX_COLOR_REGEXP=/^#([0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/i,RGB_COLOR_REGEXP=/^rgb\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}[0-9]{1,3}[ %]?\)$/i,RGBA_COLOR_REGEXP=/^rgba\([ ]?([0-9]{1,3}[ %]?,[ ]?){3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,HSL_COLOR_REGEXP=/^hsl\([ ]?([0-9]{1,3}[ %]?[,]?[ ]*){3}(1|[0-9]+%|[0]?\.?[0-9]+)?\)$/i,HSLA_COLOR_REGEXP=/^hsla\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,CSS_SHORTHAND_VALUE_REGEXP=/\w+\((?:[^()]|\([^()]*\))*\)|\S+/gi,COLOR_NAMES=new Set(["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","orange","aliceblue","antiquewhite","aquamarine","azure","beige","bisque","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","gainsboro","ghostwhite","gold","goldenrod","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","limegreen","linen","magenta","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","oldlace","olivedrab","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellowgreen","activeborder","activecaption","appworkspace","background","buttonface","buttonhighlight","buttonshadow","buttontext","captiontext","graytext","highlight","highlighttext","inactiveborder","inactivecaption","inactivecaptiontext","infobackground","infotext","menu","menutext","scrollbar","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","window","windowframe","windowtext","rebeccapurple","currentcolor","transparent"]);function isColor(H){return H.startsWith("#")?HEX_COLOR_REGEXP.test(H):H.startsWith("rgb")?RGB_COLOR_REGEXP.test(H)||RGBA_COLOR_REGEXP.test(H):H.startsWith("hsl")?HSL_COLOR_REGEXP.test(H)||HSLA_COLOR_REGEXP.test(H):COLOR_NAMES.has(H.toLowerCase())}const lineStyleValues=["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset"];function isLineStyle(H){return lineStyleValues.includes(H)}const lengthRegExp=/^([+-]?[0-9]*([.][0-9]+)?(px|cm|mm|in|pc|pt|ch|em|ex|rem|vh|vw|vmin|vmax)|0)$/;function isLength(H){return lengthRegExp.test(H)}const PERCENTAGE_VALUE_REGEXP=/^[+-]?[0-9]*([.][0-9]+)?%$/;function isPercentage(H){return PERCENTAGE_VALUE_REGEXP.test(H)}const repeatValues=["repeat-x","repeat-y","repeat","space","round","no-repeat"];function isRepeat(H){return repeatValues.includes(H)}const positionValues=["center","top","bottom","left","right"];function isPosition(H){return positionValues.includes(H)}const attachmentValues=["fixed","scroll","local"];function isAttachment(H){return attachmentValues.includes(H)}const urlRegExp=/^url\(/;function isURL(H){return urlRegExp.test(H)}function getBoxSidesValues(H=""){if(H==="")return{top:void 0,right:void 0,bottom:void 0,left:void 0};const B=getShorthandValues(H),t=B[0],V=B[2]||t,N=B[1]||t,W=B[3]||N;return{top:t,bottom:V,right:N,left:W}}function getBoxSidesValueReducer(H){return B=>{const{top:t,right:V,bottom:N,left:W}=B,K=[];return[t,V,W,N].every(G=>!!G)?K.push([H,getBoxSidesShorthandValue(B)]):(t&&K.push([H+"-top",t]),V&&K.push([H+"-right",V]),N&&K.push([H+"-bottom",N]),W&&K.push([H+"-left",W])),K}}function getBoxSidesShorthandValue({top:H,right:B,bottom:t,left:V}){const N=[];return V!==B?N.push(H,B,t,V):t!==H?N.push(H,B,t):B!==H?N.push(H,B):N.push(H),N.join(" ")}function getPositionShorthandNormalizer(H){return B=>({path:H,value:getBoxSidesValues(B)})}function getShorthandValues(H){const B=H.trim().slice(0,1500).matchAll(CSS_SHORTHAND_VALUE_REGEXP);return Array.from(B).map(t=>t[0])}function addBackgroundRules(H){H.setNormalizer("background",getBackgroundNormalizer()),H.setNormalizer("background-color",getBackgroundColorNormalizer()),H.setReducer("background",getBackgroundReducer()),H.setStyleRelation("background",["background-color"])}function getBackgroundNormalizer(){return H=>{const B={},t=getShorthandValues(H);for(const V of t)isRepeat(V)?(B.repeat=B.repeat||[],B.repeat.push(V)):isPosition(V)?(B.position=B.position||[],B.position.push(V)):isAttachment(V)?B.attachment=V:isColor(V)?B.color=V:isURL(V)&&(B.image=V);return{path:"background",value:B}}}function getBackgroundColorNormalizer(){return H=>({path:"background.color",value:H})}function getBackgroundReducer(){return H=>{const B=[];return B.push(["background-color",H.color]),B}}function addBorderRules(H){H.setNormalizer("border",getBorderNormalizer()),H.setNormalizer("border-top",getBorderPositionNormalizer("top")),H.setNormalizer("border-right",getBorderPositionNormalizer("right")),H.setNormalizer("border-bottom",getBorderPositionNormalizer("bottom")),H.setNormalizer("border-left",getBorderPositionNormalizer("left")),H.setNormalizer("border-color",getBorderPropertyNormalizer("color")),H.setNormalizer("border-width",getBorderPropertyNormalizer("width")),H.setNormalizer("border-style",getBorderPropertyNormalizer("style")),H.setNormalizer("border-top-color",getBorderPropertyPositionNormalizer("color","top")),H.setNormalizer("border-top-style",getBorderPropertyPositionNormalizer("style","top")),H.setNormalizer("border-top-width",getBorderPropertyPositionNormalizer("width","top")),H.setNormalizer("border-right-color",getBorderPropertyPositionNormalizer("color","right")),H.setNormalizer("border-right-style",getBorderPropertyPositionNormalizer("style","right")),H.setNormalizer("border-right-width",getBorderPropertyPositionNormalizer("width","right")),H.setNormalizer("border-bottom-color",getBorderPropertyPositionNormalizer("color","bottom")),H.setNormalizer("border-bottom-style",getBorderPropertyPositionNormalizer("style","bottom")),H.setNormalizer("border-bottom-width",getBorderPropertyPositionNormalizer("width","bottom")),H.setNormalizer("border-left-color",getBorderPropertyPositionNormalizer("color","left")),H.setNormalizer("border-left-style",getBorderPropertyPositionNormalizer("style","left")),H.setNormalizer("border-left-width",getBorderPropertyPositionNormalizer("width","left")),H.setExtractor("border-top",getBorderPositionExtractor("top")),H.setExtractor("border-right",getBorderPositionExtractor("right")),H.setExtractor("border-bottom",getBorderPositionExtractor("bottom")),H.setExtractor("border-left",getBorderPositionExtractor("left")),H.setExtractor("border-top-color","border.color.top"),H.setExtractor("border-right-color","border.color.right"),H.setExtractor("border-bottom-color","border.color.bottom"),H.setExtractor("border-left-color","border.color.left"),H.setExtractor("border-top-width","border.width.top"),H.setExtractor("border-right-width","border.width.right"),H.setExtractor("border-bottom-width","border.width.bottom"),H.setExtractor("border-left-width","border.width.left"),H.setExtractor("border-top-style","border.style.top"),H.setExtractor("border-right-style","border.style.right"),H.setExtractor("border-bottom-style","border.style.bottom"),H.setExtractor("border-left-style","border.style.left"),H.setReducer("border-color",getBoxSidesValueReducer("border-color")),H.setReducer("border-style",getBoxSidesValueReducer("border-style")),H.setReducer("border-width",getBoxSidesValueReducer("border-width")),H.setReducer("border-top",getBorderPositionReducer("top")),H.setReducer("border-right",getBorderPositionReducer("right")),H.setReducer("border-bottom",getBorderPositionReducer("bottom")),H.setReducer("border-left",getBorderPositionReducer("left")),H.setReducer("border",getBorderReducer()),H.setStyleRelation("border",["border-color","border-style","border-width","border-top","border-right","border-bottom","border-left","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-width","border-right-width","border-bottom-width","border-left-width"]),H.setStyleRelation("border-color",["border-top-color","border-right-color","border-bottom-color","border-left-color"]),H.setStyleRelation("border-style",["border-top-style","border-right-style","border-bottom-style","border-left-style"]),H.setStyleRelation("border-width",["border-top-width","border-right-width","border-bottom-width","border-left-width"]),H.setStyleRelation("border-top",["border-top-color","border-top-style","border-top-width"]),H.setStyleRelation("border-right",["border-right-color","border-right-style","border-right-width"]),H.setStyleRelation("border-bottom",["border-bottom-color","border-bottom-style","border-bottom-width"]),H.setStyleRelation("border-left",["border-left-color","border-left-style","border-left-width"])}function getBorderNormalizer(){return H=>{const{color:B,style:t,width:V}=normalizeBorderShorthand(H);return{path:"border",value:{color:getBoxSidesValues(B),style:getBoxSidesValues(t),width:getBoxSidesValues(V)}}}}function getBorderPositionNormalizer(H){return B=>{const{color:t,style:V,width:N}=normalizeBorderShorthand(B),W={};return t!==void 0&&(W.color={[H]:t}),V!==void 0&&(W.style={[H]:V}),N!==void 0&&(W.width={[H]:N}),{path:"border",value:W}}}function getBorderPropertyNormalizer(H){return B=>({path:"border",value:toBorderPropertyShorthand(B,H)})}function toBorderPropertyShorthand(H,B){return{[B]:getBoxSidesValues(H)}}function getBorderPropertyPositionNormalizer(H,B){return t=>({path:"border",value:{[H]:{[B]:t}}})}function getBorderPositionExtractor(H){return(B,t)=>{if(t.border)return extractBorderPosition(t.border,H)}}function extractBorderPosition(H,B){const t={};return H.width&&H.width[B]&&(t.width=H.width[B]),H.style&&H.style[B]&&(t.style=H.style[B]),H.color&&H.color[B]&&(t.color=H.color[B]),t}function normalizeBorderShorthand(H){const B={},t=getShorthandValues(H);for(const V of t)isLength(V)||/thin|medium|thick/.test(V)?B.width=V:isLineStyle(V)?B.style=V:B.color=V;return B}function getBorderReducer(){return B=>{const t=extractBorderPosition(B,"top"),V=extractBorderPosition(B,"right"),N=extractBorderPosition(B,"bottom"),W=extractBorderPosition(B,"left"),K=[t,V,N,W],G={width:H(K,"width"),style:H(K,"style"),color:H(K,"color")},Z=reduceBorderPosition(G,"all");return Z.length?Z:[...Object.entries(G).reduce((X,[Q,te])=>(te&&(X.push([`border-${Q}`,te]),K.forEach(ie=>delete ie[Q])),X),[]),...reduceBorderPosition(t,"top"),...reduceBorderPosition(V,"right"),...reduceBorderPosition(N,"bottom"),...reduceBorderPosition(W,"left")]};function H(B,t){return B.map(V=>V[t]).reduce((V,N)=>V==N?V:null)}}function getBorderPositionReducer(H){return B=>reduceBorderPosition(B,H)}function reduceBorderPosition(H,B){const t=[];if(H&&H.width&&t.push("width"),H&&H.style&&t.push("style"),H&&H.color&&t.push("color"),t.length==3){const V=t.map(N=>H[N]).join(" ");return[B=="all"?["border",V]:[`border-${B}`,V]]}return B=="all"?[]:t.map(V=>[`border-${B}-${V}`,H[V]])}function addPaddingRules(H){H.setNormalizer("padding",getPositionShorthandNormalizer("padding")),H.setNormalizer("padding-top",B=>({path:"padding.top",value:B})),H.setNormalizer("padding-right",B=>({path:"padding.right",value:B})),H.setNormalizer("padding-bottom",B=>({path:"padding.bottom",value:B})),H.setNormalizer("padding-left",B=>({path:"padding.left",value:B})),H.setReducer("padding",getBoxSidesValueReducer("padding")),H.setStyleRelation("padding",["padding-top","padding-right","padding-bottom","padding-left"])}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Watchdog{constructor(B){ee(this,"crashes",[]);ee(this,"state","initializing");ee(this,"_crashNumberLimit");ee(this,"_now",Date.now);ee(this,"_minimumNonErrorTimePeriod");ee(this,"_boundErrorHandler");ee(this,"_listeners");if(this.crashes=[],this._crashNumberLimit=typeof B.crashNumberLimit=="number"?B.crashNumberLimit:3,this._minimumNonErrorTimePeriod=typeof B.minimumNonErrorTimePeriod=="number"?B.minimumNonErrorTimePeriod:5e3,this._boundErrorHandler=t=>{const V="error"in t?t.error:t.reason;V instanceof Error&&this._handleError(V,t)},this._listeners={},!this._restart)throw new Error("The Watchdog class was split into the abstract `Watchdog` class and the `EditorWatchdog` class. Please, use `EditorWatchdog` if you have used the `Watchdog` class previously.")}destroy(){this._stopErrorHandling(),this._listeners={}}on(B,t){this._listeners[B]||(this._listeners[B]=[]),this._listeners[B].push(t)}off(B,t){this._listeners[B]=this._listeners[B].filter(V=>V!==t)}_fire(B,...t){const V=this._listeners[B]||[];for(const N of V)N.apply(this,[null,...t])}_startErrorHandling(){window.addEventListener("error",this._boundErrorHandler),window.addEventListener("unhandledrejection",this._boundErrorHandler)}_stopErrorHandling(){window.removeEventListener("error",this._boundErrorHandler),window.removeEventListener("unhandledrejection",this._boundErrorHandler)}_handleError(B,t){if(this._shouldReactToError(B)){this.crashes.push({message:B.message,stack:B.stack,filename:t instanceof ErrorEvent?t.filename:void 0,lineno:t instanceof ErrorEvent?t.lineno:void 0,colno:t instanceof ErrorEvent?t.colno:void 0,date:this._now()});const V=this._shouldRestart();this.state="crashed",this._fire("stateChange"),this._fire("error",{error:B,causesRestart:V}),V?this._restart():(this.state="crashedPermanently",this._fire("stateChange"))}}_shouldReactToError(B){return B.is&&B.is("CKEditorError")&&B.context!==void 0&&B.context!==null&&this.state==="ready"&&this._isErrorComingFromThisItem(B)}_shouldRestart(){if(this.crashes.length<=this._crashNumberLimit)return!0;const B=this.crashes[this.crashes.length-1].date,t=this.crashes[this.crashes.length-1-this._crashNumberLimit].date;return(B-t)/this._crashNumberLimit>this._minimumNonErrorTimePeriod}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getSubNodes(H,B=new Set){const t=[H],V=new Set;let N=0;for(;t.length>N;){const W=t[N++];if(!(V.has(W)||!shouldNodeBeIncluded(W)||B.has(W)))if(V.add(W),Symbol.iterator in W)try{for(const K of W)t.push(K)}catch{}else for(const K in W)K!=="defaultValue"&&t.push(W[K])}return V}function shouldNodeBeIncluded(H){const B=Object.prototype.toString.call(H),t=typeof H;return!(t==="number"||t==="boolean"||t==="string"||t==="symbol"||t==="function"||B==="[object Date]"||B==="[object RegExp]"||B==="[object Module]"||H===void 0||H===null||H._watchdogExcluded||H instanceof EventTarget||H instanceof Event)}function areConnectedThroughProperties(H,B,t=new Set){if(H===B&&isObject$1(H))return!0;const V=getSubNodes(H,t),N=getSubNodes(B,t);for(const W of V)if(N.has(W))return!0;return!1}function isObject$1(H){return typeof H=="object"&&H!==null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class EditorWatchdog extends Watchdog{constructor(t,V={}){super(V);ee(this,"_editor",null);ee(this,"_lifecyclePromise",null);ee(this,"_throttledSave");ee(this,"_data");ee(this,"_lastDocumentVersion");ee(this,"_elementOrData");ee(this,"_initUsingData",!0);ee(this,"_editables",{});ee(this,"_config");ee(this,"_excludedProps");this._throttledSave=throttle(this._save.bind(this),typeof V.saveInterval=="number"?V.saveInterval:5e3),t&&(this._creator=(N,W)=>t.create(N,W)),this._destructor=N=>N.destroy()}get editor(){return this._editor}get _item(){return this._editor}setCreator(t){this._creator=t}setDestructor(t){this._destructor=t}_restart(){return Promise.resolve().then(()=>(this.state="initializing",this._fire("stateChange"),this._destroy())).catch(t=>{console.error("An error happened during the editor destroying.",t)}).then(()=>{const t={},V=[],N=this._config.rootsAttributes||{},W={};for(const[G,Z]of Object.entries(this._data.roots))Z.isLoaded?(t[G]="",W[G]=N[G]||{}):V.push(G);const K={...this._config,extraPlugins:this._config.extraPlugins||[],lazyRoots:V,rootsAttributes:W,_watchdogInitialData:this._data};return delete K.initialData,K.extraPlugins.push(EditorWatchdogInitPlugin),this._initUsingData?this.create(t,K,K.context):isElement$1(this._elementOrData)?this.create(this._elementOrData,K,K.context):this.create(this._editables,K,K.context)}).then(()=>{this._fire("restart")})}create(t=this._elementOrData,V=this._config,N){return this._lifecyclePromise=Promise.resolve(this._lifecyclePromise).then(()=>(super._startErrorHandling(),this._elementOrData=t,this._initUsingData=typeof t=="string"||Object.keys(t).length>0&&typeof Object.values(t)[0]=="string",this._config=this._cloneEditorConfiguration(V)||{},this._config.context=N,this._creator(t,this._config))).then(W=>{this._editor=W,W.model.document.on("change:data",this._throttledSave),this._lastDocumentVersion=W.model.document.version,this._data=this._getData(),this._initUsingData||(this._editables=this._getEditables()),this.state="ready",this._fire("stateChange")}).finally(()=>{this._lifecyclePromise=null}),this._lifecyclePromise}destroy(){return this._lifecyclePromise=Promise.resolve(this._lifecyclePromise).then(()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy())).finally(()=>{this._lifecyclePromise=null}),this._lifecyclePromise}_destroy(){return Promise.resolve().then(()=>{this._stopErrorHandling(),this._throttledSave.cancel();const t=this._editor;return this._editor=null,t.model.document.off("change:data",this._throttledSave),this._destructor(t)})}_save(){const t=this._editor.model.document.version;try{this._data=this._getData(),this._initUsingData||(this._editables=this._getEditables()),this._lastDocumentVersion=t}catch(V){console.error(V,"An error happened during restoring editor data. Editor will be restored from the previously saved data.")}}_setExcludedProperties(t){this._excludedProps=t}_getData(){const t=this._editor,V=t.model.document.roots.filter(Z=>Z.isAttached()&&Z.rootName!="$graveyard"),{plugins:N}=t,W=N.has("CommentsRepository")&&N.get("CommentsRepository"),K=N.has("TrackChanges")&&N.get("TrackChanges"),G={roots:{},markers:{},commentThreads:JSON.stringify([]),suggestions:JSON.stringify([])};V.forEach(Z=>{G.roots[Z.rootName]={content:JSON.stringify(Array.from(Z.getChildren())),attributes:JSON.stringify(Array.from(Z.getAttributes())),isLoaded:Z._isLoaded}});for(const Z of t.model.markers)Z._affectsData&&(G.markers[Z.name]={rangeJSON:Z.getRange().toJSON(),usingOperation:Z._managedUsingOperations,affectsData:Z._affectsData});return W&&(G.commentThreads=JSON.stringify(W.getCommentThreads({toJSON:!0,skipNotAttached:!0}))),K&&(G.suggestions=JSON.stringify(K.getSuggestions({toJSON:!0,skipNotAttached:!0}))),G}_getEditables(){const t={};for(const V of this.editor.model.document.getRootNames()){const N=this.editor.ui.getEditableElement(V);N&&(t[V]=N)}return t}_isErrorComingFromThisItem(t){return areConnectedThroughProperties(this._editor,t.context,this._excludedProps)}_cloneEditorConfiguration(t){return cloneDeepWith(t,(V,N)=>{if(isElement$1(V)||N==="context")return V})}}class EditorWatchdogInitPlugin{constructor(B){ee(this,"editor");ee(this,"_data");this.editor=B,this._data=B.config.get("_watchdogInitialData")}init(){this.editor.data.on("init",B=>{B.stop(),this.editor.model.enqueueChange({isUndoable:!1},t=>{this._restoreCollaborationData(),this._restoreEditorData(t)}),this.editor.data.fire("ready")},{priority:999})}_createNode(B,t){if("name"in t){const V=B.createElement(t.name,t.attributes);if(t.children)for(const N of t.children)V._appendChild(this._createNode(B,N));return V}else return B.createText(t.data,t.attributes)}_restoreEditorData(B){const t=this.editor;Object.entries(this._data.roots).forEach(([V,{content:N,attributes:W}])=>{const K=JSON.parse(N),G=JSON.parse(W),Z=t.model.document.getRoot(V);for(const[Y,X]of G)B.setAttribute(Y,X,Z);for(const Y of K){const X=this._createNode(B,Y);B.insert(X,Z,"end")}}),Object.entries(this._data.markers).forEach(([V,N])=>{const{document:W}=t.model,{rangeJSON:{start:K,end:G},...Z}=N,Y=W.getRoot(K.root),X=B.createPositionFromPath(Y,K.path,K.stickiness),Q=B.createPositionFromPath(Y,G.path,G.stickiness),te=B.createRange(X,Q);B.addMarker(V,{range:te,...Z})})}_restoreCollaborationData(){const B=JSON.parse(this._data.commentThreads),t=JSON.parse(this._data.suggestions);B.forEach(V=>{const N=this.editor.config.get("collaboration.channelId"),W=this.editor.plugins.get("CommentsRepository");W.hasCommentThread(V.threadId)&&W.getCommentThread(V.threadId).remove(),W.addCommentThread({channelId:N,...V})}),t.forEach(V=>{const N=this.editor.plugins.get("TrackChangesEditing");if(N.hasSuggestion(V.id)){const W=N.getSuggestion(V.id);W.attributes=V.attributes}else N.addSuggestionData(V)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const mainQueueId=Symbol("MainQueueId");class ContextWatchdog extends Watchdog{constructor(t,V={}){super(V);ee(this,"_watchdogs",new Map);ee(this,"_watchdogConfig");ee(this,"_context",null);ee(this,"_contextProps",new Set);ee(this,"_actionQueues",new ActionQueues);ee(this,"_contextConfig");ee(this,"_item");this._watchdogConfig=V,this._creator=N=>t.create(N),this._destructor=N=>N.destroy(),this._actionQueues.onEmpty(()=>{this.state==="initializing"&&(this.state="ready",this._fire("stateChange"))})}setCreator(t){this._creator=t}setDestructor(t){this._destructor=t}get context(){return this._context}create(t={}){return this._actionQueues.enqueue(mainQueueId,()=>(this._contextConfig=t,this._create()))}getItem(t){return this._getWatchdog(t)._item}getItemState(t){return this._getWatchdog(t).state}add(t){const V=toArray$1(t);return Promise.all(V.map(N=>this._actionQueues.enqueue(N.id,()=>{if(this.state==="destroyed")throw new Error("Cannot add items to destroyed watchdog.");if(!this._context)throw new Error("Context was not created yet. You should call the `ContextWatchdog#create()` method first.");let W;if(this._watchdogs.has(N.id))throw new Error(`Item with the given id is already added: '${N.id}'.`);if(N.type==="editor")return W=new EditorWatchdog(null,this._watchdogConfig),W.setCreator(N.creator),W._setExcludedProperties(this._contextProps),N.destructor&&W.setDestructor(N.destructor),this._watchdogs.set(N.id,W),W.on("error",(K,{error:G,causesRestart:Z})=>{this._fire("itemError",{itemId:N.id,error:G}),Z&&this._actionQueues.enqueue(N.id,()=>new Promise(Y=>{const X=()=>{W.off("restart",X),this._fire("itemRestart",{itemId:N.id}),Y()};W.on("restart",X)}))}),W.create(N.sourceElementOrData,N.config,this._context);throw new Error(`Not supported item type: '${N.type}'.`)})))}remove(t){const V=toArray$1(t);return Promise.all(V.map(N=>this._actionQueues.enqueue(N,()=>{const W=this._getWatchdog(N);return this._watchdogs.delete(N),W.destroy()})))}destroy(){return this._actionQueues.enqueue(mainQueueId,()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy()))}_restart(){return this._actionQueues.enqueue(mainQueueId,()=>(this.state="initializing",this._fire("stateChange"),this._destroy().catch(t=>{console.error("An error happened during destroying the context or items.",t)}).then(()=>this._create()).then(()=>this._fire("restart"))))}_create(){return Promise.resolve().then(()=>(this._startErrorHandling(),this._creator(this._contextConfig))).then(t=>(this._context=t,this._contextProps=getSubNodes(this._context),Promise.all(Array.from(this._watchdogs.values()).map(V=>(V._setExcludedProperties(this._contextProps),V.create(void 0,void 0,this._context))))))}_destroy(){return Promise.resolve().then(()=>{this._stopErrorHandling();const t=this._context;return this._context=null,this._contextProps=new Set,Promise.all(Array.from(this._watchdogs.values()).map(V=>V.destroy())).then(()=>this._destructor(t))})}_getWatchdog(t){const V=this._watchdogs.get(t);if(!V)throw new Error(`Item with the given id was not registered: ${t}.`);return V}_isErrorComingFromThisItem(t){for(const V of this._watchdogs.values())if(V._isErrorComingFromThisItem(t))return!1;return areConnectedThroughProperties(this._context,t.context)}}class ActionQueues{constructor(){ee(this,"_onEmptyCallbacks",[]);ee(this,"_queues",new Map);ee(this,"_activeActions",0)}onEmpty(B){this._onEmptyCallbacks.push(B)}enqueue(B,t){const V=B===mainQueueId;this._activeActions++,this._queues.get(B)||this._queues.set(B,Promise.resolve());const W=(V?Promise.all(this._queues.values()):Promise.all([this._queues.get(mainQueueId),this._queues.get(B)])).then(t),K=W.catch(()=>{});return this._queues.set(B,K),W.finally(()=>{this._activeActions--,this._queues.get(B)===K&&this._activeActions===0&&this._onEmptyCallbacks.forEach(G=>G())})}}function toArray$1(H){return Array.isArray(H)?H:[H]}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Plugin extends ObservableMixin(){constructor(t){super();ee(this,"editor");ee(this,"_disableStack",new Set);this.editor=t,this.set("isEnabled",!0)}forceDisabled(t){this._disableStack.add(t),this._disableStack.size==1&&(this.on("set:isEnabled",forceDisable$1,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(t){this._disableStack.delete(t),this._disableStack.size==0&&(this.off("set:isEnabled",forceDisable$1),this.isEnabled=!0)}destroy(){this.stopListening()}static get isContextPlugin(){return!1}}function forceDisable$1(H){H.return=!1,H.stop()}class Command extends ObservableMixin(){constructor(t){super();ee(this,"editor");ee(this,"_isEnabledBasedOnSelection");ee(this,"_affectsData");ee(this,"_disableStack");this.editor=t,this.set("value",void 0),this.set("isEnabled",!1),this._affectsData=!0,this._isEnabledBasedOnSelection=!0,this._disableStack=new Set,this.decorate("execute"),this.listenTo(this.editor.model.document,"change",()=>{this.refresh()}),this.listenTo(t,"change:isReadOnly",()=>{this.refresh()}),this.on("set:isEnabled",V=>{if(!this.affectsData)return;const N=t.model.document.selection,K=!(N.getFirstPosition().root.rootName=="$graveyard")&&t.model.canEditAt(N);(t.isReadOnly||this._isEnabledBasedOnSelection&&!K)&&(V.return=!1,V.stop())},{priority:"highest"}),this.on("execute",V=>{this.isEnabled||V.stop()},{priority:"high"})}get affectsData(){return this._affectsData}set affectsData(t){this._affectsData=t}refresh(){this.isEnabled=!0}forceDisabled(t){this._disableStack.add(t),this._disableStack.size==1&&(this.on("set:isEnabled",forceDisable,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(t){this._disableStack.delete(t),this._disableStack.size==0&&(this.off("set:isEnabled",forceDisable),this.refresh())}execute(...t){}destroy(){this.stopListening()}}function forceDisable(H){H.return=!1,H.stop()}class PluginCollection extends EmitterMixin(){constructor(t,V=[],N=[]){super();ee(this,"_context");ee(this,"_plugins",new Map);ee(this,"_availablePlugins");ee(this,"_contextPlugins");this._context=t,this._availablePlugins=new Map;for(const W of V)W.pluginName&&this._availablePlugins.set(W.pluginName,W);this._contextPlugins=new Map;for(const[W,K]of N)this._contextPlugins.set(W,K),this._contextPlugins.set(K,W),W.pluginName&&this._availablePlugins.set(W.pluginName,W)}*[Symbol.iterator](){for(const t of this._plugins)typeof t[0]=="function"&&(yield t)}get(t){const V=this._plugins.get(t);if(!V){let N=t;throw typeof t=="function"&&(N=t.pluginName||t.name),new CKEditorError("plugincollection-plugin-not-loaded",this._context,{plugin:N})}return V}has(t){return this._plugins.has(t)}init(t,V=[],N=[]){const W=this,K=this._context;ne(t),ae(t);const G=t.filter(he=>!te(he,V)),Z=[...le(G)];Ce(Z,N);const Y=be(Z);return ge(Y,"init").then(()=>ge(Y,"afterInit")).then(()=>Y);function X(he){return typeof he=="function"}function Q(he){return X(he)&&!!he.isContextPlugin}function te(he,me){return me.some(pe=>pe===he||ie(he)===pe||ie(pe)===he)}function ie(he){return X(he)?he.pluginName||he.name:he}function ne(he,me=new Set){he.forEach(pe=>{X(pe)&&(me.has(pe)||(me.add(pe),pe.pluginName&&!W._availablePlugins.has(pe.pluginName)&&W._availablePlugins.set(pe.pluginName,pe),pe.requires&&ne(pe.requires,me)))})}function le(he,me=new Set){return he.map(pe=>X(pe)?pe:W._availablePlugins.get(pe)).reduce((pe,_e)=>me.has(_e)?pe:(me.add(_e),_e.requires&&(ae(_e.requires,_e),le(_e.requires,me).forEach(ye=>pe.add(ye))),pe.add(_e)),new Set)}function ae(he,me=null){he.map(pe=>X(pe)?pe:W._availablePlugins.get(pe)||pe).forEach(pe=>{de(pe,me),ce(pe,me),we(pe,me)})}function de(he,me){if(!X(he))throw me?new CKEditorError("plugincollection-soft-required",K,{missingPlugin:he,requiredBy:ie(me)}):new CKEditorError("plugincollection-plugin-not-found",K,{plugin:he})}function ce(he,me){if(Q(me)&&!Q(he))throw new CKEditorError("plugincollection-context-required",K,{plugin:ie(he),requiredBy:ie(me)})}function we(he,me){if(me&&te(he,V))throw new CKEditorError("plugincollection-required",K,{plugin:ie(he),requiredBy:ie(me)})}function be(he){return he.map(me=>{let pe=W._contextPlugins.get(me);return pe=pe||new me(K),W._add(me,pe),pe})}function ge(he,me){return he.reduce((pe,_e)=>!_e[me]||W._contextPlugins.has(_e)?pe:pe.then(_e[me].bind(_e)),Promise.resolve())}function Ce(he,me){for(const pe of me){if(typeof pe!="function")throw new CKEditorError("plugincollection-replace-plugin-invalid-type",null,{pluginItem:pe});const _e=pe.pluginName;if(!_e)throw new CKEditorError("plugincollection-replace-plugin-missing-name",null,{pluginItem:pe});if(pe.requires&&pe.requires.length)throw new CKEditorError("plugincollection-plugin-for-replacing-cannot-have-dependencies",null,{pluginName:_e});const ye=W._availablePlugins.get(_e);if(!ye)throw new CKEditorError("plugincollection-plugin-for-replacing-not-exist",null,{pluginName:_e});const Re=he.indexOf(ye);if(Re===-1){if(W._contextPlugins.has(ye))return;throw new CKEditorError("plugincollection-plugin-for-replacing-not-loaded",null,{pluginName:_e})}if(ye.requires&&ye.requires.length)throw new CKEditorError("plugincollection-replaced-plugin-cannot-have-dependencies",null,{pluginName:_e});he.splice(Re,1,pe),W._availablePlugins.set(_e,pe)}}}destroy(){const t=[];for(const[,V]of this)typeof V.destroy=="function"&&!this._contextPlugins.has(V)&&t.push(V.destroy());return Promise.all(t)}_add(t,V){this._plugins.set(t,V);const N=t.pluginName;if(N){if(this._plugins.has(N))throw new CKEditorError("plugincollection-plugin-name-conflict",null,{pluginName:N,plugin1:this._plugins.get(N).constructor,plugin2:t});this._plugins.set(N,V)}}}class Context{constructor(B){ee(this,"config");ee(this,"plugins");ee(this,"locale");ee(this,"t");ee(this,"editors");ee(this,"_contextOwner",null);const{translations:t,...V}=B||{};this.config=new Config(V,this.constructor.defaultConfig);const N=this.constructor.builtinPlugins;this.config.define("plugins",N),this.plugins=new PluginCollection(this,N);const W=this.config.get("language")||{};this.locale=new Locale({uiLanguage:typeof W=="string"?W:W.ui,contentLanguage:this.config.get("language.content"),translations:t}),this.t=this.locale.t,this.editors=new Collection}initPlugins(){const B=this.config.get("plugins")||[],t=this.config.get("substitutePlugins")||[];for(const V of B.concat(t)){if(typeof V!="function")throw new CKEditorError("context-initplugins-constructor-only",null,{Plugin:V});if(V.isContextPlugin!==!0)throw new CKEditorError("context-initplugins-invalid-plugin",null,{Plugin:V})}return this.plugins.init(B,[],t)}destroy(){return Promise.all(Array.from(this.editors,B=>B.destroy())).then(()=>this.plugins.destroy())}_addEditor(B,t){if(this._contextOwner)throw new CKEditorError("context-addeditor-private-context");this.editors.add(B),t&&(this._contextOwner=B)}_removeEditor(B){return this.editors.has(B)&&this.editors.remove(B),this._contextOwner===B?this.destroy():Promise.resolve()}_getEditorConfig(){const B={};for(const t of this.config.names())["plugins","removePlugins","extraPlugins"].includes(t)||(B[t]=this.config.get(t));return B}static create(B){return new Promise(t=>{const V=new this(B);t(V.initPlugins().then(()=>V))})}}ee(Context,"defaultConfig"),ee(Context,"builtinPlugins");class ContextPlugin extends ObservableMixin(){constructor(t){super();ee(this,"context");this.context=t}destroy(){this.stopListening()}static get isContextPlugin(){return!0}}class CommandCollection{constructor(){ee(this,"_commands");this._commands=new Map}add(B,t){this._commands.set(B,t)}get(B){return this._commands.get(B)}execute(B,...t){const V=this.get(B);if(!V)throw new CKEditorError("commandcollection-command-not-found",this,{commandName:B});return V.execute(...t)}*names(){yield*this._commands.keys()}*commands(){yield*this._commands.values()}[Symbol.iterator](){return this._commands[Symbol.iterator]()}destroy(){for(const B of this.commands())B.destroy()}}class EditingKeystrokeHandler extends KeystrokeHandler{constructor(t){super();ee(this,"editor");this.editor=t}set(t,V,N={}){if(typeof V=="string"){const W=V;V=(K,G)=>{this.editor.execute(W),G()}}super.set(t,V,N)}}const DEFAULT_CATEGORY_ID="contentEditing",DEFAULT_GROUP_ID="common";class Accessibility{constructor(B){ee(this,"keystrokeInfos",new Map);ee(this,"_editor");this._editor=B;const t=B.config.get("menuBar.isVisible"),V=B.locale.t;this.addKeystrokeInfoCategory({id:DEFAULT_CATEGORY_ID,label:V("Content editing keystrokes"),description:V("These keyboard shortcuts allow for quick access to content editing features.")});const N=[{label:V("Close contextual balloons, dropdowns, and dialogs"),keystroke:"Esc"},{label:V("Open the accessibility help dialog"),keystroke:"Alt+0"},{label:V("Move focus between form fields (inputs, buttons, etc.)"),keystroke:[["Tab"],["Shift+Tab"]]},{label:V("Move focus to the toolbar, navigate between toolbars"),keystroke:"Alt+F10",mayRequireFn:!0},{label:V("Navigate through the toolbar or menu bar"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]},{label:V("Execute the currently focused button. Executing buttons that interact with the editor content moves the focus back to the content."),keystroke:[["Enter"],["Space"]]}];t&&N.push({label:V("Move focus to the menu bar, navigate between menu bars"),keystroke:"Alt+F9",mayRequireFn:!0}),this.addKeystrokeInfoCategory({id:"navigation",label:V("User interface and content navigation keystrokes"),description:V("Use the following keystrokes for more efficient navigation in the CKEditor 5 user interface."),groups:[{id:"common",keystrokes:N}]})}addKeystrokeInfoCategory({id:B,label:t,description:V,groups:N}){this.keystrokeInfos.set(B,{id:B,label:t,description:V,groups:new Map}),this.addKeystrokeInfoGroup({categoryId:B,id:DEFAULT_GROUP_ID}),N&&N.forEach(W=>{this.addKeystrokeInfoGroup({categoryId:B,...W})})}addKeystrokeInfoGroup({categoryId:B=DEFAULT_CATEGORY_ID,id:t,label:V,keystrokes:N}){const W=this.keystrokeInfos.get(B);if(!W)throw new CKEditorError("accessibility-unknown-keystroke-info-category",this._editor,{groupId:t,categoryId:B});W.groups.set(t,{id:t,label:V,keystrokes:N||[]})}addKeystrokeInfos({categoryId:B=DEFAULT_CATEGORY_ID,groupId:t=DEFAULT_GROUP_ID,keystrokes:V}){if(!this.keystrokeInfos.has(B))throw new CKEditorError("accessibility-unknown-keystroke-info-category",this._editor,{categoryId:B,keystrokes:V});const N=this.keystrokeInfos.get(B);if(!N.groups.has(t))throw new CKEditorError("accessibility-unknown-keystroke-info-group",this._editor,{groupId:t,categoryId:B,keystrokes:V});N.groups.get(t).keystrokes.push(...V)}}class Editor extends ObservableMixin(){constructor(t={}){super();ee(this,"accessibility");ee(this,"commands");ee(this,"config");ee(this,"conversion");ee(this,"data");ee(this,"editing");ee(this,"locale");ee(this,"model");ee(this,"plugins");ee(this,"keystrokes");ee(this,"t");ee(this,"_context");ee(this,"_readOnlyLocks");if("sanitizeHtml"in t)throw new CKEditorError("editor-config-sanitizehtml-not-supported");const V=this.constructor,{translations:N,...W}=V.defaultConfig||{},{translations:K=N,...G}=t,Z=t.language||W.language;this._context=t.context||new Context({language:Z,translations:K}),this._context._addEditor(this,!t.context);const Y=Array.from(V.builtinPlugins||[]);this.config=new Config(G,W),this.config.define("plugins",Y),this.config.define(this._context._getEditorConfig()),this.plugins=new PluginCollection(this,Y,this._context.plugins),this.locale=this._context.locale,this.t=this.locale.t,this._readOnlyLocks=new Set,this.commands=new CommandCollection,this.set("state","initializing"),this.once("ready",()=>this.state="ready",{priority:"high"}),this.once("destroy",()=>this.state="destroyed",{priority:"high"}),this.model=new Model$1,this.on("change:isReadOnly",()=>{this.model.document.isReadOnly=this.isReadOnly});const X=new StylesProcessor;this.data=new DataController(this.model,X),this.editing=new EditingController(this.model,X),this.editing.view.document.bind("isReadOnly").to(this),this.conversion=new Conversion([this.editing.downcastDispatcher,this.data.downcastDispatcher],this.data.upcastDispatcher),this.conversion.addAlias("dataDowncast",this.data.downcastDispatcher),this.conversion.addAlias("editingDowncast",this.editing.downcastDispatcher),this.keystrokes=new EditingKeystrokeHandler(this),this.keystrokes.listenTo(this.editing.view.document),this.accessibility=new Accessibility(this)}get isReadOnly(){return this._readOnlyLocks.size>0}set isReadOnly(t){throw new CKEditorError("editor-isreadonly-has-no-setter")}enableReadOnlyMode(t){if(typeof t!="string"&&typeof t!="symbol")throw new CKEditorError("editor-read-only-lock-id-invalid",null,{lockId:t});this._readOnlyLocks.has(t)||(this._readOnlyLocks.add(t),this._readOnlyLocks.size===1&&this.fire("change:isReadOnly","isReadOnly",!0,!1))}disableReadOnlyMode(t){if(typeof t!="string"&&typeof t!="symbol")throw new CKEditorError("editor-read-only-lock-id-invalid",null,{lockId:t});this._readOnlyLocks.has(t)&&(this._readOnlyLocks.delete(t),this._readOnlyLocks.size===0&&this.fire("change:isReadOnly","isReadOnly",!1,!0))}setData(t){this.data.set(t)}getData(t){return this.data.get(t)}initPlugins(){const t=this.config,V=t.get("plugins"),N=t.get("removePlugins")||[],W=t.get("extraPlugins")||[],K=t.get("substitutePlugins")||[];return this.plugins.init(V.concat(W),N,K)}destroy(){let t=Promise.resolve();return this.state=="initializing"&&(t=new Promise(V=>this.once("ready",V))),t.then(()=>{this.fire("destroy"),this.stopListening(),this.commands.destroy()}).then(()=>this.plugins.destroy()).then(()=>{this.model.destroy(),this.data.destroy(),this.editing.destroy(),this.keystrokes.destroy()}).then(()=>this._context._removeEditor(this))}execute(t,...V){try{return this.commands.execute(t,...V)}catch(N){/* istanbul ignore next -- @preserve */CKEditorError.rethrowUnexpectedError(N,this)}}focus(){this.editing.view.focus()}static create(...t){throw new Error("This is an abstract method.")}}ee(Editor,"defaultConfig"),ee(Editor,"builtinPlugins"),ee(Editor,"Context",Context),ee(Editor,"EditorWatchdog",EditorWatchdog),ee(Editor,"ContextWatchdog",ContextWatchdog);function attachToForm(H){if(!isFunction(H.updateSourceElement))throw new CKEditorError("attachtoform-missing-elementapi-interface",H);const B=H.sourceElement;if(isTextArea(B)&&B.form){let t;const V=B.form,N=()=>H.updateSourceElement();isFunction(V.submit)&&(t=V.submit,V.submit=()=>{N(),t.apply(V)}),V.addEventListener("submit",N),H.on("destroy",()=>{V.removeEventListener("submit",N),t&&(V.submit=t)})}}function isTextArea(H){return!!H&&H.tagName.toLowerCase()==="textarea"}function ElementApiMixin(H){class B extends H{constructor(){super(...arguments);ee(this,"sourceElement")}updateSourceElement(N){if(!this.sourceElement)throw new CKEditorError("editor-missing-sourceelement",this);const W=this.config.get("updateSourceElementOnDestroy"),K=this.sourceElement instanceof HTMLTextAreaElement;if(!W&&!K){setDataInElement(this.sourceElement,"");return}const G=typeof N=="string"?N:this.data.get();setDataInElement(this.sourceElement,G)}}return B}ElementApiMixin.updateSourceElement=ElementApiMixin(Object).prototype.updateSourceElement;class PendingActions extends ContextPlugin{constructor(){super(...arguments);ee(this,"_actions")}static get pluginName(){return"PendingActions"}init(){this.set("hasAny",!1),this._actions=new Collection({idProperty:"_id"}),this._actions.delegate("add","remove").to(this)}add(t){if(typeof t!="string")throw new CKEditorError("pendingactions-add-invalid-message",this);const V=new(ObservableMixin());return V.set("message",t),this._actions.add(V),this.hasAny=!0,V}remove(t){this._actions.remove(t),this.hasAny=!!this._actions.length}get first(){return this._actions.get(0)}[Symbol.iterator](){return this._actions[Symbol.iterator]()}}var cancel='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.591 10.177 4.243 4.242a1 1 0 0 1-1.415 1.415l-4.242-4.243-4.243 4.243a1 1 0 0 1-1.414-1.415l4.243-4.242L4.52 5.934A1 1 0 0 1 5.934 4.52l4.243 4.243 4.242-4.243a1 1 0 1 1 1.415 1.414l-4.243 4.243z"/></svg>',caption='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 16h9a1 1 0 0 1 0 2H2a1 1 0 0 1 0-2z"/><path d="M17 1a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14zm0 1.5H3a.5.5 0 0 0-.492.41L2.5 3v9a.5.5 0 0 0 .41.492L3 12.5h14a.5.5 0 0 0 .492-.41L17.5 12V3a.5.5 0 0 0-.41-.492L17 2.5z" fill-opacity=".6"/></svg>',check='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.972 16.615a.997.997 0 0 1-.744-.292l-4.596-4.596a1 1 0 1 1 1.414-1.414l3.926 3.926 9.937-9.937a1 1 0 0 1 1.414 1.415L7.717 16.323a.997.997 0 0 1-.745.292z"/></svg>',cog='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.333 2 .19 2.263a5.899 5.899 0 0 1 1.458.604L14.714 3.4 16.6 5.286l-1.467 1.733c.263.452.468.942.605 1.46L18 8.666v2.666l-2.263.19a5.899 5.899 0 0 1-.604 1.458l1.467 1.733-1.886 1.886-1.733-1.467a5.899 5.899 0 0 1-1.46.605L11.334 18H8.667l-.19-2.263a5.899 5.899 0 0 1-1.458-.604L5.286 16.6 3.4 14.714l1.467-1.733a5.899 5.899 0 0 1-.604-1.458L2 11.333V8.667l2.262-.189a5.899 5.899 0 0 1 .605-1.459L3.4 5.286 5.286 3.4l1.733 1.467a5.899 5.899 0 0 1 1.46-.605L8.666 2h2.666zM10 6.267a3.733 3.733 0 1 0 0 7.466 3.733 3.733 0 0 0 0-7.466z"/></svg>',colorPalette='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.209 18.717A8.5 8.5 0 1 1 18.686 9.6h-.008l.002.12a3 3 0 0 1-2.866 2.997h-.268l-.046-.002v.002h-4.791a2 2 0 1 0 0 4 1 1 0 1 1-.128 1.992 8.665 8.665 0 0 1-.372.008Zm-3.918-7.01a1.25 1.25 0 1 0-2.415-.648 1.25 1.25 0 0 0 2.415.647ZM5.723 8.18a1.25 1.25 0 1 0 .647-2.414 1.25 1.25 0 0 0-.647 2.414ZM9.76 6.155a1.25 1.25 0 1 0 .647-2.415 1.25 1.25 0 0 0-.647 2.415Zm4.028 1.759a1.25 1.25 0 1 0 .647-2.415 1.25 1.25 0 0 0-.647 2.415Z"/></svg>',eraser='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m8.636 9.531-2.758 3.94a.5.5 0 0 0 .122.696l3.224 2.284h1.314l2.636-3.736L8.636 9.53zm.288 8.451L5.14 15.396a2 2 0 0 1-.491-2.786l6.673-9.53a2 2 0 0 1 2.785-.49l3.742 2.62a2 2 0 0 1 .491 2.785l-7.269 10.053-2.147-.066z"/><path d="M4 18h5.523v-1H4zm-2 0h1v-1H2z"/></svg>',history='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11 1a9 9 0 1 1-8.027 13.075l1.128-1.129A7.502 7.502 0 0 0 18.5 10a7.5 7.5 0 1 0-14.962.759l-.745-.746-.76.76A9 9 0 0 1 11 1z"/><path d="M.475 8.17a.75.75 0 0 1 .978.047l.075.082 1.284 1.643 1.681-1.284a.75.75 0 0 1 .978.057l.073.083a.75.75 0 0 1-.057.978l-.083.073-2.27 1.737a.75.75 0 0 1-.973-.052l-.074-.082-1.741-2.23a.75.75 0 0 1 .13-1.052z"/><path d="M11.5 5v4.999l3.196 3.196-1.06 1.06L10.1 10.72l-.1-.113V5z"/></svg>',lowVision='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.085 6.22 2.943 4.078a.75.75 0 1 1 1.06-1.06l2.592 2.59A11.094 11.094 0 0 1 10 5.068c4.738 0 8.578 3.101 8.578 5.083 0 1.197-1.401 2.803-3.555 3.887l1.714 1.713a.75.75 0 0 1-.09 1.138.488.488 0 0 1-.15.084.75.75 0 0 1-.821-.16L6.17 7.304c-.258.11-.51.233-.757.365l6.239 6.24-.006.005.78.78c-.388.094-.78.166-1.174.215l-1.11-1.11h.011L4.55 8.197a7.2 7.2 0 0 0-.665.514l-.112.098 4.897 4.897-.005.006 1.276 1.276a10.164 10.164 0 0 1-1.477-.117l-.479-.479-.009.009-4.863-4.863-.022.031a2.563 2.563 0 0 0-.124.2c-.043.077-.08.158-.108.241a.534.534 0 0 0-.028.133.29.29 0 0 0 .008.072.927.927 0 0 0 .082.226c.067.133.145.26.234.379l3.242 3.365.025.01.59.623c-3.265-.918-5.59-3.155-5.59-4.668 0-1.194 1.448-2.838 3.663-3.93zm7.07.531a4.632 4.632 0 0 1 1.108 5.992l.345.344.046-.018a9.313 9.313 0 0 0 2-1.112c.256-.187.5-.392.727-.613.137-.134.27-.277.392-.431.072-.091.141-.185.203-.286.057-.093.107-.19.148-.292a.72.72 0 0 0 .036-.12.29.29 0 0 0 .008-.072.492.492 0 0 0-.028-.133.999.999 0 0 0-.036-.096 2.165 2.165 0 0 0-.071-.145 2.917 2.917 0 0 0-.125-.2 3.592 3.592 0 0 0-.263-.335 5.444 5.444 0 0 0-.53-.523 7.955 7.955 0 0 0-1.054-.768 9.766 9.766 0 0 0-1.879-.891c-.337-.118-.68-.219-1.027-.301zm-2.85.21-.069.002a.508.508 0 0 0-.254.097.496.496 0 0 0-.104.679.498.498 0 0 0 .326.199l.045.005c.091.003.181.003.272.012a2.45 2.45 0 0 1 2.017 1.513c.024.061.043.125.069.185a.494.494 0 0 0 .45.287h.008a.496.496 0 0 0 .35-.158.482.482 0 0 0 .13-.335.638.638 0 0 0-.048-.219 3.379 3.379 0 0 0-.36-.723 3.438 3.438 0 0 0-2.791-1.543l-.028-.001h-.013z"/></svg>',textAlternative='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.035 1C2.446 1 2 1.54 2 2.098V10.5h1.5v-8h13v8H18V2.098C18 1.539 17.48 1 16.9 1H3.035Zm10.453 2.61a1.885 1.885 0 0 0-1.442.736 1.89 1.89 0 0 0 1.011 2.976 1.903 1.903 0 0 0 2.253-1.114 1.887 1.887 0 0 0-1.822-2.598ZM7.463 8.163a.611.611 0 0 0-.432.154L5.071 10.5h5.119L7.88 8.348a.628.628 0 0 0-.417-.185Zm6.236 1.059a.62.62 0 0 0-.42.164L12.07 10.5h2.969l-.92-1.113a.618.618 0 0 0-.42-.165ZM.91 11.5a.91.91 0 0 0-.91.912v6.877c0 .505.405.91.91.91h18.178a.91.91 0 0 0 .912-.91v-6.877a.908.908 0 0 0-.912-.912H.91ZM3.668 13h1.947l2.135 5.7H5.898l-.28-.946H3.601l-.278.945H1.516L3.668 13Zm4.947 0h1.801v4.3h2.7v1.4h-4.5V13h-.001Zm4.5 0h5.4v1.4h-1.798v4.3h-1.701v-4.3h-1.9V13h-.001Zm-8.517 1.457-.614 2.059h1.262l-.648-2.059Z"/></svg>',loupe='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.68 13.74h-.001l4.209 4.208a1 1 0 1 0 1.414-1.414l-4.267-4.268a6 6 0 1 0-1.355 1.474ZM13 9a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"/></svg>',previousArrow='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.463 5.187a.888.888 0 1 1 1.254 1.255L9.16 10l3.557 3.557a.888.888 0 1 1-1.254 1.255L7.26 10.61a.888.888 0 0 1 .16-1.382l4.043-4.042z"/></svg>',nextArrow='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8.537 14.813a.888.888 0 1 1-1.254-1.255L10.84 10 7.283 6.442a.888.888 0 1 1 1.254-1.255L12.74 9.39a.888.888 0 0 1-.16 1.382l-4.043 4.042z"/></svg>',image='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.66 9.118a.693.693 0 0 1 .956.032l3.65 3.411 2.422-2.238a.695.695 0 0 1 .945 0L17.5 13.6V2.5h-15v11.1l4.16-4.482ZM17.8 1c.652 0 1.2.47 1.2 1.1v14.362c0 .64-.532 1.038-1.184 1.038H2.184C1.532 17.5 1 17.103 1 16.462V2.1C1 1.47 1.537 1 2.2 1h15.6Zm-5.655 6a2.128 2.128 0 0 1 .157-2.364A2.133 2.133 0 1 1 12.145 7Z"/></svg>',imageUpload='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1C.538 1 0 1.47 0 2.1v14.363c0 .64.534 1.037 1.186 1.037h9.494a2.97 2.97 0 0 1-.414-.287 2.998 2.998 0 0 1-1.055-2.03 3.003 3.003 0 0 1 .693-2.185l.383-.455-.02.018-3.65-3.41a.695.695 0 0 0-.957-.034L1.5 13.6V2.5h15v5.535a2.97 2.97 0 0 1 1.412.932l.088.105V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.713 2.803a2.146 2.146 0 0 0-2.049 1.992 2.14 2.14 0 0 0 1.28 2.096 2.13 2.13 0 0 0 2.644-3.11 2.134 2.134 0 0 0-1.875-.978Z"/><path d="M15.522 19.1a.79.79 0 0 0 .79-.79v-5.373l2.059 2.455a.79.79 0 1 0 1.211-1.015l-3.352-3.995a.79.79 0 0 0-.995-.179.784.784 0 0 0-.299.221l-3.35 3.99a.79.79 0 1 0 1.21 1.017l1.936-2.306v5.185c0 .436.353.79.79.79Z"/><path d="M15.522 19.1a.79.79 0 0 0 .79-.79v-5.373l2.059 2.455a.79.79 0 1 0 1.211-1.015l-3.352-3.995a.79.79 0 0 0-.995-.179.784.784 0 0 0-.299.221l-3.35 3.99a.79.79 0 1 0 1.21 1.017l1.936-2.306v5.185c0 .436.353.79.79.79Z"/></svg>',imageAssetManager='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1c-.662 0-1.2.47-1.2 1.1v14.248c0 .64.533 1.152 1.185 1.152h6.623v-7.236L6.617 9.15a.694.694 0 0 0-.957-.033L1.602 13.55V2.553l14.798.003V9.7H18V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.723 2.805a2.094 2.094 0 0 0-1.621.832 2.127 2.127 0 0 0 1.136 3.357 2.13 2.13 0 0 0 2.611-1.506 2.133 2.133 0 0 0-.76-2.244 2.13 2.13 0 0 0-1.366-.44Z"/><path clip-rule="evenodd" d="M19.898 12.369v6.187a.844.844 0 0 1-.844.844h-8.719a.844.844 0 0 1-.843-.844v-7.312a.844.844 0 0 1 .843-.844h2.531a.843.843 0 0 1 .597.248l.838.852h4.75c.223 0 .441.114.6.272a.844.844 0 0 1 .247.597Zm-1.52.654-4.377.02-1.1-1.143H11v6h7.4l-.023-4.877Z"/></svg>',imageUrl='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1C.538 1 0 1.47 0 2.1v14.363c0 .64.534 1.037 1.186 1.037h7.029a5.401 5.401 0 0 1 .615-4.338l.762-1.232-2.975-2.78a.696.696 0 0 0-.957-.033L1.5 13.6V2.5h15v6.023c.449.131.887.32 1.307.573l.058.033c.046.028.09.057.135.086V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.713 2.803a2.15 2.15 0 0 0-1.611.834 2.118 2.118 0 0 0-.438 1.158 2.14 2.14 0 0 0 1.277 2.096 2.132 2.132 0 0 0 2.645-3.11 2.13 2.13 0 0 0-1.873-.978Z"/><path d="M16.63 10.294a3.003 3.003 0 0 0-4.142.887l-.117.177a.647.647 0 0 0-.096.492.664.664 0 0 0 .278.418.7.7 0 0 0 .944-.234 1.741 1.741 0 0 1 2.478-.463 1.869 1.869 0 0 1 .476 2.55.637.637 0 0 0-.071.5.646.646 0 0 0 .309.396.627.627 0 0 0 .869-.19l.027-.041a3.226 3.226 0 0 0-.956-4.492Zm-6.061 3.78-.044.066a3.228 3.228 0 0 0 .82 4.403 3.005 3.005 0 0 0 4.275-.798l.13-.197a.626.626 0 0 0 .092-.475.638.638 0 0 0-.268-.402.713.713 0 0 0-.99.26l-.018.029a1.741 1.741 0 0 1-2.477.461 1.87 1.87 0 0 1-.475-2.55l.029-.047a.647.647 0 0 0 .086-.485.66.66 0 0 0-.275-.408l-.04-.027a.609.609 0 0 0-.845.17Z"/><path d="M15.312 13.925c.24-.36.154-.838-.19-1.067-.346-.23-.82-.124-1.059.236l-1.268 1.907c-.239.36-.153.838.192 1.067.345.23.818.123 1.057-.236l1.268-1.907Z"/></svg>',alignBottom='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.239 13.938-2.88-1.663a.75.75 0 0 1 .75-1.3L9 12.067V4.75a.75.75 0 1 1 1.5 0v7.318l1.89-1.093a.75.75 0 0 1 .75 1.3l-2.879 1.663a.752.752 0 0 1-.511.187.752.752 0 0 1-.511-.187zM4.25 17a.75.75 0 1 1 0-1.5h10.5a.75.75 0 0 1 0 1.5H4.25z"/></svg>',alignMiddle='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.75 11.875a.752.752 0 0 1 .508.184l2.883 1.666a.75.75 0 0 1-.659 1.344l-.091-.044-1.892-1.093.001 4.318a.75.75 0 1 1-1.5 0v-4.317l-1.89 1.092a.75.75 0 0 1-.75-1.3l2.879-1.663a.752.752 0 0 1 .51-.187zM15.25 9a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM9.75.375a.75.75 0 0 1 .75.75v4.318l1.89-1.093.092-.045a.75.75 0 0 1 .659 1.344l-2.883 1.667a.752.752 0 0 1-.508.184.752.752 0 0 1-.511-.187L6.359 5.65a.75.75 0 0 1 .75-1.299L9 5.442V1.125a.75.75 0 0 1 .75-.75z"/></svg>',alignTop='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m10.261 7.062 2.88 1.663a.75.75 0 0 1-.75 1.3L10.5 8.933v7.317a.75.75 0 1 1-1.5 0V8.932l-1.89 1.093a.75.75 0 0 1-.75-1.3l2.879-1.663a.752.752 0 0 1 .511-.187.752.752 0 0 1 .511.187zM15.25 4a.75.75 0 1 1 0 1.5H4.75a.75.75 0 0 1 0-1.5h10.5z"/></svg>',alignLeft='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"/></svg>',alignCenter='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm2.286 4c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75z"/></svg>',alignRight='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M18 3.75a.75.75 0 0 1-.75.75H2.75a.75.75 0 1 1 0-1.5h14.5a.75.75 0 0 1 .75.75zm0 8a.75.75 0 0 1-.75.75H2.75a.75.75 0 1 1 0-1.5h14.5a.75.75 0 0 1 .75.75zm0 4a.75.75 0 0 1-.75.75H7.321a.75.75 0 1 1 0-1.5h9.929a.75.75 0 0 1 .75.75zm0-8a.75.75 0 0 1-.75.75H7.321a.75.75 0 1 1 0-1.5h9.929a.75.75 0 0 1 .75.75z"/></svg>',alignJustify='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"/></svg>',objectBlockLeft='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',objectCenter='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M15.003 7v5.5a1 1 0 0 1-1 1H5.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H6.5V12h6.997V7.5z"/></svg>',objectBlockRight='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M18.003 7v5.5a1 1 0 0 1-1 1H8.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H9.5V12h6.997V7.5z"/></svg>',objectFullWidth='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M18 7v5.5a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1zm-1.505.5H3.504V12h12.991V7.5z"/></svg>',objectInline='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm11.5 9H18v1.5h-4.5zM2 15h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',objectLeft='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm11.5 9H18v1.5h-4.5zm0-3H18v1.5h-4.5zm0-3H18v1.5h-4.5zM2 15h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',objectRight='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2zm0-9h5v1.5H2zm0 3h5v1.5H2zm0 3h5v1.5H2z"/><path d="M18.003 7v5.5a1 1 0 0 1-1 1H8.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H9.5V12h6.997V7.5z"/></svg>',objectSizeFull='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M18.095 2H1.905C.853 2 0 2.895 0 4v12c0 1.105.853 2 1.905 2h16.19C19.147 18 20 17.105 20 16V4c0-1.105-.853-2-1.905-2zm0 1.5c.263 0 .476.224.476.5v12c0 .276-.213.5-.476.5H1.905a.489.489 0 0 1-.476-.5V4c0-.276.213-.5.476-.5h16.19z"/></svg>',objectSizeCustom='<svg xmlns="http://www.w3.org/2000/svg" xmlns:v="https://vecta.io/nano" viewBox="0 0 20 20"><path d="M.95 1.43a.95.95 0 0 0-.95.95v3.1a.95.95 0 0 0 .95.95h.75v6.3H.95a.95.95 0 0 0-.95.95v3.1a.95.95 0 0 0 .95.95h3.1a.95.95 0 0 0 .95-.95v-.65h1.932l1.539-1.5H5v-.95a.95.95 0 0 0-.95-.95H3.2v-6.3h.85A.95.95 0 0 0 5 5.48v-.55h10v.55a.95.95 0 0 0 .95.95h3.1a.95.95 0 0 0 .95-.95v-3.1a.95.95 0 0 0-.95-.95h-3.1a.95.95 0 0 0-.95.95v1.05H5V2.38a.95.95 0 0 0-.95-.95H.95zm.55 3.5v-2h2v2h-2zm0 9.3v2h2v-2h-2zm15-11.3v2h2v-2h-2z"/><path d="M8.139 20.004v-2.388l7.045-7.048 2.391 2.391-7.046 7.046h-2.39zm11.421-9.101a.64.64 0 0 1-.138.206l-1.165 1.168-2.391-2.391 1.167-1.163a.63.63 0 0 1 .206-.138.635.635 0 0 1 .243-.049.63.63 0 0 1 .449.187l1.491 1.488c.059.059.108.129.138.206s.049.16.049.243a.6.6 0 0 1-.049.243z"/></svg>',objectSizeLarge='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 16.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1ZM1 15v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 13v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 11v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 9v1H0V9h1Zm19 0v1h-1V9h1ZM1 7v1H0V7h1Zm19 0v1h-1V7h1ZM1 5v1H0V5h1Zm19 0v1h-1V5h1Zm0-2v1h-1V3h1ZM1 3v1H0V3h1Zm13.5-1.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm-8 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm8 0v1h-1v-1h1Zm-10 0v1h-1v-1h1Z"/><path d="M13 5.5H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2ZM13 7a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-8A.5.5 0 0 1 2 7h11Z"/></svg>',objectSizeSmall='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 16.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1ZM1 15v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 13v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 11v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 9v1H0V9h1Zm19 0v1h-1V9h1ZM1 7v1H0V7h1Zm19 0v1h-1V7h1ZM1 5v1H0V5h1Zm19 0v1h-1V5h1Zm0-2v1h-1V3h1ZM1 3v1H0V3h1Zm13.5-1.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm-8 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm8 0v1h-1v-1h1Zm-10 0v1h-1v-1h1Z"/><path d="M7 9.5H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2ZM7 11a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-4A.5.5 0 0 1 2 11h5Z"/></svg>',objectSizeMedium='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 16.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1ZM1 15v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 13v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 11v1H0v-1h1Zm19 0v1h-1v-1h1ZM1 9v1H0V9h1Zm19 0v1h-1V9h1ZM1 7v1H0V7h1Zm19 0v1h-1V7h1ZM1 5v1H0V5h1Zm19 0v1h-1V5h1Zm0-2v1h-1V3h1ZM1 3v1H0V3h1Zm13.5-1.5v1h-1v-1h1Zm2 0v1h-1v-1h1Zm2 0v1h-1v-1h1Zm-8 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm-2 0v1h-1v-1h1Zm8 0v1h-1v-1h1Zm-10 0v1h-1v-1h1Z"/><path d="M10 7.5H2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2ZM10 9a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-6A.5.5 0 0 1 2 9h8Z"/></svg>',pencil='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m7.3 17.37-.061.088a1.518 1.518 0 0 1-.934.535l-4.178.663-.806-4.153a1.495 1.495 0 0 1 .187-1.058l.056-.086L8.77 2.639c.958-1.351 2.803-1.076 4.296-.03 1.497 1.047 2.387 2.693 1.433 4.055L7.3 17.37zM9.14 4.728l-5.545 8.346 3.277 2.294 5.544-8.346L9.14 4.728zM6.07 16.512l-3.276-2.295.53 2.73 2.746-.435zM9.994 3.506 13.271 5.8c.316-.452-.16-1.333-1.065-1.966-.905-.634-1.895-.78-2.212-.328zM8 18.5 9.375 17H19v1.5H8z"/></svg>',pilcrow='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.999 2H15a1 1 0 0 1 0 2h-1.004v13a1 1 0 1 1-2 0V4H8.999v13a1 1 0 1 1-2 0v-7A4 4 0 0 1 3 6a4 4 0 0 1 3.999-4z"/></svg>',quote='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 10.423a6.5 6.5 0 0 1 6.056-6.408l.038.67C6.448 5.423 5.354 7.663 5.22 10H9c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574zm8 0a6.5 6.5 0 0 1 6.056-6.408l.038.67c-2.646.739-3.74 2.979-3.873 5.315H17c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574z"/></svg>',threeVerticalDots='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><circle cx="9.5" cy="4.5" r="1.5"/><circle cx="9.5" cy="10.5" r="1.5"/><circle cx="9.5" cy="16.5" r="1.5"/></svg>',dragIndicator='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5 3.25a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M12 3.25a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M5 10a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M12 10a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M5 16.75a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/><path d="M12 16.75a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0"/></svg>',bold='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.187 17H5.773c-.637 0-1.092-.138-1.364-.415-.273-.277-.409-.718-.409-1.323V4.738c0-.617.14-1.062.419-1.332.279-.27.73-.406 1.354-.406h4.68c.69 0 1.288.041 1.793.124.506.083.96.242 1.36.478.341.197.644.447.906.75a3.262 3.262 0 0 1 .808 2.162c0 1.401-.722 2.426-2.167 3.075C15.05 10.175 16 11.315 16 13.01a3.756 3.756 0 0 1-2.296 3.504 6.1 6.1 0 0 1-1.517.377c-.571.073-1.238.11-2 .11zm-.217-6.217H7v4.087h3.069c1.977 0 2.965-.69 2.965-2.072 0-.707-.256-1.22-.768-1.537-.512-.319-1.277-.478-2.296-.478zM7 5.13v3.619h2.606c.729 0 1.292-.067 1.69-.2a1.6 1.6 0 0 0 .91-.765c.165-.267.247-.566.247-.897 0-.707-.26-1.176-.778-1.409-.519-.232-1.31-.348-2.375-.348H7z"/></svg>',paragraph='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.5 5.5H7v5h3.5a2.5 2.5 0 1 0 0-5zM5 3h6.5v.025a5 5 0 0 1 0 9.95V13H7v4a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1z"/></svg>',plus='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 0 0-1 1v6H3a1 1 0 1 0 0 2h6v6a1 1 0 1 0 2 0v-6h6a1 1 0 1 0 0-2h-6V3a1 1 0 0 0-1-1Z"/></svg>',text='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.816 11.5 7.038 4.785 4.261 11.5h5.555Zm.62 1.5H3.641l-1.666 4.028H.312l5.789-14h1.875l5.789 14h-1.663L10.436 13Z"/><path d="m12.09 17-.534-1.292.848-1.971.545 1.319L12.113 17h-.023Zm1.142-5.187.545 1.319L15.5 9.13l1.858 4.316h-3.45l.398.965h3.467L18.887 17H20l-3.873-9h-1.254l-1.641 3.813Z"/></svg>',importExport='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M19 4.5 14 0H3v12.673l.868-1.041c.185-.222.4-.402.632-.54V1.5h8v5h5v7.626a2.24 2.24 0 0 1 1.5.822V4.5ZM14 5V2l3.3 3H14Zm-3.692 12.5c.062.105.133.206.213.303L11.52 19H8v-.876a2.243 2.243 0 0 0 1.82-.624h.488Zm7.518-.657a.75.75 0 0 0-1.152-.96L15.5 17.29V12H14v5.29l-1.174-1.408a.75.75 0 0 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Zm-15.056-.38a.75.75 0 0 1-.096-1.056l2.346-2.815a.95.95 0 0 1 1.46 0l2.346 2.815a.75.75 0 1 1-1.152.96L6.5 14.96V20H5v-5.04l-1.174 1.408a.75.75 0 0 1-1.056.096Z"/></svg>',redo='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14.958 9.367-2.189 1.837a.75.75 0 0 0 .965 1.149l3.788-3.18a.747.747 0 0 0 .21-.284.75.75 0 0 0-.17-.945L13.77 4.762a.75.75 0 1 0-.964 1.15l2.331 1.955H6.22A.75.75 0 0 0 6 7.9a4 4 0 1 0 1.477 7.718l-.344-1.489A2.5 2.5 0 1 1 6.039 9.4l-.008-.032h8.927z"/></svg>',undo='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m5.042 9.367 2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z"/></svg>',bulletedList='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0C1 4.784 1.777 4 2.75 4c.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75C1.784 7.5 1 6.723 1 5.75zm6 9c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0c0-.966.777-1.75 1.75-1.75.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75-.966 0-1.75-.777-1.75-1.75z"/></svg>',numberedList='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM3.5 3v5H2V3.7H1v-1h2.5V3zM.343 17.857l2.59-3.257H2.92a.6.6 0 1 0-1.04 0H.302a2 2 0 1 1 3.995 0h-.001c-.048.405-.16.734-.333.988-.175.254-.59.692-1.244 1.312H4.3v1h-4l.043-.043zM7 14.75a.75.75 0 0 1 .75-.75h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75z"/></svg>',todoList='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m2.315 14.705 2.224-2.24a.689.689 0 0 1 .963 0 .664.664 0 0 1 0 .949L2.865 16.07a.682.682 0 0 1-.112.089.647.647 0 0 1-.852-.051L.688 14.886a.635.635 0 0 1 0-.903.647.647 0 0 1 .91 0l.717.722zm5.185.045a.75.75 0 0 1 .75-.75h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75zM2.329 5.745l2.21-2.226a.689.689 0 0 1 .963 0 .664.664 0 0 1 0 .95L2.865 7.125a.685.685 0 0 1-.496.196.644.644 0 0 1-.468-.187L.688 5.912a.635.635 0 0 1 0-.903.647.647 0 0 1 .91 0l.73.736zM7.5 5.75A.75.75 0 0 1 8.25 5h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75z"/></svg>',codeBlock='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.87 12.61a.75.75 0 0 1-.089.976l-.085.07-3.154 2.254 3.412 2.414a.75.75 0 0 1 .237.95l-.057.095a.75.75 0 0 1-.95.237l-.096-.058-4.272-3.022-.003-1.223 4.01-2.867a.75.75 0 0 1 1.047.174zm2.795-.231.095.057 4.011 2.867-.003 1.223-4.272 3.022-.095.058a.75.75 0 0 1-.88-.151l-.07-.086-.058-.095a.75.75 0 0 1 .15-.88l.087-.07 3.412-2.414-3.154-2.253-.085-.071a.75.75 0 0 1 .862-1.207zM16 0a2 2 0 0 1 2 2v9.354l-.663-.492-.837-.001V2a.5.5 0 0 0-.5-.5H2a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h3.118L7.156 19H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h14zM5.009 15l.003 1H3v-1h2.009zm2.188-2-1.471 1H5v-1h2.197zM10 11v.095L8.668 12H7v-1h3zm4-2v1H7V9h7zm0-2v1H7V7h7zm-4-2v1H5V5h5zM6 3v1H3V3h3z"/></svg>',browseFiles='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.627 16.5zm5.873-.196zm0-7.001V8h-13v8.5h4.341c.191.54.457 1.044.785 1.5H2a1.5 1.5 0 0 1-1.5-1.5v-13A1.5 1.5 0 0 1 2 2h4.5a1.5 1.5 0 0 1 1.06.44L9.122 4H16a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 19 8v2.531a6.027 6.027 0 0 0-1.5-1.228zM16 6.5v-1H8.5l-2-2H2v13h1V8a1.5 1.5 0 0 1 1.5-1.5H16z"/><path d="M14.5 19.5a5 5 0 1 1 0-10 5 5 0 0 1 0 10zM15 14v-2h-1v2h-2v1h2v2h1v-2h2v-1h-2z"/></svg>',heading1='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M19 9v10h-2v-8h-2V9h4zM4 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1H10a1 1 0 0 1-1-1V11H4v4.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1H3a1 1 0 0 1 1 1v4.5z"/></svg>',heading2='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V11H3v4.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1H2a1 1 0 0 1 1 1v4.5zm16.076 8.343V18.5h-6.252c.067-.626.27-1.22.61-1.78.338-.561 1.006-1.305 2.005-2.232.804-.749 1.297-1.257 1.479-1.523.245-.368.368-.732.368-1.092 0-.398-.107-.703-.32-.917-.214-.214-.51-.32-.886-.32-.372 0-.669.111-.889.336-.22.224-.347.596-.38 1.117l-1.778-.178c.106-.982.438-1.686.997-2.114.558-.427 1.257-.64 2.095-.64.918 0 1.64.247 2.164.742.525.495.787 1.11.787 1.847 0 .419-.075.818-.225 1.197-.15.378-.388.775-.714 1.19-.216.275-.605.67-1.168 1.187-.563.516-.92.859-1.07 1.028a3.11 3.11 0 0 0-.365.495h3.542z"/></svg>',heading3='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V11H3v4.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1H2a1 1 0 0 1 1 1v4.5zm9.989 7.53 1.726-.209c.055.44.203.777.445 1.01.24.232.533.349.876.349.368 0 .678-.14.93-.42.251-.279.377-.655.377-1.13 0-.448-.12-.803-.362-1.066a1.153 1.153 0 0 0-.882-.393c-.228 0-.501.044-.819.133l.197-1.453c.482.012.85-.092 1.105-.315.253-.222.38-.517.38-.885 0-.313-.093-.563-.279-.75-.186-.185-.434-.278-.743-.278a1.07 1.07 0 0 0-.78.317c-.216.212-.347.52-.394.927l-1.644-.28c.114-.562.287-1.012.517-1.348.231-.337.553-.601.965-.794a3.24 3.24 0 0 1 1.387-.289c.876 0 1.579.28 2.108.838.436.457.653.973.653 1.549 0 .817-.446 1.468-1.339 1.955.533.114.96.37 1.28.768.319.398.478.878.478 1.441 0 .817-.298 1.513-.895 2.088-.596.576-1.339.864-2.228.864-.842 0-1.54-.243-2.094-.727-.555-.485-.876-1.118-.965-1.901z"/></svg>',heading4='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V11h-5v4.5a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v4.5zm13.55 10v-1.873h-3.81v-1.561l4.037-5.91h1.498v5.904h1.156v1.567h-1.156V18.5H17.05zm0-3.44v-3.18l-2.14 3.18h2.14z"/></svg>',heading5='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V11h-5v4.5a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v4.5zm9.578 7.607 1.777-.184c.05.402.201.72.45.955a1.223 1.223 0 0 0 1.81-.101c.258-.303.387-.759.387-1.368 0-.572-.128-1-.384-1.286-.256-.285-.59-.428-1-.428-.512 0-.971.226-1.377.679l-1.448-.21.915-4.843h4.716v1.67H15.56l-.28 1.58a2.697 2.697 0 0 1 1.219-.298 2.68 2.68 0 0 1 2.012.863c.55.576.825 1.323.825 2.241a3.36 3.36 0 0 1-.666 2.05c-.605.821-1.445 1.232-2.52 1.232-.86 0-1.56-.23-2.101-.692-.542-.461-.866-1.081-.971-1.86z"/></svg>',heading6='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 8.5h5V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v11.5a1 1 0 0 1-1 1h-.5a1 1 0 0 1-1-1V11h-5v4.5a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h.5a1 1 0 0 1 1 1v4.5zm15.595 2.973-1.726.19c-.043-.355-.153-.617-.33-.787-.178-.169-.409-.253-.692-.253-.377 0-.695.169-.956.507-.26.339-.424 1.043-.492 2.114.445-.525.997-.787 1.657-.787.745 0 1.383.284 1.914.85.531.568.797 1.3.797 2.197 0 .952-.28 1.716-.838 2.291-.559.576-1.276.864-2.152.864-.94 0-1.712-.365-2.317-1.095-.605-.73-.908-1.927-.908-3.59 0-1.705.316-2.935.946-3.688.63-.753 1.45-1.13 2.457-1.13.706 0 1.291.198 1.755.594.463.395.758.97.885 1.723zm-4.043 3.891c0 .58.133 1.028.4 1.343.266.315.57.473.914.473.33 0 .605-.13.825-.388.22-.258.33-.68.33-1.27 0-.604-.118-1.047-.355-1.329a1.115 1.115 0 0 0-.89-.422c-.342 0-.632.134-.869.403s-.355.666-.355 1.19z"/></svg>',horizontalLine='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 9h16v2H2z"/></svg>',html='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17 0a2 2 0 0 1 2 2v7a1 1 0 0 1 1 1v5a1 1 0 0 1-.883.993l-.118.006L19 17a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2l-.001-1.001-.116-.006A1 1 0 0 1 0 15v-5a1 1 0 0 1 .999-1L1 2a2 2 0 0 1 2-2h14zm.499 15.999h-15L2.5 17a.5.5 0 0 0 .5.5h14a.5.5 0 0 0 .5-.5l-.001-1.001zm-3.478-6.013-.014.014H14v.007l-1.525 1.525-1.46-1.46-.015.013V10h-1v5h1v-3.53l1.428 1.43.048.043.131-.129L14 11.421V15h1v-5h-.965l-.014-.014zM2 10H1v5h1v-2h2v2h1v-5H4v2H2v-2zm7 0H6v1h1v4h1v-4h1v-1zm8 0h-1v5h3v-1h-2v-4zm0-8.5H3a.5.5 0 0 0-.5.5l-.001 6.999h15L17.5 2a.5.5 0 0 0-.5-.5zM10 7v1H4V7h6zm3-2v1H4V5h9zm-3-2v1H4V3h6z"/></svg>',indent='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm5 6c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM2.75 16.5h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 1 0 0 1.5zM1.632 6.95 5.02 9.358a.4.4 0 0 1-.013.661l-3.39 2.207A.4.4 0 0 1 1 11.892V7.275a.4.4 0 0 1 .632-.326z"/></svg>',outdent='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm5 6c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM2.75 16.5h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 1 0 0 1.5zm1.618-9.55L.98 9.358a.4.4 0 0 0 .013.661l3.39 2.207A.4.4 0 0 0 5 11.892V7.275a.4.4 0 0 0-.632-.326z"/></svg>',table='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 5.5v3h4v-3H3Zm0 4v3h4v-3H3Zm0 4v3h4v-3H3Zm5 3h4v-3H8v3Zm5 0h4v-3h-4v3Zm4-4v-3h-4v3h4Zm0-4v-3h-4v3h4Zm1.5 8A1.5 1.5 0 0 1 17 18H3a1.5 1.5 0 0 1-1.5-1.5V3c.222-.863 1.068-1.5 2-1.5h13c.932 0 1.778.637 2 1.5v13.5Zm-6.5-4v-3H8v3h4Zm0-4v-3H8v3h4Z"/></svg>';const icons={bold,cancel,caption,check,cog,colorPalette,eraser,history,image,imageUpload,imageAssetManager,imageUrl,lowVision,textAlternative,loupe,previousArrow,nextArrow,importExport,paragraph,plus,text,alignBottom,alignMiddle,alignTop,alignLeft,alignCenter,alignRight,alignJustify,objectLeft,objectCenter,objectRight,objectFullWidth,objectInline,objectBlockLeft,objectBlockRight,objectSizeCustom,objectSizeFull,objectSizeLarge,objectSizeSmall,objectSizeMedium,pencil,pilcrow,quote,threeVerticalDots,dragIndicator,redo,undo,bulletedList,numberedList,todoList,codeBlock,browseFiles,heading1,heading2,heading3,heading4,heading5,heading6,horizontalLine,html,indent,outdent,table};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let FileReader$1=class extends ObservableMixin(){constructor(){super();ee(this,"total");ee(this,"_reader");ee(this,"_data");const t=new window.FileReader;this._reader=t,this._data=void 0,this.set("loaded",0),t.onprogress=V=>{this.loaded=V.loaded}}get error(){return this._reader.error}get data(){return this._data}read(t){const V=this._reader;return this.total=t.size,new Promise((N,W)=>{V.onload=()=>{const K=V.result;this._data=K,N(K)},V.onerror=()=>{W("error")},V.onabort=()=>{W("aborted")},this._reader.readAsDataURL(t)})}abort(){this._reader.abort()}};class FileRepository extends Plugin{constructor(){super(...arguments);ee(this,"loaders",new Collection);ee(this,"_loadersMap",new Map);ee(this,"_pendingAction",null)}static get pluginName(){return"FileRepository"}static get requires(){return[PendingActions]}init(){this.loaders.on("change",()=>this._updatePendingAction()),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(t,V)=>V?t/V*100:0)}getLoader(t){return this._loadersMap.get(t)||null}createLoader(t){if(!this.createUploadAdapter)return logWarning("filerepository-no-upload-adapter"),null;const V=new FileLoader(Promise.resolve(t),this.createUploadAdapter);return this.loaders.add(V),this._loadersMap.set(t,V),t instanceof Promise&&V.file.then(N=>{this._loadersMap.set(N,V)}).catch(()=>{}),V.on("change:uploaded",()=>{let N=0;for(const W of this.loaders)N+=W.uploaded;this.uploaded=N}),V.on("change:uploadTotal",()=>{let N=0;for(const W of this.loaders)W.uploadTotal&&(N+=W.uploadTotal);this.uploadTotal=N}),V}destroyLoader(t){const V=t instanceof FileLoader?t:this.getLoader(t);V._destroy(),this.loaders.remove(V),this._loadersMap.forEach((N,W)=>{N===V&&this._loadersMap.delete(W)})}_updatePendingAction(){const t=this.editor.plugins.get(PendingActions);if(this.loaders.length){if(!this._pendingAction){const V=this.editor.t,N=W=>`${V("Upload in progress")} ${parseInt(W)}%.`;this._pendingAction=t.add(N(this.uploadedPercent)),this._pendingAction.bind("message").to(this,"uploadedPercent",N)}}else t.remove(this._pendingAction),this._pendingAction=null}}class FileLoader extends ObservableMixin(){constructor(t,V){super();ee(this,"id");ee(this,"_filePromiseWrapper");ee(this,"_adapter");ee(this,"_reader");this.id=uid(),this._filePromiseWrapper=this._createFilePromiseWrapper(t),this._adapter=V(this),this._reader=new FileReader$1,this.set("status","idle"),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(N,W)=>W?N/W*100:0),this.set("uploadResponse",null)}get file(){return this._filePromiseWrapper?this._filePromiseWrapper.promise.then(t=>this._filePromiseWrapper?t:null):Promise.resolve(null)}get data(){return this._reader.data}read(){if(this.status!="idle")throw new CKEditorError("filerepository-read-wrong-status",this);return this.status="reading",this.file.then(t=>this._reader.read(t)).then(t=>{if(this.status!=="reading")throw this.status;return this.status="idle",t}).catch(t=>{throw t==="aborted"?(this.status="aborted","aborted"):(this.status="error",this._reader.error?this._reader.error:t)})}upload(){if(this.status!="idle")throw new CKEditorError("filerepository-upload-wrong-status",this);return this.status="uploading",this.file.then(()=>this._adapter.upload()).then(t=>(this.uploadResponse=t,this.status="idle",t)).catch(t=>{throw this.status==="aborted"?"aborted":(this.status="error",t)})}abort(){const t=this.status;this.status="aborted",this._filePromiseWrapper.isFulfilled?t=="reading"?this._reader.abort():t=="uploading"&&this._adapter.abort&&this._adapter.abort():(this._filePromiseWrapper.promise.catch(()=>{}),this._filePromiseWrapper.rejecter("aborted")),this._destroy()}_destroy(){this._filePromiseWrapper=void 0,this._reader=void 0,this._adapter=void 0,this.uploadResponse=void 0}_createFilePromiseWrapper(t){const V={};return V.promise=new Promise((N,W)=>{V.rejecter=W,V.isFulfilled=!1,t.then(K=>{V.isFulfilled=!0,N(K)}).catch(K=>{V.isFulfilled=!0,W(K)})}),V}}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(H){return H&&H.__esModule&&Object.prototype.hasOwnProperty.call(H,"default")?H.default:H}var colorName$1={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const names=getDefaultExportFromCjs(colorName$1);var baseHues={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function parse$1(H){var B,t=[],V=1,N;if(typeof H=="string")if(names[H])t=names[H].slice(),N="rgb";else if(H==="transparent")V=0,N="rgb",t=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(H)){var W=H.slice(1),K=W.length,G=K<=4;V=1,G?(t=[parseInt(W[0]+W[0],16),parseInt(W[1]+W[1],16),parseInt(W[2]+W[2],16)],K===4&&(V=parseInt(W[3]+W[3],16)/255)):(t=[parseInt(W[0]+W[1],16),parseInt(W[2]+W[3],16),parseInt(W[4]+W[5],16)],K===8&&(V=parseInt(W[6]+W[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),N="rgb"}else if(B=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(H)){var Z=B[1],Y=Z==="rgb",W=Z.replace(/a$/,"");N=W;var K=W==="cmyk"?4:W==="gray"?1:3;t=B[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(te,ie){if(/%$/.test(te))return ie===K?parseFloat(te)/100:W==="rgb"?parseFloat(te)*255/100:parseFloat(te);if(W[ie]==="h"){if(/deg$/.test(te))return parseFloat(te);if(baseHues[te]!==void 0)return baseHues[te]}return parseFloat(te)}),Z===W&&t.push(1),V=Y||t[K]===void 0?1:t[K],t=t.slice(0,K)}else H.length>10&&/[0-9](?:\s|\/)/.test(H)&&(t=H.match(/([0-9]+)/g).map(function(X){return parseFloat(X)}),N=H.match(/([a-z])/ig).join("").toLowerCase());else isNaN(H)?Array.isArray(H)||H.length?(t=[H[0],H[1],H[2]],N="rgb",V=H.length===4?H[3]:1):H instanceof Object&&(H.r!=null||H.red!=null||H.R!=null?(N="rgb",t=[H.r||H.red||H.R||0,H.g||H.green||H.G||0,H.b||H.blue||H.B||0]):(N="hsl",t=[H.h||H.hue||H.H||0,H.s||H.saturation||H.S||0,H.l||H.lightness||H.L||H.b||H.brightness]),V=H.a||H.alpha||H.opacity||1,H.opacity!=null&&(V/=100)):(N="rgb",t=[H>>>16,(H&65280)>>>8,H&255]);return{space:N,values:t,alpha:V}}var colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};const cssKeywords=colorName,reverseKeywords={};for(const H of Object.keys(cssKeywords))reverseKeywords[cssKeywords[H]]=H;const convert$2={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};var conversions$2=convert$2;for(const H of Object.keys(convert$2)){if(!("channels"in convert$2[H]))throw new Error("missing channels property: "+H);if(!("labels"in convert$2[H]))throw new Error("missing channel labels property: "+H);if(convert$2[H].labels.length!==convert$2[H].channels)throw new Error("channel and label counts mismatch: "+H);const{channels:B,labels:t}=convert$2[H];delete convert$2[H].channels,delete convert$2[H].labels,Object.defineProperty(convert$2[H],"channels",{value:B}),Object.defineProperty(convert$2[H],"labels",{value:t})}convert$2.rgb.hsl=function(H){const B=H[0]/255,t=H[1]/255,V=H[2]/255,N=Math.min(B,t,V),W=Math.max(B,t,V),K=W-N;let G,Z;W===N?G=0:B===W?G=(t-V)/K:t===W?G=2+(V-B)/K:V===W&&(G=4+(B-t)/K),G=Math.min(G*60,360),G<0&&(G+=360);const Y=(N+W)/2;return W===N?Z=0:Y<=.5?Z=K/(W+N):Z=K/(2-W-N),[G,Z*100,Y*100]};convert$2.rgb.hsv=function(H){let B,t,V,N,W;const K=H[0]/255,G=H[1]/255,Z=H[2]/255,Y=Math.max(K,G,Z),X=Y-Math.min(K,G,Z),Q=function(te){return(Y-te)/6/X+1/2};return X===0?(N=0,W=0):(W=X/Y,B=Q(K),t=Q(G),V=Q(Z),K===Y?N=V-t:G===Y?N=1/3+B-V:Z===Y&&(N=2/3+t-B),N<0?N+=1:N>1&&(N-=1)),[N*360,W*100,Y*100]};convert$2.rgb.hwb=function(H){const B=H[0],t=H[1];let V=H[2];const N=convert$2.rgb.hsl(H)[0],W=1/255*Math.min(B,Math.min(t,V));return V=1-1/255*Math.max(B,Math.max(t,V)),[N,W*100,V*100]};convert$2.rgb.cmyk=function(H){const B=H[0]/255,t=H[1]/255,V=H[2]/255,N=Math.min(1-B,1-t,1-V),W=(1-B-N)/(1-N)||0,K=(1-t-N)/(1-N)||0,G=(1-V-N)/(1-N)||0;return[W*100,K*100,G*100,N*100]};function comparativeDistance(H,B){return(H[0]-B[0])**2+(H[1]-B[1])**2+(H[2]-B[2])**2}convert$2.rgb.keyword=function(H){const B=reverseKeywords[H];if(B)return B;let t=1/0,V;for(const N of Object.keys(cssKeywords)){const W=cssKeywords[N],K=comparativeDistance(H,W);K<t&&(t=K,V=N)}return V};convert$2.keyword.rgb=function(H){return cssKeywords[H]};convert$2.rgb.xyz=function(H){let B=H[0]/255,t=H[1]/255,V=H[2]/255;B=B>.04045?((B+.055)/1.055)**2.4:B/12.92,t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,V=V>.04045?((V+.055)/1.055)**2.4:V/12.92;const N=B*.4124+t*.3576+V*.1805,W=B*.2126+t*.7152+V*.0722,K=B*.0193+t*.1192+V*.9505;return[N*100,W*100,K*100]};convert$2.rgb.lab=function(H){const B=convert$2.rgb.xyz(H);let t=B[0],V=B[1],N=B[2];t/=95.047,V/=100,N/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,V=V>.008856?V**(1/3):7.787*V+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;const W=116*V-16,K=500*(t-V),G=200*(V-N);return[W,K,G]};convert$2.hsl.rgb=function(H){const B=H[0]/360,t=H[1]/100,V=H[2]/100;let N,W,K;if(t===0)return K=V*255,[K,K,K];V<.5?N=V*(1+t):N=V+t-V*t;const G=2*V-N,Z=[0,0,0];for(let Y=0;Y<3;Y++)W=B+1/3*-(Y-1),W<0&&W++,W>1&&W--,6*W<1?K=G+(N-G)*6*W:2*W<1?K=N:3*W<2?K=G+(N-G)*(2/3-W)*6:K=G,Z[Y]=K*255;return Z};convert$2.hsl.hsv=function(H){const B=H[0];let t=H[1]/100,V=H[2]/100,N=t;const W=Math.max(V,.01);V*=2,t*=V<=1?V:2-V,N*=W<=1?W:2-W;const K=(V+t)/2,G=V===0?2*N/(W+N):2*t/(V+t);return[B,G*100,K*100]};convert$2.hsv.rgb=function(H){const B=H[0]/60,t=H[1]/100;let V=H[2]/100;const N=Math.floor(B)%6,W=B-Math.floor(B),K=255*V*(1-t),G=255*V*(1-t*W),Z=255*V*(1-t*(1-W));switch(V*=255,N){case 0:return[V,Z,K];case 1:return[G,V,K];case 2:return[K,V,Z];case 3:return[K,G,V];case 4:return[Z,K,V];case 5:return[V,K,G]}};convert$2.hsv.hsl=function(H){const B=H[0],t=H[1]/100,V=H[2]/100,N=Math.max(V,.01);let W,K;K=(2-t)*V;const G=(2-t)*N;return W=t*N,W/=G<=1?G:2-G,W=W||0,K/=2,[B,W*100,K*100]};convert$2.hwb.rgb=function(H){const B=H[0]/360;let t=H[1]/100,V=H[2]/100;const N=t+V;let W;N>1&&(t/=N,V/=N);const K=Math.floor(6*B),G=1-V;W=6*B-K,K&1&&(W=1-W);const Z=t+W*(G-t);let Y,X,Q;switch(K){default:case 6:case 0:Y=G,X=Z,Q=t;break;case 1:Y=Z,X=G,Q=t;break;case 2:Y=t,X=G,Q=Z;break;case 3:Y=t,X=Z,Q=G;break;case 4:Y=Z,X=t,Q=G;break;case 5:Y=G,X=t,Q=Z;break}return[Y*255,X*255,Q*255]};convert$2.cmyk.rgb=function(H){const B=H[0]/100,t=H[1]/100,V=H[2]/100,N=H[3]/100,W=1-Math.min(1,B*(1-N)+N),K=1-Math.min(1,t*(1-N)+N),G=1-Math.min(1,V*(1-N)+N);return[W*255,K*255,G*255]};convert$2.xyz.rgb=function(H){const B=H[0]/100,t=H[1]/100,V=H[2]/100;let N,W,K;return N=B*3.2406+t*-1.5372+V*-.4986,W=B*-.9689+t*1.8758+V*.0415,K=B*.0557+t*-.204+V*1.057,N=N>.0031308?1.055*N**(1/2.4)-.055:N*12.92,W=W>.0031308?1.055*W**(1/2.4)-.055:W*12.92,K=K>.0031308?1.055*K**(1/2.4)-.055:K*12.92,N=Math.min(Math.max(0,N),1),W=Math.min(Math.max(0,W),1),K=Math.min(Math.max(0,K),1),[N*255,W*255,K*255]};convert$2.xyz.lab=function(H){let B=H[0],t=H[1],V=H[2];B/=95.047,t/=100,V/=108.883,B=B>.008856?B**(1/3):7.787*B+16/116,t=t>.008856?t**(1/3):7.787*t+16/116,V=V>.008856?V**(1/3):7.787*V+16/116;const N=116*t-16,W=500*(B-t),K=200*(t-V);return[N,W,K]};convert$2.lab.xyz=function(H){const B=H[0],t=H[1],V=H[2];let N,W,K;W=(B+16)/116,N=t/500+W,K=W-V/200;const G=W**3,Z=N**3,Y=K**3;return W=G>.008856?G:(W-16/116)/7.787,N=Z>.008856?Z:(N-16/116)/7.787,K=Y>.008856?Y:(K-16/116)/7.787,N*=95.047,W*=100,K*=108.883,[N,W,K]};convert$2.lab.lch=function(H){const B=H[0],t=H[1],V=H[2];let N;N=Math.atan2(V,t)*360/2/Math.PI,N<0&&(N+=360);const K=Math.sqrt(t*t+V*V);return[B,K,N]};convert$2.lch.lab=function(H){const B=H[0],t=H[1],N=H[2]/360*2*Math.PI,W=t*Math.cos(N),K=t*Math.sin(N);return[B,W,K]};convert$2.rgb.ansi16=function(H,B=null){const[t,V,N]=H;let W=B===null?convert$2.rgb.hsv(H)[2]:B;if(W=Math.round(W/50),W===0)return 30;let K=30+(Math.round(N/255)<<2|Math.round(V/255)<<1|Math.round(t/255));return W===2&&(K+=60),K};convert$2.hsv.ansi16=function(H){return convert$2.rgb.ansi16(convert$2.hsv.rgb(H),H[2])};convert$2.rgb.ansi256=function(H){const B=H[0],t=H[1],V=H[2];return B===t&&t===V?B<8?16:B>248?231:Math.round((B-8)/247*24)+232:16+36*Math.round(B/255*5)+6*Math.round(t/255*5)+Math.round(V/255*5)};convert$2.ansi16.rgb=function(H){let B=H%10;if(B===0||B===7)return H>50&&(B+=3.5),B=B/10.5*255,[B,B,B];const t=(~~(H>50)+1)*.5,V=(B&1)*t*255,N=(B>>1&1)*t*255,W=(B>>2&1)*t*255;return[V,N,W]};convert$2.ansi256.rgb=function(H){if(H>=232){const W=(H-232)*10+8;return[W,W,W]}H-=16;let B;const t=Math.floor(H/36)/5*255,V=Math.floor((B=H%36)/6)/5*255,N=B%6/5*255;return[t,V,N]};convert$2.rgb.hex=function(H){const t=(((Math.round(H[0])&255)<<16)+((Math.round(H[1])&255)<<8)+(Math.round(H[2])&255)).toString(16).toUpperCase();return"000000".substring(t.length)+t};convert$2.hex.rgb=function(H){const B=H.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!B)return[0,0,0];let t=B[0];B[0].length===3&&(t=t.split("").map(G=>G+G).join(""));const V=parseInt(t,16),N=V>>16&255,W=V>>8&255,K=V&255;return[N,W,K]};convert$2.rgb.hcg=function(H){const B=H[0]/255,t=H[1]/255,V=H[2]/255,N=Math.max(Math.max(B,t),V),W=Math.min(Math.min(B,t),V),K=N-W;let G,Z;return K<1?G=W/(1-K):G=0,K<=0?Z=0:N===B?Z=(t-V)/K%6:N===t?Z=2+(V-B)/K:Z=4+(B-t)/K,Z/=6,Z%=1,[Z*360,K*100,G*100]};convert$2.hsl.hcg=function(H){const B=H[1]/100,t=H[2]/100,V=t<.5?2*B*t:2*B*(1-t);let N=0;return V<1&&(N=(t-.5*V)/(1-V)),[H[0],V*100,N*100]};convert$2.hsv.hcg=function(H){const B=H[1]/100,t=H[2]/100,V=B*t;let N=0;return V<1&&(N=(t-V)/(1-V)),[H[0],V*100,N*100]};convert$2.hcg.rgb=function(H){const B=H[0]/360,t=H[1]/100,V=H[2]/100;if(t===0)return[V*255,V*255,V*255];const N=[0,0,0],W=B%1*6,K=W%1,G=1-K;let Z=0;switch(Math.floor(W)){case 0:N[0]=1,N[1]=K,N[2]=0;break;case 1:N[0]=G,N[1]=1,N[2]=0;break;case 2:N[0]=0,N[1]=1,N[2]=K;break;case 3:N[0]=0,N[1]=G,N[2]=1;break;case 4:N[0]=K,N[1]=0,N[2]=1;break;default:N[0]=1,N[1]=0,N[2]=G}return Z=(1-t)*V,[(t*N[0]+Z)*255,(t*N[1]+Z)*255,(t*N[2]+Z)*255]};convert$2.hcg.hsv=function(H){const B=H[1]/100,t=H[2]/100,V=B+t*(1-B);let N=0;return V>0&&(N=B/V),[H[0],N*100,V*100]};convert$2.hcg.hsl=function(H){const B=H[1]/100,V=H[2]/100*(1-B)+.5*B;let N=0;return V>0&&V<.5?N=B/(2*V):V>=.5&&V<1&&(N=B/(2*(1-V))),[H[0],N*100,V*100]};convert$2.hcg.hwb=function(H){const B=H[1]/100,t=H[2]/100,V=B+t*(1-B);return[H[0],(V-B)*100,(1-V)*100]};convert$2.hwb.hcg=function(H){const B=H[1]/100,V=1-H[2]/100,N=V-B;let W=0;return N<1&&(W=(V-N)/(1-N)),[H[0],N*100,W*100]};convert$2.apple.rgb=function(H){return[H[0]/65535*255,H[1]/65535*255,H[2]/65535*255]};convert$2.rgb.apple=function(H){return[H[0]/255*65535,H[1]/255*65535,H[2]/255*65535]};convert$2.gray.rgb=function(H){return[H[0]/100*255,H[0]/100*255,H[0]/100*255]};convert$2.gray.hsl=function(H){return[0,0,H[0]]};convert$2.gray.hsv=convert$2.gray.hsl;convert$2.gray.hwb=function(H){return[0,100,H[0]]};convert$2.gray.cmyk=function(H){return[0,0,0,H[0]]};convert$2.gray.lab=function(H){return[H[0],0,0]};convert$2.gray.hex=function(H){const B=Math.round(H[0]/100*255)&255,V=((B<<16)+(B<<8)+B).toString(16).toUpperCase();return"000000".substring(V.length)+V};convert$2.rgb.gray=function(H){return[(H[0]+H[1]+H[2])/3/255*100]};const conversions$1=conversions$2;function buildGraph(){const H={},B=Object.keys(conversions$1);for(let t=B.length,V=0;V<t;V++)H[B[V]]={distance:-1,parent:null};return H}function deriveBFS(H){const B=buildGraph(),t=[H];for(B[H].distance=0;t.length;){const V=t.pop(),N=Object.keys(conversions$1[V]);for(let W=N.length,K=0;K<W;K++){const G=N[K],Z=B[G];Z.distance===-1&&(Z.distance=B[V].distance+1,Z.parent=V,t.unshift(G))}}return B}function link(H,B){return function(t){return B(H(t))}}function wrapConversion(H,B){const t=[B[H].parent,H];let V=conversions$1[B[H].parent][H],N=B[H].parent;for(;B[N].parent;)t.unshift(B[N].parent),V=link(conversions$1[B[N].parent][N],V),N=B[N].parent;return V.conversion=t,V}var route$1=function(H){const B=deriveBFS(H),t={},V=Object.keys(B);for(let N=V.length,W=0;W<N;W++){const K=V[W];B[K].parent!==null&&(t[K]=wrapConversion(K,B))}return t};const conversions=conversions$2,route=route$1,convert={},models=Object.keys(conversions);function wrapRaw(H){const B=function(...t){const V=t[0];return V==null?V:(V.length>1&&(t=V),H(t))};return"conversion"in H&&(B.conversion=H.conversion),B}function wrapRounded(H){const B=function(...t){const V=t[0];if(V==null)return V;V.length>1&&(t=V);const N=H(t);if(typeof N=="object")for(let W=N.length,K=0;K<W;K++)N[K]=Math.round(N[K]);return N};return"conversion"in H&&(B.conversion=H.conversion),B}models.forEach(H=>{convert[H]={},Object.defineProperty(convert[H],"channels",{value:conversions[H].channels}),Object.defineProperty(convert[H],"labels",{value:conversions[H].labels});const B=route(H);Object.keys(B).forEach(V=>{const N=B[V];convert[H][V]=wrapRounded(N),convert[H][V].raw=wrapRaw(N)})});var colorConvert=convert;const index=getDefaultExportFromCjs(colorConvert),convert$1=_mergeNamespaces({__proto__:null,default:index},[colorConvert]),clamp$1=(H,B=0,t=1)=>H>t?t:H<B?B:H,round=(H,B=0,t=Math.pow(10,B))=>Math.round(t*H)/t,hexToHsva=H=>rgbaToHsva(hexToRgba(H)),hexToRgba=H=>(H[0]==="#"&&(H=H.substring(1)),H.length<6?{r:parseInt(H[0]+H[0],16),g:parseInt(H[1]+H[1],16),b:parseInt(H[2]+H[2],16),a:H.length===4?round(parseInt(H[3]+H[3],16)/255,2):1}:{r:parseInt(H.substring(0,2),16),g:parseInt(H.substring(2,4),16),b:parseInt(H.substring(4,6),16),a:H.length===8?round(parseInt(H.substring(6,8),16)/255,2):1}),hsvaToHex=H=>rgbaToHex(hsvaToRgba(H)),hsvaToHsla=({h:H,s:B,v:t,a:V})=>{const N=(200-B)*t/100;return{h:round(H),s:round(N>0&&N<200?B*t/100/(N<=100?N:200-N)*100:0),l:round(N/2),a:round(V,2)}},hsvaToHslString=H=>{const{h:B,s:t,l:V}=hsvaToHsla(H);return`hsl(${B}, ${t}%, ${V}%)`},hsvaToRgba=({h:H,s:B,v:t,a:V})=>{H=H/360*6,B=B/100,t=t/100;const N=Math.floor(H),W=t*(1-B),K=t*(1-(H-N)*B),G=t*(1-(1-H+N)*B),Z=N%6;return{r:round([t,K,W,W,G,t][Z]*255),g:round([G,t,t,K,W,W][Z]*255),b:round([W,W,G,t,t,K][Z]*255),a:round(V,2)}},format=H=>{const B=H.toString(16);return B.length<2?"0"+B:B},rgbaToHex=({r:H,g:B,b:t,a:V})=>{const N=V<1?format(round(V*255)):"";return"#"+format(H)+format(B)+format(t)+N},rgbaToHsva=({r:H,g:B,b:t,a:V})=>{const N=Math.max(H,B,t),W=N-Math.min(H,B,t),K=W?N===H?(B-t)/W:N===B?2+(t-H)/W:4+(H-B)/W:0;return{h:round(60*(K<0?K+6:K)),s:round(N?W/N*100:0),v:round(N/255*100),a:V}},equalColorObjects=(H,B)=>{if(H===B)return!0;for(const t in H)if(H[t]!==B[t])return!1;return!0},equalHex=(H,B)=>H.toLowerCase()===B.toLowerCase()?!0:equalColorObjects(hexToRgba(H),hexToRgba(B)),cache$1={},tpl=H=>{let B=cache$1[H];return B||(B=document.createElement("template"),B.innerHTML=H,cache$1[H]=B),B},fire=(H,B,t)=>{H.dispatchEvent(new CustomEvent(B,{bubbles:!0,detail:t}))};let hasTouched=!1;const isTouch=H=>"touches"in H,isValid=H=>hasTouched&&!isTouch(H)?!1:(hasTouched||(hasTouched=isTouch(H)),!0),pointerMove=(H,B)=>{const t=isTouch(B)?B.touches[0]:B,V=H.el.getBoundingClientRect();fire(H.el,"move",H.getMove({x:clamp$1((t.pageX-(V.left+window.pageXOffset))/V.width),y:clamp$1((t.pageY-(V.top+window.pageYOffset))/V.height)}))},keyMove=(H,B)=>{const t=B.keyCode;t>40||H.xy&&t<37||t<33||(B.preventDefault(),fire(H.el,"move",H.getMove({x:t===39?.01:t===37?-.01:t===34?.05:t===33?-.05:t===35?1:t===36?-1:0,y:t===40?.01:t===38?-.01:0},!0)))};class Slider{constructor(B,t,V,N){const W=tpl(`<div role="slider" tabindex="0" part="${t}" ${V}><div part="${t}-pointer"></div></div>`);B.appendChild(W.content.cloneNode(!0));const K=B.querySelector(`[part=${t}]`);K.addEventListener("mousedown",this),K.addEventListener("touchstart",this),K.addEventListener("keydown",this),this.el=K,this.xy=N,this.nodes=[K.firstChild,K]}set dragging(B){const t=B?document.addEventListener:document.removeEventListener;t(hasTouched?"touchmove":"mousemove",this),t(hasTouched?"touchend":"mouseup",this)}handleEvent(B){switch(B.type){case"mousedown":case"touchstart":if(B.preventDefault(),!isValid(B)||!hasTouched&&B.button!=0)return;this.el.focus(),pointerMove(this,B),this.dragging=!0;break;case"mousemove":case"touchmove":B.preventDefault(),pointerMove(this,B);break;case"mouseup":case"touchend":this.dragging=!1;break;case"keydown":keyMove(this,B);break}}style(B){B.forEach((t,V)=>{for(const N in t)this.nodes[V].style.setProperty(N,t[N])})}}class Hue extends Slider{constructor(B){super(B,"hue",'aria-label="Hue" aria-valuemin="0" aria-valuemax="360"',!1)}update({h:B}){this.h=B,this.style([{left:`${B/360*100}%`,color:hsvaToHslString({h:B,s:100,v:100,a:1})}]),this.el.setAttribute("aria-valuenow",`${round(B)}`)}getMove(B,t){return{h:t?clamp$1(this.h+B.x*360,0,360):360*B.x}}}class Saturation extends Slider{constructor(B){super(B,"saturation",'aria-label="Color"',!0)}update(B){this.hsva=B,this.style([{top:`${100-B.v}%`,left:`${B.s}%`,color:hsvaToHslString(B)},{"background-color":hsvaToHslString({h:B.h,s:100,v:100,a:1})}]),this.el.setAttribute("aria-valuetext",`Saturation ${round(B.s)}%, Brightness ${round(B.v)}%`)}getMove(B,t){return{s:t?clamp$1(this.hsva.s+B.x*100,0,100):B.x*100,v:t?clamp$1(this.hsva.v-B.y*100,0,100):Math.round(100-B.y*100)}}}const css=':host{display:flex;flex-direction:column;position:relative;width:200px;height:200px;user-select:none;-webkit-user-select:none;cursor:default}:host([hidden]){display:none!important}[role=slider]{position:relative;touch-action:none;user-select:none;-webkit-user-select:none;outline:0}[role=slider]:last-child{border-radius:0 0 8px 8px}[part$=pointer]{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;display:flex;place-content:center center;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}[part$=pointer]::after{content:"";width:100%;height:100%;border-radius:inherit;background-color:currentColor}[role=slider]:focus [part$=pointer]{transform:translate(-50%,-50%) scale(1.1)}',hueCss="[part=hue]{flex:0 0 24px;background:linear-gradient(to right,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%)}[part=hue-pointer]{top:50%;z-index:2}",saturationCss="[part=saturation]{flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(to top,#000,transparent),linear-gradient(to right,#fff,rgba(255,255,255,0));box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}[part=saturation-pointer]{z-index:3}",$isSame=Symbol("same"),$color=Symbol("color"),$hsva=Symbol("hsva"),$update=Symbol("update"),$parts=Symbol("parts"),$css=Symbol("css"),$sliders=Symbol("sliders");class ColorPicker extends HTMLElement{static get observedAttributes(){return["color"]}get[$css](){return[css,hueCss,saturationCss]}get[$sliders](){return[Saturation,Hue]}get color(){return this[$color]}set color(B){if(!this[$isSame](B)){const t=this.colorModel.toHsva(B);this[$update](t),this[$color]=B}}constructor(){super();const B=tpl(`<style>${this[$css].join("")}</style>`),t=this.attachShadow({mode:"open"});t.appendChild(B.content.cloneNode(!0)),t.addEventListener("move",this),this[$parts]=this[$sliders].map(V=>new V(t))}connectedCallback(){if(this.hasOwnProperty("color")){const B=this.color;delete this.color,this.color=B}else this.color||(this.color=this.colorModel.defaultColor)}attributeChangedCallback(B,t,V){const N=this.colorModel.fromAttr(V);this[$isSame](N)||(this.color=N)}handleEvent(B){const t=this[$hsva],V={...t,...B.detail};this[$update](V);let N;!equalColorObjects(V,t)&&!this[$isSame](N=this.colorModel.fromHsva(V))&&(this[$color]=N,fire(this,"color-changed",{value:N}))}[$isSame](B){return this.color&&this.colorModel.equal(B,this.color)}[$update](B){this[$hsva]=B,this[$parts].forEach(t=>t.update(B))}}const colorModel={defaultColor:"#000",toHsva:hexToHsva,fromHsva:({h:H,s:B,v:t})=>hsvaToHex({h:H,s:B,v:t,a:1}),equal:equalHex,fromAttr:H=>H};class HexBase extends ColorPicker{get colorModel(){return colorModel}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ViewCollection extends Collection{constructor(t=[]){super(t,{idProperty:"viewUid"});ee(this,"_parentElement");this.on("add",(V,N,W)=>{this._renderViewIntoCollectionParent(N,W)}),this.on("remove",(V,N)=>{N.element&&this._parentElement&&N.element.remove()}),this._parentElement=null}destroy(){this.map(t=>t.destroy())}setParent(t){this._parentElement=t;for(const V of this)this._renderViewIntoCollectionParent(V)}delegate(...t){if(!t.length||!isStringArray(t))throw new CKEditorError("ui-viewcollection-delegate-wrong-events",this);return{to:V=>{for(const N of this)for(const W of t)N.delegate(W).to(V);this.on("add",(N,W)=>{for(const K of t)W.delegate(K).to(V)}),this.on("remove",(N,W)=>{for(const K of t)W.stopDelegating(K,V)})}}}_renderViewIntoCollectionParent(t,V){t.isRendered||t.render(),t.element&&this._parentElement&&this._parentElement.insertBefore(t.element,this._parentElement.children[V])}remove(t){return super.remove(t)}}function isStringArray(H){return H.every(B=>typeof B=="string")}const xhtmlNs="http://www.w3.org/1999/xhtml";class Template extends EmitterMixin(){constructor(t){super();ee(this,"ns");ee(this,"tag");ee(this,"text");ee(this,"attributes");ee(this,"children");ee(this,"eventListeners");ee(this,"_isRendered");ee(this,"_revertData");Object.assign(this,normalize(clone(t))),this._isRendered=!1,this._revertData=null}render(){const t=this._renderNode({intoFragment:!0});return this._isRendered=!0,t}apply(t){return this._revertData=getEmptyRevertData(),this._renderNode({node:t,intoFragment:!1,isApplying:!0,revertData:this._revertData}),t}revert(t){if(!this._revertData)throw new CKEditorError("ui-template-revert-not-applied",[this,t]);this._revertTemplateFromNode(t,this._revertData)}*getViews(){function*t(V){if(V.children)for(const N of V.children)isView$2(N)?yield N:isTemplate(N)&&(yield*t(N))}yield*t(this)}static bind(t,V){return{to(N,W){return new TemplateToBinding({eventNameOrFunction:N,attribute:N,observable:t,emitter:V,callback:W})},if(N,W,K){return new TemplateIfBinding({observable:t,emitter:V,attribute:N,valueIfTrue:W,callback:K})}}}static extend(t,V){if(t._isRendered)throw new CKEditorError("template-extend-render",[this,t]);extendTemplate(t,normalize(clone(V)))}_renderNode(t){let V;if(t.node?V=this.tag&&this.text:V=this.tag?this.text:!this.text,V)throw new CKEditorError("ui-template-wrong-syntax",this);return this.text?this._renderText(t):this._renderElement(t)}_renderElement(t){let V=t.node;return V||(V=t.node=document.createElementNS(this.ns||xhtmlNs,this.tag)),this._renderAttributes(t),this._renderElementChildren(t),this._setUpListeners(t),V}_renderText(t){let V=t.node;return V?t.revertData.text=V.textContent:V=t.node=document.createTextNode(""),hasTemplateBinding(this.text)?this._bindToObservable({schema:this.text,updater:getTextUpdater(V),data:t}):V.textContent=this.text.join(""),V}_renderAttributes(t){if(!this.attributes)return;const V=t.node,N=t.revertData;for(const W in this.attributes){const K=V.getAttribute(W),G=this.attributes[W];N&&(N.attributes[W]=K);const Z=isNamespaced(G)?G[0].ns:null;if(hasTemplateBinding(G)){const Y=isNamespaced(G)?G[0].value:G;N&&shouldExtend(W)&&Y.unshift(K),this._bindToObservable({schema:Y,updater:getAttributeUpdater(V,W,Z),data:t})}else if(W=="style"&&typeof G[0]!="string")this._renderStyleAttribute(G[0],t);else{N&&K&&shouldExtend(W)&&G.unshift(K);const Y=G.map(X=>X&&(X.value||X)).reduce((X,Q)=>X.concat(Q),[]).reduce(arrayValueReducer,"");isFalsy(Y)||V.setAttributeNS(Z,W,Y)}}}_renderStyleAttribute(t,V){const N=V.node;for(const W in t){const K=t[W];hasTemplateBinding(K)?this._bindToObservable({schema:[K],updater:getStyleUpdater(N,W),data:V}):N.style[W]=K}}_renderElementChildren(t){const V=t.node,N=t.intoFragment?document.createDocumentFragment():V,W=t.isApplying;let K=0;for(const G of this.children)if(isViewCollection(G)){if(!W){G.setParent(V);for(const Z of G)N.appendChild(Z.element)}}else if(isView$2(G))W||(G.isRendered||G.render(),N.appendChild(G.element));else if(isNode(G))N.appendChild(G);else if(W){const Z=t.revertData,Y=getEmptyRevertData();Z.children.push(Y),G._renderNode({intoFragment:!1,node:N.childNodes[K++],isApplying:!0,revertData:Y})}else N.appendChild(G.render());t.intoFragment&&V.appendChild(N)}_setUpListeners(t){if(this.eventListeners)for(const V in this.eventListeners){const N=this.eventListeners[V].map(W=>{const[K,G]=V.split("@");return W.activateDomEventListener(K,G,t)});t.revertData&&t.revertData.bindings.push(N)}}_bindToObservable({schema:t,updater:V,data:N}){const W=N.revertData;syncValueSchemaValue(t,V,N);const K=t.filter(G=>!isFalsy(G)).filter(G=>G.observable).map(G=>G.activateAttributeListener(t,V,N));W&&W.bindings.push(K)}_revertTemplateFromNode(t,V){for(const W of V.bindings)for(const K of W)K();if(V.text){t.textContent=V.text;return}const N=t;for(const W in V.attributes){const K=V.attributes[W];K===null?N.removeAttribute(W):N.setAttribute(W,K)}for(let W=0;W<V.children.length;++W)this._revertTemplateFromNode(N.childNodes[W],V.children[W])}}class TemplateBinding{constructor(B){ee(this,"attribute");ee(this,"observable");ee(this,"emitter");ee(this,"callback");this.attribute=B.attribute,this.observable=B.observable,this.emitter=B.emitter,this.callback=B.callback}getValue(B){const t=this.observable[this.attribute];return this.callback?this.callback(t,B):t}activateAttributeListener(B,t,V){const N=()=>syncValueSchemaValue(B,t,V);return this.emitter.listenTo(this.observable,`change:${this.attribute}`,N),()=>{this.emitter.stopListening(this.observable,`change:${this.attribute}`,N)}}}class TemplateToBinding extends TemplateBinding{constructor(t){super(t);ee(this,"eventNameOrFunction");this.eventNameOrFunction=t.eventNameOrFunction}activateDomEventListener(t,V,N){const W=(K,G)=>{(!V||G.target.matches(V))&&(typeof this.eventNameOrFunction=="function"?this.eventNameOrFunction(G):this.observable.fire(this.eventNameOrFunction,G))};return this.emitter.listenTo(N.node,t,W),()=>{this.emitter.stopListening(N.node,t,W)}}}class TemplateIfBinding extends TemplateBinding{constructor(t){super(t);ee(this,"valueIfTrue");this.valueIfTrue=t.valueIfTrue}getValue(t){const V=super.getValue(t);return isFalsy(V)?!1:this.valueIfTrue||!0}}function hasTemplateBinding(H){return H?(H.value&&(H=H.value),Array.isArray(H)?H.some(hasTemplateBinding):H instanceof TemplateBinding):!1}function getValueSchemaValue(H,B){return H.map(t=>t instanceof TemplateBinding?t.getValue(B):t)}function syncValueSchemaValue(H,B,{node:t}){const V=getValueSchemaValue(H,t);let N;H.length==1&&H[0]instanceof TemplateIfBinding?N=V[0]:N=V.reduce(arrayValueReducer,""),isFalsy(N)?B.remove():B.set(N)}function getTextUpdater(H){return{set(B){H.textContent=B},remove(){H.textContent=""}}}function getAttributeUpdater(H,B,t){return{set(V){H.setAttributeNS(t,B,V)},remove(){H.removeAttributeNS(t,B)}}}function getStyleUpdater(H,B){return{set(t){H.style[B]=t},remove(){H.style[B]=null}}}function clone(H){return cloneDeepWith(H,t=>{if(t&&(t instanceof TemplateBinding||isTemplate(t)||isView$2(t)||isViewCollection(t)))return t})}function normalize(H){if(typeof H=="string"?H=normalizePlainTextDefinition(H):H.text&&normalizeTextDefinition(H),H.on&&(H.eventListeners=normalizeListeners(H.on),delete H.on),!H.text){H.attributes&&normalizeAttributes(H.attributes);const B=[];if(H.children)if(isViewCollection(H.children))B.push(H.children);else for(const t of H.children)isTemplate(t)||isView$2(t)||isNode(t)?B.push(t):B.push(new Template(t));H.children=B}return H}function normalizeAttributes(H){for(const B in H)H[B].value&&(H[B].value=toArray$2(H[B].value)),arrayify(H,B)}function normalizeListeners(H){for(const B in H)arrayify(H,B);return H}function normalizePlainTextDefinition(H){return{text:[H]}}function normalizeTextDefinition(H){H.text=toArray$2(H.text)}function arrayify(H,B){H[B]=toArray$2(H[B])}function arrayValueReducer(H,B){return isFalsy(B)?H:isFalsy(H)?B:`${H} ${B}`}function extendObjectValueArray(H,B){for(const t in B)H[t]?H[t].push(...B[t]):H[t]=B[t]}function extendTemplate(H,B){if(B.attributes&&(H.attributes||(H.attributes={}),extendObjectValueArray(H.attributes,B.attributes)),B.eventListeners&&(H.eventListeners||(H.eventListeners={}),extendObjectValueArray(H.eventListeners,B.eventListeners)),B.text&&H.text.push(...B.text),B.children&&B.children.length){if(H.children.length!=B.children.length)throw new CKEditorError("ui-template-extend-children-mismatch",H);let t=0;for(const V of B.children)extendTemplate(H.children[t++],V)}}function isFalsy(H){return!H&&H!==0}function isView$2(H){return H instanceof View}function isTemplate(H){return H instanceof Template}function isViewCollection(H){return H instanceof ViewCollection}function isNamespaced(H){return isObject$2(H[0])&&H[0].ns}function getEmptyRevertData(){return{children:[],bindings:[],attributes:{}}}function shouldExtend(H){return H=="class"||H=="style"}class View extends DomEmitterMixin(ObservableMixin()){constructor(t){super();ee(this,"element");ee(this,"isRendered");ee(this,"locale");ee(this,"t");ee(this,"template");ee(this,"_viewCollections");ee(this,"_unboundChildren");ee(this,"_bindTemplate");this.element=null,this.isRendered=!1,this.locale=t,this.t=t&&t.t,this._viewCollections=new Collection,this._unboundChildren=this.createCollection(),this._viewCollections.on("add",(V,N)=>{N.locale=t,N.t=t&&t.t}),this.decorate("render")}get bindTemplate(){return this._bindTemplate?this._bindTemplate:this._bindTemplate=Template.bind(this,this)}createCollection(t){const V=new ViewCollection(t);return this._viewCollections.add(V),V}registerChild(t){isIterable(t)||(t=[t]);for(const V of t)this._unboundChildren.add(V)}deregisterChild(t){isIterable(t)||(t=[t]);for(const V of t)this._unboundChildren.remove(V)}setTemplate(t){this.template=new Template(t)}extendTemplate(t){Template.extend(this.template,t)}render(){if(this.isRendered)throw new CKEditorError("ui-view-render-already-rendered",this);this.template&&(this.element=this.template.render(),this.registerChild(this.template.getViews())),this.isRendered=!0}destroy(){this.stopListening(),this._viewCollections.map(t=>t.destroy()),this.template&&this.template._revertData&&this.template.revert(this.element)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function clickOutsideHandler({emitter:H,activator:B,callback:t,contextElements:V,listenerOptions:N}){H.listenTo(document,"mousedown",(W,K)=>{if(!B())return;const G=typeof K.composedPath=="function"?K.composedPath():[],Z=typeof V=="function"?V():V;for(const Y of Z)if(Y.contains(K.target)||G.includes(Y))return;t()},N)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function CssTransitionDisablerMixin(H){class B extends H{disableCssTransitions(){this._isCssTransitionsDisabled=!0}enableCssTransitions(){this._isCssTransitionsDisabled=!1}constructor(...V){super(...V),this.set("_isCssTransitionsDisabled",!1),this.initializeCssTransitionDisablerMixin()}initializeCssTransitionDisablerMixin(){this.extendTemplate({attributes:{class:[this.bindTemplate.if("_isCssTransitionsDisabled","ck-transitions-disabled")]}})}}return B}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function submitHandler({view:H}){H.listenTo(H.element,"submit",(B,t)=>{t.preventDefault(),H.fire("submit")},{useCapture:!0})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function addKeyboardHandlingForGrid({keystrokeHandler:H,focusTracker:B,gridItems:t,numberOfColumns:V,uiLanguageDirection:N}){const W=typeof V=="number"?()=>V:V;H.set("arrowright",K((Y,X)=>N==="rtl"?Z(Y,X.length):G(Y,X.length))),H.set("arrowleft",K((Y,X)=>N==="rtl"?G(Y,X.length):Z(Y,X.length))),H.set("arrowup",K((Y,X)=>{let Q=Y-W();return Q<0&&(Q=Y+W()*Math.floor(X.length/W()),Q>X.length-1&&(Q-=W())),Q})),H.set("arrowdown",K((Y,X)=>{let Q=Y+W();return Q>X.length-1&&(Q=Y%W()),Q}));function K(Y){return X=>{const Q=t.find(ne=>ne.element===B.focusedElement),te=t.getIndex(Q),ie=Y(te,t);t.get(ie).focus(),X.stopPropagation(),X.preventDefault()}}function G(Y,X){return Y===X-1?0:Y+1}function Z(Y,X){return Y===0?X-1:Y-1}}const ot=class ot extends View{constructor(){super();const B=this.bindTemplate;this.set("content",""),this.set("viewBox","0 0 20 20"),this.set("fillColor",""),this.set("isColorInherited",!0),this.set("isVisible",!0),this.setTemplate({tag:"svg",ns:"http://www.w3.org/2000/svg",attributes:{class:["ck","ck-icon",B.if("isVisible","ck-hidden",t=>!t),"ck-reset_all-excluded",B.if("isColorInherited","ck-icon_inherit-color")],viewBox:B.to("viewBox")}})}render(){super.render(),this._updateXMLContent(),this._colorFillPaths(),this.on("change:content",()=>{this._updateXMLContent(),this._colorFillPaths()}),this.on("change:fillColor",()=>{this._colorFillPaths()})}_updateXMLContent(){if(this.content){const t=new DOMParser().parseFromString(this.content.trim(),"image/svg+xml").querySelector("svg"),V=t.getAttribute("viewBox");V&&(this.viewBox=V);for(const{name:N,value:W}of Array.from(t.attributes))ot.presentationalAttributeNames.includes(N)&&this.element.setAttribute(N,W);for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(;t.childNodes.length>0;)this.element.appendChild(t.childNodes[0])}}_colorFillPaths(){this.fillColor&&this.element.querySelectorAll(".ck-icon__fill").forEach(B=>{B.style.fill=this.fillColor})}};ee(ot,"presentationalAttributeNames",["alignment-baseline","baseline-shift","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-rendering","cursor","direction","display","dominant-baseline","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","mask","opacity","overflow","paint-order","pointer-events","shape-rendering","stop-color","stop-opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-overflow","text-rendering","transform","unicode-bidi","vector-effect","visibility","white-space","word-spacing","writing-mode"]);let IconView=ot;class ButtonLabelView extends View{constructor(){super(),this.set({style:void 0,text:void 0,id:void 0});const B=this.bindTemplate;this.setTemplate({tag:"span",attributes:{class:["ck","ck-button__label"],style:B.to("style"),id:B.to("id")},children:[{text:B.to("text")}]})}}class ButtonView extends View{constructor(t,V=new ButtonLabelView){super(t);ee(this,"children");ee(this,"labelView");ee(this,"iconView");ee(this,"keystrokeView");ee(this,"_focusDelayed",null);const N=this.bindTemplate,W=uid();this.set("_ariaPressed",!1),this.set("_ariaChecked",!1),this.set("ariaLabel",void 0),this.set("ariaLabelledBy",`ck-editor__aria-label_${W}`),this.set("class",void 0),this.set("labelStyle",void 0),this.set("icon",void 0),this.set("isEnabled",!0),this.set("isOn",!1),this.set("isVisible",!0),this.set("isToggleable",!1),this.set("keystroke",void 0),this.set("label",void 0),this.set("role",void 0),this.set("tabindex",-1),this.set("tooltip",!1),this.set("tooltipPosition","s"),this.set("type","button"),this.set("withText",!1),this.set("withKeystroke",!1),this.children=this.createCollection(),this.labelView=this._setupLabelView(V),this.iconView=new IconView,this.iconView.extendTemplate({attributes:{class:"ck-button__icon"}}),this.keystrokeView=this._createKeystrokeView(),this.bind("_tooltipString").to(this,"tooltip",this,"label",this,"keystroke",this._getTooltipString.bind(this));const K={tag:"button",attributes:{class:["ck","ck-button",N.to("class"),N.if("isEnabled","ck-disabled",G=>!G),N.if("isVisible","ck-hidden",G=>!G),N.to("isOn",G=>G?"ck-on":"ck-off"),N.if("withText","ck-button_with-text"),N.if("withKeystroke","ck-button_with-keystroke")],role:N.to("role"),type:N.to("type",G=>G||"button"),tabindex:N.to("tabindex"),"aria-checked":N.to("_ariaChecked"),"aria-pressed":N.to("_ariaPressed"),"aria-label":N.to("ariaLabel"),"aria-labelledby":N.to("ariaLabelledBy"),"aria-disabled":N.if("isEnabled",!0,G=>!G),"data-cke-tooltip-text":N.to("_tooltipString"),"data-cke-tooltip-position":N.to("tooltipPosition")},children:this.children,on:{click:N.to(G=>{this.isEnabled?this.fire("execute"):G.preventDefault()})}};this.bind("_ariaPressed").to(this,"isOn",this,"isToggleable",this,"role",(G,Z,Y)=>!Z||isCheckableRole(Y)?!1:String(!!G)),this.bind("_ariaChecked").to(this,"isOn",this,"isToggleable",this,"role",(G,Z,Y)=>!Z||!isCheckableRole(Y)?!1:String(!!G)),env.isSafari&&(this._focusDelayed||(this._focusDelayed=delay(()=>this.focus(),0)),K.on.mousedown=N.to(()=>{this._focusDelayed()}),K.on.mouseup=N.to(()=>{this._focusDelayed.cancel()})),this.setTemplate(K)}render(){super.render(),this.icon&&(this.iconView.bind("content").to(this,"icon"),this.children.add(this.iconView)),this.children.add(this.labelView),this.withKeystroke&&this.keystroke&&this.children.add(this.keystrokeView)}focus(){this.element.focus()}destroy(){this._focusDelayed&&this._focusDelayed.cancel(),super.destroy()}_setupLabelView(t){return t.bind("text","style","id").to(this,"label","labelStyle","ariaLabelledBy"),t}_createKeystrokeView(){const t=new View;return t.setTemplate({tag:"span",attributes:{class:["ck","ck-button__keystroke"]},children:[{text:this.bindTemplate.to("keystroke",V=>getEnvKeystrokeText(V))}]}),t}_getTooltipString(t,V,N){return t?typeof t=="string"?t:(N&&(N=getEnvKeystrokeText(N)),t instanceof Function?t(V,N):`${V}${N?` (${N})`:""}`):""}}function isCheckableRole(H){switch(H){case"radio":case"checkbox":case"option":case"switch":case"menuitemcheckbox":case"menuitemradio":return!0;default:return!1}}class FormHeaderView extends View{constructor(t,V={}){super(t);ee(this,"children");ee(this,"iconView");const N=this.bindTemplate;this.set("label",V.label||""),this.set("class",V.class||null),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-form__header",N.to("class")]},children:this.children}),V.icon&&(this.iconView=new IconView,this.iconView.content=V.icon,this.children.add(this.iconView));const W=new View(t);W.setTemplate({tag:"h2",attributes:{class:["ck","ck-form__header__label"],role:"presentation"},children:[{text:N.to("label")}]}),this.children.add(W)}}class FocusCycler extends EmitterMixin(){constructor(t){super();ee(this,"focusables");ee(this,"focusTracker");ee(this,"keystrokeHandler");ee(this,"actions");if(this.focusables=t.focusables,this.focusTracker=t.focusTracker,this.keystrokeHandler=t.keystrokeHandler,this.actions=t.actions,t.actions&&t.keystrokeHandler)for(const V in t.actions){let N=t.actions[V];typeof N=="string"&&(N=[N]);for(const W of N)t.keystrokeHandler.set(W,(K,G)=>{this[V](),G()},t.keystrokeHandlerOptions)}this.on("forwardCycle",()=>this.focusFirst(),{priority:"low"}),this.on("backwardCycle",()=>this.focusLast(),{priority:"low"})}get first(){return this.focusables.find(isDomFocusable)||null}get last(){return this.focusables.filter(isDomFocusable).slice(-1)[0]||null}get next(){return this._getDomFocusableItem(1)}get previous(){return this._getDomFocusableItem(-1)}get current(){let t=null;return this.focusTracker.focusedElement===null?null:(this.focusables.find((V,N)=>{const W=V.element===this.focusTracker.focusedElement;return W&&(t=N),W}),t)}focusFirst(){this._focus(this.first,1)}focusLast(){this._focus(this.last,-1)}focusNext(){const t=this.next;if(t&&this.focusables.getIndex(t)===this.current){this.fire("forwardCycle");return}t===this.first?this.fire("forwardCycle"):this._focus(t,1)}focusPrevious(){const t=this.previous;if(t&&this.focusables.getIndex(t)===this.current){this.fire("backwardCycle");return}t===this.last?this.fire("backwardCycle"):this._focus(t,-1)}chain(t){const V=()=>this.current===null?null:this.focusables.get(this.current);this.listenTo(t,"forwardCycle",N=>{const W=V();this.focusNext(),W!==V()&&N.stop()},{priority:"low"}),this.listenTo(t,"backwardCycle",N=>{const W=V();this.focusPrevious(),W!==V()&&N.stop()},{priority:"low"})}unchain(t){this.stopListening(t)}_focus(t,V){t&&this.focusTracker.focusedElement!==t.element&&t.focus(V)}_getDomFocusableItem(t){const V=this.focusables.length;if(!V)return null;const N=this.current;if(N===null)return this[t===1?"first":"last"];let W=this.focusables.get(N),K=(N+V+t)%V;do{const G=this.focusables.get(K);if(isDomFocusable(G)){W=G;break}K=(K+V+t)%V}while(K!==N);return W}}function isDomFocusable(H){return isFocusable(H)&&isVisible(H.element)}function isFocusable(H){return"focus"in H&&typeof H.focus=="function"}function isViewWithFocusCycler(H){return isFocusable(H)&&"focusCycler"in H&&H.focusCycler instanceof FocusCycler}function DraggableViewMixin(H){class B extends H{constructor(...N){super(...N);ee(this,"_onDragBound",this._onDrag.bind(this));ee(this,"_onDragEndBound",this._onDragEnd.bind(this));ee(this,"_lastDraggingCoordinates",{x:0,y:0});this.on("render",()=>{this._attachListeners()}),this.set("isDragging",!1)}_attachListeners(){this.listenTo(this.element,"mousedown",this._onDragStart.bind(this)),this.listenTo(this.element,"touchstart",this._onDragStart.bind(this))}_attachDragListeners(){this.listenTo(global$1.document,"mouseup",this._onDragEndBound),this.listenTo(global$1.document,"touchend",this._onDragEndBound),this.listenTo(global$1.document,"mousemove",this._onDragBound),this.listenTo(global$1.document,"touchmove",this._onDragBound)}_detachDragListeners(){this.stopListening(global$1.document,"mouseup",this._onDragEndBound),this.stopListening(global$1.document,"touchend",this._onDragEndBound),this.stopListening(global$1.document,"mousemove",this._onDragBound),this.stopListening(global$1.document,"touchmove",this._onDragBound)}_onDragStart(N,W){if(!this._isHandleElementPressed(W))return;this._attachDragListeners();let K=0,G=0;W instanceof MouseEvent?(K=W.clientX,G=W.clientY):(K=W.touches[0].clientX,G=W.touches[0].clientY),this._lastDraggingCoordinates={x:K,y:G},this.isDragging=!0}_onDrag(N,W){if(!this.isDragging){this._detachDragListeners();return}let K=0,G=0;W instanceof MouseEvent?(K=W.clientX,G=W.clientY):(K=W.touches[0].clientX,G=W.touches[0].clientY),W.preventDefault(),this.fire("drag",{deltaX:Math.round(K-this._lastDraggingCoordinates.x),deltaY:Math.round(G-this._lastDraggingCoordinates.y)}),this._lastDraggingCoordinates={x:K,y:G}}_onDragEnd(){this._detachDragListeners(),this.isDragging=!1}_isHandleElementPressed(N){return this.dragHandleElement?this.dragHandleElement===N.target||N.target instanceof HTMLElement&&this.dragHandleElement.contains(N.target):!1}}return B}class DialogActionsView extends View{constructor(t){super(t);ee(this,"children");ee(this,"keystrokes");ee(this,"focusCycler");ee(this,"_focusTracker");ee(this,"_focusables");this.children=this.createCollection(),this.keystrokes=new KeystrokeHandler,this._focusTracker=new FocusTracker,this._focusables=new ViewCollection,this.focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this._focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-dialog__actions"]},children:this.children})}render(){super.render(),this.keystrokes.listenTo(this.element)}setButtons(t){for(const V of t){const N=new ButtonView(this.locale);let W;N.on("execute",()=>V.onExecute()),V.onCreate&&V.onCreate(N);for(W in V)W!="onExecute"&&W!="onCreate"&&N.set(W,V[W]);this.children.add(N)}this._updateFocusCyclableItems()}focus(t){t===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}_updateFocusCyclableItems(){Array.from(this.children).forEach(t=>{this._focusables.add(t),this._focusTracker.add(t.element)})}}class DialogContentView extends View{constructor(t){super(t);ee(this,"children");this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-dialog__content"]},children:this.children})}reset(){for(;this.children.length;)this.children.remove(0)}}const DialogViewPosition={SCREEN_CENTER:"screen-center",EDITOR_CENTER:"editor-center",EDITOR_TOP_SIDE:"editor-top-side",EDITOR_TOP_CENTER:"editor-top-center",EDITOR_BOTTOM_CENTER:"editor-bottom-center",EDITOR_ABOVE_CENTER:"editor-above-center",EDITOR_BELOW_CENTER:"editor-below-center"},toPx$6=toUnit("px"),rt=class rt extends DraggableViewMixin(View){constructor(t,{getCurrentDomRoot:V,getViewportOffset:N}){super(t);ee(this,"parts");ee(this,"headerView");ee(this,"closeButtonView");ee(this,"actionsView");ee(this,"contentView");ee(this,"keystrokes");ee(this,"focusTracker");ee(this,"wasMoved",!1);ee(this,"_getCurrentDomRoot");ee(this,"_getViewportOffset");ee(this,"_focusables");ee(this,"_focusCycler");const W=this.bindTemplate,K=t.t;this.set("className",""),this.set("ariaLabel",K("Editor dialog")),this.set("isModal",!1),this.set("position",DialogViewPosition.SCREEN_CENTER),this.set("_isVisible",!1),this.set("_isTransparent",!1),this.set("_top",0),this.set("_left",0),this._getCurrentDomRoot=V,this._getViewportOffset=N,this.decorate("moveTo"),this.parts=this.createCollection(),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this._focusables=new ViewCollection,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-dialog-overlay",W.if("isModal","ck-dialog-overlay__transparent",G=>!G),W.if("_isVisible","ck-hidden",G=>!G)],tabindex:"-1"},children:[{tag:"div",attributes:{tabindex:"-1",class:["ck","ck-dialog",W.to("className")],role:"dialog","aria-label":W.to("ariaLabel"),style:{top:W.to("_top",G=>toPx$6(G)),left:W.to("_left",G=>toPx$6(G)),visibility:W.if("_isTransparent","hidden")}},children:this.parts}]})}render(){super.render(),this.keystrokes.set("Esc",(t,V)=>{this.fire("close",{source:"escKeyPress"}),V()}),this.on("drag",(t,{deltaX:V,deltaY:N})=>{this.wasMoved=!0,this.moveBy(V,N)}),this.listenTo(global$1.window,"resize",()=>{this._isVisible&&!this.wasMoved&&this.updatePosition()}),this.listenTo(global$1.document,"scroll",()=>{this._isVisible&&!this.wasMoved&&this.updatePosition()}),this.on("change:_isVisible",(t,V,N)=>{N&&(this._isTransparent=!0,setTimeout(()=>{this.updatePosition(),this._isTransparent=!1,this.focus()},10))}),this.keystrokes.listenTo(this.element)}get dragHandleElement(){return this.headerView?this.headerView.element:null}setupParts({icon:t,title:V,hasCloseButton:N=!0,content:W,actionButtons:K}){V&&(this.headerView=new FormHeaderView(this.locale,{icon:t}),N&&(this.closeButtonView=this._createCloseButton(),this.headerView.children.add(this.closeButtonView)),this.headerView.label=V,this.ariaLabel=V,this.parts.add(this.headerView,0)),W&&(W instanceof View&&(W=[W]),this.contentView=new DialogContentView(this.locale),this.contentView.children.addMany(W),this.parts.add(this.contentView)),K&&(this.actionsView=new DialogActionsView(this.locale),this.actionsView.setButtons(K),this.parts.add(this.actionsView)),this._updateFocusCyclableItems()}focus(){this._focusCycler.focusFirst()}moveTo(t,V){const N=this._getViewportRect(),W=this._getDialogRect();t+W.width>N.right&&(t=N.right-W.width),t<N.left&&(t=N.left),V<N.top&&(V=N.top),this._moveTo(t,V)}_moveTo(t,V){this._left=t,this._top=V}moveBy(t,V){this.moveTo(this._left+t,this._top+V)}_moveOffScreen(){this._moveTo(-9999,-9999)}updatePosition(){if(!this.element||!this.element.parentNode)return;const t=this._getViewportRect();let V=this.position,N;this._getCurrentDomRoot()?N=this._getVisibleDomRootRect(t):V=DialogViewPosition.SCREEN_CENTER;const W=rt.defaultOffset,K=this._getDialogRect();switch(V){case DialogViewPosition.EDITOR_TOP_SIDE:{if(N){const G=this.locale.contentLanguageDirection==="ltr"?N.right-K.width-W:N.left+W;this.moveTo(G,N.top+W)}else this._moveOffScreen();break}case DialogViewPosition.EDITOR_CENTER:{N?this.moveTo(Math.round(N.left+N.width/2-K.width/2),Math.round(N.top+N.height/2-K.height/2)):this._moveOffScreen();break}case DialogViewPosition.SCREEN_CENTER:{this.moveTo(Math.round((t.width-K.width)/2),Math.round((t.height-K.height)/2));break}case DialogViewPosition.EDITOR_TOP_CENTER:{N?this.moveTo(Math.round(N.left+N.width/2-K.width/2),N.top+W):this._moveOffScreen();break}case DialogViewPosition.EDITOR_BOTTOM_CENTER:{N?this.moveTo(Math.round(N.left+N.width/2-K.width/2),N.bottom-K.height-W):this._moveOffScreen();break}case DialogViewPosition.EDITOR_ABOVE_CENTER:{N?this.moveTo(Math.round(N.left+N.width/2-K.width/2),N.top-K.height-W):this._moveOffScreen();break}case DialogViewPosition.EDITOR_BELOW_CENTER:{N?this.moveTo(Math.round(N.left+N.width/2-K.width/2),N.bottom+W):this._moveOffScreen();break}}}_getVisibleDomRootRect(t){let V=new Rect(this._getCurrentDomRoot()).getVisible();if(V){if(V=t.getIntersection(V),!V)return null}else return null;return V}_getDialogRect(){return new Rect(this.element.firstElementChild)}_getViewportRect(){return getConstrainedViewportRect(this._getViewportOffset())}_updateFocusCyclableItems(){const t=[];if(this.contentView)for(const V of this.contentView.children)isFocusable(V)&&t.push(V);this.actionsView&&t.push(this.actionsView),this.closeButtonView&&t.push(this.closeButtonView),t.forEach(V=>{this._focusables.add(V),this.focusTracker.add(V.element),isViewWithFocusCycler(V)&&this._focusCycler.chain(V.focusCycler)})}_createCloseButton(){const t=new ButtonView(this.locale),V=this.locale.t;return t.set({label:V("Close"),tooltip:!0,icon:icons.cancel}),t.on("execute",()=>this.fire("close",{source:"closeButton"})),t}};ee(rt,"defaultOffset",15);let DialogView=rt;function getConstrainedViewportRect(H){H=Object.assign({top:0,bottom:0,left:0,right:0},H);const B=new Rect(global$1.window);return B.top+=H.top,B.height-=H.top,B.bottom-=H.bottom,B.height-=H.bottom,B.left+=H.left,B.right-=H.right,B.width-=H.left+H.right,B}const We=class We extends Plugin{constructor(t){super(t);ee(this,"view");ee(this,"_onHide");const V=t.t;this._initShowHideListeners(),this._initFocusToggler(),this._initMultiRootIntegration(),this.set({id:null,isOpen:!1}),t.accessibility.addKeystrokeInfos({categoryId:"navigation",keystrokes:[{label:V("Move focus in and out of an active dialog window"),keystroke:"Ctrl+F6",mayRequireFn:!0}]})}static get pluginName(){return"Dialog"}_initShowHideListeners(){this.on("show",(t,V)=>{this._show(V)}),this.on("show",(t,V)=>{V.onShow&&V.onShow(this)},{priority:"low"}),this.on("hide",()=>{We._visibleDialogPlugin&&We._visibleDialogPlugin._hide()}),this.on("hide",()=>{this._onHide&&(this._onHide(this),this._onHide=void 0)},{priority:"low"})}_initFocusToggler(){const t=this.editor;t.keystrokes.set("Ctrl+F6",(V,N)=>{!this.isOpen||this.view.isModal||(this.view.focusTracker.isFocused?t.editing.view.focus():this.view.focus(),N())})}_initMultiRootIntegration(){const t=this.editor.model;t.document.on("change:data",()=>{if(!this.view)return;const V=t.document.differ.getChangedRoots();for(const N of V)N.state&&this.view.updatePosition()})}show(t){this.hide(),this.fire(`show:${t.id}`,t)}_show({id:t,icon:V,title:N,hasCloseButton:W=!0,content:K,actionButtons:G,className:Z,isModal:Y,position:X,onHide:Q}){const te=this.editor;this.view=new DialogView(te.locale,{getCurrentDomRoot:()=>te.editing.view.getDomRoot(te.model.document.selection.anchor.root.rootName),getViewportOffset:()=>te.ui.viewportOffset});const ie=this.view;ie.on("close",()=>{this.hide()}),te.ui.view.body.add(ie),te.keystrokes.listenTo(ie.element),X||(X=Y?DialogViewPosition.SCREEN_CENTER:DialogViewPosition.EDITOR_CENTER),ie.set({position:X,_isVisible:!0,className:Z,isModal:Y}),ie.setupParts({icon:V,title:N,hasCloseButton:W,content:K,actionButtons:G}),this.id=t,Q&&(this._onHide=Q),this.isOpen=!0,We._visibleDialogPlugin=this}hide(){We._visibleDialogPlugin&&We._visibleDialogPlugin.fire(`hide:${We._visibleDialogPlugin.id}`)}_hide(){if(!this.view)return;const t=this.editor,V=this.view;V.contentView&&V.contentView.reset(),t.ui.view.body.remove(V),t.ui.focusTracker.remove(V.element),t.keystrokes.stopListening(V.element),V.destroy(),t.editing.view.focus(),this.id=null,this.isOpen=!1,We._visibleDialogPlugin=null}};ee(We,"_visibleDialogPlugin");let Dialog=We;class ListItemButtonView extends ButtonView{constructor(t,V=new ButtonLabelView){super(t,V);ee(this,"_checkIconHolderView",new CheckIconHolderView);this.set({hasCheckSpace:!1,_hasCheck:this.isToggleable});const N=this.bindTemplate;this.extendTemplate({attributes:{class:["ck-list-item-button",N.if("isToggleable","ck-list-item-button_toggleable")]}}),this.bind("_hasCheck").to(this,"hasCheckSpace",this,"isToggleable",(W,K)=>W||K)}render(){super.render(),this._hasCheck&&this.children.add(this._checkIconHolderView,0),this._watchCheckIconHolderMount()}_watchCheckIconHolderMount(){this._checkIconHolderView.bind("isOn").to(this,"isOn",t=>this.isToggleable&&t),this.on("change:_hasCheck",(t,V,N)=>{const{children:W,_checkIconHolderView:K}=this;N?W.add(K,0):W.remove(K)})}}class CheckIconHolderView extends View{constructor(){super();ee(this,"children");ee(this,"_checkIconView",this._createCheckIconView());const t=this.bindTemplate;this.children=this.createCollection(),this.set("isOn",!1),this.setTemplate({tag:"span",children:this.children,attributes:{class:["ck","ck-list-item-button__check-holder",t.to("isOn",V=>V?"ck-on":"ck-off")]}})}render(){super.render(),this.isOn&&this.children.add(this._checkIconView,0),this._watchCheckIconMount()}_watchCheckIconMount(){this.on("change:isOn",(t,V,N)=>{const{children:W,_checkIconView:K}=this;N&&!W.has(K)?W.add(K):!N&&W.has(K)&&W.remove(K)})}_createCheckIconView(){const t=new IconView;return t.content=icons.check,t.extendTemplate({attributes:{class:"ck-list-item-button__check-icon"}}),t}}class MenuBarMenuListItemButtonView extends ListItemButtonView{constructor(B){super(B),this.set({withText:!0,withKeystroke:!0,tooltip:!1,role:"menuitem"}),this.extendTemplate({attributes:{class:["ck-menu-bar__menu__item__button"]}})}}class LabelView extends View{constructor(t){super(t);ee(this,"id");this.set("text",void 0),this.set("for",void 0),this.id=`ck-editor__label_${uid()}`;const V=this.bindTemplate;this.setTemplate({tag:"label",attributes:{class:["ck","ck-label"],id:this.id,for:V.to("for")},children:[{text:V.to("text")}]})}}class AccessibilityHelpContentView extends View{constructor(B,t){super(B);const V=B.t,N=new LabelView;N.text=V("Help Contents. To close this dialog press ESC."),this.setTemplate({tag:"div",attributes:{class:["ck","ck-accessibility-help-dialog__content"],"aria-labelledby":N.id,role:"document",tabindex:-1},children:[createElement(document,"p",{},V("Below, you can find a list of keyboard shortcuts that can be used in the editor.")),...this._createCategories(Array.from(t.values())),N]})}focus(){this.element.focus()}_createCategories(B){return B.map(t=>{const V=[createElement(document,"h3",{},t.label),...Array.from(t.groups.values()).map(N=>this._createGroup(N)).flat()];return t.description&&V.splice(1,0,createElement(document,"p",{},t.description)),createElement(document,"section",{},V)})}_createGroup(B){const t=B.keystrokes.sort((N,W)=>N.label.localeCompare(W.label)).map(N=>this._createGroupRow(N)).flat(),V=[createElement(document,"dl",{},t)];return B.label&&V.unshift(createElement(document,"h4",{},B.label)),V}_createGroupRow(B){const t=this.locale.t,V=createElement(document,"dt"),N=createElement(document,"dd"),W=normalizeKeystrokeDefinition(B.keystroke),K=[];for(const G of W)K.push(G.map(keystrokeToEnvKbd).join(""));return V.innerHTML=B.label,N.innerHTML=K.join(", ")+(B.mayRequireFn&&env.isMac?` ${t("(may require <kbd>Fn</kbd>)")}`:""),[V,N]}}function keystrokeToEnvKbd(H){return getEnvKeystrokeText(H).split("+").map(B=>`<kbd>${B}</kbd>`).join("+")}function normalizeKeystrokeDefinition(H){return typeof H=="string"?[[H]]:typeof H[0]=="string"?[H]:H}var accessibilityIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 6.628a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"/><path d="M8.5 9.125a.3.3 0 0 0-.253-.296L5.11 8.327a.75.75 0 1 1 .388-1.449l4.04.716c.267.072.624.08.893.009l4.066-.724a.75.75 0 1 1 .388 1.45l-3.132.5a.3.3 0 0 0-.253.296v1.357a.3.3 0 0 0 .018.102l1.615 4.438a.75.75 0 0 1-1.41.513l-1.35-3.71a.3.3 0 0 0-.281-.197h-.209a.3.3 0 0 0-.282.198l-1.35 3.711a.75.75 0 0 1-1.41-.513l1.64-4.509a.3.3 0 0 0 .019-.103V9.125Z"/><path clip-rule="evenodd" d="M10 18.5a8.5 8.5 0 1 1 0-17 8.5 8.5 0 0 1 0 17Zm0 1.5c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Z"/></svg>';class AccessibilityHelp extends Plugin{constructor(){super(...arguments);ee(this,"contentView",null)}static get requires(){return[Dialog]}static get pluginName(){return"AccessibilityHelp"}init(){const t=this.editor,V=t.locale.t;t.ui.componentFactory.add("accessibilityHelp",()=>{const N=this._createButton(ButtonView);return N.set({tooltip:!0,withText:!1,label:V("Accessibility help")}),N}),t.ui.componentFactory.add("menuBar:accessibilityHelp",()=>{const N=this._createButton(MenuBarMenuListItemButtonView);return N.label=V("Accessibility"),N}),t.keystrokes.set("Alt+0",(N,W)=>{this._toggleDialog(),W()}),this._setupRootLabels()}_createButton(t){const V=this.editor,N=V.plugins.get("Dialog"),W=V.locale,K=new t(W);return K.set({keystroke:"Alt+0",icon:accessibilityIcon,isToggleable:!0}),K.on("execute",()=>this._toggleDialog()),K.bind("isOn").to(N,"id",G=>G==="accessibilityHelp"),K}_setupRootLabels(){const t=this.editor,V=t.editing.view,N=t.t;t.ui.on("ready",()=>{V.change(K=>{for(const G of V.document.roots)W(K,G)}),t.on("addRoot",(K,G)=>{const Z=t.editing.view.document.getRoot(G.rootName);V.change(Y=>W(Y,Z))},{priority:"low"})});function W(K,G){const Y=[G.getAttribute("aria-label"),N("Press %0 for help.",[getEnvKeystrokeText("Alt+0")])].filter(X=>X).join(". ");K.setAttribute("aria-label",Y,G)}}_toggleDialog(){const t=this.editor,V=t.plugins.get("Dialog"),N=t.locale.t;this.contentView||(this.contentView=new AccessibilityHelpContentView(t.locale,t.accessibility.keystrokeInfos)),V.id==="accessibilityHelp"?V.hide():V.show({id:"accessibilityHelp",className:"ck-accessibility-help-dialog",title:N("Accessibility help"),icon:accessibilityIcon,hasCloseButton:!0,content:this.contentView})}}class BodyCollection extends ViewCollection{constructor(t,V=[]){super(V);ee(this,"locale");ee(this,"_bodyCollectionContainer");this.locale=t}get bodyCollectionContainer(){return this._bodyCollectionContainer}attachToDom(){this._bodyCollectionContainer=new Template({tag:"div",attributes:{class:["ck","ck-reset_all","ck-body","ck-rounded-corners"],dir:this.locale.uiLanguageDirection,role:"application"},children:this}).render();let t=document.querySelector(".ck-body-wrapper");t||(t=createElement(document,"div",{class:"ck-body-wrapper"}),document.body.appendChild(t)),t.appendChild(this._bodyCollectionContainer)}detachFromDom(){super.destroy(),this._bodyCollectionContainer&&this._bodyCollectionContainer.remove();const t=document.querySelector(".ck-body-wrapper");t&&t.childElementCount==0&&t.remove()}}class SwitchButtonView extends ButtonView{constructor(t){super(t);ee(this,"toggleSwitchView");this.isToggleable=!0,this.toggleSwitchView=this._createToggleView(),this.extendTemplate({attributes:{class:"ck-switchbutton"}})}render(){super.render(),this.children.add(this.toggleSwitchView)}_createToggleView(){const t=new View;return t.setTemplate({tag:"span",attributes:{class:["ck","ck-button__toggle"]},children:[{tag:"span",attributes:{class:["ck","ck-button__toggle__inner"]}}]}),t}}class FileDialogButtonView extends FileDialogViewMixin(ButtonView){}class FileDialogListItemButtonView extends FileDialogViewMixin(ListItemButtonView){}function FileDialogViewMixin(H){class B extends H{constructor(...N){super(...N);ee(this,"buttonView");ee(this,"_fileInputView");this.buttonView=this,this._fileInputView=new FileInputView(this.locale),this._fileInputView.bind("acceptedType").to(this),this._fileInputView.bind("allowMultipleFiles").to(this),this._fileInputView.delegate("done").to(this),this.on("execute",()=>{this._fileInputView.open()}),this.extendTemplate({attributes:{class:"ck-file-dialog-button"}})}render(){super.render(),this.children.add(this._fileInputView)}}return B}class FileInputView extends View{constructor(B){super(B),this.set("acceptedType",void 0),this.set("allowMultipleFiles",!1);const t=this.bindTemplate;this.setTemplate({tag:"input",attributes:{class:["ck-hidden"],type:"file",tabindex:"-1",accept:t.to("acceptedType"),multiple:t.to("allowMultipleFiles")},on:{change:t.to(()=>{this.element&&this.element.files&&this.element.files.length&&this.fire("done",this.element.files),this.element.value=""})}})}open(){this.element.click()}}var dropdownArrowIcon='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.941 4.523a.75.75 0 1 1 1.06-1.06l3.006 3.005 3.005-3.005a.75.75 0 1 1 1.06 1.06l-3.549 3.55a.75.75 0 0 1-1.168-.136L.941 4.523z"/></svg>';class CollapsibleView extends View{constructor(t,V){super(t);ee(this,"buttonView");ee(this,"children");const N=this.bindTemplate;this.set("isCollapsed",!1),this.set("label",""),this.buttonView=this._createButtonView(),this.children=this.createCollection(),this.set("_collapsibleAriaLabelUid",void 0),V&&this.children.addMany(V),this.setTemplate({tag:"div",attributes:{class:["ck","ck-collapsible",N.if("isCollapsed","ck-collapsible_collapsed")]},children:[this.buttonView,{tag:"div",attributes:{class:["ck","ck-collapsible__children"],role:"region",hidden:N.if("isCollapsed","hidden"),"aria-labelledby":N.to("_collapsibleAriaLabelUid")},children:this.children}]})}render(){super.render(),this._collapsibleAriaLabelUid=this.buttonView.labelView.element.id}focus(){this.buttonView.focus()}_createButtonView(){const t=new ButtonView(this.locale),V=t.bindTemplate;return t.set({withText:!0,icon:dropdownArrowIcon}),t.extendTemplate({attributes:{"aria-expanded":V.to("isOn",N=>String(N))}}),t.bind("label").to(this),t.bind("isOn").to(this,"isCollapsed",N=>!N),t.on("execute",()=>{this.isCollapsed=!this.isCollapsed}),t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getLocalizedColorOptions(H,B){const t=H.t,V={Black:t("Black"),"Dim grey":t("Dim grey"),Grey:t("Grey"),"Light grey":t("Light grey"),White:t("White"),Red:t("Red"),Orange:t("Orange"),Yellow:t("Yellow"),"Light green":t("Light green"),Green:t("Green"),Aquamarine:t("Aquamarine"),Turquoise:t("Turquoise"),"Light blue":t("Light blue"),Blue:t("Blue"),Purple:t("Purple")};return B.map(N=>{const W=V[N.label];return W&&W!=N.label&&(N.label=W),N})}function normalizeColorOptions(H){return H.map(normalizeSingleColorDefinition).filter(B=>!!B)}function normalizeSingleColorDefinition(H){return typeof H=="string"?{model:H,label:H,hasBorder:!1,view:{name:"span",styles:{color:H}}}:{model:H.color,label:H.label||H.color,hasBorder:H.hasBorder===void 0?!1:H.hasBorder,view:{name:"span",styles:{color:`${H.color}`}}}}var checkIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path class="ck-icon__fill" d="M16.935 5.328a2 2 0 0 1 0 2.829l-7.778 7.778a2 2 0 0 1-2.829 0L3.5 13.107a1.999 1.999 0 1 1 2.828-2.829l.707.707a1 1 0 0 0 1.414 0l5.658-5.657a2 2 0 0 1 2.828 0z"/><path d="M14.814 6.035 8.448 12.4a1 1 0 0 1-1.414 0l-1.413-1.415A1 1 0 1 0 4.207 12.4l2.829 2.829a1 1 0 0 0 1.414 0l7.778-7.778a1 1 0 1 0-1.414-1.415z"/></svg>';class ColorTileView extends ButtonView{constructor(B){super(B);const t=this.bindTemplate;this.set("color",void 0),this.set("hasBorder",!1),this.icon=checkIcon,this.extendTemplate({attributes:{style:{backgroundColor:t.to("color",V=>env.isMediaForcedColors?null:V)},class:["ck","ck-color-grid__tile",t.if("hasBorder","ck-color-selector__color-tile_bordered")]}})}render(){super.render(),this.iconView.fillColor="hsl(0, 0%, 100%)"}}class ColorGridView extends View{constructor(t,V){super(t);ee(this,"columns");ee(this,"items");ee(this,"focusTracker");ee(this,"keystrokes");const N=V&&V.colorDefinitions?V.colorDefinitions:[];this.columns=V&&V.columns?V.columns:5;const W={gridTemplateColumns:`repeat( ${this.columns}, 1fr)`};this.set("selectedColor",void 0),this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.items.on("add",(K,G)=>{G.isOn=G.color===this.selectedColor}),N.forEach(K=>{const G=new ColorTileView;G.set({color:K.color,label:K.label,tooltip:!0,hasBorder:K.options.hasBorder}),G.on("execute",()=>{this.fire("execute",{value:K.color,hasBorder:K.options.hasBorder,label:K.label})}),this.items.add(G)}),this.setTemplate({tag:"div",children:this.items,attributes:{class:["ck","ck-color-grid"],style:W}}),this.on("change:selectedColor",(K,G,Z)=>{for(const Y of this.items)Y.isOn=Y.color===Z})}focus(){this.items.length&&this.items.first.focus()}focusLast(){this.items.length&&this.items.last.focus()}render(){super.render();for(const t of this.items)this.focusTracker.add(t.element);this.items.on("add",(t,V)=>{this.focusTracker.add(V.element)}),this.items.on("remove",(t,V)=>{this.focusTracker.remove(V.element)}),this.keystrokes.listenTo(this.element),addKeyboardHandlingForGrid({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:this.columns,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function convertColor(H,B){if(!H)return"";const t=parseColorString(H);if(!t)return"";if(t.space===B)return H;if(!canConvertParsedColor(t))return"";const N=convert$1[t.space][B];if(!N)return"";const W=N(t.space==="hex"?t.hexValue:t.values);return formatColorOutput(W,B)}function convertToHex(H){if(!H)return"";const B=parseColorString(H);return B?B.space==="hex"?B.hexValue:convertColor(H,"hex"):"#000"}function registerCustomElement(H,B){customElements.get(H)===void 0&&customElements.define(H,B)}function formatColorOutput(H,B){switch(B){case"hex":return`#${H}`;case"rgb":return`rgb( ${H[0]}, ${H[1]}, ${H[2]} )`;case"hsl":return`hsl( ${H[0]}, ${H[1]}%, ${H[2]}% )`;case"hwb":return`hwb( ${H[0]}, ${H[1]}, ${H[2]} )`;case"lab":return`lab( ${H[0]}% ${H[1]} ${H[2]} )`;case"lch":return`lch( ${H[0]}% ${H[1]} ${H[2]} )`;default:return""}}function parseColorString(H){if(H.startsWith("#")){const t=parse$1(H);return{space:"hex",values:t.values,hexValue:H,alpha:t.alpha}}const B=parse$1(H);return B.space?B:null}function canConvertParsedColor(H){return Object.keys(convert$1).includes(H.space)}class LabeledFieldView extends View{constructor(t,V){super(t);ee(this,"fieldView");ee(this,"labelView");ee(this,"statusView");ee(this,"fieldWrapperChildren");const N=`ck-labeled-field-view-${uid()}`,W=`ck-labeled-field-view-status-${uid()}`;this.fieldView=V(this,N,W),this.set("label",void 0),this.set("isEnabled",!0),this.set("isEmpty",!0),this.set("isFocused",!1),this.set("errorText",null),this.set("infoText",null),this.set("class",void 0),this.set("placeholder",void 0),this.labelView=this._createLabelView(N),this.statusView=this._createStatusView(W),this.fieldWrapperChildren=this.createCollection([this.fieldView,this.labelView]),this.bind("_statusText").to(this,"errorText",this,"infoText",(G,Z)=>G||Z);const K=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-labeled-field-view",K.to("class"),K.if("isEnabled","ck-disabled",G=>!G),K.if("isEmpty","ck-labeled-field-view_empty"),K.if("isFocused","ck-labeled-field-view_focused"),K.if("placeholder","ck-labeled-field-view_placeholder"),K.if("errorText","ck-error")]},children:[{tag:"div",attributes:{class:["ck","ck-labeled-field-view__input-wrapper"]},children:this.fieldWrapperChildren},this.statusView]})}_createLabelView(t){const V=new LabelView(this.locale);return V.for=t,V.bind("text").to(this,"label"),V}_createStatusView(t){const V=new View(this.locale),N=this.bindTemplate;return V.setTemplate({tag:"div",attributes:{class:["ck","ck-labeled-field-view__status",N.if("errorText","ck-labeled-field-view__status_error"),N.if("_statusText","ck-hidden",W=>!W)],id:t,role:N.if("errorText","alert")},children:[{text:N.to("_statusText")}]}),V}focus(t){this.fieldView.focus(t)}}class InputBase extends View{constructor(t){super(t);ee(this,"focusTracker");this.set("value",void 0),this.set("id",void 0),this.set("placeholder",void 0),this.set("tabIndex",void 0),this.set("isReadOnly",!1),this.set("hasError",!1),this.set("ariaDescribedById",void 0),this.set("ariaLabel",void 0),this.focusTracker=new FocusTracker,this.bind("isFocused").to(this.focusTracker),this.set("isEmpty",!0);const V=this.bindTemplate;this.setTemplate({tag:"input",attributes:{class:["ck","ck-input",V.if("isFocused","ck-input_focused"),V.if("isEmpty","ck-input-text_empty"),V.if("hasError","ck-error")],id:V.to("id"),placeholder:V.to("placeholder"),tabindex:V.to("tabIndex"),readonly:V.to("isReadOnly"),"aria-invalid":V.if("hasError",!0),"aria-describedby":V.to("ariaDescribedById"),"aria-label":V.to("ariaLabel")},on:{input:V.to((...N)=>{this.fire("input",...N),this._updateIsEmpty()}),change:V.to(this._updateIsEmpty.bind(this))}})}render(){super.render(),this.focusTracker.add(this.element),this._setDomElementValue(this.value),this._updateIsEmpty(),this.on("change:value",(t,V,N)=>{this._setDomElementValue(N),this._updateIsEmpty()})}destroy(){super.destroy(),this.focusTracker.destroy()}select(){this.element.select()}focus(){this.element.focus()}reset(){this.value=this.element.value="",this._updateIsEmpty()}_updateIsEmpty(){this.isEmpty=isInputElementEmpty(this.element)}_setDomElementValue(t){this.element.value=!t&&t!==0?"":t}}function isInputElementEmpty(H){return!H.value}class InputView extends InputBase{constructor(B){super(B),this.set("inputMode","text");const t=this.bindTemplate;this.extendTemplate({attributes:{inputmode:t.to("inputMode")}})}}class InputTextView extends InputView{constructor(B){super(B),this.extendTemplate({attributes:{type:"text",class:["ck-input-text"]}})}}class InputNumberView extends InputView{constructor(B,{min:t,max:V,step:N}={}){super(B);const W=this.bindTemplate;this.set("min",t),this.set("max",V),this.set("step",N),this.extendTemplate({attributes:{type:"number",class:["ck-input-number"],min:W.to("min"),max:W.to("max"),step:W.to("step")}})}}class DropdownPanelView extends View{constructor(t){super(t);ee(this,"children");const V=this.bindTemplate;this.set("isVisible",!1),this.set("position","se"),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-dropdown__panel",V.to("position",N=>`ck-dropdown__panel_${N}`),V.if("isVisible","ck-dropdown__panel-visible")],tabindex:"-1"},children:this.children,on:{selectstart:V.to(N=>{N.target.tagName.toLocaleLowerCase()!=="input"&&N.preventDefault()})}})}focus(){if(this.children.length){const t=this.children.first;typeof t.focus=="function"?t.focus():logWarning("ui-dropdown-panel-focus-child-missing-focus",{childView:this.children.first,dropdownPanel:this})}}focusLast(){if(this.children.length){const t=this.children.last;typeof t.focusLast=="function"?t.focusLast():t.focus()}}}const nt=class nt extends View{constructor(t,V,N){super(t);ee(this,"buttonView");ee(this,"panelView");ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"listView");ee(this,"toolbarView");ee(this,"menuView");const W=this.bindTemplate;this.buttonView=V,this.panelView=N,this.set("isOpen",!1),this.set("isEnabled",!0),this.set("class",void 0),this.set("id",void 0),this.set("panelPosition","auto"),this.panelView.bind("isVisible").to(this,"isOpen"),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.setTemplate({tag:"div",attributes:{class:["ck","ck-dropdown",W.to("class"),W.if("isEnabled","ck-disabled",K=>!K)],id:W.to("id"),"aria-describedby":W.to("ariaDescribedById")},children:[V,N]}),V.extendTemplate({attributes:{class:["ck-dropdown__button"],"data-cke-tooltip-disabled":W.to("isOpen")}})}render(){super.render(),this.focusTracker.add(this.buttonView.element),this.focusTracker.add(this.panelView.element),this.listenTo(this.buttonView,"open",()=>{this.isOpen=!this.isOpen}),this.on("change:isOpen",(V,N,W)=>{if(W)if(this.panelPosition==="auto"){const K=nt._getOptimalPosition({element:this.panelView.element,target:this.buttonView.element,fitInViewport:!0,positions:this._panelPositions});this.panelView.position=K?K.name:this._panelPositions[0].name}else this.panelView.position=this.panelPosition}),this.keystrokes.listenTo(this.element);const t=(V,N)=>{this.isOpen&&(this.isOpen=!1,N())};this.keystrokes.set("arrowdown",(V,N)=>{this.buttonView.isEnabled&&!this.isOpen&&(this.isOpen=!0,N())}),this.keystrokes.set("arrowright",(V,N)=>{this.isOpen&&N()}),this.keystrokes.set("arrowleft",t),this.keystrokes.set("esc",t)}focus(){this.buttonView.focus()}get _panelPositions(){const{south:t,north:V,southEast:N,southWest:W,northEast:K,northWest:G,southMiddleEast:Z,southMiddleWest:Y,northMiddleEast:X,northMiddleWest:Q}=nt.defaultPanelPositions;return this.locale.uiLanguageDirection!=="rtl"?[N,W,Z,Y,t,K,G,X,Q,V]:[W,N,Y,Z,t,G,K,Q,X,V]}};ee(nt,"defaultPanelPositions",{south:(t,V)=>({top:t.bottom,left:t.left-(V.width-t.width)/2,name:"s"}),southEast:t=>({top:t.bottom,left:t.left,name:"se"}),southWest:(t,V)=>({top:t.bottom,left:t.left-V.width+t.width,name:"sw"}),southMiddleEast:(t,V)=>({top:t.bottom,left:t.left-(V.width-t.width)/4,name:"sme"}),southMiddleWest:(t,V)=>({top:t.bottom,left:t.left-(V.width-t.width)*3/4,name:"smw"}),north:(t,V)=>({top:t.top-V.height,left:t.left-(V.width-t.width)/2,name:"n"}),northEast:(t,V)=>({top:t.top-V.height,left:t.left,name:"ne"}),northWest:(t,V)=>({top:t.top-V.height,left:t.left-V.width+t.width,name:"nw"}),northMiddleEast:(t,V)=>({top:t.top-V.height,left:t.left-(V.width-t.width)/4,name:"nme"}),northMiddleWest:(t,V)=>({top:t.top-V.height,left:t.left-(V.width-t.width)*3/4,name:"nmw"})}),ee(nt,"_getOptimalPosition",getOptimalPosition);let DropdownView=nt;class DropdownButtonView extends ButtonView{constructor(t){super(t);ee(this,"arrowView");this.arrowView=this._createArrowView(),this.extendTemplate({attributes:{"aria-haspopup":!0,"aria-expanded":this.bindTemplate.to("isOn",V=>String(V))}}),this.delegate("execute").to(this,"open")}render(){super.render(),this.children.add(this.arrowView)}_createArrowView(){const t=new IconView;return t.content=dropdownArrowIcon,t.extendTemplate({attributes:{class:"ck-dropdown__arrow"}}),t}}class ListItemView extends View{constructor(t){super(t);ee(this,"children");const V=this.bindTemplate;this.set("isVisible",!0),this.children=this.createCollection(),this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__item",V.if("isVisible","ck-hidden",N=>!N)],role:"presentation"},children:this.children})}focus(){this.children.first&&this.children.first.focus()}}class ListSeparatorView extends View{constructor(B){super(B),this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__separator"]}})}}class ListItemGroupView extends View{constructor(t,V=new LabelView){super(t);ee(this,"labelView");ee(this,"items");ee(this,"children");const N=this.bindTemplate,W=new ListView(t);this.set({label:"",isVisible:!0}),this.labelView=V,this.labelView.bind("text").to(this,"label"),this.children=this.createCollection(),this.children.addMany([this.labelView,W]),W.set({role:"group",ariaLabelledBy:V.id}),W.focusTracker.destroy(),W.keystrokes.destroy(),this.items=W.items,this.setTemplate({tag:"li",attributes:{role:"presentation",class:["ck","ck-list__group",N.if("isVisible","ck-hidden",K=>!K)]},children:this.children})}focus(){if(this.items){const t=this.items.find(V=>!(V instanceof ListSeparatorView));t&&t.focus()}}}class ListView extends View{constructor(t){super(t);ee(this,"focusables");ee(this,"items");ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"_focusCycler");ee(this,"_listItemGroupToChangeListeners",new WeakMap);const V=this.bindTemplate;this.focusables=new ViewCollection,this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"arrowup",focusNext:"arrowdown"}}),this.set("ariaLabel",void 0),this.set("ariaLabelledBy",void 0),this.set("role",void 0),this.setTemplate({tag:"ul",attributes:{class:["ck","ck-reset","ck-list"],role:V.to("role"),"aria-label":V.to("ariaLabel"),"aria-labelledby":V.to("ariaLabelledBy")},children:this.items})}render(){super.render();for(const t of this.items)t instanceof ListItemGroupView?this._registerFocusableItemsGroup(t):t instanceof ListItemView&&this._registerFocusableListItem(t);this.items.on("change",(t,V)=>{for(const N of V.removed)N instanceof ListItemGroupView?this._deregisterFocusableItemsGroup(N):N instanceof ListItemView&&this._deregisterFocusableListItem(N);for(const N of Array.from(V.added).reverse())N instanceof ListItemGroupView?this._registerFocusableItemsGroup(N,V.index):this._registerFocusableListItem(N,V.index)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}focusFirst(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}_registerFocusableListItem(t,V){this.focusTracker.add(t.element),this.focusables.add(t,V)}_deregisterFocusableListItem(t){this.focusTracker.remove(t.element),this.focusables.remove(t)}_getOnGroupItemsChangeCallback(t){return(V,N)=>{for(const W of N.removed)this._deregisterFocusableListItem(W);for(const W of Array.from(N.added).reverse())this._registerFocusableListItem(W,this.items.getIndex(t)+N.index)}}_registerFocusableItemsGroup(t,V){Array.from(t.items).forEach((W,K)=>{const G=typeof V<"u"?V+K:void 0;this._registerFocusableListItem(W,G)});const N=this._getOnGroupItemsChangeCallback(t);this._listItemGroupToChangeListeners.set(t,N),t.items.on("change",N)}_deregisterFocusableItemsGroup(t){for(const V of t.items)this._deregisterFocusableListItem(V);t.items.off("change",this._listItemGroupToChangeListeners.get(t)),this._listItemGroupToChangeListeners.delete(t)}}const toPx$5=toUnit("px"),POSITION_OFF_SCREEN={top:-99999,left:-99999,name:"arrowless",config:{withArrow:!1}},He=class He extends View{constructor(t){super(t);ee(this,"content");ee(this,"_pinWhenIsVisibleCallback");ee(this,"_resizeObserver");const V=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("position","arrow_nw"),this.set("isVisible",!1),this.set("withArrow",!0),this.set("class",void 0),this._pinWhenIsVisibleCallback=null,this._resizeObserver=null,this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-panel",V.to("position",N=>`ck-balloon-panel_${N}`),V.if("isVisible","ck-balloon-panel_visible"),V.if("withArrow","ck-balloon-panel_with-arrow"),V.to("class")],style:{top:V.to("top",toPx$5),left:V.to("left",toPx$5)}},children:this.content})}destroy(){this.hide(),super.destroy()}show(){this.isVisible=!0}hide(){this.isVisible=!1}attachTo(t){const V=getDomElement(t.target);if(V&&!isVisible(V))return!1;this.show();const N=He.defaultPositions,W=Object.assign({},{element:this.element,positions:[N.southArrowNorth,N.southArrowNorthMiddleWest,N.southArrowNorthMiddleEast,N.southArrowNorthWest,N.southArrowNorthEast,N.northArrowSouth,N.northArrowSouthMiddleWest,N.northArrowSouthMiddleEast,N.northArrowSouthWest,N.northArrowSouthEast,N.viewportStickyNorth],limiter:global$1.document.body,fitInViewport:!0},t),K=He._getOptimalPosition(W)||POSITION_OFF_SCREEN,G=parseInt(K.left),Z=parseInt(K.top),Y=K.name,X=K.config||{},{withArrow:Q=!0}=X;return this.top=Z,this.left=G,this.position=Y,this.withArrow=Q,!0}pin(t){this.unpin(),this._startPinning(t)&&(this._pinWhenIsVisibleCallback=()=>{this.isVisible?this._startPinning(t):this._stopPinning()},this.listenTo(this,"change:isVisible",this._pinWhenIsVisibleCallback))}unpin(){this._pinWhenIsVisibleCallback&&(this._stopPinning(),this.stopListening(this,"change:isVisible",this._pinWhenIsVisibleCallback),this._pinWhenIsVisibleCallback=null,this.hide())}_startPinning(t){if(!this.attachTo(t))return!1;let V=getDomElement(t.target);const N=t.limiter?getDomElement(t.limiter):global$1.document.body;if(this.listenTo(global$1.document,"scroll",(W,K)=>{const G=K.target,Z=V&&G.contains(V),Y=N&&G.contains(N);(Z||Y||!V||!N)&&this.attachTo(t)},{useCapture:!0}),this.listenTo(global$1.window,"resize",()=>{this.attachTo(t)}),!this._resizeObserver&&(V&&isText(V)&&(V=V.parentElement),V)){const W=()=>{isVisible(V)||this.unpin()};this._resizeObserver=new ResizeObserver(V,W)}return!0}_stopPinning(){this.stopListening(global$1.document,"scroll"),this.stopListening(global$1.window,"resize"),this._resizeObserver&&(this._resizeObserver.destroy(),this._resizeObserver=null)}static generatePositions(t={}){const{sideOffset:V=He.arrowSideOffset,heightOffset:N=He.arrowHeightOffset,stickyVerticalOffset:W=He.stickyVerticalOffset,config:K}=t;return{northWestArrowSouthWest:(Y,X)=>({top:G(Y,X),left:Y.left-V,name:"arrow_sw",...K&&{config:K}}),northWestArrowSouthMiddleWest:(Y,X)=>({top:G(Y,X),left:Y.left-X.width*.25-V,name:"arrow_smw",...K&&{config:K}}),northWestArrowSouth:(Y,X)=>({top:G(Y,X),left:Y.left-X.width/2,name:"arrow_s",...K&&{config:K}}),northWestArrowSouthMiddleEast:(Y,X)=>({top:G(Y,X),left:Y.left-X.width*.75+V,name:"arrow_sme",...K&&{config:K}}),northWestArrowSouthEast:(Y,X)=>({top:G(Y,X),left:Y.left-X.width+V,name:"arrow_se",...K&&{config:K}}),northArrowSouthWest:(Y,X)=>({top:G(Y,X),left:Y.left+Y.width/2-V,name:"arrow_sw",...K&&{config:K}}),northArrowSouthMiddleWest:(Y,X)=>({top:G(Y,X),left:Y.left+Y.width/2-X.width*.25-V,name:"arrow_smw",...K&&{config:K}}),northArrowSouth:(Y,X)=>({top:G(Y,X),left:Y.left+Y.width/2-X.width/2,name:"arrow_s",...K&&{config:K}}),northArrowSouthMiddleEast:(Y,X)=>({top:G(Y,X),left:Y.left+Y.width/2-X.width*.75+V,name:"arrow_sme",...K&&{config:K}}),northArrowSouthEast:(Y,X)=>({top:G(Y,X),left:Y.left+Y.width/2-X.width+V,name:"arrow_se",...K&&{config:K}}),northEastArrowSouthWest:(Y,X)=>({top:G(Y,X),left:Y.right-V,name:"arrow_sw",...K&&{config:K}}),northEastArrowSouthMiddleWest:(Y,X)=>({top:G(Y,X),left:Y.right-X.width*.25-V,name:"arrow_smw",...K&&{config:K}}),northEastArrowSouth:(Y,X)=>({top:G(Y,X),left:Y.right-X.width/2,name:"arrow_s",...K&&{config:K}}),northEastArrowSouthMiddleEast:(Y,X)=>({top:G(Y,X),left:Y.right-X.width*.75+V,name:"arrow_sme",...K&&{config:K}}),northEastArrowSouthEast:(Y,X)=>({top:G(Y,X),left:Y.right-X.width+V,name:"arrow_se",...K&&{config:K}}),southWestArrowNorthWest:Y=>({top:Z(Y),left:Y.left-V,name:"arrow_nw",...K&&{config:K}}),southWestArrowNorthMiddleWest:(Y,X)=>({top:Z(Y),left:Y.left-X.width*.25-V,name:"arrow_nmw",...K&&{config:K}}),southWestArrowNorth:(Y,X)=>({top:Z(Y),left:Y.left-X.width/2,name:"arrow_n",...K&&{config:K}}),southWestArrowNorthMiddleEast:(Y,X)=>({top:Z(Y),left:Y.left-X.width*.75+V,name:"arrow_nme",...K&&{config:K}}),southWestArrowNorthEast:(Y,X)=>({top:Z(Y),left:Y.left-X.width+V,name:"arrow_ne",...K&&{config:K}}),southArrowNorthWest:Y=>({top:Z(Y),left:Y.left+Y.width/2-V,name:"arrow_nw",...K&&{config:K}}),southArrowNorthMiddleWest:(Y,X)=>({top:Z(Y),left:Y.left+Y.width/2-X.width*.25-V,name:"arrow_nmw",...K&&{config:K}}),southArrowNorth:(Y,X)=>({top:Z(Y),left:Y.left+Y.width/2-X.width/2,name:"arrow_n",...K&&{config:K}}),southArrowNorthMiddleEast:(Y,X)=>({top:Z(Y),left:Y.left+Y.width/2-X.width*.75+V,name:"arrow_nme",...K&&{config:K}}),southArrowNorthEast:(Y,X)=>({top:Z(Y),left:Y.left+Y.width/2-X.width+V,name:"arrow_ne",...K&&{config:K}}),southEastArrowNorthWest:Y=>({top:Z(Y),left:Y.right-V,name:"arrow_nw",...K&&{config:K}}),southEastArrowNorthMiddleWest:(Y,X)=>({top:Z(Y),left:Y.right-X.width*.25-V,name:"arrow_nmw",...K&&{config:K}}),southEastArrowNorth:(Y,X)=>({top:Z(Y),left:Y.right-X.width/2,name:"arrow_n",...K&&{config:K}}),southEastArrowNorthMiddleEast:(Y,X)=>({top:Z(Y),left:Y.right-X.width*.75+V,name:"arrow_nme",...K&&{config:K}}),southEastArrowNorthEast:(Y,X)=>({top:Z(Y),left:Y.right-X.width+V,name:"arrow_ne",...K&&{config:K}}),westArrowEast:(Y,X)=>({top:Y.top+Y.height/2-X.height/2,left:Y.left-X.width-N,name:"arrow_e",...K&&{config:K}}),eastArrowWest:(Y,X)=>({top:Y.top+Y.height/2-X.height/2,left:Y.right+N,name:"arrow_w",...K&&{config:K}}),viewportStickyNorth:(Y,X,Q,te)=>{const ie=te||Q;return!Y.getIntersection(ie)||ie.height-Y.height>W?null:{top:ie.top+W,left:Y.left+Y.width/2-X.width/2,name:"arrowless",config:{withArrow:!1,...K}}}};function G(Y,X){return Y.top-X.height-N}function Z(Y){return Y.bottom+N}}};ee(He,"arrowSideOffset",25),ee(He,"arrowHeightOffset",10),ee(He,"stickyVerticalOffset",20),ee(He,"_getOptimalPosition",getOptimalPosition),ee(He,"defaultPositions",He.generatePositions());let BalloonPanelView=He;function getDomElement(H){return isElement$1(H)?H:isRange(H)?H.commonAncestorContainer:typeof H=="function"?getDomElement(H()):null}class ToolbarSeparatorView extends View{constructor(B){super(B),this.setTemplate({tag:"span",attributes:{class:["ck","ck-toolbar__separator"]}})}}class ToolbarLineBreakView extends View{constructor(B){super(B),this.setTemplate({tag:"span",attributes:{class:["ck","ck-toolbar__line-break"]}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function preventDefault(H){return H.bindTemplate.to(B=>{B.target===H.element&&B.preventDefault()})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function normalizeToolbarConfig(H){if(Array.isArray(H))return{items:H,removeItems:[]};const B={items:[],removeItems:[]};return H?{...B,...H}:B}const NESTED_TOOLBAR_ICONS={alignLeft:icons.alignLeft,bold:icons.bold,importExport:icons.importExport,paragraph:icons.paragraph,plus:icons.plus,text:icons.text,threeVerticalDots:icons.threeVerticalDots,pilcrow:icons.pilcrow,dragIndicator:icons.dragIndicator};class ToolbarView extends View{constructor(t,V){super(t);ee(this,"options");ee(this,"items");ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"itemsView");ee(this,"children");ee(this,"focusables");ee(this,"_focusCycler");ee(this,"_behavior");const N=this.bindTemplate,W=this.t;this.options=V||{},this.set("ariaLabel",W("Editor toolbar")),this.set("maxWidth","auto"),this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.set("class",void 0),this.set("isCompact",!1),this.itemsView=new ItemsView(t),this.children=this.createCollection(),this.children.add(this.itemsView),this.focusables=this.createCollection();const K=t.uiLanguageDirection==="rtl";this._focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:[K?"arrowright":"arrowleft","arrowup"],focusNext:[K?"arrowleft":"arrowright","arrowdown"]}});const G=["ck","ck-toolbar",N.to("class"),N.if("isCompact","ck-toolbar_compact")];this.options.shouldGroupWhenFull&&this.options.isFloating&&G.push("ck-toolbar_floating"),this.setTemplate({tag:"div",attributes:{class:G,role:"toolbar","aria-label":N.to("ariaLabel"),style:{maxWidth:N.to("maxWidth")},tabindex:-1},children:this.children,on:{mousedown:preventDefault(this)}}),this._behavior=this.options.shouldGroupWhenFull?new DynamicGrouping(this):new StaticLayout(this)}render(){super.render(),this.focusTracker.add(this.element);for(const t of this.items)this.focusTracker.add(t.element);this.items.on("add",(t,V)=>{this.focusTracker.add(V.element)}),this.items.on("remove",(t,V)=>{this.focusTracker.remove(V.element)}),this.keystrokes.listenTo(this.element),this._behavior.render(this)}destroy(){return this._behavior.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy(),super.destroy()}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}fillFromConfig(t,V,N){this.items.addMany(this._buildItemsFromConfig(t,V,N))}_buildItemsFromConfig(t,V,N){const W=normalizeToolbarConfig(t),K=N||W.removeItems;return this._cleanItemsConfiguration(W.items,V,K).map(Z=>isObject$2(Z)?this._createNestedToolbarDropdown(Z,V,K):Z==="|"?new ToolbarSeparatorView:Z==="-"?new ToolbarLineBreakView:V.create(Z)).filter(Z=>!!Z)}_cleanItemsConfiguration(t,V,N){const W=t.filter((K,G,Z)=>K==="|"?!0:N.indexOf(K)!==-1?!1:K==="-"?this.options.shouldGroupWhenFull?(logWarning("toolbarview-line-break-ignored-when-grouping-items",Z),!1):!0:!isObject$2(K)&&!V.has(K)?(logWarning("toolbarview-item-unavailable",{item:K}),!1):!0);return this._cleanSeparatorsAndLineBreaks(W)}_cleanSeparatorsAndLineBreaks(t){const V=G=>G!=="-"&&G!=="|",N=t.length,W=t.findIndex(V);if(W===-1)return[];const K=N-t.slice().reverse().findIndex(V);return t.slice(W,K).filter((G,Z,Y)=>V(G)?!0:!(Z>0&&Y[Z-1]===G))}_createNestedToolbarDropdown(t,V,N){let{label:W,icon:K,items:G,tooltip:Z=!0,withText:Y=!1}=t;if(G=this._cleanItemsConfiguration(G,V,N),!G.length)return null;const X=this.locale,Q=createDropdown(X);return W||logWarning("toolbarview-nested-toolbar-dropdown-missing-label",t),Q.class="ck-toolbar__nested-toolbar-dropdown",Q.buttonView.set({label:W,tooltip:Z,withText:!!Y}),K!==!1?Q.buttonView.icon=NESTED_TOOLBAR_ICONS[K]||K||icons.threeVerticalDots:Q.buttonView.withText=!0,addToolbarToDropdown(Q,()=>Q.toolbarView._buildItemsFromConfig(G,V,N)),Q}}class ItemsView extends View{constructor(t){super(t);ee(this,"children");this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-toolbar__items"]},children:this.children})}}class StaticLayout{constructor(B){const t=B.bindTemplate;B.set("isVertical",!1),B.itemsView.children.bindTo(B.items).using(V=>V),B.focusables.bindTo(B.items).using(V=>isFocusable(V)?V:null),B.extendTemplate({attributes:{class:[t.if("isVertical","ck-toolbar_vertical")]}})}render(){}destroy(){}}class DynamicGrouping{constructor(B){ee(this,"view");ee(this,"viewChildren");ee(this,"viewFocusables");ee(this,"viewItemsView");ee(this,"viewFocusTracker");ee(this,"viewLocale");ee(this,"ungroupedItems");ee(this,"groupedItems");ee(this,"groupedItemsDropdown");ee(this,"resizeObserver",null);ee(this,"cachedPadding",null);ee(this,"shouldUpdateGroupingOnNextResize",!1);ee(this,"viewElement");this.view=B,this.viewChildren=B.children,this.viewFocusables=B.focusables,this.viewItemsView=B.itemsView,this.viewFocusTracker=B.focusTracker,this.viewLocale=B.locale,this.ungroupedItems=B.createCollection(),this.groupedItems=B.createCollection(),this.groupedItemsDropdown=this._createGroupedItemsDropdown(),B.itemsView.children.bindTo(this.ungroupedItems).using(t=>t),this.ungroupedItems.on("change",this._updateFocusCyclableItems.bind(this)),B.children.on("change",this._updateFocusCyclableItems.bind(this)),B.items.on("change",(t,V)=>{const N=V.index,W=Array.from(V.added);for(const K of V.removed)N>=this.ungroupedItems.length?this.groupedItems.remove(K):this.ungroupedItems.remove(K);for(let K=N;K<N+W.length;K++){const G=W[K-N];K>this.ungroupedItems.length?this.groupedItems.add(G,K-this.ungroupedItems.length):this.ungroupedItems.add(G,K)}this._updateGrouping()}),B.extendTemplate({attributes:{class:["ck-toolbar_grouping"]}})}render(B){this.viewElement=B.element,this._enableGroupingOnResize(),this._enableGroupingOnMaxWidthChange(B)}destroy(){this.groupedItemsDropdown.destroy(),this.resizeObserver.destroy()}_updateGrouping(){if(!this.viewElement.ownerDocument.body.contains(this.viewElement))return;if(!isVisible(this.viewElement)){this.shouldUpdateGroupingOnNextResize=!0;return}const B=this.groupedItems.length;let t;for(;this._areItemsOverflowing;)this._groupLastItem(),t=!0;if(!t&&this.groupedItems.length){for(;this.groupedItems.length&&!this._areItemsOverflowing;)this._ungroupFirstItem();this._areItemsOverflowing&&this._groupLastItem()}this.groupedItems.length!==B&&this.view.fire("groupedItemsUpdate")}get _areItemsOverflowing(){if(!this.ungroupedItems.length)return!1;const B=this.viewElement,t=this.viewLocale.uiLanguageDirection,V=new Rect(B.lastChild),N=new Rect(B);if(!this.cachedPadding){const W=global$1.window.getComputedStyle(B),K=t==="ltr"?"paddingRight":"paddingLeft";this.cachedPadding=Number.parseInt(W[K])}return t==="ltr"?V.right>N.right-this.cachedPadding:V.left<N.left+this.cachedPadding}_enableGroupingOnResize(){let B;this.resizeObserver=new ResizeObserver(this.viewElement,t=>{(!B||B!==t.contentRect.width||this.shouldUpdateGroupingOnNextResize)&&(this.shouldUpdateGroupingOnNextResize=!1,this._updateGrouping(),B=t.contentRect.width)}),this._updateGrouping()}_enableGroupingOnMaxWidthChange(B){B.on("change:maxWidth",()=>{this._updateGrouping()})}_groupLastItem(){this.groupedItems.length||(this.viewChildren.add(new ToolbarSeparatorView),this.viewChildren.add(this.groupedItemsDropdown),this.viewFocusTracker.add(this.groupedItemsDropdown.element)),this.groupedItems.add(this.ungroupedItems.remove(this.ungroupedItems.last),0)}_ungroupFirstItem(){this.ungroupedItems.add(this.groupedItems.remove(this.groupedItems.first)),this.groupedItems.length||(this.viewChildren.remove(this.groupedItemsDropdown),this.viewChildren.remove(this.viewChildren.last),this.viewFocusTracker.remove(this.groupedItemsDropdown.element))}_createGroupedItemsDropdown(){const B=this.viewLocale,t=B.t,V=createDropdown(B);return V.class="ck-toolbar__grouped-dropdown",V.panelPosition=B.uiLanguageDirection==="ltr"?"sw":"se",addToolbarToDropdown(V,this.groupedItems),V.buttonView.set({label:t("Show more items"),tooltip:!0,tooltipPosition:B.uiLanguageDirection==="rtl"?"se":"sw",icon:icons.threeVerticalDots}),V}_updateFocusCyclableItems(){this.viewFocusables.clear(),this.ungroupedItems.map(B=>{isFocusable(B)&&this.viewFocusables.add(B)}),this.groupedItems.length&&this.viewFocusables.add(this.groupedItemsDropdown)}}class SplitButtonView extends View{constructor(t,V){super(t);ee(this,"children");ee(this,"actionView");ee(this,"arrowView");ee(this,"keystrokes");ee(this,"focusTracker");const N=this.bindTemplate;this.set("class",void 0),this.set("labelStyle",void 0),this.set("icon",void 0),this.set("isEnabled",!0),this.set("isOn",!1),this.set("isToggleable",!1),this.set("isVisible",!0),this.set("keystroke",void 0),this.set("withKeystroke",!1),this.set("label",void 0),this.set("tabindex",-1),this.set("tooltip",!1),this.set("tooltipPosition","s"),this.set("type","button"),this.set("withText",!1),this.children=this.createCollection(),this.actionView=this._createActionView(V),this.arrowView=this._createArrowView(),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.setTemplate({tag:"div",attributes:{class:["ck","ck-splitbutton",N.to("class"),N.if("isVisible","ck-hidden",W=>!W),this.arrowView.bindTemplate.if("isOn","ck-splitbutton_open")]},children:this.children})}render(){super.render(),this.children.add(this.actionView),this.children.add(this.arrowView),this.focusTracker.add(this.actionView.element),this.focusTracker.add(this.arrowView.element),this.keystrokes.listenTo(this.element),this.keystrokes.set("arrowright",(t,V)=>{this.focusTracker.focusedElement===this.actionView.element&&(this.arrowView.focus(),V())}),this.keystrokes.set("arrowleft",(t,V)=>{this.focusTracker.focusedElement===this.arrowView.element&&(this.actionView.focus(),V())})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.actionView.focus()}_createActionView(t){const V=t||new ButtonView;return t||V.bind("icon","isEnabled","isOn","isToggleable","keystroke","label","tabindex","tooltip","tooltipPosition","type","withText").to(this),V.extendTemplate({attributes:{class:"ck-splitbutton__action"}}),V.delegate("execute").to(this),V}_createArrowView(){const t=new ButtonView,V=t.bindTemplate;return t.icon=dropdownArrowIcon,t.extendTemplate({attributes:{class:["ck-splitbutton__arrow"],"data-cke-tooltip-disabled":V.to("isOn"),"aria-haspopup":!0,"aria-expanded":V.to("isOn",N=>String(N))}}),t.bind("isEnabled").to(this),t.bind("label").to(this),t.bind("tooltip").to(this),t.delegate("execute").to(this,"open"),t}}function createDropdown(H,B=DropdownButtonView){const t=typeof B=="function"?new B(H):B,V=new DropdownPanelView(H),N=new DropdownView(H,t,V);return t.bind("isEnabled").to(N),t instanceof SplitButtonView?t.arrowView.bind("isOn").to(N,"isOpen"):t.bind("isOn").to(N,"isOpen"),addDefaultBehaviors(N),N}function addToolbarToDropdown(H,B,t={}){H.extendTemplate({attributes:{class:["ck-toolbar-dropdown"]}}),H.isOpen?addToolbarToOpenDropdown(H,B,t):H.once("change:isOpen",()=>addToolbarToOpenDropdown(H,B,t),{priority:"highest"}),t.enableActiveItemFocusOnDropdownOpen&&focusChildOnDropdownOpen(H,()=>H.toolbarView.items.find(V=>V.isOn))}function addToolbarToOpenDropdown(H,B,t){const V=H.locale,N=V.t,W=H.toolbarView=new ToolbarView(V),K=typeof B=="function"?B():B;W.ariaLabel=t.ariaLabel||N("Dropdown toolbar"),t.maxWidth&&(W.maxWidth=t.maxWidth),t.class&&(W.class=t.class),t.isCompact&&(W.isCompact=t.isCompact),t.isVertical&&(W.isVertical=!0),K instanceof ViewCollection?W.items.bindTo(K).using(G=>G):W.items.addMany(K),H.panelView.children.add(W),W.items.delegate("execute").to(H)}function addListToDropdown(H,B,t={}){H.isOpen?addListToOpenDropdown(H,B,t):H.once("change:isOpen",()=>addListToOpenDropdown(H,B,t),{priority:"highest"}),focusChildOnDropdownOpen(H,()=>H.listView.items.find(V=>V instanceof ListItemView?V.children.first.isOn:!1))}function addListToOpenDropdown(H,B,t){const V=H.locale,N=H.listView=new ListView(V),W=typeof B=="function"?B():B;N.ariaLabel=t.ariaLabel,N.role=t.role,bindViewCollectionItemsToDefinitions(H,N.items,W,V),H.panelView.children.add(N),N.items.delegate("execute").to(H)}function focusChildOnDropdownOpen(H,B){H.on("change:isOpen",()=>{if(!H.isOpen)return;const t=B();t&&(typeof t.focus=="function"?t.focus():logWarning("ui-dropdown-focus-child-on-open-child-missing-focus",{view:t}))},{priority:priorities.low-10})}function addDefaultBehaviors(H){closeDropdownOnClickOutside(H),closeDropdownOnExecute(H),closeDropdownOnBlur(H),focusDropdownContentsOnArrows(H),focusDropdownButtonOnClose(H),focusDropdownPanelOnOpen(H)}function closeDropdownOnClickOutside(H){clickOutsideHandler({emitter:H,activator:()=>H.isRendered&&H.isOpen,callback:()=>{H.isOpen=!1},contextElements:()=>[H.element,...H.focusTracker.elements]})}function closeDropdownOnExecute(H){H.on("execute",B=>{B.source instanceof SwitchButtonView||(H.isOpen=!1)})}function closeDropdownOnBlur(H){H.focusTracker.on("change:isFocused",(B,t,V)=>{V||!H.isOpen||(H.isOpen=!1)})}function focusDropdownContentsOnArrows(H){H.keystrokes.set("arrowdown",(B,t)=>{H.isOpen&&(H.panelView.focus(),t())}),H.keystrokes.set("arrowup",(B,t)=>{H.isOpen&&(H.panelView.focusLast(),t())})}function focusDropdownButtonOnClose(H){H.on("change:isOpen",(B,t,V)=>{if(V)return;H.focusTracker.elements.some(W=>W.contains(global$1.document.activeElement))&&H.buttonView.focus()})}function focusDropdownPanelOnOpen(H){H.on("change:isOpen",(B,t,V)=>{V&&H.panelView.focus()},{priority:"low"})}function bindViewCollectionItemsToDefinitions(H,B,t,V){B.on("change",()=>{const N=[...B].reduce((K,G)=>(G instanceof ListItemView&&G.children.first instanceof ListItemButtonView&&K.push(G.children.first),K),[]),W=N.some(K=>K.isToggleable);N.forEach(K=>{K.hasCheckSpace=W})}),B.bindTo(t).using(N=>{if(N.type==="separator")return new ListSeparatorView(V);if(N.type==="group"){const W=new ListItemGroupView(V);return W.set({label:N.label}),bindViewCollectionItemsToDefinitions(H,W.items,N.items,V),W.items.delegate("execute").to(H),W}else if(N.type==="button"||N.type==="switchbutton"){const W=N.model.role==="menuitemcheckbox"||N.model.role==="menuitemradio",K=new ListItemView(V);let G;return N.type==="button"?(G=new ListItemButtonView(V),G.set({isToggleable:W})):G=new SwitchButtonView(V),G.bind(...Object.keys(N.model)).to(N.model),G.delegate("execute").to(K),K.children.add(G),K}return null})}const createLabeledInputText=(H,B,t)=>{const V=new InputTextView(H.locale);return V.set({id:B,ariaDescribedById:t}),V.bind("isReadOnly").to(H,"isEnabled",N=>!N),V.bind("hasError").to(H,"errorText",N=>!!N),V.on("input",()=>{H.errorText=null}),H.bind("isEmpty","isFocused","placeholder").to(V),V},createLabeledInputNumber=(H,B,t)=>{const V=new InputNumberView(H.locale);return V.set({id:B,ariaDescribedById:t,inputMode:"numeric"}),V.bind("isReadOnly").to(H,"isEnabled",N=>!N),V.bind("hasError").to(H,"errorText",N=>!!N),V.on("input",()=>{H.errorText=null}),H.bind("isEmpty","isFocused","placeholder").to(V),V},createLabeledDropdown=(H,B,t)=>{const V=createDropdown(H.locale);return V.set({id:B,ariaDescribedById:t}),V.bind("isEnabled").to(H),V},waitingTime=150;class ColorPickerView extends View{constructor(t,V={}){super(t);ee(this,"hexInputRow");ee(this,"_debounceColorPickerEvent");ee(this,"_config");this.set({color:"",_hexColor:""}),this.hexInputRow=this._createInputRow();const N=this.createCollection();V.hideInput||N.add(this.hexInputRow),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker"],tabindex:-1},children:N}),this._config=V,this._debounceColorPickerEvent=debounce(W=>{this.set("color",W),this.fire("colorSelected",{color:this.color})},waitingTime,{leading:!0}),this.on("set:color",(W,K,G)=>{W.return=convertColor(G,this._config.format||"hsl")}),this.on("change:color",()=>{this._hexColor=convertColorToCommonHexFormat(this.color)}),this.on("change:_hexColor",()=>{document.activeElement!==this.picker&&this.picker.setAttribute("color",this._hexColor),convertColorToCommonHexFormat(this.color)!=convertColorToCommonHexFormat(this._hexColor)&&(this.color=this._hexColor)})}render(){if(super.render(),registerCustomElement("hex-color-picker",HexBase),this.picker=global$1.document.createElement("hex-color-picker"),this.picker.setAttribute("class","hex-color-picker"),this.picker.setAttribute("tabindex","-1"),this._createSlidersView(),this.element){this.hexInputRow.element?this.element.insertBefore(this.picker,this.hexInputRow.element):this.element.appendChild(this.picker);const t=document.createElement("style");t.textContent='[role="slider"]:focus [part$="pointer"] {border: 1px solid #fff;outline: 1px solid var(--ck-color-focus-border);box-shadow: 0 0 0 2px #fff;}',this.picker.shadowRoot.appendChild(t)}this.picker.addEventListener("color-changed",t=>{const V=t.detail.value;this._debounceColorPickerEvent(V)})}focus(){/* istanbul ignore next -- @preserve */!this._config.hideInput&&(env.isGecko||env.isiOS||env.isSafari)&&this.hexInputRow.children.get(1).focus(),this.slidersView.first.focus()}_createSlidersView(){const N=[...this.picker.shadowRoot.children].filter(W=>W.getAttribute("role")==="slider").map(W=>new SliderView(W));this.slidersView=this.createCollection(),N.forEach(W=>{this.slidersView.add(W)})}_createInputRow(){const t=this._createColorInput();return new ColorPickerInputRowView(this.locale,t)}_createColorInput(){const t=new LabeledFieldView(this.locale,createLabeledInputText),{t:V}=this.locale;return t.set({label:V("HEX"),class:"color-picker-hex-input"}),t.fieldView.bind("value").to(this,"_hexColor",N=>t.isFocused?t.fieldView.value:N.startsWith("#")?N.substring(1):N),t.fieldView.on("input",()=>{const N=t.fieldView.element.value;if(N){const W=tryParseHexColor(N);W&&this._debounceColorPickerEvent(W)}}),t}isValid(){const{t}=this.locale;return this._config.hideInput?!0:(this.resetValidationStatus(),this.hexInputRow.getParsedColor()?!0:(this.hexInputRow.inputView.errorText=t('Please enter a valid color (e.g. "ff0000").'),!1))}resetValidationStatus(){this.hexInputRow.inputView.errorText=null}}function convertColorToCommonHexFormat(H){let B=convertToHex(H);return B||(B="#000"),B.length===4&&(B="#"+[B[1],B[1],B[2],B[2],B[3],B[3]].join("")),B.toLowerCase()}class SliderView extends View{constructor(B){super(),this.element=B}focus(){this.element.focus()}}class HashView extends View{constructor(B){super(B),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker__hash-view"]},children:"#"})}}class ColorPickerInputRowView extends View{constructor(t,V){super(t);ee(this,"children");ee(this,"inputView");this.inputView=V,this.children=this.createCollection([new HashView,this.inputView]),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker__row"]},children:this.children})}getParsedColor(){return tryParseHexColor(this.inputView.fieldView.element.value)}}function tryParseHexColor(H){if(!H)return null;const B=H.trim().replace(/^#/,"");return![3,4,6,8].includes(B.length)||!/^(([0-9a-fA-F]{2}){3,4}|([0-9a-fA-F]){3,4})$/.test(B)?null:`#${B}`}class DocumentColorCollection extends ObservableMixin(Collection){constructor(B){super(B),this.set("isEmpty",!0),this.on("change",()=>{this.set("isEmpty",this.length===0)})}add(B,t){return this.find(V=>V.color===B.color)?this:super.add(B,t)}hasColor(B){return!!this.find(t=>t.color===B)}}class ColorGridsFragmentView extends View{constructor(t,{colors:V,columns:N,removeButtonLabel:W,documentColorsLabel:K,documentColorsCount:G,colorPickerLabel:Z,focusTracker:Y,focusables:X}){super(t);ee(this,"items");ee(this,"colorDefinitions");ee(this,"focusTracker");ee(this,"columns");ee(this,"documentColors");ee(this,"documentColorsCount");ee(this,"staticColorsGrid");ee(this,"documentColorsGrid");ee(this,"colorPickerButtonView");ee(this,"removeColorButtonView");ee(this,"_focusables");ee(this,"_documentColorsLabel");ee(this,"_removeButtonLabel");ee(this,"_colorPickerLabel");const Q=this.bindTemplate;this.set("isVisible",!0),this.focusTracker=Y,this.items=this.createCollection(),this.colorDefinitions=V,this.columns=N,this.documentColors=new DocumentColorCollection,this.documentColorsCount=G,this._focusables=X,this._removeButtonLabel=W,this._colorPickerLabel=Z,this._documentColorsLabel=K,this.setTemplate({tag:"div",attributes:{class:["ck-color-grids-fragment",Q.if("isVisible","ck-hidden",te=>!te)]},children:this.items}),this.removeColorButtonView=this._createRemoveColorButton(),this.items.add(this.removeColorButtonView)}updateDocumentColors(t,V){const N=t.document,W=this.documentColorsCount;this.documentColors.clear();for(const K of N.getRoots()){const G=t.createRangeIn(K);for(const Z of G.getItems())if(Z.is("$textProxy")&&Z.hasAttribute(V)&&(this._addColorToDocumentColors(Z.getAttribute(V)),this.documentColors.length>=W))return}}updateSelectedColors(){const t=this.documentColorsGrid,V=this.staticColorsGrid,N=this.selectedColor;V.selectedColor=N,t&&(t.selectedColor=N)}render(){if(super.render(),this.staticColorsGrid=this._createStaticColorsGrid(),this.items.add(this.staticColorsGrid),this.documentColorsCount){const t=Template.bind(this.documentColors,this.documentColors),V=new View(this.locale);V.setTemplate({tag:"span",attributes:{class:["ck","ck-color-grid__label",t.if("isEmpty","ck-hidden")]},children:[{text:this._documentColorsLabel}]}),this.items.add(V),this.documentColorsGrid=this._createDocumentColorsGrid(),this.items.add(this.documentColorsGrid)}this._createColorPickerButton(),this._addColorSelectorElementsToFocusTracker()}focus(){this.removeColorButtonView.focus()}destroy(){super.destroy()}addColorPickerButton(){this.colorPickerButtonView&&(this.items.add(this.colorPickerButtonView),this.focusTracker.add(this.colorPickerButtonView.element),this._focusables.add(this.colorPickerButtonView))}_addColorSelectorElementsToFocusTracker(){this.focusTracker.add(this.removeColorButtonView.element),this._focusables.add(this.removeColorButtonView),this.staticColorsGrid&&(this.focusTracker.add(this.staticColorsGrid.element),this._focusables.add(this.staticColorsGrid)),this.documentColorsGrid&&(this.focusTracker.add(this.documentColorsGrid.element),this._focusables.add(this.documentColorsGrid))}_createColorPickerButton(){this.colorPickerButtonView=new ButtonView,this.colorPickerButtonView.set({label:this._colorPickerLabel,withText:!0,icon:icons.colorPalette,class:"ck-color-selector__color-picker"}),this.colorPickerButtonView.on("execute",()=>{this.fire("colorPicker:show")})}_createRemoveColorButton(){const t=new ButtonView;return t.set({withText:!0,icon:icons.eraser,label:this._removeButtonLabel}),t.class="ck-color-selector__remove-color",t.on("execute",()=>{this.fire("execute",{value:null,source:"removeColorButton"})}),t.render(),t}_createStaticColorsGrid(){const t=new ColorGridView(this.locale,{colorDefinitions:this.colorDefinitions,columns:this.columns});return t.on("execute",(V,N)=>{this.fire("execute",{value:N.value,source:"staticColorsGrid"})}),t}_createDocumentColorsGrid(){const t=Template.bind(this.documentColors,this.documentColors),V=new ColorGridView(this.locale,{columns:this.columns});return V.extendTemplate({attributes:{class:t.if("isEmpty","ck-hidden")}}),V.items.bindTo(this.documentColors).using(N=>{const W=new ColorTileView;return W.set({color:N.color,hasBorder:N.options&&N.options.hasBorder}),N.label&&W.set({label:N.label,tooltip:!0}),W.on("execute",()=>{this.fire("execute",{value:N.color,source:"documentColorsGrid"})}),W}),this.documentColors.on("change:isEmpty",(N,W,K)=>{K&&(V.selectedColor=null)}),V}_addColorToDocumentColors(t){const V=this.colorDefinitions.find(N=>N.color===t);V?this.documentColors.add(Object.assign({},V)):this.documentColors.add({color:t,label:t,options:{hasBorder:!1}})}}class ColorPickerFragmentView extends View{constructor(t,{focusTracker:V,focusables:N,keystrokes:W,colorPickerViewConfig:K}){super(t);ee(this,"items");ee(this,"colorPickerView");ee(this,"saveButtonView");ee(this,"cancelButtonView");ee(this,"actionBarView");ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"_focusables");ee(this,"_colorPickerViewConfig");this.items=this.createCollection(),this.focusTracker=V,this.keystrokes=W,this.set("isVisible",!1),this.set("selectedColor",void 0),this._focusables=N,this._colorPickerViewConfig=K;const G=this.bindTemplate,{saveButtonView:Z,cancelButtonView:Y}=this._createActionButtons();this.saveButtonView=Z,this.cancelButtonView=Y,this.actionBarView=this._createActionBarView({saveButtonView:Z,cancelButtonView:Y}),this.setTemplate({tag:"div",attributes:{class:["ck-color-picker-fragment",G.if("isVisible","ck-hidden",X=>!X)]},children:this.items})}render(){super.render();const t=new ColorPickerView(this.locale,{...this._colorPickerViewConfig});this.colorPickerView=t,this.colorPickerView.render(),this.selectedColor&&(t.color=this.selectedColor),this.listenTo(this,"change:selectedColor",(V,N,W)=>{t.color=W}),this.items.add(this.colorPickerView),this.items.add(this.actionBarView),this._addColorPickersElementsToFocusTracker(),this._stopPropagationOnArrowsKeys(),this._executeOnEnterPress(),this._executeUponColorChange()}destroy(){super.destroy()}focus(){this.colorPickerView.focus()}resetValidationStatus(){this.colorPickerView.resetValidationStatus()}_executeOnEnterPress(){this.keystrokes.set("enter",t=>{this.isVisible&&this.focusTracker.focusedElement!==this.cancelButtonView.element&&this.colorPickerView.isValid()&&(this.fire("execute",{value:this.selectedColor}),t.stopPropagation(),t.preventDefault())})}_stopPropagationOnArrowsKeys(){const t=V=>V.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}_addColorPickersElementsToFocusTracker(){for(const V of this.colorPickerView.slidersView)this.focusTracker.add(V.element),this._focusables.add(V);const t=this.colorPickerView.hexInputRow.children.get(1);t.element&&(this.focusTracker.add(t.element),this._focusables.add(t)),this.focusTracker.add(this.saveButtonView.element),this._focusables.add(this.saveButtonView),this.focusTracker.add(this.cancelButtonView.element),this._focusables.add(this.cancelButtonView)}_createActionBarView({saveButtonView:t,cancelButtonView:V}){const N=new View,W=this.createCollection();return W.add(t),W.add(V),N.setTemplate({tag:"div",attributes:{class:["ck","ck-color-selector_action-bar"]},children:W}),N}_createActionButtons(){const t=this.locale,V=t.t,N=new ButtonView(t),W=new ButtonView(t);return N.set({icon:icons.check,class:"ck-button-save",type:"button",withText:!1,label:V("Accept")}),W.set({icon:icons.cancel,class:"ck-button-cancel",type:"button",withText:!1,label:V("Cancel")}),N.on("execute",()=>{this.colorPickerView.isValid()&&this.fire("execute",{source:"colorPickerSaveButton",value:this.selectedColor})}),W.on("execute",()=>{this.fire("colorPicker:cancel")}),{saveButtonView:N,cancelButtonView:W}}_executeUponColorChange(){this.colorPickerView.on("colorSelected",(t,V)=>{this.fire("execute",{value:V.color,source:"colorPicker"}),this.set("selectedColor",V.color)})}}class ColorSelectorView extends View{constructor(t,{colors:V,columns:N,removeButtonLabel:W,documentColorsLabel:K,documentColorsCount:G,colorPickerLabel:Z,colorPickerViewConfig:Y}){super(t);ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"items");ee(this,"colorGridsFragmentView");ee(this,"colorPickerFragmentView");ee(this,"_focusCycler");ee(this,"_focusables");ee(this,"_colorPickerViewConfig");this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusables=new ViewCollection,this._colorPickerViewConfig=Y,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.colorGridsFragmentView=new ColorGridsFragmentView(t,{colors:V,columns:N,removeButtonLabel:W,documentColorsLabel:K,documentColorsCount:G,colorPickerLabel:Z,focusTracker:this.focusTracker,focusables:this._focusables}),this.colorPickerFragmentView=new ColorPickerFragmentView(t,{focusables:this._focusables,focusTracker:this.focusTracker,keystrokes:this.keystrokes,colorPickerViewConfig:Y}),this.set("_isColorGridsFragmentVisible",!0),this.set("_isColorPickerFragmentVisible",!1),this.set("selectedColor",void 0),this.colorGridsFragmentView.bind("isVisible").to(this,"_isColorGridsFragmentVisible"),this.colorPickerFragmentView.bind("isVisible").to(this,"_isColorPickerFragmentVisible"),this.on("change:selectedColor",(X,Q,te)=>{this.colorGridsFragmentView.set("selectedColor",te),this.colorPickerFragmentView.set("selectedColor",te)}),this.colorGridsFragmentView.on("change:selectedColor",(X,Q,te)=>{this.set("selectedColor",te)}),this.colorPickerFragmentView.on("change:selectedColor",(X,Q,te)=>{this.set("selectedColor",te)}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-selector"]},children:this.items})}render(){super.render(),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}appendUI(){this._appendColorGridsFragment(),this._colorPickerViewConfig&&this._appendColorPickerFragment()}showColorPickerFragment(){!this.colorPickerFragmentView.colorPickerView||this._isColorPickerFragmentVisible||(this._isColorPickerFragmentVisible=!0,this.colorPickerFragmentView.focus(),this.colorPickerFragmentView.resetValidationStatus(),this._isColorGridsFragmentVisible=!1)}showColorGridsFragment(){this._isColorGridsFragmentVisible||(this._isColorGridsFragmentVisible=!0,this.colorGridsFragmentView.focus(),this._isColorPickerFragmentVisible=!1)}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}updateDocumentColors(t,V){this.colorGridsFragmentView.updateDocumentColors(t,V)}updateSelectedColors(){this.colorGridsFragmentView.updateSelectedColors()}_appendColorGridsFragment(){this.items.length||(this.items.add(this.colorGridsFragmentView),this.colorGridsFragmentView.delegate("execute").to(this),this.colorGridsFragmentView.delegate("colorPicker:show").to(this))}_appendColorPickerFragment(){this.items.length!==2&&(this.items.add(this.colorPickerFragmentView),this.colorGridsFragmentView.colorPickerButtonView&&this.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{this.showColorPickerFragment()}),this.colorGridsFragmentView.addColorPickerButton(),this.colorPickerFragmentView.delegate("execute").to(this),this.colorPickerFragmentView.delegate("colorPicker:cancel").to(this))}}class ComponentFactory{constructor(B){ee(this,"editor");ee(this,"_components",new Map);this.editor=B}*names(){for(const B of this._components.values())yield B.originalName}add(B,t){this._components.set(getNormalized(B),{callback:t,originalName:B})}create(B){if(!this.has(B))throw new CKEditorError("componentfactory-item-missing",this,{name:B});return this._components.get(getNormalized(B)).callback(this.editor.locale)}has(B){return this._components.has(getNormalized(B))}}function getNormalized(H){return String(H).toLowerCase()}const BALLOON_CLASS="ck-tooltip",Ue=class Ue extends DomEmitterMixin(){constructor(t){super();ee(this,"tooltipTextView");ee(this,"balloonPanelView");ee(this,"_currentElementWithTooltip",null);ee(this,"_currentTooltipPosition",null);ee(this,"_mutationObserver",null);ee(this,"_pinTooltipDebounced");ee(this,"_unpinTooltipDebounced");ee(this,"_watchdogExcluded");if(Ue._editors.add(t),Ue._instance)return Ue._instance;Ue._instance=this,this.tooltipTextView=new View(t.locale),this.tooltipTextView.set("text",""),this.tooltipTextView.setTemplate({tag:"span",attributes:{class:["ck","ck-tooltip__text"]},children:[{text:this.tooltipTextView.bindTemplate.to("text")}]}),this.balloonPanelView=new BalloonPanelView(t.locale),this.balloonPanelView.class=BALLOON_CLASS,this.balloonPanelView.content.add(this.tooltipTextView),this._mutationObserver=createMutationObserver(()=>{this._updateTooltipPosition()}),this._pinTooltipDebounced=debounce(this._pinTooltip,600),this._unpinTooltipDebounced=debounce(this._unpinTooltip,400),this.listenTo(global$1.document,"keydown",this._onKeyDown.bind(this),{useCapture:!0}),this.listenTo(global$1.document,"mouseenter",this._onEnterOrFocus.bind(this),{useCapture:!0}),this.listenTo(global$1.document,"mouseleave",this._onLeaveOrBlur.bind(this),{useCapture:!0}),this.listenTo(global$1.document,"focus",this._onEnterOrFocus.bind(this),{useCapture:!0}),this.listenTo(global$1.document,"blur",this._onLeaveOrBlur.bind(this),{useCapture:!0}),this.listenTo(global$1.document,"scroll",this._onScroll.bind(this),{useCapture:!0}),this._watchdogExcluded=!0}destroy(t){const V=t.ui.view&&t.ui.view.body;Ue._editors.delete(t),this.stopListening(t.ui),V&&V.has(this.balloonPanelView)&&V.remove(this.balloonPanelView),Ue._editors.size||(this._unpinTooltip(),this.balloonPanelView.destroy(),this.stopListening(),Ue._instance=null)}static getPositioningFunctions(t){const V=Ue.defaultBalloonPositions;return{s:[V.southArrowNorth,V.southArrowNorthEast,V.southArrowNorthWest],n:[V.northArrowSouth],e:[V.eastArrowWest],w:[V.westArrowEast],sw:[V.southArrowNorthEast],se:[V.southArrowNorthWest]}[t]}_onKeyDown(t,V){V.key==="Escape"&&this._currentElementWithTooltip&&(this._unpinTooltip(),V.stopPropagation())}_onEnterOrFocus(t,{target:V}){const N=getDescendantWithTooltip(V);if(!N){t.name==="focus"&&this._unpinTooltip();return}N!==this._currentElementWithTooltip&&(this._unpinTooltip(),t.name==="focus"&&!N.matches(":hover")?this._pinTooltip(N,getTooltipData(N)):this._pinTooltipDebounced(N,getTooltipData(N)))}_onLeaveOrBlur(t,{target:V,relatedTarget:N}){if(t.name==="mouseleave"){if(!isElement$1(V))return;const W=this.balloonPanelView.element,K=W&&(W===N||W.contains(N)),G=!K&&V===W;if(K){this._unpinTooltipDebounced.cancel();return}if(!G&&this._currentElementWithTooltip&&V!==this._currentElementWithTooltip)return;const Z=getDescendantWithTooltip(V),Y=getDescendantWithTooltip(N);(G||Z&&Z!==Y)&&this._unpinTooltipDebounced()}else{if(this._currentElementWithTooltip&&V!==this._currentElementWithTooltip)return;this._unpinTooltipDebounced()}}_onScroll(t,{target:V}){this._currentElementWithTooltip&&(V.contains(this.balloonPanelView.element)&&V.contains(this._currentElementWithTooltip)||this._unpinTooltip())}_pinTooltip(t,{text:V,position:N,cssClass:W}){this._unpinTooltip();const K=first(Ue._editors.values()).ui.view.body;K.has(this.balloonPanelView)||K.add(this.balloonPanelView),this.tooltipTextView.text=V,this.balloonPanelView.class=[BALLOON_CLASS,W].filter(G=>G).join(" "),this.balloonPanelView.pin({target:t,positions:Ue.getPositioningFunctions(N)}),this._mutationObserver.attach(t);for(const G of Ue._editors)this.listenTo(G.ui,"update",this._updateTooltipPosition.bind(this),{priority:"low"});this._currentElementWithTooltip=t,this._currentTooltipPosition=N}_unpinTooltip(){this._unpinTooltipDebounced.cancel(),this._pinTooltipDebounced.cancel(),this.balloonPanelView.unpin();for(const t of Ue._editors)this.stopListening(t.ui,"update");this._currentElementWithTooltip=null,this._currentTooltipPosition=null,this.tooltipTextView.text="",this._mutationObserver.detach()}_updateTooltipPosition(){if(!this._currentElementWithTooltip)return;const t=getTooltipData(this._currentElementWithTooltip);if(!isVisible(this._currentElementWithTooltip)||!t.text){this._unpinTooltip();return}this.balloonPanelView.pin({target:this._currentElementWithTooltip,positions:Ue.getPositioningFunctions(t.position)})}};ee(Ue,"defaultBalloonPositions",BalloonPanelView.generatePositions({heightOffset:5,sideOffset:13})),ee(Ue,"_editors",new Set),ee(Ue,"_instance",null);let TooltipManager=Ue;function getDescendantWithTooltip(H){return isElement$1(H)?H.closest("[data-cke-tooltip-text]:not([data-cke-tooltip-disabled])"):null}function getTooltipData(H){return{text:H.dataset.ckeTooltipText,position:H.dataset.ckeTooltipPosition||"s",cssClass:H.dataset.ckeTooltipClass||""}}function createMutationObserver(H){const B=new MutationObserver(()=>{H()});return{attach(t){B.observe(t,{attributes:!0,attributeFilter:["data-cke-tooltip-text","data-cke-tooltip-position"]})},detach(){B.disconnect()}}}var poweredByIcon=`<svg xmlns="http://www.w3.org/2000/svg" width="53" height="10" viewBox="0 0 53 10"><path fill="#1C2331" d="M31.724 1.492a15.139 15.139 0 0 0 .045 1.16 2.434 2.434 0 0 0-.687-.34 3.68 3.68 0 0 0-1.103-.166 2.332 2.332 0 0 0-1.14.255 1.549 1.549 0 0 0-.686.87c-.15.41-.225.98-.225 1.712 0 .939.148 1.659.444 2.161.297.503.792.754 1.487.754.452.015.9-.094 1.294-.316.296-.174.557-.4.771-.669l.14.852h1.282V.007h-1.623v1.485ZM31 6.496a1.77 1.77 0 0 1-.494.061.964.964 0 0 1-.521-.127.758.758 0 0 1-.296-.466 3.984 3.984 0 0 1-.093-.992 4.208 4.208 0 0 1 .098-1.052.753.753 0 0 1 .307-.477 1.08 1.08 0 0 1 .55-.122c.233-.004.466.026.69.089l.483.144v2.553c-.11.076-.213.143-.307.2a1.73 1.73 0 0 1-.417.189ZM35.68 0l-.702.004c-.322.002-.482.168-.48.497l.004.581c.002.33.164.493.486.49l.702-.004c.322-.002.481-.167.48-.496L36.165.49c-.002-.33-.164-.493-.486-.491ZM36.145 2.313l-1.612.01.034 5.482 1.613-.01-.035-5.482ZM39.623.79 37.989.8 38 2.306l-.946.056.006 1.009.949-.006.024 2.983c.003.476.143.844.419 1.106.275.26.658.39 1.148.387.132 0 .293-.01.483-.03.19-.02.38-.046.57-.08.163-.028.324-.068.482-.119l-.183-1.095-.702.004a.664.664 0 0 1-.456-.123.553.553 0 0 1-.14-.422l-.016-2.621 1.513-.01-.006-1.064-1.514.01-.01-1.503ZM46.226 2.388c-.41-.184-.956-.274-1.636-.27-.673.004-1.215.101-1.627.29-.402.179-.72.505-.888.91-.18.419-.268.979-.264 1.68.004.688.1 1.24.285 1.655.172.404.495.724.9.894.414.18.957.268 1.63.264.68-.004 1.224-.099 1.632-.284.4-.176.714-.501.878-.905.176-.418.263-.971.258-1.658-.004-.702-.097-1.261-.28-1.677a1.696 1.696 0 0 0-.888-.9Zm-.613 3.607a.77.77 0 0 1-.337.501 1.649 1.649 0 0 1-1.317.009.776.776 0 0 1-.343-.497 4.066 4.066 0 0 1-.105-1.02 4.136 4.136 0 0 1 .092-1.03.786.786 0 0 1 .337-.507 1.59 1.59 0 0 1 1.316-.008.79.79 0 0 1 .344.502c.078.337.113.683.105 1.03.012.343-.019.685-.092 1.02ZM52.114 2.07a2.67 2.67 0 0 0-1.128.278c-.39.191-.752.437-1.072.73l-.157-.846-1.273.008.036 5.572 1.623-.01-.024-3.78c.35-.124.646-.22.887-.286.26-.075.53-.114.8-.118l.45-.003.144-1.546-.286.001ZM22.083 7.426l-1.576-2.532a2.137 2.137 0 0 0-.172-.253 1.95 1.95 0 0 0-.304-.29.138.138 0 0 1 .042-.04 1.7 1.7 0 0 0 .328-.374l1.75-2.71c.01-.015.025-.028.024-.048-.01-.01-.021-.007-.031-.007L20.49 1.17a.078.078 0 0 0-.075.045l-.868 1.384c-.23.366-.46.732-.688 1.099a.108.108 0 0 1-.112.06c-.098-.005-.196-.001-.294-.002-.018 0-.038.006-.055-.007.002-.02.002-.039.005-.058a4.6 4.6 0 0 0 .046-.701V1.203c0-.02-.009-.032-.03-.03h-.033L16.93 1.17c-.084 0-.073-.01-.073.076v6.491c-.001.018.006.028.025.027h1.494c.083 0 .072.007.072-.071v-2.19c0-.055-.003-.11-.004-.166a3.366 3.366 0 0 0-.05-.417h.06c.104 0 .209.002.313-.002a.082.082 0 0 1 .084.05c.535.913 1.07 1.824 1.607 2.736a.104.104 0 0 0 .103.062c.554-.003 1.107-.002 1.66-.002l.069-.003-.019-.032-.188-.304ZM27.112 6.555c-.005-.08-.004-.08-.082-.08h-2.414c-.053 0-.106-.003-.159-.011a.279.279 0 0 1-.246-.209.558.558 0 0 1-.022-.15c0-.382 0-.762-.002-1.143 0-.032.007-.049.042-.044h2.504c.029.003.037-.012.034-.038V3.814c0-.089.013-.078-.076-.078h-2.44c-.07 0-.062.003-.062-.06v-.837c0-.047.004-.093.013-.14a.283.283 0 0 1 .241-.246.717.717 0 0 1 .146-.011h2.484c.024.002.035-.009.036-.033l.003-.038.03-.496c.01-.183.024-.365.034-.548.005-.085.003-.087-.082-.094-.218-.018-.437-.038-.655-.05a17.845 17.845 0 0 0-.657-.026 72.994 72.994 0 0 0-1.756-.016 1.7 1.7 0 0 0-.471.064 1.286 1.286 0 0 0-.817.655c-.099.196-.149.413-.145.633v3.875c0 .072.003.144.011.216a1.27 1.27 0 0 0 .711 1.029c.228.113.48.167.734.158.757-.005 1.515.002 2.272-.042.274-.016.548-.034.82-.053.03-.002.043-.008.04-.041-.008-.104-.012-.208-.019-.312a69.964 69.964 0 0 1-.05-.768ZM16.14 7.415l-.127-1.075c-.004-.03-.014-.04-.044-.037a13.125 13.125 0 0 1-.998.073c-.336.01-.672.02-1.008.016-.116-.001-.233-.014-.347-.039a.746.746 0 0 1-.45-.262c-.075-.1-.132-.211-.167-.33a3.324 3.324 0 0 1-.126-.773 9.113 9.113 0 0 1-.015-.749c0-.285.022-.57.065-.852.023-.158.066-.312.127-.46a.728.728 0 0 1 .518-.443 1.64 1.64 0 0 1 .397-.048c.628-.001 1.255.003 1.882.05.022.001.033-.006.036-.026l.003-.031.06-.55c.019-.177.036-.355.057-.532.004-.034-.005-.046-.04-.056a5.595 5.595 0 0 0-1.213-.21 10.783 10.783 0 0 0-.708-.02c-.24-.003-.48.01-.719.041a3.477 3.477 0 0 0-.625.14 1.912 1.912 0 0 0-.807.497c-.185.2-.33.433-.424.688a4.311 4.311 0 0 0-.24 1.096c-.031.286-.045.572-.042.86-.006.43.024.86.091 1.286.04.25.104.497.193.734.098.279.26.53.473.734.214.205.473.358.756.446.344.11.702.17 1.063.177a8.505 8.505 0 0 0 1.578-.083 6.11 6.11 0 0 0 .766-.18c.03-.008.047-.023.037-.057a.157.157 0 0 1-.003-.025Z"/><path fill="#AFE229" d="M6.016 6.69a1.592 1.592 0 0 0-.614.21c-.23.132-.422.32-.56.546-.044.072-.287.539-.287.539l-.836 1.528.009.006c.038.025.08.046.123.063.127.046.26.07.395.073.505.023 1.011-.007 1.517-.003.29.009.58.002.869-.022a.886.886 0 0 0 .395-.116.962.962 0 0 0 .312-.286c.056-.083.114-.163.164-.249.24-.408.48-.816.718-1.226.075-.128.148-.257.222-.386l.112-.192a1.07 1.07 0 0 0 .153-.518l-1.304.023s-1.258-.005-1.388.01Z"/><path fill="#771BFF" d="m2.848 9.044.76-1.39.184-.352c-.124-.067-.245-.14-.367-.21-.346-.204-.706-.384-1.045-.6a.984.984 0 0 1-.244-.207c-.108-.134-.136-.294-.144-.46-.021-.409-.002-.818-.009-1.227-.003-.195 0-.39.003-.585.004-.322.153-.553.427-.713l.833-.488c.22-.13.44-.257.662-.385.05-.029.105-.052.158-.077.272-.128.519-.047.76.085l.044.028c.123.06.242.125.358.196.318.178.635.357.952.537.095.056.187.117.275.184.194.144.254.35.266.578.016.284.007.569.006.853-.001.28.004.558 0 .838.592-.003 1.259 0 1.259 0l.723-.013c-.003-.292-.007-.584-.007-.876 0-.524.015-1.048-.016-1.571-.024-.42-.135-.8-.492-1.067a5.02 5.02 0 0 0-.506-.339A400.52 400.52 0 0 0 5.94.787C5.722.664 5.513.524 5.282.423 5.255.406 5.228.388 5.2.373 4.758.126 4.305-.026 3.807.21c-.097.046-.197.087-.29.14A699.896 699.896 0 0 0 .783 1.948c-.501.294-.773.717-.778 1.31-.004.36-.009.718-.001 1.077.016.754-.017 1.508.024 2.261.016.304.07.6.269.848.127.15.279.28.448.382.622.4 1.283.734 1.92 1.11l.183.109Z"/></svg>
`;const ICON_WIDTH=53,ICON_HEIGHT=10,NARROW_ROOT_HEIGHT_THRESHOLD=50,NARROW_ROOT_WIDTH_THRESHOLD=350,DEFAULT_LABEL="Powered by";class PoweredBy extends DomEmitterMixin(){constructor(t){super();ee(this,"editor");ee(this,"_balloonView");ee(this,"_showBalloonThrottled");ee(this,"_lastFocusedEditableElement");this.editor=t,this._balloonView=null,this._lastFocusedEditableElement=null,this._showBalloonThrottled=throttle(this._showBalloon.bind(this),50,{leading:!0}),t.on("ready",this._handleEditorReady.bind(this))}destroy(){const t=this._balloonView;t&&(t.unpin(),this._balloonView=null),this._showBalloonThrottled.cancel(),this.stopListening()}_handleEditorReady(){const t=this.editor,V=!!t.config.get("ui.poweredBy.forceVisible");/* istanbul ignore next -- @preserve */!V&&verifyLicense(t.config.get("licenseKey"))==="VALID"||t.ui.view&&(t.ui.focusTracker.on("change:isFocused",(N,W,K)=>{this._updateLastFocusedEditableElement(),K?this._showBalloon():this._hideBalloon()}),t.ui.focusTracker.on("change:focusedElement",(N,W,K)=>{this._updateLastFocusedEditableElement(),K&&this._showBalloon()}),t.ui.on("update",()=>{this._showBalloonThrottled()}))}_createBalloonView(){const t=this.editor,V=this._balloonView=new BalloonPanelView,N=getNormalizedConfig$1(t),W=new PoweredByView(t.locale,N.label);V.content.add(W),V.set({class:"ck-powered-by-balloon"}),t.ui.view.body.add(V),this._balloonView=V}_showBalloon(){if(!this._lastFocusedEditableElement)return;const t=getBalloonAttachOptions(this.editor,this._lastFocusedEditableElement);t&&(this._balloonView||this._createBalloonView(),this._balloonView.pin(t))}_hideBalloon(){this._balloonView&&this._balloonView.unpin()}_updateLastFocusedEditableElement(){const t=this.editor,V=t.ui.focusTracker.isFocused,N=t.ui.focusTracker.focusedElement;if(!V||!N){this._lastFocusedEditableElement=null;return}const W=Array.from(t.ui.getEditableElementsNames()).map(K=>t.ui.getEditableElement(K));W.includes(N)?this._lastFocusedEditableElement=N:this._lastFocusedEditableElement=W[0]}}class PoweredByView extends View{constructor(B,t){super(B);const V=new IconView,N=this.bindTemplate;V.set({content:poweredByIcon,isColorInherited:!1}),V.extendTemplate({attributes:{style:{width:ICON_WIDTH+"px",height:ICON_HEIGHT+"px"}}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-powered-by"],"aria-hidden":!0},children:[{tag:"a",attributes:{href:"https://ckeditor.com/powered-by-ckeditor/?utm_source=ckeditor&utm_medium=referral&utm_campaign=701Dn000000hVgmIAE_powered_by_ckeditor_logo",target:"_blank",tabindex:"-1"},children:[...t?[{tag:"span",attributes:{class:["ck","ck-powered-by__label"]},children:[t]}]:[],V],on:{dragstart:N.to(W=>W.preventDefault())}}]})}}function getBalloonAttachOptions(H,B){const t=getNormalizedConfig$1(H),V=t.side==="right"?getLowerRightCornerPosition(B,t):getLowerLeftCornerPosition(B,t);return{target:B,positions:[V]}}function getLowerRightCornerPosition(H,B){return getLowerCornerPosition(H,B,(t,V)=>t.left+t.width-V.width-B.horizontalOffset)}function getLowerLeftCornerPosition(H,B){return getLowerCornerPosition(H,B,t=>t.left+B.horizontalOffset)}function getLowerCornerPosition(H,B,t){return(V,N)=>{const W=new Rect(H);if(W.width<NARROW_ROOT_WIDTH_THRESHOLD||W.height<NARROW_ROOT_HEIGHT_THRESHOLD)return null;let K;B.position==="inside"?K=W.bottom-N.height:K=W.bottom-N.height/2,K-=B.verticalOffset;const G=t(W,N),Y=V.clone().moveTo(G,K).getIntersection(N.clone().moveTo(G,K)).getVisible();return!Y||Y.getArea()<N.getArea()?null:{top:K,left:G,name:`position_${B.position}-side_${B.side}`,config:{withArrow:!1}}}}function getNormalizedConfig$1(H){const B=H.config.get("ui.poweredBy"),t=B&&B.position||"border";return{position:t,label:DEFAULT_LABEL,verticalOffset:t==="inside"?5:0,horizontalOffset:5,side:H.locale.contentLanguageDirection==="ltr"?"right":"left",...B}}const AriaLiveAnnouncerPoliteness={POLITE:"polite",ASSERTIVE:"assertive"};class AriaLiveAnnouncer{constructor(B){ee(this,"editor");ee(this,"view");this.editor=B,B.once("ready",()=>{for(const t of Object.values(AriaLiveAnnouncerPoliteness))this.announce("",t)})}announce(B,t=AriaLiveAnnouncerPoliteness.POLITE){const V=this.editor;if(!V.ui.view)return;this.view||(this.view=new AriaLiveAnnouncerView(V.locale),V.ui.view.body.add(this.view));const{politeness:N,isUnsafeHTML:W}=typeof t=="string"?{politeness:t}:t;let K=this.view.regionViews.find(G=>G.politeness===N);K||(K=new AriaLiveAnnouncerRegionView(V,N),this.view.regionViews.add(K)),K.announce({announcement:B,isUnsafeHTML:W})}}class AriaLiveAnnouncerView extends View{constructor(t){super(t);ee(this,"regionViews");this.regionViews=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-aria-live-announcer"]},children:this.regionViews})}}class AriaLiveAnnouncerRegionView extends View{constructor(t,V){super(t.locale);ee(this,"politeness");ee(this,"_domConverter");ee(this,"_pruneAnnouncementsInterval");this.setTemplate({tag:"div",attributes:{"aria-live":V,"aria-relevant":"additions"},children:[{tag:"ul",attributes:{class:["ck","ck-aria-live-region-list"]}}]}),t.on("destroy",()=>{this._pruneAnnouncementsInterval!==null&&(clearInterval(this._pruneAnnouncementsInterval),this._pruneAnnouncementsInterval=null)}),this.politeness=V,this._domConverter=t.data.htmlProcessor.domConverter,this._pruneAnnouncementsInterval=setInterval(()=>{this.element&&this._listElement.firstChild&&this._listElement.firstChild.remove()},5e3)}announce({announcement:t,isUnsafeHTML:V}){if(!t.trim().length)return;const N=document.createElement("li");V?this._domConverter.setContentOf(N,t):N.innerText=t,this._listElement.appendChild(N)}get _listElement(){return this.element.querySelector("ul")}}class MenuBarMenuListItemView extends ListItemView{constructor(B,t){super(B);const V=this.bindTemplate;this.extendTemplate({attributes:{class:["ck-menu-bar__menu__item"]},on:{mouseenter:V.to("mouseenter")}}),this.delegate("mouseenter").to(t)}}const NESTED_PANEL_HORIZONTAL_OFFSET=5,MenuBarBehaviors={toggleMenusAndFocusItemsOnHover(H){H.on("menu:mouseenter",B=>{if(!(!H.isFocusBorderEnabled&&!H.isOpen)){if(H.isOpen)for(const t of H.menus){const V=B.path[0],N=V instanceof MenuBarMenuListItemView&&V.children.first===t;t.isOpen=(B.path.includes(t)||N)&&t.isEnabled}B.source.focus()}})},focusCycleMenusOnArrows(H){const B=H.locale.uiLanguageDirection==="rtl";H.on("menu:arrowright",V=>{t(V.source,B?-1:1)}),H.on("menu:arrowleft",V=>{t(V.source,B?1:-1)});function t(V,N){const W=H.children.getIndex(V),K=V.isOpen,G=H.children.length,Z=H.children.get((W+G+N)%G);V.isOpen=!1,K&&(Z.isOpen=!0),Z.buttonView.focus()}},closeMenusWhenTheBarCloses(H){H.on("change:isOpen",()=>{H.isOpen||H.menus.forEach(B=>{B.isOpen=!1})})},closeMenuWhenAnotherOnTheSameLevelOpens(H){H.on("menu:change:isOpen",(B,t,V)=>{V&&H.menus.filter(N=>B.source.parentMenuView===N.parentMenuView&&B.source!==N&&N.isOpen).forEach(N=>{N.isOpen=!1})})},closeOnClickOutside(H){clickOutsideHandler({emitter:H,activator:()=>H.isOpen,callback:()=>H.close(),contextElements:()=>H.children.map(B=>B.element)})},enableFocusHighlightOnInteraction(H){let B=!1;H.on("change:isOpen",(t,V,N)=>{N||(B||(H.isFocusBorderEnabled=!1),B=!1)}),H.listenTo(H.element,"keydown",()=>{B=!0},{useCapture:!0}),H.listenTo(H.element,"keyup",()=>{B=!1},{useCapture:!0}),H.listenTo(H.element,"focus",()=>{B&&(H.isFocusBorderEnabled=!0)},{useCapture:!0})}},MenuBarMenuBehaviors={openAndFocusPanelOnArrowDownKey(H){H.keystrokes.set("arrowdown",(B,t)=>{H.focusTracker.focusedElement===H.buttonView.element&&(H.isOpen||(H.isOpen=!0),H.panelView.focus(),t())})},openOnArrowRightKey(H){const B=H.locale.uiLanguageDirection==="rtl"?"arrowleft":"arrowright";H.keystrokes.set(B,(t,V)=>{H.focusTracker.focusedElement!==H.buttonView.element||!H.isEnabled||(H.isOpen||(H.isOpen=!0),H.panelView.focus(),V())})},openOnButtonClick(H){H.buttonView.on("execute",()=>{H.isOpen=!0})},toggleOnButtonClick(H){H.buttonView.on("execute",()=>{H.isOpen=!H.isOpen})},openAndFocusOnEnterKeyPress(H){H.keystrokes.set("enter",(B,t)=>{H.focusTracker.focusedElement===H.buttonView.element&&(H.isOpen=!0,H.panelView.focus(),t())})},closeOnArrowLeftKey(H){const B=H.locale.uiLanguageDirection==="rtl"?"arrowright":"arrowleft";H.keystrokes.set(B,(t,V)=>{H.isOpen&&(H.isOpen=!1,H.focus(),V())})},closeOnEscKey(H){H.keystrokes.set("esc",(B,t)=>{H.isOpen&&(H.isOpen=!1,H.focus(),t())})},closeOnParentClose(H){H.parentMenuView.on("change:isOpen",(B,t,V)=>{!V&&B.source===H.parentMenuView&&(H.isOpen=!1)})}},MenuBarMenuViewPanelPositioningFunctions={southEast:H=>({top:H.bottom,left:H.left,name:"se"}),southWest:(H,B)=>({top:H.bottom,left:H.left-B.width+H.width,name:"sw"}),northEast:(H,B)=>({top:H.top-B.height,left:H.left,name:"ne"}),northWest:(H,B)=>({top:H.top-B.height,left:H.left-B.width+H.width,name:"nw"}),eastSouth:H=>({top:H.top,left:H.right-NESTED_PANEL_HORIZONTAL_OFFSET,name:"es"}),eastNorth:(H,B)=>({top:H.top-B.height,left:H.right-NESTED_PANEL_HORIZONTAL_OFFSET,name:"en"}),westSouth:(H,B)=>({top:H.top,left:H.left-B.width+NESTED_PANEL_HORIZONTAL_OFFSET,name:"ws"}),westNorth:(H,B)=>({top:H.top-B.height,left:H.left-B.width+NESTED_PANEL_HORIZONTAL_OFFSET,name:"wn"})},DefaultMenuBarItems=[{menuId:"file",label:"File",groups:[{groupId:"export",items:["menuBar:exportPdf","menuBar:exportWord"]},{groupId:"import",items:["menuBar:importWord"]},{groupId:"revisionHistory",items:["menuBar:revisionHistory"]}]},{menuId:"edit",label:"Edit",groups:[{groupId:"undo",items:["menuBar:undo","menuBar:redo"]},{groupId:"selectAll",items:["menuBar:selectAll"]},{groupId:"findAndReplace",items:["menuBar:findAndReplace"]}]},{menuId:"view",label:"View",groups:[{groupId:"sourceEditing",items:["menuBar:sourceEditing"]},{groupId:"showBlocks",items:["menuBar:showBlocks"]},{groupId:"previewMergeFields",items:["menuBar:previewMergeFields"]},{groupId:"restrictedEditing",items:["menuBar:restrictedEditing"]}]},{menuId:"insert",label:"Insert",groups:[{groupId:"insertMainWidgets",items:["menuBar:insertImage","menuBar:ckbox","menuBar:ckfinder","menuBar:insertTable"]},{groupId:"insertInline",items:["menuBar:link","menuBar:comment","menuBar:insertMergeField"]},{groupId:"insertMinorWidgets",items:["menuBar:mediaEmbed","menuBar:insertTemplate","menuBar:specialCharacters","menuBar:blockQuote","menuBar:codeBlock","menuBar:htmlEmbed"]},{groupId:"insertStructureWidgets",items:["menuBar:horizontalLine","menuBar:pageBreak","menuBar:tableOfContents"]},{groupId:"restrictedEditingException",items:["menuBar:restrictedEditingException"]}]},{menuId:"format",label:"Format",groups:[{groupId:"textAndFont",items:[{menuId:"text",label:"Text",groups:[{groupId:"basicStyles",items:["menuBar:bold","menuBar:italic","menuBar:underline","menuBar:strikethrough","menuBar:superscript","menuBar:subscript","menuBar:code"]},{groupId:"textPartLanguage",items:["menuBar:textPartLanguage"]}]},{menuId:"font",label:"Font",groups:[{groupId:"fontProperties",items:["menuBar:fontSize","menuBar:fontFamily"]},{groupId:"fontColors",items:["menuBar:fontColor","menuBar:fontBackgroundColor"]},{groupId:"highlight",items:["menuBar:highlight"]}]},"menuBar:heading"]},{groupId:"list",items:["menuBar:bulletedList","menuBar:numberedList","menuBar:multiLevelList","menuBar:todoList"]},{groupId:"indent",items:["menuBar:alignment","menuBar:indent","menuBar:outdent"]},{groupId:"caseChange",items:["menuBar:caseChange"]},{groupId:"removeFormat",items:["menuBar:removeFormat"]}]},{menuId:"tools",label:"Tools",groups:[{groupId:"aiTools",items:["menuBar:aiAssistant","menuBar:aiCommands"]},{groupId:"tools",items:["menuBar:trackChanges","menuBar:commentsArchive"]}]},{menuId:"help",label:"Help",groups:[{groupId:"help",items:["menuBar:accessibilityHelp"]}]}];function normalizeMenuBarConfig(H){let B;return!("items"in H)||!H.items?B={items:cloneDeep(DefaultMenuBarItems),addItems:[],removeItems:[],isVisible:!0,isUsingDefaultConfig:!0,...H}:B={items:H.items,removeItems:[],addItems:[],isVisible:!0,isUsingDefaultConfig:!1,...H},B}function processMenuBarConfig({normalizedConfig:H,locale:B,componentFactory:t,extraItems:V}){const N=cloneDeep(H);return handleAdditions(H,N,V),handleRemovals(H,N),handleAdditions(H,N,N.addItems),purgeUnavailableComponents(H,N,t),purgeEmptyMenus(H,N),localizeMenuLabels(N,B),N}function handleRemovals(H,B){const t=B.removeItems,V=[];B.items=B.items.filter(({menuId:N})=>t.includes(N)?(V.push(N),!1):!0),walkConfigMenus(B.items,N=>{N.groups=N.groups.filter(({groupId:W})=>t.includes(W)?(V.push(W),!1):!0);for(const W of N.groups)W.items=W.items.filter(K=>{const G=getIdFromGroupItem(K);return t.includes(G)?(V.push(G),!1):!0})});for(const N of t)V.includes(N)||logWarning("menu-bar-item-could-not-be-removed",{menuBarConfig:H,itemName:N})}function handleAdditions(H,B,t){const V=[];if(t.length!=0){for(const N of t){const W=getRelationFromPosition(N.position),K=getRelativeIdFromPosition(N.position);if(isMenuBarMenuAddition(N))if(!K)W==="start"?(B.items.unshift(N.menu),V.push(N)):W==="end"&&(B.items.push(N.menu),V.push(N));else{const G=B.items.findIndex(Z=>Z.menuId===K);G!=-1?W==="before"?(B.items.splice(G,0,N.menu),V.push(N)):W==="after"&&(B.items.splice(G+1,0,N.menu),V.push(N)):addMenuOrItemToGroup(B,N.menu,K,W)&&V.push(N)}else isMenuBarMenuGroupAddition(N)?walkConfigMenus(B.items,G=>{if(G.menuId===K)W==="start"?(G.groups.unshift(N.group),V.push(N)):W==="end"&&(G.groups.push(N.group),V.push(N));else{const Z=G.groups.findIndex(Y=>Y.groupId===K);Z!==-1&&(W==="before"?(G.groups.splice(Z,0,N.group),V.push(N)):W==="after"&&(G.groups.splice(Z+1,0,N.group),V.push(N)))}}):addMenuOrItemToGroup(B,N.item,K,W)&&V.push(N)}for(const N of t)V.includes(N)||logWarning("menu-bar-item-could-not-be-added",{menuBarConfig:H,addedItemConfig:N})}}function addMenuOrItemToGroup(H,B,t,V){let N=!1;return walkConfigMenus(H.items,W=>{for(const{groupId:K,items:G}of W.groups){if(N)return;if(K===t)V==="start"?(G.unshift(B),N=!0):V==="end"&&(G.push(B),N=!0);else{const Z=G.findIndex(Y=>getIdFromGroupItem(Y)===t);Z!==-1&&(V==="before"?(G.splice(Z,0,B),N=!0):V==="after"&&(G.splice(Z+1,0,B),N=!0))}}}),N}function purgeUnavailableComponents(H,B,t){walkConfigMenus(B.items,V=>{for(const N of V.groups)N.items=N.items.filter(W=>{const K=typeof W=="string"&&!t.has(W);return K&&!B.isUsingDefaultConfig&&logWarning("menu-bar-item-unavailable",{menuBarConfig:H,parentMenuConfig:cloneDeep(V),componentName:W}),!K})})}function purgeEmptyMenus(H,B){const t=B.isUsingDefaultConfig;let V=!1;if(B.items=B.items.filter(N=>N.groups.length?!0:(warnAboutEmptyMenu(H,N,t),!1)),!B.items.length){warnAboutEmptyMenu(H,H,t);return}walkConfigMenus(B.items,N=>{N.groups=N.groups.filter(W=>W.items.length?!0:(V=!0,!1));for(const W of N.groups)W.items=W.items.filter(K=>isMenuDefinition(K)&&!K.groups.length?(warnAboutEmptyMenu(H,K,t),V=!0,!1):!0)}),V&&purgeEmptyMenus(H,B)}function warnAboutEmptyMenu(H,B,t){t||logWarning("menu-bar-menu-empty",{menuBarConfig:H,emptyMenuConfig:B})}function localizeMenuLabels(H,B){const t=B.t,V={File:t({string:"File",id:"MENU_BAR_MENU_FILE"}),Edit:t({string:"Edit",id:"MENU_BAR_MENU_EDIT"}),View:t({string:"View",id:"MENU_BAR_MENU_VIEW"}),Insert:t({string:"Insert",id:"MENU_BAR_MENU_INSERT"}),Format:t({string:"Format",id:"MENU_BAR_MENU_FORMAT"}),Tools:t({string:"Tools",id:"MENU_BAR_MENU_TOOLS"}),Help:t({string:"Help",id:"MENU_BAR_MENU_HELP"}),Text:t({string:"Text",id:"MENU_BAR_MENU_TEXT"}),Font:t({string:"Font",id:"MENU_BAR_MENU_FONT"})};walkConfigMenus(H.items,N=>{N.label in V&&(N.label=V[N.label])})}function walkConfigMenus(H,B){if(Array.isArray(H))for(const V of H)t(V);function t(V){B(V);for(const N of V.groups)for(const W of N.items)isMenuDefinition(W)&&t(W)}}function isMenuBarMenuAddition(H){return typeof H=="object"&&"menu"in H}function isMenuBarMenuGroupAddition(H){return typeof H=="object"&&"group"in H}function getRelationFromPosition(H){return H.startsWith("start")?"start":H.startsWith("end")?"end":H.startsWith("after")?"after":"before"}function getRelativeIdFromPosition(H){const B=H.match(/^[^:]+:(.+)/);return B?B[1]:null}function getIdFromGroupItem(H){return typeof H=="string"?H:H.menuId}function isMenuDefinition(H){return typeof H=="object"&&"menuId"in H}class EditorUI extends ObservableMixin(){constructor(t){super();ee(this,"editor");ee(this,"componentFactory");ee(this,"focusTracker");ee(this,"tooltipManager");ee(this,"poweredBy");ee(this,"ariaLiveAnnouncer");ee(this,"isReady",!1);ee(this,"_editableElementsMap",new Map);ee(this,"_focusableToolbarDefinitions",[]);ee(this,"_extraMenuBarElements",[]);ee(this,"_lastFocusedForeignElement",null);const V=t.editing.view;this.editor=t,this.componentFactory=new ComponentFactory(t),this.focusTracker=new FocusTracker,this.tooltipManager=new TooltipManager(t),this.poweredBy=new PoweredBy(t),this.ariaLiveAnnouncer=new AriaLiveAnnouncer(t),this.set("viewportOffset",this._readViewportOffsetFromConfig()),this.once("ready",()=>{this._bindBodyCollectionWithFocusTracker(),this.isReady=!0}),this.listenTo(V.document,"layoutChanged",this.update.bind(this)),this.listenTo(V,"scrollToTheSelection",this._handleScrollToTheSelection.bind(this)),this._initFocusTracking()}get element(){return null}update(){this.fire("update")}destroy(){this.stopListening(),this.focusTracker.destroy(),this.tooltipManager.destroy(this.editor),this.poweredBy.destroy();for(const t of this._editableElementsMap.values())t.ckeditorInstance=null,this.editor.keystrokes.stopListening(t);this._editableElementsMap=new Map,this._focusableToolbarDefinitions=[]}setEditableElement(t,V){this._editableElementsMap.set(t,V),V.ckeditorInstance||(V.ckeditorInstance=this.editor),this.focusTracker.add(V);const N=()=>{this.editor.editing.view.getDomRoot(t)||this.editor.keystrokes.listenTo(V)};this.isReady?N():this.once("ready",N)}removeEditableElement(t){const V=this._editableElementsMap.get(t);V&&(this._editableElementsMap.delete(t),this.editor.keystrokes.stopListening(V),this.focusTracker.remove(V),V.ckeditorInstance=null)}getEditableElement(t="main"){return this._editableElementsMap.get(t)}getEditableElementsNames(){return this._editableElementsMap.keys()}addToolbar(t,V={}){t.isRendered?(this.focusTracker.add(t.element),this.editor.keystrokes.listenTo(t.element)):t.once("render",()=>{this.focusTracker.add(t.element),this.editor.keystrokes.listenTo(t.element)}),this._focusableToolbarDefinitions.push({toolbarView:t,options:V})}extendMenuBar(t){this._extraMenuBarElements.push(t)}get _editableElements(){return console.warn("editor-ui-deprecated-editable-elements: The EditorUI#_editableElements property has been deprecated and will be removed in the near future.",{editorUI:this}),this._editableElementsMap}_initMenuBar(t){const V=t.element;this.focusTracker.add(V),this.editor.keystrokes.listenTo(V);const N=normalizeMenuBarConfig(this.editor.config.get("menuBar")||{});t.fillFromConfig(N,this.componentFactory,this._extraMenuBarElements),this.editor.keystrokes.set("Esc",(W,K)=>{V.contains(this.editor.ui.focusTracker.focusedElement)&&(this._lastFocusedForeignElement?(this._lastFocusedForeignElement.focus(),this._lastFocusedForeignElement=null):this.editor.editing.view.focus(),K())}),this.editor.keystrokes.set("Alt+F9",(W,K)=>{V.contains(this.editor.ui.focusTracker.focusedElement)||(this._saveLastFocusedForeignElement(),t.isFocusBorderEnabled=!0,t.focus(),K())})}_readViewportOffsetFromConfig(){const t=this.editor,V=t.config.get("ui.viewportOffset");if(V)return V;const N=t.config.get("toolbar.viewportTopOffset");return N?(console.warn("editor-ui-deprecated-viewport-offset-config: The `toolbar.vieportTopOffset` configuration option is deprecated. It will be removed from future CKEditor versions. Use `ui.viewportOffset.top` instead."),{top:N}):{top:0}}_initFocusTracking(){const t=this.editor;let V;t.keystrokes.set("Alt+F10",(N,W)=>{this._saveLastFocusedForeignElement();const K=this._getCurrentFocusedToolbarDefinition();(!K||!V)&&(V=this._getFocusableCandidateToolbarDefinitions());for(let G=0;G<V.length;G++){const Z=V.shift();if(V.push(Z),Z!==K&&this._focusFocusableCandidateToolbar(Z)){K&&K.options.afterBlur&&K.options.afterBlur();break}}W()}),t.keystrokes.set("Esc",(N,W)=>{const K=this._getCurrentFocusedToolbarDefinition();K&&(this._lastFocusedForeignElement?(this._lastFocusedForeignElement.focus(),this._lastFocusedForeignElement=null):t.editing.view.focus(),K.options.afterBlur&&K.options.afterBlur(),W())})}_saveLastFocusedForeignElement(){const t=this.focusTracker.focusedElement;Array.from(this._editableElementsMap.values()).includes(t)&&!Array.from(this.editor.editing.view.domRoots.values()).includes(t)&&(this._lastFocusedForeignElement=t)}_getFocusableCandidateToolbarDefinitions(){const t=[];for(const V of this._focusableToolbarDefinitions){const{toolbarView:N,options:W}=V;(isVisible(N.element)||W.beforeFocus)&&t.push(V)}return t.sort((V,N)=>getToolbarDefinitionWeight(V)-getToolbarDefinitionWeight(N)),t}_getCurrentFocusedToolbarDefinition(){for(const t of this._focusableToolbarDefinitions)if(t.toolbarView.element&&t.toolbarView.element.contains(this.focusTracker.focusedElement))return t;return null}_focusFocusableCandidateToolbar(t){const{toolbarView:V,options:{beforeFocus:N}}=t;return N&&N(),isVisible(V.element)?(V.focus(),!0):!1}_handleScrollToTheSelection(t,V){const N={top:0,bottom:0,left:0,right:0,...this.viewportOffset};V.viewportOffset.top+=N.top,V.viewportOffset.bottom+=N.bottom,V.viewportOffset.left+=N.left,V.viewportOffset.right+=N.right}_bindBodyCollectionWithFocusTracker(){const t=this.view.body;for(const V of t)this.focusTracker.add(V.element);t.on("add",(V,N)=>{this.focusTracker.add(N.element)}),t.on("remove",(V,N)=>{this.focusTracker.remove(N.element)})}}function getToolbarDefinitionWeight(H){const{toolbarView:B,options:t}=H;let V=10;return isVisible(B.element)&&V--,t.isContextual&&V--,V}class EditorUIView extends View{constructor(t){super(t);ee(this,"body");ee(this,"menuBarView");this.body=new BodyCollection(t)}render(){super.render(),this.body.attachToDom()}destroy(){return this.body.detachFromDom(),super.destroy()}}class BoxedEditorUIView extends EditorUIView{constructor(t){super(t);ee(this,"top");ee(this,"main");ee(this,"_voiceLabelView");this.top=this.createCollection(),this.main=this.createCollection(),this._voiceLabelView=this._createVoiceLabel(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-editor","ck-rounded-corners"],role:"application",dir:t.uiLanguageDirection,lang:t.uiLanguage,"aria-labelledby":this._voiceLabelView.id},children:[this._voiceLabelView,{tag:"div",attributes:{class:["ck","ck-editor__top","ck-reset_all"],role:"presentation"},children:this.top},{tag:"div",attributes:{class:["ck","ck-editor__main"],role:"presentation"},children:this.main}]})}_createVoiceLabel(){const t=this.t,V=new LabelView;return V.text=t("Rich Text Editor"),V.extendTemplate({attributes:{class:"ck-voice-label"}}),V}}class EditableUIView extends View{constructor(t,V,N){super(t);ee(this,"name",null);ee(this,"_editingView");ee(this,"_editableElement");ee(this,"_hasExternalElement");this.setTemplate({tag:"div",attributes:{class:["ck","ck-content","ck-editor__editable","ck-rounded-corners"],lang:t.contentLanguage,dir:t.contentLanguageDirection}}),this.set("isFocused",!1),this._editableElement=N,this._hasExternalElement=!!this._editableElement,this._editingView=V}render(){super.render(),this._hasExternalElement?this.template.apply(this.element=this._editableElement):this._editableElement=this.element,this.on("change:isFocused",()=>this._updateIsFocusedClasses()),this._updateIsFocusedClasses()}destroy(){this._hasExternalElement&&this.template.revert(this._editableElement),super.destroy()}get hasExternalElement(){return this._hasExternalElement}_updateIsFocusedClasses(){const t=this._editingView;t.isRenderingInProgress?N(this):V(this);function V(W){t.change(K=>{const G=t.document.getRoot(W.name);K.addClass(W.isFocused?"ck-focused":"ck-blurred",G),K.removeClass(W.isFocused?"ck-blurred":"ck-focused",G)})}function N(W){t.once("change:isRenderingInProgress",(K,G,Z)=>{Z?N(W):V(W)})}}}class InlineEditableUIView extends EditableUIView{constructor(t,V,N,W={}){super(t,V,N);ee(this,"_options");this._options=W,this.extendTemplate({attributes:{role:"textbox",class:"ck-editor__editable_inline"}})}render(){super.render();const t=this._editingView;t.change(V=>{const N=t.document.getRoot(this.name);V.setAttribute("aria-label",this.getEditableAriaLabel(),N)})}getEditableAriaLabel(){const t=this.locale.t,V=this._options.label,N=this._editableElement,W=this.name;if(typeof V=="string")return V;if(typeof V=="object")return V[W];if(typeof V=="function")return V(this);if(N){const K=N.getAttribute("aria-label");if(K)return K}return t("Rich Text Editor. Editing area: %0",W)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function filterGroupAndItemNames(H,B){let t=0,V=0;for(const N of B){const W=N,K=W.items,G=H&&!!W.label.match(H);W.labelView.highlightText(G?H:null);for(const Y of K){const X=Y.children.first,Q=X.labelView;if(!H)Y.isVisible=!0,Q.highlightText(null);else{const te=!!X.label.match(H);Q.highlightText(te?H:null),Y.isVisible=G||te}}const Z=K.filter(Y=>Y.isVisible).length;t+=W.items.length,V+=G?W.items.length:Z,W.isVisible=G||!!Z}return{resultsCount:V,totalItemsCount:t}}class Notification extends ContextPlugin{static get pluginName(){return"Notification"}init(){this.on("show:warning",(B,t)=>{window.alert(t.message)},{priority:"lowest"})}showSuccess(B,t={}){this._showNotification({message:B,type:"success",namespace:t.namespace,title:t.title})}showInfo(B,t={}){this._showNotification({message:B,type:"info",namespace:t.namespace,title:t.title})}showWarning(B,t={}){this._showNotification({message:B,type:"warning",namespace:t.namespace,title:t.title})}_showNotification(B){const t=B.namespace?`show:${B.type}:${B.namespace}`:`show:${B.type}`;this.fire(t,{message:B.message,type:B.type,title:B.title||""})}}class Model extends ObservableMixin(){constructor(B,t){super(),t&&assignIn(this,t),B&&this.set(B)}}const toPx$4=toUnit("px");class ContextualBalloon extends Plugin{constructor(t){super(t);ee(this,"positionLimiter");ee(this,"visibleStack");ee(this,"_viewToStack",new Map);ee(this,"_idToStack",new Map);ee(this,"_view",null);ee(this,"_rotatorView",null);ee(this,"_fakePanelsView",null);this.positionLimiter=()=>{const V=this.editor.editing.view,W=V.document.selection.editableElement;return W?V.domConverter.mapViewToDom(W.root):null},this.decorate("getPositionOptions"),this.set("visibleView",null),this.set("_numberOfStacks",0),this.set("_singleViewMode",!1)}static get pluginName(){return"ContextualBalloon"}destroy(){super.destroy(),this._view&&this._view.destroy(),this._rotatorView&&this._rotatorView.destroy(),this._fakePanelsView&&this._fakePanelsView.destroy()}get view(){return this._view||this._createPanelView(),this._view}hasView(t){return Array.from(this._viewToStack.keys()).includes(t)}add(t){if(this._view||this._createPanelView(),this.hasView(t.view))throw new CKEditorError("contextualballoon-add-view-exist",[this,t]);const V=t.stackId||"main";if(!this._idToStack.has(V)){this._idToStack.set(V,new Map([[t.view,t]])),this._viewToStack.set(t.view,this._idToStack.get(V)),this._numberOfStacks=this._idToStack.size,(!this._visibleStack||t.singleViewMode)&&this.showStack(V);return}const N=this._idToStack.get(V);t.singleViewMode&&this.showStack(V),N.set(t.view,t),this._viewToStack.set(t.view,N),N===this._visibleStack&&this._showView(t)}remove(t){if(!this.hasView(t))throw new CKEditorError("contextualballoon-remove-view-not-exist",[this,t]);const V=this._viewToStack.get(t);this._singleViewMode&&this.visibleView===t&&(this._singleViewMode=!1),this.visibleView===t&&(V.size===1?this._idToStack.size>1?this._showNextStack():(this.view.hide(),this.visibleView=null,this._rotatorView.hideView()):this._showView(Array.from(V.values())[V.size-2])),V.size===1?(this._idToStack.delete(this._getStackId(V)),this._numberOfStacks=this._idToStack.size):V.delete(t),this._viewToStack.delete(t)}updatePosition(t){t&&(this._visibleStack.get(this.visibleView).position=t),this.view.pin(this.getPositionOptions()),this._fakePanelsView.updatePosition()}getPositionOptions(){let t=Array.from(this._visibleStack.values()).pop().position;return t&&(t.limiter||(t=Object.assign({},t,{limiter:this.positionLimiter})),t=Object.assign({},t,{viewportOffsetConfig:this.editor.ui.viewportOffset})),t}showStack(t){this.visibleStack=t;const V=this._idToStack.get(t);if(!V)throw new CKEditorError("contextualballoon-showstack-stack-not-exist",this);this._visibleStack!==V&&this._showView(Array.from(V.values()).pop())}_createPanelView(){this._view=new BalloonPanelView(this.editor.locale),this.editor.ui.view.body.add(this._view),this._rotatorView=this._createRotatorView(),this._fakePanelsView=this._createFakePanelsView()}get _visibleStack(){return this._viewToStack.get(this.visibleView)}_getStackId(t){return Array.from(this._idToStack.entries()).find(N=>N[1]===t)[0]}_showNextStack(){const t=Array.from(this._idToStack.values());let V=t.indexOf(this._visibleStack)+1;t[V]||(V=0),this.showStack(this._getStackId(t[V]))}_showPrevStack(){const t=Array.from(this._idToStack.values());let V=t.indexOf(this._visibleStack)-1;t[V]||(V=t.length-1),this.showStack(this._getStackId(t[V]))}_createRotatorView(){const t=new RotatorView(this.editor.locale),V=this.editor.locale.t;return this.view.content.add(t),t.bind("isNavigationVisible").to(this,"_numberOfStacks",this,"_singleViewMode",(N,W)=>!W&&N>1),t.on("change:isNavigationVisible",()=>this.updatePosition(),{priority:"low"}),t.bind("counter").to(this,"visibleView",this,"_numberOfStacks",(N,W)=>{if(W<2)return"";const K=Array.from(this._idToStack.values()).indexOf(this._visibleStack)+1;return V("%0 of %1",[K,W])}),t.buttonNextView.on("execute",()=>{t.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showNextStack()}),t.buttonPrevView.on("execute",()=>{t.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showPrevStack()}),t}_createFakePanelsView(){const t=new FakePanelsView(this.editor.locale,this.view);return t.bind("numberOfPanels").to(this,"_numberOfStacks",this,"_singleViewMode",(V,N)=>!N&&V>=2?Math.min(V-1,2):0),t.listenTo(this.view,"change:top",()=>t.updatePosition()),t.listenTo(this.view,"change:left",()=>t.updatePosition()),this.editor.ui.view.body.add(t),t}_showView({view:t,balloonClassName:V="",withArrow:N=!0,singleViewMode:W=!1}){this.view.class=V,this.view.withArrow=N,this._rotatorView.showView(t),this.visibleView=t,this.view.pin(this.getPositionOptions()),this._fakePanelsView.updatePosition(),W&&(this._singleViewMode=!0)}}class RotatorView extends View{constructor(t){super(t);ee(this,"focusTracker");ee(this,"buttonPrevView");ee(this,"buttonNextView");ee(this,"content");const V=t.t,N=this.bindTemplate;this.set("isNavigationVisible",!0),this.focusTracker=new FocusTracker,this.buttonPrevView=this._createButtonView(V("Previous"),icons.previousArrow),this.buttonNextView=this._createButtonView(V("Next"),icons.nextArrow),this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-rotator"],"z-index":"-1"},children:[{tag:"div",attributes:{class:["ck-balloon-rotator__navigation",N.to("isNavigationVisible",W=>W?"":"ck-hidden")]},children:[this.buttonPrevView,{tag:"span",attributes:{class:["ck-balloon-rotator__counter"]},children:[{text:N.to("counter")}]},this.buttonNextView]},{tag:"div",attributes:{class:"ck-balloon-rotator__content"},children:this.content}]})}render(){super.render(),this.focusTracker.add(this.element)}destroy(){super.destroy(),this.focusTracker.destroy()}showView(t){this.hideView(),this.content.add(t)}hideView(){this.content.clear()}_createButtonView(t,V){const N=new ButtonView(this.locale);return N.set({label:t,icon:V,tooltip:!0}),N}}class FakePanelsView extends View{constructor(t,V){super(t);ee(this,"content");ee(this,"_balloonPanelView");const N=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("height",0),this.set("width",0),this.set("numberOfPanels",0),this.content=this.createCollection(),this._balloonPanelView=V,this.setTemplate({tag:"div",attributes:{class:["ck-fake-panel",N.to("numberOfPanels",W=>W?"":"ck-hidden")],style:{top:N.to("top",toPx$4),left:N.to("left",toPx$4),width:N.to("width",toPx$4),height:N.to("height",toPx$4)}},children:this.content}),this.on("change:numberOfPanels",(W,K,G,Z)=>{G>Z?this._addPanels(G-Z):this._removePanels(Z-G),this.updatePosition()})}_addPanels(t){for(;t--;){const V=new View;V.setTemplate({tag:"div"}),this.content.add(V),this.registerChild(V)}}_removePanels(t){for(;t--;){const V=this.content.last;this.content.remove(V),this.deregisterChild(V),V.destroy()}}updatePosition(){if(this.numberOfPanels){const{top:t,left:V}=this._balloonPanelView,{width:N,height:W}=new Rect(this._balloonPanelView.element);Object.assign(this,{top:t,left:V,width:N,height:W})}}}const toPx$3=toUnit("px");class StickyPanelView extends View{constructor(t){super(t);ee(this,"content");ee(this,"contentPanelElement");ee(this,"_contentPanelPlaceholder");const V=this.bindTemplate;this.set("isActive",!1),this.set("isSticky",!1),this.set("limiterElement",null),this.set("limiterBottomOffset",50),this.set("viewportTopOffset",0),this.set("_marginLeft",null),this.set("_isStickyToTheBottomOfLimiter",!1),this.set("_stickyTopOffset",null),this.set("_stickyBottomOffset",null),this.content=this.createCollection(),this._contentPanelPlaceholder=new Template({tag:"div",attributes:{class:["ck","ck-sticky-panel__placeholder"],style:{display:V.to("isSticky",N=>N?"block":"none"),height:V.to("isSticky",N=>N?toPx$3(this._contentPanelRect.height):null)}}}).render(),this.contentPanelElement=new Template({tag:"div",attributes:{class:["ck","ck-sticky-panel__content",V.if("isSticky","ck-sticky-panel__content_sticky"),V.if("_isStickyToTheBottomOfLimiter","ck-sticky-panel__content_sticky_bottom-limit")],style:{width:V.to("isSticky",N=>N?toPx$3(this._contentPanelPlaceholder.getBoundingClientRect().width):null),top:V.to("_stickyTopOffset",N=>N&&toPx$3(N)),bottom:V.to("_stickyBottomOffset",N=>N&&toPx$3(N)),marginLeft:V.to("_marginLeft")}},children:this.content}).render(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-sticky-panel"]},children:[this._contentPanelPlaceholder,this.contentPanelElement]})}render(){super.render(),this.checkIfShouldBeSticky(),this.listenTo(global$1.document,"scroll",()=>{this.checkIfShouldBeSticky()},{useCapture:!0}),this.listenTo(this,"change:isActive",()=>{this.checkIfShouldBeSticky()})}checkIfShouldBeSticky(){if(!this.limiterElement||!this.isActive){this._unstick();return}const t=new Rect(this.limiterElement);let V=t.getVisible();if(V){const N=new Rect(global$1.window);N.top+=this.viewportTopOffset,N.height-=this.viewportTopOffset,V=V.getIntersection(N)}if(V&&t.top<V.top){const N=V.top;if(N+this._contentPanelRect.height+this.limiterBottomOffset>V.bottom){const W=Math.max(t.bottom-V.bottom,0)+this.limiterBottomOffset;t.bottom-W>t.top+this._contentPanelRect.height?this._stickToBottomOfLimiter(W):this._unstick()}else this._contentPanelRect.height+this.limiterBottomOffset<t.height?this._stickToTopOfAncestors(N):this._unstick()}else this._unstick()}_stickToTopOfAncestors(t){this.isSticky=!0,this._isStickyToTheBottomOfLimiter=!1,this._stickyTopOffset=t,this._stickyBottomOffset=null,this._marginLeft=toPx$3(-global$1.window.scrollX)}_stickToBottomOfLimiter(t){this.isSticky=!0,this._isStickyToTheBottomOfLimiter=!0,this._stickyTopOffset=null,this._stickyBottomOffset=t,this._marginLeft=toPx$3(-global$1.window.scrollX)}_unstick(){this.isSticky=!1,this._isStickyToTheBottomOfLimiter=!1,this._stickyTopOffset=null,this._stickyBottomOffset=null,this._marginLeft=null}get _contentPanelRect(){return new Rect(this.contentPanelElement)}}class SearchTextQueryView extends LabeledFieldView{constructor(t,V){const N=t.t,W=Object.assign({},{showResetButton:!0,showIcon:!0,creator:createLabeledInputText},V);super(t,W.creator);ee(this,"iconView");ee(this,"resetButtonView");ee(this,"_viewConfig");this.label=V.label,this._viewConfig=W,this._viewConfig.showIcon&&(this.iconView=new IconView,this.iconView.content=icons.loupe,this.fieldWrapperChildren.add(this.iconView,0),this.extendTemplate({attributes:{class:"ck-search__query_with-icon"}})),this._viewConfig.showResetButton&&(this.resetButtonView=new ButtonView(t),this.resetButtonView.set({label:N("Clear"),icon:icons.cancel,class:"ck-search__reset",isVisible:!1,tooltip:!0}),this.resetButtonView.on("execute",()=>{this.reset(),this.focus(),this.fire("reset")}),this.resetButtonView.bind("isVisible").to(this.fieldView,"isEmpty",K=>!K),this.fieldWrapperChildren.add(this.resetButtonView),this.extendTemplate({attributes:{class:"ck-search__query_with-reset"}}))}reset(){this.fieldView.reset(),this._viewConfig.showResetButton&&(this.resetButtonView.isVisible=!1)}}class SearchInfoView extends View{constructor(){super();const B=this.bindTemplate;this.set({isVisible:!1,primaryText:"",secondaryText:""}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-search__info",B.if("isVisible","ck-hidden",t=>!t)],tabindex:-1},children:[{tag:"span",children:[{text:[B.to("primaryText")]}]},{tag:"span",children:[{text:[B.to("secondaryText")]}]}]})}focus(){this.element.focus()}}class SearchResultsView extends View{constructor(t){super(t);ee(this,"focusTracker");ee(this,"children");ee(this,"_focusCycler");this.children=this.createCollection(),this.focusTracker=new FocusTracker,this.setTemplate({tag:"div",attributes:{class:["ck","ck-search__results"],tabindex:-1},children:this.children}),this._focusCycler=new FocusCycler({focusables:this.children,focusTracker:this.focusTracker})}render(){super.render();for(const t of this.children)this.focusTracker.add(t.element)}focus(){this._focusCycler.focusFirst()}focusFirst(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}}class SearchTextView extends View{constructor(t,V){super(t);ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"resultsView");ee(this,"filteredView");ee(this,"infoView");ee(this,"queryView");ee(this,"focusCycler");ee(this,"_config");this._config=V,this.filteredView=V.filteredView,this.queryView=this._createSearchTextQueryView(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.resultsView=new SearchResultsView(t),this.children=this.createCollection(),this.focusableChildren=this.createCollection([this.queryView,this.resultsView]),this.set("isEnabled",!0),this.set("resultsCount",0),this.set("totalItemsCount",0),V.infoView&&V.infoView.instance?this.infoView=V.infoView.instance:(this.infoView=new SearchInfoView,this._enableDefaultInfoViewBehavior(),this.on("render",()=>{this.search("")})),this.resultsView.children.addMany([this.infoView,this.filteredView]),this.focusCycler=new FocusCycler({focusables:this.focusableChildren,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.on("search",(N,{resultsCount:W,totalItemsCount:K})=>{this.resultsCount=W,this.totalItemsCount=K}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-search",V.class||null],tabindex:"-1"},children:this.children})}render(){super.render(),this.children.addMany([this.queryView,this.resultsView]);const t=V=>V.stopPropagation();for(const V of this.focusableChildren)this.focusTracker.add(V.element);this.keystrokes.listenTo(this.element),this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}focus(){this.queryView.focus()}reset(){this.queryView.reset(),this.search(""),this.filteredView.element.scrollTo(0,0)}search(t){const V=t?new RegExp(escapeRegExp(t),"ig"):null,N=this.filteredView.filter(V);this.fire("search",{query:t,...N})}_createSearchTextQueryView(){const t=new SearchTextQueryView(this.locale,this._config.queryView);return this.listenTo(t.fieldView,"input",()=>{this.search(t.fieldView.element.value)}),t.on("reset",()=>this.reset()),t.bind("isEnabled").to(this),t}_enableDefaultInfoViewBehavior(){const t=this.locale.t,V=this.infoView;this.on("search",(W,K)=>{if(K.resultsCount)V.set({isVisible:!1});else{const G=this._config.infoView&&this._config.infoView.text;let Z,Y;K.totalItemsCount?G&&G.notFound?(Z=G.notFound.primary,Y=G.notFound.secondary):(Z=t("No results found"),Y=""):G&&G.noSearchableItems?(Z=G.noSearchableItems.primary,Y=G.noSearchableItems.secondary):(Z=t("No searchable items"),Y=""),V.set({primaryText:N(Z,K),secondaryText:N(Y,K),isVisible:!0})}});function N(W,{query:K,resultsCount:G,totalItemsCount:Z}){return typeof W=="function"?W(K,G,Z):W}}}class HighlightedTextView extends View{constructor(){super(),this.set("text",void 0),this.setTemplate({tag:"span",attributes:{class:["ck","ck-highlighted-text"]}}),this.on("render",()=>{this.on("change:text",()=>{this._updateInnerHTML(this.text)}),this._updateInnerHTML(this.text)})}highlightText(B){this._updateInnerHTML(markText(this.text||"",B))}_updateInnerHTML(B){this.element.innerHTML=B||""}}function markText(H,B){if(!B)return escape$1(H);const t=[];let V=0,N=B.exec(H);for(;N!==null;){const K=N.index;K!==V&&t.push({text:H.substring(V,K),isMatch:!1}),t.push({text:N[0],isMatch:!0}),V=B.lastIndex,N=B.exec(H)}return V!==H.length&&t.push({text:H.substring(V),isMatch:!1}),t.map(K=>(K.text=escape$1(K.text),K)).map(K=>K.isMatch?`<mark>${K.text}</mark>`:K.text).join("")}class ButtonLabelWithHighlightView extends HighlightedTextView{constructor(){super(),this.set({style:void 0,text:void 0,id:void 0});const B=this.bindTemplate;this.extendTemplate({attributes:{class:["ck-button__label"],style:B.to("style"),id:B.to("id")}})}}class LabelWithHighlightView extends HighlightedTextView{constructor(){super();ee(this,"id");this.set("for",void 0);const t=this.bindTemplate;this.id=`ck-editor__label_${uid()}`,this.extendTemplate({attributes:{class:["ck","ck-label"],id:this.id,for:t.to("for")}})}}class SpinnerView extends View{constructor(){super(),this.set("isVisible",!1);const B=this.bindTemplate;this.setTemplate({tag:"span",attributes:{class:["ck","ck-spinner-container",B.if("isVisible","ck-hidden",t=>!t)]},children:[{tag:"span",attributes:{class:["ck","ck-spinner"]}}]})}}const toPx$2=toUnit("px");class BalloonToolbar extends Plugin{constructor(t){super(t);ee(this,"toolbarView");ee(this,"focusTracker");ee(this,"_balloonConfig");ee(this,"_resizeObserver",null);ee(this,"_balloon");ee(this,"_fireSelectionChangeDebounced");this._balloonConfig=normalizeToolbarConfig(t.config.get("balloonToolbar")),this.toolbarView=this._createToolbarView(),this.focusTracker=new FocusTracker,this._trackFocusableEditableElements(),this.focusTracker.add(this.toolbarView.element),t.ui.addToolbar(this.toolbarView,{beforeFocus:()=>this.show(!0),afterBlur:()=>this.hide(),isContextual:!0}),this._balloon=t.plugins.get(ContextualBalloon),this._fireSelectionChangeDebounced=debounce(()=>this.fire("_selectionChangeDebounced"),200),this.decorate("show")}static get pluginName(){return"BalloonToolbar"}static get requires(){return[ContextualBalloon]}init(){const t=this.editor,V=t.model.document.selection;this.listenTo(this.focusTracker,"change:isFocused",(N,W,K)=>{const G=this._balloon.visibleView===this.toolbarView;!K&&G?this.hide():K&&this.show()}),this.listenTo(V,"change:range",(N,W)=>{(W.directChange||V.isCollapsed)&&this.hide(),this._fireSelectionChangeDebounced()}),this.listenTo(this,"_selectionChangeDebounced",()=>{this.editor.editing.view.document.isFocused&&this.show()}),this._balloonConfig.shouldNotGroupWhenFull||this.listenTo(t,"ready",()=>{const N=t.ui.view.editable.element;this._resizeObserver=new ResizeObserver(N,W=>{this.toolbarView.maxWidth=toPx$2(W.contentRect.width*.9)})}),this.listenTo(this.toolbarView,"groupedItemsUpdate",()=>{this._updatePosition()}),t.ui.once("ready",()=>{this.toolbarView.fillFromConfig(this._balloonConfig,this.editor.ui.componentFactory)})}_createToolbarView(){const t=this.editor.locale.t,V=!this._balloonConfig.shouldNotGroupWhenFull,N=new ToolbarView(this.editor.locale,{shouldGroupWhenFull:V,isFloating:!0});return N.ariaLabel=t("Editor contextual toolbar"),N.render(),N}show(t=!1){const V=this.editor,N=V.model.document.selection,W=V.model.schema;this._balloon.hasView(this.toolbarView)||N.isCollapsed&&!t||selectionContainsOnlyMultipleSelectables(N,W)||Array.from(this.toolbarView.items).every(K=>K.isEnabled!==void 0&&!K.isEnabled)||(this.listenTo(this.editor.ui,"update",()=>{this._updatePosition()}),this._balloon.add({view:this.toolbarView,position:this._getBalloonPositionData(),balloonClassName:"ck-toolbar-container"}))}hide(){this._balloon.hasView(this.toolbarView)&&(this.stopListening(this.editor.ui,"update"),this._balloon.remove(this.toolbarView))}_trackFocusableEditableElements(){const{editor:t,focusTracker:V}=this,{editing:N}=t;N.view.addObserver(class extends Observer{observe(K){V.add(K)}stopObserving(K){V.remove(K)}})}_getBalloonPositionData(){const V=this.editor.editing.view,N=V.document,W=N.selection,K=N.selection.isBackward;return{target:()=>{const G=K?W.getFirstRange():W.getLastRange(),Z=Rect.getDomRangeRects(V.domConverter.viewRangeToDom(G));return K?Z[0]:(Z.length>1&&Z[Z.length-1].width===0&&Z.pop(),Z[Z.length-1])},positions:this._getBalloonPositions(K)}}_updatePosition(){this._balloon.updatePosition(this._getBalloonPositionData())}destroy(){super.destroy(),this.stopListening(),this._fireSelectionChangeDebounced.cancel(),this.toolbarView.destroy(),this.focusTracker.destroy(),this._resizeObserver&&this._resizeObserver.destroy()}_getBalloonPositions(t){const N=env.isSafari&&env.isiOS?BalloonPanelView.generatePositions({heightOffset:Math.max(BalloonPanelView.arrowHeightOffset,Math.round(20/global$1.window.visualViewport.scale))}):BalloonPanelView.defaultPositions;return t?[N.northWestArrowSouth,N.northWestArrowSouthWest,N.northWestArrowSouthEast,N.northWestArrowSouthMiddleEast,N.northWestArrowSouthMiddleWest,N.southWestArrowNorth,N.southWestArrowNorthWest,N.southWestArrowNorthEast,N.southWestArrowNorthMiddleWest,N.southWestArrowNorthMiddleEast]:[N.southEastArrowNorth,N.southEastArrowNorthEast,N.southEastArrowNorthWest,N.southEastArrowNorthMiddleEast,N.southEastArrowNorthMiddleWest,N.northEastArrowSouth,N.northEastArrowSouthEast,N.northEastArrowSouthWest,N.northEastArrowSouthMiddleEast,N.northEastArrowSouthMiddleWest]}}function selectionContainsOnlyMultipleSelectables(H,B){return H.rangeCount===1?!1:[...H.getRanges()].every(t=>{const V=t.getContainedElement();return V&&B.isSelectable(V)})}const toPx$1$1=toUnit("px");class BlockButtonView extends ButtonView{constructor(B){super(B);const t=this.bindTemplate;this.isVisible=!1,this.isToggleable=!0,this.set("top",0),this.set("left",0),this.extendTemplate({attributes:{class:"ck-block-toolbar-button",style:{top:t.to("top",V=>toPx$1$1(V)),left:t.to("left",V=>toPx$1$1(V))}}})}}const toPx$7=toUnit("px");class BlockToolbar extends Plugin{constructor(t){super(t);ee(this,"toolbarView");ee(this,"panelView");ee(this,"buttonView");ee(this,"_resizeObserver",null);ee(this,"_blockToolbarConfig");this._blockToolbarConfig=normalizeToolbarConfig(this.editor.config.get("blockToolbar")),this.toolbarView=this._createToolbarView(),this.panelView=this._createPanelView(),this.buttonView=this._createButtonView(),clickOutsideHandler({emitter:this.panelView,contextElements:[this.panelView.element,this.buttonView.element],activator:()=>this.panelView.isVisible,callback:()=>this._hidePanel()})}static get pluginName(){return"BlockToolbar"}init(){const t=this.editor,V=t.t,N=V("Click to edit block"),W=V("Drag to move"),K=V("Edit block"),G=t.plugins.has("DragDropBlockToolbar"),Z=G?`${N}
${W}`:K;this.buttonView.label=Z,G&&(this.buttonView.element.dataset.ckeTooltipClass="ck-tooltip_multi-line"),this.listenTo(t.model.document.selection,"change:range",(Y,X)=>{X.directChange&&this._hidePanel()}),this.listenTo(t.ui,"update",()=>this._updateButton()),this.listenTo(t,"change:isReadOnly",()=>this._updateButton(),{priority:"low"}),this.listenTo(t.ui.focusTracker,"change:isFocused",()=>this._updateButton()),this.listenTo(this.buttonView,"change:isVisible",(Y,X,Q)=>{Q?this.buttonView.listenTo(window,"resize",()=>this._updateButton()):(this.buttonView.stopListening(window,"resize"),this._hidePanel())}),this._repositionButtonOnScroll(),t.ui.addToolbar(this.toolbarView,{beforeFocus:()=>this._showPanel(),afterBlur:()=>this._hidePanel()}),t.ui.once("ready",()=>{this.toolbarView.fillFromConfig(this._blockToolbarConfig,this.editor.ui.componentFactory);for(const Y of this.toolbarView.items)Y.on("execute",()=>this._hidePanel(!0),{priority:"high"})})}destroy(){super.destroy(),this.panelView.destroy(),this.buttonView.destroy(),this.toolbarView.destroy(),this._resizeObserver&&this._resizeObserver.destroy()}_createToolbarView(){const t=this.editor.locale.t,V=!this._blockToolbarConfig.shouldNotGroupWhenFull,N=new ToolbarView(this.editor.locale,{shouldGroupWhenFull:V,isFloating:!0});return N.ariaLabel=t("Editor block content toolbar"),N}_createPanelView(){const t=this.editor,V=new BalloonPanelView(t.locale);return V.content.add(this.toolbarView),V.class="ck-toolbar-container",t.ui.view.body.add(V),this.toolbarView.keystrokes.set("Esc",(N,W)=>{this._hidePanel(!0),W()}),V}_createButtonView(){const t=this.editor,V=t.t,N=new BlockButtonView(t.locale),W=this._blockToolbarConfig.icon,K=NESTED_TOOLBAR_ICONS[W]||W||NESTED_TOOLBAR_ICONS.dragIndicator;return N.set({label:V("Edit block"),icon:K,withText:!1}),N.bind("isOn").to(this.panelView,"isVisible"),N.bind("tooltip").to(this.panelView,"isVisible",G=>!G),this.listenTo(N,"execute",()=>{this.panelView.isVisible?this._hidePanel(!0):this._showPanel()}),this.listenTo(N,"change:isEnabled",(G,Z,Y)=>{!Y&&this.panelView.isVisible&&this._hidePanel(!1)}),t.ui.view.body.add(N),N}_updateButton(){const t=this.editor,V=t.model,N=t.editing.view;if(!t.ui.focusTracker.isFocused){this._hideButton();return}if(!t.model.canEditAt(t.model.document.selection)){this._hideButton();return}const W=Array.from(V.document.selection.getSelectedBlocks())[0];if(!W||Array.from(this.toolbarView.items).every(G=>!G.isEnabled)){this._hideButton();return}const K=N.domConverter.mapViewToDom(t.editing.mapper.toViewElement(W));this.buttonView.isVisible=!0,this._setupToolbarResize(),this._attachButtonToElement(K),this.panelView.isVisible&&this._showPanel()}_hideButton(){this.buttonView.isVisible=!1}_showPanel(){if(!this.buttonView.isVisible)return;const t=this.panelView.isVisible;this.panelView.show();const V=this._getSelectedEditableElement();this.toolbarView.maxWidth=this._getToolbarMaxWidth(V),this.panelView.pin({target:this.buttonView.element,limiter:V}),t||this.toolbarView.items.get(0).focus()}_getSelectedEditableElement(){const t=this.editor.model.document.selection.getFirstRange().root.rootName;return this.editor.ui.getEditableElement(t)}_hidePanel(t){this.panelView.isVisible=!1,t&&this.editor.editing.view.focus()}_repositionButtonOnScroll(){const{buttonView:t}=this;let V=!1;const N=(W,K)=>{if(V)return;const G=this._getSelectedEditableElement();K.target!==global$1.document&&!getAncestors(G).includes(K.target)||(V=!0,global$1.window.requestAnimationFrame(()=>{this._updateButton(),V=!1}))};t.on("change:isVisible",(W,K,G)=>{G?t.listenTo(global$1.document,"scroll",N,{useCapture:!0,usePassive:!0}):t.stopListening(global$1.document,"scroll",N)})}_attachButtonToElement(t){const V=this.buttonView.element,N=this._getSelectedEditableElement(),W=window.getComputedStyle(t),K=new Rect(N),G=parseInt(W.paddingTop,10),Z=parseInt(W.lineHeight,10)||parseInt(W.fontSize,10)*1.2,Y=new Rect(V),X=new Rect(t);let Q;this.editor.locale.uiLanguageDirection==="ltr"?Q=K.left-Y.width:Q=K.right;const te=X.top+G+(Z-Y.height)/2;Y.moveTo(Q,te);const ie=Y.toAbsoluteRect();this.buttonView.top=ie.top,this.buttonView.left=ie.left,this._clipButtonToViewport(this.buttonView,N)}_clipButtonToViewport(t,V){const N=new Rect(t.element),W=new Rect(V).getVisible(),K=(...Z)=>{t.element.style.clipPath=Z.length?`polygon(${Z.join(",")})`:""},G=Z=>{t.isEnabled=!Z,t.element.style.pointerEvents=Z?"none":""};if(W&&W.bottom<N.bottom){const Z=Math.min(N.height,N.bottom-W.bottom);G(Z>=N.height),K("0 0","100% 0",`100% calc(100% - ${toPx$7(Z)})`,`0 calc(100% - ${toPx$7(Z)}`)}else if(W&&W.top>N.top){const Z=Math.min(N.height,W.top-N.top);G(Z>=N.height),K(`0 ${toPx$7(Z)}`,`100% ${toPx$7(Z)}`,"100% 100%","0 100%")}else G(!1),K()}_setupToolbarResize(){const t=this._getSelectedEditableElement();this._blockToolbarConfig.shouldNotGroupWhenFull||(this._resizeObserver&&this._resizeObserver.element!==t&&(this._resizeObserver.destroy(),this._resizeObserver=null),this._resizeObserver||(this._resizeObserver=new ResizeObserver(t,()=>{this.toolbarView.maxWidth=this._getToolbarMaxWidth(t)})))}_getToolbarMaxWidth(t){const V=new Rect(t),N=new Rect(this.buttonView.element),K=this.editor.locale.uiLanguageDirection==="rtl"?N.left-V.right+N.width:V.left-N.left;return toPx$7(V.width+K)}}class MenuBarMenuButtonView extends ListItemButtonView{constructor(t){super(t);ee(this,"arrowView");const V=this.bindTemplate;this.set({withText:!0,role:"menuitem"}),this.arrowView=this._createArrowView(),this.extendTemplate({attributes:{class:["ck-menu-bar__menu__button"],"aria-haspopup":!0,"aria-expanded":this.bindTemplate.to("isOn",N=>String(N)),"data-cke-tooltip-disabled":V.to("isOn")},on:{mouseenter:V.to("mouseenter")}})}render(){super.render(),this.children.add(this.arrowView)}_createArrowView(){const t=new IconView;return t.content=dropdownArrowIcon,t.extendTemplate({attributes:{class:"ck-menu-bar__menu__button__arrow"}}),t}}class MenuBarMenuPanelView extends View{constructor(t){super(t);ee(this,"children");const V=this.bindTemplate;this.set("isVisible",!1),this.set("position","se"),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-menu-bar__menu__panel",V.to("position",N=>`ck-menu-bar__menu__panel_position_${N}`),V.if("isVisible","ck-hidden",N=>!N)],tabindex:"-1"},children:this.children,on:{selectstart:V.to(N=>{N.target.tagName.toLocaleLowerCase()!=="input"&&N.preventDefault()})}})}focus(t=1){this.children.length&&(t===1?this.children.first.focus():this.children.last.focus())}}const at=class at extends View{constructor(t){super(t);ee(this,"buttonView");ee(this,"panelView");ee(this,"focusTracker");ee(this,"keystrokes");const V=this.bindTemplate;this.buttonView=new MenuBarMenuButtonView(t),this.buttonView.delegate("mouseenter").to(this),this.buttonView.bind("isOn","isEnabled").to(this,"isOpen","isEnabled"),this.panelView=new MenuBarMenuPanelView(t),this.panelView.bind("isVisible").to(this,"isOpen"),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.set("isOpen",!1),this.set("isEnabled",!0),this.set("panelPosition","w"),this.set("class",void 0),this.set("parentMenuView",null),this.setTemplate({tag:"div",attributes:{class:["ck","ck-menu-bar__menu",V.to("class"),V.if("isEnabled","ck-disabled",N=>!N),V.if("parentMenuView","ck-menu-bar__menu_top-level",N=>!N)]},children:[this.buttonView,this.panelView]})}render(){super.render(),this.focusTracker.add(this.buttonView.element),this.focusTracker.add(this.panelView.element),this.keystrokes.listenTo(this.element),MenuBarMenuBehaviors.closeOnEscKey(this),this._repositionPanelOnOpen()}_attachBehaviors(){this.parentMenuView?(MenuBarMenuBehaviors.openOnButtonClick(this),MenuBarMenuBehaviors.openOnArrowRightKey(this),MenuBarMenuBehaviors.closeOnArrowLeftKey(this),MenuBarMenuBehaviors.openAndFocusOnEnterKeyPress(this),MenuBarMenuBehaviors.closeOnParentClose(this)):(this._propagateArrowKeystrokeEvents(),MenuBarMenuBehaviors.openAndFocusPanelOnArrowDownKey(this),MenuBarMenuBehaviors.toggleOnButtonClick(this))}_propagateArrowKeystrokeEvents(){this.keystrokes.set("arrowright",(t,V)=>{this.fire("arrowright"),V()}),this.keystrokes.set("arrowleft",(t,V)=>{this.fire("arrowleft"),V()})}_repositionPanelOnOpen(){this.on("change:isOpen",(t,V,N)=>{if(!N)return;const W=at._getOptimalPosition({element:this.panelView.element,target:this.buttonView.element,fitInViewport:!0,positions:this._panelPositions});this.panelView.position=W?W.name:this._panelPositions[0].name})}focus(){this.buttonView.focus()}get _panelPositions(){const{southEast:t,southWest:V,northEast:N,northWest:W,westSouth:K,eastSouth:G,westNorth:Z,eastNorth:Y}=MenuBarMenuViewPanelPositioningFunctions;return this.locale.uiLanguageDirection==="ltr"?this.parentMenuView?[G,Y,K,Z]:[t,V,N,W]:this.parentMenuView?[K,Z,G,Y]:[V,t,W,N]}};ee(at,"_getOptimalPosition",getOptimalPosition);let MenuBarMenuView=at;class MenuBarMenuListView extends ListView{constructor(B){super(B),this.role="menu",this.items.on("change",this._setItemsCheckSpace.bind(this))}_setItemsCheckSpace(){const B=Array.from(this.items).some(t=>{const V=pickListButtonMenuViewIfPresent(t);return V&&V.isToggleable});this.items.forEach(t=>{const V=pickListButtonMenuViewIfPresent(t);V&&(V.hasCheckSpace=B)})}}function pickListButtonMenuViewIfPresent(H){return H instanceof ListItemView?H.children.map(B=>isNestedMenuLikeView(B)?B.buttonView:B).find(B=>B instanceof ListItemButtonView):null}function isNestedMenuLikeView(H){return typeof H=="object"&&"buttonView"in H&&H.buttonView instanceof ButtonView}class MenuBarMenuListItemFileDialogButtonView extends FileDialogListItemButtonView{constructor(B){super(B),this.set({withText:!0,withKeystroke:!0,tooltip:!1,role:"menuitem"}),this.extendTemplate({attributes:{class:["ck-menu-bar__menu__item__button"]}})}}const EVENT_NAME_DELEGATES=["mouseenter","arrowleft","arrowright","change:isOpen"];class MenuBarView extends View{constructor(t){super(t);ee(this,"children");ee(this,"menus",[]);const V=t.t,N=this.bindTemplate;this.set({isOpen:!1,isFocusBorderEnabled:!1}),this._setupIsOpenUpdater(),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-menu-bar",N.if("isFocusBorderEnabled","ck-menu-bar_focus-border-enabled")],"aria-label":V("Editor menu bar"),role:"menubar"},children:this.children})}fillFromConfig(t,V,N=[]){const W=this.locale,G=processMenuBarConfig({normalizedConfig:t,locale:W,componentFactory:V,extraItems:N}).items.map(Z=>this._createMenu({componentFactory:V,menuDefinition:Z}));this.children.addMany(G)}render(){super.render(),MenuBarBehaviors.toggleMenusAndFocusItemsOnHover(this),MenuBarBehaviors.closeMenusWhenTheBarCloses(this),MenuBarBehaviors.closeMenuWhenAnotherOnTheSameLevelOpens(this),MenuBarBehaviors.focusCycleMenusOnArrows(this),MenuBarBehaviors.closeOnClickOutside(this),MenuBarBehaviors.enableFocusHighlightOnInteraction(this)}focus(){this.children.first&&this.children.first.focus()}close(){for(const t of this.children)t.isOpen=!1}registerMenu(t,V=null){V?(t.delegate(...EVENT_NAME_DELEGATES).to(V),t.parentMenuView=V):t.delegate(...EVENT_NAME_DELEGATES).to(this,N=>"menu:"+N),t._attachBehaviors(),this.menus.push(t)}_createMenu({componentFactory:t,menuDefinition:V,parentMenuView:N}){const W=this.locale,K=new MenuBarMenuView(W);return this.registerMenu(K,N),K.buttonView.set({label:V.label}),K.once("change:isOpen",()=>{const G=new MenuBarMenuListView(W);G.ariaLabel=V.label,K.panelView.children.add(G),G.items.addMany(this._createMenuItems({menuDefinition:V,parentMenuView:K,componentFactory:t}))}),K}_createMenuItems({menuDefinition:t,parentMenuView:V,componentFactory:N}){const W=this.locale,K=[];for(const G of t.groups){for(const Z of G.items){const Y=new MenuBarMenuListItemView(W,V);if(isObject$2(Z))Y.children.add(this._createMenu({componentFactory:N,menuDefinition:Z,parentMenuView:V}));else{const X=this._createMenuItemContentFromFactory({componentName:Z,componentFactory:N,parentMenuView:V});if(!X)continue;Y.children.add(X)}K.push(Y)}G!==t.groups[t.groups.length-1]&&K.push(new ListSeparatorView(W))}return K}_createMenuItemContentFromFactory({componentName:t,parentMenuView:V,componentFactory:N}){const W=N.create(t);return W instanceof MenuBarMenuView||W instanceof MenuBarMenuListItemButtonView||W instanceof MenuBarMenuListItemFileDialogButtonView?(this._registerMenuTree(W,V),W.on("execute",()=>{this.close()}),W):(logWarning("menu-bar-component-unsupported",{componentName:t,componentView:W}),null)}_registerMenuTree(t,V){if(!(t instanceof MenuBarMenuView)){t.delegate("mouseenter").to(V);return}this.registerMenu(t,V);const N=t.panelView.children.filter(K=>K instanceof MenuBarMenuListView)[0];if(!N){t.delegate("mouseenter").to(V);return}const W=N.items.filter(K=>K instanceof ListItemView);for(const K of W)this._registerMenuTree(K.children.get(0),t)}_setupIsOpenUpdater(){let t;this.on("menu:change:isOpen",(V,N,W)=>{clearTimeout(t),W?this.isOpen=!0:t=setTimeout(()=>{this.isOpen=Array.from(this.children).some(K=>K.isOpen)},0)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const supportedOptions=["left","right","center","justify"];function isSupported(H){return supportedOptions.includes(H)}function isDefault(H,B){return B.contentLanguageDirection=="rtl"?H==="right":H==="left"}function normalizeAlignmentOptions(H){const B=H.map(V=>{let N;return typeof V=="string"?N={name:V}:N=V,N}).filter(V=>{const N=supportedOptions.includes(V.name);return N||logWarning("alignment-config-name-not-recognized",{option:V}),N}),t=B.filter(V=>!!V.className).length;if(t&&t<B.length)throw new CKEditorError("alignment-config-classnames-are-missing",{configuredOptions:H});return B.forEach((V,N,W)=>{const K=W.slice(N+1);if(K.some(Z=>Z.name==V.name))throw new CKEditorError("alignment-config-name-already-defined",{option:V,configuredOptions:H});if(V.className&&K.some(Y=>Y.className==V.className))throw new CKEditorError("alignment-config-classname-already-defined",{option:V,configuredOptions:H})}),B}const ALIGNMENT="alignment";class AlignmentCommand extends Command{refresh(){const t=this.editor.locale,V=first(this.editor.model.document.selection.getSelectedBlocks());this.isEnabled=!!V&&this._canBeAligned(V),this.isEnabled&&V.hasAttribute("alignment")?this.value=V.getAttribute("alignment"):this.value=t.contentLanguageDirection==="rtl"?"right":"left"}execute(B={}){const t=this.editor,V=t.locale,N=t.model,W=N.document,K=B.value;N.change(G=>{const Z=Array.from(W.selection.getSelectedBlocks()).filter(Q=>this._canBeAligned(Q)),Y=Z[0].getAttribute("alignment");isDefault(K,V)||Y===K||!K?removeAlignmentFromSelection(Z,G):setAlignmentOnSelection(Z,G,K)})}_canBeAligned(B){return this.editor.model.schema.checkAttribute(B,ALIGNMENT)}}function removeAlignmentFromSelection(H,B){for(const t of H)B.removeAttribute(ALIGNMENT,t)}function setAlignmentOnSelection(H,B,t){for(const V of H)B.setAttribute(ALIGNMENT,t,V)}class AlignmentEditing extends Plugin{static get pluginName(){return"AlignmentEditing"}constructor(B){super(B),B.config.define("alignment",{options:supportedOptions.map(t=>({name:t}))})}init(){const B=this.editor,t=B.locale,V=B.model.schema,W=normalizeAlignmentOptions(B.config.get("alignment.options")).filter(Y=>isSupported(Y.name)&&!isDefault(Y.name,t)),K=W.some(Y=>!!Y.className);V.extend("$block",{allowAttributes:"alignment"}),B.model.schema.setAttributeProperties("alignment",{isFormatting:!0}),K?B.conversion.attributeToAttribute(buildClassDefinition(W)):B.conversion.for("downcast").attributeToAttribute(buildDowncastInlineDefinition(W));const G=buildUpcastInlineDefinitions(W);for(const Y of G)B.conversion.for("upcast").attributeToAttribute(Y);const Z=buildUpcastCompatibilityDefinitions(W);for(const Y of Z)B.conversion.for("upcast").attributeToAttribute(Y);B.commands.add("alignment",new AlignmentCommand(B))}}function buildDowncastInlineDefinition(H){const B={};for(const{name:V}of H)B[V]={key:"style",value:{"text-align":V}};return{model:{key:"alignment",values:H.map(V=>V.name)},view:B}}function buildUpcastInlineDefinitions(H){const B=[];for(const{name:t}of H)B.push({view:{key:"style",value:{"text-align":t}},model:{key:"alignment",value:t}});return B}function buildUpcastCompatibilityDefinitions(H){const B=[];for(const{name:t}of H)B.push({view:{key:"align",value:t},model:{key:"alignment",value:t}});return B}function buildClassDefinition(H){const B={};for(const V of H)B[V.name]={key:"class",value:V.className};return{model:{key:"alignment",values:H.map(V=>V.name)},view:B}}const iconsMap=new Map([["left",icons.alignLeft],["right",icons.alignRight],["center",icons.alignCenter],["justify",icons.alignJustify]]);class AlignmentUI extends Plugin{get localizedOptionTitles(){const B=this.editor.t;return{left:B("Align left"),right:B("Align right"),center:B("Align center"),justify:B("Justify")}}static get pluginName(){return"AlignmentUI"}init(){const B=this.editor,t=normalizeAlignmentOptions(B.config.get("alignment.options"));t.map(V=>V.name).filter(isSupported).forEach(V=>this._addButton(V)),this._addToolbarDropdown(t),this._addMenuBarMenu(t)}_addButton(B){this.editor.ui.componentFactory.add(`alignment:${B}`,V=>this._createButton(V,B))}_createButton(B,t,V={}){const N=this.editor,W=N.commands.get("alignment"),K=new ButtonView(B);return K.set({label:this.localizedOptionTitles[t],icon:iconsMap.get(t),tooltip:!0,isToggleable:!0,...V}),K.bind("isEnabled").to(W),K.bind("isOn").to(W,"value",G=>G===t),this.listenTo(K,"execute",()=>{N.execute("alignment",{value:t}),N.editing.view.focus()}),K}_addToolbarDropdown(B){const t=this.editor;t.ui.componentFactory.add("alignment",N=>{const W=createDropdown(N),K=N.uiLanguageDirection==="rtl"?"w":"e",G=N.t;addToolbarToDropdown(W,()=>B.map(X=>this._createButton(N,X.name,{tooltipPosition:K})),{enableActiveItemFocusOnDropdownOpen:!0,isVertical:!0,ariaLabel:G("Text alignment toolbar")}),W.buttonView.set({label:G("Text alignment"),tooltip:!0}),W.extendTemplate({attributes:{class:"ck-alignment-dropdown"}});const Z=N.contentLanguageDirection==="rtl"?iconsMap.get("right"):iconsMap.get("left"),Y=t.commands.get("alignment");return W.buttonView.bind("icon").to(Y,"value",X=>iconsMap.get(X)||Z),W.bind("isEnabled").to(Y,"isEnabled"),this.listenTo(W,"execute",()=>{t.editing.view.focus()}),W})}_addMenuBarMenu(B){const t=this.editor;t.ui.componentFactory.add("menuBar:alignment",V=>{const N=t.commands.get("alignment"),W=V.t,K=new MenuBarMenuView(V),G=new MenuBarMenuListView(V);K.bind("isEnabled").to(N),G.set({ariaLabel:W("Text alignment"),role:"menu"}),K.buttonView.set({label:W("Text alignment")});for(const Z of B){const Y=new MenuBarMenuListItemView(V,K),X=new MenuBarMenuListItemButtonView(V);X.delegate("execute").to(K),X.set({label:this.localizedOptionTitles[Z.name],icon:iconsMap.get(Z.name),role:"menuitemcheckbox",isToggleable:!0}),X.on("execute",()=>{t.execute("alignment",{value:Z.name}),t.editing.view.focus()}),X.bind("isOn").to(N,"value",Q=>Q===Z.name),X.bind("isEnabled").to(N,"isEnabled"),Y.children.add(X),G.items.add(Y)}return K.panelView.children.add(G),K})}}class Alignment extends Plugin{static get requires(){return[AlignmentEditing,AlignmentUI]}static get pluginName(){return"Alignment"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ChangeBuffer{constructor(B,t=20){ee(this,"model");ee(this,"limit");ee(this,"_isLocked");ee(this,"_size");ee(this,"_batch",null);ee(this,"_changeCallback");ee(this,"_selectionChangeCallback");this.model=B,this._size=0,this.limit=t,this._isLocked=!1,this._changeCallback=(V,N)=>{N.isLocal&&N.isUndoable&&N!==this._batch&&this._reset(!0)},this._selectionChangeCallback=()=>{this._reset()},this.model.document.on("change",this._changeCallback),this.model.document.selection.on("change:range",this._selectionChangeCallback),this.model.document.selection.on("change:attribute",this._selectionChangeCallback)}get batch(){return this._batch||(this._batch=this.model.createBatch({isTyping:!0})),this._batch}get size(){return this._size}input(B){this._size+=B,this._size>=this.limit&&this._reset(!0)}get isLocked(){return this._isLocked}lock(){this._isLocked=!0}unlock(){this._isLocked=!1}destroy(){this.model.document.off("change",this._changeCallback),this.model.document.selection.off("change:range",this._selectionChangeCallback),this.model.document.selection.off("change:attribute",this._selectionChangeCallback)}_reset(B=!1){(!this.isLocked||B)&&(this._batch=null,this._size=0)}}class InsertTextCommand extends Command{constructor(t,V){super(t);ee(this,"_buffer");this._buffer=new ChangeBuffer(t.model,V),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}destroy(){super.destroy(),this._buffer.destroy()}execute(t={}){const V=this.editor.model,N=V.document,W=t.text||"",K=W.length;let G=N.selection;if(t.selection?G=t.selection:t.range&&(G=V.createSelection(t.range)),!V.canEditAt(G))return;const Z=t.resultRange;V.enqueueChange(this._buffer.batch,Y=>{this._buffer.lock();const X=Array.from(N.selection.getAttributes());V.deleteContent(G),W&&V.insertContent(Y.createText(W,X),G),Z?Y.setSelection(Z):G.is("documentSelection")||Y.setSelection(G),this._buffer.unlock(),this._buffer.input(K)})}}const TYPING_INPUT_TYPES=["insertText","insertReplacementText"],TYPING_INPUT_TYPES_ANDROID=[...TYPING_INPUT_TYPES,"insertCompositionText"];class InsertTextObserver extends Observer{constructor(t){super(t);ee(this,"focusObserver");this.focusObserver=t.getObserver(FocusObserver);const V=env.isAndroid?TYPING_INPUT_TYPES_ANDROID:TYPING_INPUT_TYPES,N=t.document;N.on("beforeinput",(W,K)=>{if(!this.isEnabled)return;const{data:G,targetRanges:Z,inputType:Y,domEvent:X}=K;if(!V.includes(Y))return;this.focusObserver.flush();const Q=new EventInfo(N,"insertText");N.fire(Q,new DomEventData(t,X,{text:G,selection:t.createSelection(Z)})),Q.stop.called&&W.stop()}),env.isAndroid||N.on("compositionend",(W,{data:K,domEvent:G})=>{this.isEnabled&&K&&N.fire("insertText",new DomEventData(t,G,{text:K}))},{priority:"lowest"})}observe(){}stopObserving(){}}class Input extends Plugin{constructor(){super(...arguments);ee(this,"_compositionQueue")}static get pluginName(){return"Input"}init(){const t=this.editor,V=t.model,N=t.editing.view,W=t.editing.mapper,K=V.document.selection;this._compositionQueue=new CompositionQueue(t),N.addObserver(InsertTextObserver);const G=new InsertTextCommand(t,t.config.get("typing.undoStep")||20);t.commands.add("insertText",G),t.commands.add("input",G),this.listenTo(N.document,"insertText",(Z,Y)=>{N.document.isComposing||Y.preventDefault(),env.isAndroid&&N.document.isComposing&&this._compositionQueue.flush("next beforeinput");const{text:X,selection:Q}=Y;let te;Q?te=Array.from(Q.getRanges()).map(le=>W.toModelRange(le)):te=Array.from(K.getRanges());let ie=X;if(env.isAndroid){const le=Array.from(te[0].getItems()).reduce((ae,de)=>ae+(de.is("$textProxy")?de.data:""),"");if(le&&(le.length<=ie.length?ie.startsWith(le)&&(ie=ie.substring(le.length),te[0].start=te[0].start.getShiftedBy(le.length)):le.startsWith(ie)&&(te[0].start=te[0].start.getShiftedBy(ie.length),ie="")),ie.length==0&&te[0].isCollapsed)return}const ne={text:ie,selection:V.createSelection(te)};env.isAndroid&&N.document.isComposing?this._compositionQueue.push(ne):(t.execute("insertText",ne),N.scrollToTheSelection())}),env.isAndroid?this.listenTo(N.document,"keydown",(Z,Y)=>{K.isCollapsed||Y.keyCode!=229||!N.document.isComposing||deleteSelectionContent(V,G)}):this.listenTo(N.document,"compositionstart",()=>{K.isCollapsed||deleteSelectionContent(V,G)}),env.isAndroid?(this.listenTo(N.document,"mutations",(Z,{mutations:Y})=>{if(N.document.isComposing)for(const{node:X}of Y){const Q=findMappedViewAncestor(X,W),te=W.toModelElement(Q);if(this._compositionQueue.isComposedElement(te)){this._compositionQueue.flush("mutations");return}}}),this.listenTo(N.document,"compositionend",()=>{this._compositionQueue.flush("composition end")}),this.listenTo(N.document,"compositionend",()=>{const Z=[];for(const Y of this._compositionQueue.flushComposedElements()){const X=W.toViewElement(Y);X&&Z.push({type:"children",node:X})}Z.length&&N.document.fire("mutations",{mutations:Z})},{priority:"lowest"})):this.listenTo(N.document,"compositionend",()=>{N.document.fire("mutations",{mutations:[]})},{priority:"lowest"})}destroy(){super.destroy(),this._compositionQueue.destroy()}}class CompositionQueue{constructor(B){ee(this,"editor");ee(this,"flushDebounced",debounce(()=>this.flush("timeout"),50));ee(this,"_queue",[]);ee(this,"_compositionElements",new Set);this.editor=B}destroy(){for(this.flushDebounced.cancel(),this._compositionElements.clear();this._queue.length;)this.shift()}get length(){return this._queue.length}push(B){const t={text:B.text};if(B.selection){t.selectionRanges=[];for(const V of B.selection.getRanges())t.selectionRanges.push(LiveRange.fromRange(V)),this._compositionElements.add(V.start.parent)}this._queue.push(t),this.flushDebounced()}shift(){const B=this._queue.shift(),t={text:B.text};if(B.selectionRanges){const V=B.selectionRanges.map(N=>detachLiveRange(N)).filter(N=>!!N);V.length&&(t.selection=this.editor.model.createSelection(V))}return t}flush(B){const t=this.editor,V=t.model,N=t.editing.view;if(this.flushDebounced.cancel(),!this._queue.length)return;const K=t.commands.get("insertText").buffer;V.enqueueChange(K.batch,()=>{for(K.lock();this._queue.length;){const G=this.shift();t.execute("insertText",G)}K.unlock()}),N.scrollToTheSelection()}isComposedElement(B){return this._compositionElements.has(B)}flushComposedElements(){const B=Array.from(this._compositionElements);return this._compositionElements.clear(),B}}function deleteSelectionContent(H,B){if(!B.isEnabled)return;const t=B.buffer;t.lock(),H.enqueueChange(t.batch,()=>{H.deleteContent(H.document.selection)}),t.unlock()}function detachLiveRange(H){const B=H.toRange();return H.detach(),B.root.rootName=="$graveyard"?null:B}function findMappedViewAncestor(H,B){let t=H.is("$text")?H.parent:H;for(;!B.toModelElement(t);)t=t.parent;return t}class DeleteCommand extends Command{constructor(t,V){super(t);ee(this,"direction");ee(this,"_buffer");this.direction=V,this._buffer=new ChangeBuffer(t.model,t.config.get("typing.undoStep")),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}execute(t={}){const V=this.editor.model,N=V.document;V.enqueueChange(this._buffer.batch,W=>{this._buffer.lock();const K=W.createSelection(t.selection||N.selection);if(!V.canEditAt(K))return;const G=t.sequence||1,Z=K.isCollapsed;if(K.isCollapsed&&V.modifySelection(K,{direction:this.direction,unit:t.unit,treatEmojiAsSingleUnit:!0}),this._shouldEntireContentBeReplacedWithParagraph(G)){this._replaceEntireContentWithParagraph(W);return}if(this._shouldReplaceFirstBlockWithParagraph(K,G)){this.editor.execute("paragraph",{selection:K});return}if(K.isCollapsed)return;let Y=0;K.getFirstRange().getMinimalFlatRanges().forEach(X=>{Y+=count(X.getWalker({singleCharacters:!0,ignoreElementEnd:!0,shallow:!0}))}),V.deleteContent(K,{doNotResetEntireContent:Z,direction:this.direction}),this._buffer.input(Y),W.setSelection(K),this._buffer.unlock()})}_shouldEntireContentBeReplacedWithParagraph(t){if(t>1)return!1;const V=this.editor.model,W=V.document.selection,K=V.schema.getLimitElement(W);if(!(W.isCollapsed&&W.containsEntireContent(K))||!V.schema.checkChild(K,"paragraph"))return!1;const Z=K.getChild(0);return!(Z&&Z.is("element","paragraph"))}_replaceEntireContentWithParagraph(t){const V=this.editor.model,W=V.document.selection,K=V.schema.getLimitElement(W),G=t.createElement("paragraph");t.remove(t.createRangeIn(K)),t.insert(G,K),t.setSelection(G,0)}_shouldReplaceFirstBlockWithParagraph(t,V){const N=this.editor.model;if(V>1||this.direction!="backward"||!t.isCollapsed)return!1;const W=t.getFirstPosition(),K=N.schema.getLimitElement(W),G=K.getChild(0);return!(W.parent!=G||!t.containsEntireContent(G)||!N.schema.checkChild(K,"paragraph")||G.name=="paragraph")}}const DELETE_CHARACTER="character",DELETE_WORD="word",DELETE_CODE_POINT="codePoint",DELETE_SELECTION="selection",DELETE_BACKWARD="backward",DELETE_FORWARD="forward",DELETE_EVENT_TYPES={deleteContent:{unit:DELETE_SELECTION,direction:DELETE_BACKWARD},deleteContentBackward:{unit:DELETE_CODE_POINT,direction:DELETE_BACKWARD},deleteWordBackward:{unit:DELETE_WORD,direction:DELETE_BACKWARD},deleteHardLineBackward:{unit:DELETE_SELECTION,direction:DELETE_BACKWARD},deleteSoftLineBackward:{unit:DELETE_SELECTION,direction:DELETE_BACKWARD},deleteContentForward:{unit:DELETE_CHARACTER,direction:DELETE_FORWARD},deleteWordForward:{unit:DELETE_WORD,direction:DELETE_FORWARD},deleteHardLineForward:{unit:DELETE_SELECTION,direction:DELETE_FORWARD},deleteSoftLineForward:{unit:DELETE_SELECTION,direction:DELETE_FORWARD}};class DeleteObserver extends Observer{constructor(B){super(B);const t=B.document;let V=0;t.on("keydown",()=>{V++}),t.on("keyup",()=>{V=0}),t.on("beforeinput",(N,W)=>{if(!this.isEnabled)return;const{targetRanges:K,domEvent:G,inputType:Z}=W,Y=DELETE_EVENT_TYPES[Z];if(!Y)return;const X={direction:Y.direction,unit:Y.unit,sequence:V};X.unit==DELETE_SELECTION&&(X.selectionToRemove=B.createSelection(K[0])),Z==="deleteContentBackward"&&(env.isAndroid&&(X.sequence=1),shouldUseTargetRanges(K)&&(X.unit=DELETE_SELECTION,X.selectionToRemove=B.createSelection(K)));const Q=new BubblingEventInfo(t,"delete",K[0]);t.fire(Q,new DomEventData(B,G,X)),Q.stop.called&&N.stop()}),env.isBlink&&enableChromeWorkaround(this)}observe(){}stopObserving(){}}function enableChromeWorkaround(H){const B=H.view,t=B.document;let V=null,N=!1;t.on("keydown",(G,{keyCode:Z})=>{V=Z,N=!1}),t.on("keyup",(G,{keyCode:Z,domEvent:Y})=>{const X=t.selection,Q=H.isEnabled&&Z==V&&W(Z)&&!X.isCollapsed&&!N;if(V=null,Q){const te=X.getFirstRange(),ie=new BubblingEventInfo(t,"delete",te),ne={unit:DELETE_SELECTION,direction:K(Z),selectionToRemove:X};t.fire(ie,new DomEventData(B,Y,ne))}}),t.on("beforeinput",(G,{inputType:Z})=>{const Y=DELETE_EVENT_TYPES[Z];W(V)&&Y&&Y.direction==K(V)&&(N=!0)},{priority:"high"}),t.on("beforeinput",(G,{inputType:Z,data:Y})=>{V==keyCodes.delete&&Z=="insertText"&&Y==""&&G.stop()},{priority:"high"});function W(G){return G==keyCodes.backspace||G==keyCodes.delete}function K(G){return G==keyCodes.backspace?DELETE_BACKWARD:DELETE_FORWARD}}function shouldUseTargetRanges(H){if(H.length!=1||H[0].isCollapsed)return!1;const B=H[0].getWalker({direction:"backward",singleCharacters:!0,ignoreElementEnd:!0});let t=0;for(const{nextPosition:V,item:N}of B){if(V.parent.is("$text")){const W=V.parent.data,K=V.offset;if(isInsideSurrogatePair(W,K)||isInsideCombinedSymbol(W,K)||isInsideEmojiSequence(W,K))continue;t++}else(N.is("containerElement")||N.is("emptyElement"))&&t++;if(t>1)return!0}return!1}class Delete extends Plugin{constructor(){super(...arguments);ee(this,"_undoOnBackspace")}static get pluginName(){return"Delete"}init(){const t=this.editor,V=t.editing.view,N=V.document,W=t.model.document;V.addObserver(DeleteObserver),this._undoOnBackspace=!1;const K=new DeleteCommand(t,"forward");t.commands.add("deleteForward",K),t.commands.add("forwardDelete",K),t.commands.add("delete",new DeleteCommand(t,"backward")),this.listenTo(N,"delete",(G,Z)=>{N.isComposing||Z.preventDefault();const{direction:Y,sequence:X,selectionToRemove:Q,unit:te}=Z,ie=Y==="forward"?"deleteForward":"delete",ne={sequence:X};if(te=="selection"){const le=Array.from(Q.getRanges()).map(ae=>t.editing.mapper.toModelRange(ae));ne.selection=t.model.createSelection(le)}else ne.unit=te;t.execute(ie,ne),V.scrollToTheSelection()},{priority:"low"}),this.editor.plugins.has("UndoEditing")&&(this.listenTo(N,"delete",(G,Z)=>{this._undoOnBackspace&&Z.direction=="backward"&&Z.sequence==1&&Z.unit=="codePoint"&&(this._undoOnBackspace=!1,t.execute("undo"),Z.preventDefault(),G.stop())},{context:"$capture"}),this.listenTo(W,"change",()=>{this._undoOnBackspace=!1}))}requestUndoOnBackspace(){this.editor.plugins.has("UndoEditing")&&(this._undoOnBackspace=!0)}}class Typing extends Plugin{static get requires(){return[Input,Delete]}static get pluginName(){return"Typing"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getLastTextLine(H,B){let t=H.start;return{text:Array.from(H.getWalker({ignoreElementEnd:!1})).reduce((N,{item:W})=>W.is("$text")||W.is("$textProxy")?N+W.data:(t=B.createPositionAfter(W),""),""),range:B.createRange(t,H.end)}}class TextWatcher extends ObservableMixin(){constructor(t,V){super();ee(this,"model");ee(this,"testCallback");ee(this,"_hasMatch");this.model=t,this.testCallback=V,this._hasMatch=!1,this.set("isEnabled",!0),this.on("change:isEnabled",()=>{this.isEnabled?this._startListening():(this.stopListening(t.document.selection),this.stopListening(t.document))}),this._startListening()}get hasMatch(){return this._hasMatch}_startListening(){const V=this.model.document;this.listenTo(V.selection,"change:range",(N,{directChange:W})=>{if(W){if(!V.selection.isCollapsed){this.hasMatch&&(this.fire("unmatched"),this._hasMatch=!1);return}this._evaluateTextBeforeSelection("selection")}}),this.listenTo(V,"change:data",(N,W)=>{W.isUndo||!W.isLocal||this._evaluateTextBeforeSelection("data",{batch:W})})}_evaluateTextBeforeSelection(t,V={}){const N=this.model,K=N.document.selection,G=N.createRange(N.createPositionAt(K.focus.parent,0),K.focus),{text:Z,range:Y}=getLastTextLine(G,N),X=this.testCallback(Z);if(!X&&this.hasMatch&&this.fire("unmatched"),this._hasMatch=!!X,X){const Q=Object.assign(V,{text:Z,range:Y});typeof X=="object"&&Object.assign(Q,X),this.fire(`matched:${t}`,Q)}}}class TwoStepCaretMovement extends Plugin{constructor(t){super(t);ee(this,"attributes");ee(this,"_overrideUid");ee(this,"_isNextGravityRestorationSkipped",!1);this.attributes=new Set,this._overrideUid=null}static get pluginName(){return"TwoStepCaretMovement"}init(){const t=this.editor,V=t.model,N=t.editing.view,W=t.locale,K=V.document.selection;this.listenTo(N.document,"arrowKey",(G,Z)=>{if(!K.isCollapsed||Z.shiftKey||Z.altKey||Z.ctrlKey)return;const Y=Z.keyCode==keyCodes.arrowright,X=Z.keyCode==keyCodes.arrowleft;if(!Y&&!X)return;const Q=W.contentLanguageDirection;let te=!1;Q==="ltr"&&Y||Q==="rtl"&&X?te=this._handleForwardMovement(Z):te=this._handleBackwardMovement(Z),te===!0&&G.stop()},{context:"$text",priority:"highest"}),this.listenTo(K,"change:range",(G,Z)=>{if(this._isNextGravityRestorationSkipped){this._isNextGravityRestorationSkipped=!1;return}this._isGravityOverridden&&(!Z.directChange&&isBetweenDifferentAttributes(K.getFirstPosition(),this.attributes)||this._restoreGravity())}),this._enableClickingAfterNode(),this._enableInsertContentSelectionAttributesFixer(),this._handleDeleteContentAfterNode()}registerAttribute(t){this.attributes.add(t)}_handleForwardMovement(t){const V=this.attributes,N=this.editor.model,W=N.document.selection,K=W.getFirstPosition();return this._isGravityOverridden||K.isAtStart&&hasAnyAttribute$1(W,V)?!1:isBetweenDifferentAttributes(K,V)?(preventCaretMovement(t),hasAnyAttribute$1(W,V)&&isBetweenDifferentAttributes(K,V,!0)?clearSelectionAttributes(N,V):this._overrideGravity(),!0):!1}_handleBackwardMovement(t){const V=this.attributes,N=this.editor.model,W=N.document.selection,K=W.getFirstPosition();return this._isGravityOverridden?(preventCaretMovement(t),this._restoreGravity(),isBetweenDifferentAttributes(K,V,!0)?clearSelectionAttributes(N,V):setSelectionAttributesFromTheNodeBefore(N,V,K),!0):K.isAtStart?hasAnyAttribute$1(W,V)?(preventCaretMovement(t),setSelectionAttributesFromTheNodeBefore(N,V,K),!0):!1:!hasAnyAttribute$1(W,V)&&isBetweenDifferentAttributes(K,V,!0)?(preventCaretMovement(t),setSelectionAttributesFromTheNodeBefore(N,V,K),!0):isStepAfterAnyAttributeBoundary(K,V)?K.isAtEnd&&!hasAnyAttribute$1(W,V)&&isBetweenDifferentAttributes(K,V)?(preventCaretMovement(t),setSelectionAttributesFromTheNodeBefore(N,V,K),!0):(this._isNextGravityRestorationSkipped=!0,this._overrideGravity(),!1):!1}_enableClickingAfterNode(){const t=this.editor,V=t.model,N=V.document.selection,W=t.editing.view.document;t.editing.view.addObserver(MouseObserver);let K=!1;this.listenTo(W,"mousedown",()=>{K=!0}),this.listenTo(W,"selectionChange",()=>{const G=this.attributes;if(!K||(K=!1,!N.isCollapsed)||!hasAnyAttribute$1(N,G))return;const Z=N.getFirstPosition();isBetweenDifferentAttributes(Z,G)&&(Z.isAtStart||isBetweenDifferentAttributes(Z,G,!0)?clearSelectionAttributes(V,G):this._isGravityOverridden||this._overrideGravity())})}_enableInsertContentSelectionAttributesFixer(){const V=this.editor.model,N=V.document.selection,W=this.attributes;this.listenTo(V,"insertContent",()=>{const K=N.getFirstPosition();hasAnyAttribute$1(N,W)&&isBetweenDifferentAttributes(K,W)&&clearSelectionAttributes(V,W)},{priority:"low"})}_handleDeleteContentAfterNode(){const t=this.editor,V=t.model,N=V.document.selection,W=t.editing.view;let K=!1,G=!1;this.listenTo(W.document,"delete",(Z,Y)=>{K=Y.direction==="backward"},{priority:"high"}),this.listenTo(V,"deleteContent",()=>{if(!K)return;const Z=N.getFirstPosition();G=hasAnyAttribute$1(N,this.attributes)&&!isStepAfterAnyAttributeBoundary(Z,this.attributes)},{priority:"high"}),this.listenTo(V,"deleteContent",()=>{K&&(K=!1,!G&&t.model.enqueueChange(()=>{const Z=N.getFirstPosition();hasAnyAttribute$1(N,this.attributes)&&isBetweenDifferentAttributes(Z,this.attributes)&&(Z.isAtStart||isBetweenDifferentAttributes(Z,this.attributes,!0)?clearSelectionAttributes(V,this.attributes):this._isGravityOverridden||this._overrideGravity())}))},{priority:"low"})}get _isGravityOverridden(){return!!this._overrideUid}_overrideGravity(){this._overrideUid=this.editor.model.change(t=>t.overrideSelectionGravity())}_restoreGravity(){this.editor.model.change(t=>{t.restoreSelectionGravity(this._overrideUid),this._overrideUid=null})}}function hasAnyAttribute$1(H,B){for(const t of B)if(H.hasAttribute(t))return!0;return!1}function setSelectionAttributesFromTheNodeBefore(H,B,t){const V=t.nodeBefore;H.change(N=>{if(V){const W=[],K=H.schema.isObject(V)&&H.schema.isInline(V);for(const[G,Z]of V.getAttributes())H.schema.checkAttribute("$text",G)&&(!K||H.schema.getAttributeProperties(G).copyFromObject!==!1)&&W.push([G,Z]);N.setSelectionAttribute(W)}else N.removeSelectionAttribute(B)})}function clearSelectionAttributes(H,B){H.change(t=>{t.removeSelectionAttribute(B)})}function preventCaretMovement(H){H.preventDefault()}function isStepAfterAnyAttributeBoundary(H,B){const t=H.getShiftedBy(-1);return isBetweenDifferentAttributes(t,B)}function isBetweenDifferentAttributes(H,B,t=!1){const{nodeBefore:V,nodeAfter:N}=H;for(const W of B){const K=V?V.getAttribute(W):void 0,G=N?N.getAttribute(W):void 0;if(!(t&&(K===void 0||G===void 0))&&G!==K)return!0}return!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function findAttributeRange(H,B,t,V){return V.createRange(findAttributeRangeBound(H,B,t,!0,V),findAttributeRangeBound(H,B,t,!1,V))}function findAttributeRangeBound(H,B,t,V,N){let W=H.textNode||(V?H.nodeBefore:H.nodeAfter),K=null;for(;W&&W.getAttribute(B)==t;)K=W,W=V?W.previousSibling:W.nextSibling;return K?N.createPositionAt(K,V?"before":"after"):H}function inlineHighlight(H,B,t,V){const N=H.editing.view,W=new Set;N.document.registerPostFixer(K=>{const G=H.model.document.selection;let Z=!1;if(G.hasAttribute(B)){const Y=findAttributeRange(G.getFirstPosition(),B,G.getAttribute(B),H.model),X=H.editing.mapper.toViewRange(Y);for(const Q of X.getItems())Q.is("element",t)&&!Q.hasClass(V)&&(K.addClass(V,Q),W.add(Q),Z=!0)}return Z}),H.conversion.for("editingDowncast").add(K=>{K.on("insert",G,{priority:"highest"}),K.on("remove",G,{priority:"highest"}),K.on("attribute",G,{priority:"highest"}),K.on("selection",G,{priority:"highest"});function G(){N.change(Z=>{for(const Y of W.values())Z.removeClass(V,Y),W.delete(Y)})}})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Autosave extends Plugin{constructor(t){super(t);ee(this,"adapter");ee(this,"_debouncedSave");ee(this,"_lastDocumentVersion");ee(this,"_savePromise");ee(this,"_domEmitter");ee(this,"_config");ee(this,"_pendingActions");ee(this,"_makeImmediateSave");ee(this,"_action",null);const V=t.config.get("autosave")||{},N=V.waitingTime||1e3;this.set("state","synchronized"),this._debouncedSave=debounce(this._save.bind(this),N),this._lastDocumentVersion=t.model.document.version,this._savePromise=null,this._domEmitter=new(DomEmitterMixin()),this._config=V,this._pendingActions=t.plugins.get(PendingActions),this._makeImmediateSave=!1}static get pluginName(){return"Autosave"}static get requires(){return[PendingActions]}init(){const t=this.editor,V=t.model.document;this.listenTo(t,"ready",()=>{this.listenTo(V,"change:data",(N,W)=>{this._saveCallbacks.length&&W.isLocal&&(this.state==="synchronized"&&(this.state="waiting",this._setPendingAction()),this.state==="waiting"&&this._debouncedSave())})}),this.listenTo(t,"destroy",()=>this._flush(),{priority:"highest"});/* istanbul ignore next -- @preserve */this._domEmitter.listenTo(window,"beforeunload",(N,W)=>{this._pendingActions.hasAny&&(W.returnValue=this._pendingActions.first.message)})}destroy(){this._domEmitter.stopListening(),super.destroy()}save(){return this._debouncedSave.cancel(),this._save()}_flush(){this._debouncedSave.flush()}_save(){return this._savePromise?(this._makeImmediateSave=this.editor.model.document.version>this._lastDocumentVersion,this._savePromise):(this._setPendingAction(),this.state="saving",this._lastDocumentVersion=this.editor.model.document.version,this._savePromise=Promise.resolve().then(()=>Promise.all(this._saveCallbacks.map(t=>t(this.editor)))).finally(()=>{this._savePromise=null}).then(()=>{if(this._makeImmediateSave)return this._makeImmediateSave=!1,this._save();this.editor.model.document.version>this._lastDocumentVersion?(this.state="waiting",this._debouncedSave()):(this.state="synchronized",this._pendingActions.remove(this._action),this._action=null)}).catch(t=>{throw this.state="error",this.state="saving",this._debouncedSave(),t}),this._savePromise)}_setPendingAction(){const t=this.editor.t;this._action||(this._action=this._pendingActions.add(t("Saving changes")))}get _saveCallbacks(){const t=[];return this.adapter&&this.adapter.save&&t.push(this.adapter.save),this._config.save&&t.push(this._config.save),t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class AttributeCommand extends Command{constructor(t,V){super(t);ee(this,"attributeKey");this.attributeKey=V}refresh(){const t=this.editor.model,V=t.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=t.schema.checkAttributeInSelection(V.selection,this.attributeKey)}execute(t={}){const V=this.editor.model,W=V.document.selection,K=t.forceValue===void 0?!this.value:t.forceValue;V.change(G=>{if(W.isCollapsed)K?G.setSelectionAttribute(this.attributeKey,!0):G.removeSelectionAttribute(this.attributeKey);else{const Z=V.schema.getValidRanges(W.getRanges(),this.attributeKey);for(const Y of Z)K?G.setAttribute(this.attributeKey,K,Y):G.removeAttribute(this.attributeKey,Y)}})}_getValueFromFirstAllowedNode(){const t=this.editor.model,V=t.schema,N=t.document.selection;if(N.isCollapsed)return N.hasAttribute(this.attributeKey);for(const W of N.getRanges())for(const K of W.getItems())if(V.checkAttribute(K,this.attributeKey))return K.hasAttribute(this.attributeKey);return!1}}const BOLD$1="bold";class BoldEditing extends Plugin{static get pluginName(){return"BoldEditing"}init(){const B=this.editor,t=this.editor.t;B.model.schema.extend("$text",{allowAttributes:BOLD$1}),B.model.schema.setAttributeProperties(BOLD$1,{isFormatting:!0,copyOnEnter:!0}),B.conversion.attributeToElement({model:BOLD$1,view:"strong",upcastAlso:["b",V=>{const N=V.getStyle("font-weight");return N&&(N=="bold"||Number(N)>=600)?{name:!0,styles:["font-weight"]}:null}]}),B.commands.add(BOLD$1,new AttributeCommand(B,BOLD$1)),B.keystrokes.set("CTRL+B",BOLD$1),B.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Bold text"),keystroke:"CTRL+B"}]})}}function getButtonCreator({editor:H,commandName:B,plugin:t,icon:V,label:N,keystroke:W}){return K=>{const G=H.commands.get(B),Z=new K(H.locale);return Z.set({label:N,icon:V,keystroke:W,isToggleable:!0}),Z.bind("isEnabled").to(G,"isEnabled"),Z.bind("isOn").to(G,"value"),Z instanceof MenuBarMenuListItemButtonView?Z.set({role:"menuitemcheckbox"}):Z.set({tooltip:!0}),t.listenTo(Z,"execute",()=>{H.execute(B),H.editing.view.focus()}),Z}}const BOLD="bold";class BoldUI extends Plugin{static get pluginName(){return"BoldUI"}init(){const B=this.editor,t=B.locale.t,V=getButtonCreator({editor:B,commandName:BOLD,plugin:this,icon:icons.bold,label:t("Bold"),keystroke:"CTRL+B"});B.ui.componentFactory.add(BOLD,()=>V(ButtonView)),B.ui.componentFactory.add("menuBar:"+BOLD,()=>V(MenuBarMenuListItemButtonView))}}class Bold extends Plugin{static get requires(){return[BoldEditing,BoldUI]}static get pluginName(){return"Bold"}}const ITALIC$1="italic";class ItalicEditing extends Plugin{static get pluginName(){return"ItalicEditing"}init(){const B=this.editor,t=this.editor.t;B.model.schema.extend("$text",{allowAttributes:ITALIC$1}),B.model.schema.setAttributeProperties(ITALIC$1,{isFormatting:!0,copyOnEnter:!0}),B.conversion.attributeToElement({model:ITALIC$1,view:"i",upcastAlso:["em",{styles:{"font-style":"italic"}}]}),B.commands.add(ITALIC$1,new AttributeCommand(B,ITALIC$1)),B.keystrokes.set("CTRL+I",ITALIC$1),B.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Italic text"),keystroke:"CTRL+I"}]})}}var italicIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.586 14.633.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z"/></svg>';const ITALIC="italic";class ItalicUI extends Plugin{static get pluginName(){return"ItalicUI"}init(){const B=this.editor,t=B.locale.t,V=getButtonCreator({editor:B,commandName:ITALIC,plugin:this,icon:italicIcon,keystroke:"CTRL+I",label:t("Italic")});B.ui.componentFactory.add(ITALIC,()=>V(ButtonView)),B.ui.componentFactory.add("menuBar:"+ITALIC,()=>V(MenuBarMenuListItemButtonView))}}class Italic extends Plugin{static get requires(){return[ItalicEditing,ItalicUI]}static get pluginName(){return"Italic"}}const STRIKETHROUGH$1="strikethrough";class StrikethroughEditing extends Plugin{static get pluginName(){return"StrikethroughEditing"}init(){const B=this.editor,t=this.editor.t;B.model.schema.extend("$text",{allowAttributes:STRIKETHROUGH$1}),B.model.schema.setAttributeProperties(STRIKETHROUGH$1,{isFormatting:!0,copyOnEnter:!0}),B.conversion.attributeToElement({model:STRIKETHROUGH$1,view:"s",upcastAlso:["del","strike",{styles:{"text-decoration":"line-through"}}]}),B.commands.add(STRIKETHROUGH$1,new AttributeCommand(B,STRIKETHROUGH$1)),B.keystrokes.set("CTRL+SHIFT+X","strikethrough"),B.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Strikethrough text"),keystroke:"CTRL+SHIFT+X"}]})}}var strikethroughIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 16.4c-.8-.4-1.5-.9-2.2-1.5a.6.6 0 0 1-.2-.5l.3-.6h1c1 1.2 2.1 1.7 3.7 1.7 1 0 1.8-.3 2.3-.6.6-.4.6-1.2.6-1.3.2-1.2-.9-2.1-.9-2.1h2.1c.3.7.4 1.2.4 1.7v.8l-.6 1.2c-.6.8-1.1 1-1.6 1.2a6 6 0 0 1-2.4.6c-1 0-1.8-.3-2.5-.6zM6.8 9 6 8.3c-.4-.5-.5-.8-.5-1.6 0-.7.1-1.3.5-1.8.4-.6 1-1 1.6-1.3a6.3 6.3 0 0 1 4.7 0 4 4 0 0 1 1.7 1l.3.7c0 .1.2.4-.2.7-.4.2-.9.1-1 0a3 3 0 0 0-1.2-1c-.4-.2-1-.3-2-.4-.7 0-1.4.2-2 .6-.8.6-1 .8-1 1.5 0 .8.5 1 1.2 1.5.6.4 1.1.7 1.9 1H6.8z"/><path d="M3 10.5V9h14v1.5z"/></svg>';const STRIKETHROUGH="strikethrough";class StrikethroughUI extends Plugin{static get pluginName(){return"StrikethroughUI"}init(){const B=this.editor,t=B.locale.t,V=getButtonCreator({editor:B,commandName:STRIKETHROUGH,plugin:this,icon:strikethroughIcon,keystroke:"CTRL+SHIFT+X",label:t("Strikethrough")});B.ui.componentFactory.add(STRIKETHROUGH,()=>V(ButtonView)),B.ui.componentFactory.add("menuBar:"+STRIKETHROUGH,()=>V(MenuBarMenuListItemButtonView))}}class Strikethrough extends Plugin{static get requires(){return[StrikethroughEditing,StrikethroughUI]}static get pluginName(){return"Strikethrough"}}const SUBSCRIPT$1="subscript";class SubscriptEditing extends Plugin{static get pluginName(){return"SubscriptEditing"}init(){const B=this.editor;B.model.schema.extend("$text",{allowAttributes:SUBSCRIPT$1}),B.model.schema.setAttributeProperties(SUBSCRIPT$1,{isFormatting:!0,copyOnEnter:!0}),B.conversion.attributeToElement({model:SUBSCRIPT$1,view:"sub",upcastAlso:[{styles:{"vertical-align":"sub"}}]}),B.commands.add(SUBSCRIPT$1,new AttributeCommand(B,SUBSCRIPT$1))}}var subscriptIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m7.03 10.349 3.818-3.819a.8.8 0 1 1 1.132 1.132L8.16 11.48l3.819 3.818a.8.8 0 1 1-1.132 1.132L7.03 12.61l-3.818 3.82a.8.8 0 1 1-1.132-1.132L5.9 11.48 2.08 7.662A.8.8 0 1 1 3.212 6.53l3.818 3.82zm8.147 7.829h2.549c.254 0 .447.05.58.152a.49.49 0 0 1 .201.413.54.54 0 0 1-.159.393c-.105.108-.266.162-.48.162h-3.594c-.245 0-.435-.066-.572-.197a.621.621 0 0 1-.205-.463c0-.114.044-.265.132-.453a1.62 1.62 0 0 1 .288-.444c.433-.436.824-.81 1.172-1.122.348-.312.597-.517.747-.615.267-.183.49-.368.667-.553.177-.185.312-.375.405-.57.093-.194.139-.384.139-.57a1.008 1.008 0 0 0-.554-.917 1.197 1.197 0 0 0-.56-.133c-.426 0-.761.182-1.005.546a2.332 2.332 0 0 0-.164.39 1.609 1.609 0 0 1-.258.488c-.096.114-.237.17-.423.17a.558.558 0 0 1-.405-.156.568.568 0 0 1-.161-.427c0-.218.05-.446.151-.683.101-.238.252-.453.452-.646s.454-.349.762-.467a2.998 2.998 0 0 1 1.081-.178c.498 0 .923.076 1.274.228a1.916 1.916 0 0 1 1.004 1.032 1.984 1.984 0 0 1-.156 1.794c-.2.32-.405.572-.613.754-.208.182-.558.468-1.048.857-.49.39-.826.691-1.008.906a2.703 2.703 0 0 0-.24.309z"/></svg>';const SUBSCRIPT="subscript";class SubscriptUI extends Plugin{static get pluginName(){return"SubscriptUI"}init(){const B=this.editor,t=B.locale.t,V=getButtonCreator({editor:B,commandName:SUBSCRIPT,plugin:this,icon:subscriptIcon,label:t("Subscript")});B.ui.componentFactory.add(SUBSCRIPT,()=>V(ButtonView)),B.ui.componentFactory.add("menuBar:"+SUBSCRIPT,()=>V(MenuBarMenuListItemButtonView))}}class Subscript extends Plugin{static get requires(){return[SubscriptEditing,SubscriptUI]}static get pluginName(){return"Subscript"}}const SUPERSCRIPT$1="superscript";class SuperscriptEditing extends Plugin{static get pluginName(){return"SuperscriptEditing"}init(){const B=this.editor;B.model.schema.extend("$text",{allowAttributes:SUPERSCRIPT$1}),B.model.schema.setAttributeProperties(SUPERSCRIPT$1,{isFormatting:!0,copyOnEnter:!0}),B.conversion.attributeToElement({model:SUPERSCRIPT$1,view:"sup",upcastAlso:[{styles:{"vertical-align":"super"}}]}),B.commands.add(SUPERSCRIPT$1,new AttributeCommand(B,SUPERSCRIPT$1))}}var superscriptIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.677 8.678h2.549c.254 0 .447.05.58.152a.49.49 0 0 1 .201.413.54.54 0 0 1-.159.393c-.105.108-.266.162-.48.162h-3.594c-.245 0-.435-.066-.572-.197a.621.621 0 0 1-.205-.463c0-.114.044-.265.132-.453a1.62 1.62 0 0 1 .288-.444c.433-.436.824-.81 1.172-1.122.348-.312.597-.517.747-.615.267-.183.49-.368.667-.553.177-.185.312-.375.405-.57.093-.194.139-.384.139-.57a1.008 1.008 0 0 0-.554-.917 1.197 1.197 0 0 0-.56-.133c-.426 0-.761.182-1.005.546a2.332 2.332 0 0 0-.164.39 1.609 1.609 0 0 1-.258.488c-.096.114-.237.17-.423.17a.558.558 0 0 1-.405-.156.568.568 0 0 1-.161-.427c0-.218.05-.446.151-.683.101-.238.252-.453.452-.646s.454-.349.762-.467a2.998 2.998 0 0 1 1.081-.178c.498 0 .923.076 1.274.228a1.916 1.916 0 0 1 1.004 1.032 1.984 1.984 0 0 1-.156 1.794c-.2.32-.405.572-.613.754-.208.182-.558.468-1.048.857-.49.39-.826.691-1.008.906a2.703 2.703 0 0 0-.24.309zM7.03 10.349l3.818-3.819a.8.8 0 1 1 1.132 1.132L8.16 11.48l3.819 3.818a.8.8 0 1 1-1.132 1.132L7.03 12.61l-3.818 3.82a.8.8 0 1 1-1.132-1.132L5.9 11.48 2.08 7.662A.8.8 0 1 1 3.212 6.53l3.818 3.82z"/></svg>';const SUPERSCRIPT="superscript";class SuperscriptUI extends Plugin{static get pluginName(){return"SuperscriptUI"}init(){const B=this.editor,t=B.locale.t,V=getButtonCreator({editor:B,commandName:SUPERSCRIPT,plugin:this,icon:superscriptIcon,label:t("Superscript")});B.ui.componentFactory.add(SUPERSCRIPT,()=>V(ButtonView)),B.ui.componentFactory.add("menuBar:"+SUPERSCRIPT,()=>V(MenuBarMenuListItemButtonView))}}class Superscript extends Plugin{static get requires(){return[SuperscriptEditing,SuperscriptUI]}static get pluginName(){return"Superscript"}}const UNDERLINE$1="underline";class UnderlineEditing extends Plugin{static get pluginName(){return"UnderlineEditing"}init(){const B=this.editor,t=this.editor.t;B.model.schema.extend("$text",{allowAttributes:UNDERLINE$1}),B.model.schema.setAttributeProperties(UNDERLINE$1,{isFormatting:!0,copyOnEnter:!0}),B.conversion.attributeToElement({model:UNDERLINE$1,view:"u",upcastAlso:{styles:{"text-decoration":"underline"}}}),B.commands.add(UNDERLINE$1,new AttributeCommand(B,UNDERLINE$1)),B.keystrokes.set("CTRL+U","underline"),B.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Underline text"),keystroke:"CTRL+U"}]})}}var underlineIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 18v-1.5h14V18zm2.2-8V3.6c0-.4.4-.6.8-.6.3 0 .7.2.7.6v6.2c0 2 1.3 2.8 3.2 2.8 1.9 0 3.4-.9 3.4-2.9V3.6c0-.3.4-.5.8-.5.3 0 .7.2.7.5V10c0 2.7-2.2 4-4.9 4-2.6 0-4.7-1.2-4.7-4z"/></svg>';const UNDERLINE="underline";class UnderlineUI extends Plugin{static get pluginName(){return"UnderlineUI"}init(){const B=this.editor,t=B.locale.t,V=getButtonCreator({editor:B,commandName:UNDERLINE,plugin:this,icon:underlineIcon,label:t("Underline"),keystroke:"CTRL+U"});B.ui.componentFactory.add(UNDERLINE,()=>V(ButtonView)),B.ui.componentFactory.add("menuBar:"+UNDERLINE,()=>V(MenuBarMenuListItemButtonView))}}class Underline extends Plugin{static get requires(){return[UnderlineEditing,UnderlineUI]}static get pluginName(){return"Underline"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function*getCopyOnEnterAttributes(H,B){for(const t of B)t&&H.getAttributeProperties(t[0]).copyOnEnter&&(yield t)}class EnterCommand extends Command{execute(){this.editor.model.change(B=>{this.enterBlock(B),this.fire("afterExecute",{writer:B})})}enterBlock(B){const t=this.editor.model,V=t.document.selection,N=t.schema,W=V.isCollapsed,K=V.getFirstRange(),G=K.start.parent,Z=K.end.parent;if(N.isLimit(G)||N.isLimit(Z))return!W&&G==Z&&t.deleteContent(V),!1;if(W){const Y=getCopyOnEnterAttributes(B.model.schema,V.getAttributes());return splitBlock(B,K.start),B.setSelectionAttribute(Y),!0}else{const Y=!(K.start.isAtStart&&K.end.isAtEnd),X=G==Z;if(t.deleteContent(V,{leaveUnmerged:Y}),Y){if(X)return splitBlock(B,V.focus),!0;B.setSelection(Z,0)}}return!1}}function splitBlock(H,B){H.split(B),H.setSelection(B.parent.nextSibling,0)}const ENTER_EVENT_TYPES={insertParagraph:{isSoft:!1},insertLineBreak:{isSoft:!0}};class EnterObserver extends Observer{constructor(B){super(B);const t=this.document;let V=!1;t.on("keydown",(N,W)=>{V=W.shiftKey}),t.on("beforeinput",(N,W)=>{if(!this.isEnabled)return;let K=W.inputType;env.isSafari&&V&&K=="insertParagraph"&&(K="insertLineBreak");const G=W.domEvent,Z=ENTER_EVENT_TYPES[K];if(!Z)return;const Y=new BubblingEventInfo(t,"enter",W.targetRanges[0]);t.fire(Y,new DomEventData(B,G,{isSoft:Z.isSoft})),Y.stop.called&&N.stop()})}observe(){}stopObserving(){}}class Enter extends Plugin{static get pluginName(){return"Enter"}init(){const B=this.editor,t=B.editing.view,V=t.document,N=this.editor.t;t.addObserver(EnterObserver),B.commands.add("enter",new EnterCommand(B)),this.listenTo(V,"enter",(W,K)=>{V.isComposing||K.preventDefault(),!K.isSoft&&(B.execute("enter"),t.scrollToTheSelection())},{priority:"low"}),B.accessibility.addKeystrokeInfos({keystrokes:[{label:N("Insert a hard break (a new paragraph)"),keystroke:"Enter"}]})}}class ShiftEnterCommand extends Command{execute(){const B=this.editor.model,t=B.document;B.change(V=>{softBreakAction(B,V,t.selection),this.fire("afterExecute",{writer:V})})}refresh(){const B=this.editor.model,t=B.document;this.isEnabled=isEnabled(B.schema,t.selection)}}function isEnabled(H,B){if(B.rangeCount>1)return!1;const t=B.anchor;if(!t||!H.checkChild(t,"softBreak"))return!1;const V=B.getFirstRange(),N=V.start.parent,W=V.end.parent;return!((isInsideLimitElement(N,H)||isInsideLimitElement(W,H))&&N!==W)}function softBreakAction(H,B,t){const V=t.isCollapsed,N=t.getFirstRange(),W=N.start.parent,K=N.end.parent,G=W==K;if(V){const Z=getCopyOnEnterAttributes(H.schema,t.getAttributes());insertBreak(H,B,N.end),B.removeSelectionAttribute(t.getAttributeKeys()),B.setSelectionAttribute(Z)}else{const Z=!(N.start.isAtStart&&N.end.isAtEnd);H.deleteContent(t,{leaveUnmerged:Z}),G?insertBreak(H,B,t.focus):Z&&B.setSelection(K,0)}}function insertBreak(H,B,t){const V=B.createElement("softBreak");H.insertContent(V,t),B.setSelection(V,"after")}function isInsideLimitElement(H,B){return H.is("rootElement")?!1:B.isLimit(H)||isInsideLimitElement(H.parent,B)}class ShiftEnter extends Plugin{static get pluginName(){return"ShiftEnter"}init(){const B=this.editor,t=B.model.schema,V=B.conversion,N=B.editing.view,W=N.document,K=this.editor.t;t.register("softBreak",{allowWhere:"$text",isInline:!0}),V.for("upcast").elementToElement({model:"softBreak",view:"br"}),V.for("downcast").elementToElement({model:"softBreak",view:(G,{writer:Z})=>Z.createEmptyElement("br")}),N.addObserver(EnterObserver),B.commands.add("shiftEnter",new ShiftEnterCommand(B)),this.listenTo(W,"enter",(G,Z)=>{W.isComposing||Z.preventDefault(),Z.isSoft&&(B.execute("shiftEnter"),N.scrollToTheSelection())},{priority:"low"}),B.accessibility.addKeystrokeInfos({keystrokes:[{label:K("Insert a soft break (a <code>&lt;br&gt;</code> element)"),keystroke:"Shift+Enter"}]})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class BlockQuoteCommand extends Command{refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(B={}){const t=this.editor.model,V=t.schema,N=t.document.selection,W=Array.from(N.getSelectedBlocks()),K=B.forceValue===void 0?!this.value:B.forceValue;t.change(G=>{if(!K)this._removeQuote(G,W.filter(findQuote));else{const Z=W.filter(Y=>findQuote(Y)||checkCanBeQuoted(V,Y));this._applyQuote(G,Z)}})}_getValue(){const B=this.editor.model.document.selection,t=first(B.getSelectedBlocks());return!!(t&&findQuote(t))}_checkEnabled(){if(this.value)return!0;const B=this.editor.model.document.selection,t=this.editor.model.schema,V=first(B.getSelectedBlocks());return V?checkCanBeQuoted(t,V):!1}_removeQuote(B,t){getRangesOfBlockGroups(B,t).reverse().forEach(V=>{if(V.start.isAtStart&&V.end.isAtEnd){B.unwrap(V.start.parent);return}if(V.start.isAtStart){const W=B.createPositionBefore(V.start.parent);B.move(V,W);return}V.end.isAtEnd||B.split(V.end);const N=B.createPositionAfter(V.end.parent);B.move(V,N)})}_applyQuote(B,t){const V=[];getRangesOfBlockGroups(B,t).reverse().forEach(N=>{let W=findQuote(N.start);W||(W=B.createElement("blockQuote"),B.wrap(N,W)),V.push(W)}),V.reverse().reduce((N,W)=>N.nextSibling==W?(B.merge(B.createPositionAfter(N)),N):W)}}function findQuote(H){return H.parent.name=="blockQuote"?H.parent:null}function getRangesOfBlockGroups(H,B){let t,V=0;const N=[];for(;V<B.length;){const W=B[V],K=B[V+1];t||(t=H.createPositionBefore(W)),(!K||W.nextSibling!=K)&&(N.push(H.createRange(t,H.createPositionAfter(W))),t=null),V++}return N}function checkCanBeQuoted(H,B){const t=H.checkChild(B.parent,"blockQuote"),V=H.checkChild(["$root","blockQuote"],B);return t&&V}class BlockQuoteEditing extends Plugin{static get pluginName(){return"BlockQuoteEditing"}static get requires(){return[Enter,Delete]}init(){const B=this.editor,t=B.model.schema;B.commands.add("blockQuote",new BlockQuoteCommand(B)),t.register("blockQuote",{inheritAllFrom:"$container"}),B.conversion.elementToElement({model:"blockQuote",view:"blockquote"}),B.model.document.registerPostFixer(K=>{const G=B.model.document.differ.getChanges();for(const Z of G)if(Z.type=="insert"){const Y=Z.position.nodeAfter;if(!Y)continue;if(Y.is("element","blockQuote")&&Y.isEmpty)return K.remove(Y),!0;if(Y.is("element","blockQuote")&&!t.checkChild(Z.position,Y))return K.unwrap(Y),!0;if(Y.is("element")){const X=K.createRangeIn(Y);for(const Q of X.getItems())if(Q.is("element","blockQuote")&&!t.checkChild(K.createPositionBefore(Q),Q))return K.unwrap(Q),!0}}else if(Z.type=="remove"){const Y=Z.position.parent;if(Y.is("element","blockQuote")&&Y.isEmpty)return K.remove(Y),!0}return!1});const V=this.editor.editing.view.document,N=B.model.document.selection,W=B.commands.get("blockQuote");this.listenTo(V,"enter",(K,G)=>{if(!N.isCollapsed||!W.value)return;N.getLastPosition().parent.isEmpty&&(B.execute("blockQuote"),B.editing.view.scrollToTheSelection(),G.preventDefault(),K.stop())},{context:"blockquote"}),this.listenTo(V,"delete",(K,G)=>{if(G.direction!="backward"||!N.isCollapsed||!W.value)return;const Z=N.getLastPosition().parent;Z.isEmpty&&!Z.previousSibling&&(B.execute("blockQuote"),B.editing.view.scrollToTheSelection(),G.preventDefault(),K.stop())},{context:"blockquote"})}}class BlockQuoteUI extends Plugin{static get pluginName(){return"BlockQuoteUI"}init(){const B=this.editor;B.ui.componentFactory.add("blockQuote",()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),B.ui.componentFactory.add("menuBar:blockQuote",()=>{const t=this._createButton(MenuBarMenuListItemButtonView);return t.set({role:"menuitemcheckbox"}),t})}_createButton(B){const t=this.editor,V=t.locale,N=t.commands.get("blockQuote"),W=new B(t.locale),K=V.t;return W.set({label:K("Block quote"),icon:icons.quote,isToggleable:!0}),W.bind("isEnabled").to(N,"isEnabled"),W.bind("isOn").to(N,"value"),this.listenTo(W,"execute",()=>{t.execute("blockQuote"),t.editing.view.focus()}),W}}class BlockQuote extends Plugin{static get requires(){return[BlockQuoteEditing,BlockQuoteUI]}static get pluginName(){return"BlockQuote"}}var q$1=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],x$1=H=>{let B=0;for(let t=0;t<H.length;t++){let V=H[t],N=q$1.indexOf(V);B=B*83+N}return B},f$1=H=>{let B=H/255;return B<=.04045?B/12.92:Math.pow((B+.055)/1.055,2.4)},h$3=H=>{let B=Math.max(0,Math.min(1,H));return B<=.0031308?Math.trunc(B*12.92*255+.5):Math.trunc((1.055*Math.pow(B,.4166666666666667)-.055)*255+.5)},F$2=H=>H<0?-1:1,M=(H,B)=>F$2(H)*Math.pow(Math.abs(H),B),d$4=class extends Error{constructor(B){super(B),this.name="ValidationError",this.message=B}},C$2=H=>{if(!H||H.length<6)throw new d$4("The blurhash string must be at least 6 characters");let B=x$1(H[0]),t=Math.floor(B/9)+1,V=B%9+1;if(H.length!==4+2*V*t)throw new d$4(`blurhash length mismatch: length is ${H.length} but it should be ${4+2*V*t}`)},z=H=>{let B=H>>16,t=H>>8&255,V=H&255;return[f$1(B),f$1(t),f$1(V)]},L=(H,B)=>{let t=Math.floor(H/361),V=Math.floor(H/19)%19,N=H%19;return[M((t-9)/9,2)*B,M((V-9)/9,2)*B,M((N-9)/9,2)*B]},U$1=(H,B,t,V)=>{C$2(H),V=V|1;let N=x$1(H[0]),W=Math.floor(N/9)+1,K=N%9+1,G=(x$1(H[1])+1)/166,Z=new Array(K*W);for(let Q=0;Q<Z.length;Q++)if(Q===0){let te=x$1(H.substring(2,6));Z[Q]=z(te)}else{let te=x$1(H.substring(4+Q*2,6+Q*2));Z[Q]=L(te,G*V)}let Y=B*4,X=new Uint8ClampedArray(Y*t);for(let Q=0;Q<t;Q++)for(let te=0;te<B;te++){let ie=0,ne=0,le=0;for(let we=0;we<W;we++)for(let be=0;be<K;be++){let ge=Math.cos(Math.PI*te*be/B)*Math.cos(Math.PI*Q*we/t),Ce=Z[be+we*K];ie+=Ce[0]*ge,ne+=Ce[1]*ge,le+=Ce[2]*ge}let ae=h$3(ie),de=h$3(ne),ce=h$3(le);X[4*te+0+Q*Y]=ae,X[4*te+1+Q*Y]=de,X[4*te+2+Q*Y]=ce,X[4*te+3+Q*Y]=255}return X},j=U$1;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class CKBoxUI extends Plugin{static get pluginName(){return"CKBoxUI"}afterInit(){const B=this.editor;B.commands.get("ckbox")&&(B.ui.componentFactory.add("ckbox",()=>this._createFileToolbarButton()),B.ui.componentFactory.add("menuBar:ckbox",()=>this._createFileMenuBarButton()),B.plugins.has("ImageInsertUI")&&B.plugins.get("ImageInsertUI").registerIntegration({name:"assetManager",observable:()=>B.commands.get("ckbox"),buttonViewCreator:()=>this._createImageToolbarButton(),formViewCreator:()=>this._createImageDropdownButton(),menuBarButtonViewCreator:t=>this._createImageMenuBarButton(t?"insertOnly":"insertNested")}))}_createButton(B){const t=this.editor,V=t.locale,N=new B(V),W=t.commands.get("ckbox");return N.bind("isOn","isEnabled").to(W,"value","isEnabled"),N.on("execute",()=>{t.execute("ckbox")}),N}_createFileToolbarButton(){const B=this.editor.locale.t,t=this._createButton(ButtonView);return t.icon=icons.browseFiles,t.label=B("Open file manager"),t.tooltip=!0,t}_createImageToolbarButton(){const B=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),V=this._createButton(ButtonView);return V.icon=icons.imageAssetManager,V.bind("label").to(t,"isImageSelected",N=>B(N?"Replace image with file manager":"Insert image with file manager")),V.tooltip=!0,V}_createImageDropdownButton(){const B=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),V=this._createButton(ButtonView);return V.icon=icons.imageAssetManager,V.withText=!0,V.bind("label").to(t,"isImageSelected",N=>B(N?"Replace with file manager":"Insert with file manager")),V.on("execute",()=>{t.dropdownView.isOpen=!1}),V}_createFileMenuBarButton(){const B=this.editor.locale.t,t=this._createButton(MenuBarMenuListItemButtonView);return t.icon=icons.browseFiles,t.withText=!0,t.label=B("File"),t}_createImageMenuBarButton(B){const t=this.editor.locale.t,V=this._createButton(MenuBarMenuListItemButtonView);switch(V.icon=icons.imageAssetManager,V.withText=!0,B){case"insertOnly":V.label=t("Image");break;case"insertNested":V.label=t("With file manager");break}return V}}function getImageUrls(H){const B=[];let t=0;for(const N in H){const W=parseInt(N,10);isNaN(W)||(W>t&&(t=W),B.push(`${H[N]} ${N}w`))}const V=[{srcset:B.join(","),sizes:`(max-width: ${t}px) 100vw, ${t}px`,type:"image/webp"}];return{imageFallbackUrl:H.default,imageSources:V}}function getWorkspaceId(H,B){const[,t]=H.value.split("."),V=JSON.parse(atob(t)),N=V.auth&&V.auth.ckbox&&V.auth.ckbox.workspaces||[V.aud];return B?(V.auth&&V.auth.ckbox&&V.auth.ckbox.role)=="superadmin"||N.includes(B)?B:null:N[0]}const BLUR_RESOLUTION=32;function blurHashToDataUrl(H){if(H)try{const B=`${BLUR_RESOLUTION}px`,t=document.createElement("canvas");t.setAttribute("width",B),t.setAttribute("height",B);const V=t.getContext("2d");/* istanbul ignore next -- @preserve */if(!V)return;const N=V.createImageData(BLUR_RESOLUTION,BLUR_RESOLUTION),W=j(H,BLUR_RESOLUTION,BLUR_RESOLUTION);return N.data.set(W),V.putImageData(N,0,0),t.toDataURL()}catch{return}}function sendHttpRequest({url:H,method:B="GET",data:t,onUploadProgress:V,signal:N,authorization:W}){const K=new XMLHttpRequest;K.open(B,H.toString()),K.setRequestHeader("Authorization",W),K.setRequestHeader("CKBox-Version","CKEditor 5"),K.responseType="json";const G=()=>{K.abort()};return new Promise((Z,Y)=>{N.throwIfAborted(),N.addEventListener("abort",G),K.addEventListener("loadstart",()=>{N.addEventListener("abort",G)}),K.addEventListener("loadend",()=>{N.removeEventListener("abort",G)}),K.addEventListener("error",()=>{Y()}),K.addEventListener("abort",()=>{Y()}),K.addEventListener("load",()=>{const X=K.response;if(!X||X.statusCode>=400)return Y(X&&X.message);Z(X)});/* istanbul ignore else -- @preserve */V&&K.upload.addEventListener("progress",X=>{V(X)}),K.send(t)})}const MIME_TO_EXTENSION={"image/gif":"gif","image/jpeg":"jpg","image/png":"png","image/webp":"webp","image/bmp":"bmp","image/tiff":"tiff"};function convertMimeTypeToExtension(H){return MIME_TO_EXTENSION[H]}async function getContentTypeOfUrl(H,B){try{const t=await fetch(H,{method:"HEAD",cache:"force-cache",...B});return t.ok&&t.headers.get("content-type")||""}catch{return""}}function getFileExtension(H){const B=H.name,t=/\.(?<ext>[^.]+)$/;return B.match(t).groups.ext.toLowerCase()}const ASSET_INSERTION_WAIT_TIMEOUT=1e3;class CKBoxCommand extends Command{constructor(t){super(t);ee(this,"_chosenAssets",new Set);ee(this,"_wrapper",null);this._initListeners()}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(){this.fire("ckbox:open")}_getValue(){return this._wrapper!==null}_checkEnabled(){const t=this.editor.commands.get("insertImage"),V=this.editor.commands.get("link");return!(!t.isEnabled&&!V.isEnabled)}_prepareOptions(){const V=this.editor.config.get("ckbox"),N=V.dialog,W=V.categories,K=V.view,G=V.upload;return{theme:V.theme,language:V.language,tokenUrl:V.tokenUrl,serviceOrigin:V.serviceOrigin,forceDemoLabel:V.forceDemoLabel,choosableFileExtensions:V.choosableFileExtensions,assets:{onChoose:Z=>this.fire("ckbox:choose",Z)},dialog:{onClose:()=>this.fire("ckbox:close"),width:N&&N.width,height:N&&N.height},categories:W&&{icons:W.icons},view:K&&{openLastView:K.openLastView,startupFolderId:K.startupFolderId,startupCategoryId:K.startupCategoryId,hideMaximizeButton:K.hideMaximizeButton},upload:G&&{componentsHideTimeout:G.componentsHideTimeout,dialogMinimizeTimeout:G.dialogMinimizeTimeout}}}_initListeners(){const t=this.editor,V=t.model,N=!t.config.get("ckbox.ignoreDataId");this.on("ckbox",()=>{this.refresh()},{priority:"low"}),this.on("ckbox:open",()=>{!this.isEnabled||this.value||(this._wrapper=createElement(document,"div",{class:"ck ckbox-wrapper"}),document.body.appendChild(this._wrapper),window.CKBox.mount(this._wrapper,this._prepareOptions()))}),this.on("ckbox:close",()=>{this.value&&(this._wrapper.remove(),this._wrapper=null,t.editing.view.focus())}),this.on("ckbox:choose",(W,K)=>{if(!this.isEnabled)return;const G=t.commands.get("insertImage"),Z=t.commands.get("link"),Y=prepareAssets({assets:K,isImageAllowed:G.isEnabled,isLinkAllowed:Z.isEnabled}),X=Y.length;X!==0&&(V.change(Q=>{for(const te of Y){const ie=te===Y[X-1],ne=X===1;this._insertAsset(te,ie,Q,ne),N&&(setTimeout(()=>this._chosenAssets.delete(te),ASSET_INSERTION_WAIT_TIMEOUT),this._chosenAssets.add(te))}}),t.editing.view.focus())}),this.listenTo(t,"destroy",()=>{this.fire("ckbox:close"),this._chosenAssets.clear()})}_insertAsset(t,V,N,W){const Z=this.editor.model.document.selection;N.removeSelectionAttribute("linkHref"),t.type==="image"?this._insertImage(t):this._insertLink(t,N,W),V||N.setSelection(Z.getLastPosition())}_insertImage(t){const V=this.editor,{imageFallbackUrl:N,imageSources:W,imageTextAlternative:K,imageWidth:G,imageHeight:Z,imagePlaceholder:Y}=t.attributes;V.execute("insertImage",{source:{src:N,sources:W,alt:K,width:G,height:Z,...Y?{placeholder:Y}:null}})}_insertLink(t,V,N){const W=this.editor,K=W.model,G=K.document.selection,{linkName:Z,linkHref:Y}=t.attributes;if(G.isCollapsed){const X=toMap(G.getAttributes()),Q=V.createText(Z,X);if(!N){const ie=G.getLastPosition(),ne=ie.parent;ne.name==="paragraph"&&ne.isEmpty||W.execute("insertParagraph",{position:ie});const le=K.insertContent(Q);V.setSelection(le),W.execute("link",Y);return}const te=K.insertContent(Q);V.setSelection(te)}W.execute("link",Y)}}function prepareAssets({assets:H,isImageAllowed:B,isLinkAllowed:t}){return H.map(V=>isImage(V)?{id:V.data.id,type:"image",attributes:prepareImageAssetAttributes(V)}:{id:V.data.id,type:"link",attributes:prepareLinkAssetAttributes(V)}).filter(V=>V.type==="image"?B:t)}function prepareImageAssetAttributes(H){const{imageFallbackUrl:B,imageSources:t}=getImageUrls(H.data.imageUrls),{description:V,width:N,height:W,blurHash:K}=H.data.metadata,G=blurHashToDataUrl(K);return{imageFallbackUrl:B,imageSources:t,imageTextAlternative:V||"",imageWidth:N,imageHeight:W,...G?{imagePlaceholder:G}:null}}function prepareLinkAssetAttributes(H){return{linkName:H.data.name,linkHref:getAssetUrl(H)}}function isImage(H){const B=H.data.metadata;return B?B.width&&B.height:!1}function getAssetUrl(H){const B=new URL(H.data.url);return B.searchParams.set("download","true"),B.toString()}const DEFAULT_CKBOX_THEME_NAME="lark";class CKBoxUtils extends Plugin{constructor(){super(...arguments);ee(this,"_token")}static get pluginName(){return"CKBoxUtils"}static get requires(){return["CloudServices"]}init(){const t=this.editor,V=!!t.config.get("ckbox"),N=!!window.CKBox;if(!V&&!N)return;t.config.define("ckbox",{serviceOrigin:"https://api.ckbox.io",defaultUploadCategories:null,ignoreDataId:!1,language:t.locale.uiLanguage,theme:DEFAULT_CKBOX_THEME_NAME,tokenUrl:t.config.get("cloudServices.tokenUrl")});const W=t.plugins.get("CloudServices"),K=t.config.get("cloudServices.tokenUrl"),G=t.config.get("ckbox.tokenUrl");if(!G)throw new CKEditorError("ckbox-plugin-missing-token-url",this);G==K?this._token=Promise.resolve(W.token):this._token=W.registerTokenUrl(G)}getToken(){return this._token}async getWorkspaceId(){const t=this.editor.t,V=t("Cannot access default workspace."),N=this.editor.config.get("ckbox.defaultUploadWorkspaceId"),W=getWorkspaceId(await this._token,N);if(W==null)throw logError("ckbox-access-default-workspace-error"),V;return W}async getCategoryIdForFile(t,V){const N=this.editor.t,W=N("Cannot determine a category for the uploaded file."),K=this.editor.config.get("ckbox.defaultUploadCategories"),G=this._getAvailableCategories(V),Z=typeof t=="string"?convertMimeTypeToExtension(await getContentTypeOfUrl(t,V)):getFileExtension(t),Y=await G;if(!Y)throw W;if(K){const Q=Object.keys(K).find(te=>K[te].find(ie=>ie.toLowerCase()==Z));if(Q){const te=Y.find(ie=>ie.id===Q||ie.name===Q);if(!te)throw W;return te.id}}const X=Y.find(Q=>Q.extensions.find(te=>te.toLowerCase()==Z));if(!X)throw W;return X.id}async _getAvailableCategories(t){const N=this.editor,W=this._token,{signal:K}=t,G=N.config.get("ckbox.serviceOrigin"),Z=await this.getWorkspaceId();try{const X=[];let Q=0,te;do{const ie=await Y(Q);X.push(...ie.items),te=ie.totalCount-(Q+50),Q+=50}while(te>0);return X}catch{K.throwIfAborted(),logError("ckbox-fetch-category-http-error");return}async function Y(X){const Q=new URL("categories",G);return Q.searchParams.set("limit",String(50)),Q.searchParams.set("offset",String(X)),Q.searchParams.set("workspaceId",Z),sendHttpRequest({url:Q,signal:K,authorization:(await W).value})}}}class CKBoxUploadAdapter extends Plugin{static get requires(){return["ImageUploadEditing","ImageUploadProgress",FileRepository,CKBoxEditing]}static get pluginName(){return"CKBoxUploadAdapter"}async afterInit(){const B=this.editor,t=!!B.config.get("ckbox"),V=!!window.CKBox;if(!t&&!V)return;const N=B.plugins.get(FileRepository),W=B.plugins.get(CKBoxUtils);N.createUploadAdapter=Z=>new Adapter(Z,B,W);const K=!B.config.get("ckbox.ignoreDataId"),G=B.plugins.get("ImageUploadEditing");K&&G.on("uploadComplete",(Z,{imageElement:Y,data:X})=>{B.model.change(Q=>{Q.setAttribute("ckboxImageId",X.ckboxImageId,Y)})})}}class Adapter{constructor(B,t,V){ee(this,"loader");ee(this,"token");ee(this,"editor");ee(this,"controller");ee(this,"serviceOrigin");ee(this,"ckboxUtils");this.loader=B,this.token=V.getToken(),this.ckboxUtils=V,this.editor=t,this.controller=new AbortController,this.serviceOrigin=t.config.get("ckbox.serviceOrigin")}async upload(){const B=this.ckboxUtils,t=this.editor.t,V=await this.loader.file,N=await B.getCategoryIdForFile(V,{signal:this.controller.signal}),W=new URL("assets",this.serviceOrigin),K=new FormData;W.searchParams.set("workspaceId",await B.getWorkspaceId()),K.append("categoryId",N),K.append("file",V);const G={method:"POST",url:W,data:K,onUploadProgress:Z=>{/* istanbul ignore else -- @preserve */Z.lengthComputable&&(this.loader.uploadTotal=Z.total,this.loader.uploaded=Z.loaded)},signal:this.controller.signal,authorization:(await this.token).value};return sendHttpRequest(G).then(async Z=>{const Y=getImageUrls(Z.imageUrls);return{ckboxImageId:Z.id,default:Y.imageFallbackUrl,sources:Y.imageSources}}).catch(()=>{const Z=t("Cannot upload file:")+` ${V.name}.`;return Promise.reject(Z)})}abort(){this.controller.abort()}}const COMMAND_FORCE_DISABLE_ID$1="NoPermission";class CKBoxEditing extends Plugin{static get pluginName(){return"CKBoxEditing"}static get requires(){return["LinkEditing","PictureEditing",CKBoxUploadAdapter,CKBoxUtils]}init(){const B=this.editor;this._shouldBeInitialised()&&(this._checkImagePlugins(),isLibraryLoaded()&&B.commands.add("ckbox",new CKBoxCommand(B)),isUploadPermissionGranted(B).then(t=>{t||this._blockImageCommands()}))}afterInit(){const B=this.editor;this._shouldBeInitialised()&&(B.config.get("ckbox.ignoreDataId")||(this._initSchema(),this._initConversion(),this._initFixers()))}_shouldBeInitialised(){return!!this.editor.config.get("ckbox")||isLibraryLoaded()}_blockImageCommands(){const B=this.editor,t=B.commands.get("uploadImage"),V=B.commands.get("ckboxImageEdit");t&&(t.isAccessAllowed=!1,t.forceDisabled(COMMAND_FORCE_DISABLE_ID$1)),V&&V.forceDisabled(COMMAND_FORCE_DISABLE_ID$1)}_checkImagePlugins(){const B=this.editor;!B.plugins.has("ImageBlockEditing")&&!B.plugins.has("ImageInlineEditing")&&logError("ckbox-plugin-image-feature-missing",B)}_initSchema(){const t=this.editor.model.schema;t.extend("$text",{allowAttributes:"ckboxLinkId"}),t.isRegistered("imageBlock")&&t.extend("imageBlock",{allowAttributes:["ckboxImageId","ckboxLinkId"]}),t.isRegistered("imageInline")&&t.extend("imageInline",{allowAttributes:["ckboxImageId","ckboxLinkId"]}),t.addAttributeCheck(V=>{if(!V.last.getAttribute("linkHref"))return!1},"ckboxLinkId")}_initConversion(){const B=this.editor;B.conversion.for("downcast").add(V=>{V.on("attribute:ckboxLinkId:imageBlock",(N,W,K)=>{const{writer:G,mapper:Z,consumable:Y}=K;if(!Y.consume(W.item,N.name))return;const Q=[...Z.toViewElement(W.item).getChildren()].find(te=>te.name==="a");Q&&(W.item.hasAttribute("ckboxLinkId")?G.setAttribute("data-ckbox-resource-id",W.item.getAttribute("ckboxLinkId"),Q):G.removeAttribute("data-ckbox-resource-id",Q))},{priority:"low"}),V.on("attribute:ckboxLinkId",(N,W,K)=>{const{writer:G,mapper:Z,consumable:Y}=K;if(Y.consume(W.item,N.name)){if(W.attributeOldValue){const X=createLinkElement$1(G,W.attributeOldValue);G.unwrap(Z.toViewRange(W.range),X)}if(W.attributeNewValue){const X=createLinkElement$1(G,W.attributeNewValue);if(W.item.is("selection")){const Q=G.document.selection;G.wrap(Q.getFirstRange(),X)}else G.wrap(Z.toViewRange(W.range),X)}}},{priority:"low"})}),B.conversion.for("upcast").add(V=>{V.on("element:a",(N,W,K)=>{const{writer:G,consumable:Z}=K;if(!W.viewItem.getAttribute("href"))return;const Y={attributes:["data-ckbox-resource-id"]};if(!Z.consume(W.viewItem,Y))return;const X=W.viewItem.getAttribute("data-ckbox-resource-id");if(X)if(W.modelRange)for(let Q of W.modelRange.getItems())Q.is("$textProxy")&&(Q=Q.textNode),shouldUpcastAttributeForNode(Q)&&G.setAttribute("ckboxLinkId",X,Q);else{const Q=W.modelCursor.nodeBefore||W.modelCursor.parent;G.setAttribute("ckboxLinkId",X,Q)}},{priority:"low"})}),B.conversion.for("downcast").attributeToAttribute({model:"ckboxImageId",view:"data-ckbox-resource-id"}),B.conversion.for("upcast").elementToAttribute({model:{key:"ckboxImageId",value:V=>V.getAttribute("data-ckbox-resource-id")},view:{attributes:{"data-ckbox-resource-id":/[\s\S]+/}}});const t=B.commands.get("replaceImageSource");t&&this.listenTo(t,"cleanupImage",(V,[N,W])=>{N.removeAttribute("ckboxImageId",W)})}_initFixers(){const B=this.editor,t=B.model,V=t.document.selection;t.document.registerPostFixer(syncDataIdPostFixer(B)),t.document.registerPostFixer(injectSelectionPostFixer(V))}}function syncDataIdPostFixer(H){return B=>{let t=!1;const V=H.model,N=H.commands.get("ckbox");if(!N)return t;for(const W of V.document.differ.getChanges()){if(W.type!=="insert"&&W.type!=="attribute")continue;const K=W.type==="insert"?new Range(W.position,W.position.getShiftedBy(W.length)):W.range,G=W.type==="attribute"&&W.attributeKey==="linkHref"&&W.attributeNewValue===null;for(const Z of K.getItems()){if(G&&Z.hasAttribute("ckboxLinkId")){B.removeAttribute("ckboxLinkId",Z),t=!0;continue}const Y=findAssetsForItem(Z,N._chosenAssets);for(const X of Y){const Q=X.type==="image"?"ckboxImageId":"ckboxLinkId";X.id!==Z.getAttribute(Q)&&(B.setAttribute(Q,X.id,Z),t=!0)}}}return t}}function injectSelectionPostFixer(H){return B=>!H.hasAttribute("linkHref")&&H.hasAttribute("ckboxLinkId")?(B.removeSelectionAttribute("ckboxLinkId"),!0):!1}function findAssetsForItem(H,B){const t=H.is("element","imageInline")||H.is("element","imageBlock"),V=H.hasAttribute("linkHref");return[...B].filter(N=>{if(N.type==="image"&&t)return N.attributes.imageFallbackUrl===H.getAttribute("src");if(N.type==="link"&&V)return N.attributes.linkHref===H.getAttribute("linkHref")})}function createLinkElement$1(H,B){const t=H.createAttributeElement("a",{"data-ckbox-resource-id":B},{priority:5});return H.setCustomProperty("link",!0,t),t}function shouldUpcastAttributeForNode(H){return!!(H.is("$text")||H.is("element","imageInline")||H.is("element","imageBlock"))}function isLibraryLoaded(){return!!window.CKBox}async function isUploadPermissionGranted(H){const B=H.plugins.get(CKBoxUtils),t=H.config.get("ckbox.serviceOrigin"),V=new URL("permissions",t),{value:N}=await B.getToken(),W=await sendHttpRequest({url:V,authorization:N,signal:new AbortController().signal});return Object.values(W).some(K=>K["asset:create"])}class CKBox extends Plugin{static get pluginName(){return"CKBox"}static get requires(){return[CKBoxEditing,CKBoxUI]}}function createEditabilityChecker(H){const B=createUrlChecker(H);return t=>t.is("element","imageInline")||t.is("element","imageBlock")?t.hasAttribute("ckboxImageId")?!0:t.hasAttribute("src")?B(t.getAttribute("src")):!1:!1}function createUrlChecker(H){if(Array.isArray(H)){const B=H.map(createUrlChecker);return t=>B.some(V=>V(t))}if(H=="origin"){const B=global$1.window.location.origin;return t=>new URL(t,global$1.document.baseURI).origin==B}return typeof H=="function"?H:H instanceof RegExp?B=>!!(B.match(H)||B.replace(/^https?:\/\//,"").match(H)):()=>!1}class CKBoxImageEditCommand extends Command{constructor(t){super(t);ee(this,"_wrapper",null);ee(this,"_processInProgress",new Set);ee(this,"_canEdit");ee(this,"_prepareOptions");ee(this,"_updateUiDelayed",delay(()=>this.editor.ui.update(),0));this.value=!1,this._canEdit=createEditabilityChecker(t.config.get("ckbox.allowExternalImagesEditing")),this._prepareOptions=abortableDebounce((V,N)=>this._prepareOptionsAbortable(V,N)),this._prepareListeners()}refresh(){const t=this.editor;this.value=this._getValue();const V=t.model.document.selection.getSelectedElement();this.isEnabled=!!V&&this._canEdit(V)&&!this._checkIfElementIsBeingProcessed(V)}execute(){if(this._getValue())return;const t=createElement(document,"div",{class:"ck ckbox-wrapper"});this._wrapper=t,this.value=!0,document.body.appendChild(this._wrapper);const N={element:this.editor.model.document.selection.getSelectedElement(),controller:new AbortController};this._prepareOptions(N).then(W=>window.CKBox.mountImageEditor(t,W),W=>{const K=this.editor,G=K.t;K.plugins.get(Notification).showWarning(G("Failed to determine category of edited image."),{namespace:"ckbox"}),console.error(W),this._handleImageEditorClose()})}destroy(){this._handleImageEditorClose(),this._prepareOptions.abort(),this._updateUiDelayed.cancel();for(const t of this._processInProgress.values())t.controller.abort();super.destroy()}_getValue(){return this._wrapper!==null}async _prepareOptionsAbortable(t,V){const N=this.editor,W=N.config.get("ckbox"),K=N.plugins.get(CKBoxUtils),{element:G}=V;let Z;const Y=G.getAttribute("ckboxImageId");if(Y)Z={assetId:Y};else{const X=new URL(G.getAttribute("src"),document.baseURI).href,Q=await K.getCategoryIdForFile(X,{signal:t});Z={imageUrl:X,uploadCategoryId:Q}}return{...Z,imageEditing:{allowOverwrite:!1},tokenUrl:W.tokenUrl,...W.serviceOrigin&&{serviceOrigin:W.serviceOrigin},onClose:()=>this._handleImageEditorClose(),onSave:X=>this._handleImageEditorSave(V,X)}}_prepareListeners(){this.listenTo(this.editor.model.document,"change:data",()=>{this._getProcessingStatesOfDeletedImages().forEach(V=>{V.controller.abort()})})}_getProcessingStatesOfDeletedImages(){const t=[];for(const V of this._processInProgress.values())V.element.root.rootName=="$graveyard"&&t.push(V);return t}_checkIfElementIsBeingProcessed(t){for(const{element:V}of this._processInProgress)if(isEqual(V,t))return!0;return!1}_handleImageEditorClose(){this._wrapper&&(this._wrapper.remove(),this._wrapper=null,this.editor.editing.view.focus(),this._updateUiDelayed(),this.refresh())}_handleImageEditorSave(t,V){const N=this.editor.locale.t,W=this.editor.plugins.get(Notification),K=this.editor.plugins.get(PendingActions),G=K.add(N("Processing the edited image."));this._processInProgress.add(t),this._showImageProcessingIndicator(t.element,V),this.refresh(),this._waitForAssetProcessed(V.data.id,t.controller.signal).then(Z=>{this._replaceImage(t.element,Z)},Z=>{this.editor.editing.reconvertItem(t.element),!t.controller.signal.aborted&&(!Z||Z instanceof CKEditorError?W.showWarning(N("Server failed to process the image."),{namespace:"ckbox"}):console.error(Z))}).finally(()=>{this._processInProgress.delete(t),K.remove(G),this.refresh()})}async _getAssetStatusFromServer(t,V){const N=this.editor.plugins.get(CKBoxUtils),W=new URL("assets/"+t,this.editor.config.get("ckbox.serviceOrigin")),K=await sendHttpRequest({url:W,signal:V,authorization:(await N.getToken()).value}),G=K.metadata.metadataProcessingStatus;if(!G||G=="queued")throw new CKEditorError("ckbox-image-not-processed");return{data:{...K}}}async _waitForAssetProcessed(t,V){const N=await retry(()=>this._getAssetStatusFromServer(t,V),{signal:V,maxAttempts:5});if(N.data.metadata.metadataProcessingStatus!="success")throw new CKEditorError("ckbox-image-processing-failed");return N}_showImageProcessingIndicator(t,V){const N=this.editor;N.editing.view.change(W=>{const K=N.editing.mapper.toViewElement(t),Z=this.editor.plugins.get("ImageUtils").findViewImgElement(K);W.removeStyle("aspect-ratio",Z),W.setAttribute("width",V.data.metadata.width,Z),W.setAttribute("height",V.data.metadata.height,Z),W.setStyle("width",`${V.data.metadata.width}px`,Z),W.setStyle("height",`${V.data.metadata.height}px`,Z),W.addClass("image-processing",K)})}_replaceImage(t,V){const N=this.editor,{imageFallbackUrl:W,imageSources:K,imageWidth:G,imageHeight:Z,imagePlaceholder:Y}=prepareImageAssetAttributes(V),X=Array.from(N.model.document.selection.getRanges());N.model.change(Q=>{Q.setSelection(t,"on"),N.execute("insertImage",{imageType:t.is("element","imageInline")?"imageInline":null,source:{src:W,sources:K,width:G,height:Z,...Y?{placeholder:Y}:null,...t.hasAttribute("alt")?{alt:t.getAttribute("alt")}:null}});const te=t.getChildren();t=N.model.document.selection.getSelectedElement();for(const ie of te)Q.append(Q.cloneElement(ie),t);Q.setAttribute("ckboxImageId",V.data.id,t),Q.setSelection(X)})}}class CKBoxImageEditEditing extends Plugin{static get pluginName(){return"CKBoxImageEditEditing"}static get requires(){return[CKBoxEditing,CKBoxUtils,PendingActions,Notification,"ImageUtils","ImageEditing"]}init(){const{editor:B}=this;B.commands.add("ckboxImageEdit",new CKBoxImageEditCommand(B))}}var ckboxImageEditIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.201 1C.538 1 0 1.47 0 2.1v14.363c0 .64.534 1.037 1.186 1.037H5.06l5.058-5.078L6.617 9.15a.696.696 0 0 0-.957-.033L1.5 13.6V2.5h15v4.354a3.478 3.478 0 0 1 1.5.049V2.1c0-.63-.547-1.1-1.2-1.1H1.202Zm11.713 2.803a2.147 2.147 0 0 0-2.049 1.992 2.14 2.14 0 0 0 1.28 2.096 2.13 2.13 0 0 0 2.642-3.11 2.129 2.129 0 0 0-1.873-.978ZM8.089 17.635v2.388h2.389l7.046-7.046-2.39-2.39-7.045 7.048Zm11.282-6.507a.637.637 0 0 0 .139-.692.603.603 0 0 0-.139-.205l-1.49-1.488a.63.63 0 0 0-.899 0l-1.166 1.163 2.39 2.39 1.165-1.168Z"/></svg>';class CKBoxImageEditUI extends Plugin{static get pluginName(){return"CKBoxImageEditUI"}init(){const B=this.editor;B.ui.componentFactory.add("ckboxImageEdit",t=>{const V=B.commands.get("ckboxImageEdit"),N=B.commands.get("uploadImage"),W=new ButtonView(t),K=t.t;return W.set({icon:ckboxImageEditIcon,tooltip:!0}),W.bind("label").to(N,"isAccessAllowed",G=>K(G?"Edit image":"You have no image editing permissions.")),W.bind("isOn").to(V,"value",V,"isEnabled",(G,Z)=>G&&Z),W.bind("isEnabled").to(V),this.listenTo(W,"execute",()=>{B.execute("ckboxImageEdit"),B.editing.view.focus()}),W})}}class CKBoxImageEdit extends Plugin{static get pluginName(){return"CKBoxImageEdit"}static get requires(){return[CKBoxImageEditEditing,CKBoxImageEditUI]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HighlightStack extends EmitterMixin(){constructor(){super(...arguments);ee(this,"_stack",[])}add(t,V){const N=this._stack,W=N[0];this._insertDescriptor(t);const K=N[0];W!==K&&!compareDescriptors(W,K)&&this.fire("change:top",{oldDescriptor:W,newDescriptor:K,writer:V})}remove(t,V){const N=this._stack,W=N[0];this._removeDescriptor(t);const K=N[0];W!==K&&!compareDescriptors(W,K)&&this.fire("change:top",{oldDescriptor:W,newDescriptor:K,writer:V})}_insertDescriptor(t){const V=this._stack,N=V.findIndex(K=>K.id===t.id);if(compareDescriptors(t,V[N]))return;N>-1&&V.splice(N,1);let W=0;for(;V[W]&&shouldABeBeforeB(V[W],t);)W++;V.splice(W,0,t)}_removeDescriptor(t){const V=this._stack,N=V.findIndex(W=>W.id===t);N>-1&&V.splice(N,1)}}function compareDescriptors(H,B){return H&&B&&H.priority==B.priority&&classesToString(H.classes)==classesToString(B.classes)}function shouldABeBeforeB(H,B){return H.priority>B.priority?!0:H.priority<B.priority?!1:classesToString(H.classes)>classesToString(B.classes)}function classesToString(H){return Array.isArray(H)?H.sort().join(","):H}var dragHandleIcon='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M4 0v1H1v3H0V.5A.5.5 0 0 1 .5 0H4zm8 0h3.5a.5.5 0 0 1 .5.5V4h-1V1h-3V0zM4 16H.5a.5.5 0 0 1-.5-.5V12h1v3h3v1zm8 0v-1h3v-3h1v3.5a.5.5 0 0 1-.5.5H12z"/><path fill-opacity=".256" d="M1 1h14v14H1z"/><g class="ck-icon__selected-indicator"><path d="M7 0h2v1H7V0zM0 7h1v2H0V7zm15 0h1v2h-1V7zm-8 8h2v1H7v-1z"/><path fill-opacity=".254" d="M1 1h14v14H1z"/></g></svg>';const WIDGET_CLASS_NAME="ck-widget",WIDGET_SELECTED_CLASS_NAME="ck-widget_selected";function isWidget(H){return H.is("element")?!!H.getCustomProperty("widget"):!1}function toWidget(H,B,t={}){if(!H.is("containerElement"))throw new CKEditorError("widget-to-widget-wrong-element-type",null,{element:H});return B.setAttribute("contenteditable","false",H),B.addClass(WIDGET_CLASS_NAME,H),B.setCustomProperty("widget",!0,H),H.getFillerOffset=getFillerOffset,B.setCustomProperty("widgetLabel",[],H),t.label&&setLabel(H,t.label),t.hasSelectionHandle&&addSelectionHandle(H,B),setHighlightHandling(H,B),H}function addHighlight(H,B,t){if(B.classes&&t.addClass(toArray$2(B.classes),H),B.attributes)for(const V in B.attributes)t.setAttribute(V,B.attributes[V],H)}function removeHighlight(H,B,t){if(B.classes&&t.removeClass(toArray$2(B.classes),H),B.attributes)for(const V in B.attributes)t.removeAttribute(V,H)}function setHighlightHandling(H,B,t=addHighlight,V=removeHighlight){const N=new HighlightStack;N.on("change:top",(G,Z)=>{Z.oldDescriptor&&V(H,Z.oldDescriptor,Z.writer),Z.newDescriptor&&t(H,Z.newDescriptor,Z.writer)});const W=(G,Z,Y)=>N.add(Z,Y),K=(G,Z,Y)=>N.remove(Z,Y);B.setCustomProperty("addHighlight",W,H),B.setCustomProperty("removeHighlight",K,H)}function setLabel(H,B){H.getCustomProperty("widgetLabel").push(B)}function getLabel(H){return H.getCustomProperty("widgetLabel").reduce((t,V)=>typeof V=="function"?t?t+". "+V():V():t?t+". "+V:V,"")}function toWidgetEditable(H,B,t={}){return B.addClass(["ck-editor__editable","ck-editor__nested-editable"],H),B.setAttribute("role","textbox",H),B.setAttribute("tabindex","-1",H),t.label&&B.setAttribute("aria-label",t.label,H),B.setAttribute("contenteditable",H.isReadOnly?"false":"true",H),H.on("change:isReadOnly",(V,N,W)=>{B.setAttribute("contenteditable",W?"false":"true",H)}),H.on("change:isFocused",(V,N,W)=>{W?B.addClass("ck-editor__nested-editable_focused",H):B.removeClass("ck-editor__nested-editable_focused",H)}),setHighlightHandling(H,B),H}function findOptimalInsertionRange(H,B){const t=H.getSelectedElement();if(t){const V=getTypeAroundFakeCaretPosition(H);if(V)return B.createRange(B.createPositionAt(t,V))}return B.schema.findOptimalInsertionRange(H)}function viewToModelPositionOutsideModelElement(H,B){return(t,V)=>{const{mapper:N,viewPosition:W}=V,K=N.findMappedViewAncestor(W);if(!B(K))return;const G=N.toModelElement(K);V.modelPosition=H.createPositionAt(G,W.isAtStart?"before":"after")}}function getFillerOffset(){return null}function addSelectionHandle(H,B){const t=B.createUIElement("div",{class:"ck ck-widget__selection-handle"},function(V){const N=this.toDomElement(V),W=new IconView;return W.set("content",dragHandleIcon),W.render(),N.appendChild(W.element),N});B.insert(B.createPositionAt(H,0),t),B.addClass(["ck-widget_with-selection-handle"],H)}function calculateResizeHostAncestorWidth(H){const B=G=>{const{width:Z,paddingLeft:Y,paddingRight:X}=G.ownerDocument.defaultView.getComputedStyle(G);return parseFloat(Z)-(parseFloat(Y)||0)-(parseFloat(X)||0)},t=H.parentElement;if(!t)return 0;let V=B(t);const N=5;let W=0,K=t;for(;isNaN(V);){if(K=K.parentElement,++W>N)return 0;V=B(K)}return V}function calculateResizeHostPercentageWidth(H,B=new Rect(H)){const t=calculateResizeHostAncestorWidth(H);return t?B.width/t*100:0}const TYPE_AROUND_SELECTION_ATTRIBUTE="widget-type-around";function isTypeAroundWidget(H,B,t){return!!H&&isWidget(H)&&!t.isInline(B)}function getClosestTypeAroundDomButton(H){return H.closest(".ck-widget__type-around__button")}function getTypeAroundButtonPosition(H){return H.classList.contains("ck-widget__type-around__button_before")?"before":"after"}function getClosestWidgetViewElement(H,B){const t=H.closest(".ck-widget");return B.mapDomToView(t)}function getTypeAroundFakeCaretPosition(H){return H.getAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)}var returnIcon='<svg viewBox="0 0 10 8" xmlns="http://www.w3.org/2000/svg"><path d="M9.055.263v3.972h-6.77M1 4.216l2-2.038m-2 2 2 2.038"/></svg>';const POSSIBLE_INSERTION_POSITIONS=["before","after"],RETURN_ARROW_ICON_ELEMENT=new DOMParser().parseFromString(returnIcon,"image/svg+xml").firstChild,PLUGIN_DISABLED_EDITING_ROOT_CLASS="ck-widget__type-around_disabled";class WidgetTypeAround extends Plugin{constructor(){super(...arguments);ee(this,"_currentFakeCaretModelElement",null)}static get pluginName(){return"WidgetTypeAround"}static get requires(){return[Enter,Delete]}init(){const t=this.editor,V=t.editing.view;this.on("change:isEnabled",(N,W,K)=>{V.change(G=>{for(const Z of V.document.roots)K?G.removeClass(PLUGIN_DISABLED_EDITING_ROOT_CLASS,Z):G.addClass(PLUGIN_DISABLED_EDITING_ROOT_CLASS,Z)}),K||t.model.change(G=>{G.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)})}),this._enableTypeAroundUIInjection(),this._enableInsertingParagraphsOnButtonClick(),this._enableInsertingParagraphsOnEnterKeypress(),this._enableInsertingParagraphsOnTypingKeystroke(),this._enableTypeAroundFakeCaretActivationUsingKeyboardArrows(),this._enableDeleteIntegration(),this._enableInsertContentIntegration(),this._enableInsertObjectIntegration(),this._enableDeleteContentIntegration()}destroy(){super.destroy(),this._currentFakeCaretModelElement=null}_insertParagraph(t,V){const N=this.editor,W=N.editing.view,K=N.model.schema.getAttributesWithProperty(t,"copyOnReplace",!0);N.execute("insertParagraph",{position:N.model.createPositionAt(t,V),attributes:K}),W.focus(),W.scrollToTheSelection()}_listenToIfEnabled(t,V,N,W){this.listenTo(t,V,(...K)=>{this.isEnabled&&N(...K)},W)}_insertParagraphAccordingToFakeCaretPosition(){const N=this.editor.model.document.selection,W=getTypeAroundFakeCaretPosition(N);if(!W)return!1;const K=N.getSelectedElement();return this._insertParagraph(K,W),!0}_enableTypeAroundUIInjection(){const t=this.editor,V=t.model.schema,N=t.locale.t,W={before:N("Insert paragraph before block"),after:N("Insert paragraph after block")};t.editing.downcastDispatcher.on("insert",(K,G,Z)=>{const Y=Z.mapper.toViewElement(G.item);Y&&isTypeAroundWidget(Y,G.item,V)&&(injectUIIntoWidget(Z.writer,W,Y),Y.getCustomProperty("widgetLabel").push(()=>this.isEnabled?N("Press Enter to type after or press Shift + Enter to type before the widget"):""))},{priority:"low"})}_enableTypeAroundFakeCaretActivationUsingKeyboardArrows(){const t=this.editor,V=t.model,N=V.document.selection,W=V.schema,K=t.editing.view;this._listenToIfEnabled(K.document,"arrowKey",(Z,Y)=>{this._handleArrowKeyPress(Z,Y)},{context:[isWidget,"$text"],priority:"high"}),this._listenToIfEnabled(N,"change:range",(Z,Y)=>{Y.directChange&&t.model.change(X=>{X.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)})}),this._listenToIfEnabled(V.document,"change:data",()=>{const Z=N.getSelectedElement();if(Z){const Y=t.editing.mapper.toViewElement(Z);if(isTypeAroundWidget(Y,Z,W))return}t.model.change(Y=>{Y.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)})}),this._listenToIfEnabled(t.editing.downcastDispatcher,"selection",(Z,Y,X)=>{const Q=X.writer;if(this._currentFakeCaretModelElement){const le=X.mapper.toViewElement(this._currentFakeCaretModelElement);le&&(Q.removeClass(POSSIBLE_INSERTION_POSITIONS.map(G),le),this._currentFakeCaretModelElement=null)}const te=Y.selection.getSelectedElement();if(!te)return;const ie=X.mapper.toViewElement(te);if(!isTypeAroundWidget(ie,te,W))return;const ne=getTypeAroundFakeCaretPosition(Y.selection);ne&&(Q.addClass(G(ne),ie),this._currentFakeCaretModelElement=te)}),this._listenToIfEnabled(t.ui.focusTracker,"change:isFocused",(Z,Y,X)=>{X||t.model.change(Q=>{Q.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE)})});function G(Z){return`ck-widget_type-around_show-fake-caret_${Z}`}}_handleArrowKeyPress(t,V){const N=this.editor,W=N.model,K=W.document.selection,G=W.schema,Z=N.editing.view,Y=V.keyCode,X=isForwardArrowKeyCode(Y,N.locale.contentLanguageDirection),Q=Z.document.selection.getSelectedElement(),te=N.editing.mapper.toModelElement(Q);let ie;isTypeAroundWidget(Q,te,G)?ie=this._handleArrowKeyPressOnSelectedWidget(X):K.isCollapsed?ie=this._handleArrowKeyPressWhenSelectionNextToAWidget(X):V.shiftKey||(ie=this._handleArrowKeyPressWhenNonCollapsedSelection(X)),ie&&(V.preventDefault(),t.stop())}_handleArrowKeyPressOnSelectedWidget(t){const N=this.editor.model,W=N.document.selection,K=getTypeAroundFakeCaretPosition(W);return N.change(G=>{if(K){if(!(K===(t?"after":"before")))return G.removeSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE),!0}else return G.setSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE,t?"after":"before"),!0;return!1})}_handleArrowKeyPressWhenSelectionNextToAWidget(t){const V=this.editor,N=V.model,W=N.schema,K=V.plugins.get("Widget"),G=K._getObjectElementNextToSelection(t),Z=V.editing.mapper.toViewElement(G);return isTypeAroundWidget(Z,G,W)?(N.change(Y=>{K._setSelectionOverElement(G),Y.setSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE,t?"before":"after")}),!0):!1}_handleArrowKeyPressWhenNonCollapsedSelection(t){const V=this.editor,N=V.model,W=N.schema,K=V.editing.mapper,G=N.document.selection,Z=t?G.getLastPosition().nodeBefore:G.getFirstPosition().nodeAfter,Y=K.toViewElement(Z);return isTypeAroundWidget(Y,Z,W)?(N.change(X=>{X.setSelection(Z,"on"),X.setSelectionAttribute(TYPE_AROUND_SELECTION_ATTRIBUTE,t?"after":"before")}),!0):!1}_enableInsertingParagraphsOnButtonClick(){const t=this.editor,V=t.editing.view;this._listenToIfEnabled(V.document,"mousedown",(N,W)=>{const K=getClosestTypeAroundDomButton(W.domTarget);if(!K)return;const G=getTypeAroundButtonPosition(K),Z=getClosestWidgetViewElement(K,V.domConverter),Y=t.editing.mapper.toModelElement(Z);this._insertParagraph(Y,G),W.preventDefault(),N.stop()})}_enableInsertingParagraphsOnEnterKeypress(){const t=this.editor,V=t.model.document.selection,N=t.editing.view;this._listenToIfEnabled(N.document,"enter",(W,K)=>{if(W.eventPhase!="atTarget")return;const G=V.getSelectedElement(),Z=t.editing.mapper.toViewElement(G),Y=t.model.schema;let X;this._insertParagraphAccordingToFakeCaretPosition()?X=!0:isTypeAroundWidget(Z,G,Y)&&(this._insertParagraph(G,K.isSoft?"before":"after"),X=!0),X&&(K.preventDefault(),W.stop())},{context:isWidget})}_enableInsertingParagraphsOnTypingKeystroke(){const V=this.editor.editing.view.document;this._listenToIfEnabled(V,"insertText",(N,W)=>{this._insertParagraphAccordingToFakeCaretPosition()&&(W.selection=V.selection)},{priority:"high"}),env.isAndroid?this._listenToIfEnabled(V,"keydown",(N,W)=>{W.keyCode==229&&this._insertParagraphAccordingToFakeCaretPosition()}):this._listenToIfEnabled(V,"compositionstart",()=>{this._insertParagraphAccordingToFakeCaretPosition()},{priority:"high"})}_enableDeleteIntegration(){const t=this.editor,V=t.editing.view,N=t.model,W=N.schema;this._listenToIfEnabled(V.document,"delete",(K,G)=>{if(K.eventPhase!="atTarget")return;const Z=getTypeAroundFakeCaretPosition(N.document.selection);if(!Z)return;const Y=G.direction,X=N.document.selection.getSelectedElement(),Q=Z==="before",te=Y=="forward";if(Q===te)t.execute("delete",{selection:N.createSelection(X,"on")});else{const ne=W.getNearestSelectionRange(N.createPositionAt(X,Z),Y);if(ne)if(!ne.isCollapsed)N.change(le=>{le.setSelection(ne),t.execute(te?"deleteForward":"delete")});else{const le=N.createSelection(ne.start);if(N.modifySelection(le,{direction:Y}),!le.focus.isEqual(ne.start))N.change(ae=>{ae.setSelection(ne),t.execute(te?"deleteForward":"delete")});else{const ae=getDeepestEmptyElementAncestor(W,ne.start.parent);N.deleteContent(N.createSelection(ae,"on"),{doNotAutoparagraph:!0})}}}G.preventDefault(),K.stop()},{context:isWidget})}_enableInsertContentIntegration(){const t=this.editor,V=this.editor.model,N=V.document.selection;this._listenToIfEnabled(t.model,"insertContent",(W,[K,G])=>{if(G&&!G.is("documentSelection"))return;const Z=getTypeAroundFakeCaretPosition(N);if(Z)return W.stop(),V.change(Y=>{const X=N.getSelectedElement(),Q=V.createPositionAt(X,Z),te=Y.createSelection(Q),ie=V.insertContent(K,te);return Y.setSelection(te),ie})},{priority:"high"})}_enableInsertObjectIntegration(){const t=this.editor,N=this.editor.model.document.selection;this._listenToIfEnabled(t.model,"insertObject",(W,K)=>{const[,G,Z={}]=K;if(G&&!G.is("documentSelection"))return;const Y=getTypeAroundFakeCaretPosition(N);Y&&(Z.findOptimalPosition=Y,K[3]=Z)},{priority:"high"})}_enableDeleteContentIntegration(){const t=this.editor,N=this.editor.model.document.selection;this._listenToIfEnabled(t.model,"deleteContent",(W,[K])=>{if(K&&!K.is("documentSelection"))return;getTypeAroundFakeCaretPosition(N)&&W.stop()},{priority:"high"})}}function injectUIIntoWidget(H,B,t){const V=H.createUIElement("div",{class:"ck ck-reset_all ck-widget__type-around"},function(N){const W=this.toDomElement(N);return injectButtons(W,B),injectFakeCaret(W),W});H.insert(H.createPositionAt(t,"end"),V)}function injectButtons(H,B){for(const t of POSSIBLE_INSERTION_POSITIONS){const V=new Template({tag:"div",attributes:{class:["ck","ck-widget__type-around__button",`ck-widget__type-around__button_${t}`],title:B[t],"aria-hidden":"true"},children:[H.ownerDocument.importNode(RETURN_ARROW_ICON_ELEMENT,!0)]});H.appendChild(V.render())}}function injectFakeCaret(H){const B=new Template({tag:"div",attributes:{class:["ck","ck-widget__type-around__fake-caret"]}});H.appendChild(B.render())}function getDeepestEmptyElementAncestor(H,B){let t=B;for(const V of B.getAncestors({parentFirst:!0})){if(V.childCount>1||H.isLimit(V))break;t=V}return t}function verticalNavigationHandler(H){const B=H.model;return(t,V)=>{const N=V.keyCode==keyCodes.arrowup,W=V.keyCode==keyCodes.arrowdown,K=V.shiftKey,G=B.document.selection;if(!N&&!W)return;const Z=W;if(K&&selectionWillShrink(G,Z))return;const Y=findTextRangeFromSelection(H,G,Z);if(Y){if(Y.isCollapsed){if(G.isCollapsed)return;if(K)return}(Y.isCollapsed||isSingleLineRange(H,Y,Z))&&(B.change(X=>{const Q=Z?Y.end:Y.start;if(K){const te=B.createSelection(G.anchor);te.setFocus(Q),X.setSelection(te)}else X.setSelection(Q)}),t.stop(),V.preventDefault(),V.stopPropagation())}}}function findTextRangeFromSelection(H,B,t){const V=H.model;if(t){const N=B.isCollapsed?B.focus:B.getLastPosition(),W=getNearestNonInlineLimit(V,N,"forward");if(!W)return null;const K=V.createRange(N,W),G=getNearestTextPosition(V.schema,K,"backward");return G?V.createRange(N,G):null}else{const N=B.isCollapsed?B.focus:B.getFirstPosition(),W=getNearestNonInlineLimit(V,N,"backward");if(!W)return null;const K=V.createRange(W,N),G=getNearestTextPosition(V.schema,K,"forward");return G?V.createRange(G,N):null}}function getNearestNonInlineLimit(H,B,t){const V=H.schema,N=H.createRangeIn(B.root),W=t=="forward"?"elementStart":"elementEnd";for(const{previousPosition:K,item:G,type:Z}of N.getWalker({startPosition:B,direction:t})){if(V.isLimit(G)&&!V.isInline(G))return K;if(Z==W&&V.isBlock(G))return null}return null}function getNearestTextPosition(H,B,t){const V=t=="backward"?B.end:B.start;if(H.checkChild(V,"$text"))return V;for(const{nextPosition:N}of B.getWalker({direction:t}))if(H.checkChild(N,"$text"))return N;return null}function isSingleLineRange(H,B,t){const V=H.model,N=H.view.domConverter;if(t){const Y=V.createSelection(B.start);V.modifySelection(Y),!Y.focus.isAtEnd&&!B.start.isEqual(Y.focus)&&(B=V.createRange(Y.focus,B.end))}const W=H.mapper.toViewRange(B),K=N.viewRangeToDom(W),G=Rect.getDomRangeRects(K);let Z;for(const Y of G){if(Z===void 0){Z=Math.round(Y.bottom);continue}if(Math.round(Y.top)>=Z)return!1;Z=Math.max(Z,Math.round(Y.bottom))}return!0}function selectionWillShrink(H,B){return!H.isCollapsed&&H.isBackward==B}class Widget extends Plugin{constructor(){super(...arguments);ee(this,"_previouslySelected",new Set)}static get pluginName(){return"Widget"}static get requires(){return[WidgetTypeAround,Delete]}init(){const t=this.editor,V=t.editing.view,N=V.document,W=t.t;this.editor.editing.downcastDispatcher.on("selection",(K,G,Z)=>{const Y=Z.writer,X=G.selection;if(X.isCollapsed)return;const Q=X.getSelectedElement();if(!Q)return;const te=t.editing.mapper.toViewElement(Q);isWidget(te)&&Z.consumable.consume(X,"selection")&&Y.setSelection(Y.createRangeOn(te),{fake:!0,label:getLabel(te)})}),this.editor.editing.downcastDispatcher.on("selection",(K,G,Z)=>{this._clearPreviouslySelectedWidgets(Z.writer);const Y=Z.writer,X=Y.document.selection;let Q=null;for(const te of X.getRanges())for(const ie of te){const ne=ie.item;isWidget(ne)&&!isChild(ne,Q)&&(Y.addClass(WIDGET_SELECTED_CLASS_NAME,ne),this._previouslySelected.add(ne),Q=ne)}},{priority:"low"}),V.addObserver(MouseObserver),this.listenTo(N,"mousedown",(...K)=>this._onMousedown(...K)),this.listenTo(N,"arrowKey",(...K)=>{this._handleSelectionChangeOnArrowKeyPress(...K)},{context:[isWidget,"$text"]}),this.listenTo(N,"arrowKey",(...K)=>{this._preventDefaultOnArrowKeyPress(...K)},{context:"$root"}),this.listenTo(N,"arrowKey",verticalNavigationHandler(this.editor.editing),{context:"$text"}),this.listenTo(N,"delete",(K,G)=>{this._handleDelete(G.direction=="forward")&&(G.preventDefault(),K.stop())},{context:"$root"}),this.listenTo(N,"tab",(K,G)=>{K.eventPhase=="atTarget"&&(G.shiftKey||this._selectFirstNestedEditable()&&(G.preventDefault(),K.stop()))},{context:isWidget,priority:"low"}),this.listenTo(N,"tab",(K,G)=>{G.shiftKey&&this._selectAncestorWidget()&&(G.preventDefault(),K.stop())},{priority:"low"}),this.listenTo(N,"keydown",(K,G)=>{G.keystroke==keyCodes.esc&&this._selectAncestorWidget()&&(G.preventDefault(),K.stop())},{priority:"low"}),t.accessibility.addKeystrokeInfoGroup({id:"widget",label:W("Keystrokes that can be used when a widget is selected (for example: image, table, etc.)"),keystrokes:[{label:W("Move focus from an editable area back to the parent widget"),keystroke:"Esc"},{label:W("Insert a new paragraph directly after a widget"),keystroke:"Enter"},{label:W("Insert a new paragraph directly before a widget"),keystroke:"Shift+Enter"},{label:W("Move the caret to allow typing directly before a widget"),keystroke:[["arrowup"],["arrowleft"]]},{label:W("Move the caret to allow typing directly after a widget"),keystroke:[["arrowdown"],["arrowright"]]}]})}_onMousedown(t,V){const N=this.editor,W=N.editing.view,K=W.document;let G=V.target;if(!G)return;if(V.domEvent.detail>=3){this._selectBlockContent(G)&&V.preventDefault();return}if(!isWidget(G)){const Y=findClosestEditableOrWidgetAncestor(G);if(!Y)return;if(isWidget(Y))G=Y;else{const X=getElementFromMouseEvent(W,V);if(X&&isWidget(X))G=X;else return}}env.isAndroid&&V.preventDefault(),K.isFocused||W.focus();const Z=N.editing.mapper.toModelElement(G);this._setSelectionOverElement(Z)}_selectBlockContent(t){const V=this.editor,N=V.model,W=V.editing.mapper,K=N.schema,G=W.findMappedViewAncestor(this.editor.editing.view.createPositionAt(t,0)),Z=findTextBlockAncestor(W.toModelElement(G),N.schema);return Z?(N.change(Y=>{const X=K.isLimit(Z)?null:findNextTextBlock(Y.createPositionAfter(Z),K),Q=Y.createPositionAt(Z,0),te=X?Y.createPositionAt(X,0):Y.createPositionAt(Z,"end");Y.setSelection(Y.createRange(Q,te))}),!0):!1}_handleSelectionChangeOnArrowKeyPress(t,V){const N=V.keyCode,W=this.editor.model,K=W.schema,G=W.document.selection,Z=G.getSelectedElement(),Y=getLocalizedArrowKeyCodeDirection(N,this.editor.locale.contentLanguageDirection),X=Y=="down"||Y=="right",Q=Y=="up"||Y=="down";if(Z&&K.isObject(Z)){const ie=X?G.getLastPosition():G.getFirstPosition(),ne=K.getNearestSelectionRange(ie,X?"forward":"backward");ne&&(W.change(le=>{le.setSelection(ne)}),V.preventDefault(),t.stop());return}if(!G.isCollapsed&&!V.shiftKey){const ie=G.getFirstPosition(),ne=G.getLastPosition(),le=ie.nodeAfter,ae=ne.nodeBefore;(le&&K.isObject(le)||ae&&K.isObject(ae))&&(W.change(de=>{de.setSelection(X?ne:ie)}),V.preventDefault(),t.stop());return}if(!G.isCollapsed)return;const te=this._getObjectElementNextToSelection(X);if(te&&K.isObject(te)){if(K.isInline(te)&&Q)return;this._setSelectionOverElement(te),V.preventDefault(),t.stop()}}_preventDefaultOnArrowKeyPress(t,V){const N=this.editor.model,W=N.schema,K=N.document.selection.getSelectedElement();K&&W.isObject(K)&&(V.preventDefault(),t.stop())}_handleDelete(t){const N=this.editor.model.document.selection;if(!this.editor.model.canEditAt(N)||!N.isCollapsed)return;const W=this._getObjectElementNextToSelection(t);if(W)return this.editor.model.change(K=>{let G=N.anchor.parent;for(;G.isEmpty;){const Z=G;G=Z.parent,K.remove(Z)}this._setSelectionOverElement(W)}),!0}_setSelectionOverElement(t){this.editor.model.change(V=>{V.setSelection(V.createRangeOn(t))})}_getObjectElementNextToSelection(t){const V=this.editor.model,N=V.schema,W=V.document.selection,K=V.createSelection(W);if(V.modifySelection(K,{direction:t?"forward":"backward"}),K.isEqual(W))return null;const G=t?K.focus.nodeBefore:K.focus.nodeAfter;return G&&N.isObject(G)?G:null}_clearPreviouslySelectedWidgets(t){for(const V of this._previouslySelected)t.removeClass(WIDGET_SELECTED_CLASS_NAME,V);this._previouslySelected.clear()}_selectFirstNestedEditable(){const t=this.editor,N=this.editor.editing.view.document;for(const W of N.selection.getFirstRange().getItems())if(W.is("editableElement")){const K=t.editing.mapper.toModelElement(W);/* istanbul ignore next -- @preserve */if(!K)continue;const G=t.model.createPositionAt(K,0),Z=t.model.schema.getNearestSelectionRange(G,"forward");return t.model.change(Y=>{Y.setSelection(Z)}),!0}return!1}_selectAncestorWidget(){const t=this.editor,V=t.editing.mapper,W=t.editing.view.document.selection.getFirstPosition().parent,G=(W.is("$text")?W.parent:W).findAncestor(isWidget);if(!G)return!1;const Z=V.toModelElement(G);/* istanbul ignore next -- @preserve */return Z?(t.model.change(Y=>{Y.setSelection(Z,"on")}),!0):!1}}function findClosestEditableOrWidgetAncestor(H){let B=H;for(;B;){if(B.is("editableElement")||isWidget(B))return B;B=B.parent}return null}function getElementFromMouseEvent(H,B){const t=getRangeFromMouseEvent(B.domEvent);let V=null;if(t?V=H.domConverter.domRangeToView(t):V=H.createRange(H.createPositionAt(B.target,0)),!V)return null;const N=V.start;if(!N.parent)return null;let W=N.parent;return N.parent.is("editableElement")&&(N.isAtEnd&&N.nodeBefore?W=N.nodeBefore:N.isAtStart&&N.nodeAfter&&(W=N.nodeAfter)),W.is("$text")?W.parent:W}function isChild(H,B){return B?Array.from(H.getAncestors()).includes(B):!1}function findTextBlockAncestor(H,B){for(const t of H.getAncestors({includeSelf:!0,parentFirst:!0})){if(B.checkChild(t,"$text"))return t;if(B.isLimit(t)&&!B.isObject(t))break}return null}function findNextTextBlock(H,B){const t=new TreeWalker({startPosition:H});for(const{item:V}of t){if(B.isLimit(V)||!V.is("element"))return null;if(B.checkChild(V,"$text"))return V}return null}class WidgetToolbarRepository extends Plugin{constructor(){super(...arguments);ee(this,"_toolbarDefinitions",new Map);ee(this,"_balloon")}static get requires(){return[ContextualBalloon]}static get pluginName(){return"WidgetToolbarRepository"}init(){const t=this.editor;if(t.plugins.has("BalloonToolbar")){const V=t.plugins.get("BalloonToolbar");this.listenTo(V,"show",N=>{isWidgetSelected(t.editing.view.document.selection)&&N.stop()},{priority:"high"})}this._balloon=this.editor.plugins.get("ContextualBalloon"),this.on("change:isEnabled",()=>{this._updateToolbarsVisibility()}),this.listenTo(t.ui,"update",()=>{this._updateToolbarsVisibility()}),this.listenTo(t.ui.focusTracker,"change:isFocused",()=>{this._updateToolbarsVisibility()},{priority:"low"})}destroy(){super.destroy();for(const t of this._toolbarDefinitions.values())t.view.destroy()}register(t,{ariaLabel:V,items:N,getRelatedElement:W,balloonClassName:K="ck-toolbar-container"}){if(!N.length){logWarning("widget-toolbar-no-items",{toolbarId:t});return}const G=this.editor,Z=G.t,Y=new ToolbarView(G.locale);if(Y.ariaLabel=V||Z("Widget toolbar"),this._toolbarDefinitions.has(t))throw new CKEditorError("widget-toolbar-duplicated",this,{toolbarId:t});const X={view:Y,getRelatedElement:W,balloonClassName:K,itemsConfig:N,initialized:!1};G.ui.addToolbar(Y,{isContextual:!0,beforeFocus:()=>{const Q=W(G.editing.view.document.selection);Q&&this._showToolbar(X,Q)},afterBlur:()=>{this._hideToolbar(X)}}),this._toolbarDefinitions.set(t,X)}_updateToolbarsVisibility(){let t=0,V=null,N=null;for(const W of this._toolbarDefinitions.values()){const K=W.getRelatedElement(this.editor.editing.view.document.selection);if(!this.isEnabled||!K)this._isToolbarInBalloon(W)&&this._hideToolbar(W);else if(!this.editor.ui.focusTracker.isFocused)this._isToolbarVisible(W)&&this._hideToolbar(W);else{const G=K.getAncestors().length;G>t&&(t=G,V=K,N=W)}}N&&this._showToolbar(N,V)}_hideToolbar(t){this._balloon.remove(t.view),this.stopListening(this._balloon,"change:visibleView")}_showToolbar(t,V){this._isToolbarVisible(t)?repositionContextualBalloon$2(this.editor,V):this._isToolbarInBalloon(t)||(t.initialized||(t.initialized=!0,t.view.fillFromConfig(t.itemsConfig,this.editor.ui.componentFactory)),this._balloon.add({view:t.view,position:getBalloonPositionData$1(this.editor,V),balloonClassName:t.balloonClassName}),this.listenTo(this._balloon,"change:visibleView",()=>{for(const N of this._toolbarDefinitions.values())if(this._isToolbarVisible(N)){const W=N.getRelatedElement(this.editor.editing.view.document.selection);repositionContextualBalloon$2(this.editor,W)}}))}_isToolbarVisible(t){return this._balloon.visibleView===t.view}_isToolbarInBalloon(t){return this._balloon.hasView(t.view)}}function repositionContextualBalloon$2(H,B){const t=H.plugins.get("ContextualBalloon"),V=getBalloonPositionData$1(H,B);t.updatePosition(V)}function getBalloonPositionData$1(H,B){const t=H.editing.view,V=BalloonPanelView.defaultPositions;return{target:t.domConverter.mapViewToDom(B),positions:[V.northArrowSouth,V.northArrowSouthWest,V.northArrowSouthEast,V.southArrowNorth,V.southArrowNorthWest,V.southArrowNorthEast,V.viewportStickyNorth]}}function isWidgetSelected(H){const B=H.getSelectedElement();return!!(B&&isWidget(B))}class ResizeState extends ObservableMixin(){constructor(t){super();ee(this,"_referenceCoordinates");ee(this,"_options");ee(this,"_originalWidth");ee(this,"_originalHeight");ee(this,"_originalWidthPercents");ee(this,"_aspectRatio");this.set("activeHandlePosition",null),this.set("proposedWidthPercents",null),this.set("proposedWidth",null),this.set("proposedHeight",null),this.set("proposedHandleHostWidth",null),this.set("proposedHandleHostHeight",null),this._options=t,this._referenceCoordinates=null}get originalWidth(){return this._originalWidth}get originalHeight(){return this._originalHeight}get originalWidthPercents(){return this._originalWidthPercents}get aspectRatio(){return this._aspectRatio}begin(t,V,N){const W=new Rect(V);this.activeHandlePosition=getHandlePosition(t),this._referenceCoordinates=getAbsoluteBoundaryPoint(V,getOppositePosition(this.activeHandlePosition)),this._originalWidth=W.width,this._originalHeight=W.height,this._aspectRatio=W.width/W.height;const K=N.style.width;K&&K.match(/^\d+(\.\d*)?%$/)?this._originalWidthPercents=parseFloat(K):this._originalWidthPercents=calculateResizeHostPercentageWidth(N,W)}update(t){this.proposedWidth=t.width,this.proposedHeight=t.height,this.proposedWidthPercents=t.widthPercents,this.proposedHandleHostWidth=t.handleHostWidth,this.proposedHandleHostHeight=t.handleHostHeight}}function getAbsoluteBoundaryPoint(H,B){const t=new Rect(H),V=B.split("-"),N={x:V[1]=="right"?t.right:t.left,y:V[0]=="bottom"?t.bottom:t.top};return N.x+=H.ownerDocument.defaultView.scrollX,N.y+=H.ownerDocument.defaultView.scrollY,N}function getResizerHandleClass(H){return`ck-widget__resizer__handle-${H}`}function getHandlePosition(H){const B=["top-left","top-right","bottom-right","bottom-left"];for(const t of B)if(H.classList.contains(getResizerHandleClass(t)))return t}function getOppositePosition(H){const B=H.split("-"),t={top:"bottom",bottom:"top",left:"right",right:"left"};return`${t[B[0]]}-${t[B[1]]}`}class SizeView extends View{constructor(){super();const B=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-size-view",B.to("_viewPosition",t=>t?`ck-orientation-${t}`:"")],style:{display:B.if("_isVisible","none",t=>!t)}},children:[{text:B.to("_label")}]})}_bindToState(B,t){this.bind("_isVisible").to(t,"proposedWidth",t,"proposedHeight",(V,N)=>V!==null&&N!==null),this.bind("_label").to(t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",t,"proposedWidthPercents",(V,N,W)=>B.unit==="px"?`${V}×${N}`:`${W}%`),this.bind("_viewPosition").to(t,"activeHandlePosition",t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",(V,N,W)=>N<50||W<50?"above-center":V)}_dismiss(){this.unbind(),this._isVisible=!1}}class Resizer extends ObservableMixin(){constructor(t){super();ee(this,"_state");ee(this,"_sizeView");ee(this,"_options");ee(this,"_viewResizerWrapper",null);ee(this,"_initialViewWidth");this._options=t,this.set("isEnabled",!0),this.set("isSelected",!1),this.bind("isVisible").to(this,"isEnabled",this,"isSelected",(V,N)=>V&&N),this.decorate("begin"),this.decorate("cancel"),this.decorate("commit"),this.decorate("updateSize"),this.on("commit",V=>{!this.state.proposedWidth&&!this.state.proposedWidthPercents&&(this._cleanup(),V.stop())},{priority:"high"})}get state(){return this._state}show(){this._options.editor.editing.view.change(V=>{V.removeClass("ck-hidden",this._viewResizerWrapper)})}hide(){this._options.editor.editing.view.change(V=>{V.addClass("ck-hidden",this._viewResizerWrapper)})}attach(){const t=this,V=this._options.viewElement;this._options.editor.editing.view.change(W=>{const K=W.createUIElement("div",{class:"ck ck-reset_all ck-widget__resizer"},function(G){const Z=this.toDomElement(G);return t._appendHandles(Z),t._appendSizeUI(Z),Z});W.insert(W.createPositionAt(V,"end"),K),W.addClass("ck-widget_with-resizer",V),this._viewResizerWrapper=K,this.isVisible||this.hide()}),this.on("change:isVisible",()=>{this.isVisible?(this.show(),this.redraw()):this.hide()})}begin(t){this._state=new ResizeState(this._options),this._sizeView._bindToState(this._options,this.state),this._initialViewWidth=this._options.viewElement.getStyle("width"),this.state.begin(t,this._getHandleHost(),this._getResizeHost())}updateSize(t){const V=this._proposeNewSize(t);this._options.editor.editing.view.change(X=>{const Q=this._options.unit||"%",te=(Q==="%"?V.widthPercents:V.width)+Q;X.setStyle("width",te,this._options.viewElement)});const W=this._getHandleHost(),K=new Rect(W),G=Math.round(K.width),Z=Math.round(K.height),Y=new Rect(W);V.width=Math.round(Y.width),V.height=Math.round(Y.height),this.redraw(K),this.state.update({...V,handleHostWidth:G,handleHostHeight:Z})}commit(){const t=this._options.unit||"%",V=(t==="%"?this.state.proposedWidthPercents:this.state.proposedWidth)+t;this._options.editor.editing.view.change(()=>{this._cleanup(),this._options.onCommit(V)})}cancel(){this._cleanup()}destroy(){this.cancel()}redraw(t){const V=this._domResizerWrapper;if(!existsInDom(V))return;const N=V.parentElement,W=this._getHandleHost(),K=this._viewResizerWrapper,G=[K.getStyle("width"),K.getStyle("height"),K.getStyle("left"),K.getStyle("top")];let Z;if(N.isSameNode(W)){const Y=t||new Rect(W);Z=[Y.width+"px",Y.height+"px",void 0,void 0]}else Z=[W.offsetWidth+"px",W.offsetHeight+"px",W.offsetLeft+"px",W.offsetTop+"px"];compareArrays(G,Z)!=="same"&&this._options.editor.editing.view.change(Y=>{Y.setStyle({width:Z[0],height:Z[1],left:Z[2],top:Z[3]},K)})}containsHandle(t){return this._domResizerWrapper.contains(t)}static isResizeHandle(t){return t.classList.contains("ck-widget__resizer__handle")}_cleanup(){this._sizeView._dismiss(),this._options.editor.editing.view.change(V=>{V.setStyle("width",this._initialViewWidth,this._options.viewElement)})}_proposeNewSize(t){const V=this.state,N=extractCoordinates(t),W=this._options.isCentered?this._options.isCentered(this):!0,K={x:V._referenceCoordinates.x-(N.x+V.originalWidth),y:N.y-V.originalHeight-V._referenceCoordinates.y};W&&V.activeHandlePosition.endsWith("-right")&&(K.x=N.x-(V._referenceCoordinates.x+V.originalWidth)),W&&(K.x*=2);let G=Math.abs(V.originalWidth+K.x),Z=Math.abs(V.originalHeight+K.y);return(G/V.aspectRatio>Z?"width":"height")=="width"?Z=G/V.aspectRatio:G=Z*V.aspectRatio,{width:Math.round(G),height:Math.round(Z),widthPercents:Math.min(Math.round(V.originalWidthPercents/V.originalWidth*G*100)/100,100)}}_getResizeHost(){const t=this._domResizerWrapper.parentElement;return this._options.getResizeHost(t)}_getHandleHost(){const t=this._domResizerWrapper.parentElement;return this._options.getHandleHost(t)}get _domResizerWrapper(){return this._options.editor.editing.view.domConverter.mapViewToDom(this._viewResizerWrapper)}_appendHandles(t){const V=["top-left","top-right","bottom-right","bottom-left"];for(const N of V)t.appendChild(new Template({tag:"div",attributes:{class:`ck-widget__resizer__handle ${getResizerClass(N)}`}}).render())}_appendSizeUI(t){this._sizeView=new SizeView,this._sizeView.render(),t.appendChild(this._sizeView.element)}}function getResizerClass(H){return`ck-widget__resizer__handle-${H}`}function extractCoordinates(H){return{x:H.pageX,y:H.pageY}}function existsInDom(H){return H&&H.ownerDocument&&H.ownerDocument.contains(H)}class WidgetResize extends Plugin{constructor(){super(...arguments);ee(this,"_resizers",new Map);ee(this,"_observer");ee(this,"_redrawSelectedResizerThrottled")}static get pluginName(){return"WidgetResize"}init(){const t=this.editor.editing,V=global$1.window.document;this.set("selectedResizer",null),this.set("_activeResizer",null),t.view.addObserver(MouseObserver),this._observer=new(DomEmitterMixin()),this.listenTo(t.view.document,"mousedown",this._mouseDownListener.bind(this),{priority:"high"}),this._observer.listenTo(V,"mousemove",this._mouseMoveListener.bind(this)),this._observer.listenTo(V,"mouseup",this._mouseUpListener.bind(this)),this._redrawSelectedResizerThrottled=throttle(()=>this.redrawSelectedResizer(),200),this.editor.ui.on("update",this._redrawSelectedResizerThrottled),this.editor.model.document.on("change",()=>{for(const[W,K]of this._resizers)W.isAttached()||(this._resizers.delete(W),K.destroy())},{priority:"lowest"}),this._observer.listenTo(global$1.window,"resize",this._redrawSelectedResizerThrottled);const N=this.editor.editing.view.document.selection;N.on("change",()=>{const W=N.getSelectedElement(),K=this.getResizerByViewElement(W)||null;K?this.select(K):this.deselect()})}redrawSelectedResizer(){this.selectedResizer&&this.selectedResizer.isVisible&&this.selectedResizer.redraw()}destroy(){super.destroy(),this._observer.stopListening();for(const t of this._resizers.values())t.destroy();this._redrawSelectedResizerThrottled.cancel()}select(t){this.deselect(),this.selectedResizer=t,this.selectedResizer.isSelected=!0}deselect(){this.selectedResizer&&(this.selectedResizer.isSelected=!1),this.selectedResizer=null}attachTo(t){const V=new Resizer(t),N=this.editor.plugins;if(V.attach(),N.has("WidgetToolbarRepository")){const G=N.get("WidgetToolbarRepository");V.on("begin",()=>{G.forceDisabled("resize")},{priority:"lowest"}),V.on("cancel",()=>{G.clearForceDisabled("resize")},{priority:"highest"}),V.on("commit",()=>{G.clearForceDisabled("resize")},{priority:"highest"})}this._resizers.set(t.viewElement,V);const K=this.editor.editing.view.document.selection.getSelectedElement();return this.getResizerByViewElement(K)==V&&this.select(V),V}getResizerByViewElement(t){return this._resizers.get(t)}_getResizerByHandle(t){for(const V of this._resizers.values())if(V.containsHandle(t))return V}_mouseDownListener(t,V){const N=V.domTarget;Resizer.isResizeHandle(N)&&(this._activeResizer=this._getResizerByHandle(N)||null,this._activeResizer&&(this._activeResizer.begin(N),t.stop(),V.preventDefault()))}_mouseMoveListener(t,V){this._activeResizer&&this._activeResizer.updateSize(V)}_mouseUpListener(){this._activeResizer&&(this._activeResizer.commit(),this._activeResizer=null)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ClipboardObserver extends DomEventObserver{constructor(t){super(t);ee(this,"domEventType",["paste","copy","cut","drop","dragover","dragstart","dragend","dragenter","dragleave"]);const V=this.document;this.listenTo(V,"paste",N("clipboardInput"),{priority:"low"}),this.listenTo(V,"drop",N("clipboardInput"),{priority:"low"}),this.listenTo(V,"dragover",N("dragging"),{priority:"low"});function N(W){return(K,G)=>{G.preventDefault();const Z=G.dropRange?[G.dropRange]:null,Y=new EventInfo(V,W);V.fire(Y,{dataTransfer:G.dataTransfer,method:K.name,targetRanges:Z,target:G.target,domEvent:G.domEvent}),Y.stop.called&&G.stopPropagation()}}}onDomEvent(t){const V="clipboardData"in t?t.clipboardData:t.dataTransfer,N=t.type=="drop"||t.type=="paste",W={dataTransfer:new DataTransfer$1(V,{cacheFiles:N})};if(t.type=="drop"||t.type=="dragover"){const K=getRangeFromMouseEvent(t);W.dropRange=K&&this.view.domConverter.domRangeToView(K)}this.fire(t.type,t,W)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function plainTextToHtml(H){return H=H.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),(H.includes("</p><p>")||H.includes("<br>"))&&(H=`<p>${H}</p>`),H}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function normalizeClipboardData(H){return H.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(B,t)=>t.length==1?" ":t).replace(/<!--[\s\S]*?-->/g,"")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const smallPaddingElements=["figcaption","li"],listElements=["ol","ul"];function viewToPlainText(H){if(H.is("$text")||H.is("$textProxy"))return H.data;if(H.is("element","img")&&H.hasAttribute("alt"))return H.getAttribute("alt");if(H.is("element","br"))return`
`;let B="",t=null;for(const V of H.getChildren())B+=newLinePadding(V,t)+viewToPlainText(V),t=V;return B}function newLinePadding(H,B){return B?H.is("element","li")&&!H.isEmpty&&H.getChild(0).is("containerElement")||listElements.includes(H.name)&&listElements.includes(B.name)?`

`:!H.is("containerElement")&&!B.is("containerElement")?"":smallPaddingElements.includes(H.name)||smallPaddingElements.includes(B.name)?`
`:H.is("element")&&H.getCustomProperty("dataPipeline:transparentRendering")||B.is("element")&&B.getCustomProperty("dataPipeline:transparentRendering")?"":`

`:""}class ClipboardMarkersUtils extends Plugin{constructor(){super(...arguments);ee(this,"_markersToCopy",new Map)}static get pluginName(){return"ClipboardMarkersUtils"}_registerMarkerToCopy(t,V){this._markersToCopy.set(t,V)}_copySelectedFragmentWithMarkers(t,V,N=W=>W.model.getSelectedContent(W.model.document.selection)){return this.editor.model.change(W=>{const K=W.model.document.selection;W.setSelection(V);const G=this._insertFakeMarkersIntoSelection(W,W.model.document.selection,t),Z=N(W),Y=this._removeFakeMarkersInsideElement(W,Z);for(const[X,Q]of Object.entries(G)){Y[X]||(Y[X]=W.createRangeIn(Z));for(const te of Q)W.remove(te)}Z.markers.clear();for(const[X,Q]of Object.entries(Y))Z.markers.set(X,Q);return W.setSelection(K),Z})}_pasteMarkersIntoTransformedElement(t,V){const N=this._getPasteMarkersFromRangeMap(t);return this.editor.model.change(W=>{const K=this._insertFakeMarkersElements(W,N),G=V(W),Z=this._removeFakeMarkersInsideElement(W,G);for(const Y of Object.values(K).flat())W.remove(Y);for(const[Y,X]of Object.entries(Z))W.model.markers.has(Y)||W.addMarker(Y,{usingOperation:!0,affectsData:!0,range:X});return G})}_pasteFragmentWithMarkers(t){const V=this._getPasteMarkersFromRangeMap(t.markers);t.markers.clear();for(const N of V)t.markers.set(N.name,N.range);return this.editor.model.insertContent(t)}_forceMarkersCopy(t,V,N={allowedActions:"all",copyPartiallySelected:!0,duplicateOnPaste:!0}){const W=this._markersToCopy.get(t);this._markersToCopy.set(t,N),V(),W?this._markersToCopy.set(t,W):this._markersToCopy.delete(t)}_isMarkerCopyable(t,V){const N=this._getMarkerClipboardConfig(t);if(!N)return!1;if(!V)return!0;const{allowedActions:W}=N;return W==="all"||W.includes(V)}_hasMarkerConfiguration(t){return!!this._getMarkerClipboardConfig(t)}_getMarkerClipboardConfig(t){const[V]=t.split(":");return this._markersToCopy.get(V)||null}_insertFakeMarkersIntoSelection(t,V,N){const W=this._getCopyableMarkersFromSelection(t,V,N);return this._insertFakeMarkersElements(t,W)}_getCopyableMarkersFromSelection(t,V,N){const W=Array.from(V.getRanges()),K=new Set(W.flatMap(Z=>Array.from(t.model.markers.getMarkersIntersectingRange(Z)))),G=Z=>{if(!this._isMarkerCopyable(Z.name,N))return!1;const{copyPartiallySelected:X}=this._getMarkerClipboardConfig(Z.name);if(!X){const Q=Z.getRange();return W.some(te=>te.containsRange(Q,!0))}return!0};return Array.from(K).filter(G).map(Z=>({name:N==="dragstart"?this._getUniqueMarkerName(Z.name):Z.name,range:Z.getRange()}))}_getPasteMarkersFromRangeMap(t,V=null){const{model:N}=this.editor;return(t instanceof Map?Array.from(t.entries()):Object.entries(t)).flatMap(([K,G])=>{if(!this._hasMarkerConfiguration(K))return[{name:K,range:G}];if(this._isMarkerCopyable(K,V)){const Z=this._getMarkerClipboardConfig(K),Y=N.markers.has(K)&&N.markers.get(K).getRange().root.rootName==="$graveyard";return(Z.duplicateOnPaste||Y)&&(K=this._getUniqueMarkerName(K)),[{name:K,range:G}]}return[]})}_insertFakeMarkersElements(t,V){const N={},W=V.flatMap(K=>{const{start:G,end:Z}=K.range;return[{position:G,marker:K,type:"start"},{position:Z,marker:K,type:"end"}]}).sort(({position:K},{position:G})=>K.isBefore(G)?1:-1);for(const{position:K,marker:G,type:Z}of W){const Y=t.createElement("$marker",{"data-name":G.name,"data-type":Z});N[G.name]||(N[G.name]=[]),N[G.name].push(Y),t.insert(Y,K)}return N}_removeFakeMarkersInsideElement(t,V){const W=this._getAllFakeMarkersFromElement(t,V).reduce((K,G)=>{const Z=G.markerElement&&t.createPositionBefore(G.markerElement);let Y=K[G.name],X=!1;return Y&&Y.start&&Y.end&&(this._getMarkerClipboardConfig(G.name).duplicateOnPaste?K[this._getUniqueMarkerName(G.name)]=K[G.name]:X=!0,Y=null),X||(K[G.name]={...Y,[G.type]:Z}),G.markerElement&&t.remove(G.markerElement),K},{});return mapValues(W,K=>new Range(K.start||t.createPositionFromPath(V,[0]),K.end||t.createPositionAt(V,"end")))}_getAllFakeMarkersFromElement(t,V){const N=Array.from(t.createRangeIn(V)).flatMap(({item:G})=>{if(!G.is("element","$marker"))return[];const Z=G.getAttribute("data-name"),Y=G.getAttribute("data-type");return[{markerElement:G,name:Z,type:Y}]}),W=[],K=[];for(const G of N)G.type==="end"&&(N.some(Y=>Y.name===G.name&&Y.type==="start")||W.push({markerElement:null,name:G.name,type:"start"})),G.type==="start"&&(N.some(Y=>Y.name===G.name&&Y.type==="end")||K.unshift({markerElement:null,name:G.name,type:"end"}));return[...W,...N,...K]}_getUniqueMarkerName(t){const V=t.split(":"),N=uid().substring(1,6);return V.length===3?`${V.slice(0,2).join(":")}:${N}`:`${V.join(":")}:${N}`}}class ClipboardPipeline extends Plugin{static get pluginName(){return"ClipboardPipeline"}static get requires(){return[ClipboardMarkersUtils]}init(){this.editor.editing.view.addObserver(ClipboardObserver),this._setupPasteDrop(),this._setupCopyCut()}_fireOutputTransformationEvent(B,t,V){const N=this.editor.plugins.get("ClipboardMarkersUtils");this.editor.model.enqueueChange({isUndoable:V==="cut"},()=>{const W=N._copySelectedFragmentWithMarkers(V,t);this.fire("outputTransformation",{dataTransfer:B,content:W,method:V})})}_setupPasteDrop(){const B=this.editor,t=B.model,V=B.editing.view,N=V.document,W=this.editor.plugins.get("ClipboardMarkersUtils");this.listenTo(N,"clipboardInput",(K,G)=>{G.method=="paste"&&!B.model.canEditAt(B.model.document.selection)&&K.stop()},{priority:"highest"}),this.listenTo(N,"clipboardInput",(K,G)=>{const Z=G.dataTransfer;let Y;if(G.content)Y=G.content;else{let Q="";Z.getData("text/html")?Q=normalizeClipboardData(Z.getData("text/html")):Z.getData("text/plain")&&(Q=plainTextToHtml(Z.getData("text/plain"))),Y=this.editor.data.htmlProcessor.toView(Q)}const X=new EventInfo(this,"inputTransformation");this.fire(X,{content:Y,dataTransfer:Z,targetRanges:G.targetRanges,method:G.method}),X.stop.called&&K.stop(),V.scrollToTheSelection()},{priority:"low"}),this.listenTo(this,"inputTransformation",(K,G)=>{if(G.content.isEmpty)return;const Y=this.editor.data.toModel(G.content,"$clipboardHolder");Y.childCount!=0&&(K.stop(),t.change(()=>{this.fire("contentInsertion",{content:Y,method:G.method,dataTransfer:G.dataTransfer,targetRanges:G.targetRanges})}))},{priority:"low"}),this.listenTo(this,"contentInsertion",(K,G)=>{G.resultRange=W._pasteFragmentWithMarkers(G.content)},{priority:"low"})}_setupCopyCut(){const B=this.editor,t=B.model.document,N=B.editing.view.document,W=(K,G)=>{const Z=G.dataTransfer;G.preventDefault(),this._fireOutputTransformationEvent(Z,t.selection,K.name)};this.listenTo(N,"copy",W,{priority:"low"}),this.listenTo(N,"cut",(K,G)=>{B.model.canEditAt(B.model.document.selection)?W(K,G):G.preventDefault()},{priority:"low"}),this.listenTo(this,"outputTransformation",(K,G)=>{const Z=B.data.toView(G.content);N.fire("clipboardOutput",{dataTransfer:G.dataTransfer,content:Z,method:G.method})},{priority:"low"}),this.listenTo(N,"clipboardOutput",(K,G)=>{G.content.isEmpty||(G.dataTransfer.setData("text/html",this.editor.data.htmlProcessor.toData(G.content)),G.dataTransfer.setData("text/plain",viewToPlainText(G.content))),G.method=="cut"&&B.model.deleteContent(t.selection)},{priority:"low"})}}const toPx$1=toUnit("px");class LineView extends View{constructor(){super();const B=this.bindTemplate;this.set({isVisible:!1,left:null,top:null,width:null}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-clipboard-drop-target-line",B.if("isVisible","ck-hidden",t=>!t)],style:{left:B.to("left",t=>toPx$1(t)),top:B.to("top",t=>toPx$1(t)),width:B.to("width",t=>toPx$1(t))}}})}}class DragDropTarget extends Plugin{constructor(){super(...arguments);ee(this,"removeDropMarkerDelayed",delay(()=>this.removeDropMarker(),40));ee(this,"_updateDropMarkerThrottled",throttle(t=>this._updateDropMarker(t),40));ee(this,"_reconvertMarkerThrottled",throttle(()=>{this.editor.model.markers.has("drop-target")&&this.editor.editing.reconvertMarker("drop-target")},0));ee(this,"_dropTargetLineView",new LineView);ee(this,"_domEmitter",new(DomEmitterMixin()));ee(this,"_scrollables",new Map)}static get pluginName(){return"DragDropTarget"}init(){this._setupDropMarker()}destroy(){this._domEmitter.stopListening();for(const{resizeObserver:t}of this._scrollables.values())t.destroy();return this._updateDropMarkerThrottled.cancel(),this.removeDropMarkerDelayed.cancel(),this._reconvertMarkerThrottled.cancel(),super.destroy()}updateDropMarker(t,V,N,W,K,G){this.removeDropMarkerDelayed.cancel();const Z=findDropTargetRange(this.editor,t,V,N,W,K,G);/* istanbul ignore next -- @preserve */if(Z){if(G&&G.containsRange(Z))return this.removeDropMarker();this._updateDropMarkerThrottled(Z)}}getFinalDropRange(t,V,N,W,K,G){const Z=findDropTargetRange(this.editor,t,V,N,W,K,G);return this.removeDropMarker(),Z}removeDropMarker(){const t=this.editor.model;this.removeDropMarkerDelayed.cancel(),this._updateDropMarkerThrottled.cancel(),this._dropTargetLineView.isVisible=!1,t.markers.has("drop-target")&&t.change(V=>{V.removeMarker("drop-target")})}_setupDropMarker(){const t=this.editor;t.ui.view.body.add(this._dropTargetLineView),t.conversion.for("editingDowncast").markerToHighlight({model:"drop-target",view:{classes:["ck-clipboard-drop-target-range"]}}),t.conversion.for("editingDowncast").markerToElement({model:"drop-target",view:(V,{writer:N})=>{if(t.model.schema.checkChild(V.markerRange.start,"$text"))return this._dropTargetLineView.isVisible=!1,this._createDropTargetPosition(N);V.markerRange.isCollapsed?this._updateDropTargetLine(V.markerRange):this._dropTargetLineView.isVisible=!1}})}_updateDropMarker(t){const V=this.editor,N=V.model.markers;V.model.change(W=>{N.has("drop-target")?N.get("drop-target").getRange().isEqual(t)||W.updateMarker("drop-target",{range:t}):W.addMarker("drop-target",{range:t,usingOperation:!1,affectsData:!1})})}_createDropTargetPosition(t){return t.createUIElement("span",{class:"ck ck-clipboard-drop-target-position"},function(V){const N=this.toDomElement(V);return N.append("⁠",V.createElement("span"),"⁠"),N})}_updateDropTargetLine(t){const V=this.editor.editing,N=t.start.nodeBefore,W=t.start.nodeAfter,K=t.start.parent,G=N?V.mapper.toViewElement(N):null,Z=G?V.view.domConverter.mapViewToDom(G):null,Y=W?V.mapper.toViewElement(W):null,X=Y?V.view.domConverter.mapViewToDom(Y):null,Q=V.mapper.toViewElement(K);if(!Q)return;const te=V.view.domConverter.mapViewToDom(Q),ie=this._getScrollableRect(Q),{scrollX:ne,scrollY:le}=global$1.window,ae=Z?new Rect(Z):null,de=X?new Rect(X):null,ce=new Rect(te).excludeScrollbarsAndBorders(),we=ae?ae.bottom:ce.top,be=de?de.top:ce.bottom,ge=global$1.window.getComputedStyle(te),Ce=we<=be?(we+be)/2:be;if(ie.top<Ce&&Ce<ie.bottom){const he=ce.left+parseFloat(ge.paddingLeft),me=ce.right-parseFloat(ge.paddingRight),pe=Math.max(he+ne,ie.left),_e=Math.min(me+ne,ie.right);this._dropTargetLineView.set({isVisible:!0,left:pe,top:Ce+le,width:_e-pe})}else this._dropTargetLineView.isVisible=!1}_getScrollableRect(t){const V=t.root.rootName;let N;if(this._scrollables.has(V))N=this._scrollables.get(V).domElement;else{const W=this.editor.editing.view.domConverter.mapViewToDom(t);N=findScrollableElement(W),this._domEmitter.listenTo(N,"scroll",this._reconvertMarkerThrottled,{usePassive:!0});const K=new ResizeObserver(N,this._reconvertMarkerThrottled);this._scrollables.set(V,{domElement:N,resizeObserver:K})}return new Rect(N).excludeScrollbarsAndBorders()}}function findDropTargetRange(H,B,t,V,N,W,K){const G=H.model,Z=H.editing.mapper;let X=getClosestMappedModelElement(H,B);for(;X;){if(!W){if(G.schema.checkChild(X,"$text")){if(t){const Q=t[0].start,te=Z.toModelPosition(Q);if(!K||Array.from(K.getItems()).every(ne=>G.schema.checkChild(te,ne))){if(G.schema.checkChild(te,"$text"))return G.createRange(te);if(Q)return findDropTargetRangeForElement(H,getClosestMappedModelElement(H,Q.parent),V,N)}}}else if(G.schema.isInline(X))return findDropTargetRangeForElement(H,X,V,N)}if(G.schema.isBlock(X))return findDropTargetRangeForElement(H,X,V,N);if(G.schema.checkChild(X,"$block")){const Q=Array.from(X.getChildren()).filter(ne=>ne.is("element")&&!shouldIgnoreElement(H,ne));let te=0,ie=Q.length;if(ie==0)return G.createRange(G.createPositionAt(X,"end"));for(;te<ie-1;){const ne=Math.floor((te+ie)/2);findElementSide(H,Q[ne],V,N)=="before"?ie=ne:te=ne}return findDropTargetRangeForElement(H,Q[te],V,N)}X=X.parent}return null}function shouldIgnoreElement(H,B){const t=H.editing.mapper,V=H.editing.view.domConverter,N=t.toViewElement(B);if(!N)return!0;const W=V.mapViewToDom(N);return global$1.window.getComputedStyle(W).float!="none"}function findDropTargetRangeForElement(H,B,t,V){const N=H.model;return N.createRange(N.createPositionAt(B,findElementSide(H,B,t,V)))}function findElementSide(H,B,t,V){const N=H.editing.mapper,W=H.editing.view.domConverter,K=N.toViewElement(B),G=W.mapViewToDom(K),Z=new Rect(G);return H.model.schema.isInline(B)?t<(Z.left+Z.right)/2?"before":"after":V<(Z.top+Z.bottom)/2?"before":"after"}function getClosestMappedModelElement(H,B){const t=H.editing.mapper,V=H.editing.view,N=t.toModelElement(B);if(N)return N;const W=V.createPositionBefore(B),K=t.findMappedViewAncestor(W);return t.toModelElement(K)}function findScrollableElement(H){let B=H;do{B=B.parentElement;const t=global$1.window.getComputedStyle(B).overflowY;if(t=="auto"||t=="scroll")break}while(B.tagName!="BODY");return B}class DragDropBlockToolbar extends Plugin{constructor(){super(...arguments);ee(this,"_isBlockDragging",!1);ee(this,"_domEmitter",new(DomEmitterMixin()))}static get pluginName(){return"DragDropBlockToolbar"}init(){const t=this.editor;if(this.listenTo(t,"change:isReadOnly",(V,N,W)=>{W?(this.forceDisabled("readOnlyMode"),this._isBlockDragging=!1):this.clearForceDisabled("readOnlyMode")}),env.isAndroid&&this.forceDisabled("noAndroidSupport"),t.plugins.has("BlockToolbar")){const N=t.plugins.get("BlockToolbar").buttonView.element;this._domEmitter.listenTo(N,"dragstart",(W,K)=>this._handleBlockDragStart(K)),this._domEmitter.listenTo(global$1.document,"dragover",(W,K)=>this._handleBlockDragging(K)),this._domEmitter.listenTo(global$1.document,"drop",(W,K)=>this._handleBlockDragging(K)),this._domEmitter.listenTo(global$1.document,"dragend",()=>this._handleBlockDragEnd(),{useCapture:!0}),this.isEnabled&&N.setAttribute("draggable","true"),this.on("change:isEnabled",(W,K,G)=>{N.setAttribute("draggable",G?"true":"false")})}}destroy(){return this._domEmitter.stopListening(),super.destroy()}_handleBlockDragStart(t){if(!this.isEnabled)return;const V=this.editor.model,N=V.document.selection,W=this.editor.editing.view,K=Array.from(N.getSelectedBlocks()),G=V.createRange(V.createPositionBefore(K[0]),V.createPositionAfter(K[K.length-1]));V.change(Z=>Z.setSelection(G)),this._isBlockDragging=!0,W.focus(),W.getObserver(ClipboardObserver).onDomEvent(t)}_handleBlockDragging(t){if(!this.isEnabled||!this._isBlockDragging)return;const V=t.clientX+(this.editor.locale.contentLanguageDirection=="ltr"?100:-100),N=t.clientY,W=document.elementFromPoint(V,N),K=this.editor.editing.view;!W||!W.closest(".ck-editor__editable")||K.getObserver(ClipboardObserver).onDomEvent({...t,type:t.type,dataTransfer:t.dataTransfer,target:W,clientX:V,clientY:N,preventDefault:()=>t.preventDefault(),stopPropagation:()=>t.stopPropagation()})}_handleBlockDragEnd(){this._isBlockDragging=!1}}class DragDrop extends Plugin{constructor(){super(...arguments);ee(this,"_draggedRange");ee(this,"_draggingUid");ee(this,"_draggableElement");ee(this,"_clearDraggableAttributesDelayed",delay(()=>this._clearDraggableAttributes(),40));ee(this,"_blockMode",!1);ee(this,"_domEmitter",new(DomEmitterMixin()));ee(this,"_previewContainer")}static get pluginName(){return"DragDrop"}static get requires(){return[ClipboardPipeline,Widget,DragDropTarget,DragDropBlockToolbar]}init(){const t=this.editor,V=t.editing.view;this._draggedRange=null,this._draggingUid="",this._draggableElement=null,V.addObserver(ClipboardObserver),V.addObserver(MouseObserver),this._setupDragging(),this._setupContentInsertionIntegration(),this._setupClipboardInputIntegration(),this._setupDraggableAttributeHandling(),this.listenTo(t,"change:isReadOnly",(N,W,K)=>{K?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")}),this.on("change:isEnabled",(N,W,K)=>{K||this._finalizeDragging(!1)}),env.isAndroid&&this.forceDisabled("noAndroidSupport")}destroy(){return this._draggedRange&&(this._draggedRange.detach(),this._draggedRange=null),this._previewContainer&&this._previewContainer.remove(),this._domEmitter.stopListening(),this._clearDraggableAttributesDelayed.cancel(),super.destroy()}_setupDragging(){const t=this.editor,V=t.model,N=t.editing.view,W=N.document,K=t.plugins.get(DragDropTarget);this.listenTo(W,"dragstart",(G,Z)=>{if(Z.target&&Z.target.is("editableElement")){Z.preventDefault();return}if(this._prepareDraggedRange(Z.target),!this._draggedRange){Z.preventDefault();return}this._draggingUid=uid(),Z.dataTransfer.effectAllowed=this.isEnabled?"copyMove":"copy",Z.dataTransfer.setData("application/ckeditor5-dragging-uid",this._draggingUid);const Y=V.createSelection(this._draggedRange.toRange());this.editor.plugins.get("ClipboardPipeline")._fireOutputTransformationEvent(Z.dataTransfer,Y,"dragstart");const{dataTransfer:Q,domTarget:te,domEvent:ie}=Z,{clientX:ne}=ie;this._updatePreview({dataTransfer:Q,domTarget:te,clientX:ne}),Z.stopPropagation(),this.isEnabled||(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid="")},{priority:"low"}),this.listenTo(W,"dragend",(G,Z)=>{this._finalizeDragging(!Z.dataTransfer.isCanceled&&Z.dataTransfer.dropEffect=="move")},{priority:"low"}),this._domEmitter.listenTo(global$1.document,"dragend",()=>{this._blockMode=!1},{useCapture:!0}),this.listenTo(W,"dragenter",()=>{this.isEnabled&&N.focus()}),this.listenTo(W,"dragleave",()=>{K.removeDropMarkerDelayed()}),this.listenTo(W,"dragging",(G,Z)=>{if(!this.isEnabled){Z.dataTransfer.dropEffect="none";return}const{clientX:Y,clientY:X}=Z.domEvent;K.updateDropMarker(Z.target,Z.targetRanges,Y,X,this._blockMode,this._draggedRange),this._draggedRange||(Z.dataTransfer.dropEffect="copy"),env.isGecko||(Z.dataTransfer.effectAllowed=="copy"?Z.dataTransfer.dropEffect="copy":["all","copyMove"].includes(Z.dataTransfer.effectAllowed)&&(Z.dataTransfer.dropEffect="move")),G.stop()},{priority:"low"})}_setupClipboardInputIntegration(){const t=this.editor,N=t.editing.view.document,W=t.plugins.get(DragDropTarget);this.listenTo(N,"clipboardInput",(K,G)=>{if(G.method!="drop")return;const{clientX:Z,clientY:Y}=G.domEvent,X=W.getFinalDropRange(G.target,G.targetRanges,Z,Y,this._blockMode,this._draggedRange);if(!X){this._finalizeDragging(!1),K.stop();return}if(this._draggedRange&&this._draggingUid!=G.dataTransfer.getData("application/ckeditor5-dragging-uid")&&(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid=""),getFinalDropEffect(G.dataTransfer)=="move"&&this._draggedRange&&this._draggedRange.containsRange(X,!0)){this._finalizeDragging(!1),K.stop();return}G.targetRanges=[t.editing.mapper.toViewRange(X)]},{priority:"high"})}_setupContentInsertionIntegration(){const t=this.editor.plugins.get(ClipboardPipeline);t.on("contentInsertion",(V,N)=>{if(!this.isEnabled||N.method!=="drop")return;const W=N.targetRanges.map(K=>this.editor.editing.mapper.toModelRange(K));this.editor.model.change(K=>K.setSelection(W))},{priority:"high"}),t.on("contentInsertion",(V,N)=>{if(!this.isEnabled||N.method!=="drop")return;const W=getFinalDropEffect(N.dataTransfer)=="move",K=!N.resultRange||!N.resultRange.isCollapsed;this._finalizeDragging(K&&W)},{priority:"lowest"})}_setupDraggableAttributeHandling(){const t=this.editor,V=t.editing.view,N=V.document;this.listenTo(N,"mousedown",(W,K)=>{if(env.isAndroid||!K)return;this._clearDraggableAttributesDelayed.cancel();let G=findDraggableWidget(K.target);if(env.isBlink&&!t.isReadOnly&&!G&&!N.selection.isCollapsed){const Z=N.selection.getSelectedElement();(!Z||!isWidget(Z))&&(G=N.selection.editableElement)}G&&(V.change(Z=>{Z.setAttribute("draggable","true",G)}),this._draggableElement=t.editing.mapper.toModelElement(G))}),this.listenTo(N,"mouseup",()=>{env.isAndroid||this._clearDraggableAttributesDelayed()})}_clearDraggableAttributes(){const t=this.editor.editing;t.view.change(V=>{this._draggableElement&&this._draggableElement.root.rootName!="$graveyard"&&V.removeAttribute("draggable",t.mapper.toViewElement(this._draggableElement)),this._draggableElement=null})}_finalizeDragging(t){const V=this.editor,N=V.model;V.plugins.get(DragDropTarget).removeDropMarker(),this._clearDraggableAttributes(),V.plugins.has("WidgetToolbarRepository")&&V.plugins.get("WidgetToolbarRepository").clearForceDisabled("dragDrop"),this._draggingUid="",this._previewContainer&&(this._previewContainer.remove(),this._previewContainer=void 0),this._draggedRange&&(t&&this.isEnabled&&N.change(K=>{const G=N.createSelection(this._draggedRange);N.deleteContent(G,{doNotAutoparagraph:!0});const Z=G.getFirstPosition().parent;Z.isEmpty&&!N.schema.checkChild(Z,"$text")&&N.schema.checkChild(Z,"paragraph")&&K.insertElement("paragraph",Z,0)}),this._draggedRange.detach(),this._draggedRange=null)}_prepareDraggedRange(t){const V=this.editor,N=V.model,W=N.document.selection,K=t?findDraggableWidget(t):null;if(K){const X=V.editing.mapper.toModelElement(K);this._draggedRange=LiveRange.fromRange(N.createRangeOn(X)),this._blockMode=N.schema.isBlock(X),V.plugins.has("WidgetToolbarRepository")&&V.plugins.get("WidgetToolbarRepository").forceDisabled("dragDrop");return}if(W.isCollapsed&&!W.getFirstPosition().parent.isEmpty)return;const G=Array.from(W.getSelectedBlocks()),Z=W.getFirstRange();if(G.length==0){this._draggedRange=LiveRange.fromRange(Z);return}const Y=getRangeIncludingFullySelectedParents(N,G);if(G.length>1)this._draggedRange=LiveRange.fromRange(Y),this._blockMode=!0;else if(G.length==1){const X=Z.start.isTouching(Y.start)&&Z.end.isTouching(Y.end);this._draggedRange=LiveRange.fromRange(X?Y:Z),this._blockMode=X}N.change(X=>X.setSelection(this._draggedRange.toRange()))}_updatePreview({dataTransfer:t,domTarget:V,clientX:N}){const W=this.editor.editing.view,K=W.document.selection.editableElement,G=W.domConverter.mapViewToDom(K),Z=global$1.window.getComputedStyle(G);this._previewContainer?this._previewContainer.firstElementChild&&this._previewContainer.removeChild(this._previewContainer.firstElementChild):(this._previewContainer=createElement(global$1.document,"div",{style:"position: fixed; left: -999999px;"}),global$1.document.body.appendChild(this._previewContainer));const Y=new Rect(G);if(G.contains(V))return;const X=parseFloat(Z.paddingLeft),Q=createElement(global$1.document,"div");Q.className="ck ck-content",Q.style.width=Z.width,Q.style.paddingLeft=`${Y.left-N+X}px`,env.isiOS&&(Q.style.backgroundColor="white"),W.domConverter.setContentOf(Q,t.getData("text/html")),t.setDragImage(Q,0,0),this._previewContainer.appendChild(Q)}}function getFinalDropEffect(H){return env.isGecko?H.dropEffect:["all","copyMove"].includes(H.effectAllowed)?"move":"copy"}function findDraggableWidget(H){if(H.is("editableElement"))return null;if(H.hasClass("ck-widget__selection-handle"))return H.findAncestor(isWidget);if(isWidget(H))return H;const B=H.findAncestor(t=>isWidget(t)||t.is("editableElement"));return isWidget(B)?B:null}function getRangeIncludingFullySelectedParents(H,B){const t=B[0],V=B[B.length-1],N=t.getCommonAncestor(V),W=H.createPositionBefore(t),K=H.createPositionAfter(V);if(N&&N.is("element")&&!H.schema.isLimit(N)){const G=H.createRangeOn(N),Z=W.isTouching(G.start),Y=K.isTouching(G.end);if(Z&&Y)return getRangeIncludingFullySelectedParents(H,[N])}return H.createRange(W,K)}class PastePlainText extends Plugin{static get pluginName(){return"PastePlainText"}static get requires(){return[ClipboardPipeline]}init(){const B=this.editor,t=B.model,V=B.editing.view,N=t.document.selection;V.addObserver(ClipboardObserver),B.plugins.get(ClipboardPipeline).on("contentInsertion",(W,K)=>{isUnformattedInlineContent(K.content,t)&&t.change(G=>{const Z=Array.from(N.getAttributes()).filter(([X])=>t.schema.getAttributeProperties(X).isFormatting);N.isCollapsed||t.deleteContent(N,{doNotAutoparagraph:!0}),Z.push(...N.getAttributes());const Y=G.createRangeIn(K.content);for(const X of Y.getItems())for(const Q of Z)t.schema.checkAttribute(X,Q[0])&&G.setAttribute(Q[0],Q[1],X)})})}}function isUnformattedInlineContent(H,B){let t=B.createRangeIn(H);if(H.childCount==1){const V=H.getChild(0);V.is("element")&&B.schema.isBlock(V)&&!B.schema.isObject(V)&&!B.schema.isLimit(V)&&(t=B.createRangeIn(V))}for(const V of t.getItems())if(!B.schema.isInline(V)||Array.from(V.getAttributeKeys()).find(W=>B.schema.getAttributeProperties(W).isFormatting))return!1;return!0}class Clipboard extends Plugin{static get pluginName(){return"Clipboard"}static get requires(){return[ClipboardMarkersUtils,ClipboardPipeline,DragDrop,PastePlainText]}init(){const B=this.editor,t=this.editor.t;B.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Copy selected content"),keystroke:"CTRL+C"},{label:t("Paste content"),keystroke:"CTRL+V"},{label:t("Paste content as plain text"),keystroke:"CTRL+SHIFT+V"}]})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const DEFAULT_OPTIONS$1={autoRefresh:!0},DEFAULT_TOKEN_REFRESH_TIMEOUT_TIME=36e5,TOKEN_FAILED_REFRESH_TIMEOUT_TIME=5e3;class Token extends ObservableMixin(){constructor(t,V={}){super();ee(this,"_refresh");ee(this,"_options");ee(this,"_tokenRefreshTimeout");if(!t)throw new CKEditorError("token-missing-token-url",this);V.initValue&&this._validateTokenValue(V.initValue),this.set("value",V.initValue),typeof t=="function"?this._refresh=t:this._refresh=()=>defaultRefreshToken(t),this._options={...DEFAULT_OPTIONS$1,...V}}init(){return new Promise((t,V)=>{if(!this.value){this.refreshToken().then(t).catch(V);return}this._options.autoRefresh&&this._registerRefreshTokenTimeout(),t(this)})}refreshToken(){const t=this._options.autoRefresh;return this._refresh().then(V=>(this._validateTokenValue(V),this.set("value",V),t&&this._registerRefreshTokenTimeout(),this)).catch(V=>{throw logWarning("token-refresh-failed",{autoRefresh:t}),t&&this._registerRefreshTokenTimeout(TOKEN_FAILED_REFRESH_TIMEOUT_TIME),V})}destroy(){clearTimeout(this._tokenRefreshTimeout)}_validateTokenValue(t){const V=typeof t=="string",N=!/^".*"$/.test(t),W=V&&t.split(".").length===3;if(!(N&&W))throw new CKEditorError("token-not-in-jwt-format",this)}_registerRefreshTokenTimeout(t){const V=t||this._getTokenRefreshTimeoutTime();clearTimeout(this._tokenRefreshTimeout),this._tokenRefreshTimeout=setTimeout(()=>{this.refreshToken()},V)}_getTokenRefreshTimeoutTime(){try{const[,t]=this.value.split("."),{exp:V}=JSON.parse(atob(t));return V?Math.floor((V*1e3-Date.now())/2):DEFAULT_TOKEN_REFRESH_TIMEOUT_TIME}catch{return DEFAULT_TOKEN_REFRESH_TIMEOUT_TIME}}static create(t,V={}){return new Token(t,V).init()}}function defaultRefreshToken(H){return new Promise((B,t)=>{const V=new XMLHttpRequest;V.open("GET",H),V.addEventListener("load",()=>{const N=V.status,W=V.response;return N<200||N>299?t(new CKEditorError("token-cannot-download-new-token",null)):B(W)}),V.addEventListener("error",()=>t(new Error("Network Error"))),V.addEventListener("abort",()=>t(new Error("Abort"))),V.send()})}const BASE64_HEADER_REG_EXP=/^data:(\S*?);base64,/;class FileUploader extends EmitterMixin(){constructor(t,V,N){super();ee(this,"file");ee(this,"xhr");ee(this,"_token");ee(this,"_apiAddress");if(!t)throw new CKEditorError("fileuploader-missing-file",null);if(!V)throw new CKEditorError("fileuploader-missing-token",null);if(!N)throw new CKEditorError("fileuploader-missing-api-address",null);this.file=_isBase64(t)?_base64ToBlob(t):t,this._token=V,this._apiAddress=N}onProgress(t){return this.on("progress",(V,N)=>t(N)),this}onError(t){return this.once("error",(V,N)=>t(N)),this}abort(){this.xhr.abort()}send(){return this._prepareRequest(),this._attachXHRListeners(),this._sendRequest()}_prepareRequest(){const t=new XMLHttpRequest;t.open("POST",this._apiAddress),t.setRequestHeader("Authorization",this._token.value),t.responseType="json",this.xhr=t}_attachXHRListeners(){const t=this.xhr,V=N=>()=>this.fire("error",N);t.addEventListener("error",V("Network Error")),t.addEventListener("abort",V("Abort"));/* istanbul ignore else -- @preserve */t.upload&&t.upload.addEventListener("progress",N=>{N.lengthComputable&&this.fire("progress",{total:N.total,uploaded:N.loaded})}),t.addEventListener("load",()=>{const N=t.status,W=t.response;if(N<200||N>299)return this.fire("error",W.message||W.error)})}_sendRequest(){const t=new FormData,V=this.xhr;return t.append("file",this.file),new Promise((N,W)=>{V.addEventListener("load",()=>{const K=V.status,G=V.response;return K<200||K>299?G.message?W(new CKEditorError("fileuploader-uploading-data-failed",this,{message:G.message})):W(G.error):N(G)}),V.addEventListener("error",()=>W(new Error("Network Error"))),V.addEventListener("abort",()=>W(new Error("Abort"))),V.send(t)})}}function _base64ToBlob(H,B=512){try{const t=H.match(BASE64_HEADER_REG_EXP)[1],V=atob(H.replace(BASE64_HEADER_REG_EXP,"")),N=[];for(let W=0;W<V.length;W+=B){const K=V.slice(W,W+B),G=new Array(K.length);for(let Z=0;Z<K.length;Z++)G[Z]=K.charCodeAt(Z);N.push(new Uint8Array(G))}return new Blob(N,{type:t})}catch{throw new CKEditorError("fileuploader-decoding-image-data-error",null)}}function _isBase64(H){if(typeof H!="string")return!1;const B=H.match(BASE64_HEADER_REG_EXP);return!!(B&&B.length)}class UploadGateway{constructor(B,t){ee(this,"_token");ee(this,"_apiAddress");if(!B)throw new CKEditorError("uploadgateway-missing-token",null);if(!t)throw new CKEditorError("uploadgateway-missing-api-address",null);this._token=B,this._apiAddress=t}upload(B){return new FileUploader(B,this._token,this._apiAddress)}}class CloudServicesCore extends ContextPlugin{static get pluginName(){return"CloudServicesCore"}createToken(B,t){return new Token(B,t)}createUploadGateway(B,t){return new UploadGateway(B,t)}}class CloudServices extends ContextPlugin{constructor(){super(...arguments);ee(this,"tokenUrl");ee(this,"uploadUrl");ee(this,"webSocketUrl");ee(this,"bundleVersion");ee(this,"token",null);ee(this,"_tokens",new Map)}static get pluginName(){return"CloudServices"}static get requires(){return[CloudServicesCore]}async init(){const V=this.context.config.get("cloudServices")||{};for(const[W,K]of Object.entries(V))this[W]=K;if(!this.tokenUrl){this.token=null;return}const N=this.context.plugins.get("CloudServicesCore");this.token=await N.createToken(this.tokenUrl).init(),this._tokens.set(this.tokenUrl,this.token)}async registerTokenUrl(t){if(this._tokens.has(t))return this.getTokenFor(t);const N=await this.context.plugins.get("CloudServicesCore").createToken(t).init();return this._tokens.set(t,N),N}getTokenFor(t){const V=this._tokens.get(t);if(!V)throw new CKEditorError("cloudservices-token-not-registered",this);return V}destroy(){super.destroy();for(const t of this._tokens.values())t.destroy()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ClassicEditorUI extends EditorUI{constructor(t,V){super(t);ee(this,"view");ee(this,"_toolbarConfig");ee(this,"_elementReplacer");this.view=V,this._toolbarConfig=normalizeToolbarConfig(t.config.get("toolbar")),this._elementReplacer=new ElementReplacer,this.listenTo(t.editing.view,"scrollToTheSelection",this._handleScrollToTheSelectionWithStickyPanel.bind(this))}get element(){return this.view.element}init(t){const V=this.editor,N=this.view,W=V.editing.view,K=N.editable,G=W.document.getRoot();K.name=G.rootName,N.render();const Z=K.element;this.setEditableElement(K.name,Z),N.editable.bind("isFocused").to(this.focusTracker),W.attachDomRoot(Z),t&&this._elementReplacer.replace(t,this.element),this._initPlaceholder(),this._initToolbar(),N.menuBarView&&this._initMenuBar(N.menuBarView),this._initDialogPluginIntegration(),this._initContextualBalloonIntegration(),this.fire("ready")}destroy(){super.destroy();const t=this.view,V=this.editor.editing.view;this._elementReplacer.restore(),V.getDomRoot(t.editable.name)&&V.detachDomRoot(t.editable.name),t.destroy()}_initToolbar(){const t=this.view;t.stickyPanel.bind("isActive").to(this.focusTracker,"isFocused"),t.stickyPanel.limiterElement=t.element,t.stickyPanel.bind("viewportTopOffset").to(this,"viewportOffset",({top:V})=>V||0),t.toolbar.fillFromConfig(this._toolbarConfig,this.componentFactory),this.addToolbar(t.toolbar)}_initPlaceholder(){const t=this.editor,V=t.editing.view,N=V.document.getRoot(),W=t.sourceElement;let K;const G=t.config.get("placeholder");G&&(K=typeof G=="string"?G:G[this.view.editable.name]),!K&&W&&W.tagName.toLowerCase()==="textarea"&&(K=W.getAttribute("placeholder")),K&&(N.placeholder=K),enablePlaceholder({view:V,element:N,isDirectHost:!1,keepOnFocus:!0})}_initContextualBalloonIntegration(){if(!this.editor.plugins.has("ContextualBalloon"))return;const{stickyPanel:t}=this.view,V=this.editor.plugins.get("ContextualBalloon");V.on("getPositionOptions",W=>{const K=W.return;if(!K||!t.isSticky||!t.element)return;const G=new Rect(t.element).height,Z=typeof K.target=="function"?K.target():K.target,Y=typeof K.limiter=="function"?K.limiter():K.limiter;if(Z&&Y&&new Rect(Z).height>=new Rect(Y).height-G)return;const X={...K.viewportOffsetConfig},Q=(X.top||0)+G;W.return={...K,viewportOffsetConfig:{...X,top:Q}}},{priority:"low"});const N=()=>{V.visibleView&&V.updatePosition()};this.listenTo(t,"change:isSticky",N),this.listenTo(this.editor.ui,"change:viewportOffset",N)}_handleScrollToTheSelectionWithStickyPanel(t,V,N){const W=this.view.stickyPanel;if(W.isSticky){const K=new Rect(W.element).height;V.viewportOffset.top+=K}else{const K=()=>{this.editor.editing.view.scrollToTheSelection(N)};this.listenTo(W,"change:isSticky",K),setTimeout(()=>{this.stopListening(W,"change:isSticky",K)},20)}}_initDialogPluginIntegration(){if(!this.editor.plugins.has("Dialog"))return;const t=this.view.stickyPanel,V=this.editor.plugins.get("Dialog");V.on("show",()=>{const N=V.view;N.on("moveTo",(W,K)=>{if(!t.isSticky||N.wasMoved)return;const G=new Rect(t.contentPanelElement);K[1]<G.bottom+DialogView.defaultOffset&&(K[1]=G.bottom+DialogView.defaultOffset)},{priority:"high"})},{priority:"low"})}}class ClassicEditorUIView extends BoxedEditorUIView{constructor(t,V,N={}){super(t);ee(this,"stickyPanel");ee(this,"toolbar");ee(this,"editable");this.stickyPanel=new StickyPanelView(t),this.toolbar=new ToolbarView(t,{shouldGroupWhenFull:N.shouldToolbarGroupWhenFull}),N.useMenuBar&&(this.menuBarView=new MenuBarView(t)),this.editable=new InlineEditableUIView(t,V,void 0,{label:N.label})}render(){super.render(),this.menuBarView?this.stickyPanel.content.addMany([this.menuBarView,this.toolbar]):this.stickyPanel.content.add(this.toolbar),this.top.add(this.stickyPanel),this.main.add(this.editable)}}class ClassicEditor extends ElementApiMixin(Editor){constructor(t,V={}){if(!isElement(t)&&V.initialData!==void 0)throw new CKEditorError("editor-create-initial-data",null);super(V);ee(this,"ui");this.config.define("menuBar.isVisible",!1),this.config.get("initialData")===void 0&&this.config.set("initialData",getInitialData(t)),isElement(t)&&(this.sourceElement=t),this.model.document.createRoot();const N=!this.config.get("toolbar.shouldNotGroupWhenFull"),W=this.config.get("menuBar"),K=new ClassicEditorUIView(this.locale,this.editing.view,{shouldToolbarGroupWhenFull:N,useMenuBar:W.isVisible,label:this.config.get("label")});this.ui=new ClassicEditorUI(this,K),attachToForm(this)}destroy(){return this.sourceElement&&this.updateSourceElement(),this.ui.destroy(),super.destroy()}static create(t,V={}){return new Promise(N=>{const W=new this(t,V);N(W.initPlugins().then(()=>W.ui.init(isElement(t)?t:null)).then(()=>W.data.init(W.config.get("initialData"))).then(()=>W.fire("ready")).then(()=>W))})}}function getInitialData(H){return isElement(H)?getDataFromElement(H):H}function isElement(H){return isElement$1(H)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class SelectAllCommand extends Command{constructor(B){super(B),this.affectsData=!1}execute(){const B=this.editor.model,t=B.document.selection;let V=B.schema.getLimitElement(t);if(t.containsEntireContent(V)||!isSelectAllScope(B.schema,V))do if(V=V.parent,!V)return;while(!isSelectAllScope(B.schema,V));B.change(N=>{N.setSelection(V,"in")})}}function isSelectAllScope(H,B){return H.isLimit(B)&&(H.checkChild(B,"$text")||H.checkChild(B,"paragraph"))}const SELECT_ALL_KEYSTROKE=parseKeystroke("Ctrl+A");class SelectAllEditing extends Plugin{static get pluginName(){return"SelectAllEditing"}init(){const B=this.editor,t=B.t,N=B.editing.view.document;B.commands.add("selectAll",new SelectAllCommand(B)),this.listenTo(N,"keydown",(W,K)=>{getCode(K)===SELECT_ALL_KEYSTROKE&&(B.execute("selectAll"),K.preventDefault())}),B.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Select all"),keystroke:"CTRL+A"}]})}}var selectAllIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M.75 15.5a.75.75 0 0 1 .75.75V18l.008.09A.5.5 0 0 0 2 18.5h1.75a.75.75 0 1 1 0 1.5H1.5l-.144-.007a1.5 1.5 0 0 1-1.35-1.349L0 18.5v-2.25a.75.75 0 0 1 .75-.75zm18.5 0a.75.75 0 0 1 .75.75v2.25l-.007.144a1.5 1.5 0 0 1-1.349 1.35L18.5 20h-2.25a.75.75 0 1 1 0-1.5H18a.5.5 0 0 0 .492-.41L18.5 18v-1.75a.75.75 0 0 1 .75-.75zm-10.45 3c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm.45-5.5a.75.75 0 1 1 0 1.5h-8.5a.75.75 0 1 1 0-1.5h8.5zM1.3 11c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM1.3 7c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5h-2.5a.75.75 0 1 1 0-1.5h2.5zm-5 0a.75.75 0 1 1 0 1.5h-5.5a.75.75 0 0 1 0-1.5h5.5zm-6.5-5a.75.75 0 0 1 0 1.5H2a.5.5 0 0 0-.492.41L1.5 2v1.75a.75.75 0 0 1-1.5 0V1.5l.007-.144A1.5 1.5 0 0 1 1.356.006L1.5 0h2.25zM18.5 0l.144.007a1.5 1.5 0 0 1 1.35 1.349L20 1.5v2.25a.75.75 0 1 1-1.5 0V2l-.008-.09A.5.5 0 0 0 18 1.5h-1.75a.75.75 0 1 1 0-1.5h2.25zM8.8 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6z"/></svg>';class SelectAllUI extends Plugin{static get pluginName(){return"SelectAllUI"}init(){const B=this.editor;B.ui.componentFactory.add("selectAll",()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),B.ui.componentFactory.add("menuBar:selectAll",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(B){const t=this.editor,V=t.locale,N=t.commands.get("selectAll"),W=new B(t.locale),K=V.t;return W.set({label:K("Select all"),icon:selectAllIcon,keystroke:"Ctrl+A"}),W.bind("isEnabled").to(N,"isEnabled"),this.listenTo(W,"execute",()=>{t.execute("selectAll"),t.editing.view.focus()}),W}}class SelectAll extends Plugin{static get requires(){return[SelectAllEditing,SelectAllUI]}static get pluginName(){return"SelectAll"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class BaseCommand extends Command{constructor(t){super(t);ee(this,"_stack",[]);ee(this,"_createdBatches",new WeakSet);this.refresh(),this._isEnabledBasedOnSelection=!1,this.listenTo(t.data,"set",(V,N)=>{N[1]={...N[1]};const W=N[1];W.batchType||(W.batchType={isUndoable:!1})},{priority:"high"}),this.listenTo(t.data,"set",(V,N)=>{N[1].batchType.isUndoable||this.clearStack()})}refresh(){this.isEnabled=this._stack.length>0}get createdBatches(){return this._createdBatches}addBatch(t){const V=this.editor.model.document.selection,N={ranges:V.hasOwnRange?Array.from(V.getRanges()):[],isBackward:V.isBackward};this._stack.push({batch:t,selection:N}),this.refresh()}clearStack(){this._stack=[],this.refresh()}_restoreSelection(t,V,N){const W=this.editor.model,K=W.document,G=[],Z=t.map(X=>X.getTransformedByOperations(N)),Y=Z.flat();for(const X of Z){const Q=X.filter(te=>te.root!=K.graveyard).filter(te=>!isRangeContainedByAnyOtherRange(te,Y));Q.length&&(normalizeRanges(Q),G.push(Q[0]))}G.length&&W.change(X=>{X.setSelection(G,{backward:V})})}_undo(t,V){const N=this.editor.model,W=N.document;this._createdBatches.add(V);const K=t.operations.slice().filter(G=>G.isDocumentOperation);K.reverse();for(const G of K){const Z=G.baseVersion+1,Y=Array.from(W.history.getOperations(Z)),Q=transformSets([G.getReversed()],Y,{useRelations:!0,document:this.editor.model.document,padWithNoOps:!1,forceWeakRemove:!0}).operationsA;for(let te of Q){const ie=te.affectedSelectable;ie&&!N.canEditAt(ie)&&(te=new NoOperation(te.baseVersion)),V.addOperation(te),N.applyOperation(te),W.history.setOperationAsUndone(G,te)}}}}function normalizeRanges(H){H.sort((B,t)=>B.start.isBefore(t.start)?-1:1);for(let B=1;B<H.length;B++){const V=H[B-1].getJoined(H[B],!0);V&&(B--,H.splice(B,2,V))}}function isRangeContainedByAnyOtherRange(H,B){return B.some(t=>t!==H&&t.containsRange(H,!0))}class UndoCommand extends BaseCommand{execute(B=null){const t=B?this._stack.findIndex(W=>W.batch==B):this._stack.length-1,V=this._stack.splice(t,1)[0],N=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(N,()=>{this._undo(V.batch,N);const W=this.editor.model.document.history.getOperations(V.batch.baseVersion);this._restoreSelection(V.selection.ranges,V.selection.isBackward,W)}),this.fire("revert",V.batch,N),this.refresh()}}class RedoCommand extends BaseCommand{execute(){const B=this._stack.pop(),t=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(t,()=>{const N=B.batch.operations[B.batch.operations.length-1].baseVersion+1,W=this.editor.model.document.history.getOperations(N);this._restoreSelection(B.selection.ranges,B.selection.isBackward,W),this._undo(B.batch,t)}),this.refresh()}}class UndoEditing extends Plugin{constructor(){super(...arguments);ee(this,"_undoCommand");ee(this,"_redoCommand");ee(this,"_batchRegistry",new WeakSet)}static get pluginName(){return"UndoEditing"}init(){const t=this.editor,V=t.t;this._undoCommand=new UndoCommand(t),this._redoCommand=new RedoCommand(t),t.commands.add("undo",this._undoCommand),t.commands.add("redo",this._redoCommand),this.listenTo(t.model,"applyOperation",(N,W)=>{const K=W[0];if(!K.isDocumentOperation)return;const G=K.batch,Z=this._redoCommand.createdBatches.has(G),Y=this._undoCommand.createdBatches.has(G);this._batchRegistry.has(G)||(this._batchRegistry.add(G),G.isUndoable&&(Z?this._undoCommand.addBatch(G):Y||(this._undoCommand.addBatch(G),this._redoCommand.clearStack())))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",(N,W,K)=>{this._redoCommand.addBatch(K)}),t.keystrokes.set("CTRL+Z","undo"),t.keystrokes.set("CTRL+Y","redo"),t.keystrokes.set("CTRL+SHIFT+Z","redo"),t.accessibility.addKeystrokeInfos({keystrokes:[{label:V("Undo"),keystroke:"CTRL+Z"},{label:V("Redo"),keystroke:[["CTRL+Y"],["CTRL+SHIFT+Z"]]}]})}}class UndoUI extends Plugin{static get pluginName(){return"UndoUI"}init(){const B=this.editor,t=B.locale,V=B.t,N=t.uiLanguageDirection=="ltr"?icons.undo:icons.redo,W=t.uiLanguageDirection=="ltr"?icons.redo:icons.undo;this._addButtonsToFactory("undo",V("Undo"),"CTRL+Z",N),this._addButtonsToFactory("redo",V("Redo"),"CTRL+Y",W)}_addButtonsToFactory(B,t,V,N){const W=this.editor;W.ui.componentFactory.add(B,()=>{const K=this._createButton(ButtonView,B,t,V,N);return K.set({tooltip:!0}),K}),W.ui.componentFactory.add("menuBar:"+B,()=>this._createButton(MenuBarMenuListItemButtonView,B,t,V,N))}_createButton(B,t,V,N,W){const K=this.editor,G=K.locale,Z=K.commands.get(t),Y=new B(G);return Y.set({label:V,icon:W,keystroke:N}),Y.bind("isEnabled").to(Z,"isEnabled"),this.listenTo(Y,"execute",()=>{K.execute(t),K.editing.view.focus()}),Y}}class Undo extends Plugin{static get requires(){return[UndoEditing,UndoUI]}static get pluginName(){return"Undo"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Essentials extends Plugin{static get requires(){return[AccessibilityHelp,Clipboard,Enter,SelectAll,ShiftEnter,Typing,Undo]}static get pluginName(){return"Essentials"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class FontCommand extends Command{constructor(t,V){super(t);ee(this,"attributeKey");this.attributeKey=V}refresh(){const t=this.editor.model,V=t.document;this.value=V.selection.getAttribute(this.attributeKey),this.isEnabled=t.schema.checkAttributeInSelection(V.selection,this.attributeKey)}execute(t={}){const V=this.editor.model,W=V.document.selection,K=t.value,G=t.batch,Z=Y=>{if(W.isCollapsed)K?Y.setSelectionAttribute(this.attributeKey,K):Y.removeSelectionAttribute(this.attributeKey);else{const X=V.schema.getValidRanges(W.getRanges(),this.attributeKey);for(const Q of X)K?Y.setAttribute(this.attributeKey,K,Q):Y.removeAttribute(this.attributeKey,Q)}};G?V.enqueueChange(G,Y=>{Z(Y)}):V.change(Y=>{Z(Y)})}}const FONT_SIZE="fontSize",FONT_FAMILY="fontFamily",FONT_COLOR="fontColor";function buildDefinition(H,B){const t={model:{key:H,values:[]},view:{},upcastAlso:{}};for(const V of B)t.model.values.push(V.model),t.view[V.model]=V.view,V.upcastAlso&&(t.upcastAlso[V.model]=V.upcastAlso);return t}function renderUpcastAttribute(H){return B=>normalizeColorCode(B.getStyle(H))}function renderDowncastElement(H){return(B,{writer:t})=>t.createAttributeElement("span",{style:`${H}:${B}`},{priority:7})}function addColorSelectorToDropdown({dropdownView:H,colors:B,columns:t,removeButtonLabel:V,colorPickerLabel:N,documentColorsLabel:W,documentColorsCount:K,colorPickerViewConfig:G}){const Z=H.locale,Y=new ColorSelectorView(Z,{colors:B,columns:t,removeButtonLabel:V,colorPickerLabel:N,documentColorsLabel:W,documentColorsCount:K,colorPickerViewConfig:G});return H.colorSelectorView=Y,H.panelView.children.add(Y),Y}function normalizeColorCode(H){return H.replace(/\s/g,"")}class FontFamilyCommand extends FontCommand{constructor(B){super(B,FONT_FAMILY)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function normalizeOptions$1(H){return H.map(getOptionDefinition$1).filter(B=>B!==void 0)}function getOptionDefinition$1(H){if(typeof H=="object")return H;if(H==="default")return{title:"Default",model:void 0};if(typeof H=="string")return generateFontPreset(H)}function generateFontPreset(H){const B=H.replace(/"|'/g,"").split(","),t=B[0],V=B.map(normalizeFontNameForCSS).join(", ");return{title:t,model:V,view:{name:"span",styles:{"font-family":V},priority:7}}}function normalizeFontNameForCSS(H){return H=H.trim(),H.indexOf(" ")>0&&(H=`'${H}'`),H}class FontFamilyEditing extends Plugin{static get pluginName(){return"FontFamilyEditing"}constructor(B){super(B),B.config.define(FONT_FAMILY,{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!1})}init(){const B=this.editor;B.model.schema.extend("$text",{allowAttributes:FONT_FAMILY}),B.model.schema.setAttributeProperties(FONT_FAMILY,{isFormatting:!0,copyOnEnter:!0});const t=normalizeOptions$1(B.config.get("fontFamily.options")).filter(N=>N.model),V=buildDefinition(FONT_FAMILY,t);B.config.get("fontFamily.supportAllValues")?(this._prepareAnyValueConverters(),this._prepareCompatibilityConverter()):B.conversion.attributeToElement(V),B.commands.add(FONT_FAMILY,new FontFamilyCommand(B))}_prepareAnyValueConverters(){const B=this.editor;B.conversion.for("downcast").attributeToElement({model:FONT_FAMILY,view:(t,{writer:V})=>V.createAttributeElement("span",{style:"font-family:"+t},{priority:7})}),B.conversion.for("upcast").elementToAttribute({model:{key:FONT_FAMILY,value:t=>t.getStyle("font-family")},view:{name:"span",styles:{"font-family":/.*/}}})}_prepareCompatibilityConverter(){this.editor.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{face:/.*/}},model:{key:FONT_FAMILY,value:t=>t.getAttribute("face")}})}}var fontFamilyIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.03 3h6.149a.75.75 0 1 1 0 1.5h-5.514L11.03 3zm1.27 3h4.879a.75.75 0 1 1 0 1.5h-4.244L12.3 6zm1.27 3h3.609a.75.75 0 1 1 0 1.5h-2.973L13.57 9zm-2.754 2.5L8.038 4.785 5.261 11.5h5.555zm.62 1.5H4.641l-1.666 4.028H1.312l5.789-14h1.875l5.789 14h-1.663L11.436 13z"/></svg>';class FontFamilyUI extends Plugin{static get pluginName(){return"FontFamilyUI"}init(){const B=this.editor,t=B.t,V=this._getLocalizedOptions(),N=B.commands.get(FONT_FAMILY),W=t("Font Family"),K=_prepareListOptions$1(V,N);B.ui.componentFactory.add(FONT_FAMILY,G=>{const Z=createDropdown(G);return addListToDropdown(Z,K,{role:"menu",ariaLabel:W}),Z.buttonView.set({label:W,icon:fontFamilyIcon,tooltip:!0}),Z.extendTemplate({attributes:{class:"ck-font-family-dropdown"}}),Z.bind("isEnabled").to(N),this.listenTo(Z,"execute",Y=>{B.execute(Y.source.commandName,{value:Y.source.commandParam}),B.editing.view.focus()}),Z}),B.ui.componentFactory.add(`menuBar:${FONT_FAMILY}`,G=>{const Z=new MenuBarMenuView(G);Z.buttonView.set({label:W,icon:fontFamilyIcon}),Z.bind("isEnabled").to(N);const Y=new MenuBarMenuListView(G);for(const X of K){const Q=new MenuBarMenuListItemView(G,Z),te=new MenuBarMenuListItemButtonView(G);te.set({role:"menuitemradio",isToggleable:!0}),te.bind(...Object.keys(X.model)).to(X.model),te.delegate("execute").to(Z),te.on("execute",()=>{B.execute(X.model.commandName,{value:X.model.commandParam}),B.editing.view.focus()}),Q.children.add(te),Y.items.add(Q)}return Z.panelView.children.add(Y),Z})}_getLocalizedOptions(){const B=this.editor,t=B.t;return normalizeOptions$1(B.config.get(FONT_FAMILY).options).map(N=>(N.title==="Default"&&(N.title=t("Default")),N))}}function _prepareListOptions$1(H,B){const t=new Collection;for(const V of H){const N={type:"button",model:new Model({commandName:FONT_FAMILY,commandParam:V.model,label:V.title,role:"menuitemradio",withText:!0})};N.model.bind("isOn").to(B,"value",W=>W===V.model?!0:!W||!V.model?!1:W.split(",")[0].replace(/'/g,"").toLowerCase()===V.model.toLowerCase()),V.view&&typeof V.view!="string"&&V.view.styles&&N.model.set("labelStyle",`font-family: ${V.view.styles["font-family"]}`),t.add(N)}return t}class FontFamily extends Plugin{static get requires(){return[FontFamilyEditing,FontFamilyUI]}static get pluginName(){return"FontFamily"}}class FontSizeCommand extends FontCommand{constructor(B){super(B,FONT_SIZE)}}function normalizeOptions(H){return H.map(B=>getOptionDefinition(B)).filter(B=>B!==void 0)}const namedPresets={get tiny(){return{title:"Tiny",model:"tiny",view:{name:"span",classes:"text-tiny",priority:7}}},get small(){return{title:"Small",model:"small",view:{name:"span",classes:"text-small",priority:7}}},get big(){return{title:"Big",model:"big",view:{name:"span",classes:"text-big",priority:7}}},get huge(){return{title:"Huge",model:"huge",view:{name:"span",classes:"text-huge",priority:7}}}};function getOptionDefinition(H){if(typeof H=="number"&&(H=String(H)),typeof H=="object"&&isFullItemDefinition(H))return attachPriority(H);const B=findPreset(H);if(B)return attachPriority(B);if(H==="default")return{model:void 0,title:"Default"};if(!isNumericalDefinition(H))return generatePixelPreset(H)}function generatePixelPreset(H){return typeof H=="string"&&(H={title:H,model:`${parseFloat(H)}px`}),H.view={name:"span",styles:{"font-size":H.model}},attachPriority(H)}function attachPriority(H){return H.view&&typeof H.view!="string"&&!H.view.priority&&(H.view.priority=7),H}function findPreset(H){return typeof H=="string"?namedPresets[H]:namedPresets[H.model]}function isFullItemDefinition(H){return H.title&&H.model&&H.view}function isNumericalDefinition(H){let B;if(typeof H=="object")if(H.model)B=parseFloat(H.model);else throw new CKEditorError("font-size-invalid-definition",null,H);else B=parseFloat(H);return isNaN(B)}const styleFontSize=["x-small","x-small","small","medium","large","x-large","xx-large","xxx-large"];class FontSizeEditing extends Plugin{static get pluginName(){return"FontSizeEditing"}constructor(B){super(B),B.config.define(FONT_SIZE,{options:["tiny","small","default","big","huge"],supportAllValues:!1})}init(){const B=this.editor;B.model.schema.extend("$text",{allowAttributes:FONT_SIZE}),B.model.schema.setAttributeProperties(FONT_SIZE,{isFormatting:!0,copyOnEnter:!0});const t=B.config.get("fontSize.supportAllValues"),V=normalizeOptions(this.editor.config.get("fontSize.options")).filter(W=>W.model),N=buildDefinition(FONT_SIZE,V);t?(this._prepareAnyValueConverters(N),this._prepareCompatibilityConverter()):B.conversion.attributeToElement(N),B.commands.add(FONT_SIZE,new FontSizeCommand(B))}_prepareAnyValueConverters(B){const t=this.editor,V=B.model.values.filter(N=>!isLength(String(N))&&!isPercentage(String(N)));if(V.length)throw new CKEditorError("font-size-invalid-use-of-named-presets",null,{presets:V});t.conversion.for("downcast").attributeToElement({model:FONT_SIZE,view:(N,{writer:W})=>{if(N)return W.createAttributeElement("span",{style:"font-size:"+N},{priority:7})}}),t.conversion.for("upcast").elementToAttribute({model:{key:FONT_SIZE,value:N=>N.getStyle("font-size")},view:{name:"span",styles:{"font-size":/.*/}}})}_prepareCompatibilityConverter(){this.editor.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{size:/^[+-]?\d{1,3}$/}},model:{key:FONT_SIZE,value:t=>{const V=t.getAttribute("size"),N=V[0]==="-"||V[0]==="+";let W=parseInt(V,10);N&&(W=3+W);const K=styleFontSize.length-1,G=Math.min(Math.max(W,0),K);return styleFontSize[G]}}})}}var fontSizeIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.816 11.5 7.038 4.785 4.261 11.5h5.555zm.62 1.5H3.641l-1.666 4.028H.312l5.789-14h1.875l5.789 14h-1.663L10.436 13zm7.55 2.279.779-.779.707.707-2.265 2.265-2.193-2.265.707-.707.765.765V4.825c0-.042 0-.083.002-.123l-.77.77-.707-.707L17.207 2.5l2.265 2.265-.707.707-.782-.782c.002.043.003.089.003.135v10.454z"/></svg>';class FontSizeUI extends Plugin{static get pluginName(){return"FontSizeUI"}init(){const B=this.editor,t=B.t,V=this._getLocalizedOptions(),N=B.commands.get(FONT_SIZE),W=t("Font Size"),K=_prepareListOptions(V,N);B.ui.componentFactory.add(FONT_SIZE,G=>{const Z=createDropdown(G);return addListToDropdown(Z,K,{role:"menu",ariaLabel:W}),Z.buttonView.set({label:W,icon:fontSizeIcon,tooltip:!0}),Z.extendTemplate({attributes:{class:["ck-font-size-dropdown"]}}),Z.bind("isEnabled").to(N),this.listenTo(Z,"execute",Y=>{B.execute(Y.source.commandName,{value:Y.source.commandParam}),B.editing.view.focus()}),Z}),B.ui.componentFactory.add(`menuBar:${FONT_SIZE}`,G=>{const Z=new MenuBarMenuView(G);Z.buttonView.set({label:W,icon:fontSizeIcon}),Z.bind("isEnabled").to(N);const Y=new MenuBarMenuListView(G);for(const X of K){const Q=new MenuBarMenuListItemView(G,Z),te=new MenuBarMenuListItemButtonView(G);te.set({role:"menuitemradio",isToggleable:!0}),te.bind(...Object.keys(X.model)).to(X.model),te.delegate("execute").to(Z),te.on("execute",()=>{B.execute(X.model.commandName,{value:X.model.commandParam}),B.editing.view.focus()}),Q.children.add(te),Y.items.add(Q)}return Z.panelView.children.add(Y),Z})}_getLocalizedOptions(){const B=this.editor,t=B.t,V={Default:t("Default"),Tiny:t("Tiny"),Small:t("Small"),Big:t("Big"),Huge:t("Huge")};return normalizeOptions(B.config.get(FONT_SIZE).options).map(W=>{const K=V[W.title];return K&&K!=W.title&&(W=Object.assign({},W,{title:K})),W})}}function _prepareListOptions(H,B){const t=new Collection;for(const V of H){const N={type:"button",model:new Model({commandName:FONT_SIZE,commandParam:V.model,label:V.title,class:"ck-fontsize-option",role:"menuitemradio",withText:!0})};V.view&&typeof V.view!="string"&&(V.view.styles&&N.model.set("labelStyle",`font-size:${V.view.styles["font-size"]}`),V.view.classes&&N.model.set("class",`${N.model.class} ${V.view.classes}`)),N.model.bind("isOn").to(B,"value",W=>W===V.model),t.add(N)}return t}class FontSize extends Plugin{static get requires(){return[FontSizeEditing,FontSizeUI]}static get pluginName(){return"FontSize"}normalizeSizeOptions(B){return normalizeOptions(B)}}class FontColorCommand extends FontCommand{constructor(B){super(B,FONT_COLOR)}}class FontColorEditing extends Plugin{static get pluginName(){return"FontColorEditing"}constructor(B){super(B),B.config.define(FONT_COLOR,{colors:[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}],columns:5}),B.conversion.for("upcast").elementToAttribute({view:{name:"span",styles:{color:/[\s\S]+/}},model:{key:FONT_COLOR,value:renderUpcastAttribute("color")}}),B.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{color:/^#?\w+$/}},model:{key:FONT_COLOR,value:t=>t.getAttribute("color")}}),B.conversion.for("downcast").attributeToElement({model:FONT_COLOR,view:renderDowncastElement("color")}),B.commands.add(FONT_COLOR,new FontColorCommand(B)),B.model.schema.extend("$text",{allowAttributes:FONT_COLOR}),B.model.schema.setAttributeProperties(FONT_COLOR,{isFormatting:!0,copyOnEnter:!0})}}class ColorUI extends Plugin{constructor(t,{commandName:V,componentName:N,icon:W,dropdownLabel:K}){super(t);ee(this,"commandName");ee(this,"componentName");ee(this,"icon");ee(this,"dropdownLabel");ee(this,"columns");this.commandName=V,this.componentName=N,this.icon=W,this.dropdownLabel=K,this.columns=t.config.get(`${this.componentName}.columns`)}init(){const t=this.editor,V=t.locale,N=V.t,W=t.commands.get(this.commandName),K=t.config.get(this.componentName),G=normalizeColorOptions(K.colors),Z=getLocalizedColorOptions(V,G),Y=K.documentColors,X=K.colorPicker!==!1;t.ui.componentFactory.add(this.componentName,Q=>{const te=createDropdown(Q);let ie=!1;const ne=addColorSelectorToDropdown({dropdownView:te,colors:Z.map(le=>({label:le.label,color:le.model,options:{hasBorder:le.hasBorder}})),columns:this.columns,removeButtonLabel:N("Remove color"),colorPickerLabel:N("Color picker"),documentColorsLabel:Y!==0?N("Document colors"):"",documentColorsCount:Y===void 0?this.columns:Y,colorPickerViewConfig:X?K.colorPicker||{}:!1});return ne.bind("selectedColor").to(W,"value"),te.buttonView.set({label:this.dropdownLabel,icon:this.icon,tooltip:!0}),te.extendTemplate({attributes:{class:"ck-color-ui-dropdown"}}),te.bind("isEnabled").to(W),ne.on("execute",(le,ae)=>{te.isOpen&&t.execute(this.commandName,{value:ae.value,batch:this._undoStepBatch}),ae.source!=="colorPicker"&&t.editing.view.focus(),ae.source==="colorPickerSaveButton"&&(te.isOpen=!1)}),ne.on("colorPicker:show",()=>{this._undoStepBatch=t.model.createBatch()}),ne.on("colorPicker:cancel",()=>{this._undoStepBatch.operations.length&&(te.isOpen=!1,t.execute("undo",this._undoStepBatch)),t.editing.view.focus()}),te.on("change:isOpen",(le,ae,de)=>{ie||(ie=!0,te.colorSelectorView.appendUI()),de&&(Y!==0&&ne.updateDocumentColors(t.model,this.componentName),ne.updateSelectedColors(),ne.showColorGridsFragment())}),focusChildOnDropdownOpen(te,()=>te.colorSelectorView.colorGridsFragmentView.staticColorsGrid.items.find(le=>le.isOn)),te}),t.ui.componentFactory.add(`menuBar:${this.componentName}`,Q=>{const te=new MenuBarMenuView(Q);te.buttonView.set({label:this.dropdownLabel,icon:this.icon}),te.bind("isEnabled").to(W);let ie=!1;const ne=new ColorSelectorView(Q,{colors:Z.map(le=>({label:le.label,color:le.model,options:{hasBorder:le.hasBorder}})),columns:this.columns,removeButtonLabel:N("Remove color"),colorPickerLabel:N("Color picker"),documentColorsLabel:Y!==0?N("Document colors"):"",documentColorsCount:Y===void 0?this.columns:Y,colorPickerViewConfig:!1});return ne.bind("selectedColor").to(W,"value"),ne.delegate("execute").to(te),ne.on("execute",(le,ae)=>{t.execute(this.commandName,{value:ae.value,batch:this._undoStepBatch}),t.editing.view.focus()}),te.on("change:isOpen",(le,ae,de)=>{ie||(ie=!0,ne.appendUI()),de&&(Y!==0&&ne.updateDocumentColors(t.model,this.componentName),ne.updateSelectedColors(),ne.showColorGridsFragment())}),te.panelView.children.add(ne),te})}}var fontColorIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.4 10.3 10 4.5l-2.4 5.8h4.8zm.5 1.2H7.1L5.7 15H4.2l5-12h1.6l5 12h-1.5L13 11.5zm3.1 7H4a1 1 0 0 1 0-2h12a1 1 0 0 1 0 2z"/></svg>';class FontColorUI extends ColorUI{constructor(B){const t=B.locale.t;super(B,{commandName:FONT_COLOR,componentName:FONT_COLOR,icon:fontColorIcon,dropdownLabel:t("Font Color")})}static get pluginName(){return"FontColorUI"}}class FontColor extends Plugin{static get requires(){return[FontColorEditing,FontColorUI]}static get pluginName(){return"FontColor"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ParagraphCommand extends Command{constructor(B){super(B),this._isEnabledBasedOnSelection=!1}refresh(){const B=this.editor.model,t=B.document,V=first(t.selection.getSelectedBlocks());this.value=!!V&&V.is("element","paragraph"),this.isEnabled=!!V&&checkCanBecomeParagraph(V,B.schema)}execute(B={}){const t=this.editor.model,V=t.document,N=B.selection||V.selection;t.canEditAt(N)&&t.change(W=>{const K=N.getSelectedBlocks();for(const G of K)!G.is("element","paragraph")&&checkCanBecomeParagraph(G,t.schema)&&W.rename(G,"paragraph")})}}function checkCanBecomeParagraph(H,B){return B.checkChild(H.parent,"paragraph")&&!B.isObject(H)}class InsertParagraphCommand extends Command{constructor(B){super(B),this._isEnabledBasedOnSelection=!1}execute(B){const t=this.editor.model,V=B.attributes;let N=B.position;t.canEditAt(N)&&t.change(W=>{if(N=this._findPositionToInsertParagraph(N,W),!N)return;const K=W.createElement("paragraph");V&&t.schema.setAllowedAttributes(K,V,W),t.insertContent(K,N),W.setSelection(K,"in")})}_findPositionToInsertParagraph(B,t){const V=this.editor.model;if(V.schema.checkChild(B,"paragraph"))return B;const N=V.schema.findAllowedParent(B,"paragraph");if(!N)return null;const W=B.parent,K=V.schema.checkChild(W,"$text");return W.isEmpty||K&&B.isAtEnd?V.createPositionAfter(W):!W.isEmpty&&K&&B.isAtStart?V.createPositionBefore(W):t.split(B,N).position}}const lt=class lt extends Plugin{static get pluginName(){return"Paragraph"}init(){const B=this.editor,t=B.model;B.commands.add("paragraph",new ParagraphCommand(B)),B.commands.add("insertParagraph",new InsertParagraphCommand(B)),t.schema.register("paragraph",{inheritAllFrom:"$block"}),B.conversion.elementToElement({model:"paragraph",view:"p"}),B.conversion.for("upcast").elementToElement({model:(V,{writer:N})=>!lt.paragraphLikeElements.has(V.name)||V.isEmpty?null:N.createElement("paragraph"),view:/.+/,converterPriority:"low"})}};ee(lt,"paragraphLikeElements",new Set(["blockquote","dd","div","dt","h1","h2","h3","h4","h5","h6","li","p","td","th"]));let Paragraph=lt;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HeadingCommand extends Command{constructor(t,V){super(t);ee(this,"modelElements");this.modelElements=V}refresh(){const t=first(this.editor.model.document.selection.getSelectedBlocks());this.value=!!t&&this.modelElements.includes(t.name)&&t.name,this.isEnabled=!!t&&this.modelElements.some(V=>checkCanBecomeHeading(t,V,this.editor.model.schema))}execute(t){const V=this.editor.model,N=V.document,W=t.value;V.change(K=>{const G=Array.from(N.selection.getSelectedBlocks()).filter(Z=>checkCanBecomeHeading(Z,W,V.schema));for(const Z of G)Z.is("element",W)||K.rename(Z,W)})}}function checkCanBecomeHeading(H,B,t){return t.checkChild(H.parent,B)&&!t.isObject(H)}const defaultModelElement="paragraph";class HeadingEditing extends Plugin{static get pluginName(){return"HeadingEditing"}constructor(B){super(B),B.config.define("heading",{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h4",title:"Heading 3",class:"ck-heading_heading3"}]})}static get requires(){return[Paragraph]}init(){const B=this.editor,t=B.config.get("heading.options"),V=[];for(const N of t)N.model!=="paragraph"&&(B.model.schema.register(N.model,{inheritAllFrom:"$block"}),B.conversion.elementToElement(N),V.push(N.model));this._addDefaultH1Conversion(B),B.commands.add("heading",new HeadingCommand(B,V))}afterInit(){const B=this.editor,t=B.commands.get("enter"),V=B.config.get("heading.options");t&&this.listenTo(t,"afterExecute",(N,W)=>{const K=B.model.document.selection.getFirstPosition().parent;V.some(Z=>K.is("element",Z.model))&&!K.is("element",defaultModelElement)&&K.childCount===0&&W.writer.rename(K,defaultModelElement)})}_addDefaultH1Conversion(B){B.conversion.for("upcast").elementToElement({model:"heading1",view:"h1",converterPriority:priorities.low+1})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getLocalizedOptions(H){const B=H.t,t={Paragraph:B("Paragraph"),"Heading 1":B("Heading 1"),"Heading 2":B("Heading 2"),"Heading 3":B("Heading 3"),"Heading 4":B("Heading 4"),"Heading 5":B("Heading 5"),"Heading 6":B("Heading 6")};return H.config.get("heading.options").map(V=>{const N=t[V.title];return N&&N!=V.title&&(V.title=N),V})}class HeadingUI extends Plugin{static get pluginName(){return"HeadingUI"}init(){const B=this.editor,t=B.t,V=getLocalizedOptions(B),N=t("Choose heading"),W=t("Heading");B.ui.componentFactory.add("heading",K=>{const G={},Z=new Collection,Y=B.commands.get("heading"),X=B.commands.get("paragraph"),Q=[Y];for(const ie of V){const ne={type:"button",model:new Model({label:ie.title,class:ie.class,role:"menuitemradio",withText:!0})};ie.model==="paragraph"?(ne.model.bind("isOn").to(X,"value"),ne.model.set("commandName","paragraph"),Q.push(X)):(ne.model.bind("isOn").to(Y,"value",le=>le===ie.model),ne.model.set({commandName:"heading",commandValue:ie.model})),Z.add(ne),G[ie.model]=ie.title}const te=createDropdown(K);return addListToDropdown(te,Z,{ariaLabel:W,role:"menu"}),te.buttonView.set({ariaLabel:W,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:W}),te.extendTemplate({attributes:{class:["ck-heading-dropdown"]}}),te.bind("isEnabled").toMany(Q,"isEnabled",(...ie)=>ie.some(ne=>ne)),te.buttonView.bind("label").to(Y,"value",X,"value",(ie,ne)=>{const le=ne?"paragraph":ie;return typeof le=="boolean"||!G[le]?N:G[le]}),te.buttonView.bind("ariaLabel").to(Y,"value",X,"value",(ie,ne)=>{const le=ne?"paragraph":ie;return typeof le=="boolean"||!G[le]?W:`${G[le]}, ${W}`}),this.listenTo(te,"execute",ie=>{const{commandName:ne,commandValue:le}=ie.source;B.execute(ne,le?{value:le}:void 0),B.editing.view.focus()}),te}),B.ui.componentFactory.add("menuBar:heading",K=>{const G=new MenuBarMenuView(K),Z=B.commands.get("heading"),Y=B.commands.get("paragraph"),X=[Z],Q=new MenuBarMenuListView(K);G.set({class:"ck-heading-dropdown"}),Q.set({ariaLabel:t("Heading"),role:"menu"}),G.buttonView.set({label:t("Heading")}),G.panelView.children.add(Q);for(const te of V){const ie=new MenuBarMenuListItemView(K,G),ne=new MenuBarMenuListItemButtonView(K);ie.children.add(ne),Q.items.add(ie),ne.set({isToggleable:!0,label:te.title,role:"menuitemradio",class:te.class}),ne.delegate("execute").to(G),ne.on("execute",()=>{const le=te.model==="paragraph"?"paragraph":"heading";B.execute(le,{value:te.model}),B.editing.view.focus()}),te.model==="paragraph"?(ne.bind("isOn").to(Y,"value"),X.push(Y)):ne.bind("isOn").to(Z,"value",le=>le===te.model)}return G.bind("isEnabled").toMany(X,"isEnabled",(...te)=>te.some(ie=>ie)),G})}}class Heading extends Plugin{static get requires(){return[HeadingEditing,HeadingUI]}static get pluginName(){return"Heading"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HorizontalLineCommand extends Command{refresh(){const B=this.editor.model,t=B.schema,V=B.document.selection;this.isEnabled=isHorizontalLineAllowedInParent(V,t,B)}execute(){const B=this.editor.model;B.change(t=>{const V=t.createElement("horizontalLine");B.insertObject(V,null,null,{setSelection:"after"})})}}function isHorizontalLineAllowedInParent(H,B,t){const V=getInsertHorizontalLineParent(H,t);return B.checkChild(V,"horizontalLine")}function getInsertHorizontalLineParent(H,B){const V=findOptimalInsertionRange(H,B).start.parent;return V.isEmpty&&!V.is("element","$root")?V.parent:V}class HorizontalLineEditing extends Plugin{static get pluginName(){return"HorizontalLineEditing"}init(){const B=this.editor,t=B.model.schema,V=B.t,N=B.conversion;t.register("horizontalLine",{inheritAllFrom:"$blockObject"}),N.for("dataDowncast").elementToElement({model:"horizontalLine",view:(W,{writer:K})=>K.createEmptyElement("hr")}),N.for("editingDowncast").elementToStructure({model:"horizontalLine",view:(W,{writer:K})=>{const G=V("Horizontal line"),Z=K.createContainerElement("div",null,K.createEmptyElement("hr"));return K.addClass("ck-horizontal-line",Z),K.setCustomProperty("hr",!0,Z),toHorizontalLineWidget(Z,K,G)}}),N.for("upcast").elementToElement({view:"hr",model:"horizontalLine"}),B.commands.add("horizontalLine",new HorizontalLineCommand(B))}}function toHorizontalLineWidget(H,B,t){return B.setCustomProperty("horizontalLine",!0,H),toWidget(H,B,{label:t})}class HorizontalLineUI extends Plugin{static get pluginName(){return"HorizontalLineUI"}init(){const B=this.editor;B.ui.componentFactory.add("horizontalLine",()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),B.ui.componentFactory.add("menuBar:horizontalLine",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(B){const t=this.editor,V=t.locale,N=t.commands.get("horizontalLine"),W=new B(t.locale),K=V.t;return W.set({label:K("Horizontal line"),icon:icons.horizontalLine}),W.bind("isEnabled").to(N,"isEnabled"),this.listenTo(W,"execute",()=>{t.execute("horizontalLine"),t.editing.view.focus()}),W}}class HorizontalLine extends Plugin{static get requires(){return[HorizontalLineEditing,HorizontalLineUI,Widget]}static get pluginName(){return"HorizontalLine"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function updateViewAttributes(H,B,t,V){B&&removeViewAttributes(H,B,V),t&&setViewAttributes(H,t,V)}function setViewAttributes(H,B,t){if(B.attributes)for(const[V,N]of Object.entries(B.attributes))H.setAttribute(V,N,t);B.styles&&H.setStyle(B.styles,t),B.classes&&H.addClass(B.classes,t)}function removeViewAttributes(H,B,t){if(B.attributes)for(const[V]of Object.entries(B.attributes))H.removeAttribute(V,t);if(B.styles)for(const V of Object.keys(B.styles))H.removeStyle(V,t);B.classes&&H.removeClass(B.classes,t)}function mergeViewElementAttributes(H,B){const t=cloneDeep(H);let V="attributes";for(V in B)V=="classes"?t[V]=Array.from(new Set([...H[V]||[],...B[V]])):t[V]={...H[V],...B[V]};return t}function modifyGhsAttribute(H,B,t,V,N){const W=B.getAttribute(t),K={};for(const G of["attributes","styles","classes"]){if(G!=V){W&&W[G]&&(K[G]=W[G]);continue}if(V=="classes"){const Y=new Set(W&&W.classes||[]);N(Y),Y.size&&(K[G]=Array.from(Y));continue}const Z=new Map(Object.entries(W&&W[G]||{}));N(Z),Z.size&&(K[G]=Object.fromEntries(Z))}Object.keys(K).length?B.is("documentSelection")?H.setSelectionAttribute(t,K):H.setAttribute(t,K,B):W&&(B.is("documentSelection")?H.removeSelectionAttribute(t):H.removeAttribute(t,B))}function toPascalCase(H){return startCase(H).replace(/ /g,"")}function getHtmlAttributeName(H){return`html${toPascalCase(H)}Attributes`}function viewToModelObjectConverter({model:H}){return(B,t)=>t.writer.createElement(H,{htmlContent:B.getCustomProperty("$rawContent")})}function toObjectWidgetConverter(H,{view:B,isInline:t}){const V=H.t;return(N,{writer:W})=>{const K=V("HTML object"),G=createObjectView(B,N,W),Z=N.getAttribute(getHtmlAttributeName(B));W.addClass("html-object-embed__content",G),Z&&setViewAttributes(W,Z,G);const Y=W.createContainerElement(t?"span":"div",{class:"html-object-embed","data-html-object-embed-label":K},G);return toWidget(Y,W,{label:K})}}function createObjectView(H,B,t){return t.createRawElement(H,null,(V,N)=>{N.setContentOf(V,B.getAttribute("htmlContent"))})}function viewToAttributeInlineConverter({view:H,model:B,allowEmpty:t},V){return W=>{W.on(`element:${H}`,(K,G,Z)=>{let Y=V.processViewAttributes(G.viewItem,Z);if(!(!Y&&!Z.consumable.test(G.viewItem,{name:!0}))){if(Y=Y||{},Z.consumable.consume(G.viewItem,{name:!0}),G.modelRange||(G=Object.assign(G,Z.convertChildren(G.viewItem,G.modelCursor))),t&&G.modelRange.isCollapsed&&Object.keys(Y).length){const X=Z.writer.createElement("htmlEmptyElement");if(!Z.safeInsert(X,G.modelCursor))return;const Q=Z.getSplitParts(X);G.modelRange=Z.writer.createRange(G.modelRange.start,Z.writer.createPositionAfter(Q[Q.length-1])),Z.updateConversionResult(X,G),N(X,Y,Z);return}for(const X of G.modelRange.getItems())N(X,Y,Z)}},{priority:"low"})};function N(W,K,G){if(G.schema.checkAttribute(W,B)){const Z=W.getAttribute(B),Y=mergeViewElementAttributes(K,Z||{});G.writer.setAttribute(B,Y,W)}}}function emptyInlineModelElementToViewConverter({model:H,view:B},t){return(V,{writer:N,consumable:W})=>{if(!V.hasAttribute(H))return null;const K=N.createContainerElement(B),G=V.getAttribute(H);return W.consume(V,`attribute:${H}`),setViewAttributes(N,G,K),K.getFillerOffset=()=>null,t?toWidget(K,N):K}}function attributeToViewInlineConverter({priority:H,view:B}){return(t,V)=>{if(!t)return;const{writer:N}=V,W=N.createAttributeElement(B,null,{priority:H});return setViewAttributes(N,t,W),W}}function viewToModelBlockAttributeConverter({view:H},B){return t=>{t.on(`element:${H}`,(V,N,W)=>{if(!N.modelRange||N.modelRange.isCollapsed)return;const K=B.processViewAttributes(N.viewItem,W);K&&W.writer.setAttribute(getHtmlAttributeName(N.viewItem.name),K,N.modelRange)},{priority:"low"})}}function modelToViewBlockAttributeConverter({view:H,model:B}){return t=>{t.on(`attribute:${getHtmlAttributeName(H)}:${B}`,(V,N,W)=>{if(!W.consumable.consume(N.item,V.name))return;const{attributeOldValue:K,attributeNewValue:G}=N,Z=W.writer,Y=W.mapper.toViewElement(N.item);updateViewAttributes(Z,K,G,Y)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */var defaultConfig={block:[{model:"codeBlock",view:"pre"},{model:"paragraph",view:"p"},{model:"blockQuote",view:"blockquote"},{model:"listItem",view:"li"},{model:"pageBreak",view:"div"},{model:"rawHtml",view:"div"},{model:"table",view:"table"},{model:"tableRow",view:"tr"},{model:"tableCell",view:"td"},{model:"tableCell",view:"th"},{model:"tableColumnGroup",view:"colgroup"},{model:"tableColumn",view:"col"},{model:"caption",view:"caption"},{model:"caption",view:"figcaption"},{model:"imageBlock",view:"img"},{model:"imageInline",view:"img"},{model:"htmlP",view:"p",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlBlockquote",view:"blockquote",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlTable",view:"table",modelSchema:{allowWhere:"$block",isBlock:!0}},{model:"htmlTbody",view:"tbody",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlThead",view:"thead",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlTfoot",view:"tfoot",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlCaption",view:"caption",modelSchema:{allowIn:"htmlTable",allowChildren:"$text",isBlock:!1}},{model:"htmlColgroup",view:"colgroup",modelSchema:{allowIn:"htmlTable",allowChildren:"col",isBlock:!1}},{model:"htmlCol",view:"col",modelSchema:{allowIn:"htmlColgroup",isBlock:!1}},{model:"htmlTr",view:"tr",modelSchema:{allowIn:["htmlTable","htmlThead","htmlTbody"],isLimit:!0}},{model:"htmlTd",view:"td",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlTh",view:"th",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlFigure",view:"figure",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFigcaption",view:"figcaption",modelSchema:{allowIn:"htmlFigure",allowChildren:"$text",isBlock:!1}},{model:"htmlAddress",view:"address",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlAside",view:"aside",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlMain",view:"main",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDetails",view:"details",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSummary",view:"summary",modelSchema:{allowChildren:["htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6","$text"],allowIn:"htmlDetails",isBlock:!1}},{model:"htmlDiv",view:"div",paragraphLikeModel:"htmlDivParagraph",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlFieldset",view:"fieldset",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlLegend",view:"legend",modelSchema:{allowIn:"htmlFieldset",allowChildren:"$text"}},{model:"htmlHeader",view:"header",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFooter",view:"footer",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlForm",view:"form",modelSchema:{inheritAllFrom:"$container",isBlock:!0}},{model:"htmlHgroup",view:"hgroup",modelSchema:{allowIn:["$root","$container"],allowChildren:["paragraph","htmlP","htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6"],isBlock:!1}},{model:"htmlH1",view:"h1",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH2",view:"h2",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH3",view:"h3",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH4",view:"h4",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH5",view:"h5",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH6",view:"h6",modelSchema:{inheritAllFrom:"$block"}},{model:"$htmlList",modelSchema:{allowWhere:"$container",allowChildren:["$htmlList","htmlLi"],isBlock:!1}},{model:"htmlDir",view:"dir",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlMenu",view:"menu",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlUl",view:"ul",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlOl",view:"ol",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlLi",view:"li",modelSchema:{allowIn:"$htmlList",allowChildren:"$text",isBlock:!1}},{model:"htmlPre",view:"pre",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlArticle",view:"article",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSection",view:"section",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlNav",view:"nav",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDivDl",view:"div",modelSchema:{allowChildren:["htmlDt","htmlDd"],allowIn:"htmlDl"}},{model:"htmlDl",view:"dl",modelSchema:{allowWhere:"$container",allowChildren:["htmlDt","htmlDd","htmlDivDl"],isBlock:!1}},{model:"htmlDt",view:"dt",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlDd",view:"dd",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlCenter",view:"center",modelSchema:{inheritAllFrom:"$container",isBlock:!1}}],inline:[{model:"htmlLiAttributes",view:"li",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlOlAttributes",view:"ol",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlUlAttributes",view:"ul",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"table"},{model:"htmlTheadAttributes",view:"thead",appliesToBlock:"table"},{model:"htmlTbodyAttributes",view:"tbody",appliesToBlock:"table"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"imageBlock"},{model:"htmlAcronym",view:"acronym",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTt",view:"tt",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlFont",view:"font",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTime",view:"time",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlVar",view:"var",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBig",view:"big",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSmall",view:"small",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSamp",view:"samp",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlQ",view:"q",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlOutput",view:"output",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlKbd",view:"kbd",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdi",view:"bdi",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdo",view:"bdo",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlAbbr",view:"abbr",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlA",view:"a",priority:5,coupledAttribute:"linkHref"},{model:"htmlStrong",view:"strong",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlB",view:"b",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlI",view:"i",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlEm",view:"em",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlS",view:"s",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDel",view:"del",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlIns",view:"ins",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlU",view:"u",coupledAttribute:"underline",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSub",view:"sub",coupledAttribute:"subscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSup",view:"sup",coupledAttribute:"superscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCode",view:"code",coupledAttribute:"code",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlMark",view:"mark",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSpan",view:"span",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCite",view:"cite",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlLabel",view:"label",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDfn",view:"dfn",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlObject",view:"object",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlIframe",view:"iframe",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlInput",view:"input",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlButton",view:"button",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlTextarea",view:"textarea",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlSelect",view:"select",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlVideo",view:"video",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlEmbed",view:"embed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlOembed",view:"oembed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlAudio",view:"audio",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlImg",view:"img",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlCanvas",view:"canvas",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlMeter",view:"meter",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlProgress",view:"progress",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlScript",view:"script",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlStyle",view:"style",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlCustomElement",view:"$customElement",modelSchema:{allowWhere:["$text","$block"],allowAttributesOf:"$inlineObject",isInline:!0}}]};class DataSchema extends Plugin{constructor(){super(...arguments);ee(this,"_definitions",[])}static get pluginName(){return"DataSchema"}init(){for(const t of defaultConfig.block)this.registerBlockElement(t);for(const t of defaultConfig.inline)this.registerInlineElement(t)}registerBlockElement(t){this._definitions.push({...t,isBlock:!0})}registerInlineElement(t){this._definitions.push({...t,isInline:!0})}extendBlockElement(t){this._extendDefinition({...t,isBlock:!0})}extendInlineElement(t){this._extendDefinition({...t,isInline:!0})}getDefinitionsForView(t,V=!1){const N=new Set;for(const W of this._getMatchingViewDefinitions(t)){if(V)for(const K of this._getReferences(W.model))N.add(K);N.add(W)}return N}getDefinitionsForModel(t){return this._definitions.filter(V=>V.model==t)}_getMatchingViewDefinitions(t){return this._definitions.filter(V=>V.view&&testViewName(t,V.view))}*_getReferences(t){const V=["inheritAllFrom","inheritTypesFrom","allowWhere","allowContentOf","allowAttributesOf"],N=this._definitions.filter(W=>W.model==t);for(const{modelSchema:W}of N)if(W)for(const K of V)for(const G of toArray$2(W[K]||[])){const Z=this._definitions.filter(Y=>Y.model==G);for(const Y of Z)G!==t&&(yield*this._getReferences(Y.model),yield Y)}}_extendDefinition(t){const V=Array.from(this._definitions.entries()).filter(([,N])=>N.model==t.model);if(V.length==0){this._definitions.push(t);return}for(const[N,W]of V)this._definitions[N]=mergeWith({},W,t,(K,G)=>Array.isArray(K)?K.concat(G):void 0)}}function testViewName(H,B){return typeof H=="string"?H===B:H instanceof RegExp?H.test(B):!1}class DataFilter extends Plugin{constructor(t){super(t);ee(this,"_dataSchema");ee(this,"_allowedAttributes");ee(this,"_disallowedAttributes");ee(this,"_allowedElements");ee(this,"_disallowedElements");ee(this,"_dataInitialized");ee(this,"_coupledAttributes");this._dataSchema=t.plugins.get("DataSchema"),this._allowedAttributes=new Matcher,this._disallowedAttributes=new Matcher,this._allowedElements=new Set,this._disallowedElements=new Set,this._dataInitialized=!1,this._coupledAttributes=null,this._registerElementsAfterInit(),this._registerElementHandlers(),this._registerCoupledAttributesPostFixer(),this._registerAssociatedHtmlAttributesPostFixer()}static get pluginName(){return"DataFilter"}static get requires(){return[DataSchema,Widget]}loadAllowedConfig(t){for(const V of t){const N=V.name||/[\s\S]+/,W=splitRules(V);this.allowElement(N),W.forEach(K=>this.allowAttributes(K))}}loadDisallowedConfig(t){for(const V of t){const N=V.name||/[\s\S]+/,W=splitRules(V);W.length==0?this.disallowElement(N):W.forEach(K=>this.disallowAttributes(K))}}loadAllowedEmptyElementsConfig(t){for(const V of t)this.allowEmptyElement(V)}allowElement(t){for(const V of this._dataSchema.getDefinitionsForView(t,!0))this._addAllowedElement(V),this._coupledAttributes=null}disallowElement(t){for(const V of this._dataSchema.getDefinitionsForView(t,!1))this._disallowedElements.add(V.view)}allowEmptyElement(t){for(const V of this._dataSchema.getDefinitionsForView(t,!0))V.isInline&&this._dataSchema.extendInlineElement({...V,allowEmpty:!0})}allowAttributes(t){this._allowedAttributes.add(t)}disallowAttributes(t){this._disallowedAttributes.add(t)}processViewAttributes(t,V){const{consumable:N}=V;return matchAndConsumeAttributes(t,this._disallowedAttributes,N),prepareGHSAttribute(t,matchAndConsumeAttributes(t,this._allowedAttributes,N))}_addAllowedElement(t){if(!this._allowedElements.has(t)){if(this._allowedElements.add(t),"appliesToBlock"in t&&typeof t.appliesToBlock=="string")for(const V of this._dataSchema.getDefinitionsForModel(t.appliesToBlock))V.isBlock&&this._addAllowedElement(V);this._dataInitialized&&this.editor.data.once("set",()=>{this._fireRegisterEvent(t)},{priority:priorities.highest+1})}}_registerElementsAfterInit(){this.editor.data.on("init",()=>{this._dataInitialized=!0;for(const t of this._allowedElements)this._fireRegisterEvent(t)},{priority:priorities.highest+1})}_registerElementHandlers(){this.on("register",(t,V)=>{const N=this.editor.model.schema;if(V.isObject&&!N.isRegistered(V.model))this._registerObjectElement(V);else if(V.isBlock)this._registerBlockElement(V);else if(V.isInline)this._registerInlineElement(V);else throw new CKEditorError("data-filter-invalid-definition",null,V);t.stop()},{priority:"lowest"})}_registerCoupledAttributesPostFixer(){const t=this.editor.model,V=t.document.selection;t.document.registerPostFixer(N=>{const W=t.document.differ.getChanges();let K=!1;const G=this._getCoupledAttributesMap();for(const Z of W){if(Z.type!="attribute"||Z.attributeNewValue!==null)continue;const Y=G.get(Z.attributeKey);if(Y)for(const{item:X}of Z.range.getWalker())for(const Q of Y)X.hasAttribute(Q)&&(N.removeAttribute(Q,X),K=!0)}return K}),this.listenTo(V,"change:attribute",(N,{attributeKeys:W})=>{const K=new Set,G=this._getCoupledAttributesMap();for(const Z of W){if(V.hasAttribute(Z))continue;const Y=G.get(Z);if(Y)for(const X of Y)V.hasAttribute(X)&&K.add(X)}K.size!=0&&t.change(Z=>{for(const Y of K)Z.removeSelectionAttribute(Y)})})}_registerAssociatedHtmlAttributesPostFixer(){const t=this.editor.model;t.document.registerPostFixer(V=>{const N=t.document.differ.getChanges();let W=!1;for(const K of N)if(!(K.type!=="insert"||K.name==="$text"))for(const G of K.attributes.keys())!G.startsWith("html")||!G.endsWith("Attributes")||t.schema.checkAttribute(K.name,G)||(V.removeAttribute(G,K.position.nodeAfter),W=!0);return W})}_getCoupledAttributesMap(){if(this._coupledAttributes)return this._coupledAttributes;this._coupledAttributes=new Map;for(const t of this._allowedElements)if(t.coupledAttribute&&t.model){const V=this._coupledAttributes.get(t.coupledAttribute);V?V.push(t.model):this._coupledAttributes.set(t.coupledAttribute,[t.model])}return this._coupledAttributes}_fireRegisterEvent(t){t.view&&this._disallowedElements.has(t.view)||this.fire(t.view?`register:${t.view}`:"register",t)}_registerObjectElement(t){const V=this.editor,N=V.model.schema,W=V.conversion,{view:K,model:G}=t;N.register(G,t.modelSchema);/* istanbul ignore next: paranoid check -- @preserve */K&&(N.extend(t.model,{allowAttributes:[getHtmlAttributeName(K),"htmlContent"]}),V.data.registerRawContentMatcher({name:K}),W.for("upcast").elementToElement({view:K,model:viewToModelObjectConverter(t),converterPriority:priorities.low+2}),W.for("upcast").add(viewToModelBlockAttributeConverter(t,this)),W.for("editingDowncast").elementToStructure({model:{name:G,attributes:[getHtmlAttributeName(K)]},view:toObjectWidgetConverter(V,t)}),W.for("dataDowncast").elementToElement({model:G,view:(Z,{writer:Y})=>createObjectView(K,Z,Y)}),W.for("dataDowncast").add(modelToViewBlockAttributeConverter(t)))}_registerBlockElement(t){const V=this.editor,N=V.model.schema,W=V.conversion,{view:K,model:G}=t;if(!N.isRegistered(t.model)){if(N.register(t.model,t.modelSchema),!K)return;W.for("upcast").elementToElement({model:G,view:K,converterPriority:priorities.low+2}),W.for("downcast").elementToElement({model:G,view:K})}K&&(N.extend(t.model,{allowAttributes:getHtmlAttributeName(K)}),W.for("upcast").add(viewToModelBlockAttributeConverter(t,this)),W.for("downcast").add(modelToViewBlockAttributeConverter(t)))}_registerInlineElement(t){const V=this.editor,N=V.model.schema,W=V.conversion,K=t.model;t.appliesToBlock||(N.extend("$text",{allowAttributes:K}),t.attributeProperties&&N.setAttributeProperties(K,t.attributeProperties),W.for("upcast").add(viewToAttributeInlineConverter(t,this)),W.for("downcast").attributeToElement({model:K,view:attributeToViewInlineConverter(t)}),t.allowEmpty&&(N.setAttributeProperties(K,{copyFromObject:!1}),N.isRegistered("htmlEmptyElement")||N.register("htmlEmptyElement",{inheritAllFrom:"$inlineObject"}),V.data.htmlProcessor.domConverter.registerInlineObjectMatcher(G=>G.name==t.view&&G.isEmpty&&Array.from(G.getAttributeKeys()).length?{name:!0}:null),W.for("editingDowncast").elementToElement({model:"htmlEmptyElement",view:emptyInlineModelElementToViewConverter(t,!0)}),W.for("dataDowncast").elementToElement({model:"htmlEmptyElement",view:emptyInlineModelElementToViewConverter(t)})))}}function matchAndConsumeAttributes(H,B,t){const V=B.matchAll(H)||[],N=H.document.stylesProcessor;return V.reduce((W,{match:K})=>{for(const G of K.styles||[]){const Z=N.getRelatedStyles(G).filter(Y=>Y.split("-").length>G.split("-").length).sort((Y,X)=>X.split("-").length-Y.split("-").length);for(const Y of Z)t.consume(H,{styles:[Y]})&&W.styles.push(Y);t.consume(H,{styles:[G]})&&W.styles.push(G)}for(const G of K.classes||[])t.consume(H,{classes:[G]})&&W.classes.push(G);for(const G of K.attributes||[])t.consume(H,{attributes:[G]})&&W.attributes.push(G);return W},{attributes:[],classes:[],styles:[]})}function prepareGHSAttribute(H,{attributes:B,classes:t,styles:V}){return!B.length&&!t.length&&!V.length?null:{...B.length&&{attributes:getAttributes(H,B)},...V.length&&{styles:getReducedStyles(H,V)},...t.length&&{classes:t}}}function getAttributes(H,B){const t={};for(const V of B){const N=H.getAttribute(V);N!==void 0&&isValidAttributeName(V)&&(t[V]=N)}return t}function getReducedStyles(H,B){const t=new StylesMap(H.document.stylesProcessor);for(const V of B){const N=H.getStyle(V);N!==void 0&&t.set(V,N)}return Object.fromEntries(t.getStylesEntries())}function splitPattern(H,B){const{name:t}=H,V=H[B];return isPlainObject(V)?Object.entries(V).map(([N,W])=>({name:t,[B]:{[N]:W}})):Array.isArray(V)?V.map(N=>({name:t,[B]:[N]})):[H]}function splitRules(H){const{name:B,attributes:t,classes:V,styles:N}=H,W=[];return t&&W.push(...splitPattern({name:B,attributes:t},"attributes")),V&&W.push(...splitPattern({name:B,classes:V},"classes")),N&&W.push(...splitPattern({name:B,styles:N},"styles")),W}class CodeBlockElementSupport extends Plugin{static get requires(){return[DataFilter]}static get pluginName(){return"CodeBlockElementSupport"}init(){if(!this.editor.plugins.has("CodeBlockEditing"))return;const B=this.editor.plugins.get(DataFilter);B.on("register:pre",(t,V)=>{if(V.model!=="codeBlock")return;const N=this.editor,W=N.model.schema,K=N.conversion;W.extend("codeBlock",{allowAttributes:["htmlPreAttributes","htmlContentAttributes"]}),K.for("upcast").add(viewToModelCodeBlockAttributeConverter(B)),K.for("downcast").add(modelToViewCodeBlockAttributeConverter()),t.stop()})}}function viewToModelCodeBlockAttributeConverter(H){return B=>{B.on("element:code",(t,V,N)=>{const W=V.viewItem,K=W.parent;if(!K||!K.is("element","pre"))return;G(K,"htmlPreAttributes"),G(W,"htmlContentAttributes");function G(Z,Y){const X=H.processViewAttributes(Z,N);X&&N.writer.setAttribute(Y,X,V.modelRange)}},{priority:"low"})}}function modelToViewCodeBlockAttributeConverter(){return H=>{H.on("attribute:htmlPreAttributes:codeBlock",(B,t,V)=>{if(!V.consumable.consume(t.item,B.name))return;const{attributeOldValue:N,attributeNewValue:W}=t,G=V.mapper.toViewElement(t.item).parent;updateViewAttributes(V.writer,N,W,G)}),H.on("attribute:htmlContentAttributes:codeBlock",(B,t,V)=>{if(!V.consumable.consume(t.item,B.name))return;const{attributeOldValue:N,attributeNewValue:W}=t,K=V.mapper.toViewElement(t.item);updateViewAttributes(V.writer,N,W,K)})}}class DualContentModelElementSupport extends Plugin{static get requires(){return[DataFilter]}static get pluginName(){return"DualContentModelElementSupport"}init(){this.editor.plugins.get(DataFilter).on("register",(t,V)=>{const N=V,W=this.editor,K=W.model.schema,G=W.conversion;if(!N.paragraphLikeModel||K.isRegistered(N.model)||K.isRegistered(N.paragraphLikeModel))return;const Z={model:N.paragraphLikeModel,view:N.view};K.register(N.model,N.modelSchema),K.register(Z.model,{inheritAllFrom:"$block"}),G.for("upcast").elementToElement({view:N.view,model:(Y,{writer:X})=>this._hasBlockContent(Y)?X.createElement(N.model):X.createElement(Z.model),converterPriority:priorities.low+.5}),G.for("downcast").elementToElement({view:N.view,model:N.model}),this._addAttributeConversion(N),G.for("downcast").elementToElement({view:Z.view,model:Z.model}),this._addAttributeConversion(Z),t.stop()})}_hasBlockContent(B){const t=this.editor.editing.view,V=t.domConverter.blockElements;for(const N of t.createRangeIn(B).getItems())if(N.is("element")&&V.includes(N.name))return!0;return!1}_addAttributeConversion(B){const t=this.editor,V=t.conversion,N=t.plugins.get(DataFilter);t.model.schema.extend(B.model,{allowAttributes:getHtmlAttributeName(B.view)}),V.for("upcast").add(viewToModelBlockAttributeConverter(B,N)),V.for("downcast").add(modelToViewBlockAttributeConverter(B))}}class HeadingElementSupport extends Plugin{static get requires(){return[DataSchema,Enter]}static get pluginName(){return"HeadingElementSupport"}init(){const B=this.editor;if(!B.plugins.has("HeadingEditing"))return;const t=B.config.get("heading.options");this.registerHeadingElements(B,t)}registerHeadingElements(B,t){const V=B.plugins.get(DataSchema),N=[];for(const W of t)"model"in W&&"view"in W&&(V.registerBlockElement({view:W.view,model:W.model}),N.push(W.model));V.extendBlockElement({model:"htmlHgroup",modelSchema:{allowChildren:N}}),V.extendBlockElement({model:"htmlSummary",modelSchema:{allowChildren:N}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getDescendantElement(H,B,t){const V=H.createRangeOn(B);for(const{item:N}of V.getWalker())if(N.is("element",t))return N}class ImageElementSupport extends Plugin{static get requires(){return[DataFilter]}static get pluginName(){return"ImageElementSupport"}init(){const B=this.editor;if(!B.plugins.has("ImageInlineEditing")&&!B.plugins.has("ImageBlockEditing"))return;const t=B.model.schema,V=B.conversion,N=B.plugins.get(DataFilter);N.on("register:figure",()=>{V.for("upcast").add(viewToModelFigureAttributeConverter$1(N))}),N.on("register:img",(W,K)=>{K.model!=="imageBlock"&&K.model!=="imageInline"||(t.isRegistered("imageBlock")&&t.extend("imageBlock",{allowAttributes:["htmlImgAttributes","htmlFigureAttributes","htmlLinkAttributes"]}),t.isRegistered("imageInline")&&t.extend("imageInline",{allowAttributes:["htmlA","htmlImgAttributes"]}),V.for("upcast").add(viewToModelImageAttributeConverter(N)),V.for("downcast").add(modelToViewImageAttributeConverter()),B.plugins.has("LinkImage")&&V.for("upcast").add(viewToModelLinkImageAttributeConverter(N,B)),W.stop())})}}function viewToModelImageAttributeConverter(H){return B=>{B.on("element:img",(t,V,N)=>{if(!V.modelRange)return;const W=V.viewItem,K=H.processViewAttributes(W,N);K&&N.writer.setAttribute("htmlImgAttributes",K,V.modelRange)},{priority:"low"})}}function viewToModelLinkImageAttributeConverter(H,B){const t=B.plugins.get("ImageUtils");return V=>{V.on("element:a",(N,W,K)=>{const G=W.viewItem;if(!t.findViewImgElement(G))return;const Y=W.modelCursor.parent;if(!Y.is("element","imageBlock"))return;const X=H.processViewAttributes(G,K);X&&K.writer.setAttribute("htmlLinkAttributes",X,Y)},{priority:"low"})}}function viewToModelFigureAttributeConverter$1(H){return B=>{B.on("element:figure",(t,V,N)=>{const W=V.viewItem;if(!V.modelRange||!W.hasClass("image"))return;const K=H.processViewAttributes(W,N);K&&N.writer.setAttribute("htmlFigureAttributes",K,V.modelRange)},{priority:"low"})}}function modelToViewImageAttributeConverter(){return H=>{B("htmlImgAttributes"),t("img","htmlImgAttributes"),t("figure","htmlFigureAttributes"),t("a","htmlLinkAttributes");function B(V){H.on(`attribute:${V}:imageInline`,(N,W,K)=>{if(!K.consumable.consume(W.item,N.name))return;const{attributeOldValue:G,attributeNewValue:Z}=W,Y=K.mapper.toViewElement(W.item);updateViewAttributes(K.writer,G,Z,Y)},{priority:"low"})}function t(V,N){H.on(`attribute:${N}:imageBlock`,(W,K,G)=>{if(!G.consumable.test(K.item,W.name))return;const{attributeOldValue:Z,attributeNewValue:Y}=K,X=G.mapper.toViewElement(K.item),Q=getDescendantElement(G.writer,X,V);Q&&(updateViewAttributes(G.writer,Z,Y,Q),G.consumable.consume(K.item,W.name))},{priority:"low"}),V==="a"&&H.on("attribute:linkHref:imageBlock",(W,K,G)=>{if(!G.consumable.consume(K.item,"attribute:htmlLinkAttributes:imageBlock"))return;const Z=G.mapper.toViewElement(K.item),Y=getDescendantElement(G.writer,Z,"a");setViewAttributes(G.writer,K.item.getAttribute("htmlLinkAttributes"),Y)},{priority:"low"})}}}class MediaEmbedElementSupport extends Plugin{static get requires(){return[DataFilter]}static get pluginName(){return"MediaEmbedElementSupport"}init(){const B=this.editor;if(!B.plugins.has("MediaEmbed")||B.config.get("mediaEmbed.previewsInData"))return;const t=B.model.schema,V=B.conversion,N=this.editor.plugins.get(DataFilter),W=this.editor.plugins.get(DataSchema),K=B.config.get("mediaEmbed.elementName");W.registerBlockElement({model:"media",view:K}),N.on("register:figure",()=>{V.for("upcast").add(viewToModelFigureAttributesConverter(N))}),N.on(`register:${K}`,(G,Z)=>{Z.model==="media"&&(t.extend("media",{allowAttributes:[getHtmlAttributeName(K),"htmlFigureAttributes"]}),V.for("upcast").add(viewToModelMediaAttributesConverter(N,K)),V.for("dataDowncast").add(modelToViewMediaAttributeConverter(K)),G.stop())})}}function viewToModelMediaAttributesConverter(H,B){const t=(V,N,W)=>{const K=N.viewItem;G(K,getHtmlAttributeName(B));function G(Z,Y){const X=H.processViewAttributes(Z,W);X&&W.writer.setAttribute(Y,X,N.modelRange)}};return V=>{V.on(`element:${B}`,t,{priority:"low"})}}function viewToModelFigureAttributesConverter(H){return B=>{B.on("element:figure",(t,V,N)=>{const W=V.viewItem;if(!V.modelRange||!W.hasClass("media"))return;const K=H.processViewAttributes(W,N);K&&N.writer.setAttribute("htmlFigureAttributes",K,V.modelRange)},{priority:"low"})}}function modelToViewMediaAttributeConverter(H){return B=>{t(H,getHtmlAttributeName(H)),t("figure","htmlFigureAttributes");function t(V,N){B.on(`attribute:${N}:media`,(W,K,G)=>{if(!G.consumable.consume(K.item,W.name))return;const{attributeOldValue:Z,attributeNewValue:Y}=K,X=G.mapper.toViewElement(K.item),Q=getDescendantElement(G.writer,X,V);updateViewAttributes(G.writer,Z,Y,Q)})}}}class ScriptElementSupport extends Plugin{static get requires(){return[DataFilter]}static get pluginName(){return"ScriptElementSupport"}init(){const B=this.editor.plugins.get(DataFilter);B.on("register:script",(t,V)=>{const N=this.editor,W=N.model.schema,K=N.conversion;W.register("htmlScript",V.modelSchema),W.extend("htmlScript",{allowAttributes:["htmlScriptAttributes","htmlContent"],isContent:!0}),N.data.registerRawContentMatcher({name:"script"}),K.for("upcast").elementToElement({view:"script",model:viewToModelObjectConverter(V)}),K.for("upcast").add(viewToModelBlockAttributeConverter(V,B)),K.for("downcast").elementToElement({model:"htmlScript",view:(G,{writer:Z})=>createObjectView("script",G,Z)}),K.for("downcast").add(modelToViewBlockAttributeConverter(V)),t.stop()})}}class TableElementSupport extends Plugin{static get requires(){return[DataFilter]}static get pluginName(){return"TableElementSupport"}init(){const B=this.editor;if(!B.plugins.has("TableEditing"))return;const t=B.model.schema,V=B.conversion,N=B.plugins.get(DataFilter),W=B.plugins.get("TableUtils");N.on("register:figure",()=>{V.for("upcast").add(viewToModelFigureAttributeConverter(N))}),N.on("register:table",(K,G)=>{G.model==="table"&&(t.extend("table",{allowAttributes:["htmlTableAttributes","htmlFigureAttributes","htmlTheadAttributes","htmlTbodyAttributes"]}),V.for("upcast").add(viewToModelTableAttributeConverter(N)),V.for("downcast").add(modelToViewTableAttributeConverter()),B.model.document.registerPostFixer(createHeadingRowsPostFixer(B.model,W)),K.stop())})}}function createHeadingRowsPostFixer(H,B){return t=>{const V=H.document.differ.getChanges();let N=!1;for(const W of V){if(W.type!="attribute"||W.attributeKey!="headingRows")continue;const K=W.range.start.nodeAfter,G=K.getAttribute("htmlTheadAttributes"),Z=K.getAttribute("htmlTbodyAttributes");G&&!W.attributeNewValue?(t.removeAttribute("htmlTheadAttributes",K),N=!0):Z&&W.attributeNewValue==B.getRows(K)&&(t.removeAttribute("htmlTbodyAttributes",K),N=!0)}return N}}function viewToModelTableAttributeConverter(H){return B=>{B.on("element:table",(t,V,N)=>{if(!V.modelRange)return;const W=V.viewItem;K(W,"htmlTableAttributes");for(const G of W.getChildren())G.is("element","thead")&&K(G,"htmlTheadAttributes"),G.is("element","tbody")&&K(G,"htmlTbodyAttributes");function K(G,Z){const Y=H.processViewAttributes(G,N);Y&&N.writer.setAttribute(Z,Y,V.modelRange)}},{priority:"low"})}}function viewToModelFigureAttributeConverter(H){return B=>{B.on("element:figure",(t,V,N)=>{const W=V.viewItem;if(!V.modelRange||!W.hasClass("table"))return;const K=H.processViewAttributes(W,N);K&&N.writer.setAttribute("htmlFigureAttributes",K,V.modelRange)},{priority:"low"})}}function modelToViewTableAttributeConverter(){return H=>{B("table","htmlTableAttributes"),B("figure","htmlFigureAttributes"),B("thead","htmlTheadAttributes"),B("tbody","htmlTbodyAttributes");function B(t,V){H.on(`attribute:${V}:table`,(N,W,K)=>{if(!K.consumable.test(W.item,N.name))return;const G=K.mapper.toViewElement(W.item),Z=getDescendantElement(K.writer,G,t);Z&&(K.consumable.consume(W.item,N.name),updateViewAttributes(K.writer,W.attributeOldValue,W.attributeNewValue,Z))})}}}class StyleElementSupport extends Plugin{static get requires(){return[DataFilter]}static get pluginName(){return"StyleElementSupport"}init(){const B=this.editor.plugins.get(DataFilter);B.on("register:style",(t,V)=>{const N=this.editor,W=N.model.schema,K=N.conversion;W.register("htmlStyle",V.modelSchema),W.extend("htmlStyle",{allowAttributes:["htmlStyleAttributes","htmlContent"],isContent:!0}),N.data.registerRawContentMatcher({name:"style"}),K.for("upcast").elementToElement({view:"style",model:viewToModelObjectConverter(V)}),K.for("upcast").add(viewToModelBlockAttributeConverter(V,B)),K.for("downcast").elementToElement({model:"htmlStyle",view:(G,{writer:Z})=>createObjectView("style",G,Z)}),K.for("downcast").add(modelToViewBlockAttributeConverter(V)),t.stop()})}}class ListElementSupport extends Plugin{static get requires(){return[DataFilter]}static get pluginName(){return"ListElementSupport"}init(){const B=this.editor;if(!B.plugins.has("ListEditing"))return;const t=B.model.schema,V=B.conversion,N=B.plugins.get(DataFilter),W=B.plugins.get("ListEditing"),K=B.plugins.get("ListUtils"),G=["ul","ol","li"];W.registerDowncastStrategy({scope:"item",attributeName:"htmlLiAttributes",setAttributeOnDowncast:setViewAttributes}),W.registerDowncastStrategy({scope:"list",attributeName:"htmlUlAttributes",setAttributeOnDowncast:setViewAttributes}),W.registerDowncastStrategy({scope:"list",attributeName:"htmlOlAttributes",setAttributeOnDowncast:setViewAttributes}),N.on("register",(Z,Y)=>{if(!G.includes(Y.view)||(Z.stop(),t.checkAttribute("$block","htmlLiAttributes")))return;const X=G.map(Q=>getHtmlAttributeName(Q));t.extend("$listItem",{allowAttributes:X}),V.for("upcast").add(Q=>{Q.on("element:ul",viewToModelListAttributeConverter("htmlUlAttributes",N),{priority:"low"}),Q.on("element:ol",viewToModelListAttributeConverter("htmlOlAttributes",N),{priority:"low"}),Q.on("element:li",viewToModelListAttributeConverter("htmlLiAttributes",N),{priority:"low"})})}),W.on("postFixer",(Z,{listNodes:Y,writer:X})=>{for(const{node:Q,previousNodeInList:te}of Y)if(te){if(te.getAttribute("listType")==Q.getAttribute("listType")){const ie=getAttributeFromListType(te.getAttribute("listType")),ne=te.getAttribute(ie);!isEqual(Q.getAttribute(ie),ne)&&X.model.schema.checkAttribute(Q,ie)&&(X.setAttribute(ie,ne,Q),Z.return=!0)}if(te.getAttribute("listItemId")==Q.getAttribute("listItemId")){const ie=te.getAttribute("htmlLiAttributes");!isEqual(Q.getAttribute("htmlLiAttributes"),ie)&&X.model.schema.checkAttribute(Q,"htmlLiAttributes")&&(X.setAttribute("htmlLiAttributes",ie,Q),Z.return=!0)}}}),W.on("postFixer",(Z,{listNodes:Y,writer:X})=>{for(const{node:Q}of Y){const te=Q.getAttribute("listType");!K.isNumberedListType(te)&&Q.getAttribute("htmlOlAttributes")&&(X.removeAttribute("htmlOlAttributes",Q),Z.return=!0),K.isNumberedListType(te)&&Q.getAttribute("htmlUlAttributes")&&(X.removeAttribute("htmlUlAttributes",Q),Z.return=!0)}})}afterInit(){const B=this.editor;if(!B.commands.get("indentList"))return;const t=B.commands.get("indentList");this.listenTo(t,"afterExecute",(V,N)=>{B.model.change(W=>{for(const K of N){const G=getAttributeFromListType(K.getAttribute("listType"));B.model.schema.checkAttribute(K,G)&&W.setAttribute(G,{},K)}})})}}function viewToModelListAttributeConverter(H,B){return(t,V,N)=>{const W=V.viewItem;V.modelRange||Object.assign(V,N.convertChildren(V.viewItem,V.modelCursor));const K=B.processViewAttributes(W,N);for(const G of V.modelRange.getItems({shallow:!0}))G.hasAttribute("listItemId")&&(G.hasAttribute("htmlUlAttributes")||G.hasAttribute("htmlOlAttributes")||N.writer.model.schema.checkAttribute(G,H)&&N.writer.setAttribute(H,K||{},G))}}function getAttributeFromListType(H){return H==="numbered"||H=="customNumbered"?"htmlOlAttributes":"htmlUlAttributes"}class CustomElementSupport extends Plugin{static get requires(){return[DataFilter,DataSchema]}static get pluginName(){return"CustomElementSupport"}init(){const B=this.editor.plugins.get(DataFilter),t=this.editor.plugins.get(DataSchema);B.on("register:$customElement",(V,N)=>{V.stop();const W=this.editor,K=W.model.schema,G=W.conversion,Z=W.editing.view.domConverter.unsafeElements,Y=W.data.htmlProcessor.domConverter.preElements;K.register(N.model,N.modelSchema),K.extend(N.model,{allowAttributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"],isContent:!0}),W.data.htmlProcessor.domConverter.registerRawContentMatcher({name:"template"}),G.for("upcast").elementToElement({view:/.*/,model:(X,Q)=>{if(X.name=="$comment"||!isValidElementName(X.name)||t.getDefinitionsForView(X.name).size)return null;Z.includes(X.name)||Z.push(X.name),Y.includes(X.name)||Y.push(X.name);const te=Q.writer.createElement(N.model,{htmlElementName:X.name}),ie=B.processViewAttributes(X,Q);ie&&Q.writer.setAttribute("htmlCustomElementAttributes",ie,te);let ne;if(X.is("element","template")&&X.getCustomProperty("$rawContent"))ne=X.getCustomProperty("$rawContent");else{const ae=new UpcastWriter(X.document).createDocumentFragment(X),de=W.data.htmlProcessor.domConverter.viewToDom(ae),ce=de.firstChild;for(;ce.firstChild;)de.appendChild(ce.firstChild);ce.remove(),ne=W.data.htmlProcessor.htmlWriter.getHtml(de)}Q.writer.setAttribute("htmlContent",ne,te);for(const{item:le}of W.editing.view.createRangeIn(X))Q.consumable.consume(le,{name:!0});return te},converterPriority:"low"}),G.for("editingDowncast").elementToElement({model:{name:N.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(X,{writer:Q})=>{const te=X.getAttribute("htmlElementName"),ie=Q.createRawElement(te);return X.hasAttribute("htmlCustomElementAttributes")&&setViewAttributes(Q,X.getAttribute("htmlCustomElementAttributes"),ie),ie}}),G.for("dataDowncast").elementToElement({model:{name:N.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(X,{writer:Q})=>{const te=X.getAttribute("htmlElementName"),ie=X.getAttribute("htmlContent"),ne=Q.createRawElement(te,null,(le,ae)=>{ae.setContentOf(le,ie)});return X.hasAttribute("htmlCustomElementAttributes")&&setViewAttributes(Q,X.getAttribute("htmlCustomElementAttributes"),ne),ne}})})}}function isValidElementName(H){try{document.createElement(H)}catch{return!1}return!0}class GeneralHtmlSupport extends Plugin{static get pluginName(){return"GeneralHtmlSupport"}static get requires(){return[DataFilter,CodeBlockElementSupport,DualContentModelElementSupport,HeadingElementSupport,ImageElementSupport,MediaEmbedElementSupport,ScriptElementSupport,TableElementSupport,StyleElementSupport,ListElementSupport,CustomElementSupport]}init(){const B=this.editor,t=B.plugins.get(DataFilter);t.loadAllowedEmptyElementsConfig(B.config.get("htmlSupport.allowEmpty")||[]),t.loadAllowedConfig(B.config.get("htmlSupport.allow")||[]),t.loadDisallowedConfig(B.config.get("htmlSupport.disallow")||[])}getGhsAttributeNameForElement(B){const t=this.editor.plugins.get("DataSchema"),V=Array.from(t.getDefinitionsForView(B,!1)),N=V.find(W=>W.isInline&&!V[0].isObject);return N?N.model:getHtmlAttributeName(B)}addModelHtmlClass(B,t,V){const N=this.editor.model,W=this.getGhsAttributeNameForElement(B);N.change(K=>{for(const G of getItemsToUpdateGhsAttribute(N,V,W))modifyGhsAttribute(K,G,W,"classes",Z=>{for(const Y of toArray$2(t))Z.add(Y)})})}removeModelHtmlClass(B,t,V){const N=this.editor.model,W=this.getGhsAttributeNameForElement(B);N.change(K=>{for(const G of getItemsToUpdateGhsAttribute(N,V,W))modifyGhsAttribute(K,G,W,"classes",Z=>{for(const Y of toArray$2(t))Z.delete(Y)})})}setModelHtmlAttributes(B,t,V){const N=this.editor.model,W=this.getGhsAttributeNameForElement(B);N.change(K=>{for(const G of getItemsToUpdateGhsAttribute(N,V,W))modifyGhsAttribute(K,G,W,"attributes",Z=>{for(const[Y,X]of Object.entries(t))Z.set(Y,X)})})}removeModelHtmlAttributes(B,t,V){const N=this.editor.model,W=this.getGhsAttributeNameForElement(B);N.change(K=>{for(const G of getItemsToUpdateGhsAttribute(N,V,W))modifyGhsAttribute(K,G,W,"attributes",Z=>{for(const Y of toArray$2(t))Z.delete(Y)})})}setModelHtmlStyles(B,t,V){const N=this.editor.model,W=this.getGhsAttributeNameForElement(B);N.change(K=>{for(const G of getItemsToUpdateGhsAttribute(N,V,W))modifyGhsAttribute(K,G,W,"styles",Z=>{for(const[Y,X]of Object.entries(t))Z.set(Y,X)})})}removeModelHtmlStyles(B,t,V){const N=this.editor.model,W=this.getGhsAttributeNameForElement(B);N.change(K=>{for(const G of getItemsToUpdateGhsAttribute(N,V,W))modifyGhsAttribute(K,G,W,"styles",Z=>{for(const Y of toArray$2(t))Z.delete(Y)})})}}function*getItemsToUpdateGhsAttribute(H,B,t){if(B)if(!(Symbol.iterator in B)&&B.is("documentSelection")&&B.isCollapsed)H.schema.checkAttributeInSelection(B,t)&&(yield B);else for(const V of getValidRangesForSelectable(H,B,t))yield*V.getItems({shallow:!0})}function getValidRangesForSelectable(H,B,t){return!(Symbol.iterator in B)&&(B.is("node")||B.is("$text")||B.is("$textProxy"))?H.schema.checkAttribute(B,t)?[H.createRangeOn(B)]:[]:H.schema.getValidRanges(H.createSelection(B).getRanges(),t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function createBlockImageViewElement(H){return H.createContainerElement("figure",{class:"image"},[H.createEmptyElement("img"),H.createSlot("children")])}function getImgViewElementMatcher(H,B){const t=H.plugins.get("ImageUtils"),V=H.plugins.has("ImageInlineEditing")&&H.plugins.has("ImageBlockEditing");return W=>t.isInlineImageView(W)?V&&(W.getStyle("display")=="block"||W.findAncestor(t.isBlockImageView)?"imageBlock":"imageInline")!==B?null:N(W):null;function N(W){const K={name:!0};return W.hasAttribute("src")&&(K.attributes=["src"]),K}}function determineImageTypeForInsertionAtSelection(H,B){const t=first(B.getSelectedBlocks());return!t||H.isObject(t)||t.isEmpty&&t.name!="listItem"?"imageBlock":"imageInline"}function getSizeValueIfInPx(H){return H&&H.endsWith("px")?parseInt(H):null}function widthAndHeightStylesAreBothSet(H){const B=getSizeValueIfInPx(H.getStyle("width")),t=getSizeValueIfInPx(H.getStyle("height"));return!!(B&&t)}const IMAGE_WIDGETS_CLASSES_MATCH_REGEXP=/^(image|image-inline)$/;class ImageUtils extends Plugin{constructor(){super(...arguments);ee(this,"_domEmitter",new(DomEmitterMixin()))}static get pluginName(){return"ImageUtils"}isImage(t){return this.isInlineImage(t)||this.isBlockImage(t)}isInlineImageView(t){return!!t&&t.is("element","img")}isBlockImageView(t){return!!t&&t.is("element","figure")&&t.hasClass("image")}insertImage(t={},V=null,N=null,W={}){const K=this.editor,G=K.model,Z=G.document.selection,Y=determineImageTypeForInsertion(K,V||Z,N);t={...Object.fromEntries(Z.getAttributes()),...t};for(const X in t)G.schema.checkAttribute(Y,X)||delete t[X];return G.change(X=>{const{setImageSizes:Q=!0}=W,te=X.createElement(Y,t);return G.insertObject(te,V,null,{setSelection:"on",findOptimalPosition:!V&&Y!="imageInline"?"auto":void 0}),te.parent?(Q&&this.setImageNaturalSizeAttributes(te),te):null})}setImageNaturalSizeAttributes(t){const V=t.getAttribute("src");V&&(t.getAttribute("width")||t.getAttribute("height")||this.editor.model.change(N=>{const W=new global$1.window.Image;this._domEmitter.listenTo(W,"load",()=>{!t.getAttribute("width")&&!t.getAttribute("height")&&this.editor.model.enqueueChange(N.batch,K=>{K.setAttribute("width",W.naturalWidth,t),K.setAttribute("height",W.naturalHeight,t)}),this._domEmitter.stopListening(W,"load")}),W.src=V}))}getClosestSelectedImageWidget(t){const V=t.getFirstPosition();if(!V)return null;const N=t.getSelectedElement();if(N&&this.isImageWidget(N))return N;let W=V.parent;for(;W;){if(W.is("element")&&this.isImageWidget(W))return W;W=W.parent}return null}getClosestSelectedImageElement(t){const V=t.getSelectedElement();return this.isImage(V)?V:t.getFirstPosition().findAncestor("imageBlock")}getImageWidgetFromImageView(t){return t.findAncestor({classes:IMAGE_WIDGETS_CLASSES_MATCH_REGEXP})}isImageAllowed(){const V=this.editor.model.document.selection;return isImageAllowedInParent(this.editor,V)&&isNotInsideImage(V)}toImageWidget(t,V,N){return V.setCustomProperty("image",!0,t),toWidget(t,V,{label:()=>{const G=this.findViewImgElement(t).getAttribute("alt");return G?`${G} ${N}`:N}})}isImageWidget(t){return!!t.getCustomProperty("image")&&isWidget(t)}isBlockImage(t){return!!t&&t.is("element","imageBlock")}isInlineImage(t){return!!t&&t.is("element","imageInline")}findViewImgElement(t){if(this.isInlineImageView(t))return t;const V=this.editor.editing.view;for(const{item:N}of V.createRangeIn(t))if(this.isInlineImageView(N))return N}destroy(){return this._domEmitter.stopListening(),super.destroy()}}function isImageAllowedInParent(H,B){if(determineImageTypeForInsertion(H,B,null)=="imageBlock"){const V=getInsertImageParent(B,H.model);if(H.model.schema.checkChild(V,"imageBlock"))return!0}else if(H.model.schema.checkChild(B.focus,"imageInline"))return!0;return!1}function isNotInsideImage(H){return[...H.focus.getAncestors()].every(B=>!B.is("element","imageBlock"))}function getInsertImageParent(H,B){const V=findOptimalInsertionRange(H,B).start.parent;return V.isEmpty&&!V.is("element","$root")?V.parent:V}function determineImageTypeForInsertion(H,B,t){const V=H.model.schema,N=H.config.get("image.insert.type");return H.plugins.has("ImageBlockEditing")?H.plugins.has("ImageInlineEditing")?t||(N==="inline"?"imageInline":N!=="auto"?"imageBlock":B.is("selection")?determineImageTypeForInsertionAtSelection(V,B):V.checkChild(B,"imageInline")?"imageInline":"imageBlock"):"imageBlock":"imageInline"}const IMAGE_URL_REGEXP=new RegExp(String(/^(http(s)?:\/\/)?[\w-]+\.[\w.~:/[\]@!$&'()*+,;=%-]+/.source+/\.(jpg|jpeg|png|gif|ico|webp|JPG|JPEG|PNG|GIF|ICO|WEBP)/.source+/(\?[\w.~:/[\]@!$&'()*+,;=%-]*)?/.source+/(#[\w.~:/[\]@!$&'()*+,;=%-]*)?$/.source));class AutoImage extends Plugin{constructor(t){super(t);ee(this,"_timeoutId");ee(this,"_positionToInsert");this._timeoutId=null,this._positionToInsert=null}static get requires(){return[Clipboard,ImageUtils,Undo,Delete]}static get pluginName(){return"AutoImage"}init(){const t=this.editor,V=t.model.document,N=t.plugins.get("ClipboardPipeline");this.listenTo(N,"inputTransformation",()=>{const W=V.selection.getFirstRange(),K=LivePosition.fromPosition(W.start);K.stickiness="toPrevious";const G=LivePosition.fromPosition(W.end);G.stickiness="toNext",V.once("change:data",()=>{this._embedImageBetweenPositions(K,G),K.detach(),G.detach()},{priority:"high"})}),t.commands.get("undo").on("execute",()=>{this._timeoutId&&(global$1.window.clearTimeout(this._timeoutId),this._positionToInsert.detach(),this._timeoutId=null,this._positionToInsert=null)},{priority:"high"})}_embedImageBetweenPositions(t,V){const N=this.editor,W=new LiveRange(t,V),K=W.getWalker({ignoreElementEnd:!0}),G=Object.fromEntries(N.model.document.selection.getAttributes()),Z=this.editor.plugins.get("ImageUtils");let Y="";for(const X of K)X.item.is("$textProxy")&&(Y+=X.item.data);if(Y=Y.trim(),!Y.match(IMAGE_URL_REGEXP)){W.detach();return}this._positionToInsert=LivePosition.fromPosition(t),this._timeoutId=setTimeout(()=>{if(!N.commands.get("insertImage").isEnabled){W.detach();return}N.model.change(te=>{this._timeoutId=null,te.remove(W),W.detach();let ie;this._positionToInsert.root.rootName!=="$graveyard"&&(ie=this._positionToInsert.toPosition()),Z.insertImage({...G,src:Y},ie),this._positionToInsert.detach(),this._positionToInsert=null}),N.plugins.get("Delete").requestUndoOnBackspace()},100)}}class ImageTextAlternativeCommand extends Command{refresh(){const V=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!V,this.isEnabled&&V.hasAttribute("alt")?this.value=V.getAttribute("alt"):this.value=!1}execute(B){const t=this.editor,V=t.plugins.get("ImageUtils"),N=t.model,W=V.getClosestSelectedImageElement(N.document.selection);N.change(K=>{K.setAttribute("alt",B.newValue,W)})}}class ImageTextAlternativeEditing extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImageTextAlternativeEditing"}init(){this.editor.commands.add("imageTextAlternative",new ImageTextAlternativeCommand(this.editor))}}class TextAlternativeFormView extends View{constructor(t){super(t);ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"labeledInput");ee(this,"saveButtonView");ee(this,"cancelButtonView");ee(this,"_focusables");ee(this,"_focusCycler");const V=this.locale.t;this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(V("Save"),icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(V("Cancel"),icons.cancel,"ck-button-cancel","cancel"),this._focusables=new ViewCollection,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),submitHandler({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(t,V,N,W){const K=new ButtonView(this.locale);return K.set({label:t,icon:V,tooltip:!0}),K.extendTemplate({attributes:{class:N}}),W&&K.delegate("execute").to(this,W),K}_createLabeledInputView(){const t=this.locale.t,V=new LabeledFieldView(this.locale,createLabeledInputText);return V.label=t("Text alternative"),V}}function repositionContextualBalloon$1(H){const B=H.plugins.get("ContextualBalloon");if(H.plugins.get("ImageUtils").getClosestSelectedImageWidget(H.editing.view.document.selection)){const V=getBalloonPositionData(H);B.updatePosition(V)}}function getBalloonPositionData(H){const B=H.editing.view,t=BalloonPanelView.defaultPositions,V=H.plugins.get("ImageUtils");return{target:B.domConverter.mapViewToDom(V.getClosestSelectedImageWidget(B.document.selection)),positions:[t.northArrowSouth,t.northArrowSouthWest,t.northArrowSouthEast,t.southArrowNorth,t.southArrowNorthWest,t.southArrowNorthEast,t.viewportStickyNorth]}}class ImageTextAlternativeUI extends Plugin{constructor(){super(...arguments);ee(this,"_balloon");ee(this,"_form")}static get requires(){return[ContextualBalloon]}static get pluginName(){return"ImageTextAlternativeUI"}init(){this._createButton()}destroy(){super.destroy(),this._form&&this._form.destroy()}_createButton(){const t=this.editor,V=t.t;t.ui.componentFactory.add("imageTextAlternative",N=>{const W=t.commands.get("imageTextAlternative"),K=new ButtonView(N);return K.set({label:V("Change image text alternative"),icon:icons.textAlternative,tooltip:!0}),K.bind("isEnabled").to(W,"isEnabled"),K.bind("isOn").to(W,"value",G=>!!G),this.listenTo(K,"execute",()=>{this._showForm()}),K})}_createForm(){const t=this.editor,N=t.editing.view.document,W=t.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(CssTransitionDisablerMixin(TextAlternativeFormView))(t.locale),this._form.render(),this.listenTo(this._form,"submit",()=>{t.execute("imageTextAlternative",{newValue:this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(K,G)=>{this._hideForm(!0),G()}),this.listenTo(t.ui,"update",()=>{W.getClosestSelectedImageWidget(N.selection)?this._isVisible&&repositionContextualBalloon$1(t):this._hideForm(!0)}),clickOutsideHandler({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;this._form||this._createForm();const t=this.editor,V=t.commands.get("imageTextAlternative"),N=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:getBalloonPositionData(t)}),N.fieldView.value=N.fieldView.element.value=V.value||"",this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(t=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),t&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}class ImageTextAlternative extends Plugin{static get requires(){return[ImageTextAlternativeEditing,ImageTextAlternativeUI]}static get pluginName(){return"ImageTextAlternative"}}function upcastImageFigure(H){const B=(t,V,N)=>{if(!N.consumable.test(V.viewItem,{name:!0,classes:"image"}))return;const W=H.findViewImgElement(V.viewItem);if(!W||!N.consumable.test(W,{name:!0}))return;N.consumable.consume(V.viewItem,{name:!0,classes:"image"});const K=N.convertItem(W,V.modelCursor),G=first(K.modelRange.getItems());if(!G){N.consumable.revert(V.viewItem,{name:!0,classes:"image"});return}N.convertChildren(V.viewItem,G),N.updateConversionResult(G,V)};return t=>{t.on("element:figure",B)}}function upcastPicture(H){const B=["srcset","media","type","sizes"],t=(V,N,W)=>{const K=N.viewItem;if(!W.consumable.test(K,{name:!0}))return;const G=new Map;for(const X of K.getChildren())if(X.is("element","source")){const Q={};for(const te of B)X.hasAttribute(te)&&W.consumable.test(X,{attributes:te})&&(Q[te]=X.getAttribute(te));Object.keys(Q).length&&G.set(X,Q)}const Z=H.findViewImgElement(K);if(!Z)return;let Y=N.modelCursor.parent;if(!Y.is("element","imageBlock")){const X=W.convertItem(Z,N.modelCursor);N.modelRange=X.modelRange,N.modelCursor=X.modelCursor,Y=first(X.modelRange.getItems())}W.consumable.consume(K,{name:!0});for(const[X,Q]of G)W.consumable.consume(X,{attributes:Object.keys(Q)});G.size&&W.writer.setAttribute("sources",Array.from(G.values()),Y),W.convertChildren(K,Y)};return V=>{V.on("element:picture",t)}}function downcastSrcsetAttribute(H,B){const t=(V,N,W)=>{if(!W.consumable.consume(N.item,V.name))return;const K=W.writer,G=W.mapper.toViewElement(N.item),Z=H.findViewImgElement(G);N.attributeNewValue===null?(K.removeAttribute("srcset",Z),K.removeAttribute("sizes",Z)):N.attributeNewValue&&(K.setAttribute("srcset",N.attributeNewValue,Z),K.setAttribute("sizes","100vw",Z))};return V=>{V.on(`attribute:srcset:${B}`,t)}}function downcastSourcesAttribute(H){const B=(t,V,N)=>{if(!N.consumable.consume(V.item,t.name))return;const W=N.writer,K=N.mapper.toViewElement(V.item),G=H.findViewImgElement(K),Z=V.attributeNewValue;if(Z&&Z.length){const Y=W.createContainerElement("picture",null,Z.map(te=>W.createEmptyElement("source",te))),X=[];let Q=G.parent;for(;Q&&Q.is("attributeElement");){const te=Q.parent;W.unwrap(W.createRangeOn(G),Q),X.unshift(Q),Q=te}W.insert(W.createPositionBefore(G),Y),W.move(W.createRangeOn(G),W.createPositionAt(Y,"end"));for(const te of X)W.wrap(W.createRangeOn(Y),te)}else if(G.parent.is("element","picture")){const Y=G.parent;W.move(W.createRangeOn(G),W.createPositionBefore(Y)),W.remove(Y)}};return t=>{t.on("attribute:sources:imageBlock",B),t.on("attribute:sources:imageInline",B)}}function downcastImageAttribute(H,B,t){const V=(N,W,K)=>{if(!K.consumable.consume(W.item,N.name))return;const G=K.writer,Z=K.mapper.toViewElement(W.item),Y=H.findViewImgElement(Z);G.setAttribute(W.attributeKey,W.attributeNewValue||"",Y)};return N=>{N.on(`attribute:${t}:${B}`,V)}}class ImageLoadObserver extends Observer{observe(B){this.listenTo(B,"load",(t,V)=>{const N=V.target;this.checkShouldIgnoreEventFromTarget(N)||N.tagName=="IMG"&&this._fireEvents(V)},{useCapture:!0})}stopObserving(B){this.stopListening(B)}_fireEvents(B){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",B))}}class InsertImageCommand extends Command{constructor(B){super(B);const t=B.config.get("image.insert.type");B.plugins.has("ImageBlockEditing")||t==="block"&&logWarning("image-block-plugin-required"),B.plugins.has("ImageInlineEditing")||t==="inline"&&logWarning("image-inline-plugin-required")}refresh(){const B=this.editor.plugins.get("ImageUtils");this.isEnabled=B.isImageAllowed()}execute(B){const t=toArray$2(B.source),V=this.editor.model.document.selection,N=this.editor.plugins.get("ImageUtils"),W=Object.fromEntries(V.getAttributes());t.forEach((K,G)=>{const Z=V.getSelectedElement();if(typeof K=="string"&&(K={src:K}),G&&Z&&N.isImage(Z)){const Y=this.editor.model.createPositionAfter(Z);N.insertImage({...K,...W},Y,B.imageType)}else N.insertImage({...K,...W},null,B.imageType)})}}class ReplaceImageSourceCommand extends Command{constructor(B){super(B),this.decorate("cleanupImage")}refresh(){const t=this.editor.plugins.get("ImageUtils"),V=this.editor.model.document.selection.getSelectedElement();this.isEnabled=t.isImage(V),this.value=this.isEnabled?V.getAttribute("src"):null}execute(B){const t=this.editor.model.document.selection.getSelectedElement(),V=this.editor.plugins.get("ImageUtils");this.editor.model.change(N=>{N.setAttribute("src",B.source,t),this.cleanupImage(N,t),V.setImageNaturalSizeAttributes(t)})}cleanupImage(B,t){B.removeAttribute("srcset",t),B.removeAttribute("sizes",t),B.removeAttribute("sources",t),B.removeAttribute("width",t),B.removeAttribute("height",t),B.removeAttribute("alt",t)}}class ImageEditing extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImageEditing"}init(){const B=this.editor,t=B.conversion;B.editing.view.addObserver(ImageLoadObserver),t.for("upcast").attributeToAttribute({view:{name:"img",key:"alt"},model:"alt"}).attributeToAttribute({view:{name:"img",key:"srcset"},model:"srcset"});const V=new InsertImageCommand(B),N=new ReplaceImageSourceCommand(B);B.commands.add("insertImage",V),B.commands.add("replaceImageSource",N),B.commands.add("imageInsert",V)}}class ImageSizeAttributes extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImageSizeAttributes"}afterInit(){this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline")}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["width","height"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["width","height"]})}_registerConverters(B){const t=this.editor,V=t.plugins.get("ImageUtils"),N=B==="imageBlock"?"figure":"img";t.conversion.for("upcast").attributeToAttribute({view:{name:N,styles:{width:/.+/}},model:{key:"width",value:K=>widthAndHeightStylesAreBothSet(K)?getSizeValueIfInPx(K.getStyle("width")):null}}).attributeToAttribute({view:{name:N,key:"width"},model:"width"}).attributeToAttribute({view:{name:N,styles:{height:/.+/}},model:{key:"height",value:K=>widthAndHeightStylesAreBothSet(K)?getSizeValueIfInPx(K.getStyle("height")):null}}).attributeToAttribute({view:{name:N,key:"height"},model:"height"}),t.conversion.for("editingDowncast").add(K=>{W(K,"width","width",!0),W(K,"height","height",!0)}),t.conversion.for("dataDowncast").add(K=>{W(K,"width","width",!1),W(K,"height","height",!1)});function W(K,G,Z,Y){K.on(`attribute:${G}:${B}`,(X,Q,te)=>{if(!te.consumable.consume(Q.item,X.name))return;const ie=te.writer,ne=te.mapper.toViewElement(Q.item),le=V.findViewImgElement(ne);if(Q.attributeNewValue!==null?ie.setAttribute(Z,Q.attributeNewValue,le):ie.removeAttribute(Z,le),Q.item.hasAttribute("sources"))return;const ae=Q.item.hasAttribute("resizedWidth");if(B==="imageInline"&&!ae&&!Y)return;const de=Q.item.getAttribute("width"),ce=Q.item.getAttribute("height");de&&ce&&ie.setStyle("aspect-ratio",`${de}/${ce}`,le)})}}}class ImageTypeCommand extends Command{constructor(t,V){super(t);ee(this,"_modelElementName");this._modelElementName=V}refresh(){const V=this.editor.plugins.get("ImageUtils"),N=V.getClosestSelectedImageElement(this.editor.model.document.selection);this._modelElementName==="imageBlock"?this.isEnabled=V.isInlineImage(N):this.isEnabled=V.isBlockImage(N)}execute(t={}){const V=this.editor,N=this.editor.model,W=V.plugins.get("ImageUtils"),K=W.getClosestSelectedImageElement(N.document.selection),G=Object.fromEntries(K.getAttributes());return!G.src&&!G.uploadId?null:N.change(Z=>{const{setImageSizes:Y=!0}=t,X=Array.from(N.markers).filter(ie=>ie.getRange().containsItem(K)),Q=W.insertImage(G,N.createSelection(K,"on"),this._modelElementName,{setImageSizes:Y});if(!Q)return null;const te=Z.createRangeOn(Q);for(const ie of X){const ne=ie.getRange(),le=ne.root.rootName!="$graveyard"?ne.getJoined(te,!0):te;Z.updateMarker(ie,{range:le})}return{oldElement:K,newElement:Q}})}}class ImagePlaceholder extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImagePlaceholder"}afterInit(){this._setupSchema(),this._setupConversion(),this._setupLoadListener()}_setupSchema(){const B=this.editor.model.schema;B.isRegistered("imageBlock")&&B.extend("imageBlock",{allowAttributes:["placeholder"]}),B.isRegistered("imageInline")&&B.extend("imageInline",{allowAttributes:["placeholder"]})}_setupConversion(){const B=this.editor,t=B.conversion,V=B.plugins.get("ImageUtils");t.for("editingDowncast").add(N=>{N.on("attribute:placeholder",(W,K,G)=>{if(!G.consumable.test(K.item,W.name)||!K.item.is("element","imageBlock")&&!K.item.is("element","imageInline"))return;G.consumable.consume(K.item,W.name);const Z=G.writer,Y=G.mapper.toViewElement(K.item),X=V.findViewImgElement(Y);K.attributeNewValue?(Z.addClass("image_placeholder",X),Z.setStyle("background-image",`url(${K.attributeNewValue})`,X),Z.setCustomProperty("editingPipeline:doNotReuseOnce",!0,X)):(Z.removeClass("image_placeholder",X),Z.removeStyle("background-image",X))})})}_setupLoadListener(){const B=this.editor,t=B.model,V=B.editing,N=V.view,W=B.plugins.get("ImageUtils");N.addObserver(ImageLoadObserver),this.listenTo(N.document,"imageLoaded",(K,G)=>{const Z=N.domConverter.mapDomToView(G.target);if(!Z)return;const Y=W.getImageWidgetFromImageView(Z);if(!Y)return;const X=V.mapper.toModelElement(Y);!X||!X.hasAttribute("placeholder")||t.enqueueChange({isUndoable:!1},Q=>{Q.removeAttribute("placeholder",X)})})}}class ImageBlockEditing extends Plugin{static get requires(){return[ImageEditing,ImageSizeAttributes,ImageUtils,ImagePlaceholder,ClipboardPipeline]}static get pluginName(){return"ImageBlockEditing"}init(){const B=this.editor;B.model.schema.register("imageBlock",{inheritAllFrom:"$blockObject",allowAttributes:["alt","src","srcset"]}),this._setupConversion(),B.plugins.has("ImageInlineEditing")&&(B.commands.add("imageTypeBlock",new ImageTypeCommand(this.editor,"imageBlock")),this._setupClipboardIntegration())}_setupConversion(){const B=this.editor,t=B.t,V=B.conversion,N=B.plugins.get("ImageUtils");V.for("dataDowncast").elementToStructure({model:"imageBlock",view:(W,{writer:K})=>createBlockImageViewElement(K)}),V.for("editingDowncast").elementToStructure({model:"imageBlock",view:(W,{writer:K})=>N.toImageWidget(createBlockImageViewElement(K),K,t("image widget"))}),V.for("downcast").add(downcastImageAttribute(N,"imageBlock","src")).add(downcastImageAttribute(N,"imageBlock","alt")).add(downcastSrcsetAttribute(N,"imageBlock")),V.for("upcast").elementToElement({view:getImgViewElementMatcher(B,"imageBlock"),model:(W,{writer:K})=>K.createElement("imageBlock",W.hasAttribute("src")?{src:W.getAttribute("src")}:void 0)}).add(upcastImageFigure(N))}_setupClipboardIntegration(){const B=this.editor,t=B.model,V=B.editing.view,N=B.plugins.get("ImageUtils"),W=B.plugins.get("ClipboardPipeline");this.listenTo(W,"inputTransformation",(K,G)=>{const Z=Array.from(G.content.getChildren());let Y;if(!Z.every(N.isInlineImageView))return;G.targetRanges?Y=B.editing.mapper.toModelRange(G.targetRanges[0]):Y=t.document.selection.getFirstRange();const X=t.createSelection(Y);if(determineImageTypeForInsertionAtSelection(t.schema,X)==="imageBlock"){const Q=new UpcastWriter(V.document),te=Z.map(ie=>Q.createElement("figure",{class:"image"},ie));G.content=Q.createDocumentFragment(te)}}),this.listenTo(W,"contentInsertion",(K,G)=>{G.method==="paste"&&t.change(Z=>{const Y=Z.createRangeIn(G.content);for(const X of Y.getItems())X.is("element","imageBlock")&&N.setImageNaturalSizeAttributes(X)})})}}class ImageInsertFormView extends View{constructor(t,V=[]){super(t);ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"_focusables");ee(this,"_focusCycler");ee(this,"children");this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusables=new ViewCollection,this.children=this.createCollection(),this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});for(const N of V)this.children.add(N),this._focusables.add(N),N instanceof CollapsibleView&&this._focusables.addMany(N.children);this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-insert-form"],tabindex:-1},children:this.children})}render(){super.render(),submitHandler({view:this});for(const V of this._focusables)this.focusTracker.add(V.element);this.keystrokes.listenTo(this.element);const t=V=>V.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}}class ImageInsertUI extends Plugin{constructor(t){super(t);ee(this,"dropdownView");ee(this,"_integrations",new Map);t.config.define("image.insert.integrations",["upload","assetManager","url"])}static get pluginName(){return"ImageInsertUI"}static get requires(){return[ImageUtils]}init(){const t=this.editor,V=t.model.document.selection,N=t.plugins.get("ImageUtils");this.set("isImageSelected",!1),this.listenTo(t.model.document,"change",()=>{this.isImageSelected=N.isImage(V.getSelectedElement())});const W=G=>this._createToolbarComponent(G),K=G=>this._createMenuBarComponent(G);t.ui.componentFactory.add("insertImage",W),t.ui.componentFactory.add("imageInsert",W),t.ui.componentFactory.add("menuBar:insertImage",K)}registerIntegration({name:t,observable:V,buttonViewCreator:N,formViewCreator:W,menuBarButtonViewCreator:K,requiresForm:G=!1}){this._integrations.has(t)&&logWarning("image-insert-integration-exists",{name:t}),this._integrations.set(t,{observable:V,buttonViewCreator:N,menuBarButtonViewCreator:K,formViewCreator:W,requiresForm:G})}_createToolbarComponent(t){const V=this.editor,N=t.t,W=this._prepareIntegrations();if(!W.length)return null;let K;const G=W[0];if(W.length==1){if(!G.requiresForm)return G.buttonViewCreator(!0);K=G.buttonViewCreator(!0)}else{const X=G.buttonViewCreator(!1);K=new SplitButtonView(t,X),K.tooltip=!0,K.bind("label").to(this,"isImageSelected",Q=>N(Q?"Replace image":"Insert image"))}const Z=this.dropdownView=createDropdown(t,K),Y=W.map(({observable:X})=>typeof X=="function"?X():X);return Z.bind("isEnabled").toMany(Y,"isEnabled",(...X)=>X.some(Q=>Q)),Z.once("change:isOpen",()=>{const X=W.map(({formViewCreator:te})=>te(W.length==1)),Q=new ImageInsertFormView(V.locale,X);Z.panelView.children.add(Q)}),Z}_createMenuBarComponent(t){const V=t.t,N=this._prepareIntegrations();if(!N.length)return null;let W;const K=N[0];if(N.length==1)W=K.menuBarButtonViewCreator(!0);else{W=new MenuBarMenuView(t);const G=new MenuBarMenuListView(t);W.panelView.children.add(G),W.buttonView.set({icon:icons.image,label:V("Image")});for(const Z of N){const Y=new MenuBarMenuListItemView(t,W),X=Z.menuBarButtonViewCreator(!1);Y.children.add(X),G.items.add(Y)}}return W}_prepareIntegrations(){const V=this.editor.config.get("image.insert.integrations"),N=[];if(!V.length)return logWarning("image-insert-integrations-not-specified"),N;for(const W of V){if(!this._integrations.has(W)){["upload","assetManager","url"].includes(W)||logWarning("image-insert-unknown-integration",{item:W});continue}N.push(this._integrations.get(W))}return N.length||logWarning("image-insert-integrations-not-registered"),N}}class ImageBlock extends Plugin{static get requires(){return[ImageBlockEditing,Widget,ImageTextAlternative,ImageInsertUI]}static get pluginName(){return"ImageBlock"}}class ImageCaptionUtils extends Plugin{static get pluginName(){return"ImageCaptionUtils"}static get requires(){return[ImageUtils]}getCaptionFromImageModelElement(B){for(const t of B.getChildren())if(t&&t.is("element","caption"))return t;return null}getCaptionFromModelSelection(B){const t=this.editor.plugins.get("ImageUtils"),V=B.getFirstPosition().findAncestor("caption");return V&&t.isBlockImage(V.parent)?V:null}matchImageCaptionViewElement(B){const t=this.editor.plugins.get("ImageUtils");return B.name=="figcaption"&&t.isBlockImageView(B.parent)?{name:!0}:null}}class ToggleImageCaptionCommand extends Command{refresh(){const B=this.editor,t=B.plugins.get("ImageCaptionUtils"),V=B.plugins.get("ImageUtils");if(!B.plugins.has(ImageBlockEditing)){this.isEnabled=!1,this.value=!1;return}const N=B.model.document.selection,W=N.getSelectedElement();if(!W){const K=t.getCaptionFromModelSelection(N);this.isEnabled=!!K,this.value=!!K;return}this.isEnabled=V.isImage(W),this.isEnabled?this.value=!!t.getCaptionFromImageModelElement(W):this.value=!1}execute(B={}){const{focusCaptionOnShow:t}=B;this.editor.model.change(V=>{this.value?this._hideImageCaption(V):this._showImageCaption(V,t)})}_showImageCaption(B,t){const N=this.editor.model.document.selection,W=this.editor.plugins.get("ImageCaptionEditing"),K=this.editor.plugins.get("ImageUtils");let G=N.getSelectedElement();const Z=W._getSavedCaption(G);K.isInlineImage(G)&&(this.editor.execute("imageTypeBlock"),G=N.getSelectedElement());const Y=Z||B.createElement("caption");B.append(Y,G),t&&B.setSelection(Y,"in")}_hideImageCaption(B){const t=this.editor,V=t.model.document.selection,N=t.plugins.get("ImageCaptionEditing"),W=t.plugins.get("ImageCaptionUtils");let K=V.getSelectedElement(),G;K?G=W.getCaptionFromImageModelElement(K):(G=W.getCaptionFromModelSelection(V),K=G.parent),N._saveCaption(K,G),B.setSelection(K,"on"),B.remove(G)}}class ImageCaptionEditing extends Plugin{constructor(t){super(t);ee(this,"_savedCaptionsMap");this._savedCaptionsMap=new WeakMap}static get requires(){return[ImageUtils,ImageCaptionUtils]}static get pluginName(){return"ImageCaptionEditing"}init(){const t=this.editor,V=t.model.schema;V.isRegistered("caption")?V.extend("caption",{allowIn:"imageBlock"}):V.register("caption",{allowIn:"imageBlock",allowContentOf:"$block",isLimit:!0}),t.commands.add("toggleImageCaption",new ToggleImageCaptionCommand(this.editor)),this._setupConversion(),this._setupImageTypeCommandsIntegration(),this._registerCaptionReconversion()}_setupConversion(){const t=this.editor,V=t.editing.view,N=t.plugins.get("ImageUtils"),W=t.plugins.get("ImageCaptionUtils"),K=t.t;t.conversion.for("upcast").elementToElement({view:G=>W.matchImageCaptionViewElement(G),model:"caption"}),t.conversion.for("dataDowncast").elementToElement({model:"caption",view:(G,{writer:Z})=>N.isBlockImage(G.parent)?Z.createContainerElement("figcaption"):null}),t.conversion.for("editingDowncast").elementToElement({model:"caption",view:(G,{writer:Z})=>{if(!N.isBlockImage(G.parent))return null;const Y=Z.createEditableElement("figcaption");Z.setCustomProperty("imageCaption",!0,Y),Y.placeholder=K("Enter image caption"),enablePlaceholder({view:V,element:Y,keepOnFocus:!0});const X=G.parent.getAttribute("alt"),Q=X?K("Caption for image: %0",[X]):K("Caption for the image");return toWidgetEditable(Y,Z,{label:Q})}})}_setupImageTypeCommandsIntegration(){const t=this.editor,V=t.plugins.get("ImageUtils"),N=t.plugins.get("ImageCaptionUtils"),W=t.commands.get("imageTypeInline"),K=t.commands.get("imageTypeBlock"),G=Z=>{if(!Z.return)return;const{oldElement:Y,newElement:X}=Z.return;/* istanbul ignore if: paranoid check -- @preserve */if(!Y)return;if(V.isBlockImage(Y)){const te=N.getCaptionFromImageModelElement(Y);if(te){this._saveCaption(X,te);return}}const Q=this._getSavedCaption(Y);Q&&this._saveCaption(X,Q)};W&&this.listenTo(W,"execute",G,{priority:"low"}),K&&this.listenTo(K,"execute",G,{priority:"low"})}_getSavedCaption(t){const V=this._savedCaptionsMap.get(t);return V?Element.fromJSON(V):null}_saveCaption(t,V){this._savedCaptionsMap.set(t,V.toJSON())}_registerCaptionReconversion(){const t=this.editor,V=t.model,N=t.plugins.get("ImageUtils"),W=t.plugins.get("ImageCaptionUtils");V.document.on("change:data",()=>{const K=V.document.differ.getChanges();for(const G of K){if(G.attributeKey!=="alt")continue;const Z=G.range.start.nodeAfter;if(N.isBlockImage(Z)){const Y=W.getCaptionFromImageModelElement(Z);if(!Y)return;t.editing.reconvertItem(Y)}}})}}class ImageCaptionUI extends Plugin{static get requires(){return[ImageCaptionUtils]}static get pluginName(){return"ImageCaptionUI"}init(){const B=this.editor,t=B.editing.view,V=B.plugins.get("ImageCaptionUtils"),N=B.t;B.ui.componentFactory.add("toggleImageCaption",W=>{const K=B.commands.get("toggleImageCaption"),G=new ButtonView(W);return G.set({icon:icons.caption,tooltip:!0,isToggleable:!0}),G.bind("isOn","isEnabled").to(K,"value","isEnabled"),G.bind("label").to(K,"value",Z=>N(Z?"Toggle caption off":"Toggle caption on")),this.listenTo(G,"execute",()=>{B.execute("toggleImageCaption",{focusCaptionOnShow:!0});const Z=V.getCaptionFromModelSelection(B.model.document.selection);if(Z){const Y=B.editing.mapper.toViewElement(Z);t.scrollToTheSelection(),t.change(X=>{X.addClass("image__caption_highlighted",Y)})}B.editing.view.focus()}),G})}}class ImageCaption extends Plugin{static get requires(){return[ImageCaptionEditing,ImageCaptionUI]}static get pluginName(){return"ImageCaption"}}function createImageTypeRegExp(H){const B=H.map(t=>t.replace("+","\\+"));return new RegExp(`^image\\/(${B.join("|")})$`)}function fetchLocalImage(H){return new Promise((B,t)=>{const V=H.getAttribute("src");fetch(V).then(N=>N.blob()).then(N=>{const W=getImageMimeType(N,V),G=`image.${W.replace("image/","")}`,Z=new File([N],G,{type:W});B(Z)}).catch(N=>N&&N.name==="TypeError"?convertLocalImageOnCanvas(V).then(B).catch(t):t(N))})}function isLocalImage(H,B){return!H.isInlineImageView(B)||!B.getAttribute("src")?!1:!!B.getAttribute("src").match(/^data:image\/\w+;base64,/g)||!!B.getAttribute("src").match(/^blob:/g)}function getImageMimeType(H,B){return H.type?H.type:B.match(/data:(image\/\w+);base64/)?B.match(/data:(image\/\w+);base64/)[1].toLowerCase():"image/jpeg"}function convertLocalImageOnCanvas(H){return getBlobFromCanvas(H).then(B=>{const t=getImageMimeType(B,H),N=`image.${t.replace("image/","")}`;return new File([B],N,{type:t})})}function getBlobFromCanvas(H){return new Promise((B,t)=>{const V=global$1.document.createElement("img");V.addEventListener("load",()=>{const N=global$1.document.createElement("canvas");N.width=V.width,N.height=V.height,N.getContext("2d").drawImage(V,0,0),N.toBlob(K=>K?B(K):t())}),V.addEventListener("error",()=>t()),V.src=H})}class ImageUploadUI extends Plugin{static get pluginName(){return"ImageUploadUI"}init(){const B=this.editor;B.ui.componentFactory.add("uploadImage",()=>this._createToolbarButton()),B.ui.componentFactory.add("imageUpload",()=>this._createToolbarButton()),B.ui.componentFactory.add("menuBar:uploadImage",()=>this._createMenuBarButton("standalone")),B.plugins.has("ImageInsertUI")&&B.plugins.get("ImageInsertUI").registerIntegration({name:"upload",observable:()=>B.commands.get("uploadImage"),buttonViewCreator:()=>this._createToolbarButton(),formViewCreator:()=>this._createDropdownButton(),menuBarButtonViewCreator:t=>this._createMenuBarButton(t?"insertOnly":"insertNested")})}_createButton(B){const t=this.editor,V=t.locale,N=t.commands.get("uploadImage"),W=t.config.get("image.upload.types"),K=createImageTypeRegExp(W),G=new B(t.locale),Z=V.t;return G.set({acceptedType:W.map(Y=>`image/${Y}`).join(","),allowMultipleFiles:!0,label:Z("Upload from computer"),icon:icons.imageUpload}),G.bind("isEnabled").to(N),G.on("done",(Y,X)=>{const Q=Array.from(X).filter(te=>K.test(te.type));Q.length&&(t.execute("uploadImage",{file:Q}),t.editing.view.focus())}),G}_createToolbarButton(){const B=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),V=this.editor.commands.get("uploadImage"),N=this._createButton(FileDialogButtonView);return N.tooltip=!0,N.bind("label").to(t,"isImageSelected",V,"isAccessAllowed",(W,K)=>B(K?W?"Replace image from computer":"Upload image from computer":"You have no image upload permissions.")),N}_createDropdownButton(){const B=this.editor.locale.t,t=this.editor.plugins.get("ImageInsertUI"),V=this._createButton(FileDialogButtonView);return V.withText=!0,V.bind("label").to(t,"isImageSelected",N=>B(N?"Replace from computer":"Upload from computer")),V.on("execute",()=>{t.dropdownView.isOpen=!1}),V}_createMenuBarButton(B){const t=this.editor.locale.t,V=this._createButton(MenuBarMenuListItemFileDialogButtonView);switch(V.withText=!0,B){case"standalone":V.label=t("Image from computer");break;case"insertOnly":V.label=t("Image");break;case"insertNested":V.label=t("From computer");break}return V}}class ImageUploadProgress extends Plugin{constructor(t){super(t);ee(this,"placeholder");ee(this,"uploadStatusChange",(t,V,N)=>{const W=this.editor,K=V.item,G=K.getAttribute("uploadId");if(!N.consumable.consume(V.item,t.name))return;const Z=W.plugins.get("ImageUtils"),Y=W.plugins.get(FileRepository),X=G?V.attributeNewValue:null,Q=this.placeholder,te=W.editing.mapper.toViewElement(K),ie=N.writer;if(X=="reading"){_startAppearEffect(te,ie),_showPlaceholder(Z,Q,te,ie);return}if(X=="uploading"){const ne=Y.loaders.get(G);_startAppearEffect(te,ie),ne?(_hidePlaceholder(te,ie),_showProgressBar(te,ie,ne,W.editing.view),_displayLocalImage(Z,te,ie,ne)):_showPlaceholder(Z,Q,te,ie);return}X=="complete"&&Y.loaders.get(G)&&_showCompleteIcon(te,ie,W.editing.view),_hideProgressBar(te,ie),_hidePlaceholder(te,ie),_stopAppearEffect(te,ie)});this.placeholder="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}static get pluginName(){return"ImageUploadProgress"}init(){const t=this.editor;t.plugins.has("ImageBlockEditing")&&t.editing.downcastDispatcher.on("attribute:uploadStatus:imageBlock",this.uploadStatusChange),t.plugins.has("ImageInlineEditing")&&t.editing.downcastDispatcher.on("attribute:uploadStatus:imageInline",this.uploadStatusChange)}}function _startAppearEffect(H,B){H.hasClass("ck-appear")||B.addClass("ck-appear",H)}function _stopAppearEffect(H,B){B.removeClass("ck-appear",H)}function _showPlaceholder(H,B,t,V){t.hasClass("ck-image-upload-placeholder")||V.addClass("ck-image-upload-placeholder",t);const N=H.findViewImgElement(t);N.getAttribute("src")!==B&&V.setAttribute("src",B,N),_getUIElement(t,"placeholder")||V.insert(V.createPositionAfter(N),_createPlaceholder(V))}function _hidePlaceholder(H,B){H.hasClass("ck-image-upload-placeholder")&&B.removeClass("ck-image-upload-placeholder",H),_removeUIElement(H,B,"placeholder")}function _showProgressBar(H,B,t,V){const N=_createProgressBar(B);B.insert(B.createPositionAt(H,"end"),N),t.on("change:uploadedPercent",(W,K,G)=>{V.change(Z=>{Z.setStyle("width",G+"%",N)})})}function _hideProgressBar(H,B){_removeUIElement(H,B,"progressBar")}function _showCompleteIcon(H,B,t){const V=B.createUIElement("div",{class:"ck-image-upload-complete-icon"});B.insert(B.createPositionAt(H,"end"),V),setTimeout(()=>{t.change(N=>N.remove(N.createRangeOn(V)))},3e3)}function _createProgressBar(H){const B=H.createUIElement("div",{class:"ck-progress-bar"});return H.setCustomProperty("progressBar",!0,B),B}function _createPlaceholder(H){const B=H.createUIElement("div",{class:"ck-upload-placeholder-loader"});return H.setCustomProperty("placeholder",!0,B),B}function _getUIElement(H,B){for(const t of H.getChildren())if(t.getCustomProperty(B))return t}function _removeUIElement(H,B,t){const V=_getUIElement(H,t);V&&B.remove(B.createRangeOn(V))}function _displayLocalImage(H,B,t,V){if(V.data){const N=H.findViewImgElement(B);t.setAttribute("src",V.data,N)}}class UploadImageCommand extends Command{constructor(B){super(B),this.set("isAccessAllowed",!0)}refresh(){const B=this.editor,t=B.plugins.get("ImageUtils"),V=B.model.document.selection.getSelectedElement();this.isEnabled=t.isImageAllowed()||t.isImage(V)}execute(B){const t=toArray$2(B.file),V=this.editor.model.document.selection,N=this.editor.plugins.get("ImageUtils"),W=Object.fromEntries(V.getAttributes());t.forEach((K,G)=>{const Z=V.getSelectedElement();if(G&&Z&&N.isImage(Z)){const Y=this.editor.model.createPositionAfter(Z);this._uploadImage(K,W,Y)}else this._uploadImage(K,W)})}_uploadImage(B,t,V){const N=this.editor,K=N.plugins.get(FileRepository).createLoader(B),G=N.plugins.get("ImageUtils");K&&G.insertImage({...t,uploadId:K.id},V)}}class ImageUploadEditing extends Plugin{constructor(t){super(t);ee(this,"_uploadImageElements");t.config.define("image",{upload:{types:["jpeg","png","gif","bmp","webp","tiff"]}}),this._uploadImageElements=new Map}static get requires(){return[FileRepository,Notification,ClipboardPipeline,ImageUtils]}static get pluginName(){return"ImageUploadEditing"}init(){const t=this.editor,V=t.model.document,N=t.conversion,W=t.plugins.get(FileRepository),K=t.plugins.get("ImageUtils"),G=t.plugins.get("ClipboardPipeline"),Z=createImageTypeRegExp(t.config.get("image.upload.types")),Y=new UploadImageCommand(t);t.commands.add("uploadImage",Y),t.commands.add("imageUpload",Y),N.for("upcast").attributeToAttribute({view:{name:"img",key:"uploadId"},model:"uploadId"}),this.listenTo(t.editing.view.document,"clipboardInput",(X,Q)=>{if(isHtmlIncluded(Q.dataTransfer))return;const te=Array.from(Q.dataTransfer.files).filter(ne=>ne?Z.test(ne.type):!1);if(!te.length)return;if(X.stop(),t.model.change(ne=>{Q.targetRanges&&ne.setSelection(Q.targetRanges.map(le=>t.editing.mapper.toModelRange(le))),t.execute("uploadImage",{file:te})}),!t.commands.get("uploadImage").isAccessAllowed){const ne=t.plugins.get("Notification"),le=t.locale.t;ne.showWarning(le("You have no image upload permissions."),{namespace:"image"})}}),this.listenTo(G,"inputTransformation",(X,Q)=>{const te=Array.from(t.editing.view.createRangeIn(Q.content)).map(ne=>ne.item).filter(ne=>isLocalImage(K,ne)&&!ne.getAttribute("uploadProcessed")).map(ne=>({promise:fetchLocalImage(ne),imageElement:ne}));if(!te.length)return;const ie=new UpcastWriter(t.editing.view.document);for(const ne of te){ie.setAttribute("uploadProcessed",!0,ne.imageElement);const le=W.createLoader(ne.promise);le&&(ie.setAttribute("src","",ne.imageElement),ie.setAttribute("uploadId",le.id,ne.imageElement))}}),t.editing.view.document.on("dragover",(X,Q)=>{Q.preventDefault()}),V.on("change",()=>{const X=V.differ.getChanges({includeChangesInGraveyard:!0}).reverse(),Q=new Set;for(const te of X)if(te.type=="insert"&&te.name!="$text"){const ie=te.position.nodeAfter,ne=te.position.root.rootName=="$graveyard";for(const le of getImagesFromChangeItem(t,ie)){const ae=le.getAttribute("uploadId");if(!ae)continue;const de=W.loaders.get(ae);de&&(ne?Q.has(ae)||de.abort():(Q.add(ae),this._uploadImageElements.set(ae,le),de.status=="idle"&&this._readAndUpload(de)))}}}),this.on("uploadComplete",(X,{imageElement:Q,data:te})=>{const ie=te.urls?te.urls:te;this.editor.model.change(ne=>{ne.setAttribute("src",ie.default,Q),this._parseAndSetSrcsetAttributeOnImage(ie,Q,ne),K.setImageNaturalSizeAttributes(Q)})},{priority:"low"})}afterInit(){const t=this.editor.model.schema;this.editor.plugins.has("ImageBlockEditing")&&t.extend("imageBlock",{allowAttributes:["uploadId","uploadStatus"]}),this.editor.plugins.has("ImageInlineEditing")&&t.extend("imageInline",{allowAttributes:["uploadId","uploadStatus"]})}_readAndUpload(t){const V=this.editor,N=V.model,W=V.locale.t,K=V.plugins.get(FileRepository),G=V.plugins.get(Notification),Z=V.plugins.get("ImageUtils"),Y=this._uploadImageElements;return N.enqueueChange({isUndoable:!1},Q=>{Q.setAttribute("uploadStatus","reading",Y.get(t.id))}),t.read().then(()=>{const Q=t.upload(),te=Y.get(t.id);/* istanbul ignore next -- @preserve */if(env.isSafari){const ie=V.editing.mapper.toViewElement(te),ne=Z.findViewImgElement(ie);V.editing.view.once("render",()=>{if(!ne.parent)return;const le=V.editing.view.domConverter.mapViewToDom(ne.parent);if(!le)return;const ae=le.style.display;le.style.display="none",le._ckHack=le.offsetHeight,le.style.display=ae})}return V.ui&&V.ui.ariaLiveAnnouncer.announce(W("Uploading image")),N.enqueueChange({isUndoable:!1},ie=>{ie.setAttribute("uploadStatus","uploading",te)}),Q}).then(Q=>{N.enqueueChange({isUndoable:!1},te=>{const ie=Y.get(t.id);te.setAttribute("uploadStatus","complete",ie),V.ui&&V.ui.ariaLiveAnnouncer.announce(W("Image upload complete")),this.fire("uploadComplete",{data:Q,imageElement:ie})}),X()}).catch(Q=>{if(V.ui&&V.ui.ariaLiveAnnouncer.announce(W("Error during image upload")),t.status!=="error"&&t.status!=="aborted")throw Q;t.status=="error"&&Q&&G.showWarning(Q,{title:W("Upload failed"),namespace:"upload"}),N.enqueueChange({isUndoable:!1},te=>{te.remove(Y.get(t.id))}),X()});function X(){N.enqueueChange({isUndoable:!1},Q=>{const te=Y.get(t.id);Q.removeAttribute("uploadId",te),Q.removeAttribute("uploadStatus",te),Y.delete(t.id)}),K.destroyLoader(t)}}_parseAndSetSrcsetAttributeOnImage(t,V,N){let W=0;const K=Object.keys(t).filter(G=>{const Z=parseInt(G,10);if(!isNaN(Z))return W=Math.max(W,Z),!0}).map(G=>`${t[G]} ${G}w`).join(", ");if(K!=""){const G={srcset:K};!V.hasAttribute("width")&&!V.hasAttribute("height")&&(G.width=W),N.setAttributes(G,V)}}}function isHtmlIncluded(H){return Array.from(H.types).includes("text/html")&&H.getData("text/html")!==""}function getImagesFromChangeItem(H,B){const t=H.plugins.get("ImageUtils");return Array.from(H.model.createRangeOn(B)).filter(V=>t.isImage(V.item)).map(V=>V.item)}class ImageUpload extends Plugin{static get pluginName(){return"ImageUpload"}static get requires(){return[ImageUploadEditing,ImageUploadUI,ImageUploadProgress]}}class ImageInsertUrlView extends View{constructor(t){super(t);ee(this,"urlInputView");ee(this,"keystrokes");this.set("imageURLInputValue",""),this.set("isImageSelected",!1),this.set("isEnabled",!0),this.keystrokes=new KeystrokeHandler,this.urlInputView=this._createUrlInputView(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-image-insert-url"]},children:[this.urlInputView,{tag:"div",attributes:{class:["ck","ck-image-insert-url__action-row"]}}]})}render(){super.render(),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.keystrokes.destroy()}_createUrlInputView(){const t=this.locale,V=t.t,N=new LabeledFieldView(t,createLabeledInputText);return N.bind("label").to(this,"isImageSelected",W=>V(W?"Update image URL":"Insert image via URL")),N.bind("isEnabled").to(this),N.fieldView.inputMode="url",N.fieldView.placeholder="https://example.com/image.png",N.fieldView.bind("value").to(this,"imageURLInputValue",W=>W||""),N.fieldView.on("input",()=>{this.imageURLInputValue=N.fieldView.element.value.trim()}),N}focus(){this.urlInputView.focus()}}class ImageInsertViaUrlUI extends Plugin{constructor(){super(...arguments);ee(this,"_imageInsertUI");ee(this,"_formView")}static get pluginName(){return"ImageInsertViaUrlUI"}static get requires(){return[ImageInsertUI,Dialog]}init(){this.editor.ui.componentFactory.add("insertImageViaUrl",()=>this._createToolbarButton()),this.editor.ui.componentFactory.add("menuBar:insertImageViaUrl",()=>this._createMenuBarButton("standalone"))}afterInit(){this._imageInsertUI=this.editor.plugins.get("ImageInsertUI"),this._imageInsertUI.registerIntegration({name:"url",observable:()=>this.editor.commands.get("insertImage"),buttonViewCreator:()=>this._createToolbarButton(),formViewCreator:()=>this._createDropdownButton(),menuBarButtonViewCreator:t=>this._createMenuBarButton(t?"insertOnly":"insertNested")})}_createInsertUrlButton(t){const V=new t(this.editor.locale);return V.icon=icons.imageUrl,V.on("execute",()=>{this._showModal()}),V}_createToolbarButton(){const t=this.editor.locale.t,V=this._createInsertUrlButton(ButtonView);return V.tooltip=!0,V.bind("label").to(this._imageInsertUI,"isImageSelected",N=>t(N?"Update image URL":"Insert image via URL")),V}_createDropdownButton(){const t=this.editor.locale.t,V=this._createInsertUrlButton(ButtonView);return V.withText=!0,V.bind("label").to(this._imageInsertUI,"isImageSelected",N=>t(N?"Update image URL":"Insert via URL")),V}_createMenuBarButton(t){const V=this.editor.locale.t,N=this._createInsertUrlButton(MenuBarMenuListItemButtonView);switch(N.withText=!0,t){case"standalone":N.label=V("Image via URL");break;case"insertOnly":N.label=V("Image");break;case"insertNested":N.label=V("Via URL");break}return N}_createInsertUrlView(){const t=this.editor,V=t.locale,N=t.commands.get("replaceImageSource"),W=t.commands.get("insertImage"),K=new ImageInsertUrlView(V);return K.bind("isImageSelected").to(this._imageInsertUI),K.bind("isEnabled").toMany([W,N],"isEnabled",(...G)=>G.some(Z=>Z)),K}_showModal(){const t=this.editor,N=t.locale.t,W=t.plugins.get("Dialog");this._formView||(this._formView=this._createInsertUrlView(),this._formView.on("submit",()=>this._handleSave()));const K=t.commands.get("replaceImageSource");this._formView.imageURLInputValue=K.value||"",W.show({id:"insertImageViaUrl",title:this._imageInsertUI.isImageSelected?N("Update image URL"):N("Insert image via URL"),isModal:!0,content:this._formView,actionButtons:[{label:N("Cancel"),withText:!0,onExecute:()=>W.hide()},{label:N("Accept"),class:"ck-button-action",withText:!0,onExecute:()=>this._handleSave()}]})}_handleSave(){this.editor.commands.get("replaceImageSource").isEnabled?this.editor.execute("replaceImageSource",{source:this._formView.imageURLInputValue}):this.editor.execute("insertImage",{source:this._formView.imageURLInputValue}),this.editor.plugins.get("Dialog").hide()}}class ImageInsertViaUrl extends Plugin{static get pluginName(){return"ImageInsertViaUrl"}static get requires(){return[ImageInsertViaUrlUI,ImageInsertUI]}}class ImageInsert extends Plugin{static get pluginName(){return"ImageInsert"}static get requires(){return[ImageUpload,ImageInsertViaUrl,ImageInsertUI]}}class ResizeImageCommand extends Command{refresh(){const B=this.editor,V=B.plugins.get("ImageUtils").getClosestSelectedImageElement(B.model.document.selection);this.isEnabled=!!V,!V||!V.hasAttribute("resizedWidth")?this.value=null:this.value={width:V.getAttribute("resizedWidth"),height:null}}execute(B){const t=this.editor,V=t.model,N=t.plugins.get("ImageUtils"),W=N.getClosestSelectedImageElement(V.document.selection);this.value={width:B.width,height:null},W&&V.change(K=>{K.setAttribute("resizedWidth",B.width,W),K.removeAttribute("resizedHeight",W),N.setImageNaturalSizeAttributes(W)})}}class ImageResizeEditing extends Plugin{static get requires(){return[ImageUtils]}static get pluginName(){return"ImageResizeEditing"}constructor(B){super(B),B.config.define("image",{resizeUnit:"%",resizeOptions:[{name:"resizeImage:original",value:null,icon:"original"},{name:"resizeImage:custom",value:"custom",icon:"custom"},{name:"resizeImage:25",value:"25",icon:"small"},{name:"resizeImage:50",value:"50",icon:"medium"},{name:"resizeImage:75",value:"75",icon:"large"}]})}init(){const B=this.editor,t=new ResizeImageCommand(B);this._registerConverters("imageBlock"),this._registerConverters("imageInline"),B.commands.add("resizeImage",t),B.commands.add("imageResize",t)}afterInit(){this._registerSchema()}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["resizedWidth","resizedHeight"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["resizedWidth","resizedHeight"]})}_registerConverters(B){const t=this.editor,V=t.plugins.get("ImageUtils");t.conversion.for("downcast").add(N=>N.on(`attribute:resizedWidth:${B}`,(W,K,G)=>{if(!G.consumable.consume(K.item,W.name))return;const Z=G.writer,Y=G.mapper.toViewElement(K.item);K.attributeNewValue!==null?(Z.setStyle("width",K.attributeNewValue,Y),Z.addClass("image_resized",Y)):(Z.removeStyle("width",Y),Z.removeClass("image_resized",Y))})),t.conversion.for("dataDowncast").attributeToAttribute({model:{name:B,key:"resizedHeight"},view:N=>({key:"style",value:{height:N}})}),t.conversion.for("editingDowncast").add(N=>N.on(`attribute:resizedHeight:${B}`,(W,K,G)=>{if(!G.consumable.consume(K.item,W.name))return;const Z=G.writer,Y=G.mapper.toViewElement(K.item),X=B==="imageInline"?V.findViewImgElement(Y):Y;K.attributeNewValue!==null?Z.setStyle("height",K.attributeNewValue,X):Z.removeStyle("height",X)})),t.conversion.for("upcast").attributeToAttribute({view:{name:B==="imageBlock"?"figure":"img",styles:{width:/.+/}},model:{key:"resizedWidth",value:N=>widthAndHeightStylesAreBothSet(N)?null:N.getStyle("width")}}),t.conversion.for("upcast").attributeToAttribute({view:{name:B==="imageBlock"?"figure":"img",styles:{height:/.+/}},model:{key:"resizedHeight",value:N=>widthAndHeightStylesAreBothSet(N)?null:N.getStyle("height")}})}}const RESIZE_ICONS={small:icons.objectSizeSmall,medium:icons.objectSizeMedium,large:icons.objectSizeLarge,custom:icons.objectSizeCustom,original:icons.objectSizeFull};class ImageResizeButtons extends Plugin{constructor(t){super(t);ee(this,"_resizeUnit");this._resizeUnit=t.config.get("image.resizeUnit")}static get requires(){return[ImageResizeEditing]}static get pluginName(){return"ImageResizeButtons"}init(){const t=this.editor,V=t.config.get("image.resizeOptions"),N=t.commands.get("resizeImage");this.bind("isEnabled").to(N);for(const W of V)this._registerImageResizeButton(W);this._registerImageResizeDropdown(V)}_registerImageResizeButton(t){const V=this.editor,{name:N,value:W,icon:K}=t;V.ui.componentFactory.add(N,G=>{const Z=new ButtonView(G),Y=V.commands.get("resizeImage"),X=this._getOptionLabelValue(t,!0);if(!RESIZE_ICONS[K])throw new CKEditorError("imageresizebuttons-missing-icon",V,t);if(Z.set({label:X,icon:RESIZE_ICONS[K],tooltip:X,isToggleable:!0}),Z.bind("isEnabled").to(this),V.plugins.has("ImageCustomResizeUI")&&isCustomImageResizeOption(t)){const Q=V.plugins.get("ImageCustomResizeUI");this.listenTo(Z,"execute",()=>{Q._showForm(this._resizeUnit)})}else{const Q=W?W+this._resizeUnit:null;Z.bind("isOn").to(Y,"value",getIsOnButtonCallback(Q)),this.listenTo(Z,"execute",()=>{V.execute("resizeImage",{width:Q})})}return Z})}_registerImageResizeDropdown(t){const V=this.editor,N=V.t,W=t.find(G=>!G.value),K=G=>{const Z=V.commands.get("resizeImage"),Y=createDropdown(G,DropdownButtonView),X=Y.buttonView,Q=N("Resize image");return X.set({tooltip:Q,commandValue:W.value,icon:RESIZE_ICONS.medium,isToggleable:!0,label:this._getOptionLabelValue(W),withText:!0,class:"ck-resize-image-button",ariaLabel:Q,ariaLabelledBy:void 0}),X.bind("label").to(Z,"value",te=>te&&te.width?te.width:this._getOptionLabelValue(W)),Y.bind("isEnabled").to(this),addListToDropdown(Y,()=>this._getResizeDropdownListItemDefinitions(t,Z),{ariaLabel:N("Image resize list"),role:"menu"}),this.listenTo(Y,"execute",te=>{"onClick"in te.source?te.source.onClick():(V.execute(te.source.commandName,{width:te.source.commandValue}),V.editing.view.focus())}),Y};V.ui.componentFactory.add("resizeImage",K),V.ui.componentFactory.add("imageResize",K)}_getOptionLabelValue(t,V=!1){const N=this.editor.t;return t.label?t.label:V?isCustomImageResizeOption(t)?N("Custom image size"):t.value?N("Resize image to %0",t.value+this._resizeUnit):N("Resize image to the original size"):isCustomImageResizeOption(t)?N("Custom"):t.value?t.value+this._resizeUnit:N("Original")}_getResizeDropdownListItemDefinitions(t,V){const{editor:N}=this,W=new Collection,K=t.map(G=>isCustomImageResizeOption(G)?{...G,valueWithUnits:"custom"}:G.value?{...G,valueWithUnits:`${G.value}${this._resizeUnit}`}:{...G,valueWithUnits:null});for(const G of K){let Z=null;if(N.plugins.has("ImageCustomResizeUI")&&isCustomImageResizeOption(G)){const Y=N.plugins.get("ImageCustomResizeUI");Z={type:"button",model:new Model({label:this._getOptionLabelValue(G),role:"menuitemradio",withText:!0,icon:null,onClick:()=>{Y._showForm(this._resizeUnit)}})};const X=map$1(K,"valueWithUnits");Z.model.bind("isOn").to(V,"value",getIsOnCustomButtonCallback(X))}else Z={type:"button",model:new Model({commandName:"resizeImage",commandValue:G.valueWithUnits,label:this._getOptionLabelValue(G),role:"menuitemradio",withText:!0,icon:null})},Z.model.bind("isOn").to(V,"value",getIsOnButtonCallback(G.valueWithUnits));Z.model.bind("isEnabled").to(V,"isEnabled"),W.add(Z)}return W}}function isCustomImageResizeOption(H){return H.value==="custom"}function getIsOnButtonCallback(H){return B=>{const t=B;return H===null&&t===H?!0:t!==null&&t.width===H}}function getIsOnCustomButtonCallback(H){return B=>!H.some(t=>getIsOnButtonCallback(t)(B))}const RESIZABLE_IMAGES_CSS_SELECTOR="figure.image.ck-widget > img,figure.image.ck-widget > picture > img,figure.image.ck-widget > a > img,figure.image.ck-widget > a > picture > img,span.image-inline.ck-widget > img,span.image-inline.ck-widget > picture > img",RESIZED_IMAGE_CLASS="image_resized";class ImageResizeHandles extends Plugin{static get requires(){return[WidgetResize,ImageUtils]}static get pluginName(){return"ImageResizeHandles"}init(){const B=this.editor.commands.get("resizeImage");this.bind("isEnabled").to(B),this._setupResizerCreator()}_setupResizerCreator(){const B=this.editor,t=B.editing.view,V=B.plugins.get("ImageUtils");t.addObserver(ImageLoadObserver),this.listenTo(t.document,"imageLoaded",(N,W)=>{if(!W.target.matches(RESIZABLE_IMAGES_CSS_SELECTOR))return;const K=B.editing.view.domConverter,G=K.domToView(W.target),Z=V.getImageWidgetFromImageView(G);let Y=this.editor.plugins.get(WidgetResize).getResizerByViewElement(Z);if(Y){Y.redraw();return}const X=B.editing.mapper,Q=X.toModelElement(Z);Y=B.plugins.get(WidgetResize).attachTo({unit:B.config.get("image.resizeUnit"),modelElement:Q,viewElement:Z,editor:B,getHandleHost(te){return te.querySelector("img")},getResizeHost(){return K.mapViewToDom(X.toViewElement(Q))},isCentered(){return Q.getAttribute("imageStyle")=="alignCenter"},onCommit(te){t.change(ie=>{ie.removeClass(RESIZED_IMAGE_CLASS,Z)}),B.execute("resizeImage",{width:te})}}),Y.on("updateSize",()=>{Z.hasClass(RESIZED_IMAGE_CLASS)||t.change(ie=>{ie.addClass(RESIZED_IMAGE_CLASS,Z)});const te=Q.name==="imageInline"?G:Z;te.getStyle("height")&&t.change(ie=>{ie.removeStyle("height",te)})}),Y.bind("isEnabled").to(this)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function tryParseDimensionWithUnit(H){if(!H)return null;const[,B,t]=H.trim().match(/([.,\d]+)(%|px)$/)||[],V=Number.parseFloat(B);return Number.isNaN(V)?null:{value:V,unit:t}}function tryCastDimensionsToUnit(H,B,t){return t==="px"?{value:B.value,unit:"px"}:{value:B.value/H*100,unit:"%"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function getSelectedImageEditorNodes(H){const{editing:B}=H,V=H.plugins.get("ImageUtils").getClosestSelectedImageElement(H.model.document.selection);if(!V)return null;const N=B.mapper.toViewElement(V),W=B.view.domConverter.mapViewToDom(N);return{model:V,view:N,dom:W}}function getSelectedImageWidthInUnits(H,B){const t=getSelectedImageEditorNodes(H);if(!t)return null;const V=tryParseDimensionWithUnit(t.model.getAttribute("resizedWidth")||null);if(!V)return null;if(V.unit===B)return V;const N=calculateResizeHostAncestorWidth(t.dom),W={unit:"px",value:new Rect(t.dom).width};return tryCastDimensionsToUnit(N,W,B)}class ImageCustomResizeFormView extends View{constructor(t,V,N){super(t);ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"unit");ee(this,"labeledInput");ee(this,"saveButtonView");ee(this,"cancelButtonView");ee(this,"_focusables");ee(this,"_focusCycler");ee(this,"_validators");const W=this.locale.t;this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.unit=V,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(W("Save"),icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(W("Cancel"),icons.cancel,"ck-button-cancel","cancel"),this._focusables=new ViewCollection,this._validators=N,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-custom-resize-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),submitHandler({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(t,V,N,W){const K=new ButtonView(this.locale);return K.set({label:t,icon:V,tooltip:!0}),K.extendTemplate({attributes:{class:N}}),W&&K.delegate("execute").to(this,W),K}_createLabeledInputView(){const t=this.locale.t,V=new LabeledFieldView(this.locale,createLabeledInputNumber);return V.label=t("Resize image (in %0)",this.unit),V.fieldView.set({step:.1}),V}isValid(){this.resetFormStatus();for(const t of this._validators){const V=t(this);if(V)return this.labeledInput.errorText=V,!1}return!0}resetFormStatus(){this.labeledInput.errorText=null}get rawSize(){const{element:t}=this.labeledInput.fieldView;return t?t.value:null}get parsedSize(){const{rawSize:t}=this;if(t===null)return null;const V=Number.parseFloat(t);return Number.isNaN(V)?null:V}get sizeWithUnits(){const{parsedSize:t,unit:V}=this;return t===null?null:`${t}${V}`}}function getSelectedImagePossibleResizeRange(H,B){const t=getSelectedImageEditorNodes(H);if(!t)return null;const V=calculateResizeHostAncestorWidth(t.dom),N=tryParseDimensionWithUnit(window.getComputedStyle(t.dom).minWidth)||{value:1,unit:"px"},W=Math.max(.1,tryCastDimensionsToUnit(V,N,B).value);return{unit:B,lower:W,upper:B==="px"?V:100}}class ImageCustomResizeUI extends Plugin{constructor(){super(...arguments);ee(this,"_balloon");ee(this,"_form")}static get requires(){return[ContextualBalloon]}static get pluginName(){return"ImageCustomResizeUI"}destroy(){super.destroy(),this._form&&this._form.destroy()}_createForm(t){const V=this.editor;this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(CssTransitionDisablerMixin(ImageCustomResizeFormView))(V.locale,t,getFormValidators$1(V)),this._form.render(),this.listenTo(this._form,"submit",()=>{this._form.isValid()&&(V.execute("resizeImage",{width:this._form.sizeWithUnits}),this._hideForm(!0))}),this.listenTo(this._form.labeledInput,"change:errorText",()=>{V.ui.update()}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(N,W)=>{this._hideForm(!0),W()}),clickOutsideHandler({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(t){if(this._isVisible)return;this._form||this._createForm(t);const V=this.editor,N=this._form.labeledInput;this._form.disableCssTransitions(),this._form.resetFormStatus(),this._isInBalloon||this._balloon.add({view:this._form,position:getBalloonPositionData(V)});const W=getSelectedImageWidthInUnits(V,t),K=W?W.value.toFixed(1):"",G=getSelectedImagePossibleResizeRange(V,t);N.fieldView.value=N.fieldView.element.value=K,G&&Object.assign(N.fieldView,{min:G.lower.toFixed(1),max:Math.ceil(G.upper).toFixed(1)}),this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(t=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),t&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}function getFormValidators$1(H){const B=H.t;return[t=>{if(t.rawSize.trim()==="")return B("The value must not be empty.");if(t.parsedSize===null)return B("The value should be a plain number.")}]}class ImageResize extends Plugin{static get requires(){return[ImageResizeEditing,ImageResizeHandles,ImageCustomResizeUI,ImageResizeButtons]}static get pluginName(){return"ImageResize"}}class ImageStyleCommand extends Command{constructor(t,V){super(t);ee(this,"_defaultStyles");ee(this,"_styles");this._defaultStyles={imageBlock:!1,imageInline:!1},this._styles=new Map(V.map(N=>{if(N.isDefault)for(const W of N.modelElements)this._defaultStyles[W]=N.name;return[N.name,N]}))}refresh(){const N=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!N,this.isEnabled?N.hasAttribute("imageStyle")?this.value=N.getAttribute("imageStyle"):this.value=this._defaultStyles[N.name]:this.value=!1}execute(t={}){const V=this.editor,N=V.model,W=V.plugins.get("ImageUtils");N.change(K=>{const G=t.value,{setImageSizes:Z=!0}=t;let Y=W.getClosestSelectedImageElement(N.document.selection);G&&this.shouldConvertImageType(G,Y)&&(this.editor.execute(W.isBlockImage(Y)?"imageTypeInline":"imageTypeBlock",{setImageSizes:Z}),Y=W.getClosestSelectedImageElement(N.document.selection)),!G||this._styles.get(G).isDefault?K.removeAttribute("imageStyle",Y):K.setAttribute("imageStyle",G,Y),Z&&W.setImageNaturalSizeAttributes(Y)})}shouldConvertImageType(t,V){return!this._styles.get(t).modelElements.includes(V.name)}}const DEFAULT_OPTIONS={get inline(){return{name:"inline",title:"In line",icon:icons.objectInline,modelElements:["imageInline"],isDefault:!0}},get alignLeft(){return{name:"alignLeft",title:"Left aligned image",icon:icons.objectLeft,modelElements:["imageBlock","imageInline"],className:"image-style-align-left"}},get alignBlockLeft(){return{name:"alignBlockLeft",title:"Left aligned image",icon:icons.objectBlockLeft,modelElements:["imageBlock"],className:"image-style-block-align-left"}},get alignCenter(){return{name:"alignCenter",title:"Centered image",icon:icons.objectCenter,modelElements:["imageBlock"],className:"image-style-align-center"}},get alignRight(){return{name:"alignRight",title:"Right aligned image",icon:icons.objectRight,modelElements:["imageBlock","imageInline"],className:"image-style-align-right"}},get alignBlockRight(){return{name:"alignBlockRight",title:"Right aligned image",icon:icons.objectBlockRight,modelElements:["imageBlock"],className:"image-style-block-align-right"}},get block(){return{name:"block",title:"Centered image",icon:icons.objectCenter,modelElements:["imageBlock"],isDefault:!0}},get side(){return{name:"side",title:"Side image",icon:icons.objectRight,modelElements:["imageBlock"],className:"image-style-side"}}},DEFAULT_ICONS={full:icons.objectFullWidth,left:icons.objectBlockLeft,right:icons.objectBlockRight,center:icons.objectCenter,inlineLeft:icons.objectLeft,inlineRight:icons.objectRight,inline:icons.objectInline},DEFAULT_DROPDOWN_DEFINITIONS=[{name:"imageStyle:wrapText",title:"Wrap text",defaultItem:"imageStyle:alignLeft",items:["imageStyle:alignLeft","imageStyle:alignRight"]},{name:"imageStyle:breakText",title:"Break text",defaultItem:"imageStyle:block",items:["imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight"]}];function normalizeStyles(H){return(H.configuredStyles.options||[]).map(V=>normalizeDefinition(V)).filter(V=>isValidOption(V,H))}function getDefaultStylesConfiguration(H,B){return H&&B?{options:["inline","alignLeft","alignRight","alignCenter","alignBlockLeft","alignBlockRight","block","side"]}:H?{options:["block","side"]}:B?{options:["inline","alignLeft","alignRight"]}:{}}function getDefaultDropdownDefinitions(H){return H.has("ImageBlockEditing")&&H.has("ImageInlineEditing")?[...DEFAULT_DROPDOWN_DEFINITIONS]:[]}function normalizeDefinition(H){return typeof H=="string"?DEFAULT_OPTIONS[H]?H={...DEFAULT_OPTIONS[H]}:H={name:H}:H=extendStyle(DEFAULT_OPTIONS[H.name],H),typeof H.icon=="string"&&(H.icon=DEFAULT_ICONS[H.icon]||H.icon),H}function isValidOption(H,{isBlockPluginLoaded:B,isInlinePluginLoaded:t}){const{modelElements:V,name:N}=H;if(!V||!V.length||!N)return warnInvalidStyle({style:H}),!1;{const W=[B?"imageBlock":null,t?"imageInline":null];if(!V.some(K=>W.includes(K)))return logWarning("image-style-missing-dependency",{style:H,missingPlugins:V.map(K=>K==="imageBlock"?"ImageBlockEditing":"ImageInlineEditing")}),!1}return!0}function extendStyle(H,B){const t={...B};for(const V in H)Object.prototype.hasOwnProperty.call(B,V)||(t[V]=H[V]);return t}function warnInvalidStyle(H){logWarning("image-style-configuration-definition-invalid",H)}var utils={normalizeStyles,getDefaultStylesConfiguration,getDefaultDropdownDefinitions,warnInvalidStyle,DEFAULT_OPTIONS,DEFAULT_ICONS,DEFAULT_DROPDOWN_DEFINITIONS};function modelToViewStyleAttribute(H){return(B,t,V)=>{if(!V.consumable.consume(t.item,B.name))return;const N=getStyleDefinitionByName(t.attributeNewValue,H),W=getStyleDefinitionByName(t.attributeOldValue,H),K=V.mapper.toViewElement(t.item),G=V.writer;W&&G.removeClass(W.className,K),N&&G.addClass(N.className,K)}}function viewToModelStyleAttribute(H){const B={imageInline:H.filter(t=>!t.isDefault&&t.modelElements.includes("imageInline")),imageBlock:H.filter(t=>!t.isDefault&&t.modelElements.includes("imageBlock"))};return(t,V,N)=>{if(!V.modelRange)return;const W=V.viewItem,K=first(V.modelRange.getItems());if(K&&N.schema.checkAttribute(K,"imageStyle"))for(const G of B[K.name])N.consumable.consume(W,{classes:G.className})&&N.writer.setAttribute("imageStyle",G.name,K)}}function getStyleDefinitionByName(H,B){for(const t of B)if(t.name===H)return t}class ImageStyleEditing extends Plugin{constructor(){super(...arguments);ee(this,"normalizedStyles")}static get pluginName(){return"ImageStyleEditing"}static get requires(){return[ImageUtils]}init(){const{normalizeStyles:t,getDefaultStylesConfiguration:V}=utils,N=this.editor,W=N.plugins.has("ImageBlockEditing"),K=N.plugins.has("ImageInlineEditing");N.config.define("image.styles",V(W,K)),this.normalizedStyles=t({configuredStyles:N.config.get("image.styles"),isBlockPluginLoaded:W,isInlinePluginLoaded:K}),this._setupConversion(W,K),this._setupPostFixer(),N.commands.add("imageStyle",new ImageStyleCommand(N,this.normalizedStyles))}_setupConversion(t,V){const N=this.editor,W=N.model.schema,K=modelToViewStyleAttribute(this.normalizedStyles),G=viewToModelStyleAttribute(this.normalizedStyles);N.editing.downcastDispatcher.on("attribute:imageStyle",K),N.data.downcastDispatcher.on("attribute:imageStyle",K),t&&(W.extend("imageBlock",{allowAttributes:"imageStyle"}),N.data.upcastDispatcher.on("element:figure",G,{priority:"low"})),V&&(W.extend("imageInline",{allowAttributes:"imageStyle"}),N.data.upcastDispatcher.on("element:img",G,{priority:"low"}))}_setupPostFixer(){const t=this.editor,V=t.model.document,N=t.plugins.get(ImageUtils),W=new Map(this.normalizedStyles.map(K=>[K.name,K]));V.registerPostFixer(K=>{let G=!1;for(const Z of V.differ.getChanges())if(Z.type=="insert"||Z.type=="attribute"&&Z.attributeKey=="imageStyle"){let Y=Z.type=="insert"?Z.position.nodeAfter:Z.range.start.nodeAfter;if(Y&&Y.is("element","paragraph")&&Y.childCount>0&&(Y=Y.getChild(0)),!N.isImage(Y))continue;const X=Y.getAttribute("imageStyle");if(!X)continue;const Q=W.get(X);(!Q||!Q.modelElements.includes(Y.name))&&(K.removeAttribute("imageStyle",Y),G=!0)}return G})}}class ImageStyleUI extends Plugin{static get requires(){return[ImageStyleEditing]}static get pluginName(){return"ImageStyleUI"}get localizedDefaultStylesTitles(){const B=this.editor.t;return{"Wrap text":B("Wrap text"),"Break text":B("Break text"),"In line":B("In line"),"Full size image":B("Full size image"),"Side image":B("Side image"),"Left aligned image":B("Left aligned image"),"Centered image":B("Centered image"),"Right aligned image":B("Right aligned image")}}init(){const B=this.editor.plugins,t=this.editor.config.get("image.toolbar")||[],V=B.get("ImageStyleEditing"),N=translateStyles(V.normalizedStyles,this.localizedDefaultStylesTitles);for(const K of N)this._createButton(K);const W=translateStyles([...t.filter(isObject$2),...utils.getDefaultDropdownDefinitions(B)],this.localizedDefaultStylesTitles);for(const K of W)this._createDropdown(K,N)}_createDropdown(B,t){const V=this.editor.ui.componentFactory;V.add(B.name,N=>{let W;const{defaultItem:K,items:G,title:Z}=B,Y=G.filter(ie=>t.find(({name:ne})=>getUIComponentName(ne)===ie)).map(ie=>{const ne=V.create(ie);return ie===K&&(W=ne),ne});G.length!==Y.length&&utils.warnInvalidStyle({dropdown:B});const X=createDropdown(N,SplitButtonView),Q=X.buttonView,te=Q.arrowView;return addToolbarToDropdown(X,Y,{enableActiveItemFocusOnDropdownOpen:!0}),Q.set({label:getDropdownButtonTitle(Z,W.label),class:null,tooltip:!0}),te.unbind("label"),te.set({label:Z}),Q.bind("icon").toMany(Y,"isOn",(...ie)=>{const ne=ie.findIndex(identity);return ne<0?W.icon:Y[ne].icon}),Q.bind("label").toMany(Y,"isOn",(...ie)=>{const ne=ie.findIndex(identity);return getDropdownButtonTitle(Z,ne<0?W.label:Y[ne].label)}),Q.bind("isOn").toMany(Y,"isOn",(...ie)=>ie.some(identity)),Q.bind("class").toMany(Y,"isOn",(...ie)=>ie.some(identity)?"ck-splitbutton_flatten":void 0),Q.on("execute",()=>{Y.some(({isOn:ie})=>ie)?X.isOpen=!X.isOpen:W.fire("execute")}),X.bind("isEnabled").toMany(Y,"isEnabled",(...ie)=>ie.some(identity)),this.listenTo(X,"execute",()=>{this.editor.editing.view.focus()}),X})}_createButton(B){const t=B.name;this.editor.ui.componentFactory.add(getUIComponentName(t),V=>{const N=this.editor.commands.get("imageStyle"),W=new ButtonView(V);return W.set({label:B.title,icon:B.icon,tooltip:!0,isToggleable:!0}),W.bind("isEnabled").to(N,"isEnabled"),W.bind("isOn").to(N,"value",K=>K===t),W.on("execute",this._executeCommand.bind(this,t)),W})}_executeCommand(B){this.editor.execute("imageStyle",{value:B}),this.editor.editing.view.focus()}}function translateStyles(H,B){for(const t of H)B[t.title]&&(t.title=B[t.title]);return H}function getUIComponentName(H){return`imageStyle:${H}`}function getDropdownButtonTitle(H,B){return(H?H+": ":"")+B}class ImageStyle extends Plugin{static get requires(){return[ImageStyleEditing,ImageStyleUI]}static get pluginName(){return"ImageStyle"}}class ImageToolbar extends Plugin{static get requires(){return[WidgetToolbarRepository,ImageUtils]}static get pluginName(){return"ImageToolbar"}afterInit(){const B=this.editor,t=B.t,V=B.plugins.get(WidgetToolbarRepository),N=B.plugins.get("ImageUtils");V.register("image",{ariaLabel:t("Image toolbar"),items:normalizeDeclarativeConfig(B.config.get("image.toolbar")||[]),getRelatedElement:W=>N.getClosestSelectedImageWidget(W)})}}function normalizeDeclarativeConfig(H){return H.map(B=>isObject$2(B)?B.name:B)}class PictureEditing extends Plugin{static get requires(){return[ImageEditing,ImageUtils]}static get pluginName(){return"PictureEditing"}afterInit(){const B=this.editor;B.plugins.has("ImageBlockEditing")&&B.model.schema.extend("imageBlock",{allowAttributes:["sources"]}),B.plugins.has("ImageInlineEditing")&&B.model.schema.extend("imageInline",{allowAttributes:["sources"]}),this._setupConversion(),this._setupImageUploadEditingIntegration()}_setupConversion(){const B=this.editor,t=B.conversion,V=B.plugins.get("ImageUtils");t.for("upcast").add(upcastPicture(V)),t.for("downcast").add(downcastSourcesAttribute(V))}_setupImageUploadEditingIntegration(){const B=this.editor;if(!B.plugins.has("ImageUploadEditing"))return;const t=B.plugins.get("ImageUploadEditing");this.listenTo(t,"uploadComplete",(V,{imageElement:N,data:W})=>{const K=W.sources;K&&B.model.change(G=>{G.setAttributes({sources:K},N)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class AutomaticDecorators{constructor(){ee(this,"_definitions",new Set)}get length(){return this._definitions.size}add(B){Array.isArray(B)?B.forEach(t=>this._definitions.add(t)):this._definitions.add(B)}getDispatcher(){return B=>{B.on("attribute:linkHref",(t,V,N)=>{if(!N.consumable.test(V.item,"attribute:linkHref")||!(V.item.is("selection")||N.schema.isInline(V.item)))return;const W=N.writer,K=W.document.selection;for(const G of this._definitions){const Z=W.createAttributeElement("a",G.attributes,{priority:5});G.classes&&W.addClass(G.classes,Z);for(const Y in G.styles)W.setStyle(Y,G.styles[Y],Z);W.setCustomProperty("link",!0,Z),G.callback(V.attributeNewValue)?V.item.is("selection")?W.wrap(K.getFirstRange(),Z):W.wrap(N.mapper.toViewRange(V.range),Z):W.unwrap(N.mapper.toViewRange(V.range),Z)}},{priority:"high"})}}getDispatcherForLinkedImage(){return B=>{B.on("attribute:linkHref:imageBlock",(t,V,{writer:N,mapper:W})=>{const K=W.toViewElement(V.item),G=Array.from(K.getChildren()).find(Z=>Z.is("element","a"));for(const Z of this._definitions){const Y=toMap(Z.attributes);if(Z.callback(V.attributeNewValue)){for(const[X,Q]of Y)X==="class"?N.addClass(Q,G):N.setAttribute(X,Q,G);Z.classes&&N.addClass(Z.classes,G);for(const X in Z.styles)N.setStyle(X,Z.styles[X],G)}else{for(const[X,Q]of Y)X==="class"?N.removeClass(Q,G):N.removeAttribute(X,G);Z.classes&&N.removeClass(Z.classes,G);for(const X in Z.styles)N.removeStyle(X,G)}}})}}}const ATTRIBUTE_WHITESPACES=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,SAFE_URL_TEMPLATE="^(?:(?:<protocols>):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))",EMAIL_REG_EXP=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,PROTOCOL_REG_EXP=/^((\w+:(\/{2,})?)|(\W))/i,DEFAULT_LINK_PROTOCOLS=["https?","ftps?","mailto"],LINK_KEYSTROKE="Ctrl+K";function isLinkElement(H){return H.is("attributeElement")&&!!H.getCustomProperty("link")}function createLinkElement(H,{writer:B}){const t=B.createAttributeElement("a",{href:H},{priority:5});return B.setCustomProperty("link",!0,t),t}function ensureSafeUrl(H,B=DEFAULT_LINK_PROTOCOLS){const t=String(H),V=B.join("|"),N=new RegExp(`${SAFE_URL_TEMPLATE.replace("<protocols>",V)}`,"i");return isSafeUrl(t,N)?t:"#"}function isSafeUrl(H,B){return!!H.replace(ATTRIBUTE_WHITESPACES,"").match(B)}function getLocalizedDecorators(H,B){const t={"Open in a new tab":H("Open in a new tab"),Downloadable:H("Downloadable")};return B.forEach(V=>("label"in V&&t[V.label]&&(V.label=t[V.label]),V)),B}function normalizeDecorators(H){const B=[];if(H)for(const[t,V]of Object.entries(H)){const N=Object.assign({},V,{id:`link${upperFirst(t)}`});B.push(N)}return B}function isLinkableElement(H,B){return H?B.checkAttribute(H.name,"linkHref"):!1}function isEmail(H){return EMAIL_REG_EXP.test(H)}function addLinkProtocolIfApplicable(H,B){const t=isEmail(H)?"mailto:":B,V=!!t&&!linkHasProtocol(H);return H&&V?t+H:H}function linkHasProtocol(H){return PROTOCOL_REG_EXP.test(H)}function openLink(H){window.open(H,"_blank","noopener")}class LinkCommand extends Command{constructor(){super(...arguments);ee(this,"manualDecorators",new Collection);ee(this,"automaticDecorators",new AutomaticDecorators)}restoreManualDecoratorStates(){for(const t of this.manualDecorators)t.value=this._getDecoratorStateFromModel(t.id)}refresh(){const t=this.editor.model,V=t.document.selection,N=V.getSelectedElement()||first(V.getSelectedBlocks());isLinkableElement(N,t.schema)?(this.value=N.getAttribute("linkHref"),this.isEnabled=t.schema.checkAttribute(N,"linkHref")):(this.value=V.getAttribute("linkHref"),this.isEnabled=t.schema.checkAttributeInSelection(V,"linkHref"));for(const W of this.manualDecorators)W.value=this._getDecoratorStateFromModel(W.id)}execute(t,V={}){const N=this.editor.model,W=N.document.selection,K=[],G=[];for(const Z in V)V[Z]?K.push(Z):G.push(Z);N.change(Z=>{if(W.isCollapsed){const Y=W.getFirstPosition();if(W.hasAttribute("linkHref")){const X=extractTextFromSelection(W);let Q=findAttributeRange(Y,"linkHref",W.getAttribute("linkHref"),N);W.getAttribute("linkHref")===X&&(Q=this._updateLinkContent(N,Z,Q,t)),Z.setAttribute("linkHref",t,Q),K.forEach(te=>{Z.setAttribute(te,!0,Q)}),G.forEach(te=>{Z.removeAttribute(te,Q)}),Z.setSelection(Z.createPositionAfter(Q.end.nodeBefore))}else if(t!==""){const X=toMap(W.getAttributes());X.set("linkHref",t),K.forEach(te=>{X.set(te,!0)});const{end:Q}=N.insertContent(Z.createText(t,X),Y);Z.setSelection(Q)}["linkHref",...K,...G].forEach(X=>{Z.removeSelectionAttribute(X)})}else{const Y=N.schema.getValidRanges(W.getRanges(),"linkHref"),X=[];for(const te of W.getSelectedBlocks())N.schema.checkAttribute(te,"linkHref")&&X.push(Z.createRangeOn(te));const Q=X.slice();for(const te of Y)this._isRangeToUpdate(te,X)&&Q.push(te);for(const te of Q){let ie=te;if(Q.length===1){const ne=extractTextFromSelection(W);W.getAttribute("linkHref")===ne&&(ie=this._updateLinkContent(N,Z,te,t),Z.setSelection(Z.createSelection(ie)))}Z.setAttribute("linkHref",t,ie),K.forEach(ne=>{Z.setAttribute(ne,!0,ie)}),G.forEach(ne=>{Z.removeAttribute(ne,ie)})}}})}_getDecoratorStateFromModel(t){const V=this.editor.model,N=V.document.selection,W=N.getSelectedElement();return isLinkableElement(W,V.schema)?W.getAttribute(t):N.getAttribute(t)}_isRangeToUpdate(t,V){for(const N of V)if(N.containsRange(t))return!1;return!0}_updateLinkContent(t,V,N,W){const K=V.createText(W,{linkHref:W});return t.insertContent(K,N)}}function extractTextFromSelection(H){if(H.isCollapsed){const B=H.getFirstPosition();return B.textNode&&B.textNode.data}else{const B=Array.from(H.getFirstRange().getItems());if(B.length>1)return null;const t=B[0];return t.is("$text")||t.is("$textProxy")?t.data:null}}class UnlinkCommand extends Command{refresh(){const B=this.editor.model,t=B.document.selection,V=t.getSelectedElement();isLinkableElement(V,B.schema)?this.isEnabled=B.schema.checkAttribute(V,"linkHref"):this.isEnabled=B.schema.checkAttributeInSelection(t,"linkHref")}execute(){const B=this.editor,t=this.editor.model,V=t.document.selection,N=B.commands.get("link");t.change(W=>{const K=V.isCollapsed?[findAttributeRange(V.getFirstPosition(),"linkHref",V.getAttribute("linkHref"),t)]:t.schema.getValidRanges(V.getRanges(),"linkHref");for(const G of K)if(W.removeAttribute("linkHref",G),N)for(const Z of N.manualDecorators)W.removeAttribute(Z.id,G)})}}class ManualDecorator extends ObservableMixin(){constructor({id:t,label:V,attributes:N,classes:W,styles:K,defaultValue:G}){super();ee(this,"id");ee(this,"defaultValue");ee(this,"label");ee(this,"attributes");ee(this,"classes");ee(this,"styles");this.id=t,this.set("value",void 0),this.defaultValue=G,this.label=V,this.attributes=N,this.classes=W,this.styles=K}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}const HIGHLIGHT_CLASS="ck-link_selected",DECORATOR_AUTOMATIC="automatic",DECORATOR_MANUAL="manual",EXTERNAL_LINKS_REGEXP=/^(https?:)?\/\//;class LinkEditing extends Plugin{static get pluginName(){return"LinkEditing"}static get requires(){return[TwoStepCaretMovement,Input,ClipboardPipeline]}constructor(B){super(B),B.config.define("link",{allowCreatingEmptyLinks:!1,addTargetToExternalLinks:!1})}init(){const B=this.editor,t=this.editor.config.get("link.allowedProtocols");B.model.schema.extend("$text",{allowAttributes:"linkHref"}),B.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:createLinkElement}),B.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(W,K)=>createLinkElement(ensureSafeUrl(W,t),K)}),B.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:W=>W.getAttribute("href")}}),B.commands.add("link",new LinkCommand(B)),B.commands.add("unlink",new UnlinkCommand(B));const V=getLocalizedDecorators(B.t,normalizeDecorators(B.config.get("link.decorators")));this._enableAutomaticDecorators(V.filter(W=>W.mode===DECORATOR_AUTOMATIC)),this._enableManualDecorators(V.filter(W=>W.mode===DECORATOR_MANUAL)),B.plugins.get(TwoStepCaretMovement).registerAttribute("linkHref"),inlineHighlight(B,"linkHref","a",HIGHLIGHT_CLASS),this._enableLinkOpen(),this._enableSelectionAttributesFixer(),this._enableClipboardIntegration()}_enableAutomaticDecorators(B){const t=this.editor,N=t.commands.get("link").automaticDecorators;t.config.get("link.addTargetToExternalLinks")&&N.add({id:"linkIsExternal",mode:DECORATOR_AUTOMATIC,callback:W=>!!W&&EXTERNAL_LINKS_REGEXP.test(W),attributes:{target:"_blank",rel:"noopener noreferrer"}}),N.add(B),N.length&&t.conversion.for("downcast").add(N.getDispatcher())}_enableManualDecorators(B){if(!B.length)return;const t=this.editor,N=t.commands.get("link").manualDecorators;B.forEach(W=>{t.model.schema.extend("$text",{allowAttributes:W.id});const K=new ManualDecorator(W);N.add(K),t.conversion.for("downcast").attributeToElement({model:K.id,view:(G,{writer:Z,schema:Y},{item:X})=>{if((X.is("selection")||Y.isInline(X))&&G){const Q=Z.createAttributeElement("a",K.attributes,{priority:5});K.classes&&Z.addClass(K.classes,Q);for(const te in K.styles)Z.setStyle(te,K.styles[te],Q);return Z.setCustomProperty("link",!0,Q),Q}}}),t.conversion.for("upcast").elementToAttribute({view:{name:"a",...K._createPattern()},model:{key:K.id}})})}_enableLinkOpen(){const B=this.editor,V=B.editing.view.document;this.listenTo(V,"click",(N,W)=>{if(!(env.isMac?W.domEvent.metaKey:W.domEvent.ctrlKey))return;let G=W.domTarget;if(G.tagName.toLowerCase()!="a"&&(G=G.closest("a")),!G)return;const Z=G.getAttribute("href");Z&&(N.stop(),W.preventDefault(),openLink(Z))},{context:"$capture"}),this.listenTo(V,"keydown",(N,W)=>{const G=B.commands.get("link").value;G&&W.keyCode===keyCodes.enter&&W.altKey&&(N.stop(),openLink(G))})}_enableSelectionAttributesFixer(){const t=this.editor.model,V=t.document.selection;this.listenTo(V,"change:attribute",(N,{attributeKeys:W})=>{!W.includes("linkHref")||V.hasAttribute("linkHref")||t.change(K=>{removeLinkAttributesFromSelection(K,getLinkAttributesAllowedOnText(t.schema))})})}_enableClipboardIntegration(){const B=this.editor,t=B.model,V=this.editor.config.get("link.defaultProtocol");V&&this.listenTo(B.plugins.get("ClipboardPipeline"),"contentInsertion",(N,W)=>{t.change(K=>{const G=K.createRangeIn(W.content);for(const Z of G.getItems())if(Z.hasAttribute("linkHref")){const Y=addLinkProtocolIfApplicable(Z.getAttribute("linkHref"),V);K.setAttribute("linkHref",Y,Z)}})})}}function removeLinkAttributesFromSelection(H,B){H.removeSelectionAttribute("linkHref");for(const t of B)H.removeSelectionAttribute(t)}function getLinkAttributesAllowedOnText(H){return H.getDefinition("$text").allowAttributes.filter(t=>t.startsWith("link"))}class LinkFormView extends View{constructor(t,V,N){super(t);ee(this,"focusTracker",new FocusTracker);ee(this,"keystrokes",new KeystrokeHandler);ee(this,"urlInputView");ee(this,"saveButtonView");ee(this,"cancelButtonView");ee(this,"_manualDecoratorSwitches");ee(this,"children");ee(this,"_validators");ee(this,"_focusables",new ViewCollection);ee(this,"_focusCycler");const W=t.t;this._validators=N,this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(W("Save"),icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(W("Cancel"),icons.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(V),this.children=this._createFormChildren(V.manualDecorators),this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const K=["ck","ck-link-form","ck-responsive-form"];V.manualDecorators.length&&K.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:K,tabindex:"-1"},children:this.children})}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((t,V)=>(t[V.name]=V.isOn,t),{})}render(){super.render(),submitHandler({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(V=>{this._focusables.add(V),this.focusTracker.add(V.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}isValid(){this.resetFormStatus();for(const t of this._validators){const V=t(this);if(V)return this.urlInputView.errorText=V,!1}return!0}resetFormStatus(){this.urlInputView.errorText=null}_createUrlInput(){const t=this.locale.t,V=new LabeledFieldView(this.locale,createLabeledInputText);return V.fieldView.inputMode="url",V.label=t("Link URL"),V}_createButton(t,V,N,W){const K=new ButtonView(this.locale);return K.set({label:t,icon:V,tooltip:!0}),K.extendTemplate({attributes:{class:N}}),W&&K.delegate("execute").to(this,W),K}_createManualDecoratorSwitches(t){const V=this.createCollection();for(const N of t.manualDecorators){const W=new SwitchButtonView(this.locale);W.set({name:N.id,label:N.label,withText:!0}),W.bind("isOn").toMany([N,t],"value",(K,G)=>G===void 0&&K===void 0?!!N.defaultValue:!!K),W.on("execute",()=>{N.set("value",!W.isOn)}),V.add(W)}return V}_createFormChildren(t){const V=this.createCollection();if(V.add(this.urlInputView),t.length){const N=new View;N.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(W=>({tag:"li",children:[W],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),V.add(N)}return V.add(this.saveButtonView),V.add(this.cancelButtonView),V}get url(){const{element:t}=this.urlInputView.fieldView;return t?t.value.trim():null}}var unlinkIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';class LinkActionsView extends View{constructor(t,V={}){super(t);ee(this,"focusTracker",new FocusTracker);ee(this,"keystrokes",new KeystrokeHandler);ee(this,"previewButtonView");ee(this,"unlinkButtonView");ee(this,"editButtonView");ee(this,"_focusables",new ViewCollection);ee(this,"_focusCycler");ee(this,"_linkConfig");const N=t.t;this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(N("Unlink"),unlinkIcon,"unlink"),this.editButtonView=this._createButton(N("Edit link"),icons.pencil,"edit"),this.set("href",void 0),this._linkConfig=V,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(V=>{this._focusables.add(V),this.focusTracker.add(V.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(t,V,N){const W=new ButtonView(this.locale);return W.set({label:t,icon:V,tooltip:!0}),W.delegate("execute").to(this,N),W}_createPreviewButton(){const t=new ButtonView(this.locale),V=this.bindTemplate,N=this.t;return t.set({withText:!0,tooltip:N("Open link in new tab")}),t.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:V.to("href",W=>W&&ensureSafeUrl(W,this._linkConfig.allowedProtocols)),target:"_blank",rel:"noopener noreferrer"}}),t.bind("label").to(this,"href",W=>W||N("This link has no URL")),t.bind("isEnabled").to(this,"href",W=>!!W),t.template.tag="a",t.template.eventListeners={},t}}var linkIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';const VISUAL_SELECTION_MARKER_NAME="link-ui";class LinkUI extends Plugin{constructor(){super(...arguments);ee(this,"actionsView",null);ee(this,"formView",null);ee(this,"_balloon")}static get requires(){return[ContextualBalloon]}static get pluginName(){return"LinkUI"}init(){const t=this.editor,V=this.editor.t;t.editing.view.addObserver(ClickObserver),this._balloon=t.plugins.get(ContextualBalloon),this._createToolbarLinkButton(),this._enableBalloonActivators(),t.conversion.for("editingDowncast").markerToHighlight({model:VISUAL_SELECTION_MARKER_NAME,view:{classes:["ck-fake-link-selection"]}}),t.conversion.for("editingDowncast").markerToElement({model:VISUAL_SELECTION_MARKER_NAME,view:(N,{writer:W})=>{if(!N.markerRange.isCollapsed)return null;const K=W.createUIElement("span");return W.addClass(["ck-fake-link-selection","ck-fake-link-selection_collapsed"],K),K}}),t.accessibility.addKeystrokeInfos({keystrokes:[{label:V("Create link"),keystroke:LINK_KEYSTROKE},{label:V("Move out of a link"),keystroke:[["arrowleft","arrowleft"],["arrowright","arrowright"]]}]})}destroy(){super.destroy(),this.formView&&this.formView.destroy(),this.actionsView&&this.actionsView.destroy()}_createViews(){this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._enableUserBalloonInteractions()}_createActionsView(){const t=this.editor,V=new LinkActionsView(t.locale,t.config.get("link")),N=t.commands.get("link"),W=t.commands.get("unlink");return V.bind("href").to(N,"value"),V.editButtonView.bind("isEnabled").to(N),V.unlinkButtonView.bind("isEnabled").to(W),this.listenTo(V,"edit",()=>{this._addFormView()}),this.listenTo(V,"unlink",()=>{t.execute("unlink"),this._hideUI()}),V.keystrokes.set("Esc",(K,G)=>{this._hideUI(),G()}),V.keystrokes.set(LINK_KEYSTROKE,(K,G)=>{this._addFormView(),G()}),V}_createFormView(){const t=this.editor,V=t.commands.get("link"),N=t.config.get("link.defaultProtocol"),W=new(CssTransitionDisablerMixin(LinkFormView))(t.locale,V,getFormValidators(t));return W.urlInputView.fieldView.bind("value").to(V,"value"),W.urlInputView.bind("isEnabled").to(V,"isEnabled"),W.saveButtonView.bind("isEnabled").to(V,"isEnabled"),this.listenTo(W,"submit",()=>{if(W.isValid()){const{value:K}=W.urlInputView.fieldView.element,G=addLinkProtocolIfApplicable(K,N);t.execute("link",G,W.getDecoratorSwitchesState()),this._closeFormView()}}),this.listenTo(W.urlInputView,"change:errorText",()=>{t.ui.update()}),this.listenTo(W,"cancel",()=>{this._closeFormView()}),W.keystrokes.set("Esc",(K,G)=>{this._closeFormView(),G()}),W}_createToolbarLinkButton(){const t=this.editor;t.ui.componentFactory.add("link",()=>{const V=this._createButton(ButtonView);return V.set({tooltip:!0}),V}),t.ui.componentFactory.add("menuBar:link",()=>{const V=this._createButton(MenuBarMenuListItemButtonView);return V.set({role:"menuitemcheckbox"}),V})}_createButton(t){const V=this.editor,N=V.locale,W=V.commands.get("link"),K=new t(V.locale),G=N.t;return K.set({label:G("Link"),icon:linkIcon,keystroke:LINK_KEYSTROKE,isToggleable:!0}),K.bind("isEnabled").to(W,"isEnabled"),K.bind("isOn").to(W,"value",Z=>!!Z),this.listenTo(K,"execute",()=>this._showUI(!0)),K}_enableBalloonActivators(){const t=this.editor,V=t.editing.view.document;this.listenTo(V,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),t.keystrokes.set(LINK_KEYSTROKE,(N,W)=>{W(),t.commands.get("link").isEnabled&&this._showUI(!0)})}_enableUserBalloonInteractions(){this.editor.keystrokes.set("Tab",(t,V)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),V())},{priority:"high"}),this.editor.keystrokes.set("Esc",(t,V)=>{this._isUIVisible&&(this._hideUI(),V())}),clickOutsideHandler({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this.actionsView||this._createViews(),!this._areActionsInPanel&&this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this.formView||this._createViews(),this._isFormInPanel)return;const V=this.editor.commands.get("link");this.formView.disableCssTransitions(),this.formView.resetFormStatus(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.urlInputView.fieldView.value=V.value||"",this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions()}_closeFormView(){const t=this.editor.commands.get("link");t.restoreManualDecoratorStates(),t.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this.formView.urlInputView.fieldView.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(t=!1){this.formView||this._createViews(),this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),t&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),t&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const t=this.editor;this.stopListening(t.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),t.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const t=this.editor,V=t.editing.view.document;let N=this._getSelectedLinkElement(),W=G();const K=()=>{const Z=this._getSelectedLinkElement(),Y=G();N&&!Z||!N&&Y!==W?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),N=Z,W=Y};function G(){return V.selection.focus.getAncestors().reverse().find(Z=>Z.is("element"))}this.listenTo(t.ui,"update",K),this.listenTo(this._balloon,"change:visibleView",K)}get _isFormInPanel(){return!!this.formView&&this._balloon.hasView(this.formView)}get _areActionsInPanel(){return!!this.actionsView&&this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return!!this.actionsView&&this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){const t=this._balloon.visibleView;return!!this.formView&&t==this.formView||this._areActionsVisible}_getBalloonPositionData(){const t=this.editor.editing.view,V=this.editor.model,N=t.document;let W;if(V.markers.has(VISUAL_SELECTION_MARKER_NAME)){const K=Array.from(this.editor.editing.mapper.markerNameToElements(VISUAL_SELECTION_MARKER_NAME)),G=t.createRange(t.createPositionBefore(K[0]),t.createPositionAfter(K[K.length-1]));W=t.domConverter.viewRangeToDom(G)}else W=()=>{const K=this._getSelectedLinkElement();return K?t.domConverter.mapViewToDom(K):t.domConverter.viewRangeToDom(N.selection.getFirstRange())};return{target:W}}_getSelectedLinkElement(){const t=this.editor.editing.view,V=t.document.selection,N=V.getSelectedElement();if(V.isCollapsed||N&&isWidget(N))return findLinkElementAncestor(V.getFirstPosition());{const W=V.getFirstRange().getTrimmed(),K=findLinkElementAncestor(W.start),G=findLinkElementAncestor(W.end);return!K||K!=G?null:t.createRangeIn(K).getTrimmed().isEqual(W)?K:null}}_showFakeVisualSelection(){const t=this.editor.model;t.change(V=>{const N=t.document.selection.getFirstRange();if(t.markers.has(VISUAL_SELECTION_MARKER_NAME))V.updateMarker(VISUAL_SELECTION_MARKER_NAME,{range:N});else if(N.start.isAtEnd){const W=N.start.getLastMatchingPosition(({item:K})=>!t.schema.isContent(K),{boundaries:N});V.addMarker(VISUAL_SELECTION_MARKER_NAME,{usingOperation:!1,affectsData:!1,range:V.createRange(W,N.end)})}else V.addMarker(VISUAL_SELECTION_MARKER_NAME,{usingOperation:!1,affectsData:!1,range:N})})}_hideFakeVisualSelection(){const t=this.editor.model;t.markers.has(VISUAL_SELECTION_MARKER_NAME)&&t.change(V=>{V.removeMarker(VISUAL_SELECTION_MARKER_NAME)})}}function findLinkElementAncestor(H){return H.getAncestors().find(B=>isLinkElement(B))||null}function getFormValidators(H){const B=H.t,t=H.config.get("link.allowCreatingEmptyLinks");return[V=>{if(!t&&!V.url.length)return B("Link URL must not be empty.")}]}const MIN_LINK_LENGTH_WITH_SPACE_AT_END=4,URL_REG_EXP=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),URL_GROUP_IN_MATCH=2;class AutoLink extends Plugin{static get requires(){return[Delete,LinkEditing]}static get pluginName(){return"AutoLink"}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling(),this._enablePasteLinking()}_expandLinkRange(B,t){return t.textNode&&t.textNode.hasAttribute("linkHref")?findAttributeRange(t,"linkHref",t.textNode.getAttribute("linkHref"),B):null}_selectEntireLinks(B,t){const N=this.editor.model,W=N.document.selection,K=W.getFirstPosition(),G=W.getLastPosition();let Z=t.getJoined(this._expandLinkRange(N,K)||t);Z&&(Z=Z.getJoined(this._expandLinkRange(N,G)||t)),Z&&(Z.start.isBefore(K)||Z.end.isAfter(G))&&B.setSelection(Z)}_enablePasteLinking(){const B=this.editor,t=B.model,V=t.document.selection,N=B.plugins.get("ClipboardPipeline"),W=B.commands.get("link");N.on("inputTransformation",(K,G)=>{if(!this.isEnabled||!W.isEnabled||V.isCollapsed||G.method!=="paste"||V.rangeCount>1)return;const Z=V.getFirstRange(),Y=G.dataTransfer.getData("text/plain");if(!Y)return;const X=Y.match(URL_REG_EXP);X&&X[2]===Y&&(t.change(Q=>{this._selectEntireLinks(Q,Z),W.execute(Y)}),K.stop())},{priority:"high"})}_enableTypingHandling(){const B=this.editor,t=new TextWatcher(B.model,V=>{if(!isSingleSpaceAtTheEnd(V))return;const N=getUrlAtTextEnd(V.substr(0,V.length-1));if(N)return{url:N}});t.on("matched:data",(V,N)=>{const{batch:W,range:K,url:G}=N;if(!W.isTyping)return;const Z=K.end.getShiftedBy(-1),Y=Z.getShiftedBy(-G.length),X=B.model.createRange(Y,Z);this._applyAutoLink(G,X)}),t.bind("isEnabled").to(this)}_enableEnterHandling(){const B=this.editor,t=B.model,V=B.commands.get("enter");V&&V.on("execute",()=>{const N=t.document.selection.getFirstPosition();if(!N.parent.previousSibling)return;const W=t.createRangeIn(N.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(W)})}_enableShiftEnterHandling(){const B=this.editor,t=B.model,V=B.commands.get("shiftEnter");V&&V.on("execute",()=>{const N=t.document.selection.getFirstPosition(),W=t.createRange(t.createPositionAt(N.parent,0),N.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(W)})}_checkAndApplyAutoLinkOnRange(B){const t=this.editor.model,{text:V,range:N}=getLastTextLine(B,t),W=getUrlAtTextEnd(V);if(W){const K=t.createRange(N.end.getShiftedBy(-W.length),N.end);this._applyAutoLink(W,K)}}_applyAutoLink(B,t){const V=this.editor.model,N=this.editor.config.get("link.defaultProtocol"),W=addLinkProtocolIfApplicable(B,N);!this.isEnabled||!isLinkAllowedOnRange(t,V)||!linkHasProtocol(W)||linkIsAlreadySet(t)||this._persistAutoLink(W,t)}_persistAutoLink(B,t){const V=this.editor.model,N=this.editor.plugins.get("Delete");V.enqueueChange(W=>{W.setAttribute("linkHref",B,t),V.enqueueChange(()=>{N.requestUndoOnBackspace()})})}}function isSingleSpaceAtTheEnd(H){return H.length>MIN_LINK_LENGTH_WITH_SPACE_AT_END&&H[H.length-1]===" "&&H[H.length-2]!==" "}function getUrlAtTextEnd(H){const B=URL_REG_EXP.exec(H);return B?B[URL_GROUP_IN_MATCH]:null}function isLinkAllowedOnRange(H,B){return B.schema.checkAttributeInSelection(B.createSelection(H),"linkHref")}function linkIsAlreadySet(H){const B=H.start.nodeAfter;return!!B&&B.hasAttribute("linkHref")}class Link extends Plugin{static get requires(){return[LinkEditing,LinkUI,AutoLink]}static get pluginName(){return"Link"}}class LinkImageEditing extends Plugin{static get requires(){return["ImageEditing","ImageUtils",LinkEditing]}static get pluginName(){return"LinkImageEditing"}afterInit(){const B=this.editor,t=B.model.schema;B.plugins.has("ImageBlockEditing")&&t.extend("imageBlock",{allowAttributes:["linkHref"]}),B.conversion.for("upcast").add(upcastLink(B)),B.conversion.for("downcast").add(downcastImageLink(B)),this._enableAutomaticDecorators(),this._enableManualDecorators()}_enableAutomaticDecorators(){const B=this.editor,V=B.commands.get("link").automaticDecorators;V.length&&B.conversion.for("downcast").add(V.getDispatcherForLinkedImage())}_enableManualDecorators(){const B=this.editor,t=B.commands.get("link");for(const V of t.manualDecorators)B.plugins.has("ImageBlockEditing")&&B.model.schema.extend("imageBlock",{allowAttributes:V.id}),B.plugins.has("ImageInlineEditing")&&B.model.schema.extend("imageInline",{allowAttributes:V.id}),B.conversion.for("downcast").add(downcastImageLinkManualDecorator(V)),B.conversion.for("upcast").add(upcastImageLinkManualDecorator(B,V))}}function upcastLink(H){const B=H.plugins.has("ImageInlineEditing"),t=H.plugins.get("ImageUtils");return V=>{V.on("element:a",(N,W,K)=>{const G=W.viewItem,Z=t.findViewImgElement(G);if(!Z)return;const Y=Z.findAncestor(ie=>t.isBlockImageView(ie));if(B&&!Y)return;const X={attributes:["href"]};if(!K.consumable.consume(G,X))return;const Q=G.getAttribute("href");if(!Q)return;let te=W.modelCursor.parent;if(!te.is("element","imageBlock")){const ie=K.convertItem(Z,W.modelCursor);W.modelRange=ie.modelRange,W.modelCursor=ie.modelCursor,te=W.modelCursor.nodeBefore}te&&te.is("element","imageBlock")&&K.writer.setAttribute("linkHref",Q,te)},{priority:"high"})}}function downcastImageLink(H){const B=H.plugins.get("ImageUtils");return t=>{t.on("attribute:linkHref:imageBlock",(V,N,W)=>{if(!W.consumable.consume(N.item,V.name))return;const K=W.mapper.toViewElement(N.item),G=W.writer,Z=Array.from(K.getChildren()).find(Q=>Q.is("element","a")),Y=B.findViewImgElement(K),X=Y.parent.is("element","picture")?Y.parent:Y;if(Z)N.attributeNewValue?G.setAttribute("href",N.attributeNewValue,Z):(G.move(G.createRangeOn(X),G.createPositionAt(K,0)),G.remove(Z));else{const Q=G.createContainerElement("a",{href:N.attributeNewValue});G.insert(G.createPositionAt(K,0),Q),G.move(G.createRangeOn(X),G.createPositionAt(Q,0))}},{priority:"high"})}}function downcastImageLinkManualDecorator(H){return B=>{B.on(`attribute:${H.id}:imageBlock`,(t,V,N)=>{const W=N.mapper.toViewElement(V.item),K=Array.from(W.getChildren()).find(G=>G.is("element","a"));if(K){for(const[G,Z]of toMap(H.attributes))N.writer.setAttribute(G,Z,K);H.classes&&N.writer.addClass(H.classes,K);for(const G in H.styles)N.writer.setStyle(G,H.styles[G],K)}})}}function upcastImageLinkManualDecorator(H,B){const t=H.plugins.has("ImageInlineEditing"),V=H.plugins.get("ImageUtils");return N=>{N.on("element:a",(W,K,G)=>{const Z=K.viewItem,Y=V.findViewImgElement(Z);if(!Y)return;const X=Y.findAncestor(ne=>V.isBlockImageView(ne));if(t&&!X)return;const te=new Matcher(B._createPattern()).match(Z);if(!te||!G.consumable.consume(Z,te.match))return;const ie=K.modelCursor.nodeBefore||K.modelCursor.parent;G.writer.setAttribute(B.id,!0,ie)},{priority:"high"})}}class LinkImageUI extends Plugin{static get requires(){return[LinkEditing,LinkUI,"ImageBlockEditing"]}static get pluginName(){return"LinkImageUI"}init(){const B=this.editor,t=B.editing.view.document;this.listenTo(t,"click",(V,N)=>{this._isSelectedLinkedImage(B.model.document.selection)&&(N.preventDefault(),V.stop())},{priority:"high"}),this._createToolbarLinkImageButton()}_createToolbarLinkImageButton(){const B=this.editor,t=B.t;B.ui.componentFactory.add("linkImage",V=>{const N=new ButtonView(V),W=B.plugins.get("LinkUI"),K=B.commands.get("link");return N.set({isEnabled:!0,label:t("Link image"),icon:linkIcon,keystroke:LINK_KEYSTROKE,tooltip:!0,isToggleable:!0}),N.bind("isEnabled").to(K,"isEnabled"),N.bind("isOn").to(K,"value",G=>!!G),this.listenTo(N,"execute",()=>{this._isSelectedLinkedImage(B.model.document.selection)?W._addActionsView():W._showUI(!0)}),N})}_isSelectedLinkedImage(B){const t=B.getSelectedElement();return this.editor.plugins.get("ImageUtils").isImage(t)&&t.hasAttribute("linkHref")}}class LinkImage extends Plugin{static get requires(){return[LinkImageEditing,LinkImageUI]}static get pluginName(){return"LinkImage"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ListWalker{constructor(B,t){ee(this,"_startElement");ee(this,"_referenceIndent");ee(this,"_isForward");ee(this,"_includeSelf");ee(this,"_sameAttributes");ee(this,"_sameIndent");ee(this,"_lowerIndent");ee(this,"_higherIndent");this._startElement=B,this._referenceIndent=B.getAttribute("listIndent"),this._isForward=t.direction=="forward",this._includeSelf=!!t.includeSelf,this._sameAttributes=toArray$2(t.sameAttributes||[]),this._sameIndent=!!t.sameIndent,this._lowerIndent=!!t.lowerIndent,this._higherIndent=!!t.higherIndent}static first(B,t){const N=new this(B,t)[Symbol.iterator]();return first(N)}*[Symbol.iterator](){const B=[];for(const{node:t}of iterateSiblingListBlocks(this._getStartNode(),this._isForward?"forward":"backward")){const V=t.getAttribute("listIndent");if(V<this._referenceIndent){if(!this._lowerIndent)break;this._referenceIndent=V}else if(V>this._referenceIndent){if(!this._higherIndent)continue;if(!this._isForward){B.push(t);continue}}else{if(!this._sameIndent){if(this._higherIndent){B.length&&(yield*B,B.length=0);break}continue}if(this._sameAttributes.some(N=>t.getAttribute(N)!==this._startElement.getAttribute(N)))break}B.length&&(yield*B,B.length=0),yield t}}_getStartNode(){return this._includeSelf?this._startElement:this._isForward?this._startElement.nextSibling:this._startElement.previousSibling}}function*iterateSiblingListBlocks(H,B="forward"){const t=B=="forward",V=[];let N=null;for(;isListItemBlock(H);){let W=null;if(N){const K=H.getAttribute("listIndent"),G=N.getAttribute("listIndent");K>G?V[G]=N:K<G?(W=V[K],V.length=K):W=N}yield{node:H,previous:N,previousNodeInList:W},N=H,H=t?H.nextSibling:H.previousSibling}}class ListBlocksIterable{constructor(B){ee(this,"_listHead");this._listHead=B}[Symbol.iterator](){return iterateSiblingListBlocks(this._listHead,"forward")}}class ListItemUid{static next(){return uid()}}function isListItemBlock(H){return!!H&&H.is("element")&&H.hasAttribute("listItemId")}function getAllListItemBlocks(H,B={}){return[...getListItemBlocks(H,{...B,direction:"backward"}),...getListItemBlocks(H,{...B,direction:"forward"})]}function getListItemBlocks(H,B={}){const t=B.direction=="forward",V=Array.from(new ListWalker(H,{...B,includeSelf:t,sameIndent:!0,sameAttributes:"listItemId"}));return t?V:V.reverse()}function getNestedListBlocks(H){return Array.from(new ListWalker(H,{direction:"forward",higherIndent:!0}))}function getListItems(H,B){const t=new ListWalker(H,{sameIndent:!0,sameAttributes:"listType",...B}),V=new ListWalker(H,{sameIndent:!0,sameAttributes:"listType",includeSelf:!0,direction:"forward",...B});return[...Array.from(t).reverse(),...V]}function isFirstBlockOfListItem(H){return!ListWalker.first(H,{sameIndent:!0,sameAttributes:"listItemId"})}function isLastBlockOfListItem(H){return!ListWalker.first(H,{direction:"forward",sameIndent:!0,sameAttributes:"listItemId"})}function expandListBlocksToCompleteItems(H,B={}){H=toArray$2(H);const t=B.withNested!==!1,V=new Set;for(const N of H)for(const W of getAllListItemBlocks(N,{higherIndent:t}))V.add(W);return sortBlocks(V)}function expandListBlocksToCompleteList(H){H=toArray$2(H);const B=new Set;for(const t of H)for(const V of getListItems(t))B.add(V);return sortBlocks(B)}function splitListItemBefore(H,B){const t=getListItemBlocks(H,{direction:"forward"}),V=ListItemUid.next();for(const N of t)B.setAttribute("listItemId",V,N);return t}function mergeListItemBefore(H,B,t){const V={};for(const[W,K]of B.getAttributes())W.startsWith("list")&&(V[W]=K);const N=getListItemBlocks(H,{direction:"forward"});for(const W of N)t.setAttributes(V,W);return N}function indentBlocks(H,B,{expand:t,indentBy:V=1}={}){H=toArray$2(H);const N=t?expandListBlocksToCompleteItems(H):H;for(const W of N){const K=W.getAttribute("listIndent")+V;K<0?removeListAttributes(W,B):B.setAttribute("listIndent",K,W)}return N}function outdentBlocksWithMerge(H,B){H=toArray$2(H);const t=expandListBlocksToCompleteItems(H),V=new Set,N=Math.min(...t.map(K=>K.getAttribute("listIndent"))),W=new Map;for(const K of t)W.set(K,ListWalker.first(K,{lowerIndent:!0}));for(const K of t){if(V.has(K))continue;V.add(K);const G=K.getAttribute("listIndent")-1;if(G<0){removeListAttributes(K,B);continue}if(K.getAttribute("listIndent")==N){const Z=mergeListItemIfNotLast(K,W.get(K),B);for(const Y of Z)V.add(Y);if(Z.length)continue}B.setAttribute("listIndent",G,K)}return sortBlocks(V)}function removeListAttributes(H,B){H=toArray$2(H);for(const t of H)t.is("element","listItem")&&B.rename(t,"paragraph");for(const t of H)for(const V of t.getAttributeKeys())V.startsWith("list")&&B.removeAttribute(V,t);return H}function isSingleListItem(H){if(!H.length)return!1;const B=H[0].getAttribute("listItemId");return B?!H.some(t=>t.getAttribute("listItemId")!=B):!1}function outdentFollowingItems(H,B){const t=[];let V=Number.POSITIVE_INFINITY;for(const{node:N}of iterateSiblingListBlocks(H.nextSibling,"forward")){const W=N.getAttribute("listIndent");if(W==0)break;W<V&&(V=W);const K=W-V;B.setAttribute("listIndent",K,N),t.push(N)}return t}function sortBlocks(H){return Array.from(H).filter(B=>B.root.rootName!=="$graveyard").sort((B,t)=>B.index-t.index)}function getSelectedBlockObject(H){const B=H.document.selection.getSelectedElement();return B&&H.schema.isObject(B)&&H.schema.isBlock(B)?B:null}function canBecomeSimpleListItem(H,B){return B.checkChild(H.parent,"listItem")&&B.checkChild(H,"$text")&&!B.isObject(H)}function isNumberedListType(H){return H=="numbered"||H=="customNumbered"}function mergeListItemIfNotLast(H,B,t){return getListItemBlocks(B,{direction:"forward"}).pop().index>H.index?mergeListItemBefore(H,B,t):[]}class ListIndentCommand extends Command{constructor(t,V){super(t);ee(this,"_direction");this._direction=V}refresh(){this.isEnabled=this._checkEnabled()}execute(){const t=this.editor.model,V=getSelectedListBlocks(t.document.selection);t.change(N=>{const W=[];isSingleListItem(V)&&!isFirstBlockOfListItem(V[0])?(this._direction=="forward"&&W.push(...indentBlocks(V,N)),W.push(...splitListItemBefore(V[0],N))):this._direction=="forward"?W.push(...indentBlocks(V,N,{expand:!0})):W.push(...outdentBlocksWithMerge(V,N));for(const K of W){if(!K.hasAttribute("listType"))continue;const G=ListWalker.first(K,{sameIndent:!0});G&&N.setAttribute("listType",G.getAttribute("listType"),K)}this._fireAfterExecute(W)})}_fireAfterExecute(t){this.fire("afterExecute",sortBlocks(new Set(t)))}_checkEnabled(){let t=getSelectedListBlocks(this.editor.model.document.selection),V=t[0];if(!V)return!1;if(this._direction=="backward"||isSingleListItem(t)&&!isFirstBlockOfListItem(t[0]))return!0;t=expandListBlocksToCompleteItems(t),V=t[0];const N=ListWalker.first(V,{sameIndent:!0});return N?N.getAttribute("listType")==V.getAttribute("listType"):!1}}function getSelectedListBlocks(H){const B=Array.from(H.getSelectedBlocks()),t=B.findIndex(V=>!isListItemBlock(V));return t!=-1&&(B.length=t),B}class ListCommand extends Command{constructor(t,V,N={}){super(t);ee(this,"type");ee(this,"_listWalkerOptions");this.type=V,this._listWalkerOptions=N.multiLevel?{higherIndent:!0,lowerIndent:!0,sameAttributes:[]}:void 0}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(t={}){const V=this.editor.model,N=V.document,W=getSelectedBlockObject(V),K=Array.from(N.selection.getSelectedBlocks()).filter(Z=>V.schema.checkAttribute(Z,"listType")||canBecomeSimpleListItem(Z,V.schema)),G=t.forceValue!==void 0?!t.forceValue:this.value;V.change(Z=>{if(G){const Y=K[K.length-1],X=getListItemBlocks(Y,{direction:"forward"}),Q=[];X.length>1&&Q.push(...splitListItemBefore(X[1],Z)),Q.push(...removeListAttributes(K,Z)),Q.push(...outdentFollowingItems(Y,Z)),this._fireAfterExecute(Q)}else if((W||N.selection.isCollapsed)&&isListItemBlock(K[0])){const Y=getListItems(W||K[0],this._listWalkerOptions);for(const X of Y)Z.setAttributes({...t.additionalAttributes,listType:this.type},X);this._fireAfterExecute(Y)}else{const Y=[];for(const X of K)if(!X.hasAttribute("listType"))!X.is("element","listItem")&&canBecomeSimpleListItem(X,V.schema)&&Z.rename(X,"listItem"),Z.setAttributes({...t.additionalAttributes,listIndent:0,listItemId:ListItemUid.next(),listType:this.type},X),Y.push(X);else for(const Q of expandListBlocksToCompleteItems(X,{withNested:!1}))Q.getAttribute("listType")!=this.type&&(Z.setAttributes({...t.additionalAttributes,listType:this.type},Q),Y.push(Q));this._fireAfterExecute(Y)}})}_fireAfterExecute(t){this.fire("afterExecute",sortBlocks(new Set(t)))}_getValue(){const t=this.editor.model.document.selection,V=Array.from(t.getSelectedBlocks());if(!V.length)return!1;for(const N of V)if(N.getAttribute("listType")!=this.type)return!1;return!0}_checkEnabled(){const t=this.editor.model,V=t.schema,N=t.document.selection,W=Array.from(N.getSelectedBlocks());if(!W.length)return!1;if(this.value)return!0;for(const K of W)if(V.checkAttribute(K,"listType")||canBecomeSimpleListItem(K,V))return!0;return!1}}class ListMergeCommand extends Command{constructor(t,V){super(t);ee(this,"_direction");this._direction=V}refresh(){this.isEnabled=this._checkEnabled()}execute({shouldMergeOnBlocksContentLevel:t=!1}={}){const V=this.editor.model,N=V.document.selection,W=[];V.change(K=>{const{firstElement:G,lastElement:Z}=this._getMergeSubjectElements(N,t),Y=G.getAttribute("listIndent")||0,X=Z.getAttribute("listIndent"),Q=Z.getAttribute("listItemId");if(Y!=X){const te=getNestedListBlocks(Z);W.push(...indentBlocks([Z,...te],K,{indentBy:Y-X,expand:Y<X}))}if(t){let te=N;N.isCollapsed&&(te=K.createSelection(K.createRange(K.createPositionAt(G,"end"),K.createPositionAt(Z,0)))),V.deleteContent(te,{doNotResetEntireContent:N.isCollapsed});const ie=te.getLastPosition().parent,ne=ie.nextSibling;W.push(ie),ne&&ne!==Z&&ne.getAttribute("listItemId")==Q&&W.push(...mergeListItemBefore(ne,ie,K))}else W.push(...mergeListItemBefore(Z,G,K));this._fireAfterExecute(W)})}_fireAfterExecute(t){this.fire("afterExecute",sortBlocks(new Set(t)))}_checkEnabled(){const t=this.editor.model,V=t.document.selection,N=getSelectedBlockObject(t);if(V.isCollapsed||N){const W=N||V.getFirstPosition().parent;if(!isListItemBlock(W))return!1;const K=this._direction=="backward"?W.previousSibling:W.nextSibling;if(!K||isSingleListItem([W,K]))return!1}else{const W=V.getLastPosition(),K=V.getFirstPosition();if(W.parent===K.parent||!isListItemBlock(W.parent))return!1}return!0}_getMergeSubjectElements(t,V){const N=this.editor.model,W=getSelectedBlockObject(N);let K,G;if(t.isCollapsed||W){const Z=W||t.getFirstPosition().parent,Y=isFirstBlockOfListItem(Z);this._direction=="backward"?(G=Z,Y&&!V?K=ListWalker.first(Z,{sameIndent:!0,lowerIndent:!0}):K=Z.previousSibling):(K=Z,G=Z.nextSibling)}else K=t.getFirstPosition().parent,G=t.getLastPosition().parent;return{firstElement:K,lastElement:G}}}class ListSplitCommand extends Command{constructor(t,V){super(t);ee(this,"_direction");this._direction=V}refresh(){this.isEnabled=this._checkEnabled()}execute(){this.editor.model.change(V=>{const N=splitListItemBefore(this._getStartBlock(),V);this._fireAfterExecute(N)})}_fireAfterExecute(t){this.fire("afterExecute",sortBlocks(new Set(t)))}_checkEnabled(){const t=this.editor.model.document.selection,V=this._getStartBlock();return t.isCollapsed&&isListItemBlock(V)&&!isFirstBlockOfListItem(V)}_getStartBlock(){const V=this.editor.model.document.selection.getFirstPosition().parent;return this._direction=="before"?V:V.nextSibling}}class ListUtils extends Plugin{static get pluginName(){return"ListUtils"}expandListBlocksToCompleteList(B){return expandListBlocksToCompleteList(B)}isFirstBlockOfListItem(B){return isFirstBlockOfListItem(B)}isListItemBlock(B){return isListItemBlock(B)}expandListBlocksToCompleteItems(B,t={}){return expandListBlocksToCompleteItems(B,t)}isNumberedListType(B){return isNumberedListType(B)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function isListView(H){return H.is("element","ol")||H.is("element","ul")}function isListItemView(H){return H.is("element","li")}function getIndent$1(H){let B=0,t=H.parent;for(;t;){if(isListItemView(t))B++;else{const V=t.previousSibling;V&&isListItemView(V)&&B++}t=t.parent}return B}function createListElement(H,B,t,V=getViewElementIdForListType(t,B)){return H.createAttributeElement(getViewElementNameForListType(t),null,{priority:2*B/100-100,id:V})}function createListItemElement(H,B,t){return H.createAttributeElement("li",null,{priority:(2*B+1)/100-100,id:t})}function getViewElementNameForListType(H){return H=="numbered"||H=="customNumbered"?"ol":"ul"}function getViewElementIdForListType(H,B){return`list-${H}-${B}`}function findAndAddListHeadToMap(H,B){const t=H.nodeBefore;if(isListItemBlock(t)){let V=t;for(const{node:N}of iterateSiblingListBlocks(V,"backward"))if(V=N,B.has(V))return;B.set(t,V)}else{const V=H.nodeAfter;isListItemBlock(V)&&B.set(V,V)}}function fixListIndents(H,B){let t=0,V=-1,N=null,W=!1;for(const{node:K}of H){const G=K.getAttribute("listIndent");if(G>t){let Z;N===null?(N=G-t,Z=t):(N>G&&(N=G),Z=G-N),Z>V+1&&(Z=V+1),B.setAttribute("listIndent",Z,K),W=!0,V=Z}else N=null,t=G+1,V=G}return W}function fixListItemIds(H,B,t){const V=new Set;let N=!1;for(const{node:W}of H){if(V.has(W))continue;let K=W.getAttribute("listType"),G=W.getAttribute("listItemId");if(B.has(G)&&(G=ListItemUid.next()),B.add(G),W.is("element","listItem")){W.getAttribute("listItemId")!=G&&(t.setAttribute("listItemId",G,W),N=!0);continue}for(const Z of getListItemBlocks(W,{direction:"forward"}))V.add(Z),Z.getAttribute("listType")!=K&&(G=ListItemUid.next(),K=Z.getAttribute("listType")),Z.getAttribute("listItemId")!=G&&(t.setAttribute("listItemId",G,Z),N=!0)}return N}function listItemUpcastConverter(){return(H,B,t)=>{const{writer:V,schema:N}=t;if(!B.modelRange)return;const W=Array.from(B.modelRange.getItems({shallow:!0})).filter(Q=>N.checkAttribute(Q,"listItemId"));if(!W.length)return;const K=ListItemUid.next(),G=getIndent$1(B.viewItem);let Z=B.viewItem.parent&&B.viewItem.parent.is("element","ol")?"numbered":"bulleted";const Y=W[0].getAttribute("listType");Y&&(Z=Y);const X={listItemId:K,listIndent:G,listType:Z};for(const Q of W)Q.hasAttribute("listItemId")||V.setAttributes(X,Q);W.length>1&&W[1].getAttribute("listItemId")!=X.listItemId&&t.keepEmptyElement(W[0])}}function reconvertItemsOnDataChange(H,B,t,V){return()=>{const G=H.document.differ.getChanges(),Z=[],Y=new Map,X=new Set;for(const Q of G)if(Q.type=="insert"&&Q.name!="$text")findAndAddListHeadToMap(Q.position,Y),Q.attributes.has("listItemId")?X.add(Q.position.nodeAfter):findAndAddListHeadToMap(Q.position.getShiftedBy(Q.length),Y);else if(Q.type=="remove"&&Q.attributes.has("listItemId"))findAndAddListHeadToMap(Q.position,Y);else if(Q.type=="attribute"){const te=Q.range.start.nodeAfter;t.includes(Q.attributeKey)?(findAndAddListHeadToMap(Q.range.start,Y),Q.attributeNewValue===null?(findAndAddListHeadToMap(Q.range.start.getShiftedBy(1),Y),W(te)&&Z.push(te)):X.add(te)):isListItemBlock(te)&&W(te)&&Z.push(te)}for(const Q of Y.values())Z.push(...N(Q,X));for(const Q of new Set(Z))B.reconvertItem(Q)};function N(G,Z){const Y=[],X=new Set,Q=[];for(const{node:te,previous:ie}of iterateSiblingListBlocks(G,"forward")){if(X.has(te))continue;const ne=te.getAttribute("listIndent");ie&&ne<ie.getAttribute("listIndent")&&(Q.length=ne+1),Q[ne]=Object.fromEntries(Array.from(te.getAttributes()).filter(([ae])=>t.includes(ae)));const le=getListItemBlocks(te,{direction:"forward"});for(const ae of le)X.add(ae),(W(ae,le)||K(ae,Q,Z))&&Y.push(ae)}return Y}function W(G,Z){const Y=B.mapper.toViewElement(G);if(!Y)return!1;if(V.fire("checkElement",{modelElement:G,viewElement:Y}))return!0;if(!G.is("element","paragraph")&&!G.is("element","listItem"))return!1;const Q=shouldUseBogusParagraph(G,t,Z);return Q&&Y.is("element","p")?!0:!!(!Q&&Y.is("element","span"))}function K(G,Z,Y){if(Y.has(G))return!1;const X=B.mapper.toViewElement(G);let Q=Z.length-1;for(let te=X.parent;!te.is("editableElement");te=te.parent){const ie=isListItemView(te),ne=isListView(te);if(!ne&&!ie)continue;const le=`checkAttributes:${ie?"item":"list"}`;if(V.fire(le,{viewElement:te,modelAttributes:Z[Q]}))break;if(ne&&(Q--,Q<0))return!1}return!0}}function listItemDowncastConverter(H,B,t,{dataPipeline:V}={}){const N=createAttributesConsumer(H);return(W,K,G)=>{const{writer:Z,mapper:Y,consumable:X}=G,Q=K.item;if(!H.includes(K.attributeKey)||!N(Q,X))return;const te=findMappedViewElement(Q,Y,t);removeCustomMarkerElements(te,Z,Y),unwrapListItemBlock(te,Z);const ie=insertCustomMarkerElements(Q,te,B,Z,{dataPipeline:V});wrapListItemBlock(Q,ie,B,Z)}}function listItemDowncastRemoveConverter(H){return(B,t,V)=>{const{writer:N,mapper:W}=V,K=B.name.split(":")[1];if(!H.checkAttribute(K,"listItemId"))return;const G=W.toViewPosition(t.position),Z=t.position.getShiftedBy(t.length),Y=W.toViewPosition(Z,{isPhantom:!0}),Q=N.createRange(G,Y).getTrimmed().end.nodeBefore;/* istanbul ignore next -- @preserve */Q&&removeCustomMarkerElements(Q,N,W)}}function bogusParagraphCreator(H,{dataPipeline:B}={}){return(t,{writer:V})=>{if(!shouldUseBogusParagraph(t,H))return null;if(!B)return V.createContainerElement("span",{class:"ck-list-bogus-paragraph"});const N=V.createContainerElement("p");return V.setCustomProperty("dataPipeline:transparentRendering",!0,N),N}}function findMappedViewElement(H,B,t){const V=t.createRangeOn(H);return B.toViewRange(V).getTrimmed().end.nodeBefore}function createModelToViewPositionMapper(H,B){return(t,V)=>{if(V.modelPosition.offset>0)return;const N=V.modelPosition.parent;if(!isListItemBlock(N)||!H.some(Y=>Y.scope=="itemMarker"&&Y.canInjectMarkerIntoElement&&Y.canInjectMarkerIntoElement(N)))return;const W=V.mapper.toViewElement(N),K=B.createRangeIn(W),G=K.getWalker();let Z=K.start;for(const{item:Y}of G){if(Y.is("element")&&V.mapper.toModelElement(Y)||Y.is("$textProxy"))break;Y.is("element")&&Y.getCustomProperty("listItemMarker")&&(Z=B.createPositionAfter(Y),G.skip(({previousPosition:X})=>!X.isEqual(Z)))}V.viewPosition=Z}}function removeCustomMarkerElements(H,B,t){for(;H.parent.is("attributeElement")&&H.parent.getCustomProperty("listItemWrapper");)B.unwrap(B.createRangeOn(H),H.parent);const V=[];N(B.createPositionBefore(H).getWalker({direction:"backward"})),N(B.createRangeIn(H).getWalker());for(const W of V)B.remove(W);function N(W){for(const{item:K}of W){if(K.is("element")&&t.toModelElement(K))break;K.is("element")&&K.getCustomProperty("listItemMarker")&&V.push(K)}}}function insertCustomMarkerElements(H,B,t,V,{dataPipeline:N}){let W=V.createRangeOn(B);if(!isFirstBlockOfListItem(H))return W;for(const K of t){if(K.scope!="itemMarker")continue;const G=K.createElement(V,H,{dataPipeline:N});if(!G||(V.setCustomProperty("listItemMarker",!0,G),K.canInjectMarkerIntoElement&&K.canInjectMarkerIntoElement(H)?V.insert(V.createPositionAt(B,0),G):(V.insert(W.start,G),W=V.createRange(V.createPositionBefore(G),V.createPositionAfter(B))),!K.createWrapperElement||!K.canWrapElement))continue;const Z=K.createWrapperElement(V,H,{dataPipeline:N});V.setCustomProperty("listItemWrapper",!0,Z),K.canWrapElement(H)?W=V.wrap(W,Z):(W=V.wrap(V.createRangeOn(G),Z),W=V.createRange(W.start,V.createPositionAfter(B)))}return W}function unwrapListItemBlock(H,B){let t=H.parent;for(;t.is("attributeElement")&&["ul","ol","li"].includes(t.name);){const V=t.parent;B.unwrap(B.createRangeOn(H),t),t=V}}function wrapListItemBlock(H,B,t,V){if(!H.hasAttribute("listIndent"))return;const N=H.getAttribute("listIndent");let W=H;for(let K=N;K>=0;K--){const G=createListItemElement(V,K,W.getAttribute("listItemId")),Z=createListElement(V,K,W.getAttribute("listType"));for(const Y of t)(Y.scope=="list"||Y.scope=="item")&&W.hasAttribute(Y.attributeName)&&Y.setAttributeOnDowncast(V,W.getAttribute(Y.attributeName),Y.scope=="list"?Z:G);if(B=V.wrap(B,G),B=V.wrap(B,Z),K==0||(W=ListWalker.first(W,{lowerIndent:!0}),!W))break}}function createAttributesConsumer(H){return(B,t)=>{const V=[];for(const N of H)B.hasAttribute(N)&&V.push(`attribute:${N}`);return V.every(N=>t.test(B,N)!==!1)?(V.forEach(N=>t.consume(B,N)),!0):!1}}function shouldUseBogusParagraph(H,B,t=getAllListItemBlocks(H)){if(!isListItemBlock(H))return!1;for(const V of H.getAttributeKeys())if(!V.startsWith("selection:")&&!B.includes(V))return!1;return t.length<2}const LIST_BASE_ATTRIBUTES=["listType","listIndent","listItemId"];class ListEditing extends Plugin{constructor(t){super(t);ee(this,"_downcastStrategies",[]);t.config.define("list.multiBlock",!0)}static get pluginName(){return"ListEditing"}static get requires(){return[Enter,Delete,ListUtils,ClipboardPipeline]}init(){const t=this.editor,V=t.model,N=t.config.get("list.multiBlock");if(t.plugins.has("LegacyListEditing"))throw new CKEditorError("list-feature-conflict",this,{conflictPlugin:"LegacyListEditing"});V.schema.register("$listItem",{allowAttributes:LIST_BASE_ATTRIBUTES}),N?(V.schema.extend("$container",{allowAttributesOf:"$listItem"}),V.schema.extend("$block",{allowAttributesOf:"$listItem"}),V.schema.extend("$blockObject",{allowAttributesOf:"$listItem"})):V.schema.register("listItem",{inheritAllFrom:"$block",allowAttributesOf:"$listItem"});for(const W of LIST_BASE_ATTRIBUTES)V.schema.setAttributeProperties(W,{copyOnReplace:!0});t.commands.add("numberedList",new ListCommand(t,"numbered")),t.commands.add("bulletedList",new ListCommand(t,"bulleted")),t.commands.add("customNumberedList",new ListCommand(t,"customNumbered",{multiLevel:!0})),t.commands.add("customBulletedList",new ListCommand(t,"customBulleted",{multiLevel:!0})),t.commands.add("indentList",new ListIndentCommand(t,"forward")),t.commands.add("outdentList",new ListIndentCommand(t,"backward")),t.commands.add("splitListItemBefore",new ListSplitCommand(t,"before")),t.commands.add("splitListItemAfter",new ListSplitCommand(t,"after")),N&&(t.commands.add("mergeListItemBackward",new ListMergeCommand(t,"backward")),t.commands.add("mergeListItemForward",new ListMergeCommand(t,"forward"))),this._setupDeleteIntegration(),this._setupEnterIntegration(),this._setupTabIntegration(),this._setupClipboardIntegration(),this._setupAccessibilityIntegration()}afterInit(){const V=this.editor.commands,N=V.get("indent"),W=V.get("outdent");N&&N.registerChildCommand(V.get("indentList"),{priority:"high"}),W&&W.registerChildCommand(V.get("outdentList"),{priority:"lowest"}),this._setupModelPostFixing(),this._setupConversion()}registerDowncastStrategy(t){this._downcastStrategies.push(t)}getListAttributeNames(){return[...LIST_BASE_ATTRIBUTES,...this._downcastStrategies.map(t=>t.attributeName)]}_setupDeleteIntegration(){const t=this.editor,V=t.commands.get("mergeListItemBackward"),N=t.commands.get("mergeListItemForward");this.listenTo(t.editing.view.document,"delete",(W,K)=>{const G=t.model.document.selection;getSelectedBlockObject(t.model)||t.model.change(()=>{const Z=G.getFirstPosition();if(G.isCollapsed&&K.direction=="backward"){if(!Z.isAtStart)return;const Y=Z.parent;if(!isListItemBlock(Y))return;if(!ListWalker.first(Y,{sameAttributes:"listType",sameIndent:!0})&&Y.getAttribute("listIndent")===0)isLastBlockOfListItem(Y)||t.execute("splitListItemAfter"),t.execute("outdentList");else{if(!V||!V.isEnabled)return;V.execute({shouldMergeOnBlocksContentLevel:shouldMergeOnBlocksContentLevel(t.model,"backward")})}K.preventDefault(),W.stop()}else{if(G.isCollapsed&&!G.getLastPosition().isAtEnd||!N||!N.isEnabled)return;N.execute({shouldMergeOnBlocksContentLevel:shouldMergeOnBlocksContentLevel(t.model,"forward")}),K.preventDefault(),W.stop()}})},{context:"li"})}_setupEnterIntegration(){const t=this.editor,V=t.model,N=t.commands,W=N.get("enter");this.listenTo(t.editing.view.document,"enter",(K,G)=>{const Z=V.document,Y=Z.selection.getFirstPosition().parent;if(Z.selection.isCollapsed&&isListItemBlock(Y)&&Y.isEmpty&&!G.isSoft){const X=isFirstBlockOfListItem(Y),Q=isLastBlockOfListItem(Y);X&&Q?(t.execute("outdentList"),G.preventDefault(),K.stop()):X&&!Q?(t.execute("splitListItemAfter"),G.preventDefault(),K.stop()):Q&&(t.execute("splitListItemBefore"),G.preventDefault(),K.stop())}},{context:"li"}),this.listenTo(W,"afterExecute",()=>{const K=N.get("splitListItemBefore");if(K.refresh(),!K.isEnabled)return;const Z=t.model.document.selection.getLastPosition().parent;getAllListItemBlocks(Z).length===2&&K.execute()})}_setupTabIntegration(){const t=this.editor;this.listenTo(t.editing.view.document,"tab",(V,N)=>{const W=N.shiftKey?"outdentList":"indentList";this.editor.commands.get(W).isEnabled&&(t.execute(W),N.stopPropagation(),N.preventDefault(),V.stop())},{context:"li"})}_setupConversion(){const t=this.editor,V=t.model,N=this.getListAttributeNames(),W=t.config.get("list.multiBlock"),K=W?"paragraph":"listItem";t.conversion.for("upcast").elementToElement({view:"li",model:(Z,{writer:Y})=>Y.createElement(K,{listType:""})}).elementToElement({view:"p",model:(Z,{writer:Y})=>Z.parent&&Z.parent.is("element","li")?Y.createElement(K,{listType:""}):null,converterPriority:"high"}).add(Z=>{Z.on("element:li",listItemUpcastConverter())}),W||t.conversion.for("downcast").elementToElement({model:"listItem",view:"p"}),t.conversion.for("editingDowncast").elementToElement({model:K,view:bogusParagraphCreator(N),converterPriority:"high"}).add(Z=>{Z.on("attribute",listItemDowncastConverter(N,this._downcastStrategies,V)),Z.on("remove",listItemDowncastRemoveConverter(V.schema))}),t.conversion.for("dataDowncast").elementToElement({model:K,view:bogusParagraphCreator(N,{dataPipeline:!0}),converterPriority:"high"}).add(Z=>{Z.on("attribute",listItemDowncastConverter(N,this._downcastStrategies,V,{dataPipeline:!0}))});const G=createModelToViewPositionMapper(this._downcastStrategies,t.editing.view);t.editing.mapper.on("modelToViewPosition",G),t.data.mapper.on("modelToViewPosition",G),this.listenTo(V.document,"change:data",reconvertItemsOnDataChange(V,t.editing,N,this),{priority:"high"}),this.on("checkAttributes:item",(Z,{viewElement:Y,modelAttributes:X})=>{Y.id!=X.listItemId&&(Z.return=!0,Z.stop())}),this.on("checkAttributes:list",(Z,{viewElement:Y,modelAttributes:X})=>{(Y.name!=getViewElementNameForListType(X.listType)||Y.id!=getViewElementIdForListType(X.listType,X.listIndent))&&(Z.return=!0,Z.stop())})}_setupModelPostFixing(){const t=this.editor.model,V=this.getListAttributeNames();t.document.registerPostFixer(N=>modelChangePostFixer$1(t,N,V,this)),this.on("postFixer",(N,{listNodes:W,writer:K})=>{N.return=fixListIndents(W,K)||N.return},{priority:"high"}),this.on("postFixer",(N,{listNodes:W,writer:K,seenIds:G})=>{N.return=fixListItemIds(W,G,K)||N.return},{priority:"high"})}_setupClipboardIntegration(){const t=this.editor.model,V=this.editor.plugins.get("ClipboardPipeline");this.listenTo(t,"insertContent",createModelIndentPasteFixer(t),{priority:"high"}),this.listenTo(V,"outputTransformation",(N,W)=>{t.change(K=>{const G=Array.from(W.content.getChildren()),Z=G[G.length-1];if(G.length>1&&Z.is("element")&&Z.isEmpty&&G.slice(0,-1).every(isListItemBlock)&&K.remove(Z),W.method=="copy"||W.method=="cut"){const Y=Array.from(W.content.getChildren());isSingleListItem(Y)&&removeListAttributes(Y,K)}})})}_setupAccessibilityIntegration(){const t=this.editor,V=t.t;t.accessibility.addKeystrokeInfoGroup({id:"list",label:V("Keystrokes that can be used in a list"),keystrokes:[{label:V("Increase list item indent"),keystroke:"Tab"},{label:V("Decrease list item indent"),keystroke:"Shift+Tab"}]})}}function modelChangePostFixer$1(H,B,t,V){const N=H.document.differ.getChanges(),W=new Map,K=V.editor.config.get("list.multiBlock");let G=!1;for(const Y of N){if(Y.type=="insert"&&Y.name!="$text"){const X=Y.position.nodeAfter;if(!H.schema.checkAttribute(X,"listItemId"))for(const Q of Array.from(X.getAttributeKeys()))t.includes(Q)&&(B.removeAttribute(Q,X),G=!0);findAndAddListHeadToMap(Y.position,W),Y.attributes.has("listItemId")||findAndAddListHeadToMap(Y.position.getShiftedBy(Y.length),W);for(const{item:Q,previousPosition:te}of H.createRangeIn(X))isListItemBlock(Q)&&findAndAddListHeadToMap(te,W)}else Y.type=="remove"?findAndAddListHeadToMap(Y.position,W):Y.type=="attribute"&&t.includes(Y.attributeKey)&&(findAndAddListHeadToMap(Y.range.start,W),Y.attributeNewValue===null&&findAndAddListHeadToMap(Y.range.start.getShiftedBy(1),W));if(!K&&Y.type=="attribute"&&LIST_BASE_ATTRIBUTES.includes(Y.attributeKey)){const X=Y.range.start.nodeAfter;Y.attributeNewValue===null&&X&&X.is("element","listItem")?(B.rename(X,"paragraph"),G=!0):Y.attributeOldValue===null&&X&&X.is("element")&&X.name!="listItem"&&(B.rename(X,"listItem"),G=!0)}}const Z=new Set;for(const Y of W.values())G=V.fire("postFixer",{listNodes:new ListBlocksIterable(Y),listHead:Y,writer:B,seenIds:Z})||G;return G}function createModelIndentPasteFixer(H){return(B,[t,V])=>{const N=t.is("documentFragment")?Array.from(t.getChildren()):[t];if(!N.length)return;const K=(V?H.createSelection(V):H.document.selection).getFirstPosition();let G;if(isListItemBlock(K.parent))G=K.parent;else if(isListItemBlock(K.nodeBefore))G=K.nodeBefore;else return;H.change(Z=>{const Y=G.getAttribute("listType"),X=G.getAttribute("listIndent"),Q=N[0].getAttribute("listIndent")||0,te=Math.max(X-Q,0);for(const ie of N){const ne=isListItemBlock(ie);G.is("element","listItem")&&ie.is("element","paragraph")&&Z.rename(ie,"listItem"),Z.setAttributes({listIndent:(ne?ie.getAttribute("listIndent"):0)+te,listItemId:ne?ie.getAttribute("listItemId"):ListItemUid.next(),listType:Y},ie)}})}}function shouldMergeOnBlocksContentLevel(H,B){const t=H.document.selection;if(!t.isCollapsed)return!getSelectedBlockObject(H);if(B==="forward")return!0;const N=t.getFirstPosition().parent,W=N.previousSibling;return H.schema.isObject(W)?!1:W.isEmpty?!0:isSingleListItem([N,W])}function createUIComponents(H,B,t,V){H.ui.componentFactory.add(B,()=>{const N=_createButton(ButtonView,H,B,t,V);return N.set({tooltip:!0,isToggleable:!0}),N}),H.ui.componentFactory.add(`menuBar:${B}`,()=>{const N=_createButton(MenuBarMenuListItemButtonView,H,B,t,V);return N.set({role:"menuitemcheckbox",isToggleable:!0}),N})}function _createButton(H,B,t,V,N){const W=B.commands.get(t),K=new H(B.locale);return K.set({label:V,icon:N}),K.bind("isOn","isEnabled").to(W,"value","isEnabled"),K.on("execute",()=>{B.execute(t),B.editing.view.focus()}),K}class ListUI extends Plugin{static get pluginName(){return"ListUI"}init(){const B=this.editor.t;this.editor.ui.componentFactory.has("numberedList")||createUIComponents(this.editor,"numberedList",B("Numbered List"),icons.numberedList),this.editor.ui.componentFactory.has("bulletedList")||createUIComponents(this.editor,"bulletedList",B("Bulleted List"),icons.bulletedList)}}class List extends Plugin{static get requires(){return[ListEditing,ListUI]}static get pluginName(){return"List"}}class ListStartCommand extends Command{refresh(){const B=this._getValue();this.value=B,this.isEnabled=B!=null}execute({startIndex:B=1}={}){const t=this.editor.model,V=t.document;let N=Array.from(V.selection.getSelectedBlocks()).filter(W=>isListItemBlock(W)&&isNumberedListType(W.getAttribute("listType")));N=expandListBlocksToCompleteList(N),t.change(W=>{for(const K of N)W.setAttribute("listStart",B>=0?B:1,K)})}_getValue(){const t=this.editor.model.document,V=first(t.selection.getSelectedBlocks());return V&&isListItemBlock(V)&&isNumberedListType(V.getAttribute("listType"))?V.getAttribute("listStart"):null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const LIST_STYLE_TO_LIST_TYPE={},LIST_STYLE_TO_TYPE_ATTRIBUTE={},TYPE_ATTRIBUTE_TO_LIST_STYLE={},LIST_STYLE_TYPES=[{listStyle:"disc",typeAttribute:"disc",listType:"bulleted"},{listStyle:"circle",typeAttribute:"circle",listType:"bulleted"},{listStyle:"square",typeAttribute:"square",listType:"bulleted"},{listStyle:"decimal",typeAttribute:"1",listType:"numbered"},{listStyle:"decimal-leading-zero",typeAttribute:null,listType:"numbered"},{listStyle:"lower-roman",typeAttribute:"i",listType:"numbered"},{listStyle:"upper-roman",typeAttribute:"I",listType:"numbered"},{listStyle:"lower-alpha",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-alpha",typeAttribute:"A",listType:"numbered"},{listStyle:"lower-latin",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-latin",typeAttribute:"A",listType:"numbered"}];for(const{listStyle:H,typeAttribute:B,listType:t}of LIST_STYLE_TYPES)LIST_STYLE_TO_LIST_TYPE[H]=t,LIST_STYLE_TO_TYPE_ATTRIBUTE[H]=B,B&&(TYPE_ATTRIBUTE_TO_LIST_STYLE[B]=H);function getAllSupportedStyleTypes(){return LIST_STYLE_TYPES.map(H=>H.listStyle)}function getListTypeFromListStyleType$1(H){return LIST_STYLE_TO_LIST_TYPE[H]||null}function getListStyleTypeFromTypeAttribute(H){return TYPE_ATTRIBUTE_TO_LIST_STYLE[H]||null}function getTypeAttributeFromListStyleType(H){return LIST_STYLE_TO_TYPE_ATTRIBUTE[H]||null}class ListStyleCommand extends Command{constructor(t,V,N){super(t);ee(this,"defaultType");ee(this,"_supportedTypes");this.defaultType=V,this._supportedTypes=N}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(t={}){const V=this.editor.model,N=V.document;V.change(W=>{this._tryToConvertItemsToList(t);let K=Array.from(N.selection.getSelectedBlocks()).filter(G=>G.hasAttribute("listType"));if(K.length){K=expandListBlocksToCompleteList(K);for(const G of K)W.setAttribute("listStyle",t.type||this.defaultType,G)}})}isStyleTypeSupported(t){return this._supportedTypes?this._supportedTypes.includes(t):!0}_getValue(){const t=first(this.editor.model.document.selection.getSelectedBlocks());return isListItemBlock(t)?t.getAttribute("listStyle"):null}_checkEnabled(){const t=this.editor,V=t.commands.get("numberedList"),N=t.commands.get("bulletedList");return V.isEnabled||N.isEnabled}_tryToConvertItemsToList(t){if(!t.type)return;const V=getListTypeFromListStyleType$1(t.type);if(!V)return;const N=this.editor,W=`${V}List`;N.commands.get(W).value||N.execute(W)}}class ListReversedCommand extends Command{refresh(){const B=this._getValue();this.value=B,this.isEnabled=B!=null}execute(B={}){const t=this.editor.model,V=t.document;let N=Array.from(V.selection.getSelectedBlocks()).filter(W=>isListItemBlock(W)&&W.getAttribute("listType")=="numbered");N=expandListBlocksToCompleteList(N),t.change(W=>{for(const K of N)W.setAttribute("listReversed",!!B.reversed,K)})}_getValue(){const t=this.editor.model.document,V=first(t.selection.getSelectedBlocks());return isListItemBlock(V)&&V.getAttribute("listType")=="numbered"?V.getAttribute("listReversed"):null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function listPropertiesUpcastConverter(H){return(B,t,V)=>{const{writer:N,schema:W,consumable:K}=V;if(K.test(t.viewItem,H.viewConsumables)===!1)return;t.modelRange||Object.assign(t,V.convertChildren(t.viewItem,t.modelCursor));let G=!1;for(const Z of t.modelRange.getItems({shallow:!0}))W.checkAttribute(Z,H.attributeName)&&H.appliesToListItem(Z)&&(Z.hasAttribute(H.attributeName)||(N.setAttribute(H.attributeName,H.getAttributeOnUpcast(t.viewItem),Z),G=!0));G&&K.consume(t.viewItem,H.viewConsumables)}}class ListPropertiesUtils extends Plugin{static get pluginName(){return"ListPropertiesUtils"}getAllSupportedStyleTypes(){return getAllSupportedStyleTypes()}getListTypeFromListStyleType(B){return getListTypeFromListStyleType$1(B)}getListStyleTypeFromTypeAttribute(B){return getListStyleTypeFromTypeAttribute(B)}getTypeAttributeFromListStyleType(B){return getTypeAttributeFromListStyleType(B)}}function getNormalizedConfig(H){const{startIndex:B,reversed:t,styles:V}=H;return{styles:getNormalizedStylesConfig(V),startIndex:B||!1,reversed:t||!1}}function getNormalizedStylesConfig(H){const B={listTypes:["bulleted","numbered"],useAttribute:!1};return H===!0||(H?Array.isArray(H)||typeof H=="string"?B.listTypes=toArray$2(H):(B.listTypes=H.listTypes?toArray$2(H.listTypes):B.listTypes,B.useAttribute=!!H.useAttribute):B.listTypes=[]),B}const DEFAULT_LIST_TYPE$1="default";class ListPropertiesEditing extends Plugin{static get requires(){return[ListEditing,ListPropertiesUtils]}static get pluginName(){return"ListPropertiesEditing"}constructor(B){super(B),B.config.define("list.properties",{styles:!0,startIndex:!1,reversed:!1})}init(){const B=this.editor,t=B.model,V=B.plugins.get(ListEditing),N=B.config.get("list.properties"),W=createAttributeStrategies$1(N);for(const K of W)K.addCommand(B),t.schema.extend("$listItem",{allowAttributes:K.attributeName}),V.registerDowncastStrategy({scope:"list",attributeName:K.attributeName,setAttributeOnDowncast(G,Z,Y){K.setAttributeOnDowncast(G,Z,Y)}});B.conversion.for("upcast").add(K=>{for(const G of W)K.on("element:ol",listPropertiesUpcastConverter(G)),K.on("element:ul",listPropertiesUpcastConverter(G))}),V.on("checkAttributes:list",(K,{viewElement:G,modelAttributes:Z})=>{for(const Y of W)Y.getAttributeOnUpcast(G)!=Z[Y.attributeName]&&(K.return=!0,K.stop())}),this.listenTo(B.commands.get("indentList"),"afterExecute",(K,G)=>{t.change(Z=>{for(const Y of G)for(const X of W)X.appliesToListItem(Y)&&Z.setAttribute(X.attributeName,X.defaultValue,Y)})}),V.on("postFixer",(K,{listNodes:G,writer:Z})=>{for(const{node:Y}of G)for(const X of W)X.hasValidAttribute(Y)||(X.appliesToListItem(Y)?Z.setAttribute(X.attributeName,X.defaultValue,Y):Z.removeAttribute(X.attributeName,Y),K.return=!0)}),V.on("postFixer",(K,{listNodes:G,writer:Z})=>{for(const{node:Y,previousNodeInList:X}of G)if(X&&X.getAttribute("listType")==Y.getAttribute("listType"))for(const Q of W){const{attributeName:te}=Q;if(!Q.appliesToListItem(Y))continue;const ie=X.getAttribute(te);Y.getAttribute(te)!=ie&&(Z.setAttribute(te,ie,Y),K.return=!0)}})}}function createAttributeStrategies$1(H){const B=[],t=getNormalizedConfig(H);if(H.styles){const V=t.styles.useAttribute;B.push({attributeName:"listStyle",defaultValue:DEFAULT_LIST_TYPE$1,viewConsumables:{styles:"list-style-type"},addCommand(N){let W=getAllSupportedStyleTypes();V&&(W=W.filter(K=>!!getTypeAttributeFromListStyleType(K))),N.commands.add("listStyle",new ListStyleCommand(N,DEFAULT_LIST_TYPE$1,W))},appliesToListItem(N){return N.getAttribute("listType")=="numbered"||N.getAttribute("listType")=="bulleted"},hasValidAttribute(N){if(!this.appliesToListItem(N))return!N.hasAttribute("listStyle");if(!N.hasAttribute("listStyle"))return!1;const W=N.getAttribute("listStyle");return W==DEFAULT_LIST_TYPE$1?!0:getListTypeFromListStyleType$1(W)==N.getAttribute("listType")},setAttributeOnDowncast(N,W,K){if(W&&W!==DEFAULT_LIST_TYPE$1)if(V){const G=getTypeAttributeFromListStyleType(W);if(G){N.setAttribute("type",G,K);return}}else{N.setStyle("list-style-type",W,K);return}N.removeStyle("list-style-type",K),N.removeAttribute("type",K)},getAttributeOnUpcast(N){const W=N.getStyle("list-style-type");if(W)return W;const K=N.getAttribute("type");return K?getListStyleTypeFromTypeAttribute(K):DEFAULT_LIST_TYPE$1}})}return H.reversed&&B.push({attributeName:"listReversed",defaultValue:!1,viewConsumables:{attributes:"reversed"},addCommand(V){V.commands.add("listReversed",new ListReversedCommand(V))},appliesToListItem(V){return V.getAttribute("listType")=="numbered"},hasValidAttribute(V){return this.appliesToListItem(V)==V.hasAttribute("listReversed")},setAttributeOnDowncast(V,N,W){N?V.setAttribute("reversed","reversed",W):V.removeAttribute("reversed",W)},getAttributeOnUpcast(V){return V.hasAttribute("reversed")}}),H.startIndex&&B.push({attributeName:"listStart",defaultValue:1,viewConsumables:{attributes:"start"},addCommand(V){V.commands.add("listStart",new ListStartCommand(V))},appliesToListItem(V){return isNumberedListType(V.getAttribute("listType"))},hasValidAttribute(V){return this.appliesToListItem(V)==V.hasAttribute("listStart")},setAttributeOnDowncast(V,N,W){N==0||N>1?V.setAttribute("start",N,W):V.removeAttribute("start",W)},getAttributeOnUpcast(V){const N=V.getAttribute("start");return N>=0?N:1}}),B}class ListPropertiesView extends View{constructor(t,{enabledProperties:V,styleButtonViews:N,styleGridAriaLabel:W}){super(t);ee(this,"children");ee(this,"stylesView",null);ee(this,"additionalPropertiesCollapsibleView",null);ee(this,"startIndexFieldView",null);ee(this,"reversedSwitchButtonView",null);ee(this,"focusTracker",new FocusTracker);ee(this,"keystrokes",new KeystrokeHandler);ee(this,"focusables",new ViewCollection);ee(this,"focusCycler");const K=["ck","ck-list-properties"];this.children=this.createCollection(),this.focusCycler=new FocusCycler({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),N&&N.length?(this.stylesView=this._createStylesView(N,W),this.children.add(this.stylesView)):K.push("ck-list-properties_without-styles"),(V.startIndex||V.reversed)&&(this._addNumberedListPropertyViews(V),K.push("ck-list-properties_with-numbered-properties")),this.setTemplate({tag:"div",attributes:{class:K},children:this.children})}render(){if(super.render(),this.stylesView){this.focusables.add(this.stylesView),this.focusTracker.add(this.stylesView.element),(this.startIndexFieldView||this.reversedSwitchButtonView)&&(this.focusables.add(this.children.last.buttonView),this.focusTracker.add(this.children.last.buttonView.element));for(const t of this.stylesView.children)this.stylesView.focusTracker.add(t.element);addKeyboardHandlingForGrid({keystrokeHandler:this.stylesView.keystrokes,focusTracker:this.stylesView.focusTracker,gridItems:this.stylesView.children,numberOfColumns:()=>global$1.window.getComputedStyle(this.stylesView.element).getPropertyValue("grid-template-columns").split(" ").length,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}if(this.startIndexFieldView){this.focusables.add(this.startIndexFieldView),this.focusTracker.add(this.startIndexFieldView.element);const t=V=>V.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}this.reversedSwitchButtonView&&(this.focusables.add(this.reversedSwitchButtonView),this.focusTracker.add(this.reversedSwitchButtonView.element)),this.keystrokes.listenTo(this.element)}focus(){this.focusCycler.focusFirst()}focusLast(){this.focusCycler.focusLast()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createStylesView(t,V){const N=new View(this.locale);return N.children=N.createCollection(),N.children.addMany(t),N.setTemplate({tag:"div",attributes:{"aria-label":V,class:["ck","ck-list-styles-list"]},children:N.children}),N.children.delegate("execute").to(this),N.focus=function(){this.children.first.focus()},N.focusTracker=new FocusTracker,N.keystrokes=new KeystrokeHandler,N.render(),N.keystrokes.listenTo(N.element),N}_addNumberedListPropertyViews(t){const V=this.locale.t,N=[];t.startIndex&&(this.startIndexFieldView=this._createStartIndexField(),N.push(this.startIndexFieldView)),t.reversed&&(this.reversedSwitchButtonView=this._createReversedSwitchButton(),N.push(this.reversedSwitchButtonView)),this.stylesView?(this.additionalPropertiesCollapsibleView=new CollapsibleView(this.locale,N),this.additionalPropertiesCollapsibleView.set({label:V("List properties"),isCollapsed:!0}),this.additionalPropertiesCollapsibleView.buttonView.bind("isEnabled").toMany(N,"isEnabled",(...W)=>W.some(K=>K)),this.additionalPropertiesCollapsibleView.buttonView.on("change:isEnabled",(W,K,G)=>{G||(this.additionalPropertiesCollapsibleView.isCollapsed=!0)}),this.children.add(this.additionalPropertiesCollapsibleView)):this.children.addMany(N)}_createStartIndexField(){const t=this.locale.t,V=new LabeledFieldView(this.locale,createLabeledInputNumber);return V.set({label:t("Start at"),class:"ck-numbered-list-properties__start-index"}),V.fieldView.set({min:0,step:1,value:1,inputMode:"numeric"}),V.fieldView.on("input",()=>{const N=V.fieldView.element,W=N.valueAsNumber;if(Number.isNaN(W)){V.errorText=t("Invalid start index value.");return}N.checkValidity()?this.fire("listStart",{startIndex:W}):V.errorText=t("Start index must be greater than 0.")}),V}_createReversedSwitchButton(){const t=this.locale.t,V=new SwitchButtonView(this.locale);return V.set({withText:!0,label:t("Reversed order"),class:"ck-numbered-list-properties__reversed-order"}),V.delegate("execute").to(this,"listReversed"),V}}var listStyleDiscIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M11 27a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0-9a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0-9a3 3 0 1 1 0 6 3 3 0 0 1 0-6z"/></svg>',listStyleCircleIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M11 27a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm0-10a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm0-10a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"/></svg>',listStyleSquareIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M14 27v6H8v-6h6zm0-9v6H8v-6h6zm0-9v6H8V9h6z"/></svg>',listStyleDecimalIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M10.29 15V8.531H9.286c-.14.393-.4.736-.778 1.03-.378.295-.728.495-1.05.6v1.121a4.257 4.257 0 0 0 1.595-.936V15h1.235zm3.343 0v-1.235h-1.235V15h1.235zM11.3 24v-1.147H8.848c.064-.111.148-.226.252-.343.104-.117.351-.354.74-.712.39-.357.66-.631.81-.821.225-.288.39-.562.494-.824.104-.263.156-.539.156-.829 0-.51-.182-.936-.545-1.279-.363-.342-.863-.514-1.499-.514-.58 0-1.063.148-1.45.444-.387.296-.617.784-.69 1.463l1.23.124c.024-.36.112-.619.264-.774.153-.155.358-.233.616-.233.26 0 .465.074.613.222.148.148.222.36.222.635 0 .25-.085.501-.255.756-.126.185-.468.536-1.024 1.055-.692.641-1.155 1.156-1.389 1.544-.234.389-.375.8-.422 1.233H11.3zm2.333 0v-1.235h-1.235V24h1.235zM9.204 34.11c.615 0 1.129-.2 1.542-.598.413-.398.62-.88.62-1.446 0-.39-.11-.722-.332-.997a1.5 1.5 0 0 0-.886-.532c.619-.337.928-.788.928-1.353 0-.399-.151-.756-.453-1.073-.366-.386-.852-.58-1.459-.58a2.25 2.25 0 0 0-.96.2 1.617 1.617 0 0 0-.668.55c-.16.232-.28.544-.358.933l1.138.194c.032-.282.123-.495.272-.642.15-.146.33-.22.54-.22.215 0 .386.065.515.194s.193.302.193.518c0 .255-.087.46-.263.613-.176.154-.43.227-.765.218l-.136 1.006c.22-.061.409-.092.567-.092.24 0 .444.09.61.272.168.182.251.428.251.739 0 .328-.087.589-.261.782a.833.833 0 0 1-.644.29.841.841 0 0 1-.607-.242c-.167-.16-.27-.394-.307-.698l-1.196.145c.062.542.285.98.668 1.316.384.335.868.503 1.45.503zm4.43-.11v-1.235h-1.236V34h1.235z"/></svg>',listStyleDecimalWithLeadingZeroIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M5.714 15.11c.624 0 1.11-.22 1.46-.66.421-.533.632-1.408.632-2.627 0-1.222-.21-2.096-.629-2.624-.351-.445-.839-.668-1.463-.668-.624 0-1.11.22-1.459.66-.422.533-.633 1.406-.633 2.619 0 1.236.192 2.095.576 2.577.384.482.89.723 1.516.723zm0-1.024a.614.614 0 0 1-.398-.14c-.115-.094-.211-.283-.287-.565-.077-.283-.115-.802-.115-1.558s.043-1.294.128-1.613c.064-.246.155-.417.272-.512a.617.617 0 0 1 .4-.143.61.61 0 0 1 .398.143c.116.095.211.284.288.567.076.283.114.802.114 1.558s-.043 1.292-.128 1.608c-.064.246-.155.417-.272.512a.617.617 0 0 1-.4.143zm6.078.914V8.531H10.79c-.14.393-.4.736-.778 1.03-.378.295-.728.495-1.05.6v1.121a4.257 4.257 0 0 0 1.595-.936V15h1.235zm3.344 0v-1.235h-1.235V15h1.235zm-9.422 9.11c.624 0 1.11-.22 1.46-.66.421-.533.632-1.408.632-2.627 0-1.222-.21-2.096-.629-2.624-.351-.445-.839-.668-1.463-.668-.624 0-1.11.22-1.459.66-.422.533-.633 1.406-.633 2.619 0 1.236.192 2.095.576 2.577.384.482.89.723 1.516.723zm0-1.024a.614.614 0 0 1-.398-.14c-.115-.094-.211-.283-.287-.565-.077-.283-.115-.802-.115-1.558s.043-1.294.128-1.613c.064-.246.155-.417.272-.512a.617.617 0 0 1 .4-.143.61.61 0 0 1 .398.143c.116.095.211.284.288.567.076.283.114.802.114 1.558s-.043 1.292-.128 1.608c-.064.246-.155.417-.272.512a.617.617 0 0 1-.4.143zm7.088.914v-1.147H10.35c.065-.111.149-.226.253-.343.104-.117.35-.354.74-.712.39-.357.66-.631.81-.821.225-.288.39-.562.493-.824.104-.263.156-.539.156-.829 0-.51-.181-.936-.544-1.279-.364-.342-.863-.514-1.499-.514-.58 0-1.063.148-1.45.444-.387.296-.617.784-.69 1.463l1.23.124c.024-.36.112-.619.264-.774.152-.155.357-.233.615-.233.261 0 .465.074.613.222.148.148.222.36.222.635 0 .25-.085.501-.255.756-.126.185-.467.536-1.024 1.055-.691.641-1.154 1.156-1.388 1.544-.235.389-.375.8-.422 1.233h4.328zm2.334 0v-1.235h-1.235V24h1.235zM5.714 34.11c.624 0 1.11-.22 1.46-.66.421-.533.632-1.408.632-2.627 0-1.222-.21-2.096-.629-2.624-.351-.445-.839-.668-1.463-.668-.624 0-1.11.22-1.459.66-.422.533-.633 1.406-.633 2.619 0 1.236.192 2.095.576 2.577.384.482.89.723 1.516.723zm0-1.024a.614.614 0 0 1-.398-.14c-.115-.094-.211-.283-.287-.565-.077-.283-.115-.802-.115-1.558s.043-1.294.128-1.613c.064-.246.155-.417.272-.512a.617.617 0 0 1 .4-.143.61.61 0 0 1 .398.143c.116.095.211.284.288.567.076.283.114.802.114 1.558s-.043 1.292-.128 1.608c-.064.246-.155.417-.272.512a.617.617 0 0 1-.4.143zm4.992 1.024c.616 0 1.13-.2 1.543-.598.413-.398.62-.88.62-1.446 0-.39-.111-.722-.332-.997a1.5 1.5 0 0 0-.886-.532c.618-.337.927-.788.927-1.353 0-.399-.15-.756-.452-1.073-.366-.386-.853-.58-1.46-.58a2.25 2.25 0 0 0-.96.2 1.617 1.617 0 0 0-.667.55c-.16.232-.28.544-.359.933l1.139.194c.032-.282.123-.495.272-.642.15-.146.33-.22.54-.22.214 0 .386.065.515.194s.193.302.193.518c0 .255-.088.46-.264.613-.175.154-.43.227-.764.218l-.136 1.006c.22-.061.408-.092.566-.092.24 0 .444.09.611.272.167.182.25.428.25.739 0 .328-.086.589-.26.782a.833.833 0 0 1-.644.29.841.841 0 0 1-.607-.242c-.167-.16-.27-.394-.308-.698l-1.195.145c.062.542.284.98.668 1.316.384.335.867.503 1.45.503zm4.43-.11v-1.235h-1.235V34h1.235z"/></svg>',listStyleLowerRomanIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M11.88 8.7V7.558h-1.234V8.7h1.234zm0 5.3V9.333h-1.234V14h1.234zm2.5 0v-1.235h-1.234V14h1.235zm-4.75 4.7v-1.142H8.395V18.7H9.63zm0 5.3v-4.667H8.395V24H9.63zm2.5-5.3v-1.142h-1.234V18.7h1.235zm0 5.3v-4.667h-1.234V24h1.235zm2.501 0v-1.235h-1.235V24h1.235zM7.38 28.7v-1.142H6.145V28.7H7.38zm0 5.3v-4.667H6.145V34H7.38zm2.5-5.3v-1.142H8.646V28.7H9.88zm0 5.3v-4.667H8.646V34H9.88zm2.5-5.3v-1.142h-1.234V28.7h1.235zm0 5.3v-4.667h-1.234V34h1.235zm2.501 0v-1.235h-1.235V34h1.235z"/></svg>',listStyleUpperRomanIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M11.916 15V8.558h-1.301V15h1.3zm2.465 0v-1.235h-1.235V15h1.235zM9.665 25v-6.442h-1.3V25h1.3zm2.5 0v-6.442h-1.3V25h1.3zm2.466 0v-1.235h-1.235V25h1.235zm-7.216 9v-6.442h-1.3V34h1.3zm2.5 0v-6.442h-1.3V34h1.3zm2.501 0v-6.442h-1.3V34h1.3zm2.465 0v-1.235h-1.235V34h1.235z"/></svg>',listStyleLowerLatinIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="M9.62 14.105c.272 0 .528-.05.768-.153s.466-.257.677-.462c.009.024.023.072.044.145.047.161.086.283.119.365h1.221a2.649 2.649 0 0 1-.222-.626c-.04-.195-.059-.498-.059-.908l.013-1.441c0-.536-.055-.905-.165-1.105-.11-.201-.3-.367-.569-.497-.27-.13-.68-.195-1.23-.195-.607 0-1.064.108-1.371.325-.308.217-.525.55-.65 1.002l1.12.202c.076-.217.176-.369.299-.455.123-.086.294-.13.514-.13.325 0 .546.05.663.152.118.101.176.27.176.508v.123c-.222.093-.622.194-1.2.303-.427.082-.755.178-.982.288-.227.11-.403.268-.53.474a1.327 1.327 0 0 0-.188.706c0 .398.138.728.415.988.277.261.656.391 1.136.391zm.368-.87a.675.675 0 0 1-.492-.189.606.606 0 0 1-.193-.448c0-.176.08-.32.241-.435.106-.07.33-.142.673-.215a7.19 7.19 0 0 0 .751-.19v.247c0 .296-.016.496-.048.602a.773.773 0 0 1-.295.409 1.07 1.07 0 0 1-.637.22zm4.645.765v-1.235h-1.235V14h1.235zM10.2 25.105c.542 0 1.003-.215 1.382-.646.38-.43.57-1.044.57-1.84 0-.771-.187-1.362-.559-1.774a1.82 1.82 0 0 0-1.41-.617c-.522 0-.973.216-1.354.65v-2.32H7.594V25h1.147v-.686a1.9 1.9 0 0 0 .67.592c.26.133.523.2.79.2zm-.299-.975c-.354 0-.638-.164-.852-.492-.153-.232-.229-.59-.229-1.073 0-.468.098-.818.295-1.048a.93.93 0 0 1 .738-.345c.302 0 .55.118.743.354.193.236.29.62.29 1.154 0 .5-.096.868-.288 1.1-.192.233-.424.35-.697.35zm4.478.87v-1.235h-1.234V25h1.234zm-4.017 9.105c.6 0 1.08-.142 1.437-.426.357-.284.599-.704.725-1.261l-1.213-.207c-.061.326-.167.555-.316.688a.832.832 0 0 1-.576.2.916.916 0 0 1-.75-.343c-.185-.228-.278-.62-.278-1.173 0-.498.091-.853.274-1.066.183-.212.429-.318.736-.318.232 0 .42.061.565.184.145.123.238.306.28.55l1.216-.22c-.146-.501-.387-.874-.722-1.119-.336-.244-.788-.366-1.356-.366-.695 0-1.245.214-1.653.643-.407.43-.61 1.03-.61 1.8 0 .762.202 1.358.608 1.788.406.431.95.646 1.633.646zM14.633 34v-1.235h-1.235V34h1.235z"/></svg>',listStyleUpperLatinIcon='<svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M35 29a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17zm0-9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H18a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1h17z" fill-opacity=".163"/><path d="m7.88 15 .532-1.463h2.575L11.549 15h1.415l-2.58-6.442H9.01L6.5 15h1.38zm2.69-2.549H8.811l.87-2.39.887 2.39zM14.88 15v-1.235h-1.234V15h1.234zM9.352 25c.83-.006 1.352-.02 1.569-.044.346-.038.636-.14.872-.305.236-.166.422-.387.558-.664.137-.277.205-.562.205-.855 0-.372-.106-.695-.317-.97-.21-.276-.512-.471-.905-.585a1.51 1.51 0 0 0 .661-.567 1.5 1.5 0 0 0 .244-.83c0-.28-.066-.53-.197-.754a1.654 1.654 0 0 0-.495-.539 1.676 1.676 0 0 0-.672-.266c-.25-.042-.63-.063-1.14-.063H7.158V25h2.193zm.142-3.88H8.46v-1.49h.747c.612 0 .983.007 1.112.022.217.026.38.102.49.226.11.125.165.287.165.486a.68.68 0 0 1-.192.503.86.86 0 0 1-.525.23 11.47 11.47 0 0 1-.944.023h.18zm.17 2.795H8.46v-1.723h1.05c.592 0 .977.03 1.154.092.177.062.313.16.406.295a.84.84 0 0 1 .14.492c0 .228-.06.41-.181.547a.806.806 0 0 1-.473.257c-.126.026-.423.04-.892.04zM14.88 25v-1.235h-1.234V25h1.234zm-5.018 9.11c.691 0 1.262-.17 1.711-.512.45-.341.772-.864.965-1.567l-1.261-.4c-.109.472-.287.818-.536 1.037-.25.22-.547.33-.892.33-.47 0-.85-.173-1.143-.519-.293-.345-.44-.925-.44-1.74 0-.767.15-1.322.447-1.665.297-.343.684-.514 1.162-.514.346 0 .64.096.881.29.242.193.4.457.477.79l1.288-.307c-.147-.516-.367-.911-.66-1.187-.492-.465-1.132-.698-1.92-.698-.902 0-1.63.296-2.184.89-.554.593-.83 1.426-.83 2.498 0 1.014.275 1.813.825 2.397.551.585 1.254.877 2.11.877zM14.88 34v-1.235h-1.234V34h1.234z"/></svg>';class ListPropertiesUI extends Plugin{static get pluginName(){return"ListPropertiesUI"}init(){const B=this.editor,t=B.locale.t,V=B.config.get("list.properties"),N=getNormalizedConfig(V),W=N.styles.listTypes;if(W.includes("bulleted")){const K=[{label:t("Toggle the disc list style"),tooltip:t("Disc"),type:"disc",icon:listStyleDiscIcon},{label:t("Toggle the circle list style"),tooltip:t("Circle"),type:"circle",icon:listStyleCircleIcon},{label:t("Toggle the square list style"),tooltip:t("Square"),type:"square",icon:listStyleSquareIcon}],G=t("Bulleted List"),Z=t("Bulleted list styles toolbar"),Y="bulletedList";B.ui.componentFactory.add(Y,getDropdownViewCreator({editor:B,normalizedConfig:N,parentCommandName:Y,buttonLabel:G,buttonIcon:icons.bulletedList,styleGridAriaLabel:Z,styleDefinitions:K})),B.ui.componentFactory.add(`menuBar:${Y}`,getMenuBarStylesMenuCreator({editor:B,normalizedConfig:N,parentCommandName:Y,buttonLabel:G,styleGridAriaLabel:Z,styleDefinitions:K}))}if(W.includes("numbered")||V.startIndex||V.reversed){const K=[{label:t("Toggle the decimal list style"),tooltip:t("Decimal"),type:"decimal",icon:listStyleDecimalIcon},{label:t("Toggle the decimal with leading zero list style"),tooltip:t("Decimal with leading zero"),type:"decimal-leading-zero",icon:listStyleDecimalWithLeadingZeroIcon},{label:t("Toggle the lower–roman list style"),tooltip:t("Lower–roman"),type:"lower-roman",icon:listStyleLowerRomanIcon},{label:t("Toggle the upper–roman list style"),tooltip:t("Upper-roman"),type:"upper-roman",icon:listStyleUpperRomanIcon},{label:t("Toggle the lower–latin list style"),tooltip:t("Lower-latin"),type:"lower-latin",icon:listStyleLowerLatinIcon},{label:t("Toggle the upper–latin list style"),tooltip:t("Upper-latin"),type:"upper-latin",icon:listStyleUpperLatinIcon}],G=t("Numbered List"),Z=t("Numbered list styles toolbar"),Y="numberedList";B.ui.componentFactory.add(Y,getDropdownViewCreator({editor:B,normalizedConfig:N,parentCommandName:Y,buttonLabel:G,buttonIcon:icons.numberedList,styleGridAriaLabel:Z,styleDefinitions:K})),W.includes("numbered")&&B.ui.componentFactory.add(`menuBar:${Y}`,getMenuBarStylesMenuCreator({editor:B,normalizedConfig:N,parentCommandName:Y,buttonLabel:G,styleGridAriaLabel:Z,styleDefinitions:K}))}}}function getDropdownViewCreator({editor:H,normalizedConfig:B,parentCommandName:t,buttonLabel:V,buttonIcon:N,styleGridAriaLabel:W,styleDefinitions:K}){const G=H.commands.get(t);return Z=>{const Y=createDropdown(Z,SplitButtonView),X=Y.buttonView;return Y.bind("isEnabled").to(G),Y.class="ck-list-styles-dropdown",X.on("execute",()=>{H.execute(t),H.editing.view.focus()}),X.set({label:V,icon:N,tooltip:!0,isToggleable:!0}),X.bind("isOn").to(G,"value",Q=>!!Q),Y.once("change:isOpen",()=>{const Q=createListPropertiesView({editor:H,normalizedConfig:B,dropdownView:Y,parentCommandName:t,styleGridAriaLabel:W,styleDefinitions:K});Y.panelView.children.add(Q)}),Y.on("execute",()=>{H.editing.view.focus()}),Y}}function getStyleButtonCreator({editor:H,listStyleCommand:B,parentCommandName:t}){const V=H.locale,N=H.commands.get(t);return({label:W,type:K,icon:G,tooltip:Z})=>{const Y=new ButtonView(V);return Y.set({label:W,icon:G,tooltip:Z}),B.on("change:value",()=>{Y.isOn=B.value===K}),Y.on("execute",()=>{N.value?B.value===K?H.execute(t):B.value!==K&&H.execute("listStyle",{type:K}):H.model.change(()=>{H.execute("listStyle",{type:K})})}),Y}}function createListPropertiesView({editor:H,normalizedConfig:B,dropdownView:t,parentCommandName:V,styleDefinitions:N,styleGridAriaLabel:W}){const K=H.locale,G={...B,...V!="numberedList"?{startIndex:!1,reversed:!1}:null},Z=V.replace("List","");let Y=null;if(B.styles.listTypes.includes(Z)){const Q=H.commands.get("listStyle"),te=getStyleButtonCreator({editor:H,parentCommandName:V,listStyleCommand:Q}),ie=getStyleTypeSupportChecker(Q);Y=N.filter(ie).map(te)}const X=new ListPropertiesView(K,{styleGridAriaLabel:W,enabledProperties:G,styleButtonViews:Y});if(B.styles.listTypes.includes(Z)&&focusChildOnDropdownOpen(t,()=>X.stylesView.children.find(Q=>Q.isOn)),G.startIndex){const Q=H.commands.get("listStart");X.startIndexFieldView.bind("isEnabled").to(Q),X.startIndexFieldView.fieldView.bind("value").to(Q),X.on("listStart",(te,ie)=>H.execute("listStart",ie))}if(G.reversed){const Q=H.commands.get("listReversed");X.reversedSwitchButtonView.bind("isEnabled").to(Q),X.reversedSwitchButtonView.bind("isOn").to(Q,"value",te=>!!te),X.on("listReversed",()=>{const te=Q.value;H.execute("listReversed",{reversed:!te})})}return X.delegate("execute").to(t),X}function getMenuBarStylesMenuCreator({editor:H,normalizedConfig:B,parentCommandName:t,buttonLabel:V,styleGridAriaLabel:N,styleDefinitions:W}){return K=>{const G=new MenuBarMenuView(K),Z=H.commands.get(t),Y=H.commands.get("listStyle"),X=getStyleTypeSupportChecker(Y),Q=getStyleButtonCreator({editor:H,parentCommandName:t,listStyleCommand:Y}),te=W.filter(X).map(Q),ie=new ListPropertiesView(K,{styleGridAriaLabel:N,enabledProperties:{...B,startIndex:!1,reversed:!1},styleButtonViews:te});return ie.delegate("execute").to(G),G.buttonView.set({label:V,icon:icons[t]}),G.panelView.children.add(ie),G.bind("isEnabled").to(Z,"isEnabled"),G.on("execute",()=>{H.editing.view.focus()}),G}}function getStyleTypeSupportChecker(H){return typeof H.isStyleTypeSupported=="function"?B=>H.isStyleTypeSupported(B.type):()=>!0}class ListProperties extends Plugin{static get requires(){return[ListPropertiesEditing,ListPropertiesUI]}static get pluginName(){return"ListProperties"}}function getDefaults(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let defaults=getDefaults();function changeDefaults(H){defaults=H}const escapeTest=/[&<>"']/,escapeReplace=/[&<>"']/g,escapeTestNoEncode=/[<>"']|&(?!#?\w+;)/,escapeReplaceNoEncode=/[<>"']|&(?!#?\w+;)/g,escapeReplacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},getEscapeReplacement=H=>escapeReplacements[H];function escape(H,B){if(B){if(escapeTest.test(H))return H.replace(escapeReplace,getEscapeReplacement)}else if(escapeTestNoEncode.test(H))return H.replace(escapeReplaceNoEncode,getEscapeReplacement);return H}const unescapeTest=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function unescape$1(H){return H.replace(unescapeTest,(B,t)=>(t=t.toLowerCase(),t==="colon"?":":t.charAt(0)==="#"?t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""))}const caret=/(^|[^\[])\^/g;function edit(H,B){H=H.source||H,B=B||"";const t={replace:(V,N)=>(N=N.source||N,N=N.replace(caret,"$1"),H=H.replace(V,N),t),getRegex:()=>new RegExp(H,B)};return t}const nonWordAndColonTest=/[^\w:]/g,originIndependentUrl=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function cleanUrl(H,B,t){if(H){let V;try{V=decodeURIComponent(unescape$1(t)).replace(nonWordAndColonTest,"").toLowerCase()}catch{return null}if(V.indexOf("javascript:")===0||V.indexOf("vbscript:")===0||V.indexOf("data:")===0)return null}B&&!originIndependentUrl.test(t)&&(t=resolveUrl(B,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch{return null}return t}const baseUrls={},justDomain=/^[^:]+:\/*[^/]*$/,protocol$2=/^([^:]+:)[\s\S]*$/,domain=/^([^:]+:\/*[^/]*)[\s\S]*$/;function resolveUrl(H,B){baseUrls[" "+H]||(justDomain.test(H)?baseUrls[" "+H]=H+"/":baseUrls[" "+H]=rtrim(H,"/",!0)),H=baseUrls[" "+H];const t=H.indexOf(":")===-1;return B.substring(0,2)==="//"?t?B:H.replace(protocol$2,"$1")+B:B.charAt(0)==="/"?t?B:H.replace(domain,"$1")+B:H+B}const noopTest={exec:function(){}};function merge(H){let B=1,t,V;for(;B<arguments.length;B++){t=arguments[B];for(V in t)Object.prototype.hasOwnProperty.call(t,V)&&(H[V]=t[V])}return H}function splitCells(H,B){const t=H.replace(/\|/g,(W,K,G)=>{let Z=!1,Y=K;for(;--Y>=0&&G[Y]==="\\";)Z=!Z;return Z?"|":" |"}),V=t.split(/ \|/);let N=0;if(V[0].trim()||V.shift(),V.length>0&&!V[V.length-1].trim()&&V.pop(),V.length>B)V.splice(B);else for(;V.length<B;)V.push("");for(;N<V.length;N++)V[N]=V[N].trim().replace(/\\\|/g,"|");return V}function rtrim(H,B,t){const V=H.length;if(V===0)return"";let N=0;for(;N<V;){const W=H.charAt(V-N-1);if(W===B&&!t)N++;else if(W!==B&&t)N++;else break}return H.substr(0,V-N)}function findClosingBracket(H,B){if(H.indexOf(B[1])===-1)return-1;const t=H.length;let V=0,N=0;for(;N<t;N++)if(H[N]==="\\")N++;else if(H[N]===B[0])V++;else if(H[N]===B[1]&&(V--,V<0))return N;return-1}function checkSanitizeDeprecation(H){H&&H.sanitize&&!H.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function repeatString(H,B){if(B<1)return"";let t="";for(;B>1;)B&1&&(t+=H),B>>=1,H+=H;return t+H}function outputLink(H,B,t,V){const N=B.href,W=B.title?escape(B.title):null,K=H[1].replace(/\\([\[\]])/g,"$1");if(H[0].charAt(0)!=="!"){V.state.inLink=!0;const G={type:"link",raw:t,href:N,title:W,text:K,tokens:V.inlineTokens(K,[])};return V.state.inLink=!1,G}else return{type:"image",raw:t,href:N,title:W,text:escape(K)}}function indentCodeCompensation(H,B){const t=H.match(/^(\s+)(?:```)/);if(t===null)return B;const V=t[1];return B.split(`
`).map(N=>{const W=N.match(/^\s+/);if(W===null)return N;const[K]=W;return K.length>=V.length?N.slice(V.length):N}).join(`
`)}class Tokenizer{constructor(B){this.options=B||defaults}space(B){const t=this.rules.block.newline.exec(B);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(B){const t=this.rules.block.code.exec(B);if(t){const V=t[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?V:rtrim(V,`
`)}}}fences(B){const t=this.rules.block.fences.exec(B);if(t){const V=t[0],N=indentCodeCompensation(V,t[3]||"");return{type:"code",raw:V,lang:t[2]?t[2].trim():t[2],text:N}}}heading(B){const t=this.rules.block.heading.exec(B);if(t){let V=t[2].trim();if(/#$/.test(V)){const W=rtrim(V,"#");(this.options.pedantic||!W||/ $/.test(W))&&(V=W.trim())}const N={type:"heading",raw:t[0],depth:t[1].length,text:V,tokens:[]};return this.lexer.inline(N.text,N.tokens),N}}hr(B){const t=this.rules.block.hr.exec(B);if(t)return{type:"hr",raw:t[0]}}blockquote(B){const t=this.rules.block.blockquote.exec(B);if(t){const V=t[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:t[0],tokens:this.lexer.blockTokens(V,[]),text:V}}}list(B){let t=this.rules.block.list.exec(B);if(t){let V,N,W,K,G,Z,Y,X,Q,te,ie,ne,le=t[1].trim();const ae=le.length>1,de={type:"list",raw:"",ordered:ae,start:ae?+le.slice(0,-1):"",loose:!1,items:[]};le=ae?`\\d{1,9}\\${le.slice(-1)}`:`\\${le}`,this.options.pedantic&&(le=ae?le:"[*+-]");const ce=new RegExp(`^( {0,3}${le})((?: [^\\n]*)?(?:\\n|$))`);for(;B&&(ne=!1,!(!(t=ce.exec(B))||this.rules.block.hr.test(B)));){if(V=t[0],B=B.substring(V.length),X=t[2].split(`
`,1)[0],Q=B.split(`
`,1)[0],this.options.pedantic?(K=2,ie=X.trimLeft()):(K=t[2].search(/[^ ]/),K=K>4?1:K,ie=X.slice(K),K+=t[1].length),Z=!1,!X&&/^ *$/.test(Q)&&(V+=Q+`
`,B=B.substring(Q.length+1),ne=!0),!ne){const be=new RegExp(`^ {0,${Math.min(3,K-1)}}(?:[*+-]|\\d{1,9}[.)])`);for(;B&&(te=B.split(`
`,1)[0],X=te,this.options.pedantic&&(X=X.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!be.test(X));){if(X.search(/[^ ]/)>=K||!X.trim())ie+=`
`+X.slice(K);else if(!Z)ie+=`
`+X;else break;!Z&&!X.trim()&&(Z=!0),V+=te+`
`,B=B.substring(te.length+1)}}de.loose||(Y?de.loose=!0:/\n *\n *$/.test(V)&&(Y=!0)),this.options.gfm&&(N=/^\[[ xX]\] /.exec(ie),N&&(W=N[0]!=="[ ] ",ie=ie.replace(/^\[[ xX]\] +/,""))),de.items.push({type:"list_item",raw:V,task:!!N,checked:W,loose:!1,text:ie}),de.raw+=V}de.items[de.items.length-1].raw=V.trimRight(),de.items[de.items.length-1].text=ie.trimRight(),de.raw=de.raw.trimRight();const we=de.items.length;for(G=0;G<we;G++){this.lexer.state.top=!1,de.items[G].tokens=this.lexer.blockTokens(de.items[G].text,[]);const be=de.items[G].tokens.filter(Ce=>Ce.type==="space"),ge=be.every(Ce=>{const he=Ce.raw.split("");let me=0;for(const pe of he)if(pe===`
`&&(me+=1),me>1)return!0;return!1});!de.loose&&be.length&&ge&&(de.loose=!0,de.items[G].loose=!0)}return de}}html(B){const t=this.rules.block.html.exec(B);if(t){const V={type:"html",raw:t[0],pre:!this.options.sanitizer&&(t[1]==="pre"||t[1]==="script"||t[1]==="style"),text:t[0]};return this.options.sanitize&&(V.type="paragraph",V.text=this.options.sanitizer?this.options.sanitizer(t[0]):escape(t[0]),V.tokens=[],this.lexer.inline(V.text,V.tokens)),V}}def(B){const t=this.rules.block.def.exec(B);if(t)return t[3]&&(t[3]=t[3].substring(1,t[3].length-1)),{type:"def",tag:t[1].toLowerCase().replace(/\s+/g," "),raw:t[0],href:t[2],title:t[3]}}table(B){const t=this.rules.block.table.exec(B);if(t){const V={type:"table",header:splitCells(t[1]).map(N=>({text:N})),align:t[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(V.header.length===V.align.length){V.raw=t[0];let N=V.align.length,W,K,G,Z;for(W=0;W<N;W++)/^ *-+: *$/.test(V.align[W])?V.align[W]="right":/^ *:-+: *$/.test(V.align[W])?V.align[W]="center":/^ *:-+ *$/.test(V.align[W])?V.align[W]="left":V.align[W]=null;for(N=V.rows.length,W=0;W<N;W++)V.rows[W]=splitCells(V.rows[W],V.header.length).map(Y=>({text:Y}));for(N=V.header.length,K=0;K<N;K++)V.header[K].tokens=[],this.lexer.inlineTokens(V.header[K].text,V.header[K].tokens);for(N=V.rows.length,K=0;K<N;K++)for(Z=V.rows[K],G=0;G<Z.length;G++)Z[G].tokens=[],this.lexer.inlineTokens(Z[G].text,Z[G].tokens);return V}}}lheading(B){const t=this.rules.block.lheading.exec(B);if(t){const V={type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:[]};return this.lexer.inline(V.text,V.tokens),V}}paragraph(B){const t=this.rules.block.paragraph.exec(B);if(t){const V={type:"paragraph",raw:t[0],text:t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1],tokens:[]};return this.lexer.inline(V.text,V.tokens),V}}text(B){const t=this.rules.block.text.exec(B);if(t){const V={type:"text",raw:t[0],text:t[0],tokens:[]};return this.lexer.inline(V.text,V.tokens),V}}escape(B){const t=this.rules.inline.escape.exec(B);if(t)return{type:"escape",raw:t[0],text:escape(t[1])}}tag(B){const t=this.rules.inline.tag.exec(B);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):escape(t[0]):t[0]}}link(B){const t=this.rules.inline.link.exec(B);if(t){const V=t[2].trim();if(!this.options.pedantic&&/^</.test(V)){if(!/>$/.test(V))return;const K=rtrim(V.slice(0,-1),"\\");if((V.length-K.length)%2===0)return}else{const K=findClosingBracket(t[2],"()");if(K>-1){const Z=(t[0].indexOf("!")===0?5:4)+t[1].length+K;t[2]=t[2].substring(0,K),t[0]=t[0].substring(0,Z).trim(),t[3]=""}}let N=t[2],W="";if(this.options.pedantic){const K=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(N);K&&(N=K[1],W=K[3])}else W=t[3]?t[3].slice(1,-1):"";return N=N.trim(),/^</.test(N)&&(this.options.pedantic&&!/>$/.test(V)?N=N.slice(1):N=N.slice(1,-1)),outputLink(t,{href:N&&N.replace(this.rules.inline._escapes,"$1"),title:W&&W.replace(this.rules.inline._escapes,"$1")},t[0],this.lexer)}}reflink(B,t){let V;if((V=this.rules.inline.reflink.exec(B))||(V=this.rules.inline.nolink.exec(B))){let N=(V[2]||V[1]).replace(/\s+/g," ");if(N=t[N.toLowerCase()],!N||!N.href){const W=V[0].charAt(0);return{type:"text",raw:W,text:W}}return outputLink(V,N,V[0],this.lexer)}}emStrong(B,t,V=""){let N=this.rules.inline.emStrong.lDelim.exec(B);if(!N||N[3]&&V.match(/[\p{L}\p{N}]/u))return;const W=N[1]||N[2]||"";if(!W||W&&(V===""||this.rules.inline.punctuation.exec(V))){const K=N[0].length-1;let G,Z,Y=K,X=0;const Q=N[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(Q.lastIndex=0,t=t.slice(-1*B.length+K);(N=Q.exec(t))!=null;){if(G=N[1]||N[2]||N[3]||N[4]||N[5]||N[6],!G)continue;if(Z=G.length,N[3]||N[4]){Y+=Z;continue}else if((N[5]||N[6])&&K%3&&!((K+Z)%3)){X+=Z;continue}if(Y-=Z,Y>0)continue;if(Z=Math.min(Z,Z+Y+X),Math.min(K,Z)%2){const ie=B.slice(1,K+N.index+Z);return{type:"em",raw:B.slice(0,K+N.index+Z+1),text:ie,tokens:this.lexer.inlineTokens(ie,[])}}const te=B.slice(2,K+N.index+Z-1);return{type:"strong",raw:B.slice(0,K+N.index+Z+1),text:te,tokens:this.lexer.inlineTokens(te,[])}}}}codespan(B){const t=this.rules.inline.code.exec(B);if(t){let V=t[2].replace(/\n/g," ");const N=/[^ ]/.test(V),W=/^ /.test(V)&&/ $/.test(V);return N&&W&&(V=V.substring(1,V.length-1)),V=escape(V,!0),{type:"codespan",raw:t[0],text:V}}}br(B){const t=this.rules.inline.br.exec(B);if(t)return{type:"br",raw:t[0]}}del(B){const t=this.rules.inline.del.exec(B);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2],[])}}autolink(B,t){const V=this.rules.inline.autolink.exec(B);if(V){let N,W;return V[2]==="@"?(N=escape(this.options.mangle?t(V[1]):V[1]),W="mailto:"+N):(N=escape(V[1]),W=N),{type:"link",raw:V[0],text:N,href:W,tokens:[{type:"text",raw:N,text:N}]}}}url(B,t){let V;if(V=this.rules.inline.url.exec(B)){let N,W;if(V[2]==="@")N=escape(this.options.mangle?t(V[0]):V[0]),W="mailto:"+N;else{let K;do K=V[0],V[0]=this.rules.inline._backpedal.exec(V[0])[0];while(K!==V[0]);N=escape(V[0]),V[1]==="www."?W="http://"+N:W=N}return{type:"link",raw:V[0],text:N,href:W,tokens:[{type:"text",raw:N,text:N}]}}}inlineText(B,t){const V=this.rules.inline.text.exec(B);if(V){let N;return this.lexer.state.inRawBlock?N=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(V[0]):escape(V[0]):V[0]:N=escape(this.options.smartypants?t(V[0]):V[0]),{type:"text",raw:V[0],text:N}}}}const block={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)( [^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:noopTest,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};block._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;block._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;block.def=edit(block.def).replace("label",block._label).replace("title",block._title).getRegex();block.bullet=/(?:[*+-]|\d{1,9}[.)])/;block.listItemStart=edit(/^( *)(bull) */).replace("bull",block.bullet).getRegex();block.list=edit(block.list).replace(/bull/g,block.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+block.def.source+")").getRegex();block._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";block._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;block.html=edit(block.html,"i").replace("comment",block._comment).replace("tag",block._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();block.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.blockquote=edit(block.blockquote).replace("paragraph",block.paragraph).getRegex();block.normal=merge({},block);block.gfm=merge({},block.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});block.gfm.table=edit(block.gfm.table).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.gfm.paragraph=edit(block._paragraph).replace("hr",block.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",block.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",block._tag).getRegex();block.pedantic=merge({},block.normal,{html:edit(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",block._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:noopTest,paragraph:edit(block.normal._paragraph).replace("hr",block.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",block.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const inline={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:noopTest,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:noopTest,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};inline._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";inline.punctuation=edit(inline.punctuation).replace(/punctuation/g,inline._punctuation).getRegex();inline.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;inline.escapedEmSt=/\\\*|\\_/g;inline._comment=edit(block._comment).replace("(?:-->|$)","-->").getRegex();inline.emStrong.lDelim=edit(inline.emStrong.lDelim).replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimAst=edit(inline.emStrong.rDelimAst,"g").replace(/punct/g,inline._punctuation).getRegex();inline.emStrong.rDelimUnd=edit(inline.emStrong.rDelimUnd,"g").replace(/punct/g,inline._punctuation).getRegex();inline._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;inline._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;inline._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;inline.autolink=edit(inline.autolink).replace("scheme",inline._scheme).replace("email",inline._email).getRegex();inline._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;inline.tag=edit(inline.tag).replace("comment",inline._comment).replace("attribute",inline._attribute).getRegex();inline._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;inline._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;inline._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;inline.link=edit(inline.link).replace("label",inline._label).replace("href",inline._href).replace("title",inline._title).getRegex();inline.reflink=edit(inline.reflink).replace("label",inline._label).replace("ref",block._label).getRegex();inline.nolink=edit(inline.nolink).replace("ref",block._label).getRegex();inline.reflinkSearch=edit(inline.reflinkSearch,"g").replace("reflink",inline.reflink).replace("nolink",inline.nolink).getRegex();inline.normal=merge({},inline);inline.pedantic=merge({},inline.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:edit(/^!?\[(label)\]\((.*?)\)/).replace("label",inline._label).getRegex(),reflink:edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",inline._label).getRegex()});inline.gfm=merge({},inline.normal,{escape:edit(inline.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});inline.gfm.url=edit(inline.gfm.url,"i").replace("email",inline.gfm._extended_email).getRegex();inline.breaks=merge({},inline.gfm,{br:edit(inline.br).replace("{2,}","*").getRegex(),text:edit(inline.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function smartypants(H){return H.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function mangle(H){let B="",t,V;const N=H.length;for(t=0;t<N;t++)V=H.charCodeAt(t),Math.random()>.5&&(V="x"+V.toString(16)),B+="&#"+V+";";return B}class Lexer{constructor(B){this.tokens=[],this.tokens.links=Object.create(null),this.options=B||defaults,this.options.tokenizer=this.options.tokenizer||new Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:block.normal,inline:inline.normal};this.options.pedantic?(t.block=block.pedantic,t.inline=inline.pedantic):this.options.gfm&&(t.block=block.gfm,this.options.breaks?t.inline=inline.breaks:t.inline=inline.gfm),this.tokenizer.rules=t}static get rules(){return{block,inline}}static lex(B,t){return new Lexer(t).lex(B)}static lexInline(B,t){return new Lexer(t).inlineTokens(B)}lex(B){B=B.replace(/\r\n|\r/g,`
`).replace(/\t/g,"    "),this.blockTokens(B,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(B,t=[]){this.options.pedantic&&(B=B.replace(/^ +$/gm,""));let V,N,W,K;for(;B;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(G=>(V=G.call({lexer:this},B,t))?(B=B.substring(V.raw.length),t.push(V),!0):!1))){if(V=this.tokenizer.space(B)){B=B.substring(V.raw.length),V.raw.length===1&&t.length>0?t[t.length-1].raw+=`
`:t.push(V);continue}if(V=this.tokenizer.code(B)){B=B.substring(V.raw.length),N=t[t.length-1],N&&(N.type==="paragraph"||N.type==="text")?(N.raw+=`
`+V.raw,N.text+=`
`+V.text,this.inlineQueue[this.inlineQueue.length-1].src=N.text):t.push(V);continue}if(V=this.tokenizer.fences(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.heading(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.hr(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.blockquote(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.list(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.html(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.def(B)){B=B.substring(V.raw.length),N=t[t.length-1],N&&(N.type==="paragraph"||N.type==="text")?(N.raw+=`
`+V.raw,N.text+=`
`+V.raw,this.inlineQueue[this.inlineQueue.length-1].src=N.text):this.tokens.links[V.tag]||(this.tokens.links[V.tag]={href:V.href,title:V.title});continue}if(V=this.tokenizer.table(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.lheading(B)){B=B.substring(V.raw.length),t.push(V);continue}if(W=B,this.options.extensions&&this.options.extensions.startBlock){let G=1/0;const Z=B.slice(1);let Y;this.options.extensions.startBlock.forEach(function(X){Y=X.call({lexer:this},Z),typeof Y=="number"&&Y>=0&&(G=Math.min(G,Y))}),G<1/0&&G>=0&&(W=B.substring(0,G+1))}if(this.state.top&&(V=this.tokenizer.paragraph(W))){N=t[t.length-1],K&&N.type==="paragraph"?(N.raw+=`
`+V.raw,N.text+=`
`+V.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=N.text):t.push(V),K=W.length!==B.length,B=B.substring(V.raw.length);continue}if(V=this.tokenizer.text(B)){B=B.substring(V.raw.length),N=t[t.length-1],N&&N.type==="text"?(N.raw+=`
`+V.raw,N.text+=`
`+V.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=N.text):t.push(V);continue}if(B){const G="Infinite loop on byte: "+B.charCodeAt(0);if(this.options.silent){console.error(G);break}else throw new Error(G)}}return this.state.top=!0,t}inline(B,t){this.inlineQueue.push({src:B,tokens:t})}inlineTokens(B,t=[]){let V,N,W,K=B,G,Z,Y;if(this.tokens.links){const X=Object.keys(this.tokens.links);if(X.length>0)for(;(G=this.tokenizer.rules.inline.reflinkSearch.exec(K))!=null;)X.includes(G[0].slice(G[0].lastIndexOf("[")+1,-1))&&(K=K.slice(0,G.index)+"["+repeatString("a",G[0].length-2)+"]"+K.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(G=this.tokenizer.rules.inline.blockSkip.exec(K))!=null;)K=K.slice(0,G.index)+"["+repeatString("a",G[0].length-2)+"]"+K.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(G=this.tokenizer.rules.inline.escapedEmSt.exec(K))!=null;)K=K.slice(0,G.index)+"++"+K.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;B;)if(Z||(Y=""),Z=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(X=>(V=X.call({lexer:this},B,t))?(B=B.substring(V.raw.length),t.push(V),!0):!1))){if(V=this.tokenizer.escape(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.tag(B)){B=B.substring(V.raw.length),N=t[t.length-1],N&&V.type==="text"&&N.type==="text"?(N.raw+=V.raw,N.text+=V.text):t.push(V);continue}if(V=this.tokenizer.link(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.reflink(B,this.tokens.links)){B=B.substring(V.raw.length),N=t[t.length-1],N&&V.type==="text"&&N.type==="text"?(N.raw+=V.raw,N.text+=V.text):t.push(V);continue}if(V=this.tokenizer.emStrong(B,K,Y)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.codespan(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.br(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.del(B)){B=B.substring(V.raw.length),t.push(V);continue}if(V=this.tokenizer.autolink(B,mangle)){B=B.substring(V.raw.length),t.push(V);continue}if(!this.state.inLink&&(V=this.tokenizer.url(B,mangle))){B=B.substring(V.raw.length),t.push(V);continue}if(W=B,this.options.extensions&&this.options.extensions.startInline){let X=1/0;const Q=B.slice(1);let te;this.options.extensions.startInline.forEach(function(ie){te=ie.call({lexer:this},Q),typeof te=="number"&&te>=0&&(X=Math.min(X,te))}),X<1/0&&X>=0&&(W=B.substring(0,X+1))}if(V=this.tokenizer.inlineText(W,smartypants)){B=B.substring(V.raw.length),V.raw.slice(-1)!=="_"&&(Y=V.raw.slice(-1)),Z=!0,N=t[t.length-1],N&&N.type==="text"?(N.raw+=V.raw,N.text+=V.text):t.push(V);continue}if(B){const X="Infinite loop on byte: "+B.charCodeAt(0);if(this.options.silent){console.error(X);break}else throw new Error(X)}}return t}}class Renderer{constructor(B){this.options=B||defaults}code(B,t,V){const N=(t||"").match(/\S*/)[0];if(this.options.highlight){const W=this.options.highlight(B,N);W!=null&&W!==B&&(V=!0,B=W)}return B=B.replace(/\n$/,"")+`
`,N?'<pre><code class="'+this.options.langPrefix+escape(N,!0)+'">'+(V?B:escape(B,!0))+`</code></pre>
`:"<pre><code>"+(V?B:escape(B,!0))+`</code></pre>
`}blockquote(B){return`<blockquote>
`+B+`</blockquote>
`}html(B){return B}heading(B,t,V,N){return this.options.headerIds?"<h"+t+' id="'+this.options.headerPrefix+N.slug(V)+'">'+B+"</h"+t+`>
`:"<h"+t+">"+B+"</h"+t+`>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(B,t,V){const N=t?"ol":"ul",W=t&&V!==1?' start="'+V+'"':"";return"<"+N+W+`>
`+B+"</"+N+`>
`}listitem(B){return"<li>"+B+`</li>
`}checkbox(B){return"<input "+(B?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(B){return"<p>"+B+`</p>
`}table(B,t){return t&&(t="<tbody>"+t+"</tbody>"),`<table>
<thead>
`+B+`</thead>
`+t+`</table>
`}tablerow(B){return`<tr>
`+B+`</tr>
`}tablecell(B,t){const V=t.header?"th":"td";return(t.align?"<"+V+' align="'+t.align+'">':"<"+V+">")+B+"</"+V+`>
`}strong(B){return"<strong>"+B+"</strong>"}em(B){return"<em>"+B+"</em>"}codespan(B){return"<code>"+B+"</code>"}br(){return this.options.xhtml?"<br/>":"<br>"}del(B){return"<del>"+B+"</del>"}link(B,t,V){if(B=cleanUrl(this.options.sanitize,this.options.baseUrl,B),B===null)return V;let N='<a href="'+escape(B)+'"';return t&&(N+=' title="'+t+'"'),N+=">"+V+"</a>",N}image(B,t,V){if(B=cleanUrl(this.options.sanitize,this.options.baseUrl,B),B===null)return V;let N='<img src="'+B+'" alt="'+V+'"';return t&&(N+=' title="'+t+'"'),N+=this.options.xhtml?"/>":">",N}text(B){return B}}class TextRenderer{strong(B){return B}em(B){return B}codespan(B){return B}del(B){return B}html(B){return B}text(B){return B}link(B,t,V){return""+V}image(B,t,V){return""+V}br(){return""}}class Slugger{constructor(){this.seen={}}serialize(B){return B.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(B,t){let V=B,N=0;if(this.seen.hasOwnProperty(V)){N=this.seen[B];do N++,V=B+"-"+N;while(this.seen.hasOwnProperty(V))}return t||(this.seen[B]=N,this.seen[V]=0),V}slug(B,t={}){const V=this.serialize(B);return this.getNextSafeSlug(V,t.dryrun)}}class Parser{constructor(B){this.options=B||defaults,this.options.renderer=this.options.renderer||new Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new TextRenderer,this.slugger=new Slugger}static parse(B,t){return new Parser(t).parse(B)}static parseInline(B,t){return new Parser(t).parseInline(B)}parse(B,t=!0){let V="",N,W,K,G,Z,Y,X,Q,te,ie,ne,le,ae,de,ce,we,be,ge,Ce;const he=B.length;for(N=0;N<he;N++){if(ie=B[N],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[ie.type]&&(Ce=this.options.extensions.renderers[ie.type].call({parser:this},ie),Ce!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(ie.type))){V+=Ce||"";continue}switch(ie.type){case"space":continue;case"hr":{V+=this.renderer.hr();continue}case"heading":{V+=this.renderer.heading(this.parseInline(ie.tokens),ie.depth,unescape$1(this.parseInline(ie.tokens,this.textRenderer)),this.slugger);continue}case"code":{V+=this.renderer.code(ie.text,ie.lang,ie.escaped);continue}case"table":{for(Q="",X="",G=ie.header.length,W=0;W<G;W++)X+=this.renderer.tablecell(this.parseInline(ie.header[W].tokens),{header:!0,align:ie.align[W]});for(Q+=this.renderer.tablerow(X),te="",G=ie.rows.length,W=0;W<G;W++){for(Y=ie.rows[W],X="",Z=Y.length,K=0;K<Z;K++)X+=this.renderer.tablecell(this.parseInline(Y[K].tokens),{header:!1,align:ie.align[K]});te+=this.renderer.tablerow(X)}V+=this.renderer.table(Q,te);continue}case"blockquote":{te=this.parse(ie.tokens),V+=this.renderer.blockquote(te);continue}case"list":{for(ne=ie.ordered,le=ie.start,ae=ie.loose,G=ie.items.length,te="",W=0;W<G;W++)ce=ie.items[W],we=ce.checked,be=ce.task,de="",ce.task&&(ge=this.renderer.checkbox(we),ae?ce.tokens.length>0&&ce.tokens[0].type==="paragraph"?(ce.tokens[0].text=ge+" "+ce.tokens[0].text,ce.tokens[0].tokens&&ce.tokens[0].tokens.length>0&&ce.tokens[0].tokens[0].type==="text"&&(ce.tokens[0].tokens[0].text=ge+" "+ce.tokens[0].tokens[0].text)):ce.tokens.unshift({type:"text",text:ge}):de+=ge),de+=this.parse(ce.tokens,ae),te+=this.renderer.listitem(de,be,we);V+=this.renderer.list(te,ne,le);continue}case"html":{V+=this.renderer.html(ie.text);continue}case"paragraph":{V+=this.renderer.paragraph(this.parseInline(ie.tokens));continue}case"text":{for(te=ie.tokens?this.parseInline(ie.tokens):ie.text;N+1<he&&B[N+1].type==="text";)ie=B[++N],te+=`
`+(ie.tokens?this.parseInline(ie.tokens):ie.text);V+=t?this.renderer.paragraph(te):te;continue}default:{const me='Token with "'+ie.type+'" type was not found.';if(this.options.silent){console.error(me);return}else throw new Error(me)}}}return V}parseInline(B,t){t=t||this.renderer;let V="",N,W,K;const G=B.length;for(N=0;N<G;N++){if(W=B[N],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[W.type]&&(K=this.options.extensions.renderers[W.type].call({parser:this},W),K!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(W.type))){V+=K||"";continue}switch(W.type){case"escape":{V+=t.text(W.text);break}case"html":{V+=t.html(W.text);break}case"link":{V+=t.link(W.href,W.title,this.parseInline(W.tokens,t));break}case"image":{V+=t.image(W.href,W.title,W.text);break}case"strong":{V+=t.strong(this.parseInline(W.tokens,t));break}case"em":{V+=t.em(this.parseInline(W.tokens,t));break}case"codespan":{V+=t.codespan(W.text);break}case"br":{V+=t.br();break}case"del":{V+=t.del(this.parseInline(W.tokens,t));break}case"text":{V+=t.text(W.text);break}default:{const Z='Token with "'+W.type+'" type was not found.';if(this.options.silent){console.error(Z);return}else throw new Error(Z)}}}return V}}function marked(H,B,t){if(typeof H>"u"||H===null)throw new Error("marked(): input parameter is undefined or null");if(typeof H!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(H)+", string expected");if(typeof B=="function"&&(t=B,B=null),B=merge({},marked.defaults,B||{}),checkSanitizeDeprecation(B),t){const V=B.highlight;let N;try{N=Lexer.lex(H,B)}catch(G){return t(G)}const W=function(G){let Z;if(!G)try{B.walkTokens&&marked.walkTokens(N,B.walkTokens),Z=Parser.parse(N,B)}catch(Y){G=Y}return B.highlight=V,G?t(G):t(null,Z)};if(!V||V.length<3||(delete B.highlight,!N.length))return W();let K=0;marked.walkTokens(N,function(G){G.type==="code"&&(K++,setTimeout(()=>{V(G.text,G.lang,function(Z,Y){if(Z)return W(Z);Y!=null&&Y!==G.text&&(G.text=Y,G.escaped=!0),K--,K===0&&W()})},0))}),K===0&&W();return}try{const V=Lexer.lex(H,B);return B.walkTokens&&marked.walkTokens(V,B.walkTokens),Parser.parse(V,B)}catch(V){if(V.message+=`
Please report this to https://github.com/markedjs/marked.`,B.silent)return"<p>An error occurred:</p><pre>"+escape(V.message+"",!0)+"</pre>";throw V}}marked.options=marked.setOptions=function(H){return merge(marked.defaults,H),changeDefaults(marked.defaults),marked};marked.getDefaults=getDefaults;marked.defaults=defaults;marked.use=function(...H){const B=merge({},...H),t=marked.defaults.extensions||{renderers:{},childTokens:{}};let V;H.forEach(N=>{if(N.extensions&&(V=!0,N.extensions.forEach(W=>{if(!W.name)throw new Error("extension name required");if(W.renderer){const K=t.renderers?t.renderers[W.name]:null;K?t.renderers[W.name]=function(...G){let Z=W.renderer.apply(this,G);return Z===!1&&(Z=K.apply(this,G)),Z}:t.renderers[W.name]=W.renderer}if(W.tokenizer){if(!W.level||W.level!=="block"&&W.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");t[W.level]?t[W.level].unshift(W.tokenizer):t[W.level]=[W.tokenizer],W.start&&(W.level==="block"?t.startBlock?t.startBlock.push(W.start):t.startBlock=[W.start]:W.level==="inline"&&(t.startInline?t.startInline.push(W.start):t.startInline=[W.start]))}W.childTokens&&(t.childTokens[W.name]=W.childTokens)})),N.renderer){const W=marked.defaults.renderer||new Renderer;for(const K in N.renderer){const G=W[K];W[K]=(...Z)=>{let Y=N.renderer[K].apply(W,Z);return Y===!1&&(Y=G.apply(W,Z)),Y}}B.renderer=W}if(N.tokenizer){const W=marked.defaults.tokenizer||new Tokenizer;for(const K in N.tokenizer){const G=W[K];W[K]=(...Z)=>{let Y=N.tokenizer[K].apply(W,Z);return Y===!1&&(Y=G.apply(W,Z)),Y}}B.tokenizer=W}if(N.walkTokens){const W=marked.defaults.walkTokens;B.walkTokens=function(K){N.walkTokens.call(this,K),W&&W.call(this,K)}}V&&(B.extensions=t),marked.setOptions(B)})};marked.walkTokens=function(H,B){for(const t of H)switch(B.call(marked,t),t.type){case"table":{for(const V of t.header)marked.walkTokens(V.tokens,B);for(const V of t.rows)for(const N of V)marked.walkTokens(N.tokens,B);break}case"list":{marked.walkTokens(t.items,B);break}default:marked.defaults.extensions&&marked.defaults.extensions.childTokens&&marked.defaults.extensions.childTokens[t.type]?marked.defaults.extensions.childTokens[t.type].forEach(function(V){marked.walkTokens(t[V],B)}):t.tokens&&marked.walkTokens(t.tokens,B)}};marked.parseInline=function(H,B){if(typeof H>"u"||H===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof H!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(H)+", string expected");B=merge({},marked.defaults,B||{}),checkSanitizeDeprecation(B);try{const t=Lexer.lexInline(H,B);return B.walkTokens&&marked.walkTokens(t,B.walkTokens),Parser.parseInline(t,B)}catch(t){if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,B.silent)return"<p>An error occurred:</p><pre>"+escape(t.message+"",!0)+"</pre>";throw t}};marked.Parser=Parser;marked.parser=Parser.parse;marked.Renderer=Renderer;marked.TextRenderer=TextRenderer;marked.Lexer=Lexer;marked.lexer=Lexer.lex;marked.Tokenizer=Tokenizer;marked.Slugger=Slugger;marked.parse=marked;marked.options;marked.setOptions;marked.use;marked.walkTokens;marked.parseInline;Parser.parse;Lexer.lex;var root=typeof window<"u"?window:{};function canParseHTMLNatively(){var H=root.DOMParser,B=!1;try{new H().parseFromString("","text/html")&&(B=!0)}catch{}return B}function createHTMLParser(){var H=function(){};return shouldUseActiveX()?H.prototype.parseFromString=function(B){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(B),t.close(),t}:H.prototype.parseFromString=function(B){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(B),t.close(),t},H}function shouldUseActiveX(){var H=!1;try{document.implementation.createHTMLDocument("").open()}catch{root.ActiveXObject&&(H=!0)}return H}canParseHTMLNatively()?root.DOMParser:createHTMLParser();/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const BRACKET_PAIRS={"(":")","[":"]","{":"}"};class MentionCommand extends Command{constructor(B){super(B),this._isEnabledBasedOnSelection=!1}refresh(){const B=this.editor.model,t=B.document;this.isEnabled=B.schema.checkAttributeInSelection(t.selection,"mention")}execute(B){const t=this.editor.model,N=t.document.selection,W=typeof B.mention=="string"?{id:B.mention}:B.mention,K=W.id,G=B.range||N.getFirstRange();if(!t.canEditAt(G))return;const Z=B.text||K,Y=_addMentionAttributes({_text:Z,id:K},W);if(B.marker.length!=1)throw new CKEditorError("mentioncommand-incorrect-marker",this);if(K.charAt(0)!=B.marker)throw new CKEditorError("mentioncommand-incorrect-id",this);t.change(X=>{const Q=toMap(N.getAttributes()),te=new Map(Q.entries());te.set("mention",Y);const ie=t.insertContent(X.createText(Z,te),G),ne=ie.start.nodeBefore,le=ie.end.nodeAfter,ae=le&&le.is("$text")&&le.data.startsWith(" ");let de=!1;if(ne&&le&&ne.is("$text")&&le.is("$text")){const ce=ne.data.slice(-1),we=ce in BRACKET_PAIRS,be=we&&le.data.startsWith(BRACKET_PAIRS[ce]);de=we&&be}!de&&!ae&&t.insertContent(X.createText(" ",Q),G.start.getShiftedBy(Z.length))})}}class MentionEditing extends Plugin{static get pluginName(){return"MentionEditing"}init(){const B=this.editor,t=B.model,V=t.document;t.schema.extend("$text",{allowAttributes:"mention"}),B.conversion.for("upcast").elementToAttribute({view:{name:"span",key:"data-mention",classes:"mention"},model:{key:"mention",value:N=>_toMentionAttribute(N)}}),B.conversion.for("downcast").attributeToElement({model:"mention",view:createViewMentionElement}),B.conversion.for("downcast").add(preventPartialMentionDowncast),V.registerPostFixer(N=>removePartialMentionPostFixer(N,V,t.schema)),V.registerPostFixer(N=>extendAttributeOnMentionPostFixer(N,V)),V.registerPostFixer(N=>selectionMentionAttributePostFixer(N,V)),B.commands.add("mention",new MentionCommand(B))}}function _addMentionAttributes(H,B){return Object.assign({uid:uid()},H,B||{})}function _toMentionAttribute(H,B){const t=H.getAttribute("data-mention"),V=H.getChild(0);if(!V)return;const N={id:t,_text:V.data};return _addMentionAttributes(N,B)}function preventPartialMentionDowncast(H){H.on("attribute:mention",(B,t,V)=>{const N=t.attributeNewValue;if(!t.item.is("$textProxy")||!N)return;const W=t.range.start;(W.textNode||W.nodeAfter).data!=N._text&&V.consumable.consume(t.item,B.name)},{priority:"highest"})}function createViewMentionElement(H,{writer:B}){if(!H)return;const t={class:"mention","data-mention":H.id},V={id:H.uid,priority:20};return B.createAttributeElement("span",t,V)}function selectionMentionAttributePostFixer(H,B){const t=B.selection,V=t.focus;return t.isCollapsed&&t.hasAttribute("mention")&&shouldNotTypeWithMentionAt(V)?(H.removeSelectionAttribute("mention"),!0):!1}function shouldNotTypeWithMentionAt(H){const B=H.isAtStart;return H.nodeBefore&&H.nodeBefore.is("$text")||B}function removePartialMentionPostFixer(H,B,t){const V=B.differ.getChanges();let N=!1;for(const W of V){if(W.type=="attribute")continue;const K=W.position;if(W.name=="$text"){const G=K.textNode&&K.textNode.nextSibling;N=checkAndFix(K.textNode,H)||N,N=checkAndFix(G,H)||N,N=checkAndFix(K.nodeBefore,H)||N,N=checkAndFix(K.nodeAfter,H)||N}if(W.name!="$text"&&W.type=="insert"){const G=K.nodeAfter;for(const Z of H.createRangeIn(G).getItems())N=checkAndFix(Z,H)||N}if(W.type=="insert"&&t.isInline(W.name)){const G=K.nodeAfter&&K.nodeAfter.nextSibling;N=checkAndFix(K.nodeBefore,H)||N,N=checkAndFix(G,H)||N}}return N}function extendAttributeOnMentionPostFixer(H,B){const t=B.differ.getChanges();let V=!1;for(const N of t)if(N.type==="attribute"&&N.attributeKey!="mention"){const W=N.range.start.nodeBefore,K=N.range.end.nodeAfter;for(const G of[W,K])isBrokenMentionNode(G)&&G.getAttribute(N.attributeKey)!=N.attributeNewValue&&(H.setAttribute(N.attributeKey,N.attributeNewValue,G),V=!0)}return V}function isBrokenMentionNode(H){if(!H||!(H.is("$text")||H.is("$textProxy"))||!H.hasAttribute("mention"))return!1;const B=H.data,V=H.getAttribute("mention")._text;return B!=V}function checkAndFix(H,B){return isBrokenMentionNode(H)?(B.removeAttribute("mention",H),!0):!1}class MentionsView extends ListView{constructor(t){super(t);ee(this,"selected");ee(this,"position");this.extendTemplate({attributes:{class:["ck-mentions"],tabindex:"-1"}})}selectFirst(){this.select(0)}selectNext(){const t=this.selected,V=this.items.getIndex(t);this.select(V+1)}selectPrevious(){const t=this.selected,V=this.items.getIndex(t);this.select(V-1)}select(t){let V=0;t>0&&t<this.items.length?V=t:t<0&&(V=this.items.length-1);const N=this.items.get(V);this.selected!==N&&(this.selected&&this.selected.removeHighlight(),N.highlight(),this.selected=N,this._isItemVisibleInScrolledArea(N)||(this.element.scrollTop=N.element.offsetTop))}executeSelected(){this.selected.fire("execute")}_isItemVisibleInScrolledArea(t){return new Rect(this.element).contains(new Rect(t.element))}}class DomWrapperView extends View{constructor(t,V){super(t);ee(this,"domElement");this.template=void 0,this.domElement=V,this.domElement.classList.add("ck-button"),this.set("isOn",!1),this.on("change:isOn",(N,W,K)=>{K?(this.domElement.classList.add("ck-on"),this.domElement.classList.remove("ck-off")):(this.domElement.classList.add("ck-off"),this.domElement.classList.remove("ck-on"))}),this.listenTo(this.domElement,"click",()=>{this.fire("execute")})}render(){super.render(),this.element=this.domElement}focus(){this.domElement.focus()}}class MentionListItemView extends ListItemView{constructor(){super(...arguments);ee(this,"item");ee(this,"marker")}highlight(){const t=this.children.first;t.isOn=!0}removeHighlight(){const t=this.children.first;t.isOn=!1}}const VERTICAL_SPACING=3,defaultHandledKeyCodes=[keyCodes.arrowup,keyCodes.arrowdown,keyCodes.esc],defaultCommitKeyCodes=[keyCodes.enter,keyCodes.tab];class MentionUI extends Plugin{constructor(t){super(t);ee(this,"_mentionsView");ee(this,"_mentionsConfigurations");ee(this,"_balloon");ee(this,"_items",new Collection);ee(this,"_lastRequested");ee(this,"_requestFeedDebounced");this._mentionsView=this._createMentionView(),this._mentionsConfigurations=new Map,this._requestFeedDebounced=debounce(this._requestFeed,100),t.config.define("mention",{feeds:[]})}static get pluginName(){return"MentionUI"}static get requires(){return[ContextualBalloon]}init(){const t=this.editor,V=t.config.get("mention.commitKeys")||defaultCommitKeyCodes,N=defaultHandledKeyCodes.concat(V);this._balloon=t.plugins.get(ContextualBalloon),t.editing.view.document.on("keydown",(G,Z)=>{K(Z.keyCode)&&this._isUIVisible&&(Z.preventDefault(),G.stop(),Z.keyCode==keyCodes.arrowdown&&this._mentionsView.selectNext(),Z.keyCode==keyCodes.arrowup&&this._mentionsView.selectPrevious(),V.includes(Z.keyCode)&&this._mentionsView.executeSelected(),Z.keyCode==keyCodes.esc&&this._hideUIAndRemoveMarker())},{priority:"highest"}),clickOutsideHandler({emitter:this._mentionsView,activator:()=>this._isUIVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUIAndRemoveMarker()});const W=t.config.get("mention.feeds");for(const G of W){const{feed:Z,marker:Y,dropdownLimit:X}=G;if(!isValidMentionMarker(Y))throw new CKEditorError("mentionconfig-incorrect-marker",null,{marker:Y});const Q=typeof Z=="function"?Z.bind(this.editor):createFeedCallback(Z),te=G.itemRenderer,ie={marker:Y,feedCallback:Q,itemRenderer:te,dropdownLimit:X};this._mentionsConfigurations.set(Y,ie)}this._setupTextWatcher(W),this.listenTo(t,"change:isReadOnly",()=>{this._hideUIAndRemoveMarker()}),this.on("requestFeed:response",(G,Z)=>this._handleFeedResponse(Z)),this.on("requestFeed:error",()=>this._hideUIAndRemoveMarker());function K(G){return N.includes(G)}}destroy(){super.destroy(),this._mentionsView.destroy()}get _isUIVisible(){return this._balloon.visibleView===this._mentionsView}_createMentionView(){const t=this.editor.locale,V=new MentionsView(t);return V.items.bindTo(this._items).using(N=>{const{item:W,marker:K}=N,{dropdownLimit:G}=this._mentionsConfigurations.get(K),Z=G||this.editor.config.get("mention.dropdownLimit")||10;if(V.items.length>=Z)return null;const Y=new MentionListItemView(t),X=this._renderItem(W,K);return X.delegate("execute").to(Y),Y.children.add(X),Y.item=W,Y.marker=K,Y.on("execute",()=>{V.fire("execute",{item:W,marker:K})}),Y}),V.on("execute",(N,W)=>{const K=this.editor,G=K.model,Z=W.item,Y=W.marker,X=K.model.markers.get("mention"),Q=G.createPositionAt(G.document.selection.focus),te=G.createPositionAt(X.getStart()),ie=G.createRange(te,Q);this._hideUIAndRemoveMarker(),K.execute("mention",{mention:Z,text:Z.text,marker:Y,range:ie}),K.editing.view.focus()}),V}_getItemRenderer(t){const{itemRenderer:V}=this._mentionsConfigurations.get(t);return V}_requestFeed(t,V){this._lastRequested=V;const{feedCallback:N}=this._mentionsConfigurations.get(t),W=N(V);if(!(W instanceof Promise)){this.fire("requestFeed:response",{feed:W,marker:t,feedText:V});return}W.then(G=>{this._lastRequested==V?this.fire("requestFeed:response",{feed:G,marker:t,feedText:V}):this.fire("requestFeed:discarded",{feed:G,marker:t,feedText:V})}).catch(G=>{this.fire("requestFeed:error",{error:G}),logWarning("mention-feed-callback-error",{marker:t})})}_setupTextWatcher(t){const V=this.editor,N=t.map(G=>({...G,pattern:createRegExp(G.marker,G.minimumCharacters||0)})),W=new TextWatcher(V.model,createTestCallback(N));W.on("matched",(G,Z)=>{const Y=getLastValidMarkerInText(N,Z.text),Q=V.model.document.selection.focus,te=V.model.createPositionAt(Q.parent,Y.position);if(isPositionInExistingMention(Q)||isMarkerInExistingMention(te)){this._hideUIAndRemoveMarker();return}const ie=requestFeedText(Y,Z.text),ne=Y.marker.length+ie.length,le=Q.getShiftedBy(-ne),ae=Q.getShiftedBy(-ie.length),de=V.model.createRange(le,ae);if(checkIfStillInCompletionMode(V)){const ce=V.model.markers.get("mention");V.model.change(we=>{we.updateMarker(ce,{range:de})})}else V.model.change(ce=>{ce.addMarker("mention",{range:de,usingOperation:!1,affectsData:!1})});this._requestFeedDebounced(Y.marker,ie)}),W.on("unmatched",()=>{this._hideUIAndRemoveMarker()});const K=V.commands.get("mention");return W.bind("isEnabled").to(K),W}_handleFeedResponse(t){const{feed:V,marker:N}=t;if(!checkIfStillInCompletionMode(this.editor))return;this._items.clear();for(const K of V){const G=typeof K!="object"?{id:K,text:K}:K;this._items.add({item:G,marker:N})}const W=this.editor.model.markers.get("mention");this._items.length?this._showOrUpdateUI(W):this._hideUIAndRemoveMarker()}_showOrUpdateUI(t){this._isUIVisible?this._balloon.updatePosition(this._getBalloonPanelPositionData(t,this._mentionsView.position)):this._balloon.add({view:this._mentionsView,position:this._getBalloonPanelPositionData(t,this._mentionsView.position),singleViewMode:!0}),this._mentionsView.position=this._balloon.view.position,this._mentionsView.selectFirst()}_hideUIAndRemoveMarker(){this._balloon.hasView(this._mentionsView)&&this._balloon.remove(this._mentionsView),checkIfStillInCompletionMode(this.editor)&&this.editor.model.change(t=>t.removeMarker("mention")),this._mentionsView.position=void 0}_renderItem(t,V){const N=this.editor;let W,K=t.id;const G=this._getItemRenderer(V);if(G){const Z=G(t);typeof Z!="string"?W=new DomWrapperView(N.locale,Z):K=Z}if(!W){const Z=new ButtonView(N.locale);Z.label=K,Z.withText=!0,W=Z}return W}_getBalloonPanelPositionData(t,V){const N=this.editor,W=N.editing,K=W.view.domConverter,G=W.mapper,Z=N.locale.uiLanguageDirection;return{target:()=>{let Y=t.getRange();Y.start.root.rootName=="$graveyard"&&(Y=N.model.document.selection.getFirstRange());const X=G.toViewRange(Y);return Rect.getDomRangeRects(K.viewRangeToDom(X)).pop()},limiter:()=>{const Y=this.editor.editing.view,Q=Y.document.selection.editableElement;return Q?Y.domConverter.mapViewToDom(Q.root):null},positions:getBalloonPanelPositions(V,Z)}}}function getBalloonPanelPositions(H,B){const t={caret_se:V=>({top:V.bottom+VERTICAL_SPACING,left:V.right,name:"caret_se",config:{withArrow:!1}}),caret_ne:(V,N)=>({top:V.top-N.height-VERTICAL_SPACING,left:V.right,name:"caret_ne",config:{withArrow:!1}}),caret_sw:(V,N)=>({top:V.bottom+VERTICAL_SPACING,left:V.right-N.width,name:"caret_sw",config:{withArrow:!1}}),caret_nw:(V,N)=>({top:V.top-N.height-VERTICAL_SPACING,left:V.right-N.width,name:"caret_nw",config:{withArrow:!1}})};return Object.prototype.hasOwnProperty.call(t,H)?[t[H]]:B!=="rtl"?[t.caret_se,t.caret_sw,t.caret_ne,t.caret_nw]:[t.caret_sw,t.caret_se,t.caret_nw,t.caret_ne]}function getLastValidMarkerInText(H,B){let t;for(const V of H){const N=B.lastIndexOf(V.marker);N>0&&!B.substring(N-1).match(V.pattern)||(!t||N>=t.position)&&(t={marker:V.marker,position:N,minimumCharacters:V.minimumCharacters,pattern:V.pattern})}return t}function createRegExp(H,B){const t=B==0?"*":`{${B},}`,V=env.features.isRegExpUnicodePropertySupported?`\\p{Ps}\\p{Pi}"'`:`\\(\\[{"'`,N=".";H=H.replace(/[.*+?^${}()\-|[\]\\]/g,"\\$&");const W=`(?:^|[ ${V}])([${H}])(${N}${t})$`;return new RegExp(W,"u")}function createTestCallback(H){return t=>{const V=getLastValidMarkerInText(H,t);if(!V)return!1;let N=0;V.position!==0&&(N=V.position-1);const W=t.substring(N);return V.pattern.test(W)}}function requestFeedText(H,B){let t=0;H.position!==0&&(t=H.position-1);const V=createRegExp(H.marker,0);return B.substring(t).match(V)[2]}function createFeedCallback(H){return B=>H.filter(V=>(typeof V=="string"?V:String(V.id)).toLowerCase().includes(B.toLowerCase()))}function isPositionInExistingMention(H){const B=H.textNode&&H.textNode.hasAttribute("mention"),t=H.nodeBefore;return B||t&&t.is("$text")&&t.hasAttribute("mention")}function isMarkerInExistingMention(H){const B=H.nodeAfter;return B&&B.is("$text")&&B.hasAttribute("mention")}function isValidMentionMarker(H){return H&&H.length==1}function checkIfStillInCompletionMode(H){return H.model.markers.has("mention")}class Mention extends Plugin{toMentionAttribute(B,t){return _toMentionAttribute(B,t)}static get pluginName(){return"Mention"}static get requires(){return[MentionEditing,MentionUI]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class PageBreakCommand extends Command{refresh(){const B=this.editor.model,t=B.schema,V=B.document.selection;this.isEnabled=isPageBreakAllowedInParent(V,t,B)}execute(){const B=this.editor.model;B.change(t=>{const V=t.createElement("pageBreak");B.insertObject(V,null,null,{setSelection:"after"})})}}function isPageBreakAllowedInParent(H,B,t){const V=getInsertPageBreakParent(H,t);return B.checkChild(V,"pageBreak")}function getInsertPageBreakParent(H,B){const V=findOptimalInsertionRange(H,B).start.parent;return V.isEmpty&&!V.is("element","$root")?V.parent:V}class PageBreakEditing extends Plugin{static get pluginName(){return"PageBreakEditing"}init(){const B=this.editor,t=B.model.schema,V=B.t,N=B.conversion;t.register("pageBreak",{inheritAllFrom:"$blockObject"}),N.for("dataDowncast").elementToStructure({model:"pageBreak",view:(W,{writer:K})=>K.createContainerElement("div",{class:"page-break",style:"page-break-after: always"},K.createContainerElement("span",{style:"display: none"}))}),N.for("editingDowncast").elementToStructure({model:"pageBreak",view:(W,{writer:K})=>{const G=V("Page break"),Z=K.createContainerElement("div"),Y=K.createRawElement("span",{class:"page-break__label"},function(X){X.innerText=V("Page break")});return K.addClass("page-break",Z),K.insert(K.createPositionAt(Z,0),Y),toPageBreakWidget(Z,K,G)}}),N.for("upcast").elementToElement({view:W=>{const K=W.getStyle("page-break-before")=="always",G=W.getStyle("page-break-after")=="always";if(!K&&!G)return null;if(W.childCount==1){const Z=W.getChild(0);if(!Z.is("element","span")||Z.getStyle("display")!="none")return null}else if(W.childCount>1)return null;return{name:!0}},model:"pageBreak",converterPriority:"high"}),B.commands.add("pageBreak",new PageBreakCommand(B))}}function toPageBreakWidget(H,B,t){return B.setCustomProperty("pageBreak",!0,H),toWidget(H,B,{label:t})}var pageBreakIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3.598.687h1.5v5h-1.5zm14.5 0h1.5v5h-1.5z"/><path d="M19.598 4.187v1.5h-16v-1.5zm-16 14.569h1.5v-5h-1.5zm14.5 0h1.5v-5h-1.5z"/><path d="M19.598 15.256v-1.5h-16v1.5zM5.081 9h6v2h-6zm8 0h6v2h-6zm-9.483 1L0 12.5v-5z"/></svg>';class PageBreakUI extends Plugin{static get pluginName(){return"PageBreakUI"}init(){const B=this.editor;B.ui.componentFactory.add("pageBreak",()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),B.ui.componentFactory.add("menuBar:pageBreak",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(B){const t=this.editor,V=t.locale,N=t.commands.get("pageBreak"),W=new B(t.locale),K=V.t;return W.set({label:K("Page break"),icon:pageBreakIcon}),W.bind("isEnabled").to(N,"isEnabled"),this.listenTo(W,"execute",()=>{t.execute("pageBreak"),t.editing.view.focus()}),W}}class PageBreak extends Plugin{static get requires(){return[PageBreakEditing,PageBreakUI,Widget]}static get pluginName(){return"PageBreak"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function convertCssLengthToPx(H){const B=parseFloat(H);return H.endsWith("pt")?toPx(B*96/72):H.endsWith("pc")?toPx(B*12*96/72):H.endsWith("in")?toPx(B*96):H.endsWith("cm")?toPx(B*96/2.54):H.endsWith("mm")?toPx(B/10*96/2.54):H}function isPx(H){return H!==void 0&&H.endsWith("px")}function toPx(H){return H.toFixed(2).replace(/\.?0+$/,"")+"px"}function transformListItemLikeElementsIntoLists(H,B,t){if(!H.childCount)return;const V=new UpcastWriter(H.document),N=findAllItemLikeElements(H,V);if(!N.length)return;const W={},K=[];for(const G of N)if(G.indent!==void 0){isListContinuation(G)||(K.length=0);const Z=`${G.id}:${G.indent}`,Y=Math.min(G.indent-1,K.length);if(Y<K.length&&K[Y].id!==G.id&&(K.length=Y),Y<K.length-1)K.length=Y+1;else{const Q=detectListStyle(G,B);if(Y>K.length-1||K[Y].listElement.name!=Q.type){Y==0&&Q.type=="ol"&&G.id!==void 0&&W[Z]&&(Q.startIndex=W[Z]);const te=createNewEmptyList(Q,V,t);if(isPx(G.marginLeft)&&(Y==0||isPx(K[Y-1].marginLeft))){let ie=G.marginLeft;Y>0&&(ie=toPx(parseFloat(ie)-parseFloat(K[Y-1].marginLeft))),V.setStyle("padding-left",ie,te)}if(K.length==0){const ie=G.element.parent,ne=ie.getChildIndex(G.element)+1;V.insertChild(ne,te,ie)}else{const ie=K[Y-1].listItemElements;V.appendChild(te,ie[ie.length-1])}K[Y]={...G,listElement:te,listItemElements:[]},Y==0&&G.id!==void 0&&(W[Z]=Q.startIndex||1)}}const X=G.element.name=="li"?G.element:V.createElement("li");V.appendChild(X,K[Y].listElement),K[Y].listItemElements.push(X),Y==0&&G.id!==void 0&&W[Z]++,G.element!=X&&V.appendChild(G.element,X),removeBulletElement(G.element,V),V.removeStyle("text-indent",G.element),V.removeStyle("margin-left",G.element)}else{const Z=K.find(Y=>Y.marginLeft==G.marginLeft);if(Z){const Y=Z.listItemElements;V.appendChild(G.element,Y[Y.length-1]),V.removeStyle("margin-left",G.element)}else K.length=0}}function unwrapParagraphInListItem(H,B){for(const t of B.createRangeIn(H)){const V=t.item;if(V.is("element","li")){const N=V.getChild(0);N&&N.is("element","p")&&B.unwrapElement(N)}}}function findAllItemLikeElements(H,B){const t=B.createRangeIn(H),V=[],N=new Set;for(const W of t.getItems()){if(!W.is("element")||!W.name.match(/^(p|h\d+|li|div)$/))continue;let K=getMarginLeftNormalized(W);if(K!==void 0&&parseFloat(K)==0&&!Array.from(W.getClassNames()).find(G=>G.startsWith("MsoList"))&&(K=void 0),W.hasStyle("mso-list")||K!==void 0&&N.has(K)){const G=getListItemData(W);V.push({element:W,id:G.id,order:G.order,indent:G.indent,marginLeft:K}),K!==void 0&&N.add(K)}else N.clear()}return V}function isListContinuation(H){const B=H.element.previousSibling;return isList(B||H.element.parent)}function isList(H){return H.is("element","ol")||H.is("element","ul")}function detectListStyle(H,B){const t=new RegExp(`@list l${H.id}:level${H.indent}\\s*({[^}]*)`,"gi"),V=/mso-level-number-format:([^;]{0,100});/gi,N=/mso-level-start-at:\s{0,100}([0-9]{0,10})\s{0,100};/gi,W=new RegExp(`@list\\s+l${H.id}:level\\d\\s*{[^{]*mso-level-text:"%\\d\\\\.`,"gi"),K=new RegExp(`@list l${H.id}:level\\d\\s*{[^{]*mso-level-number-format:`,"gi"),G=W.exec(B),Z=K.exec(B),Y=G&&!Z,X=t.exec(B);let Q="decimal",te="ol",ie=null;if(X&&X[1]){const ne=V.exec(X[1]);if(ne&&ne[1]&&(Q=ne[1].trim(),te=Q!=="bullet"&&Q!=="image"?"ol":"ul"),Q==="bullet"){const le=findBulletedListStyle(H.element);le&&(Q=le)}else{const le=N.exec(X[1]);le&&le[1]&&(ie=parseInt(le[1]))}Y&&(te="ol")}return{type:te,startIndex:ie,style:mapListStyleDefinition(Q),isLegalStyleList:Y}}function findBulletedListStyle(H){if(H.name=="li"&&H.parent.name=="ul"&&H.parent.hasAttribute("type"))return H.parent.getAttribute("type");const B=findListMarkerNode(H);if(!B)return null;const t=B._data;return t==="o"?"circle":t==="·"?"disc":t==="§"?"square":null}function findListMarkerNode(H){if(H.getChild(0).is("$text"))return null;for(const B of H.getChildren()){if(!B.is("element","span"))continue;const t=B.getChild(0);if(t)return t.is("$text")?t:t.getChild(0)}/* istanbul ignore next -- @preserve */return null}function mapListStyleDefinition(H){if(H.startsWith("arabic-leading-zero"))return"decimal-leading-zero";switch(H){case"alpha-upper":return"upper-alpha";case"alpha-lower":return"lower-alpha";case"roman-upper":return"upper-roman";case"roman-lower":return"lower-roman";case"circle":case"disc":case"square":return H;default:return null}}function createNewEmptyList(H,B,t){const V=B.createElement(H.type);return H.style&&B.setStyle("list-style-type",H.style,V),H.startIndex&&H.startIndex>1&&B.setAttribute("start",H.startIndex,V),H.isLegalStyleList&&t&&B.addClass("legal-list",V),V}function getListItemData(H){const B=H.getStyle("mso-list");if(B===void 0)return{};const t=B.match(/(^|\s{1,100})l(\d+)/i),V=B.match(/\s{0,100}lfo(\d+)/i),N=B.match(/\s{0,100}level(\d+)/i);return t&&V&&N?{id:t[2],order:V[1],indent:parseInt(N[1])}:{indent:1}}function removeBulletElement(H,B){const t=new Matcher({name:"span",styles:{"mso-list":"Ignore"}}),V=B.createRangeIn(H);for(const N of V)N.type==="elementStart"&&t.match(N.item)&&B.remove(N.item)}function getMarginLeftNormalized(H){const B=H.getStyle("margin-left");return B===void 0||B.endsWith("px")?B:convertCssLengthToPx(B)}function replaceImagesSourceWithBase64(H,B){if(!H.childCount)return;const t=new UpcastWriter(H.document),V=findAllShapesIds(H,t);removeAllImgElementsRepresentingShapes(V,H,t),insertMissingImgs(V,H,t),removeAllShapeElements(H,t);const N=findAllImageElementsWithLocalSource(H,t);N.length&&replaceImagesFileSourceWithInlineRepresentation(N,extractImageDataFromRtf(B),t)}function _convertHexToBase64(H){return btoa(H.match(/\w{2}/g).map(B=>String.fromCharCode(parseInt(B,16))).join(""))}function findAllShapesIds(H,B){const t=B.createRangeIn(H),V=new Matcher({name:/v:(.+)/}),N=[];for(const W of t){if(W.type!="elementStart")continue;const K=W.item,G=K.previousSibling,Z=G&&G.is("element")?G.name:null,Y=["Chart"],X=V.match(K),Q=K.getAttribute("o:gfxdata"),te=Z==="v:shapetype",ie=Q&&Y.some(ne=>K.getAttribute("id").includes(ne));X&&Q&&!te&&!ie&&N.push(W.item.getAttribute("id"))}return N}function removeAllImgElementsRepresentingShapes(H,B,t){const V=t.createRangeIn(B),N=new Matcher({name:"img"}),W=[];for(const K of V)if(K.item.is("element")&&N.match(K.item)){const G=K.item,Z=G.getAttribute("v:shapes")?G.getAttribute("v:shapes").split(" "):[];Z.length&&Z.every(Y=>H.indexOf(Y)>-1)?W.push(G):G.getAttribute("src")||W.push(G)}for(const K of W)t.remove(K)}function removeAllShapeElements(H,B){const t=B.createRangeIn(H),V=new Matcher({name:/v:(.+)/}),N=[];for(const W of t)W.type=="elementStart"&&V.match(W.item)&&N.push(W.item);for(const W of N)B.remove(W)}function insertMissingImgs(H,B,t){const V=t.createRangeIn(B),N=[];for(const G of V)if(G.type=="elementStart"&&G.item.is("element","v:shape")){const Z=G.item.getAttribute("id");if(H.includes(Z))continue;W(G.item.parent.getChildren(),Z)||N.push(G.item)}for(const G of N){const Z={src:K(G)};G.hasAttribute("alt")&&(Z.alt=G.getAttribute("alt"));const Y=t.createElement("img",Z);t.insertChild(G.index+1,Y,G.parent)}function W(G,Z){for(const Y of G){/* istanbul ignore else -- @preserve */if(Y.is("element")&&(Y.name=="img"&&Y.getAttribute("v:shapes")==Z||W(Y.getChildren(),Z)))return!0}return!1}function K(G){for(const Z of G.getChildren()){/* istanbul ignore else -- @preserve */if(Z.is("element")&&Z.getAttribute("src"))return Z.getAttribute("src")}}}function findAllImageElementsWithLocalSource(H,B){const t=B.createRangeIn(H),V=new Matcher({name:"img"}),N=[];for(const W of t)W.item.is("element")&&V.match(W.item)&&W.item.getAttribute("src").startsWith("file://")&&N.push(W.item);return N}function extractImageDataFromRtf(H){if(!H)return[];const B=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,t=new RegExp("(?:("+B.source+"))([\\da-fA-F\\s]+)\\}","g"),V=H.match(t),N=[];if(V)for(const W of V){let K=!1;W.includes("\\pngblip")?K="image/png":W.includes("\\jpegblip")&&(K="image/jpeg"),K&&N.push({hex:W.replace(B,"").replace(/[^\da-fA-F]/g,""),type:K})}return N}function replaceImagesFileSourceWithInlineRepresentation(H,B,t){if(H.length===B.length)for(let V=0;V<H.length;V++){const N=`data:${B[V].type};base64,${_convertHexToBase64(B[V].hex)}`;t.setAttribute("src",N,H[V])}}function removeMSAttributes(H){const B=[],t=new UpcastWriter(H.document);for(const{item:V}of t.createRangeIn(H))if(V.is("element")){for(const N of V.getClassNames())/\bmso/gi.exec(N)&&t.removeClass(N,V);for(const N of V.getStyleNames())/\bmso/gi.exec(N)&&t.removeStyle(N,V);(V.is("element","w:sdt")||V.is("element","w:sdtpr")&&V.isEmpty||V.is("element","o:p")&&V.isEmpty)&&B.push(V)}for(const V of B){const N=V.parent,W=N.getChildIndex(V);t.insertChild(W,V.getChildren(),N),t.remove(V)}}const msWordMatch1=/<meta\s*name="?generator"?\s*content="?microsoft\s*word\s*\d+"?\/?>/i,msWordMatch2=/xmlns:o="urn:schemas-microsoft-com/i;class MSWordNormalizer{constructor(B,t=!1){ee(this,"document");ee(this,"hasMultiLevelListPlugin");this.document=B,this.hasMultiLevelListPlugin=t}isActive(B){return msWordMatch1.test(B)||msWordMatch2.test(B)}execute(B){const{body:t,stylesString:V}=B._parsedData;transformListItemLikeElementsIntoLists(t,V,this.hasMultiLevelListPlugin),replaceImagesSourceWithBase64(t,B.dataTransfer.getData("text/rtf")),removeMSAttributes(t),B.content=t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeBoldWrapper(H,B){for(const t of H.getChildren())if(t.is("element","b")&&t.getStyle("font-weight")==="normal"){const V=H.getChildIndex(t);B.remove(t),B.insertChild(V,t.getChildren(),H)}}function transformBlockBrsToParagraphs(H,B){const t=new Document$1(B.document.stylesProcessor),V=new DomConverter(t,{renderingMode:"data"}),N=V.blockElements,W=V.inlineObjectElements,K=[];for(const G of B.createRangeIn(H)){const Z=G.item;if(Z.is("element","br")){const Y=findSibling(Z,"forward",B,{blockElements:N,inlineObjectElements:W}),X=findSibling(Z,"backward",B,{blockElements:N,inlineObjectElements:W}),Q=isBlockViewElement(Y,N);(isBlockViewElement(X,N)||Q)&&K.push(Z)}}for(const G of K)G.hasClass("Apple-interchange-newline")?B.remove(G):B.replace(G,B.createElement("p"))}function findSibling(H,B,t,{blockElements:V,inlineObjectElements:N}){let W=t.createPositionAt(H,B=="forward"?"after":"before");return W=W.getLastMatchingPosition(({item:K})=>K.is("element")&&!V.includes(K.name)&&!N.includes(K.name),{direction:B}),B=="forward"?W.nodeAfter:W.nodeBefore}function isBlockViewElement(H,B){return!!H&&H.is("element")&&B.includes(H.name)}const googleDocsMatch=/id=("|')docs-internal-guid-[-0-9a-f]+("|')/i;class GoogleDocsNormalizer{constructor(B){ee(this,"document");this.document=B}isActive(B){return googleDocsMatch.test(B)}execute(B){const t=new UpcastWriter(this.document),{body:V}=B._parsedData;removeBoldWrapper(V,t),unwrapParagraphInListItem(V,t),transformBlockBrsToParagraphs(V,t),B.content=V}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeXmlns(H,B){for(const t of H.getChildren())t.is("element","table")&&t.hasAttribute("xmlns")&&B.removeAttribute("xmlns",t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeGoogleSheetsTag(H,B){for(const t of H.getChildren())if(t.is("element","google-sheets-html-origin")){const V=H.getChildIndex(t);B.remove(t),B.insertChild(V,t.getChildren(),H)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeInvalidTableWidth(H,B){for(const t of H.getChildren())t.is("element","table")&&t.getStyle("width")==="0px"&&B.removeStyle("width",t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function removeStyleBlock(H,B){for(const t of Array.from(H.getChildren()))t.is("element","style")&&B.remove(t)}const googleSheetsMatch=/<google-sheets-html-origin/i;class GoogleSheetsNormalizer{constructor(B){ee(this,"document");this.document=B}isActive(B){return googleSheetsMatch.test(B)}execute(B){const t=new UpcastWriter(this.document),{body:V}=B._parsedData;removeGoogleSheetsTag(V,t),removeXmlns(V,t),removeInvalidTableWidth(V,t),removeStyleBlock(V,t),B.content=V}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function normalizeSpacing(H){return normalizeSafariSpaceSpans(normalizeSafariSpaceSpans(H)).replace(/(<span\s+style=['"]mso-spacerun:yes['"]>[^\S\r\n]*?)[\r\n]+([^\S\r\n]*<\/span>)/g,"$1$2").replace(/<span\s+style=['"]mso-spacerun:yes['"]><\/span>/g,"").replace(/(<span\s+style=['"]letter-spacing:[^'"]+?['"]>)[\r\n]+(<\/span>)/g,"$1 $2").replace(/ <\//g," </").replace(/ <o:p><\/o:p>/g," <o:p></o:p>").replace(/<o:p>(&nbsp;|\u00A0)<\/o:p>/g,"").replace(/>([^\S\r\n]*[\r\n]\s*)</g,"><")}function normalizeSpacerunSpans(H){H.querySelectorAll("span[style*=spacerun]").forEach(B=>{const t=B,V=t.innerText.length||0;t.innerText=Array(V+1).join("  ").substr(0,V)})}function normalizeSafariSpaceSpans(H){return H.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(B,t)=>t.length===1?" ":Array(t.length+1).join("  ").substr(0,t.length))}function parseHtml(H,B){const t=new DOMParser;H=H.replace(/<!--\[if gte vml 1]>/g,""),H=H.replace(/<o:SmartTagType(?:\s+[^\s>=]+(?:="[^"]*")?)*\s*\/?>/gi,"");const V=normalizeSpacing(cleanContentAfterBody(H)),N=t.parseFromString(V,"text/html");normalizeSpacerunSpans(N);const W=N.body.innerHTML,K=documentToView(N,B),G=extractStyles(N);return{body:K,bodyString:W,styles:G.styles,stylesString:G.stylesString}}function documentToView(H,B){const t=new Document$1(B),V=new DomConverter(t,{renderingMode:"data"}),N=H.createDocumentFragment(),W=H.body.childNodes;for(;W.length>0;)N.appendChild(W[0]);return V.domToView(N,{skipComments:!0})}function extractStyles(H){const B=[],t=[],V=Array.from(H.getElementsByTagName("style"));for(const N of V)N.sheet&&N.sheet.cssRules&&N.sheet.cssRules.length&&(B.push(N.sheet),t.push(N.innerHTML));return{styles:B,stylesString:t.join(" ")}}function cleanContentAfterBody(H){const B="</body>",t="</html>",V=H.indexOf(B);if(V<0)return H;const N=H.indexOf(t,V+B.length);return H.substring(0,V+B.length)+(N>=0?H.substring(N):"")}class PasteFromOffice extends Plugin{static get pluginName(){return"PasteFromOffice"}static get requires(){return[ClipboardPipeline]}init(){const B=this.editor,t=B.plugins.get("ClipboardPipeline"),V=B.editing.view.document,N=[],W=this.editor.plugins.has("MultiLevelList");N.push(new MSWordNormalizer(V,W)),N.push(new GoogleDocsNormalizer(V)),N.push(new GoogleSheetsNormalizer(V)),t.on("inputTransformation",(K,G)=>{if(G._isTransformedWithPasteFromOffice||B.model.document.selection.getFirstPosition().parent.is("element","codeBlock"))return;const Y=G.dataTransfer.getData("text/html"),X=N.find(Q=>Q.isActive(Y));X&&(G._parsedData||(G._parsedData=parseHtml(Y,V.stylesProcessor)),X.execute(G),G._isTransformedWithPasteFromOffice=!0)},{priority:"high"})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */var removeFormatIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8.69 14.915c.053.052.173.083.36.093a.366.366 0 0 1 .345.485l-.003.01a.738.738 0 0 1-.697.497h-2.67a.374.374 0 0 1-.353-.496l.013-.038a.681.681 0 0 1 .644-.458c.197-.012.325-.043.386-.093a.28.28 0 0 0 .072-.11L9.592 4.5H6.269c-.359-.017-.609.013-.75.09-.142.078-.289.265-.442.563-.192.29-.516.464-.864.464H4.17a.43.43 0 0 1-.407-.569L4.46 3h13.08l-.62 2.043a.81.81 0 0 1-.775.574h-.114a.486.486 0 0 1-.486-.486c.001-.284-.054-.464-.167-.54-.112-.076-.367-.106-.766-.091h-3.28l-2.68 10.257c-.006.074.007.127.038.158zM3 17h8a.5.5 0 1 1 0 1H3a.5.5 0 1 1 0-1zm11.299 1.17a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.06-1.06l1.415 1.414 1.414-1.415a.75.75 0 1 1 1.06 1.06l-1.413 1.415 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414-1.414 1.414z"/></svg>';const REMOVE_FORMAT="removeFormat";class RemoveFormatUI extends Plugin{static get pluginName(){return"RemoveFormatUI"}init(){const B=this.editor;B.ui.componentFactory.add(REMOVE_FORMAT,()=>{const t=this._createButton(ButtonView);return t.set({tooltip:!0}),t}),B.ui.componentFactory.add(`menuBar:${REMOVE_FORMAT}`,()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(B){const t=this.editor,V=t.locale,N=t.commands.get(REMOVE_FORMAT),W=new B(t.locale),K=V.t;return W.set({label:K("Remove Format"),icon:removeFormatIcon}),W.bind("isEnabled").to(N,"isEnabled"),this.listenTo(W,"execute",()=>{t.execute(REMOVE_FORMAT),t.editing.view.focus()}),W}}class RemoveFormatCommand extends Command{refresh(){const B=this.editor.model;this.isEnabled=!!first(this._getFormattingItems(B.document.selection,B.schema))}execute(){const B=this.editor.model,t=B.schema;B.change(V=>{for(const N of this._getFormattingItems(B.document.selection,t))if(N.is("selection"))for(const W of this._getFormattingAttributes(N,t))V.removeSelectionAttribute(W);else{const W=V.createRangeOn(N);for(const K of this._getFormattingAttributes(N,t))V.removeAttribute(K,W)}})}*_getFormattingItems(B,t){const V=N=>!!first(this._getFormattingAttributes(N,t));for(const N of B.getRanges())for(const W of N.getItems())!t.isBlock(W)&&V(W)&&(yield W);for(const N of B.getSelectedBlocks())V(N)&&(yield N);V(B)&&(yield B)}*_getFormattingAttributes(B,t){for(const[V]of B.getAttributes()){const N=t.getAttributeProperties(V);N&&N.isFormatting&&(yield V)}}}class RemoveFormatEditing extends Plugin{static get pluginName(){return"RemoveFormatEditing"}init(){const B=this.editor;B.commands.add("removeFormat",new RemoveFormatCommand(B))}}class RemoveFormat extends Plugin{static get requires(){return[RemoveFormatEditing,RemoveFormatUI]}static get pluginName(){return"RemoveFormat"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function formatHtml(H){const B=[{name:"address",isVoid:!1},{name:"article",isVoid:!1},{name:"aside",isVoid:!1},{name:"blockquote",isVoid:!1},{name:"details",isVoid:!1},{name:"dialog",isVoid:!1},{name:"dd",isVoid:!1},{name:"div",isVoid:!1},{name:"dl",isVoid:!1},{name:"dt",isVoid:!1},{name:"fieldset",isVoid:!1},{name:"figcaption",isVoid:!1},{name:"figure",isVoid:!1},{name:"footer",isVoid:!1},{name:"form",isVoid:!1},{name:"h1",isVoid:!1},{name:"h2",isVoid:!1},{name:"h3",isVoid:!1},{name:"h4",isVoid:!1},{name:"h5",isVoid:!1},{name:"h6",isVoid:!1},{name:"header",isVoid:!1},{name:"hgroup",isVoid:!1},{name:"hr",isVoid:!0},{name:"li",isVoid:!1},{name:"main",isVoid:!1},{name:"nav",isVoid:!1},{name:"ol",isVoid:!1},{name:"p",isVoid:!1},{name:"section",isVoid:!1},{name:"table",isVoid:!1},{name:"tbody",isVoid:!1},{name:"td",isVoid:!1},{name:"th",isVoid:!1},{name:"thead",isVoid:!1},{name:"tr",isVoid:!1},{name:"ul",isVoid:!1}],t=B.map(K=>K.name).join("|"),V=H.replace(new RegExp(`</?(${t})( .*?)?>`,"g"),`
$&
`).replace(/<br[^>]*>/g,`$&
`).split(`
`);let N=0,W=!1;return V.filter(K=>K.length).map(K=>(W=isPreformattedBlockLine(K,W),isNonVoidOpeningTag(K,B)?indentLine(K,N++):isClosingTag(K,B)?indentLine(K,--N):W==="middle"||W==="last"?K:indentLine(K,N))).join(`
`)}function isNonVoidOpeningTag(H,B){return B.some(t=>!(t.isVoid||!new RegExp(`<${t.name}( .*?)?>`).test(H)))}function isClosingTag(H,B){return B.some(t=>new RegExp(`</${t.name}>`).test(H))}function indentLine(H,B,t="    "){return`${t.repeat(Math.max(0,B))}${H}`}function isPreformattedBlockLine(H,B){return new RegExp("<pre( .*?)?>").test(H)?"first":new RegExp("</pre>").test(H)?"last":B==="first"||B==="middle"?"middle":!1}var sourceEditingIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 0 5 4.5v15.003h-16V0h11zM3 1.5v3.25l-1.497 1-.003 8 1.5 1v3.254L7.685 18l-.001 1.504H17.5V8.002L16 9.428l-.004-4.22-4.222-3.692L3 1.5z"/><path d="M4.06 6.64a.75.75 0 0 1 .958 1.15l-.085.07L2.29 9.75l2.646 1.89c.302.216.4.62.232.951l-.058.095a.75.75 0 0 1-.951.232l-.095-.058-3.5-2.5V9.14l3.496-2.5zm4.194 6.22a.75.75 0 0 1-.958-1.149l.085-.07 2.643-1.89-2.646-1.89a.75.75 0 0 1-.232-.952l.058-.095a.75.75 0 0 1 .95-.232l.096.058 3.5 2.5v1.22l-3.496 2.5zm7.644-.836 2.122 2.122-5.825 5.809-2.125-.005.003-2.116zm2.539-1.847 1.414 1.414a.5.5 0 0 1 0 .707l-1.06 1.06-2.122-2.12 1.061-1.061a.5.5 0 0 1 .707 0z"/></svg>';const COMMAND_FORCE_DISABLE_ID="SourceEditingMode";class SourceEditing extends Plugin{constructor(t){super(t);ee(this,"_elementReplacer");ee(this,"_replacedRoots");ee(this,"_dataFromRoots");this.set("isSourceEditingMode",!1),this._elementReplacer=new ElementReplacer,this._replacedRoots=new Map,this._dataFromRoots=new Map,t.config.define("sourceEditing.allowCollaborationFeatures",!1)}static get pluginName(){return"SourceEditing"}static get requires(){return[PendingActions]}init(){this._checkCompatibility();const t=this.editor,V=t.locale.t;t.ui.componentFactory.add("sourceEditing",()=>{const N=this._createButton(ButtonView);return N.set({label:V("Source"),icon:sourceEditingIcon,tooltip:!0,class:"ck-source-editing-button"}),N}),t.ui.componentFactory.add("menuBar:sourceEditing",()=>{const N=this._createButton(MenuBarMenuListItemButtonView);return N.set({label:V("Show source"),role:"menuitemcheckbox"}),N}),this._isAllowedToHandleSourceEditingMode()&&(this.on("change:isSourceEditingMode",(N,W,K)=>{K?(this._hideVisibleDialog(),this._showSourceEditing(),this._disableCommands()):(this._hideSourceEditing(),this._enableCommands())}),this.on("change:isEnabled",(N,W,K)=>this._handleReadOnlyMode(!K)),this.listenTo(t,"change:isReadOnly",(N,W,K)=>this._handleReadOnlyMode(K))),t.data.on("get",()=>{this.isSourceEditingMode&&this.updateEditorData()},{priority:"high"})}updateEditorData(){const t=this.editor,V={};for(const[N,W]of this._replacedRoots){const K=this._dataFromRoots.get(N),G=W.dataset.value;K!==G&&(V[N]=G,this._dataFromRoots.set(N,G))}Object.keys(V).length&&t.data.set(V,{batchType:{isUndoable:!0},suppressErrorInCollaboration:!0})}_checkCompatibility(){const t=this.editor,V=t.config.get("sourceEditing.allowCollaborationFeatures");if(!V&&t.plugins.has("RealTimeCollaborativeEditing"))throw new CKEditorError("source-editing-incompatible-with-real-time-collaboration",null);!V&&["CommentsEditing","TrackChangesEditing","RevisionHistory"].some(W=>t.plugins.has(W))&&console.warn("You initialized the editor with the source editing feature and at least one of the collaboration features. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the collaboration features."),t.plugins.has("RestrictedEditingModeEditing")&&console.warn("You initialized the editor with the source editing feature and restricted editing feature. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the restricted editing feature.")}_showSourceEditing(){const t=this.editor,V=t.editing.view,N=t.model;N.change(W=>{W.setSelection(null),W.removeSelectionAttribute(N.document.selection.getAttributeKeys())});for(const[W,K]of V.domRoots){const G=formatSource(t.data.get({rootName:W})),Z=createElement(K.ownerDocument,"textarea",{rows:"1","aria-label":"Source code editing area"}),Y=createElement(K.ownerDocument,"div",{class:"ck-source-editing-area","data-value":G},[Z]);Z.value=G,Z.setSelectionRange(0,0),Z.addEventListener("input",()=>{Y.dataset.value=Z.value,t.ui.update()}),V.change(X=>{const Q=V.document.getRoot(W);X.addClass("ck-hidden",Q)}),t.ui.setEditableElement("sourceEditing:"+W,Z),this._replacedRoots.set(W,Y),this._elementReplacer.replace(K,Y),this._dataFromRoots.set(W,G)}this._focusSourceEditing()}_hideSourceEditing(){const V=this.editor.editing.view;this.updateEditorData(),V.change(N=>{for(const[W]of this._replacedRoots)N.removeClass("ck-hidden",V.document.getRoot(W))}),this._elementReplacer.restore(),this._replacedRoots.clear(),this._dataFromRoots.clear(),V.focus()}_focusSourceEditing(){const t=this.editor,[V]=this._replacedRoots.values(),N=V.querySelector("textarea");t.editing.view.document.isFocused=!1,N.focus()}_disableCommands(){const t=this.editor;for(const V of t.commands.commands())V.forceDisabled(COMMAND_FORCE_DISABLE_ID);t.plugins.has("CommentsArchiveUI")&&t.plugins.get("CommentsArchiveUI").forceDisabled(COMMAND_FORCE_DISABLE_ID)}_enableCommands(){const t=this.editor;for(const V of t.commands.commands())V.clearForceDisabled(COMMAND_FORCE_DISABLE_ID);t.plugins.has("CommentsArchiveUI")&&t.plugins.get("CommentsArchiveUI").clearForceDisabled(COMMAND_FORCE_DISABLE_ID)}_handleReadOnlyMode(t){if(this.isSourceEditingMode)for(const[,V]of this._replacedRoots)V.querySelector("textarea").readOnly=t}_isAllowedToHandleSourceEditingMode(){const V=this.editor.ui.view.editable;return V&&!V.hasExternalElement}_hideVisibleDialog(){if(this.editor.plugins.has("Dialog")){const t=this.editor.plugins.get("Dialog");t.isOpen&&t.hide()}}_createButton(t){const V=this.editor,N=new t(V.locale);return N.set({withText:!0,isToggleable:!0}),N.bind("isOn").to(this,"isSourceEditingMode"),N.bind("isEnabled").to(this,"isEnabled",V,"isReadOnly",V.plugins.get(PendingActions),"hasAny",(W,K,G)=>!(!W||K||G)),this.listenTo(N,"execute",()=>{this.isSourceEditingMode=!this.isSourceEditingMode}),N}}function formatSource(H){return isHtml(H)?formatHtml(H):H}function isHtml(H){return H.startsWith("<")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class CharacterGridView extends View{constructor(t){super(t);ee(this,"tiles");ee(this,"focusTracker");ee(this,"keystrokes");this.tiles=this.createCollection(),this.setTemplate({tag:"div",children:[{tag:"div",attributes:{class:["ck","ck-character-grid__tiles"]},children:this.tiles}],attributes:{class:["ck","ck-character-grid"]}}),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,addKeyboardHandlingForGrid({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.tiles,numberOfColumns:()=>global$1.window.getComputedStyle(this.element.firstChild).getPropertyValue("grid-template-columns").split(" ").length,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}createTile(t,V){const N=new ButtonView(this.locale);return N.set({label:t,withText:!0,class:"ck-character-grid__tile"}),N.extendTemplate({attributes:{title:V},on:{mouseover:N.bindTemplate.to("mouseover"),focus:N.bindTemplate.to("focus")}}),N.on("mouseover",()=>{this.fire("tileHover",{name:V,character:t})}),N.on("focus",()=>{this.fire("tileFocus",{name:V,character:t})}),N.on("execute",()=>{this.fire("execute",{name:V,character:t})}),N}render(){super.render();for(const t of this.tiles)this.focusTracker.add(t.element);this.tiles.on("change",(t,{added:V,removed:N})=>{if(V.length>0)for(const W of V)this.focusTracker.add(W.element);if(N.length>0)for(const W of N)this.focusTracker.remove(W.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.keystrokes.destroy()}focus(){this.tiles.first.focus()}}class CharacterInfoView extends View{constructor(B){super(B);const t=this.bindTemplate;this.set("character",null),this.set("name",null),this.bind("code").to(this,"character",characterToUnicodeString),this.setTemplate({tag:"div",children:[{tag:"span",attributes:{class:["ck-character-info__name"]},children:[{text:t.to("name",V=>V||"​")}]},{tag:"span",attributes:{class:["ck-character-info__code"]},children:[{text:t.to("code")}]}],attributes:{class:["ck","ck-character-info"]}})}}function characterToUnicodeString(H){return H===null?"":"U+"+("0000"+H.codePointAt(0).toString(16)).slice(-4)}class SpecialCharactersView extends View{constructor(t,V,N,W){super(t);ee(this,"items");ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"_focusCycler");ee(this,"categoriesView");ee(this,"gridView");ee(this,"infoView");this.categoriesView=V,this.gridView=N,this.infoView=W,this.items=this.createCollection(),this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this._focusCycler=new FocusCycler({focusables:this.items,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",children:[this.categoriesView,this.gridView,this.infoView],attributes:{tabindex:"-1"}}),this.items.add(this.categoriesView),this.items.add(this.gridView)}render(){super.render(),this.focusTracker.add(this.categoriesView.element),this.focusTracker.add(this.gridView.element),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}}var specialCharactersIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2.5a7.47 7.47 0 0 1 4.231 1.31 7.268 7.268 0 0 1 2.703 3.454 7.128 7.128 0 0 1 .199 4.353c-.39 1.436-1.475 2.72-2.633 3.677h2.013c0-.226.092-.443.254-.603a.876.876 0 0 1 1.229 0c.163.16.254.377.254.603v.853c0 .209-.078.41-.22.567a.873.873 0 0 1-.547.28l-.101.006h-4.695a.517.517 0 0 1-.516-.518v-1.265c0-.21.128-.398.317-.489a5.601 5.601 0 0 0 2.492-2.371 5.459 5.459 0 0 0 .552-3.693 5.53 5.53 0 0 0-1.955-3.2A5.71 5.71 0 0 0 10 4.206 5.708 5.708 0 0 0 6.419 5.46 5.527 5.527 0 0 0 4.46 8.663a5.457 5.457 0 0 0 .554 3.695 5.6 5.6 0 0 0 2.497 2.37.55.55 0 0 1 .317.49v1.264c0 .286-.23.518-.516.518H2.618a.877.877 0 0 1-.614-.25.845.845 0 0 1-.254-.603v-.853c0-.226.091-.443.254-.603a.876.876 0 0 1 1.228 0c.163.16.255.377.255.603h1.925c-1.158-.958-2.155-2.241-2.545-3.678a7.128 7.128 0 0 1 .199-4.352 7.268 7.268 0 0 1 2.703-3.455A7.475 7.475 0 0 1 10 2.5z"/></svg>';class SpecialCharactersCategoriesView extends View{constructor(t,V){super(t);ee(this,"_groupNames");ee(this,"_dropdownView");this.set("currentGroupName",Array.from(V.entries())[0][0]),this._groupNames=V,this._dropdownView=new LabeledFieldView(t,createLabeledDropdown),this.setTemplate({tag:"div",attributes:{class:["ck","ck-character-categories"]},children:[this._dropdownView]})}render(){super.render(),this._setupDropdown()}focus(){this._dropdownView.focus()}_setupDropdown(){const t=new Collection;for(const[W,K]of this._groupNames){const G={type:"button",model:new Model({name:W,label:K,role:"menuitemradio",withText:!0})};G.model.bind("isOn").to(this,"currentGroupName",Z=>Z===W),t.add(G)}const V=this.locale.t,N=V("Category");this._dropdownView.set({label:N,isEmpty:!1}),this._dropdownView.fieldView.panelPosition=this.locale.uiLanguageDirection==="rtl"?"se":"sw",this._dropdownView.fieldView.buttonView.set({withText:!0,tooltip:N,ariaLabel:N,ariaLabelledBy:void 0,isOn:!1}),this._dropdownView.fieldView.buttonView.bind("label").to(this,"currentGroupName",W=>this._groupNames.get(W)),this._dropdownView.fieldView.on("execute",({source:W})=>{this.currentGroupName=W.name}),addListToDropdown(this._dropdownView.fieldView,t,{ariaLabel:N,role:"menu"})}}const ALL_SPECIAL_CHARACTERS_GROUP="All";class SpecialCharacters extends Plugin{constructor(t){super(t);ee(this,"_characters");ee(this,"_groups");ee(this,"_allSpecialCharactersGroupLabel");const V=t.t;this._characters=new Map,this._groups=new Map,this._allSpecialCharactersGroupLabel=V("All")}static get requires(){return[Typing,Dialog]}static get pluginName(){return"SpecialCharacters"}init(){const t=this.editor;t.ui.componentFactory.add("specialCharacters",()=>{const V=this._createDialogButton(ButtonView);return V.set({tooltip:!0}),V}),t.ui.componentFactory.add("menuBar:specialCharacters",()=>this._createDialogButton(MenuBarMenuListItemButtonView))}addItems(t,V,N={label:t}){if(t===ALL_SPECIAL_CHARACTERS_GROUP)throw new CKEditorError("special-character-invalid-group-name",null);const W=this._getGroup(t,N.label);for(const K of V)W.items.add(K.title),this._characters.set(K.title,K.character)}getGroups(){const t=Array.from(this._groups.keys()),V=this.editor.config.get("specialCharacters.order")||[],N=V.find(W=>!t.includes(W));if(N)throw new CKEditorError("special-character-invalid-order-group-name",null,{invalidGroup:N});return new Set([...V,...t])}getCharactersForGroup(t){if(t===ALL_SPECIAL_CHARACTERS_GROUP)return new Set(this._characters.keys());const V=this._groups.get(t);if(V)return V.items}getCharacter(t){return this._characters.get(t)}_getGroup(t,V){return this._groups.has(t)||this._groups.set(t,{items:new Set,label:V}),this._groups.get(t)}_updateGrid(t,V){V.tiles.clear();const N=this.getCharactersForGroup(t);for(const W of N){const K=this.getCharacter(W);V.tiles.add(V.createTile(K,W))}}_createDropdownPanelContent(t){const V=Array.from(this.getGroups()).map(Z=>[Z,this._groups.get(Z).label]),N=new Map([[ALL_SPECIAL_CHARACTERS_GROUP,this._allSpecialCharactersGroupLabel],...V]),W=new SpecialCharactersCategoriesView(t,N),K=new CharacterGridView(t),G=new CharacterInfoView(t);return K.on("tileHover",(Z,Y)=>{G.set(Y)}),K.on("tileFocus",(Z,Y)=>{G.set(Y)}),W.on("change:currentGroupName",(Z,Y,X)=>{this._updateGrid(X,K)}),this._updateGrid(W.currentGroupName,K),{categoriesView:W,gridView:K,infoView:G}}_createDialogButton(t){const V=this.editor,N=V.locale,W=new t(V.locale),K=V.commands.get("insertText"),G=N.t,Z=this.editor.plugins.get("Dialog");return W.set({label:G("Special characters"),icon:specialCharactersIcon,isToggleable:!0}),W.bind("isOn").to(Z,"id",Y=>Y==="specialCharacters"),W.bind("isEnabled").to(K,"isEnabled"),W.on("execute",()=>{if(Z.id==="specialCharacters"){Z.hide();return}this._showDialog()}),W}_showDialog(){const t=this.editor,V=t.plugins.get("Dialog"),N=t.locale,W=N.t,{categoriesView:K,gridView:G,infoView:Z}=this._createDropdownPanelContent(N),Y=new SpecialCharactersView(N,K,G,Z);G.on("execute",(X,Q)=>{t.execute("insertText",{text:Q.character})}),V.show({id:"specialCharacters",title:W("Special characters"),className:"ck-special-characters",content:Y,position:DialogViewPosition.EDITOR_TOP_SIDE})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function upcastStyleToAttribute(H,B){const{modelAttribute:t,styleName:V,viewElement:N,defaultValue:W,reduceBoxSides:K=!1,shouldUpcast:G=()=>!0}=B;H.for("upcast").attributeToAttribute({view:{name:N,styles:{[V]:/[\s\S]+/}},model:{key:t,value:Z=>{if(!G(Z))return;const Y=Z.getNormalizedStyle(V),X=K?reduceBoxSidesValue(Y):Y;if(W!==X)return X}}})}function upcastBorderStyles(H,B,t,V){H.for("upcast").add(N=>N.on("element:"+B,(W,K,G)=>{if(!K.modelRange)return;const Z=["border-top-width","border-top-color","border-top-style","border-bottom-width","border-bottom-color","border-bottom-style","border-right-width","border-right-color","border-right-style","border-left-width","border-left-color","border-left-style"].filter(ie=>K.viewItem.hasStyle(ie));if(!Z.length)return;const Y={styles:Z};if(!G.consumable.test(K.viewItem,Y))return;const X=[...K.modelRange.getItems({shallow:!0})].pop();G.consumable.consume(K.viewItem,Y);const Q={style:K.viewItem.getNormalizedStyle("border-style"),color:K.viewItem.getNormalizedStyle("border-color"),width:K.viewItem.getNormalizedStyle("border-width")},te={style:reduceBoxSidesValue(Q.style),color:reduceBoxSidesValue(Q.color),width:reduceBoxSidesValue(Q.width)};te.style!==V.style&&G.writer.setAttribute(t.style,te.style,X),te.color!==V.color&&G.writer.setAttribute(t.color,te.color,X),te.width!==V.width&&G.writer.setAttribute(t.width,te.width,X)}))}function downcastAttributeToStyle(H,B){const{modelElement:t,modelAttribute:V,styleName:N}=B;H.for("downcast").attributeToAttribute({model:{name:t,key:V},view:W=>({key:"style",value:{[N]:W}})})}function downcastTableAttribute(H,B){const{modelAttribute:t,styleName:V}=B;H.for("downcast").add(N=>N.on(`attribute:${t}:table`,(W,K,G)=>{const{item:Z,attributeNewValue:Y}=K,{mapper:X,writer:Q}=G;if(!G.consumable.consume(K.item,W.name))return;const te=[...X.toViewElement(Z).getChildren()].find(ie=>ie.is("element","table"));Y?Q.setStyle(V,Y,te):Q.removeStyle(V,te)}))}function reduceBoxSidesValue(H){if(!H)return;const B=["top","right","bottom","left"];if(!B.every(W=>H[W]))return H;const V=H.top;return B.every(W=>H[W]===V)?V:H}function updateNumericAttribute(H,B,t,V,N=1){B!=null&&N!==void 0&&N!==null&&B>N?V.setAttribute(H,B,t):V.removeAttribute(H,t)}function createEmptyTableCell(H,B,t={}){const V=H.createElement("tableCell",t);return H.insertElement("paragraph",V),H.insert(V,B),V}function isHeadingColumnCell(H,B){const t=B.parent.parent,V=parseInt(t.getAttribute("headingColumns")||"0"),{column:N}=H.getCellLocation(B);return!!V&&N<V}function enableProperty$1(H,B,t){const{modelAttribute:V}=t;H.extend("tableCell",{allowAttributes:[V]}),upcastStyleToAttribute(B,{viewElement:/^(td|th)$/,...t}),downcastAttributeToStyle(B,{modelElement:"tableCell",...t})}function getSelectionAffectedTable(H){const B=H.getSelectedElement();return B&&B.is("element","table")?B:H.getFirstPosition().findAncestor("table")}function upcastTableFigure(){return H=>{H.on("element:figure",(B,t,V)=>{if(!V.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const N=getViewTableFromFigure(t.viewItem);if(!N||!V.consumable.test(N,{name:!0}))return;V.consumable.consume(t.viewItem,{name:!0,classes:"table"});const W=V.convertItem(N,t.modelCursor),K=first(W.modelRange.getItems());if(!K){V.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}V.convertChildren(t.viewItem,V.writer.createPositionAt(K,"end")),V.updateConversionResult(K,t)})}}function upcastTable(){return H=>{H.on("element:table",(B,t,V)=>{const N=t.viewItem;if(!V.consumable.test(N,{name:!0}))return;const{rows:W,headingRows:K,headingColumns:G}=scanTable(N),Z={};G&&(Z.headingColumns=G),K&&(Z.headingRows=K);const Y=V.writer.createElement("table",Z);if(V.safeInsert(Y,t.modelCursor)){if(V.consumable.consume(N,{name:!0}),W.forEach(X=>V.convertItem(X,V.writer.createPositionAt(Y,"end"))),V.convertChildren(N,V.writer.createPositionAt(Y,"end")),Y.isEmpty){const X=V.writer.createElement("tableRow");V.writer.insert(X,V.writer.createPositionAt(Y,"end")),createEmptyTableCell(V.writer,V.writer.createPositionAt(X,"end"))}V.updateConversionResult(Y,t)}})}}function skipEmptyTableRow(){return H=>{H.on("element:tr",(B,t)=>{t.viewItem.isEmpty&&t.modelCursor.index==0&&B.stop()},{priority:"high"})}}function ensureParagraphInTableCell(H){return B=>{B.on(`element:${H}`,(t,V,{writer:N})=>{if(!V.modelRange)return;const W=V.modelRange.start.nodeAfter,K=N.createPositionAt(W,0);if(V.viewItem.isEmpty){N.insertElement("paragraph",K);return}const G=Array.from(W.getChildren());if(G.every(Z=>Z.is("element","$marker"))){const Z=N.createElement("paragraph");N.insert(Z,N.createPositionAt(W,0));for(const Y of G)N.move(N.createRangeOn(Y),N.createPositionAt(Z,"end"))}},{priority:"low"})}}function getViewTableFromFigure(H){for(const B of H.getChildren())if(B.is("element","table"))return B}function scanTable(H){let B=0,t;const V=[],N=[];let W;for(const K of Array.from(H.getChildren())){if(K.name!=="tbody"&&K.name!=="thead"&&K.name!=="tfoot")continue;K.name==="thead"&&!W&&(W=K);const G=Array.from(K.getChildren()).filter(Z=>Z.is("element","tr"));for(const Z of G)if(W&&K===W||K.name==="tbody"&&Array.from(Z.getChildren()).length&&Array.from(Z.getChildren()).every(Y=>Y.is("element","th")))B++,V.push(Z);else{N.push(Z);const Y=scanRowForHeadingColumns(Z);(!t||Y<t)&&(t=Y)}}return{headingRows:B,headingColumns:t||0,rows:[...V,...N]}}function scanRowForHeadingColumns(H){let B=0,t=0;const V=Array.from(H.getChildren()).filter(N=>N.name==="th"||N.name==="td");for(;t<V.length&&V[t].name==="th";){const N=V[t],W=parseInt(N.getAttribute("colspan")||"1");B=B+W,t++}return B}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TableWalker{constructor(B,t={}){ee(this,"_table");ee(this,"_startRow");ee(this,"_endRow");ee(this,"_startColumn");ee(this,"_endColumn");ee(this,"_includeAllSlots");ee(this,"_skipRows");ee(this,"_row");ee(this,"_rowIndex");ee(this,"_column");ee(this,"_cellIndex");ee(this,"_spannedCells");ee(this,"_nextCellAtColumn");ee(this,"_jumpedToStartRow",!1);this._table=B,this._startRow=t.row!==void 0?t.row:t.startRow||0,this._endRow=t.row!==void 0?t.row:t.endRow,this._startColumn=t.column!==void 0?t.column:t.startColumn||0,this._endColumn=t.column!==void 0?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();const B=this._table.getChild(this._rowIndex);if(!B||this._isOverEndRow())return{done:!0,value:void 0};if(!B.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const V=this._getSpanned();if(V)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(V.cell,V.row,V.column));else{const N=B.getChild(this._cellIndex);if(!N)return this._advanceToNextRow();const W=parseInt(N.getAttribute("colspan")||"1"),K=parseInt(N.getAttribute("rowspan")||"1");(W>1||K>1)&&this._recordSpans(N,K,W),this._shouldSkipSlot()||(t=this._formatOutValue(N)),this._nextCellAtColumn=this._column+W}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(B){this._skipRows.add(B)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(B,t=this._row,V=this._column){return{done:!1,value:new TableSlot(this,B,t,V)}}_shouldSkipSlot(){const B=this._skipRows.has(this._row),t=this._row<this._startRow,V=this._column<this._startColumn,N=this._endColumn!==void 0&&this._column>this._endColumn;return B||t||V||N}_getSpanned(){const B=this._spannedCells.get(this._row);return B&&B.get(this._column)||null}_recordSpans(B,t,V){const N={cell:B,row:this._row,column:this._column};for(let W=this._row;W<this._row+t;W++)for(let K=this._column;K<this._column+V;K++)(W!=this._row||K!=this._column)&&this._markSpannedCell(W,K,N)}_markSpannedCell(B,t,V){this._spannedCells.has(B)||this._spannedCells.set(B,new Map),this._spannedCells.get(B).set(t,V)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){const B=this._getRowLength(0);for(let t=this._startRow;!this._jumpedToStartRow;t--)B===this._getRowLength(t)&&(this._row=t,this._rowIndex=t,this._jumpedToStartRow=!0)}_getRowLength(B){return[...this._table.getChild(B).getChildren()].reduce((V,N)=>V+parseInt(N.getAttribute("colspan")||"1"),0)}}class TableSlot{constructor(B,t,V,N){ee(this,"cell");ee(this,"row");ee(this,"column");ee(this,"cellAnchorRow");ee(this,"cellAnchorColumn");ee(this,"_cellIndex");ee(this,"_rowIndex");ee(this,"_table");this.cell=t,this.row=B._row,this.column=B._column,this.cellAnchorRow=V,this.cellAnchorColumn=N,this._cellIndex=B._cellIndex,this._rowIndex=B._rowIndex,this._table=B._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}function downcastTable(H,B){return(t,{writer:V})=>{const N=t.getAttribute("headingRows")||0,W=V.createContainerElement("table",null,[]),K=V.createContainerElement("figure",{class:"table"},W);N>0&&V.insert(V.createPositionAt(W,"end"),V.createContainerElement("thead",null,V.createSlot(G=>G.is("element","tableRow")&&G.index<N))),N<H.getRows(t)&&V.insert(V.createPositionAt(W,"end"),V.createContainerElement("tbody",null,V.createSlot(G=>G.is("element","tableRow")&&G.index>=N)));for(const{positionOffset:G,filter:Z}of B.additionalSlots)V.insert(V.createPositionAt(W,G),V.createSlot(Z));return V.insert(V.createPositionAt(W,"after"),V.createSlot(G=>G.is("element","tableRow")?!1:!B.additionalSlots.some(({filter:Z})=>Z(G)))),B.asWidget?toTableWidget(K,V):K}}function downcastRow(){return(H,{writer:B})=>H.isEmpty?B.createEmptyElement("tr"):B.createContainerElement("tr")}function downcastCell(H={}){return(B,{writer:t})=>{const V=B.parent,N=V.parent,W=N.getChildIndex(V),K=new TableWalker(N,{row:W}),G=N.getAttribute("headingRows")||0,Z=N.getAttribute("headingColumns")||0;let Y=null;for(const X of K)if(X.cell==B){const te=X.row<G||X.column<Z?"th":"td";Y=H.asWidget?toWidgetEditable(t.createEditableElement(te),t):t.createContainerElement(te);break}return Y}}function convertParagraphInTableCell(H={}){return(B,{writer:t})=>{if(!B.parent.is("element","tableCell")||!isSingleParagraphWithoutAttributes(B))return null;if(H.asWidget)return t.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const V=t.createContainerElement("p");return t.setCustomProperty("dataPipeline:transparentRendering",!0,V),V}}}function isSingleParagraphWithoutAttributes(H){return H.parent.childCount==1&&!hasAnyAttribute(H)}function toTableWidget(H,B){return B.setCustomProperty("table",!0,H),toWidget(H,B,{hasSelectionHandle:!0})}function hasAnyAttribute(H){return!H.getAttributeKeys().next().done}class InsertTableCommand extends Command{refresh(){const B=this.editor.model,t=B.document.selection,V=B.schema;this.isEnabled=isAllowedInParent(t,V)}execute(B={}){const t=this.editor,V=t.model,N=t.plugins.get("TableUtils"),W=t.config.get("table.defaultHeadings.rows"),K=t.config.get("table.defaultHeadings.columns");B.headingRows===void 0&&W&&(B.headingRows=W),B.headingColumns===void 0&&K&&(B.headingColumns=K),V.change(G=>{const Z=N.createTable(G,B);V.insertObject(Z,null,null,{findOptimalPosition:"auto"}),G.setSelection(G.createPositionAt(Z.getNodeByPath([0,0,0]),0))})}}function isAllowedInParent(H,B){const t=H.getFirstPosition().parent,V=t===t.root?t:t.parent;return B.checkChild(V,"table")}class InsertRowCommand extends Command{constructor(t,V={}){super(t);ee(this,"order");this.order=V.order||"below"}refresh(){const t=this.editor.model.document.selection,N=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(t).length;this.isEnabled=N}execute(){const t=this.editor,V=t.model.document.selection,N=t.plugins.get("TableUtils"),W=this.order==="above",K=N.getSelectionAffectedTableCells(V),G=N.getRowIndexes(K),Z=W?G.first:G.last,Y=K[0].findAncestor("table");N.insertRows(Y,{at:W?Z:Z+1,copyStructureFromAbove:!W})}}class InsertColumnCommand extends Command{constructor(t,V={}){super(t);ee(this,"order");this.order=V.order||"right"}refresh(){const t=this.editor.model.document.selection,N=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(t).length;this.isEnabled=N}execute(){const t=this.editor,V=t.model.document.selection,N=t.plugins.get("TableUtils"),W=this.order==="left",K=N.getSelectionAffectedTableCells(V),G=N.getColumnIndexes(K),Z=W?G.first:G.last,Y=K[0].findAncestor("table");N.insertColumns(Y,{columns:1,at:W?Z:Z+1})}}class SplitCellCommand extends Command{constructor(t,V={}){super(t);ee(this,"direction");this.direction=V.direction||"horizontally"}refresh(){const V=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=V.length===1}execute(){const t=this.editor.plugins.get("TableUtils"),V=t.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];this.direction==="horizontally"?t.splitCellHorizontally(V,2):t.splitCellVertically(V,2)}}function cropTableToDimensions(H,B,t){const{startRow:V,startColumn:N,endRow:W,endColumn:K}=B,G=t.createElement("table"),Z=W-V+1;for(let X=0;X<Z;X++)t.insertElement("tableRow",G,"end");const Y=[...new TableWalker(H,{startRow:V,endRow:W,startColumn:N,endColumn:K,includeAllSlots:!0})];for(const{row:X,column:Q,cell:te,isAnchor:ie,cellAnchorRow:ne,cellAnchorColumn:le}of Y){const ae=X-V,de=G.getChild(ae);if(!ie)(ne<V||le<N)&&createEmptyTableCell(t,t.createPositionAt(de,"end"));else{const ce=t.cloneElement(te);t.append(ce,de),trimTableCellIfNeeded(ce,X,Q,W,K,t)}}return addHeadingsToCroppedTable(G,H,V,N,t),G}function getVerticallyOverlappingCells(H,B,t=0){const V=[],N=new TableWalker(H,{startRow:t,endRow:B-1});for(const W of N){const{row:K,cellHeight:G}=W,Z=K+G-1;K<B&&B<=Z&&V.push(W)}return V}function splitHorizontally(H,B,t){const V=H.parent,N=V.parent,W=V.index,K=parseInt(H.getAttribute("rowspan")),G=B-W,Z={},Y=K-G;Y>1&&(Z.rowspan=Y);const X=parseInt(H.getAttribute("colspan")||"1");X>1&&(Z.colspan=X);const Q=W,te=Q+G,ie=[...new TableWalker(N,{startRow:Q,endRow:te,includeAllSlots:!0})];let ne=null,le;for(const ae of ie){const{row:de,column:ce,cell:we}=ae;we===H&&le===void 0&&(le=ce),le!==void 0&&le===ce&&de===te&&(ne=createEmptyTableCell(t,ae.getPositionBefore(),Z))}return updateNumericAttribute("rowspan",G,H,t),ne}function getHorizontallyOverlappingCells(H,B){const t=[],V=new TableWalker(H);for(const N of V){const{column:W,cellWidth:K}=N,G=W+K-1;W<B&&B<=G&&t.push(N)}return t}function splitVertically(H,B,t,V){const N=parseInt(H.getAttribute("colspan")),W=t-B,K={},G=N-W;G>1&&(K.colspan=G);const Z=parseInt(H.getAttribute("rowspan")||"1");Z>1&&(K.rowspan=Z);const Y=createEmptyTableCell(V,V.createPositionAfter(H),K);return updateNumericAttribute("colspan",W,H,V),Y}function trimTableCellIfNeeded(H,B,t,V,N,W){const K=parseInt(H.getAttribute("colspan")||"1"),G=parseInt(H.getAttribute("rowspan")||"1");if(t+K-1>N){const X=N-t+1;updateNumericAttribute("colspan",X,H,W,1)}if(B+G-1>V){const X=V-B+1;updateNumericAttribute("rowspan",X,H,W,1)}}function addHeadingsToCroppedTable(H,B,t,V,N){const W=parseInt(B.getAttribute("headingRows")||"0");if(W>0){const G=W-t;updateNumericAttribute("headingRows",G,H,N,0)}const K=parseInt(B.getAttribute("headingColumns")||"0");if(K>0){const G=K-V;updateNumericAttribute("headingColumns",G,H,N,0)}}function removeEmptyColumns(H,B){const t=B.getColumns(H),V=new Array(t).fill(0);for(const{column:W}of new TableWalker(H))V[W]++;const N=V.reduce((W,K,G)=>K?W:[...W,G],[]);if(N.length>0){const W=N[N.length-1];return B.removeColumns(H,{at:W}),!0}return!1}function removeEmptyRows(H,B){const t=[],V=B.getRows(H);for(let N=0;N<V;N++)H.getChild(N).isEmpty&&t.push(N);if(t.length>0){const N=t[t.length-1];return B.removeRows(H,{at:N}),!0}return!1}function removeEmptyRowsColumns(H,B){removeEmptyColumns(H,B)||removeEmptyRows(H,B)}function adjustLastRowIndex(H,B){const t=Array.from(new TableWalker(H,{startColumn:B.firstColumn,endColumn:B.lastColumn,row:B.lastRow}));if(t.every(({cellHeight:W})=>W===1))return B.lastRow;const N=t[0].cellHeight-1;return B.lastRow+N}function adjustLastColumnIndex(H,B){const t=Array.from(new TableWalker(H,{startRow:B.firstRow,endRow:B.lastRow,column:B.lastColumn}));if(t.every(({cellWidth:W})=>W===1))return B.lastColumn;const N=t[0].cellWidth-1;return B.lastColumn+N}class MergeCellCommand extends Command{constructor(t,V){super(t);ee(this,"direction");ee(this,"isHorizontal");this.direction=V.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const t=this._getMergeableCell();this.value=t,this.isEnabled=!!t}execute(){const t=this.editor.model,V=t.document,W=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(V.selection)[0],K=this.value,G=this.direction;t.change(Z=>{const Y=G=="right"||G=="down",X=Y?W:K,Q=Y?K:W,te=Q.parent;mergeTableCells$1(Q,X,Z);const ie=this.isHorizontal?"colspan":"rowspan",ne=parseInt(W.getAttribute(ie)||"1"),le=parseInt(K.getAttribute(ie)||"1");Z.setAttribute(ie,ne+le,X),Z.setSelection(Z.createRangeIn(X));const ae=this.editor.plugins.get("TableUtils"),de=te.findAncestor("table");removeEmptyRowsColumns(de,ae)})}_getMergeableCell(){const V=this.editor.model.document,N=this.editor.plugins.get("TableUtils"),W=N.getTableCellsContainingSelection(V.selection)[0];if(!W)return;const K=this.isHorizontal?getHorizontalCell(W,this.direction,N):getVerticalCell(W,this.direction,N);if(!K)return;const G=this.isHorizontal?"rowspan":"colspan",Z=parseInt(W.getAttribute(G)||"1");if(parseInt(K.getAttribute(G)||"1")===Z)return K}}function getHorizontalCell(H,B,t){const N=H.parent.parent,W=B=="right"?H.nextSibling:H.previousSibling,K=(N.getAttribute("headingColumns")||0)>0;if(!W)return;const G=B=="right"?H:W,Z=B=="right"?W:H,{column:Y}=t.getCellLocation(G),{column:X}=t.getCellLocation(Z),Q=parseInt(G.getAttribute("colspan")||"1"),te=isHeadingColumnCell(t,G),ie=isHeadingColumnCell(t,Z);return K&&te!=ie?void 0:Y+Q===X?W:void 0}function getVerticalCell(H,B,t){const V=H.parent,N=V.parent,W=N.getChildIndex(V);if(B=="down"&&W===t.getRows(N)-1||B=="up"&&W===0)return null;const K=parseInt(H.getAttribute("rowspan")||"1"),G=N.getAttribute("headingRows")||0,Z=B=="down"&&W+K===G,Y=B=="up"&&W===G;if(G&&(Z||Y))return null;const X=parseInt(H.getAttribute("rowspan")||"1"),Q=B=="down"?W+X:W,te=[...new TableWalker(N,{endRow:Q})],ne=te.find(ae=>ae.cell===H).column,le=te.find(({row:ae,cellHeight:de,column:ce})=>ce!==ne?!1:B=="down"?ae===Q:Q===ae+de);return le&&le.cell?le.cell:null}function mergeTableCells$1(H,B,t){isEmpty$2(H)||(isEmpty$2(B)&&t.remove(t.createRangeIn(B)),t.move(t.createRangeIn(H),t.createPositionAt(B,"end"))),t.remove(H)}function isEmpty$2(H){const B=H.getChild(0);return H.childCount==1&&B.is("element","paragraph")&&B.isEmpty}class RemoveRowCommand extends Command{refresh(){const B=this.editor.plugins.get("TableUtils"),t=B.getSelectionAffectedTableCells(this.editor.model.document.selection),V=t[0];if(V){const N=V.findAncestor("table"),K=B.getRows(N)-1,G=B.getRowIndexes(t),Z=G.first===0&&G.last===K;this.isEnabled=!Z}else this.isEnabled=!1}execute(){const B=this.editor.model,t=this.editor.plugins.get("TableUtils"),V=t.getSelectionAffectedTableCells(B.document.selection),N=t.getRowIndexes(V),W=V[0],K=W.findAncestor("table"),G=t.getCellLocation(W).column;B.change(Z=>{const Y=N.last-N.first+1;t.removeRows(K,{at:N.first,rows:Y});const X=getCellToFocus$1(K,N.first,G,t.getRows(K));Z.setSelection(Z.createPositionAt(X,0))})}}function getCellToFocus$1(H,B,t,V){const N=H.getChild(Math.min(B,V-1));let W=N.getChild(0),K=0;for(const G of N.getChildren()){if(K>t)return W;W=G,K+=parseInt(G.getAttribute("colspan")||"1")}return W}class RemoveColumnCommand extends Command{refresh(){const B=this.editor.plugins.get("TableUtils"),t=B.getSelectionAffectedTableCells(this.editor.model.document.selection),V=t[0];if(V){const N=V.findAncestor("table"),W=B.getColumns(N),{first:K,last:G}=B.getColumnIndexes(t);this.isEnabled=G-K<W-1}else this.isEnabled=!1}execute(){const B=this.editor.plugins.get("TableUtils"),[t,V]=getBoundaryCells(this.editor.model.document.selection,B),N=t.parent.parent,W=[...new TableWalker(N)],K={first:W.find(Z=>Z.cell===t).column,last:W.find(Z=>Z.cell===V).column},G=getCellToFocus(W,t,V,K);this.editor.model.change(Z=>{const Y=K.last-K.first+1;B.removeColumns(N,{at:K.first,columns:Y}),Z.setSelection(Z.createPositionAt(G,0))})}}function getCellToFocus(H,B,t,V){return parseInt(t.getAttribute("colspan")||"1")>1?t:B.previousSibling||t.nextSibling?t.nextSibling||B.previousSibling:V.first?H.reverse().find(({column:W})=>W<V.first).cell:H.reverse().find(({column:W})=>W>V.last).cell}function getBoundaryCells(H,B){const t=B.getSelectionAffectedTableCells(H),V=t[0],N=t.pop(),W=[V,N];return V.isBefore(N)?W:W.reverse()}class SetHeaderRowCommand extends Command{refresh(){const B=this.editor.plugins.get("TableUtils"),t=this.editor.model,V=B.getSelectionAffectedTableCells(t.document.selection),N=V.length>0;this.isEnabled=N,this.value=N&&V.every(W=>this._isInHeading(W,W.parent.parent))}execute(B={}){if(B.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),V=this.editor.model,N=t.getSelectionAffectedTableCells(V.document.selection),W=N[0].findAncestor("table"),{first:K,last:G}=t.getRowIndexes(N),Z=this.value?K:G+1,Y=W.getAttribute("headingRows")||0;V.change(X=>{if(Z){const Q=Z>Y?Y:0,te=getVerticallyOverlappingCells(W,Z,Q);for(const{cell:ie}of te)splitHorizontally(ie,Z,X)}updateNumericAttribute("headingRows",Z,W,X,0)})}_isInHeading(B,t){const V=parseInt(t.getAttribute("headingRows")||"0");return!!V&&B.parent.index<V}}class SetHeaderColumnCommand extends Command{refresh(){const B=this.editor.model,t=this.editor.plugins.get("TableUtils"),V=t.getSelectionAffectedTableCells(B.document.selection),N=V.length>0;this.isEnabled=N,this.value=N&&V.every(W=>isHeadingColumnCell(t,W))}execute(B={}){if(B.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),V=this.editor.model,N=t.getSelectionAffectedTableCells(V.document.selection),W=N[0].findAncestor("table"),{first:K,last:G}=t.getColumnIndexes(N),Z=this.value?K:G+1;V.change(Y=>{if(Z){const X=getHorizontallyOverlappingCells(W,Z);for(const{cell:Q,column:te}of X)splitVertically(Q,te,Z,Y)}updateNumericAttribute("headingColumns",Z,W,Y,0)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const COLUMN_MIN_WIDTH_AS_PERCENTAGE=5,COLUMN_MIN_WIDTH_IN_PIXELS=40,COLUMN_WIDTH_PRECISION=2;function getChangedResizedTables(H){const B=new Set;for(const t of H.document.differ.getChanges()){let V=null;switch(t.type){case"insert":V=["table","tableRow","tableCell"].includes(t.name)?t.position:null;break;case"remove":V=["tableRow","tableCell"].includes(t.name)?t.position:null;break;case"attribute":t.range.start.nodeAfter&&(V=["table","tableRow","tableCell"].includes(t.range.start.nodeAfter.name)?t.range.start:null);break}if(!V)continue;const N=V.nodeAfter&&V.nodeAfter.is("element","table")?V.nodeAfter:V.findAncestor("table");for(const W of H.createRangeOn(N).getItems())W.is("element","table")&&getColumnGroupElement(W)&&B.add(W)}return B}function getColumnMinWidthAsPercentage(H,B){return COLUMN_MIN_WIDTH_IN_PIXELS*100/getTableWidthInPixels(H,B)}function getTableWidthInPixels(H,B){const t=getChildrenViewElement(H,"tbody",B)||getChildrenViewElement(H,"thead",B),V=B.editing.view.domConverter.mapViewToDom(t);return getElementWidthInPixels(V)}function getChildrenViewElement(H,B,t){return[...[...t.editing.mapper.toViewElement(H).getChildren()].find(W=>W.is("element","table")).getChildren()].find(W=>W.is("element",B))}function getElementWidthInPixels(H){const B=global$1.window.getComputedStyle(H);return B.boxSizing==="border-box"?parseFloat(B.width)-parseFloat(B.paddingLeft)-parseFloat(B.paddingRight)-parseFloat(B.borderLeftWidth)-parseFloat(B.borderRightWidth):parseFloat(B.width)}function getColumnEdgesIndexes(H,B){const t=B.getCellLocation(H).column,V=H.getAttribute("colspan")||1;return{leftEdge:t,rightEdge:t+V-1}}function toPrecision(H){const B=Math.pow(10,COLUMN_WIDTH_PRECISION),t=typeof H=="number"?H:parseFloat(H);return Math.round(t*B)/B}function clamp(H,B,t){return H<=B?toPrecision(B):H>=t?toPrecision(t):toPrecision(H)}function createFilledArray(H,B){return Array(H).fill(B)}function sumArray(H){return H.map(B=>typeof B=="number"?B:parseFloat(B)).filter(B=>!Number.isNaN(B)).reduce((B,t)=>B+t,0)}function normalizeColumnWidths(H){const B=H.map(N=>N==="auto"?N:parseFloat(N.replace("%","")));let t=calculateMissingColumnWidths(B);const V=sumArray(t);return V!==100&&(t=t.map(N=>toPrecision(N*100/V)).map((N,W,K)=>{if(!(W===K.length-1))return N;const Z=sumArray(K);return toPrecision(N+100-Z)})),t.map(N=>N+"%")}function calculateMissingColumnWidths(H){const B=H.filter(N=>N==="auto").length;if(B===0)return H.map(N=>toPrecision(N));const t=sumArray(H),V=Math.max((100-t)/B,COLUMN_MIN_WIDTH_AS_PERCENTAGE);return H.map(N=>N==="auto"?V:N).map(N=>toPrecision(N))}function getDomCellOuterWidth(H){const B=global$1.window.getComputedStyle(H);return B.boxSizing==="border-box"?parseInt(B.width):parseFloat(B.width)+parseFloat(B.paddingLeft)+parseFloat(B.paddingRight)+parseFloat(B.borderWidth)}function updateColumnElements(H,B,t,V){for(let N=0;N<Math.max(t.length,H.length);N++){const W=H[N],K=t[N];K?W?V.setAttribute("columnWidth",K,W):V.appendElement("tableColumn",{columnWidth:K},B):V.remove(W)}}function getColumnGroupElement(H){if(H.is("element","tableColumnGroup"))return H;const B=H.getChildren();return Array.from(B).find(t=>t.is("element","tableColumnGroup"))}function getTableColumnElements(H){const B=getColumnGroupElement(H);return B?Array.from(B.getChildren()):[]}function getTableColumnsWidths(H){return getTableColumnElements(H).map(B=>B.getAttribute("columnWidth"))}function translateColSpanAttribute(H,B){return getTableColumnElements(H).reduce((V,N)=>{const W=N.getAttribute("columnWidth"),K=N.getAttribute("colSpan");if(!K)return V.push(W),V;for(let G=0;G<K;G++)V.push(W);return B.removeAttribute("colSpan",N),V},[])}class TableUtils extends Plugin{static get pluginName(){return"TableUtils"}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(B){const t=B.parent,V=t.parent,N=V.getChildIndex(t),W=new TableWalker(V,{row:N});for(const{cell:K,row:G,column:Z}of W)if(K===B)return{row:G,column:Z};/* istanbul ignore next -- @preserve */}createTable(B,t){const V=B.createElement("table"),N=t.rows||2,W=t.columns||2;return createEmptyRows(B,V,0,N,W),t.headingRows&&updateNumericAttribute("headingRows",Math.min(t.headingRows,N),V,B,0),t.headingColumns&&updateNumericAttribute("headingColumns",Math.min(t.headingColumns,W),V,B,0),V}insertRows(B,t={}){const V=this.editor.model,N=t.at||0,W=t.rows||1,K=t.copyStructureFromAbove!==void 0,G=t.copyStructureFromAbove?N-1:N,Z=this.getRows(B),Y=this.getColumns(B);if(N>Z)throw new CKEditorError("tableutils-insertrows-insert-out-of-range",this,{options:t});V.change(X=>{const Q=B.getAttribute("headingRows")||0;if(Q>N&&updateNumericAttribute("headingRows",Q+W,B,X,0),!K&&(N===0||N===Z)){createEmptyRows(X,B,N,W,Y);return}const te=K?Math.max(N,G):N,ie=new TableWalker(B,{endRow:te}),ne=new Array(Y).fill(1);for(const{row:le,column:ae,cellHeight:de,cellWidth:ce,cell:we}of ie){const be=le+de-1,ge=le<N&&N<=be,Ce=le<=G&&G<=be;ge?(X.setAttribute("rowspan",de+W,we),ne[ae]=-ce):K&&Ce&&(ne[ae]=ce)}for(let le=0;le<W;le++){const ae=X.createElement("tableRow");X.insert(ae,B,N);for(let de=0;de<ne.length;de++){const ce=ne[de],we=X.createPositionAt(ae,"end");ce>0&&createEmptyTableCell(X,we,ce>1?{colspan:ce}:void 0),de+=Math.abs(ce)-1}}})}insertColumns(B,t={}){const V=this.editor.model,N=t.at||0,W=t.columns||1;V.change(K=>{const G=B.getAttribute("headingColumns");N<G&&K.setAttribute("headingColumns",G+W,B);const Z=this.getColumns(B);if(N===0||Z===N){for(const X of B.getChildren())X.is("element","tableRow")&&createCells(W,K,K.createPositionAt(X,N?"end":0));return}const Y=new TableWalker(B,{column:N,includeAllSlots:!0});for(const X of Y){const{row:Q,cell:te,cellAnchorColumn:ie,cellAnchorRow:ne,cellWidth:le,cellHeight:ae}=X;if(ie<N){K.setAttribute("colspan",le+W,te);const de=ne+ae-1;for(let ce=Q;ce<=de;ce++)Y.skipRow(ce)}else createCells(W,K,X.getPositionBefore())}})}removeRows(B,t){const V=this.editor.model,N=t.rows||1,W=this.getRows(B),K=t.at,G=K+N-1;if(G>W-1)throw new CKEditorError("tableutils-removerows-row-index-out-of-range",this,{table:B,options:t});V.change(Z=>{const Y={first:K,last:G},{cellsToMove:X,cellsToTrim:Q}=getCellsToMoveAndTrimOnRemoveRow(B,Y);if(X.size){const te=G+1;moveCellsToRow(B,te,X,Z)}for(let te=G;te>=K;te--)Z.remove(B.getChild(te));for(const{rowspan:te,cell:ie}of Q)updateNumericAttribute("rowspan",te,ie,Z);updateHeadingRows(B,Y,Z),removeEmptyColumns(B,this)||removeEmptyRows(B,this)})}removeColumns(B,t){const V=this.editor.model,N=t.at,W=t.columns||1,K=t.at+W-1;V.change(G=>{adjustHeadingColumns(B,{first:N,last:K},G);const Z=getTableColumnElements(B);for(let Y=K;Y>=N;Y--){for(const{cell:X,column:Q,cellWidth:te}of[...new TableWalker(B)])Q<=Y&&te>1&&Q+te>Y?updateNumericAttribute("colspan",te-1,X,G):Q===Y&&G.remove(X);if(Z[Y]){const X=Y===0?Z[1]:Z[Y-1],Q=parseFloat(Z[Y].getAttribute("columnWidth")),te=parseFloat(X.getAttribute("columnWidth"));G.remove(Z[Y]),G.setAttribute("columnWidth",Q+te+"%",X)}}removeEmptyRows(B,this)||removeEmptyColumns(B,this)})}splitCellVertically(B,t=2){const V=this.editor.model,W=B.parent.parent,K=parseInt(B.getAttribute("rowspan")||"1"),G=parseInt(B.getAttribute("colspan")||"1");V.change(Z=>{if(G>1){const{newCellsSpan:Y,updatedSpan:X}=breakSpanEvenly(G,t);updateNumericAttribute("colspan",X,B,Z);const Q={};Y>1&&(Q.colspan=Y),K>1&&(Q.rowspan=K);const te=G>t?t-1:G-1;createCells(te,Z,Z.createPositionAfter(B),Q)}if(G<t){const Y=t-G,X=[...new TableWalker(W)],{column:Q}=X.find(({cell:le})=>le===B),te=X.filter(({cell:le,cellWidth:ae,column:de})=>{const ce=le!==B&&de===Q,we=de<Q&&de+ae>Q;return ce||we});for(const{cell:le,cellWidth:ae}of te)Z.setAttribute("colspan",ae+Y,le);const ie={};K>1&&(ie.rowspan=K),createCells(Y,Z,Z.createPositionAfter(B),ie);const ne=W.getAttribute("headingColumns")||0;ne>Q&&updateNumericAttribute("headingColumns",ne+Y,W,Z)}})}splitCellHorizontally(B,t=2){const V=this.editor.model,N=B.parent,W=N.parent,K=W.getChildIndex(N),G=parseInt(B.getAttribute("rowspan")||"1"),Z=parseInt(B.getAttribute("colspan")||"1");V.change(Y=>{if(G>1){const X=[...new TableWalker(W,{startRow:K,endRow:K+G-1,includeAllSlots:!0})],{newCellsSpan:Q,updatedSpan:te}=breakSpanEvenly(G,t);updateNumericAttribute("rowspan",te,B,Y);const{column:ie}=X.find(({cell:ae})=>ae===B),ne={};Q>1&&(ne.rowspan=Q),Z>1&&(ne.colspan=Z);let le=0;for(const ae of X){const{column:de,row:ce}=ae,we=ce>=K+te,be=de===ie;le>=Q&&be&&(le=0),we&&be&&(le||createCells(1,Y,ae.getPositionBefore(),ne),le++)}}if(G<t){const X=t-G,Q=[...new TableWalker(W,{startRow:0,endRow:K})];for(const{cell:ne,cellHeight:le,row:ae}of Q)if(ne!==B&&ae+le>K){const de=le+X;Y.setAttribute("rowspan",de,ne)}const te={};Z>1&&(te.colspan=Z),createEmptyRows(Y,W,K+1,X,1,te);const ie=W.getAttribute("headingRows")||0;ie>K&&updateNumericAttribute("headingRows",ie+X,W,Y)}})}getColumns(B){return[...B.getChild(0).getChildren()].filter(V=>V.is("element","tableCell")).reduce((V,N)=>{const W=parseInt(N.getAttribute("colspan")||"1");return V+W},0)}getRows(B){return Array.from(B.getChildren()).reduce((t,V)=>V.is("element","tableRow")?t+1:t,0)}createTableWalker(B,t={}){return new TableWalker(B,t)}getSelectedTableCells(B){const t=[];for(const V of this.sortRanges(B.getRanges())){const N=V.getContainedElement();N&&N.is("element","tableCell")&&t.push(N)}return t}getTableCellsContainingSelection(B){const t=[];for(const V of B.getRanges()){const N=V.start.findAncestor("tableCell");N&&t.push(N)}return t}getSelectionAffectedTableCells(B){const t=this.getSelectedTableCells(B);return t.length?t:this.getTableCellsContainingSelection(B)}getRowIndexes(B){const t=B.map(V=>V.parent.index);return this._getFirstLastIndexesObject(t)}getColumnIndexes(B){const t=B[0].findAncestor("table"),N=[...new TableWalker(t)].filter(W=>B.includes(W.cell)).map(W=>W.column);return this._getFirstLastIndexesObject(N)}isSelectionRectangular(B){if(B.length<2||!this._areCellInTheSameTableSection(B))return!1;const t=new Set,V=new Set;let N=0;for(const K of B){const{row:G,column:Z}=this.getCellLocation(K),Y=parseInt(K.getAttribute("rowspan"))||1,X=parseInt(K.getAttribute("colspan"))||1;t.add(G),V.add(Z),Y>1&&t.add(G+Y-1),X>1&&V.add(Z+X-1),N+=Y*X}return getBiggestRectangleArea(t,V)==N}sortRanges(B){return Array.from(B).sort(compareRangeOrder)}_getFirstLastIndexesObject(B){const t=B.sort((W,K)=>W-K),V=t[0],N=t[t.length-1];return{first:V,last:N}}_areCellInTheSameTableSection(B){const t=B[0].findAncestor("table"),V=this.getRowIndexes(B),N=parseInt(t.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(V,N))return!1;const W=this.getColumnIndexes(B),K=parseInt(t.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(W,K)}_areIndexesInSameSection({first:B,last:t},V){const N=B<V,W=t<V;return N===W}}function createEmptyRows(H,B,t,V,N,W={}){for(let K=0;K<V;K++){const G=H.createElement("tableRow");H.insert(G,B,t),createCells(N,H,H.createPositionAt(G,"end"),W)}}function createCells(H,B,t,V={}){for(let N=0;N<H;N++)createEmptyTableCell(B,t,V)}function breakSpanEvenly(H,B){if(H<B)return{newCellsSpan:1,updatedSpan:1};const t=Math.floor(H/B),V=H-t*B+t;return{newCellsSpan:t,updatedSpan:V}}function adjustHeadingColumns(H,B,t){const V=H.getAttribute("headingColumns")||0;if(V&&B.first<V){const N=Math.min(V-1,B.last)-B.first+1;t.setAttribute("headingColumns",V-N,H)}}function updateHeadingRows(H,{first:B,last:t},V){const N=H.getAttribute("headingRows")||0;if(B<N){const W=t<N?N-(t-B+1):B;updateNumericAttribute("headingRows",W,H,V,0)}}function getCellsToMoveAndTrimOnRemoveRow(H,{first:B,last:t}){const V=new Map,N=[];for(const{row:W,column:K,cellHeight:G,cell:Z}of new TableWalker(H,{endRow:t})){const Y=W+G-1;if(W>=B&&W<=t&&Y>t){const te=t-W+1,ie=G-te;V.set(K,{cell:Z,rowspan:ie})}if(W<B&&Y>=B){let te;Y>=t?te=t-B+1:te=Y-B+1,N.push({cell:Z,rowspan:G-te})}}return{cellsToMove:V,cellsToTrim:N}}function moveCellsToRow(H,B,t,V){const W=[...new TableWalker(H,{includeAllSlots:!0,row:B})],K=H.getChild(B);let G;for(const{column:Z,cell:Y,isAnchor:X}of W)if(t.has(Z)){const{cell:Q,rowspan:te}=t.get(Z),ie=G?V.createPositionAfter(G):V.createPositionAt(K,0);V.move(V.createRangeOn(Q),ie),updateNumericAttribute("rowspan",te,Q,V),G=Q}else X&&(G=Y)}function compareRangeOrder(H,B){const t=H.start,V=B.start;return t.isBefore(V)?-1:1}function getBiggestRectangleArea(H,B){const t=Array.from(H.values()),V=Array.from(B.values()),N=Math.max(...t),W=Math.min(...t),K=Math.max(...V),G=Math.min(...V);return(N-W+1)*(K-G+1)}class MergeCellsCommand extends Command{refresh(){const B=this.editor.plugins.get(TableUtils),t=B.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=B.isSelectionRectangular(t)}execute(){const B=this.editor.model,t=this.editor.plugins.get(TableUtils);B.change(V=>{const N=t.getSelectedTableCells(B.document.selection),W=N.shift(),{mergeWidth:K,mergeHeight:G}=getMergeDimensions(W,N,t);updateNumericAttribute("colspan",K,W,V),updateNumericAttribute("rowspan",G,W,V);for(const Y of N)mergeTableCells(Y,W,V);const Z=W.findAncestor("table");removeEmptyRowsColumns(Z,t),V.setSelection(W,"in")})}}function mergeTableCells(H,B,t){isEmpty$1(H)||(isEmpty$1(B)&&t.remove(t.createRangeIn(B)),t.move(t.createRangeIn(H),t.createPositionAt(B,"end"))),t.remove(H)}function isEmpty$1(H){const B=H.getChild(0);return H.childCount==1&&B.is("element","paragraph")&&B.isEmpty}function getMergeDimensions(H,B,t){let V=0,N=0;for(const Y of B){const{row:X,column:Q}=t.getCellLocation(Y);V=getMaxOffset(Y,Q,V,"colspan"),N=getMaxOffset(Y,X,N,"rowspan")}const{row:W,column:K}=t.getCellLocation(H),G=V-K,Z=N-W;return{mergeWidth:G,mergeHeight:Z}}function getMaxOffset(H,B,t,V){const N=parseInt(H.getAttribute(V)||"1");return Math.max(t,B+N)}class SelectRowCommand extends Command{constructor(B){super(B),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const B=this.editor.model,t=this.editor.plugins.get("TableUtils"),V=t.getSelectionAffectedTableCells(B.document.selection),N=t.getRowIndexes(V),W=V[0].findAncestor("table"),K=[];for(let G=N.first;G<=N.last;G++)for(const Z of W.getChild(G).getChildren())K.push(B.createRangeOn(Z));B.change(G=>{G.setSelection(K)})}}class SelectColumnCommand extends Command{constructor(B){super(B),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const B=this.editor.plugins.get("TableUtils"),t=this.editor.model,V=B.getSelectionAffectedTableCells(t.document.selection),N=V[0],W=V.pop(),K=N.findAncestor("table"),G=B.getCellLocation(N),Z=B.getCellLocation(W),Y=Math.min(G.column,Z.column),X=Math.max(G.column,Z.column),Q=[];for(const te of new TableWalker(K,{startColumn:Y,endColumn:X}))Q.push(t.createRangeOn(te.cell));t.change(te=>{te.setSelection(Q)})}}function injectTableLayoutPostFixer(H){H.document.registerPostFixer(B=>tableLayoutPostFixer(B,H))}function tableLayoutPostFixer(H,B){const t=B.document.differ.getChanges();let V=!1;const N=new Set;for(const W of t){let K=null;W.type=="insert"&&W.name=="table"&&(K=W.position.nodeAfter),(W.type=="insert"||W.type=="remove")&&(W.name=="tableRow"||W.name=="tableCell")&&(K=W.position.findAncestor("table")),isTableAttributeEntry(W)&&(K=W.range.start.findAncestor("table")),K&&!N.has(K)&&(V=fixTableCellsRowspan(K,H)||V,V=fixTableRowsSizes(K,H)||V,N.add(K))}return V}function fixTableCellsRowspan(H,B){let t=!1;const V=findCellsToTrim(H);if(V.length){t=!0;for(const N of V)updateNumericAttribute("rowspan",N.rowspan,N.cell,B,1)}return t}function fixTableRowsSizes(H,B){let t=!1;const V=getChildrenLengths(H),N=[];for(const[Z,Y]of V.entries())!Y&&H.getChild(Z).is("element","tableRow")&&N.push(Z);if(N.length){t=!0;for(const Z of N.reverse())B.remove(H.getChild(Z)),V.splice(Z,1)}const W=V.filter((Z,Y)=>H.getChild(Y).is("element","tableRow")),K=W[0];if(!W.every(Z=>Z===K)){const Z=W.reduce((Y,X)=>X>Y?X:Y,0);for(const[Y,X]of W.entries()){const Q=Z-X;if(Q){for(let te=0;te<Q;te++)createEmptyTableCell(B,B.createPositionAt(H.getChild(Y),"end"));t=!0}}}return t}function findCellsToTrim(H){const B=parseInt(H.getAttribute("headingRows")||"0"),t=Array.from(H.getChildren()).reduce((N,W)=>W.is("element","tableRow")?N+1:N,0),V=[];for(const{row:N,cell:W,cellHeight:K}of new TableWalker(H)){if(K<2)continue;const Z=N<B?B:t;if(N+K>Z){const Y=Z-N;V.push({cell:W,rowspan:Y})}}return V}function getChildrenLengths(H){const B=new Array(H.childCount).fill(0);for(const{rowIndex:t}of new TableWalker(H,{includeAllSlots:!0}))B[t]++;return B}function isTableAttributeEntry(H){if(H.type!=="attribute")return!1;const B=H.attributeKey;return B==="headingRows"||B==="colspan"||B==="rowspan"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function injectTableCellParagraphPostFixer(H){H.document.registerPostFixer(B=>tableCellContentsPostFixer(B,H))}function tableCellContentsPostFixer(H,B){const t=B.document.differ.getChanges();let V=!1;for(const N of t)N.type=="insert"&&N.name=="table"&&(V=fixTable(N.position.nodeAfter,H)||V),N.type=="insert"&&N.name=="tableRow"&&(V=fixTableRow(N.position.nodeAfter,H)||V),N.type=="insert"&&N.name=="tableCell"&&(V=fixTableCellContent(N.position.nodeAfter,H)||V),(N.type=="remove"||N.type=="insert")&&checkTableCellChange(N)&&(V=fixTableCellContent(N.position.parent,H)||V);return V}function fixTable(H,B){let t=!1;for(const V of H.getChildren())V.is("element","tableRow")&&(t=fixTableRow(V,B)||t);return t}function fixTableRow(H,B){let t=!1;for(const V of H.getChildren())t=fixTableCellContent(V,B)||t;return t}function fixTableCellContent(H,B){if(H.childCount==0)return B.insertElement("paragraph",H),!0;const t=Array.from(H.getChildren()).filter(V=>V.is("$text"));for(const V of t)B.wrap(B.createRangeOn(V),"paragraph");return!!t.length}function checkTableCellChange(H){return H.position.parent.is("element","tableCell")?H.type=="insert"&&H.name=="$text"||H.type=="remove":!1}function tableHeadingsRefreshHandler(H,B){const t=H.document.differ;for(const V of t.getChanges()){let N,W=!1;if(V.type=="attribute"){const Y=V.range.start.nodeAfter;if(!Y||!Y.is("element","table")||V.attributeKey!="headingRows"&&V.attributeKey!="headingColumns")continue;N=Y,W=V.attributeKey=="headingRows"}else(V.name=="tableRow"||V.name=="tableCell")&&(N=V.position.findAncestor("table"),W=V.name=="tableRow");if(!N)continue;const K=N.getAttribute("headingRows")||0,G=N.getAttribute("headingColumns")||0,Z=new TableWalker(N);for(const Y of Z){const Q=Y.row<K||Y.column<G?"th":"td",te=B.mapper.toViewElement(Y.cell);te&&te.is("element")&&te.name!=Q&&B.reconvertItem(W?Y.cell.parent:Y.cell)}}}function tableCellRefreshHandler(H,B){const t=H.document.differ,V=new Set;for(const N of t.getChanges()){const W=N.type=="attribute"?N.range.start.parent:N.position.parent;W.is("element","tableCell")&&V.add(W)}for(const N of V.values()){const W=Array.from(N.getChildren()).filter(K=>shouldRefresh(K,B.mapper));for(const K of W)B.reconvertItem(K)}}function shouldRefresh(H,B){if(!H.is("element","paragraph"))return!1;const t=B.toViewElement(H);return t?isSingleParagraphWithoutAttributes(H)!==t.is("element","span"):!1}class TableEditing extends Plugin{constructor(t){super(t);ee(this,"_additionalSlots");this._additionalSlots=[]}static get pluginName(){return"TableEditing"}static get requires(){return[TableUtils]}init(){const t=this.editor,V=t.model,N=V.schema,W=t.conversion,K=t.plugins.get(TableUtils);N.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),N.register("tableRow",{allowIn:"table",isLimit:!0}),N.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),W.for("upcast").add(upcastTableFigure()),W.for("upcast").add(upcastTable()),W.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:downcastTable(K,{asWidget:!0,additionalSlots:this._additionalSlots})}),W.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:downcastTable(K,{additionalSlots:this._additionalSlots})}),W.for("upcast").elementToElement({model:"tableRow",view:"tr"}),W.for("upcast").add(skipEmptyTableRow()),W.for("downcast").elementToElement({model:"tableRow",view:downcastRow()}),W.for("upcast").elementToElement({model:"tableCell",view:"td"}),W.for("upcast").elementToElement({model:"tableCell",view:"th"}),W.for("upcast").add(ensureParagraphInTableCell("td")),W.for("upcast").add(ensureParagraphInTableCell("th")),W.for("editingDowncast").elementToElement({model:"tableCell",view:downcastCell({asWidget:!0})}),W.for("dataDowncast").elementToElement({model:"tableCell",view:downcastCell()}),W.for("editingDowncast").elementToElement({model:"paragraph",view:convertParagraphInTableCell({asWidget:!0}),converterPriority:"high"}),W.for("dataDowncast").elementToElement({model:"paragraph",view:convertParagraphInTableCell(),converterPriority:"high"}),W.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),W.for("upcast").attributeToAttribute({model:{key:"colspan",value:upcastCellSpan("colspan")},view:"colspan"}),W.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),W.for("upcast").attributeToAttribute({model:{key:"rowspan",value:upcastCellSpan("rowspan")},view:"rowspan"}),t.config.define("table.defaultHeadings.rows",0),t.config.define("table.defaultHeadings.columns",0),t.commands.add("insertTable",new InsertTableCommand(t)),t.commands.add("insertTableRowAbove",new InsertRowCommand(t,{order:"above"})),t.commands.add("insertTableRowBelow",new InsertRowCommand(t,{order:"below"})),t.commands.add("insertTableColumnLeft",new InsertColumnCommand(t,{order:"left"})),t.commands.add("insertTableColumnRight",new InsertColumnCommand(t,{order:"right"})),t.commands.add("removeTableRow",new RemoveRowCommand(t)),t.commands.add("removeTableColumn",new RemoveColumnCommand(t)),t.commands.add("splitTableCellVertically",new SplitCellCommand(t,{direction:"vertically"})),t.commands.add("splitTableCellHorizontally",new SplitCellCommand(t,{direction:"horizontally"})),t.commands.add("mergeTableCells",new MergeCellsCommand(t)),t.commands.add("mergeTableCellRight",new MergeCellCommand(t,{direction:"right"})),t.commands.add("mergeTableCellLeft",new MergeCellCommand(t,{direction:"left"})),t.commands.add("mergeTableCellDown",new MergeCellCommand(t,{direction:"down"})),t.commands.add("mergeTableCellUp",new MergeCellCommand(t,{direction:"up"})),t.commands.add("setTableColumnHeader",new SetHeaderColumnCommand(t)),t.commands.add("setTableRowHeader",new SetHeaderRowCommand(t)),t.commands.add("selectTableRow",new SelectRowCommand(t)),t.commands.add("selectTableColumn",new SelectColumnCommand(t)),injectTableLayoutPostFixer(V),injectTableCellParagraphPostFixer(V),this.listenTo(V.document,"change:data",()=>{tableHeadingsRefreshHandler(V,t.editing),tableCellRefreshHandler(V,t.editing)})}registerAdditionalSlot(t){this._additionalSlots.push(t)}}function upcastCellSpan(H){return B=>{const t=parseInt(B.getAttribute(H));return Number.isNaN(t)||t<=0?null:t}}class InsertTableView extends View{constructor(t){super(t);ee(this,"items");ee(this,"keystrokes");ee(this,"focusTracker");const V=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new KeystrokeHandler,this.focusTracker=new FocusTracker,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(N,W)=>`${W} × ${N}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":V.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:V.to("label")}]}],on:{mousedown:V.to(N=>{N.preventDefault()}),click:V.to(()=>{this.fire("execute")})}}),this.on("boxover",(N,W)=>{const{row:K,column:G}=W.target.dataset;this.items.get((parseInt(K,10)-1)*10+(parseInt(G,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(N,W,K)=>{if(!K)return;const{row:G,column:Z}=K.dataset;this.set({rows:parseInt(G),columns:parseInt(Z)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),addKeyboardHandlingForGrid({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const t of this.items)this.focusTracker.add(t.element);this.keystrokes.listenTo(this.element)}reset(){this.set({rows:1,columns:1})}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const t=this.rows,V=this.columns;this.items.map((N,W)=>{const K=Math.floor(W/10),G=W%10,Z=K<t&&G<V;N.set("isOn",Z)})}_createGridButton(t,V,N,W){const K=new ButtonView(t);return K.set({label:W,class:"ck-insert-table-dropdown-grid-box"}),K.extendTemplate({attributes:{"data-row":V,"data-column":N}}),K}_createGridCollection(){const t=[];for(let V=0;V<100;V++){const N=Math.floor(V/10),W=V%10,K=`${N+1} × ${W+1}`;t.push(this._createGridButton(this.locale,N+1,W+1,K))}return this.createCollection(t)}}var tableColumnIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',tableRowIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',tableMergeCellIcon='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';class TableUI extends Plugin{static get pluginName(){return"TableUI"}init(){const B=this.editor,t=this.editor.t,N=B.locale.contentLanguageDirection==="ltr";B.ui.componentFactory.add("insertTable",W=>{const K=B.commands.get("insertTable"),G=createDropdown(W);G.bind("isEnabled").to(K),G.buttonView.set({icon:icons.table,label:t("Insert table"),tooltip:!0});let Z;return G.on("change:isOpen",()=>{Z||(Z=new InsertTableView(W),G.panelView.children.add(Z),Z.delegate("execute").to(G),G.on("execute",()=>{B.execute("insertTable",{rows:Z.rows,columns:Z.columns}),B.editing.view.focus()}))}),G}),B.ui.componentFactory.add("menuBar:insertTable",W=>{const K=B.commands.get("insertTable"),G=new MenuBarMenuView(W),Z=new InsertTableView(W);return Z.delegate("execute").to(G),G.on("change:isOpen",(Y,X,Q)=>{Q||Z.reset()}),Z.on("execute",()=>{B.execute("insertTable",{rows:Z.rows,columns:Z.columns}),B.editing.view.focus()}),G.buttonView.set({label:t("Table"),icon:icons.table}),G.panelView.children.add(Z),G.bind("isEnabled").to(K),G}),B.ui.componentFactory.add("tableColumn",W=>{const K=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:N?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:N?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),tableColumnIcon,K,W)}),B.ui.componentFactory.add("tableRow",W=>{const K=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),tableRowIcon,K,W)}),B.ui.componentFactory.add("mergeTableCells",W=>{const K=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:N?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:N?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),tableMergeCellIcon,K,W)})}_prepareDropdown(B,t,V,N){const W=this.editor,K=createDropdown(N),G=this._fillDropdownWithListOptions(K,V);return K.buttonView.set({label:B,icon:t,tooltip:!0}),K.bind("isEnabled").toMany(G,"isEnabled",(...Z)=>Z.some(Y=>Y)),this.listenTo(K,"execute",Z=>{W.execute(Z.source.commandName),Z.source instanceof SwitchButtonView||W.editing.view.focus()}),K}_prepareMergeSplitButtonDropdown(B,t,V,N){const W=this.editor,K=createDropdown(N,SplitButtonView),G="mergeTableCells",Z=W.commands.get(G),Y=this._fillDropdownWithListOptions(K,V);return K.buttonView.set({label:B,icon:t,tooltip:!0,isEnabled:!0}),K.bind("isEnabled").toMany([Z,...Y],"isEnabled",(...X)=>X.some(Q=>Q)),this.listenTo(K.buttonView,"execute",()=>{W.execute(G),W.editing.view.focus()}),this.listenTo(K,"execute",X=>{W.execute(X.source.commandName),W.editing.view.focus()}),K}_fillDropdownWithListOptions(B,t){const V=this.editor,N=[],W=new Collection;for(const K of t)addListOption(K,V,N,W);return addListToDropdown(B,W),N}}function addListOption(H,B,t,V){if(H.type==="button"||H.type==="switchbutton"){const N=H.model=new Model(H.model),{commandName:W,bindIsOn:K}=H.model,G=B.commands.get(W);t.push(G),N.set({commandName:W}),N.bind("isEnabled").to(G),K&&N.bind("isOn").to(G,"value"),N.set({withText:!0})}V.add(H)}class TableSelection extends Plugin{static get pluginName(){return"TableSelection"}static get requires(){return[TableUtils,TableUtils]}init(){const B=this.editor,t=B.model,V=B.editing.view;this.listenTo(t,"deleteContent",(N,W)=>this._handleDeleteContent(N,W),{priority:"high"}),this.listenTo(V.document,"insertText",(N,W)=>this._handleInsertTextEvent(N,W),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const B=this.editor.plugins.get(TableUtils),t=this.editor.model.document.selection,V=B.getSelectedTableCells(t);return V.length==0?null:V}getSelectionAsFragment(){const B=this.editor.plugins.get(TableUtils),t=this.getSelectedTableCells();return t?this.editor.model.change(V=>{const N=V.createDocumentFragment(),{first:W,last:K}=B.getColumnIndexes(t),{first:G,last:Z}=B.getRowIndexes(t),Y=t[0].findAncestor("table");let X=Z,Q=K;if(B.isSelectionRectangular(t)){const ne={firstColumn:W,lastColumn:K,firstRow:G,lastRow:Z};X=adjustLastRowIndex(Y,ne),Q=adjustLastColumnIndex(Y,ne)}const ie=cropTableToDimensions(Y,{startRow:G,startColumn:W,endRow:X,endColumn:Q},V);return V.insert(ie,N,0),N}):null}setCellSelection(B,t){const V=this._getCellsToSelect(B,t);this.editor.model.change(N=>{N.setSelection(V.cells.map(W=>N.createRangeOn(W)),{backward:V.backward})})}getFocusCell(){const V=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return V&&V.is("element","tableCell")?V:null}getAnchorCell(){const B=this.editor.model.document.selection,V=first(B.getRanges()).getContainedElement();return V&&V.is("element","tableCell")?V:null}_defineSelectionConverter(){const B=this.editor,t=new Set;B.conversion.for("editingDowncast").add(N=>N.on("selection",(W,K,G)=>{const Z=G.writer;V(Z);const Y=this.getSelectedTableCells();if(!Y)return;for(const Q of Y){const te=G.mapper.toViewElement(Q);Z.addClass("ck-editor__editable_selected",te),t.add(te)}const X=G.mapper.toViewElement(Y[Y.length-1]);Z.setSelection(X,0)},{priority:"lowest"}));function V(N){for(const W of t)N.removeClass("ck-editor__editable_selected",W);t.clear()}}_enablePluginDisabling(){const B=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;B.model.change(V=>{const N=V.createPositionAt(t[0],0),W=B.model.schema.getNearestSelectionRange(N);V.setSelection(W)})}})}_handleDeleteContent(B,t){const V=this.editor.plugins.get(TableUtils),N=t[0],W=t[1],K=this.editor.model,G=!W||W.direction=="backward",Z=V.getSelectedTableCells(N);Z.length&&(B.stop(),K.change(Y=>{const X=Z[G?Z.length-1:0];K.change(te=>{for(const ie of Z)K.deleteContent(te.createSelection(ie,"in"))});const Q=K.schema.getNearestSelectionRange(Y.createPositionAt(X,0));N.is("documentSelection")?Y.setSelection(Q):N.setTo(Q)}))}_handleInsertTextEvent(B,t){const V=this.editor,N=this.getSelectedTableCells();if(!N)return;const W=V.editing.view,K=V.editing.mapper,G=N.map(Z=>W.createRangeOn(K.toViewElement(Z)));t.selection=W.createSelection(G)}_getCellsToSelect(B,t){const V=this.editor.plugins.get("TableUtils"),N=V.getCellLocation(B),W=V.getCellLocation(t),K=Math.min(N.row,W.row),G=Math.max(N.row,W.row),Z=Math.min(N.column,W.column),Y=Math.max(N.column,W.column),X=new Array(G-K+1).fill(null).map(()=>[]),Q={startRow:K,endRow:G,startColumn:Z,endColumn:Y};for(const{row:ne,cell:le}of new TableWalker(B.findAncestor("table"),Q))X[ne-K].push(le);const te=W.row<N.row,ie=W.column<N.column;return te&&X.reverse(),ie&&X.forEach(ne=>ne.reverse()),{cells:X.flat(),backward:te||ie}}}class TableClipboard extends Plugin{static get pluginName(){return"TableClipboard"}static get requires(){return[ClipboardMarkersUtils,ClipboardPipeline,TableSelection,TableUtils]}init(){const B=this.editor,t=B.editing.view.document;this.listenTo(t,"copy",(V,N)=>this._onCopyCut(V,N)),this.listenTo(t,"cut",(V,N)=>this._onCopyCut(V,N)),this.listenTo(B.model,"insertContent",(V,[N,W])=>this._onInsertContent(V,N,W),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(B,t){const V=this.editor.editing.view,N=this.editor.plugins.get(TableSelection),W=this.editor.plugins.get(ClipboardMarkersUtils);N.getSelectedTableCells()&&(B.name=="cut"&&!this.editor.model.canEditAt(this.editor.model.document.selection)||(t.preventDefault(),B.stop(),this.editor.model.enqueueChange({isUndoable:B.name==="cut"},()=>{const K=W._copySelectedFragmentWithMarkers(B.name,this.editor.model.document.selection,()=>N.getSelectionAsFragment());V.document.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:this.editor.data.toView(K),method:B.name})})))}_onInsertContent(B,t,V){if(V&&!V.is("documentSelection"))return;const N=this.editor.model,W=this.editor.plugins.get(TableUtils),K=this.editor.plugins.get(ClipboardMarkersUtils),G=this.getTableIfOnlyTableInContent(t,N);if(!G)return;const Z=W.getSelectionAffectedTableCells(N.document.selection);if(!Z.length){removeEmptyRowsColumns(G,W);return}B.stop(),t.is("documentFragment")?K._pasteMarkersIntoTransformedElement(t.markers,Y=>this._replaceSelectedCells(G,Z,Y)):this.editor.model.change(Y=>{this._replaceSelectedCells(G,Z,Y)})}_replaceSelectedCells(B,t,V){const N=this.editor.plugins.get(TableUtils),W={width:N.getColumns(B),height:N.getRows(B)},K=prepareTableForPasting(t,W,V,N),G=K.lastRow-K.firstRow+1,Z=K.lastColumn-K.firstColumn+1,Y={startRow:0,startColumn:0,endRow:Math.min(G,W.height)-1,endColumn:Math.min(Z,W.width)-1};B=cropTableToDimensions(B,Y,V);const X=t[0].findAncestor("table"),Q=this._replaceSelectedCellsWithPasted(B,W,X,K,V);if(this.editor.plugins.get("TableSelection").isEnabled){const te=N.sortRanges(Q.map(ie=>V.createRangeOn(ie)));V.setSelection(te)}else V.setSelection(Q[0],0);return X}_replaceSelectedCellsWithPasted(B,t,V,N,W){const{width:K,height:G}=t,Z=createLocationMap(B,K,G),Y=[...new TableWalker(V,{startRow:N.firstRow,endRow:N.lastRow,startColumn:N.firstColumn,endColumn:N.lastColumn,includeAllSlots:!0})],X=[];let Q;for(const ae of Y){const{row:de,column:ce}=ae;ce===N.firstColumn&&(Q=ae.getPositionBefore());const we=de-N.firstRow,be=ce-N.firstColumn,ge=Z[we%G][be%K],Ce=ge?W.cloneElement(ge):null,he=this._replaceTableSlotCell(ae,Ce,Q,W);he&&(trimTableCellIfNeeded(he,de,ce,N.lastRow,N.lastColumn,W),X.push(he),Q=W.createPositionAfter(he))}const te=parseInt(V.getAttribute("headingRows")||"0"),ie=parseInt(V.getAttribute("headingColumns")||"0"),ne=N.firstRow<te&&te<=N.lastRow,le=N.firstColumn<ie&&ie<=N.lastColumn;if(ne){const ae={first:N.firstColumn,last:N.lastColumn},de=doHorizontalSplit(V,te,ae,W,N.firstRow);X.push(...de)}if(le){const ae={first:N.firstRow,last:N.lastRow},de=doVerticalSplit(V,ie,ae,W);X.push(...de)}return X}_replaceTableSlotCell(B,t,V,N){const{cell:W,isAnchor:K}=B;return K&&N.remove(W),t?(N.insert(t,V),t):null}getTableIfOnlyTableInContent(B,t){if(!B.is("documentFragment")&&!B.is("element"))return null;if(B.is("element","table"))return B;if(B.childCount==1&&B.getChild(0).is("element","table"))return B.getChild(0);const V=t.createRangeIn(B);for(const N of V.getItems())if(N.is("element","table")){const W=t.createRange(V.start,t.createPositionBefore(N));if(t.hasContent(W,{ignoreWhitespaces:!0}))return null;const K=t.createRange(t.createPositionAfter(N),V.end);return t.hasContent(K,{ignoreWhitespaces:!0})?null:N}return null}}function prepareTableForPasting(H,B,t,V){const N=H[0].findAncestor("table"),W=V.getColumnIndexes(H),K=V.getRowIndexes(H),G={firstColumn:W.first,lastColumn:W.last,firstRow:K.first,lastRow:K.last},Z=H.length===1;return Z&&(G.lastRow+=B.height-1,G.lastColumn+=B.width-1,expandTableSize(N,G.lastRow+1,G.lastColumn+1,V)),Z||!V.isSelectionRectangular(H)?splitCellsToRectangularSelection(N,G,t):(G.lastRow=adjustLastRowIndex(N,G),G.lastColumn=adjustLastColumnIndex(N,G)),G}function expandTableSize(H,B,t,V){const N=V.getColumns(H),W=V.getRows(H);t>N&&V.insertColumns(H,{at:N,columns:t-N}),B>W&&V.insertRows(H,{at:W,rows:B-W})}function createLocationMap(H,B,t){const V=new Array(t).fill(null).map(()=>new Array(B).fill(null));for(const{column:N,row:W,cell:K}of new TableWalker(H))V[W][N]=K;return V}function splitCellsToRectangularSelection(H,B,t){const{firstRow:V,lastRow:N,firstColumn:W,lastColumn:K}=B,G={first:V,last:N},Z={first:W,last:K};doVerticalSplit(H,W,G,t),doVerticalSplit(H,K+1,G,t),doHorizontalSplit(H,V,Z,t),doHorizontalSplit(H,N+1,Z,t,V)}function doHorizontalSplit(H,B,t,V,N=0){return B<1?void 0:getVerticallyOverlappingCells(H,B,N).filter(({column:G,cellWidth:Z})=>isAffectedBySelection(G,Z,t)).map(({cell:G})=>splitHorizontally(G,B,V))}function doVerticalSplit(H,B,t,V){return B<1?void 0:getHorizontallyOverlappingCells(H,B).filter(({row:K,cellHeight:G})=>isAffectedBySelection(K,G,t)).map(({cell:K,column:G})=>splitVertically(K,G,B,V))}function isAffectedBySelection(H,B,t){const V=H+B-1,{first:N,last:W}=t,K=H>=N&&H<=W,G=H<N&&V>=N;return K||G}class TableKeyboard extends Plugin{static get pluginName(){return"TableKeyboard"}static get requires(){return[TableSelection,TableUtils]}init(){const B=this.editor,V=B.editing.view.document,N=B.t;this.listenTo(V,"arrowKey",(...W)=>this._onArrowKey(...W),{context:"table"}),this.listenTo(V,"tab",(...W)=>this._handleTabOnSelectedTable(...W),{context:"figure"}),this.listenTo(V,"tab",(...W)=>this._handleTab(...W),{context:["th","td"]}),B.accessibility.addKeystrokeInfoGroup({id:"table",label:N("Keystrokes that can be used in a table cell"),keystrokes:[{label:N("Move the selection to the next cell"),keystroke:"Tab"},{label:N("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:N("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:N("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(B,t){const V=this.editor,W=V.model.document.selection.getSelectedElement();!W||!W.is("element","table")||(t.preventDefault(),t.stopPropagation(),B.stop(),V.model.change(K=>{K.setSelection(K.createRangeIn(W.getChild(0).getChild(0)))}))}_handleTab(B,t){const V=this.editor,N=this.editor.plugins.get(TableUtils),W=this.editor.plugins.get("TableSelection"),K=V.model.document.selection,G=!t.shiftKey;let Z=N.getTableCellsContainingSelection(K)[0];if(Z||(Z=W.getFocusCell()),!Z)return;t.preventDefault(),t.stopPropagation(),B.stop();const Y=Z.parent,X=Y.parent,Q=X.getChildIndex(Y),te=Y.getChildIndex(Z),ie=te===0;if(!G&&ie&&Q===0){V.model.change(de=>{de.setSelection(de.createRangeOn(X))});return}const ne=te===Y.childCount-1,le=Q===N.getRows(X)-1;if(G&&le&&ne&&(V.execute("insertTableRowBelow"),Q===N.getRows(X)-1)){V.model.change(de=>{de.setSelection(de.createRangeOn(X))});return}let ae;if(G&&ne)ae=X.getChild(Q+1).getChild(0);else if(!G&&ie){const de=X.getChild(Q-1);ae=de.getChild(de.childCount-1)}else ae=Y.getChild(te+(G?1:-1));V.model.change(de=>{de.setSelection(de.createRangeIn(ae))})}_onArrowKey(B,t){const V=this.editor,N=t.keyCode,W=getLocalizedArrowKeyCodeDirection(N,V.locale.contentLanguageDirection);this._handleArrowKeys(W,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),B.stop())}_handleArrowKeys(B,t){const V=this.editor.plugins.get(TableUtils),N=this.editor.plugins.get("TableSelection"),W=this.editor.model,K=W.document.selection,G=["right","down"].includes(B),Z=V.getSelectedTableCells(K);if(Z.length){let X;return t?X=N.getFocusCell():X=G?Z[Z.length-1]:Z[0],this._navigateFromCellInDirection(X,B,t),!0}const Y=K.focus.findAncestor("tableCell");/* istanbul ignore if: paranoid check -- @preserve */if(!Y)return!1;if(!K.isCollapsed)if(t){if(K.isBackward==G&&!K.containsEntireContent(Y))return!1}else{const X=K.getSelectedElement();if(!X||!W.schema.isObject(X))return!1}return this._isSelectionAtCellEdge(K,Y,G)?(this._navigateFromCellInDirection(Y,B,t),!0):!1}_isSelectionAtCellEdge(B,t,V){const N=this.editor.model,W=this.editor.model.schema,K=V?B.getLastPosition():B.getFirstPosition();if(!W.getLimitElement(K).is("element","tableCell"))return N.createPositionAt(t,V?"end":0).isTouching(K);const G=N.createSelection(K);return N.modifySelection(G,{direction:V?"forward":"backward"}),K.isEqual(G.focus)}_navigateFromCellInDirection(B,t,V=!1){const N=this.editor.model,W=B.findAncestor("table"),K=[...new TableWalker(W,{includeAllSlots:!0})],{row:G,column:Z}=K[K.length-1],Y=K.find(({cell:ce})=>ce==B);let{row:X,column:Q}=Y;switch(t){case"left":Q--;break;case"up":X--;break;case"right":Q+=Y.cellWidth;break;case"down":X+=Y.cellHeight;break}const te=X<0||X>G,ie=Q<0&&X<=0,ne=Q>Z&&X>=G;if(te||ie||ne){N.change(ce=>{ce.setSelection(ce.createRangeOn(W))});return}Q<0?(Q=V?0:Z,X--):Q>Z&&(Q=V?Z:0,X++);const le=K.find(ce=>ce.row==X&&ce.column==Q).cell,ae=["right","down"].includes(t),de=this.editor.plugins.get("TableSelection");if(V&&de.isEnabled){const ce=de.getAnchorCell()||B;de.setCellSelection(ce,le)}else{const ce=N.createPositionAt(le,ae?0:"end");N.change(we=>{we.setSelection(ce)})}}}class MouseEventsObserver extends DomEventObserver{constructor(){super(...arguments);ee(this,"domEventType",["mousemove","mouseleave"])}onDomEvent(t){this.fire(t.type,t)}}class TableMouse extends Plugin{static get pluginName(){return"TableMouse"}static get requires(){return[TableSelection,TableUtils]}init(){this.editor.editing.view.addObserver(MouseEventsObserver),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const B=this.editor,t=B.plugins.get(TableUtils);let V=!1;const N=B.plugins.get(TableSelection);this.listenTo(B.editing.view.document,"mousedown",(W,K)=>{const G=B.model.document.selection;if(!this.isEnabled||!N.isEnabled||!K.domEvent.shiftKey)return;const Z=N.getAnchorCell()||t.getTableCellsContainingSelection(G)[0];if(!Z)return;const Y=this._getModelTableCellFromDomEvent(K);Y&&haveSameTableParent(Z,Y)&&(V=!0,N.setCellSelection(Z,Y),K.preventDefault())}),this.listenTo(B.editing.view.document,"mouseup",()=>{V=!1}),this.listenTo(B.editing.view.document,"selectionChange",W=>{V&&W.stop()},{priority:"highest"})}_enableMouseDragSelection(){const B=this.editor;let t,V,N=!1,W=!1;const K=B.plugins.get(TableSelection);this.listenTo(B.editing.view.document,"mousedown",(G,Z)=>{!this.isEnabled||!K.isEnabled||Z.domEvent.shiftKey||Z.domEvent.ctrlKey||Z.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(Z))}),this.listenTo(B.editing.view.document,"mousemove",(G,Z)=>{if(!Z.domEvent.buttons||!t)return;const Y=this._getModelTableCellFromDomEvent(Z);Y&&haveSameTableParent(t,Y)&&(V=Y,!N&&V!=t&&(N=!0)),N&&(W=!0,K.setCellSelection(t,V),Z.preventDefault())}),this.listenTo(B.editing.view.document,"mouseup",()=>{N=!1,W=!1,t=null,V=null}),this.listenTo(B.editing.view.document,"selectionChange",G=>{W&&G.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(B){const t=B.target,V=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(V).parent.findAncestor("tableCell",{includeSelf:!0})}}function haveSameTableParent(H,B){return H.parent.parent==B.parent.parent}class Table extends Plugin{static get requires(){return[TableEditing,TableUI,TableSelection,TableMouse,TableKeyboard,TableClipboard,Widget]}static get pluginName(){return"Table"}}function getSelectionAffectedTableWidget(H){const B=getSelectedTableWidget(H);return B||getTableWidgetAncestor(H)}function getSelectedTableWidget(H){const B=H.getSelectedElement();return B&&isTableWidget(B)?B:null}function getTableWidgetAncestor(H){const B=H.getFirstPosition();if(!B)return null;let t=B.parent;for(;t;){if(t.is("element")&&isTableWidget(t))return t;t=t.parent}return null}function isTableWidget(H){return!!H.getCustomProperty("table")&&isWidget(H)}class TableToolbar extends Plugin{static get requires(){return[WidgetToolbarRepository]}static get pluginName(){return"TableToolbar"}afterInit(){const B=this.editor,t=B.t,V=B.plugins.get(WidgetToolbarRepository),N=B.config.get("table.contentToolbar"),W=B.config.get("table.tableToolbar");N&&V.register("tableContent",{ariaLabel:t("Table toolbar"),items:N,getRelatedElement:getTableWidgetAncestor}),W&&V.register("table",{ariaLabel:t("Table toolbar"),items:W,getRelatedElement:getSelectedTableWidget})}}class ColorInputView extends View{constructor(t,V){super(t);ee(this,"options");ee(this,"focusTracker");ee(this,"focusCycler");ee(this,"_focusables");ee(this,"dropdownView");ee(this,"inputView");ee(this,"keystrokes");ee(this,"_stillTyping");this.set("value",""),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isEmpty",!0),this.options=V,this.focusTracker=new FocusTracker,this._focusables=new ViewCollection,this.dropdownView=this._createDropdownView(),this.inputView=this._createInputTextView(),this.keystrokes=new KeystrokeHandler,this._stillTyping=!1,this.focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-input-color"]},children:[this.dropdownView,this.inputView]}),this.on("change:value",(N,W,K)=>this._setInputValue(K))}render(){super.render(),[this.inputView,this.dropdownView.buttonView].forEach(t=>{this.focusTracker.add(t.element),this._focusables.add(t)}),this.keystrokes.listenTo(this.element)}focus(t){t===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createDropdownView(){const t=this.locale,V=t.t,N=this.bindTemplate,W=this._createColorSelector(t),K=createDropdown(t),G=new View;return G.setTemplate({tag:"span",attributes:{class:["ck","ck-input-color__button__preview"],style:{backgroundColor:N.to("value")}},children:[{tag:"span",attributes:{class:["ck","ck-input-color__button__preview__no-color-indicator",N.if("value","ck-hidden",Z=>Z!="")]}}]}),K.buttonView.extendTemplate({attributes:{class:"ck-input-color__button"}}),K.buttonView.children.add(G),K.buttonView.label=V("Color picker"),K.buttonView.tooltip=!0,K.panelPosition=t.uiLanguageDirection==="rtl"?"se":"sw",K.panelView.children.add(W),K.bind("isEnabled").to(this,"isReadOnly",Z=>!Z),K.on("change:isOpen",(Z,Y,X)=>{X&&(W.updateSelectedColors(),W.showColorGridsFragment())}),K}_createInputTextView(){const t=this.locale,V=new InputTextView(t);return V.extendTemplate({on:{blur:V.bindTemplate.to("blur")}}),V.value=this.value,V.bind("isReadOnly","hasError").to(this),this.bind("isFocused","isEmpty").to(V),V.on("input",()=>{const N=V.element.value,W=this.options.colorDefinitions.find(K=>N===K.label);this._stillTyping=!0,this.value=W&&W.color||N}),V.on("blur",()=>{this._stillTyping=!1,this._setInputValue(V.element.value)}),V.delegate("input").to(this),V}_createColorSelector(t){const V=t.t,N=this.options.defaultColorValue||"",W=V(N?"Restore default":"Remove color"),K=new ColorSelectorView(t,{colors:this.options.colorDefinitions,columns:this.options.columns,removeButtonLabel:W,colorPickerLabel:V("Color picker"),colorPickerViewConfig:this.options.colorPickerConfig===!1?!1:{...this.options.colorPickerConfig,hideInput:!0}});K.appendUI(),K.on("execute",(Z,Y)=>{if(Y.source==="colorPickerSaveButton"){this.dropdownView.isOpen=!1;return}this.value=Y.value||N,this.fire("input"),Y.source!=="colorPicker"&&(this.dropdownView.isOpen=!1)});let G=this.value;return K.on("colorPicker:cancel",()=>{this.value=G,this.fire("input"),this.dropdownView.isOpen=!1}),K.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{G=this.value}),K.bind("selectedColor").to(this,"value"),K}_setInputValue(t){if(!this._stillTyping){const V=normalizeColor(t),N=this.options.colorDefinitions.find(W=>V===normalizeColor(W.color));N?this.inputView.value=N.label:this.inputView.value=t||""}}}function normalizeColor(H){return H.replace(/([(,])\s+/g,"$1").replace(/^\s+|\s+(?=[),\s]|$)/g,"").replace(/,|\s/g," ")}const isEmpty=H=>H==="";function getBorderStyleLabels(H){return{none:H("None"),solid:H("Solid"),dotted:H("Dotted"),dashed:H("Dashed"),double:H("Double"),groove:H("Groove"),ridge:H("Ridge"),inset:H("Inset"),outset:H("Outset")}}function getLocalizedColorErrorText(H){return H('The color is invalid. Try "#FF0000" or "rgb(255,0,0)" or "red".')}function getLocalizedLengthErrorText(H){return H('The value is invalid. Try "10px" or "2em" or simply "2".')}function colorFieldValidator(H){return H=H.trim().toLowerCase(),isEmpty(H)||isColor(H)}function lengthFieldValidator(H){return H=H.trim(),isEmpty(H)||isNumberString(H)||isLength(H)||isPercentage(H)}function lineWidthFieldValidator(H){return H=H.trim(),isEmpty(H)||isNumberString(H)||isLength(H)}function getBorderStyleDefinitions(H,B){const t=new Collection,V=getBorderStyleLabels(H.t);for(const N in V){const W={type:"button",model:new Model({_borderStyleValue:N,label:V[N],role:"menuitemradio",withText:!0})};N==="none"?W.model.bind("isOn").to(H,"borderStyle",K=>B==="none"?!K:K===N):W.model.bind("isOn").to(H,"borderStyle",K=>K===N),t.add(W)}return t}function fillToolbar(H){const{view:B,icons:t,toolbar:V,labels:N,propertyName:W,nameToValue:K,defaultValue:G}=H;for(const Z in N){const Y=new ButtonView(B.locale);Y.set({label:N[Z],icon:t[Z],tooltip:N[Z]});const X=K?K(Z):Z;Y.bind("isOn").to(B,W,Q=>{let te=Q;return Q===""&&G&&(te=G),X===te}),Y.on("execute",()=>{B[W]=X}),V.items.add(Y)}}const defaultColors=[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}];function getLabeledColorInputCreator(H){return(B,t,V)=>{const N=new ColorInputView(B.locale,{colorDefinitions:colorConfigToColorGridDefinitions(H.colorConfig),columns:H.columns,defaultColorValue:H.defaultColorValue,colorPickerConfig:H.colorPickerConfig});return N.inputView.set({id:t,ariaDescribedById:V}),N.bind("isReadOnly").to(B,"isEnabled",W=>!W),N.bind("hasError").to(B,"errorText",W=>!!W),N.on("input",()=>{B.errorText=null}),B.bind("isEmpty","isFocused").to(N),N}}function isNumberString(H){const B=parseFloat(H);return!Number.isNaN(B)&&H===String(B)}function colorConfigToColorGridDefinitions(H){return H.map(B=>({color:B.model,label:B.label,options:{hasBorder:B.hasBorder}}))}class FormRowView extends View{constructor(t,V={}){super(t);ee(this,"children");const N=this.bindTemplate;this.set("class",V.class||null),this.children=this.createCollection(),V.children&&V.children.forEach(W=>this.children.add(W)),this.set("_role",null),this.set("_ariaLabelledBy",null),V.labelView&&this.set({_role:"group",_ariaLabelledBy:V.labelView.id}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-form__row",N.to("class")],role:N.to("_role"),"aria-labelledby":N.to("_ariaLabelledBy")},children:this.children})}}class TableCellPropertiesView extends View{constructor(t,V){super(t);ee(this,"options");ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"children");ee(this,"borderStyleDropdown");ee(this,"borderWidthInput");ee(this,"borderColorInput");ee(this,"backgroundInput");ee(this,"paddingInput");ee(this,"widthInput");ee(this,"heightInput");ee(this,"horizontalAlignmentToolbar");ee(this,"verticalAlignmentToolbar");ee(this,"saveButtonView");ee(this,"cancelButtonView");ee(this,"_focusables");ee(this,"_focusCycler");this.set({borderStyle:"",borderWidth:"",borderColor:"",padding:"",backgroundColor:"",width:"",height:"",horizontalAlignment:"",verticalAlignment:""}),this.options=V;const{borderStyleDropdown:N,borderWidthInput:W,borderColorInput:K,borderRowLabel:G}=this._createBorderFields(),{backgroundRowLabel:Z,backgroundInput:Y}=this._createBackgroundFields(),{widthInput:X,operatorLabel:Q,heightInput:te,dimensionsLabel:ie}=this._createDimensionFields(),{horizontalAlignmentToolbar:ne,verticalAlignmentToolbar:le,alignmentLabel:ae}=this._createAlignmentFields();this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.children=this.createCollection(),this.borderStyleDropdown=N,this.borderWidthInput=W,this.borderColorInput=K,this.backgroundInput=Y,this.paddingInput=this._createPaddingField(),this.widthInput=X,this.heightInput=te,this.horizontalAlignmentToolbar=ne,this.verticalAlignmentToolbar=le;const{saveButtonView:de,cancelButtonView:ce}=this._createActionButtons();this.saveButtonView=de,this.cancelButtonView=ce,this._focusables=new ViewCollection,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new FormHeaderView(t,{label:this.t("Cell properties")})),this.children.add(new FormRowView(t,{labelView:G,children:[G,N,K,W],class:"ck-table-form__border-row"})),this.children.add(new FormRowView(t,{labelView:Z,children:[Z,Y],class:"ck-table-form__background-row"})),this.children.add(new FormRowView(t,{children:[new FormRowView(t,{labelView:ie,children:[ie,X,Q,te],class:"ck-table-form__dimensions-row"}),new FormRowView(t,{children:[this.paddingInput],class:"ck-table-cell-properties-form__padding-row"})]})),this.children.add(new FormRowView(t,{labelView:ae,children:[ae,ne,le],class:"ck-table-cell-properties-form__alignment-row"})),this.children.add(new FormRowView(t,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-cell-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),submitHandler({view:this}),[this.borderColorInput,this.backgroundInput].forEach(t=>{this._focusCycler.chain(t.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.paddingInput,this.horizontalAlignmentToolbar,this.verticalAlignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const t=this.options.defaultTableCellProperties,V={style:t.borderStyle,width:t.borderWidth,color:t.borderColor},N=getLabeledColorInputCreator({colorConfig:this.options.borderColors,columns:5,defaultColorValue:V.color,colorPickerConfig:this.options.colorPickerConfig}),W=this.locale,K=this.t,G=K("Style"),Z=new LabelView(W);Z.text=K("Border");const Y=getBorderStyleLabels(K),X=new LabeledFieldView(W,createLabeledDropdown);X.set({label:G,class:"ck-table-form__border-style"}),X.fieldView.buttonView.set({ariaLabel:G,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:G}),X.fieldView.buttonView.bind("label").to(this,"borderStyle",ie=>Y[ie||"none"]),X.fieldView.on("execute",ie=>{this.borderStyle=ie.source._borderStyleValue}),X.bind("isEmpty").to(this,"borderStyle",ie=>!ie),addListToDropdown(X.fieldView,getBorderStyleDefinitions(this,V.style),{role:"menu",ariaLabel:G});const Q=new LabeledFieldView(W,createLabeledInputText);Q.set({label:K("Width"),class:"ck-table-form__border-width"}),Q.fieldView.bind("value").to(this,"borderWidth"),Q.bind("isEnabled").to(this,"borderStyle",isBorderStyleSet$1),Q.fieldView.on("input",()=>{this.borderWidth=Q.fieldView.element.value});const te=new LabeledFieldView(W,N);return te.set({label:K("Color"),class:"ck-table-form__border-color"}),te.fieldView.bind("value").to(this,"borderColor"),te.bind("isEnabled").to(this,"borderStyle",isBorderStyleSet$1),te.fieldView.on("input",()=>{this.borderColor=te.fieldView.value}),this.on("change:borderStyle",(ie,ne,le,ae)=>{isBorderStyleSet$1(le)||(this.borderColor="",this.borderWidth=""),isBorderStyleSet$1(ae)||(this.borderColor=V.color,this.borderWidth=V.width)}),{borderRowLabel:Z,borderStyleDropdown:X,borderColorInput:te,borderWidthInput:Q}}_createBackgroundFields(){const t=this.locale,V=this.t,N=new LabelView(t);N.text=V("Background");const W=getLabeledColorInputCreator({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableCellProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),K=new LabeledFieldView(t,W);return K.set({label:V("Color"),class:"ck-table-cell-properties-form__background"}),K.fieldView.bind("value").to(this,"backgroundColor"),K.fieldView.on("input",()=>{this.backgroundColor=K.fieldView.value}),{backgroundRowLabel:N,backgroundInput:K}}_createDimensionFields(){const t=this.locale,V=this.t,N=new LabelView(t);N.text=V("Dimensions");const W=new LabeledFieldView(t,createLabeledInputText);W.set({label:V("Width"),class:"ck-table-form__dimensions-row__width"}),W.fieldView.bind("value").to(this,"width"),W.fieldView.on("input",()=>{this.width=W.fieldView.element.value});const K=new View(t);K.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const G=new LabeledFieldView(t,createLabeledInputText);return G.set({label:V("Height"),class:"ck-table-form__dimensions-row__height"}),G.fieldView.bind("value").to(this,"height"),G.fieldView.on("input",()=>{this.height=G.fieldView.element.value}),{dimensionsLabel:N,widthInput:W,operatorLabel:K,heightInput:G}}_createPaddingField(){const t=this.locale,V=this.t,N=new LabeledFieldView(t,createLabeledInputText);return N.set({label:V("Padding"),class:"ck-table-cell-properties-form__padding"}),N.fieldView.bind("value").to(this,"padding"),N.fieldView.on("input",()=>{this.padding=N.fieldView.element.value}),N}_createAlignmentFields(){const t=this.locale,V=this.t,N=new LabelView(t),W={left:icons.alignLeft,center:icons.alignCenter,right:icons.alignRight,justify:icons.alignJustify,top:icons.alignTop,middle:icons.alignMiddle,bottom:icons.alignBottom};N.text=V("Table cell text alignment");const K=new ToolbarView(t),G=t.contentLanguageDirection==="rtl";K.set({isCompact:!0,ariaLabel:V("Horizontal text alignment toolbar")}),fillToolbar({view:this,icons:W,toolbar:K,labels:this._horizontalAlignmentLabels,propertyName:"horizontalAlignment",nameToValue:Y=>{if(G){if(Y==="left")return"right";if(Y==="right")return"left"}return Y},defaultValue:this.options.defaultTableCellProperties.horizontalAlignment});const Z=new ToolbarView(t);return Z.set({isCompact:!0,ariaLabel:V("Vertical text alignment toolbar")}),fillToolbar({view:this,icons:W,toolbar:Z,labels:this._verticalAlignmentLabels,propertyName:"verticalAlignment",defaultValue:this.options.defaultTableCellProperties.verticalAlignment}),{horizontalAlignmentToolbar:K,verticalAlignmentToolbar:Z,alignmentLabel:N}}_createActionButtons(){const t=this.locale,V=this.t,N=new ButtonView(t),W=new ButtonView(t),K=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.paddingInput];return N.set({label:V("Save"),icon:icons.check,class:"ck-button-save",type:"submit",withText:!0}),N.bind("isEnabled").toMany(K,"errorText",(...G)=>G.every(Z=>!Z)),W.set({label:V("Cancel"),icon:icons.cancel,class:"ck-button-cancel",withText:!0}),W.delegate("execute").to(this,"cancel"),{saveButtonView:N,cancelButtonView:W}}get _horizontalAlignmentLabels(){const t=this.locale,V=this.t,N=V("Align cell text to the left"),W=V("Align cell text to the center"),K=V("Align cell text to the right"),G=V("Justify cell text");return t.uiLanguageDirection==="rtl"?{right:K,center:W,left:N,justify:G}:{left:N,center:W,right:K,justify:G}}get _verticalAlignmentLabels(){const t=this.t;return{top:t("Align cell text to the top"),middle:t("Align cell text to the middle"),bottom:t("Align cell text to the bottom")}}}function isBorderStyleSet$1(H){return H!=="none"}const BALLOON_POSITIONS=[BalloonPanelView.defaultPositions.northArrowSouth,BalloonPanelView.defaultPositions.northArrowSouthWest,BalloonPanelView.defaultPositions.northArrowSouthEast,BalloonPanelView.defaultPositions.southArrowNorth,BalloonPanelView.defaultPositions.southArrowNorthWest,BalloonPanelView.defaultPositions.southArrowNorthEast,BalloonPanelView.defaultPositions.viewportStickyNorth];function repositionContextualBalloon(H,B){const t=H.plugins.get("ContextualBalloon"),V=H.editing.view.document.selection;let N;B==="cell"?getTableWidgetAncestor(V)&&(N=getBalloonCellPositionData(H)):getSelectionAffectedTableWidget(V)&&(N=getBalloonTablePositionData(H)),N&&t.updatePosition(N)}function getBalloonTablePositionData(H){const B=H.model.document.selection,t=getSelectionAffectedTable(B),V=H.editing.mapper.toViewElement(t);return{target:H.editing.view.domConverter.mapViewToDom(V),positions:BALLOON_POSITIONS}}function getBalloonCellPositionData(H){const B=H.editing.mapper,t=H.editing.view.domConverter,V=H.model.document.selection;if(V.rangeCount>1)return{target:()=>createBoundingRect(V.getRanges(),H),positions:BALLOON_POSITIONS};const N=getTableCellAtPosition(V.getFirstPosition()),W=B.toViewElement(N);return{target:t.mapViewToDom(W),positions:BALLOON_POSITIONS}}function getTableCellAtPosition(H){return H.nodeAfter&&H.nodeAfter.is("element","tableCell")?H.nodeAfter:H.findAncestor("tableCell")}function createBoundingRect(H,B){const t=B.editing.mapper,V=B.editing.view.domConverter,N=Array.from(H).map(W=>{const K=getTableCellAtPosition(W.start),G=t.toViewElement(K);return new Rect(V.mapViewToDom(G))});return Rect.getBoundingRect(N)}var tableCellProperties='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.105 18-.17 1H2.5A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1h15A1.5 1.5 0 0 1 19 2.5v9.975l-.85-.124-.15-.302V8h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5h3.105zM2 12h5V8H2v4zm10-4H8v4h4V8zM2 2v5h5V2H2zm0 16h5v-5H2v5zM13 7h5V2h-5v5zM8 2v5h4V2H8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM13 6a1 1 0 0 1 1 1v3.172a2.047 2.047 0 0 0-.293.443l-.858 1.736-1.916.28-.151.027A1.976 1.976 0 0 0 9.315 14H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm-1 2H8v4h4V8z"/></svg>';function getSingleValue(H){if(!H||!isObject$2(H))return H;const{top:B,right:t,bottom:V,left:N}=H;if(B==t&&t==V&&V==N)return B}function addDefaultUnitToNumericValue(H,B){const t=parseFloat(H);return Number.isNaN(t)||String(t)!==String(H)?H:`${t}${B}`}function getNormalizedDefaultProperties(H,B={}){const t={borderStyle:"none",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",...H};return B.includeAlignmentProperty&&!t.alignment&&(t.alignment="center"),B.includePaddingProperty&&!t.padding&&(t.padding=""),B.includeVerticalAlignmentProperty&&!t.verticalAlignment&&(t.verticalAlignment="middle"),B.includeHorizontalAlignmentProperty&&!t.horizontalAlignment&&(t.horizontalAlignment=B.isRightToLeftContent?"right":"left"),t}function getNormalizedDefaultTableProperties(H,B){return getNormalizedDefaultProperties({borderStyle:"double",borderColor:"hsl(0, 0%, 70%)",borderWidth:"1px",...H},B)}function getNormalizedDefaultCellProperties(H,B){return getNormalizedDefaultProperties({borderStyle:"solid",borderColor:"hsl(0, 0%, 75%)",borderWidth:"1px",...H},B)}const ERROR_TEXT_TIMEOUT$1=500,propertyToCommandMap$1={borderStyle:"tableCellBorderStyle",borderColor:"tableCellBorderColor",borderWidth:"tableCellBorderWidth",height:"tableCellHeight",width:"tableCellWidth",padding:"tableCellPadding",backgroundColor:"tableCellBackgroundColor",horizontalAlignment:"tableCellHorizontalAlignment",verticalAlignment:"tableCellVerticalAlignment"};class TableCellPropertiesUI extends Plugin{constructor(t){super(t);ee(this,"_defaultTableCellProperties");ee(this,"_balloon");ee(this,"view");ee(this,"_undoStepBatch");ee(this,"_isReady");t.config.define("table.tableCellProperties",{borderColors:defaultColors,backgroundColors:defaultColors})}static get requires(){return[ContextualBalloon]}static get pluginName(){return"TableCellPropertiesUI"}init(){const t=this.editor,V=t.t;this._defaultTableCellProperties=getNormalizedDefaultCellProperties(t.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:t.locale.contentLanguageDirection==="rtl"}),this._balloon=t.plugins.get(ContextualBalloon),this.view=null,this._isReady=!1,t.ui.componentFactory.add("tableCellProperties",N=>{const W=new ButtonView(N);W.set({label:V("Cell properties"),icon:tableCellProperties,tooltip:!0}),this.listenTo(W,"execute",()=>this._showView());const K=Object.values(propertyToCommandMap$1).map(G=>t.commands.get(G));return W.bind("isEnabled").toMany(K,"isEnabled",(...G)=>G.some(Z=>Z)),W})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const t=this.editor,V=t.config.get("table.tableCellProperties"),N=normalizeColorOptions(V.borderColors),W=getLocalizedColorOptions(t.locale,N),K=normalizeColorOptions(V.backgroundColors),G=getLocalizedColorOptions(t.locale,K),Z=V.colorPicker!==!1,Y=new TableCellPropertiesView(t.locale,{borderColors:W,backgroundColors:G,defaultTableCellProperties:this._defaultTableCellProperties,colorPickerConfig:Z?V.colorPicker||{}:!1}),X=t.t;Y.render(),this.listenTo(Y,"submit",()=>{this._hideView()}),this.listenTo(Y,"cancel",()=>{this._undoStepBatch.operations.length&&t.execute("undo",this._undoStepBatch),this._hideView()}),Y.keystrokes.set("Esc",(ie,ne)=>{this._hideView(),ne()}),clickOutsideHandler({emitter:Y,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const Q=getLocalizedColorErrorText(X),te=getLocalizedLengthErrorText(X);return Y.on("change:borderStyle",this._getPropertyChangeCallback("tableCellBorderStyle")),Y.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:Y.borderColorInput,commandName:"tableCellBorderColor",errorText:Q,validator:colorFieldValidator})),Y.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:Y.borderWidthInput,commandName:"tableCellBorderWidth",errorText:te,validator:lineWidthFieldValidator})),Y.on("change:padding",this._getValidatedPropertyChangeCallback({viewField:Y.paddingInput,commandName:"tableCellPadding",errorText:te,validator:lengthFieldValidator})),Y.on("change:width",this._getValidatedPropertyChangeCallback({viewField:Y.widthInput,commandName:"tableCellWidth",errorText:te,validator:lengthFieldValidator})),Y.on("change:height",this._getValidatedPropertyChangeCallback({viewField:Y.heightInput,commandName:"tableCellHeight",errorText:te,validator:lengthFieldValidator})),Y.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:Y.backgroundInput,commandName:"tableCellBackgroundColor",errorText:Q,validator:colorFieldValidator})),Y.on("change:horizontalAlignment",this._getPropertyChangeCallback("tableCellHorizontalAlignment")),Y.on("change:verticalAlignment",this._getPropertyChangeCallback("tableCellVerticalAlignment")),Y}_fillViewFormFromCommandValues(){const t=this.editor.commands,V=t.get("tableCellBorderStyle");Object.entries(propertyToCommandMap$1).map(([N,W])=>{const K=this._defaultTableCellProperties[N]||"";return[N,t.get(W).value||K]}).forEach(([N,W])=>{(N==="borderColor"||N==="borderWidth")&&V.value==="none"||this.view.set(N,W)}),this._isReady=!0}_showView(){const t=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(t.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:getBalloonCellPositionData(t)}),this._undoStepBatch=t.model.createBatch(),this.view.focus()}_hideView(){const t=this.editor;this.stopListening(t.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const t=this.editor,V=t.editing.view.document;getTableWidgetAncestor(V.selection)?this._isViewVisible&&repositionContextualBalloon(t,"cell"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(t){return(V,N,W)=>{this._isReady&&this.editor.execute(t,{value:W,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(t){const{commandName:V,viewField:N,validator:W,errorText:K}=t,G=debounce(()=>{N.errorText=K},ERROR_TEXT_TIMEOUT$1);return(Z,Y,X)=>{G.cancel(),this._isReady&&(W(X)?(this.editor.execute(V,{value:X,batch:this._undoStepBatch}),N.errorText=null):G())}}}class TableCellPropertyCommand extends Command{constructor(t,V,N){super(t);ee(this,"attributeName");ee(this,"_defaultValue");this.attributeName=V,this._defaultValue=N}refresh(){const t=this.editor,N=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(t.model.document.selection);this.isEnabled=!!N.length,this.value=this._getSingleValue(N)}execute(t={}){const{value:V,batch:N}=t,W=this.editor.model,G=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(W.document.selection),Z=this._getValueToSet(V);W.enqueueChange(N,Y=>{Z?G.forEach(X=>Y.setAttribute(this.attributeName,Z,X)):G.forEach(X=>Y.removeAttribute(this.attributeName,X))})}_getAttribute(t){if(!t)return;const V=t.getAttribute(this.attributeName);if(V!==this._defaultValue)return V}_getValueToSet(t){if(t!==this._defaultValue)return t}_getSingleValue(t){const V=this._getAttribute(t[0]);return t.every(W=>this._getAttribute(W)===V)?V:void 0}}class TableCellWidthCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellWidth",t)}_getValueToSet(B){if(B=addDefaultUnitToNumericValue(B,"px"),B!==this._defaultValue)return B}}class TableCellWidthEditing extends Plugin{static get pluginName(){return"TableCellWidthEditing"}static get requires(){return[TableEditing]}init(){const B=this.editor,t=getNormalizedDefaultCellProperties(B.config.get("table.tableCellProperties.defaultProperties"));enableProperty$1(B.model.schema,B.conversion,{modelAttribute:"tableCellWidth",styleName:"width",defaultValue:t.width}),B.commands.add("tableCellWidth",new TableCellWidthCommand(B,t.width))}}class TableCellPaddingCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellPadding",t)}_getAttribute(B){if(!B)return;const t=getSingleValue(B.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(B){const t=addDefaultUnitToNumericValue(B,"px");if(t!==this._defaultValue)return t}}class TableCellHeightCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellHeight",t)}_getValueToSet(B){const t=addDefaultUnitToNumericValue(B,"px");if(t!==this._defaultValue)return t}}class TableCellBackgroundColorCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellBackgroundColor",t)}}class TableCellVerticalAlignmentCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellVerticalAlignment",t)}}class TableCellHorizontalAlignmentCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellHorizontalAlignment",t)}}class TableCellBorderStyleCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellBorderStyle",t)}_getAttribute(B){if(!B)return;const t=getSingleValue(B.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class TableCellBorderColorCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellBorderColor",t)}_getAttribute(B){if(!B)return;const t=getSingleValue(B.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class TableCellBorderWidthCommand extends TableCellPropertyCommand{constructor(B,t){super(B,"tableCellBorderWidth",t)}_getAttribute(B){if(!B)return;const t=getSingleValue(B.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(B){const t=addDefaultUnitToNumericValue(B,"px");if(t!==this._defaultValue)return t}}const VALIGN_VALUES_REG_EXP=/^(top|middle|bottom)$/,ALIGN_VALUES_REG_EXP$1=/^(left|center|right|justify)$/;class TableCellPropertiesEditing extends Plugin{static get pluginName(){return"TableCellPropertiesEditing"}static get requires(){return[TableEditing,TableCellWidthEditing]}init(){const B=this.editor,t=B.model.schema,V=B.conversion;B.config.define("table.tableCellProperties.defaultProperties",{});const N=getNormalizedDefaultCellProperties(B.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:B.locale.contentLanguageDirection==="rtl"});B.data.addStyleProcessorRules(addBorderRules),enableBorderProperties$1(t,V,{color:N.borderColor,style:N.borderStyle,width:N.borderWidth}),B.commands.add("tableCellBorderStyle",new TableCellBorderStyleCommand(B,N.borderStyle)),B.commands.add("tableCellBorderColor",new TableCellBorderColorCommand(B,N.borderColor)),B.commands.add("tableCellBorderWidth",new TableCellBorderWidthCommand(B,N.borderWidth)),enableProperty$1(t,V,{modelAttribute:"tableCellHeight",styleName:"height",defaultValue:N.height}),B.commands.add("tableCellHeight",new TableCellHeightCommand(B,N.height)),B.data.addStyleProcessorRules(addPaddingRules),enableProperty$1(t,V,{modelAttribute:"tableCellPadding",styleName:"padding",reduceBoxSides:!0,defaultValue:N.padding}),B.commands.add("tableCellPadding",new TableCellPaddingCommand(B,N.padding)),B.data.addStyleProcessorRules(addBackgroundRules),enableProperty$1(t,V,{modelAttribute:"tableCellBackgroundColor",styleName:"background-color",defaultValue:N.backgroundColor}),B.commands.add("tableCellBackgroundColor",new TableCellBackgroundColorCommand(B,N.backgroundColor)),enableHorizontalAlignmentProperty(t,V,N.horizontalAlignment),B.commands.add("tableCellHorizontalAlignment",new TableCellHorizontalAlignmentCommand(B,N.horizontalAlignment)),enableVerticalAlignmentProperty(t,V,N.verticalAlignment),B.commands.add("tableCellVerticalAlignment",new TableCellVerticalAlignmentCommand(B,N.verticalAlignment))}}function enableBorderProperties$1(H,B,t){const V={width:"tableCellBorderWidth",color:"tableCellBorderColor",style:"tableCellBorderStyle"};H.extend("tableCell",{allowAttributes:Object.values(V)}),upcastBorderStyles(B,"td",V,t),upcastBorderStyles(B,"th",V,t),downcastAttributeToStyle(B,{modelElement:"tableCell",modelAttribute:V.style,styleName:"border-style"}),downcastAttributeToStyle(B,{modelElement:"tableCell",modelAttribute:V.color,styleName:"border-color"}),downcastAttributeToStyle(B,{modelElement:"tableCell",modelAttribute:V.width,styleName:"border-width"})}function enableHorizontalAlignmentProperty(H,B,t){H.extend("tableCell",{allowAttributes:["tableCellHorizontalAlignment"]}),B.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellHorizontalAlignment"},view:V=>({key:"style",value:{"text-align":V}})}),B.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"text-align":ALIGN_VALUES_REG_EXP$1}},model:{key:"tableCellHorizontalAlignment",value:V=>{const N=V.getStyle("text-align");return N===t?null:N}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{align:ALIGN_VALUES_REG_EXP$1}},model:{key:"tableCellHorizontalAlignment",value:V=>{const N=V.getAttribute("align");return N===t?null:N}}})}function enableVerticalAlignmentProperty(H,B,t){H.extend("tableCell",{allowAttributes:["tableCellVerticalAlignment"]}),B.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellVerticalAlignment"},view:V=>({key:"style",value:{"vertical-align":V}})}),B.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"vertical-align":VALIGN_VALUES_REG_EXP}},model:{key:"tableCellVerticalAlignment",value:V=>{const N=V.getStyle("vertical-align");return N===t?null:N}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{valign:VALIGN_VALUES_REG_EXP}},model:{key:"tableCellVerticalAlignment",value:V=>{const N=V.getAttribute("valign");return N===t?null:N}}})}class TableCellProperties extends Plugin{static get pluginName(){return"TableCellProperties"}static get requires(){return[TableCellPropertiesEditing,TableCellPropertiesUI]}}class TablePropertyCommand extends Command{constructor(t,V,N){super(t);ee(this,"attributeName");ee(this,"_defaultValue");this.attributeName=V,this._defaultValue=N}refresh(){const V=this.editor.model.document.selection,N=getSelectionAffectedTable(V);this.isEnabled=!!N,this.value=this._getValue(N)}execute(t={}){const V=this.editor.model,N=V.document.selection,{value:W,batch:K}=t,G=getSelectionAffectedTable(N),Z=this._getValueToSet(W);V.enqueueChange(K,Y=>{Z?Y.setAttribute(this.attributeName,Z,G):Y.removeAttribute(this.attributeName,G)})}_getValue(t){if(!t)return;const V=t.getAttribute(this.attributeName);if(V!==this._defaultValue)return V}_getValueToSet(t){if(t!==this._defaultValue)return t}}class TableBackgroundColorCommand extends TablePropertyCommand{constructor(B,t){super(B,"tableBackgroundColor",t)}}class TableBorderColorCommand extends TablePropertyCommand{constructor(B,t){super(B,"tableBorderColor",t)}_getValue(B){if(!B)return;const t=getSingleValue(B.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class TableBorderStyleCommand extends TablePropertyCommand{constructor(B,t){super(B,"tableBorderStyle",t)}_getValue(B){if(!B)return;const t=getSingleValue(B.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}class TableBorderWidthCommand extends TablePropertyCommand{constructor(B,t){super(B,"tableBorderWidth",t)}_getValue(B){if(!B)return;const t=getSingleValue(B.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(B){const t=addDefaultUnitToNumericValue(B,"px");if(t!==this._defaultValue)return t}}class TableWidthCommand extends TablePropertyCommand{constructor(B,t){super(B,"tableWidth",t)}_getValueToSet(B){if(B=addDefaultUnitToNumericValue(B,"px"),B!==this._defaultValue)return B}}class TableHeightCommand extends TablePropertyCommand{constructor(B,t){super(B,"tableHeight",t)}_getValueToSet(B){if(B=addDefaultUnitToNumericValue(B,"px"),B!==this._defaultValue)return B}}class TableAlignmentCommand extends TablePropertyCommand{constructor(B,t){super(B,"tableAlignment",t)}}const ALIGN_VALUES_REG_EXP=/^(left|center|right)$/,FLOAT_VALUES_REG_EXP=/^(left|none|right)$/;class TablePropertiesEditing extends Plugin{static get pluginName(){return"TablePropertiesEditing"}static get requires(){return[TableEditing]}init(){const B=this.editor,t=B.model.schema,V=B.conversion;B.config.define("table.tableProperties.defaultProperties",{});const N=getNormalizedDefaultTableProperties(B.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0});B.data.addStyleProcessorRules(addBorderRules),enableBorderProperties(t,V,{color:N.borderColor,style:N.borderStyle,width:N.borderWidth}),B.commands.add("tableBorderColor",new TableBorderColorCommand(B,N.borderColor)),B.commands.add("tableBorderStyle",new TableBorderStyleCommand(B,N.borderStyle)),B.commands.add("tableBorderWidth",new TableBorderWidthCommand(B,N.borderWidth)),enableAlignmentProperty(t,V,N.alignment),B.commands.add("tableAlignment",new TableAlignmentCommand(B,N.alignment)),enableTableToFigureProperty(t,V,{modelAttribute:"tableWidth",styleName:"width",defaultValue:N.width}),B.commands.add("tableWidth",new TableWidthCommand(B,N.width)),enableTableToFigureProperty(t,V,{modelAttribute:"tableHeight",styleName:"height",defaultValue:N.height}),B.commands.add("tableHeight",new TableHeightCommand(B,N.height)),B.data.addStyleProcessorRules(addBackgroundRules),enableProperty(t,V,{modelAttribute:"tableBackgroundColor",styleName:"background-color",defaultValue:N.backgroundColor}),B.commands.add("tableBackgroundColor",new TableBackgroundColorCommand(B,N.backgroundColor))}}function enableBorderProperties(H,B,t){const V={width:"tableBorderWidth",color:"tableBorderColor",style:"tableBorderStyle"};H.extend("table",{allowAttributes:Object.values(V)}),upcastBorderStyles(B,"table",V,t),downcastTableAttribute(B,{modelAttribute:V.color,styleName:"border-color"}),downcastTableAttribute(B,{modelAttribute:V.style,styleName:"border-style"}),downcastTableAttribute(B,{modelAttribute:V.width,styleName:"border-width"})}function enableAlignmentProperty(H,B,t){H.extend("table",{allowAttributes:["tableAlignment"]}),B.for("downcast").attributeToAttribute({model:{name:"table",key:"tableAlignment"},view:V=>({key:"style",value:{float:V==="center"?"none":V}}),converterPriority:"high"}),B.for("upcast").attributeToAttribute({view:{name:/^(table|figure)$/,styles:{float:FLOAT_VALUES_REG_EXP}},model:{key:"tableAlignment",value:V=>{let N=V.getStyle("float");return N==="none"&&(N="center"),N===t?null:N}}}).attributeToAttribute({view:{attributes:{align:ALIGN_VALUES_REG_EXP}},model:{name:"table",key:"tableAlignment",value:V=>{const N=V.getAttribute("align");return N===t?null:N}}})}function enableProperty(H,B,t){const{modelAttribute:V}=t;H.extend("table",{allowAttributes:[V]}),upcastStyleToAttribute(B,{viewElement:"table",...t}),downcastTableAttribute(B,t)}function enableTableToFigureProperty(H,B,t){const{modelAttribute:V}=t;H.extend("table",{allowAttributes:[V]}),upcastStyleToAttribute(B,{viewElement:/^(table|figure)$/,shouldUpcast:N=>!(N.name=="table"&&N.parent.name=="figure"),...t}),downcastAttributeToStyle(B,{modelElement:"table",...t})}class TablePropertiesView extends View{constructor(t,V){super(t);ee(this,"options");ee(this,"focusTracker");ee(this,"keystrokes");ee(this,"children");ee(this,"borderStyleDropdown");ee(this,"borderWidthInput");ee(this,"borderColorInput");ee(this,"backgroundInput");ee(this,"widthInput");ee(this,"heightInput");ee(this,"alignmentToolbar");ee(this,"saveButtonView");ee(this,"cancelButtonView");ee(this,"_focusables");ee(this,"_focusCycler");this.set({borderStyle:"",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",alignment:""}),this.options=V;const{borderStyleDropdown:N,borderWidthInput:W,borderColorInput:K,borderRowLabel:G}=this._createBorderFields(),{backgroundRowLabel:Z,backgroundInput:Y}=this._createBackgroundFields(),{widthInput:X,operatorLabel:Q,heightInput:te,dimensionsLabel:ie}=this._createDimensionFields(),{alignmentToolbar:ne,alignmentLabel:le}=this._createAlignmentFields();this.focusTracker=new FocusTracker,this.keystrokes=new KeystrokeHandler,this.children=this.createCollection(),this.borderStyleDropdown=N,this.borderWidthInput=W,this.borderColorInput=K,this.backgroundInput=Y,this.widthInput=X,this.heightInput=te,this.alignmentToolbar=ne;const{saveButtonView:ae,cancelButtonView:de}=this._createActionButtons();this.saveButtonView=ae,this.cancelButtonView=de,this._focusables=new ViewCollection,this._focusCycler=new FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new FormHeaderView(t,{label:this.t("Table properties")})),this.children.add(new FormRowView(t,{labelView:G,children:[G,N,K,W],class:"ck-table-form__border-row"})),this.children.add(new FormRowView(t,{labelView:Z,children:[Z,Y],class:"ck-table-form__background-row"})),this.children.add(new FormRowView(t,{children:[new FormRowView(t,{labelView:ie,children:[ie,X,Q,te],class:"ck-table-form__dimensions-row"}),new FormRowView(t,{labelView:le,children:[le,ne],class:"ck-table-properties-form__alignment-row"})]})),this.children.add(new FormRowView(t,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),submitHandler({view:this}),[this.borderColorInput,this.backgroundInput].forEach(t=>{this._focusCycler.chain(t.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.alignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const t=this.options.defaultTableProperties,V={style:t.borderStyle,width:t.borderWidth,color:t.borderColor},N=getLabeledColorInputCreator({colorConfig:this.options.borderColors,columns:5,defaultColorValue:V.color,colorPickerConfig:this.options.colorPickerConfig}),W=this.locale,K=this.t,G=K("Style"),Z=new LabelView(W);Z.text=K("Border");const Y=getBorderStyleLabels(K),X=new LabeledFieldView(W,createLabeledDropdown);X.set({label:G,class:"ck-table-form__border-style"}),X.fieldView.buttonView.set({ariaLabel:G,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:G}),X.fieldView.buttonView.bind("label").to(this,"borderStyle",ie=>Y[ie||"none"]),X.fieldView.on("execute",ie=>{this.borderStyle=ie.source._borderStyleValue}),X.bind("isEmpty").to(this,"borderStyle",ie=>!ie),addListToDropdown(X.fieldView,getBorderStyleDefinitions(this,V.style),{role:"menu",ariaLabel:G});const Q=new LabeledFieldView(W,createLabeledInputText);Q.set({label:K("Width"),class:"ck-table-form__border-width"}),Q.fieldView.bind("value").to(this,"borderWidth"),Q.bind("isEnabled").to(this,"borderStyle",isBorderStyleSet),Q.fieldView.on("input",()=>{this.borderWidth=Q.fieldView.element.value});const te=new LabeledFieldView(W,N);return te.set({label:K("Color"),class:"ck-table-form__border-color"}),te.fieldView.bind("value").to(this,"borderColor"),te.bind("isEnabled").to(this,"borderStyle",isBorderStyleSet),te.fieldView.on("input",()=>{this.borderColor=te.fieldView.value}),this.on("change:borderStyle",(ie,ne,le,ae)=>{isBorderStyleSet(le)||(this.borderColor="",this.borderWidth=""),isBorderStyleSet(ae)||(this.borderColor=V.color,this.borderWidth=V.width)}),{borderRowLabel:Z,borderStyleDropdown:X,borderColorInput:te,borderWidthInput:Q}}_createBackgroundFields(){const t=this.locale,V=this.t,N=new LabelView(t);N.text=V("Background");const W=getLabeledColorInputCreator({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),K=new LabeledFieldView(t,W);return K.set({label:V("Color"),class:"ck-table-properties-form__background"}),K.fieldView.bind("value").to(this,"backgroundColor"),K.fieldView.on("input",()=>{this.backgroundColor=K.fieldView.value}),{backgroundRowLabel:N,backgroundInput:K}}_createDimensionFields(){const t=this.locale,V=this.t,N=new LabelView(t);N.text=V("Dimensions");const W=new LabeledFieldView(t,createLabeledInputText);W.set({label:V("Width"),class:"ck-table-form__dimensions-row__width"}),W.fieldView.bind("value").to(this,"width"),W.fieldView.on("input",()=>{this.width=W.fieldView.element.value});const K=new View(t);K.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const G=new LabeledFieldView(t,createLabeledInputText);return G.set({label:V("Height"),class:"ck-table-form__dimensions-row__height"}),G.fieldView.bind("value").to(this,"height"),G.fieldView.on("input",()=>{this.height=G.fieldView.element.value}),{dimensionsLabel:N,widthInput:W,operatorLabel:K,heightInput:G}}_createAlignmentFields(){const t=this.locale,V=this.t,N=new LabelView(t);N.text=V("Alignment");const W=new ToolbarView(t);return W.set({isCompact:!0,ariaLabel:V("Table alignment toolbar")}),fillToolbar({view:this,icons:{left:icons.objectLeft,center:icons.objectCenter,right:icons.objectRight},toolbar:W,labels:this._alignmentLabels,propertyName:"alignment",defaultValue:this.options.defaultTableProperties.alignment}),{alignmentLabel:N,alignmentToolbar:W}}_createActionButtons(){const t=this.locale,V=this.t,N=new ButtonView(t),W=new ButtonView(t),K=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.widthInput,this.heightInput];return N.set({label:V("Save"),icon:icons.check,class:"ck-button-save",type:"submit",withText:!0}),N.bind("isEnabled").toMany(K,"errorText",(...G)=>G.every(Z=>!Z)),W.set({label:V("Cancel"),icon:icons.cancel,class:"ck-button-cancel",withText:!0}),W.delegate("execute").to(this,"cancel"),{saveButtonView:N,cancelButtonView:W}}get _alignmentLabels(){const t=this.locale,V=this.t,N=V("Align table to the left"),W=V("Center table"),K=V("Align table to the right");return t.uiLanguageDirection==="rtl"?{right:K,center:W,left:N}:{left:N,center:W,right:K}}}function isBorderStyleSet(H){return H!=="none"}var tableProperties='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 2v5h4V2h1v5h5v1h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5H7v-5H2v-1h5V8H2V7h5V2h1zm4 6H8v4h4V8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM17 1a2 2 0 0 1 2 2v9.475l-.85-.124-.857-1.736a2.048 2.048 0 0 0-.292-.44L17 3H3v14h7.808l.402.392L10.935 19H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14z"/></svg>';const ERROR_TEXT_TIMEOUT=500,propertyToCommandMap={borderStyle:"tableBorderStyle",borderColor:"tableBorderColor",borderWidth:"tableBorderWidth",backgroundColor:"tableBackgroundColor",width:"tableWidth",height:"tableHeight",alignment:"tableAlignment"};class TablePropertiesUI extends Plugin{constructor(t){super(t);ee(this,"_defaultTableProperties");ee(this,"_balloon");ee(this,"view",null);ee(this,"_undoStepBatch");ee(this,"_isReady");t.config.define("table.tableProperties",{borderColors:defaultColors,backgroundColors:defaultColors})}static get requires(){return[ContextualBalloon]}static get pluginName(){return"TablePropertiesUI"}init(){const t=this.editor,V=t.t;this._defaultTableProperties=getNormalizedDefaultTableProperties(t.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0}),this._balloon=t.plugins.get(ContextualBalloon),t.ui.componentFactory.add("tableProperties",N=>{const W=new ButtonView(N);W.set({label:V("Table properties"),icon:tableProperties,tooltip:!0}),this.listenTo(W,"execute",()=>this._showView());const K=Object.values(propertyToCommandMap).map(G=>t.commands.get(G));return W.bind("isEnabled").toMany(K,"isEnabled",(...G)=>G.some(Z=>Z)),W})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const t=this.editor,V=t.config.get("table.tableProperties"),N=normalizeColorOptions(V.borderColors),W=getLocalizedColorOptions(t.locale,N),K=normalizeColorOptions(V.backgroundColors),G=getLocalizedColorOptions(t.locale,K),Z=V.colorPicker!==!1,Y=new TablePropertiesView(t.locale,{borderColors:W,backgroundColors:G,defaultTableProperties:this._defaultTableProperties,colorPickerConfig:Z?V.colorPicker||{}:!1}),X=t.t;Y.render(),this.listenTo(Y,"submit",()=>{this._hideView()}),this.listenTo(Y,"cancel",()=>{this._undoStepBatch.operations.length&&t.execute("undo",this._undoStepBatch),this._hideView()}),Y.keystrokes.set("Esc",(ie,ne)=>{this._hideView(),ne()}),clickOutsideHandler({emitter:Y,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const Q=getLocalizedColorErrorText(X),te=getLocalizedLengthErrorText(X);return Y.on("change:borderStyle",this._getPropertyChangeCallback("tableBorderStyle")),Y.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:Y.borderColorInput,commandName:"tableBorderColor",errorText:Q,validator:colorFieldValidator})),Y.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:Y.borderWidthInput,commandName:"tableBorderWidth",errorText:te,validator:lineWidthFieldValidator})),Y.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:Y.backgroundInput,commandName:"tableBackgroundColor",errorText:Q,validator:colorFieldValidator})),Y.on("change:width",this._getValidatedPropertyChangeCallback({viewField:Y.widthInput,commandName:"tableWidth",errorText:te,validator:lengthFieldValidator})),Y.on("change:height",this._getValidatedPropertyChangeCallback({viewField:Y.heightInput,commandName:"tableHeight",errorText:te,validator:lengthFieldValidator})),Y.on("change:alignment",this._getPropertyChangeCallback("tableAlignment")),Y}_fillViewFormFromCommandValues(){const t=this.editor.commands,V=t.get("tableBorderStyle");Object.entries(propertyToCommandMap).map(([N,W])=>{const K=N,G=this._defaultTableProperties[K]||"";return[K,t.get(W).value||G]}).forEach(([N,W])=>{(N==="borderColor"||N==="borderWidth")&&V.value==="none"||this.view.set(N,W)}),this._isReady=!0}_showView(){const t=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(t.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:getBalloonTablePositionData(t)}),this._undoStepBatch=t.model.createBatch(),this.view.focus()}_hideView(){const t=this.editor;this.stopListening(t.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const t=this.editor,V=t.editing.view.document;getSelectionAffectedTableWidget(V.selection)?this._isViewVisible&&repositionContextualBalloon(t,"table"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(t){return(V,N,W)=>{this._isReady&&this.editor.execute(t,{value:W,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(t){const{commandName:V,viewField:N,validator:W,errorText:K}=t,G=debounce(()=>{N.errorText=K},ERROR_TEXT_TIMEOUT);return(Z,Y,X)=>{G.cancel(),this._isReady&&(W(X)?(this.editor.execute(V,{value:X,batch:this._undoStepBatch}),N.errorText=null):G())}}}class TableProperties extends Plugin{static get pluginName(){return"TableProperties"}static get requires(){return[TablePropertiesEditing,TablePropertiesUI]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function injectTableCaptionPostFixer(H){H.document.registerPostFixer(B=>tableCaptionPostFixer(B,H))}function tableCaptionPostFixer(H,B){const t=B.document.differ.getChanges();let V=!1;for(const N of t){if(N.type!="insert")continue;const W=N.position.parent;if(W.is("element","table")||N.name=="table"){const K=N.name=="table"?N.position.nodeAfter:W,G=Array.from(K.getChildren()).filter(Y=>Y.is("element","caption")),Z=G.shift();if(!Z)continue;for(const Y of G)H.move(H.createRangeIn(Y),Z,"end"),H.remove(Y);Z.nextSibling&&(H.move(H.createRangeOn(Z),K,"end"),V=!0),V=!!G.length||V}}return V}function isTable(H){return!!H&&H.is("element","table")}function getCaptionFromTableModelElement(H){for(const B of H.getChildren())if(B.is("element","caption"))return B;return null}function getCaptionFromModelSelection(H){const B=getSelectionAffectedTable(H);return B?getCaptionFromTableModelElement(B):null}function matchTableCaptionViewElement(H){const B=H.parent;return H.name=="figcaption"&&B&&B.is("element","figure")&&B.hasClass("table")?{name:!0}:H.name=="caption"&&B&&B.is("element","table")?{name:!0}:null}class ToggleTableCaptionCommand extends Command{refresh(){const B=this.editor,t=getSelectionAffectedTable(B.model.document.selection);this.isEnabled=!!t,this.isEnabled?this.value=!!getCaptionFromTableModelElement(t):this.value=!1}execute({focusCaptionOnShow:B=!1}={}){this.editor.model.change(t=>{this.value?this._hideTableCaption(t):this._showTableCaption(t,B)})}_showTableCaption(B,t){const V=this.editor.model,N=getSelectionAffectedTable(V.document.selection),G=this.editor.plugins.get("TableCaptionEditing")._getSavedCaption(N)||B.createElement("caption");V.insertContent(G,N,"end"),t&&B.setSelection(G,"in")}_hideTableCaption(B){const t=this.editor.model,V=getSelectionAffectedTable(t.document.selection),N=this.editor.plugins.get("TableCaptionEditing"),W=getCaptionFromTableModelElement(V);N._saveCaption(V,W),t.deleteContent(B.createSelection(W,"on"))}}class TableCaptionEditing extends Plugin{constructor(t){super(t);ee(this,"_savedCaptionsMap");this._savedCaptionsMap=new WeakMap}static get pluginName(){return"TableCaptionEditing"}init(){const t=this.editor,V=t.model.schema,N=t.editing.view,W=t.t;V.isRegistered("caption")?V.extend("caption",{allowIn:"table"}):V.register("caption",{allowIn:"table",allowContentOf:"$block",isLimit:!0}),t.commands.add("toggleTableCaption",new ToggleTableCaptionCommand(this.editor)),t.conversion.for("upcast").elementToElement({view:matchTableCaptionViewElement,model:"caption"}),t.conversion.for("dataDowncast").elementToElement({model:"caption",view:(K,{writer:G})=>isTable(K.parent)?G.createContainerElement("figcaption"):null}),t.conversion.for("editingDowncast").elementToElement({model:"caption",view:(K,{writer:G})=>{if(!isTable(K.parent))return null;const Z=G.createEditableElement("figcaption");return G.setCustomProperty("tableCaption",!0,Z),Z.placeholder=W("Enter table caption"),enablePlaceholder({view:N,element:Z,keepOnFocus:!0}),toWidgetEditable(Z,G)}}),injectTableCaptionPostFixer(t.model)}_getSavedCaption(t){const V=this._savedCaptionsMap.get(t);return V?Element.fromJSON(V):null}_saveCaption(t,V){this._savedCaptionsMap.set(t,V.toJSON())}}class TableCaptionUI extends Plugin{static get pluginName(){return"TableCaptionUI"}init(){const B=this.editor,t=B.editing.view,V=B.t;B.ui.componentFactory.add("toggleTableCaption",N=>{const W=B.commands.get("toggleTableCaption"),K=new ButtonView(N);return K.set({icon:icons.caption,tooltip:!0,isToggleable:!0}),K.bind("isOn","isEnabled").to(W,"value","isEnabled"),K.bind("label").to(W,"value",G=>V(G?"Toggle caption off":"Toggle caption on")),this.listenTo(K,"execute",()=>{if(B.execute("toggleTableCaption",{focusCaptionOnShow:!0}),W.value){const G=getCaptionFromModelSelection(B.model.document.selection),Z=B.editing.mapper.toViewElement(G);if(!Z)return;t.scrollToTheSelection(),t.change(Y=>{Y.addClass("table__caption_highlighted",Z)})}B.editing.view.focus()}),K})}}class TableCaption extends Plugin{static get pluginName(){return"TableCaption"}static get requires(){return[TableCaptionEditing,TableCaptionUI]}}class TableWidthsCommand extends Command{refresh(){this.isEnabled=!0}execute(B={}){const{model:t,plugins:V}=this.editor;let{table:N=t.document.selection.getSelectedElement(),columnWidths:W,tableWidth:K}=B;W&&(W=Array.isArray(W)?W:W.split(",")),t.change(G=>{K?G.setAttribute("tableWidth",K,N):G.removeAttribute("tableWidth",N);const Z=V.get("TableColumnResizeEditing").getColumnGroupElement(N);if(!W&&!Z)return;if(!W)return G.remove(Z);const Y=normalizeColumnWidths(W);if(Z)Array.from(Z.getChildren()).forEach((X,Q)=>G.setAttribute("columnWidth",Y[Q],X));else{const X=G.createElement("tableColumnGroup");Y.forEach(Q=>G.appendElement("tableColumn",{columnWidth:Q},X)),G.append(X,N)}})}}function upcastColgroupElement(H){return B=>B.on("element:colgroup",(t,V,N)=>{const W=V.modelCursor.findAncestor("table"),K=getColumnGroupElement(W);if(!K)return;const G=getTableColumnElements(K),Z=H.getColumns(W);let Y=translateColSpanAttribute(K,N.writer);Y=Array.from({length:Z},(X,Q)=>Y[Q]||"auto"),(Y.length!=G.length||Y.includes("auto"))&&updateColumnElements(G,K,normalizeColumnWidths(Y),N.writer)},{priority:"low"})}function downcastTableResizedClass(){return H=>H.on("insert:table",(B,t,V)=>{const N=V.writer,W=t.item,K=V.mapper.toViewElement(W),G=K.is("element","table")?K:Array.from(K.getChildren()).find(Y=>Y.is("element","table"));getColumnGroupElement(W)?N.addClass("ck-table-resized",G):N.removeClass("ck-table-resized",G)},{priority:"low"})}class TableColumnResizeEditing extends Plugin{constructor(t){super(t);ee(this,"_isResizingActive");ee(this,"_resizingData");ee(this,"_domEmitter");ee(this,"_tableUtilsPlugin");this._isResizingActive=!1,this.set("_isResizingAllowed",!0),this._resizingData=null,this._domEmitter=new(DomEmitterMixin()),this._tableUtilsPlugin=t.plugins.get("TableUtils"),this.on("change:_isResizingAllowed",(V,N,W)=>{const K=W?"removeClass":"addClass";t.editing.view.change(G=>{for(const Z of t.editing.view.document.roots)G[K]("ck-column-resize_disabled",t.editing.view.document.getRoot(Z.rootName))})})}static get requires(){return[TableEditing,TableUtils]}static get pluginName(){return"TableColumnResizeEditing"}init(){this._extendSchema(),this._registerPostFixer(),this._registerConverters(),this._registerResizingListeners(),this._registerResizerInserter();const t=this.editor,V=t.plugins.get("TableColumnResize");t.plugins.get("TableEditing").registerAdditionalSlot({filter:K=>K.is("element","tableColumnGroup"),positionOffset:0});const W=new TableWidthsCommand(t);t.commands.add("resizeTableWidth",W),t.commands.add("resizeColumnWidths",W),this.bind("_isResizingAllowed").to(t,"isReadOnly",V,"isEnabled",W,"isEnabled",(K,G,Z)=>!K&&G&&Z)}destroy(){this._domEmitter.stopListening(),super.destroy()}getColumnGroupElement(t){return getColumnGroupElement(t)}getTableColumnElements(t){return getTableColumnElements(t)}getTableColumnsWidths(t){return getTableColumnsWidths(t)}_extendSchema(){this.editor.model.schema.extend("table",{allowAttributes:["tableWidth"]}),this.editor.model.schema.register("tableColumnGroup",{allowIn:"table",isLimit:!0}),this.editor.model.schema.register("tableColumn",{allowIn:"tableColumnGroup",allowAttributes:["columnWidth","colSpan"],isLimit:!0})}_registerPostFixer(){const V=this.editor.model;V.document.registerPostFixer(K=>{let G=!1;for(const Z of getChangedResizedTables(V)){const Y=this.getColumnGroupElement(Z),X=this.getTableColumnElements(Y),Q=this.getTableColumnsWidths(Y);let te=normalizeColumnWidths(Q);te=N(te,Z,this),!isEqual(Q,te)&&(updateColumnElements(X,Y,te,K),G=!0)}return G});function N(K,G,Z){const Y=Z._tableUtilsPlugin.getColumns(G);if(Y-K.length===0)return K;const Q=K.map(ie=>Number(ie.replace("%",""))),te=W(Z.editor.model.document.differ,G);for(const ie of te){const ne=Y-Q.length;if(ne===0)continue;const le=ne>0,ae=Z._tableUtilsPlugin.getCellLocation(ie).column;if(le){const de=getColumnMinWidthAsPercentage(G,Z.editor),ce=createFilledArray(ne,de);Q.splice(ae,0,...ce)}else{const de=Q.splice(ae,Math.abs(ne));Q[ae]+=sumArray(de)}}return Q.map(ie=>ie+"%")}function W(K,G){const Z=new Set;for(const Y of K.getChanges())if(Y.type=="insert"&&Y.position.nodeAfter&&Y.position.nodeAfter.name=="tableCell"&&Y.position.nodeAfter.getAncestors().includes(G))Z.add(Y.position.nodeAfter);else if(Y.type=="remove"){const X=Y.position.nodeBefore||Y.position.nodeAfter;X.name=="tableCell"&&X.getAncestors().includes(G)&&Z.add(X)}return Z}}_registerConverters(){const V=this.editor.conversion;V.for("upcast").attributeToAttribute({view:{name:"figure",key:"style",value:{width:/[\s\S]+/}},model:{name:"table",key:"tableWidth",value:N=>N.getStyle("width")}}),V.for("downcast").attributeToAttribute({model:{name:"table",key:"tableWidth"},view:N=>({name:"figure",key:"style",value:{width:N}})}),V.elementToElement({model:"tableColumnGroup",view:"colgroup"}),V.elementToElement({model:"tableColumn",view:"col"}),V.for("downcast").add(downcastTableResizedClass()),V.for("upcast").add(upcastColgroupElement(this._tableUtilsPlugin)),V.for("upcast").attributeToAttribute({view:{name:"col",styles:{width:/.*/}},model:{key:"columnWidth",value:N=>{const W=N.getStyle("width");return!W||!W.endsWith("%")&&!W.endsWith("pt")?"auto":W}}}),V.for("upcast").attributeToAttribute({view:{name:"col",key:"span"},model:"colSpan"}),V.for("downcast").attributeToAttribute({model:{name:"tableColumn",key:"columnWidth"},view:N=>({key:"style",value:{width:N}})})}_registerResizingListeners(){const t=this.editor.editing.view;t.addObserver(MouseEventsObserver),t.document.on("mousedown",this._onMouseDownHandler.bind(this),{priority:"high"}),this._domEmitter.listenTo(global$1.window.document,"mousemove",throttle(this._onMouseMoveHandler.bind(this),50)),this._domEmitter.listenTo(global$1.window.document,"mouseup",this._onMouseUpHandler.bind(this))}_onMouseDownHandler(t,V){const N=V.target;if(!N.hasClass("ck-table-column-resizer")||!this._isResizingAllowed)return;const W=this.editor,K=W.editing.mapper.toModelElement(N.findAncestor("figure"));if(!W.model.canEditAt(K))return;V.preventDefault(),t.stop();const G=X(K,this._tableUtilsPlugin,W),Z=N.findAncestor("table"),Y=W.editing.view;Array.from(Z.getChildren()).find(ie=>ie.is("element","colgroup"))||Y.change(ie=>{Q(ie,G,Z)}),this._isResizingActive=!0,this._resizingData=this._getResizingData(V,G),Y.change(ie=>te(ie,Z,this._resizingData));function X(ie,ne,le){const ae=Array(ne.getColumns(ie)),de=new TableWalker(ie);for(const ce of de){const we=le.editing.mapper.toViewElement(ce.cell),be=le.editing.view.domConverter.mapViewToDom(we),ge=getDomCellOuterWidth(be);(!ae[ce.column]||ge<ae[ce.column])&&(ae[ce.column]=toPrecision(ge))}return ae}function Q(ie,ne,le){const ae=ie.createContainerElement("colgroup");for(let de=0;de<ne.length;de++){const ce=ie.createEmptyElement("col"),we=`${toPrecision(ne[de]/sumArray(ne)*100)}%`;ie.setStyle("width",we,ce),ie.insert(ie.createPositionAt(ae,"end"),ce)}ie.insert(ie.createPositionAt(le,0),ae)}function te(ie,ne,le){const ae=le.widths.viewFigureWidth/le.widths.viewFigureParentWidth;ie.addClass("ck-table-resized",ne),ie.addClass("ck-table-column-resizer__active",le.elements.viewResizer),ie.setStyle("width",`${toPrecision(ae*100)}%`,ne.findAncestor("figure"))}}_onMouseMoveHandler(t,V){if(!this._isResizingActive)return;if(!this._isResizingAllowed){this._onMouseUpHandler();return}const{columnPosition:N,flags:{isRightEdge:W,isTableCentered:K,isLtrContent:G},elements:{viewFigure:Z,viewLeftColumn:Y,viewRightColumn:X},widths:{viewFigureParentWidth:Q,tableWidth:te,leftColumnWidth:ie,rightColumnWidth:ne}}=this._resizingData,le=-ie+COLUMN_MIN_WIDTH_IN_PIXELS,ae=W?Q-te:ne-COLUMN_MIN_WIDTH_IN_PIXELS,de=(G?1:-1)*(W&&K?2:1),ce=clamp((V.clientX-N)*de,Math.min(le,0),Math.max(ae,0));ce!==0&&this.editor.editing.view.change(we=>{const be=toPrecision((ie+ce)*100/te);if(we.setStyle("width",`${be}%`,Y),W){const ge=toPrecision((te+ce)*100/Q);we.setStyle("width",`${ge}%`,Z)}else{const ge=toPrecision((ne-ce)*100/te);we.setStyle("width",`${ge}%`,X)}})}_onMouseUpHandler(){if(!this._isResizingActive)return;const{viewResizer:t,modelTable:V,viewFigure:N,viewColgroup:W}=this._resizingData.elements,K=this.editor,G=K.editing.view,Z=this.getColumnGroupElement(V),Y=Array.from(W.getChildren()).filter(ae=>ae.is("view:element")),X=Z?this.getTableColumnsWidths(Z):null,Q=Y.map(ae=>ae.getStyle("width")),te=!isEqual(X,Q),ie=V.getAttribute("tableWidth"),ne=N.getStyle("width"),le=ie!==ne;(te||le)&&(this._isResizingAllowed?K.execute("resizeTableWidth",{table:V,tableWidth:`${toPrecision(ne)}%`,columnWidths:Q}):G.change(ae=>{if(X)for(const de of Y)ae.setStyle("width",X.shift(),de);else ae.remove(W);le&&(ie?ae.setStyle("width",ie,N):ae.removeStyle("width",N)),!X&&!ie&&ae.removeClass("ck-table-resized",[...N.getChildren()].find(de=>de.name==="table"))})),G.change(ae=>{ae.removeClass("ck-table-column-resizer__active",t)}),this._isResizingActive=!1,this._resizingData=null}_getResizingData(t,V){const N=this.editor,W=t.domEvent.clientX,K=t.target,G=K.findAncestor("td")||K.findAncestor("th"),Z=N.editing.mapper.toModelElement(G),Y=Z.findAncestor("table"),X=getColumnEdgesIndexes(Z,this._tableUtilsPlugin).rightEdge,Q=this._tableUtilsPlugin.getColumns(Y)-1,te=X===Q,ie=!Y.hasAttribute("tableAlignment"),ne=N.locale.contentLanguageDirection!=="rtl",le=G.findAncestor("table"),ae=le.findAncestor("figure"),de=[...le.getChildren()].find(pe=>pe.is("element","colgroup")),ce=de.getChild(X),we=te?void 0:de.getChild(X+1),be=getElementWidthInPixels(N.editing.view.domConverter.mapViewToDom(ae.parent)),ge=getElementWidthInPixels(N.editing.view.domConverter.mapViewToDom(ae)),Ce=getTableWidthInPixels(Y,N),he=V[X],me=te?void 0:V[X+1];return{columnPosition:W,flags:{isRightEdge:te,isTableCentered:ie,isLtrContent:ne},elements:{viewResizer:K,modelTable:Y,viewFigure:ae,viewColgroup:de,viewLeftColumn:ce,viewRightColumn:we},widths:{viewFigureParentWidth:be,viewFigureWidth:ge,tableWidth:Ce,leftColumnWidth:he,rightColumnWidth:me}}}_registerResizerInserter(){this.editor.conversion.for("editingDowncast").add(t=>{t.on("insert:tableCell",(V,N,W)=>{const K=N.item,G=W.mapper.toViewElement(K),Z=W.writer;Z.insert(Z.createPositionAt(G,"end"),Z.createUIElement("div",{class:"ck-table-column-resizer"}))},{priority:"lowest"})})}}class TableColumnResize extends Plugin{static get requires(){return[TableColumnResizeEditing,TableCellWidthEditing]}static get pluginName(){return"TableColumnResize"}}const a$5={paintRoller:`<svg viewBox="0 0 20 20" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M3 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V3Z"/><path d="M16 3.25a1.5 1.5 0 0 1 1.5 1.5v1.7a2.25 2.25 0 0 1-1.932 2.226l-4.424.632a.75.75 0 0 0-.644.743V11a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-5a1 1 0 0 1 1-1v-.95a2.25 2.25 0 0 1 1.932-2.226l4.424-.632A.75.75 0 0 0 16 6.449V3.25Z"/></svg>
`,robotPencil:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.61 2.66a1.406 1.406 0 1 0-1.407 0v.891H3.28a2.11 2.11 0 0 0-2.11 2.11v10.312a2.11 2.11 0 0 0 2.11 2.109h5.684l-.054-1.157.18-.25H3.28a.703.703 0 0 1-.703-.702V5.66c0-.389.315-.704.703-.704h11.25c.388 0 .703.315.703.704v2.484l.358-.497a2.492 2.492 0 0 1 1.048-.84V5.66a2.11 2.11 0 0 0-2.11-2.11H9.61v-.89Z"/><path d="M5.625 10.817c.518 0 .937-.63.937-1.407 0-.776-.42-1.406-.937-1.406-.518 0-.938.63-.938 1.406 0 .777.42 1.407.938 1.407Z"/><path d="M13.125 9.41c0 .777-.42 1.407-.938 1.407s-.937-.63-.937-1.407c0-.776.42-1.406.937-1.406.518 0 .938.63.938 1.406Z"/><path d="M.937 8.004A.937.937 0 0 0 0 8.942v1.875c0 .517.42.937.937.937v-3.75Z"/><path d="M6.128 12.51a.782.782 0 0 1 1.085.216c.272.408.907.707 1.693.707s1.421-.3 1.693-.707a.782.782 0 0 1 1.302.868c-.666 1-1.906 1.403-2.995 1.403-1.089 0-2.329-.404-2.995-1.403a.782.782 0 0 1 .217-1.085Z"/><path d="m16.987 8.91-.622.864 2.879 2.074.622-.864a.71.71 0 0 0-.161-.99l-1.728-1.245a.71.71 0 0 0-.99.161Z"/><path d="M11.635 19.951a.355.355 0 0 1-.449-.31l-.214-2.38 4.978-6.911 2.88 2.074-4.978 6.91-2.217.617Z"/></svg>',tableOfContents:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 19a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8.022a6.47 6.47 0 0 0-1.5-.709V2a.5.5 0 0 0-.5-.5H3a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h6.313c.173.534.412 1.037.709 1.5H3Z"/><path d="M9.174 14a6.489 6.489 0 0 0-.155 1H6v-1h3.174Z"/><path d="M10.022 12c-.202.316-.378.65-.524 1H4v-1h6.022Z"/><path d="M12.034 10c-.448.283-.86.62-1.224 1H6v-1h6.034Z"/><path d="M12 4v1H4V4h8Z"/><path d="M14 7V6H6v1h8Z"/><path d="M15 9V8H7v1h8Z"/><path clip-rule="evenodd" d="M20 15.5a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM15.5 13a.5.5 0 0 0-.5.5V15h-1.5a.5.5 0 0 0 0 1H15v1.5a.5.5 0 0 0 1 0V16h1.5a.5.5 0 0 0 0-1H16v-1.5a.5.5 0 0 0-.5-.5Z"/></svg>
`,template:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M8 0H3a2 2 0 0 0-2 2v15a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2ZM2.5 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V2Z"/><path clip-rule="evenodd" d="M13 0h5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2Zm0 1.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5V2a.5.5 0 0 0-.5-.5h-5Z"/><path clip-rule="evenodd" d="M13 10h5a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2Zm0 1.5a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5h-5Z"/></svg>',caseChange:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.789 3 0 17h1.664l1.664-4.027h6.797l.227.548c.046-.172.112-.352.209-.545.217-.436.556-.609.898-.798L7.664 3H5.79Zm.938 1.758 2.777 6.715H3.949l2.778-6.715Z"/><path d="M15.956 7.5c-1.584-.02-3.226.824-3.843 2.882l1.495.106c.904-2.082 4.594-2.13 4.375.534-3.245 1.024-4.838.117-6.082 2.62-.208.418-.17 1.57.54 2.397.71.826 2.014 1.149 3.409.85 1.395-.299 2.24-1.386 2.24-1.386L18.205 17h1.493l-.059-1.72-.056-5.274C19.51 8.612 17.75 7.524 15.956 7.5Zm2.027 4.696s.641 2.453-1.528 3.27c-3.376 1.269-4.188-2.141-1.775-2.638 1.704-.352 1.873-.25 3.303-.632Z"/></svg>'};let r$4=class extends Command{constructor(t,V){super(t);ee(this,"_transformCallback");this._transformCallback=V}execute(){const t=this.editor.model,V=Array.from(this._getAffectedRanges()),N=Array.from(t.document.selection.getRanges());t.change(W=>{for(const K of V)this._modifyContent(K,W);W.setSelection(N)})}refresh(){for(const t of this._getAffectedRanges())for(const V of t)if(V.item.is("$textProxy"))return void(this.isEnabled=!0);this.isEnabled=!1}_getAffectedRanges(){const t=this.editor.model,V=t.document.selection;if(V.isCollapsed){const N=this._findAncestorTextBlock(V.getFirstPosition().parent);return N?[t.createRangeIn(N)]:[]}return V.getRanges()}_modifyContent(t,V){for(const N of this._getElementsAllowingText(t)){const W=this._getElementTextContent(N),K=this._transformCallback(W);for(const G of this._getTextNodesRangeLimited(N,t))this._replaceTextNodeData(G,K,V)}}_findAncestorTextBlock(t){const V=this.editor.model.schema;if(t.is("element")&&V.checkChild(t,"$text"))return t;const N=t.parent;return!N||V.isLimit(t)?null:this._findAncestorTextBlock(N)}*_getElementsAllowingText(t){const V=new Set;for(const{item:N}of t.getWalker()){const W=this._findAncestorTextBlock(N);W&&!V.has(W)&&(V.add(W),yield W)}}_getElementTextContent(t){return Array.from(t.getChildren()).reduce((V,N)=>V+(N.is("$text")?N.data:" "),"")}*_getTextNodesRangeLimited(t,V){const N=V.getIntersection(this.editor.model.createRangeIn(t));if(N)for(const W of N.getItems())W.is("$textProxy")&&W.parent==t&&(yield W)}_replaceTextNodeData(t,V,N){const W=V.substring(t.startOffset,t.endOffset);if(W===t.data)return;const K=t.getAttributes();this.editor.model.insertContent(N.createText(W,K),N.createSelection(N.createRangeOn(t)))}};function c$2(H,B,...t){const V=H.t;switch(B){case"Case change":return V("Case change");case"UPPERCASE":return V("UPPERCASE");case"lowercase":return V("lowercase");case"Title Case":return V("Title Case");case"Change text case":return V("Change text case");case"Changed case to %0":return V("Changed case to %0",...t);default:return B}}let s$2=class extends Plugin{constructor(){super(...arguments);ee(this,"_currentCommandIndex",0)}static get pluginName(){return"CaseChangeEditing"}init(){const t=this.editor,V=t.locale.contentLanguage,N=function(K=[]){return typeof K=="function"?K:(G,{wordIndex:Z})=>Z>0&&K.includes(G)}(t.config.get("caseChange.titleCase.excludeWords")),W={changeCaseUpper:new r$4(t,K=>K.toLocaleUpperCase(V)),changeCaseLower:new r$4(t,K=>K.toLocaleLowerCase(V)),changeCaseTitle:new r$4(t,K=>function(G,Z,Y){return function(X,Q){let te="",ie=0,ne=0;for(const ae of X.matchAll(/ +/g)){const de=ae.index,ce=X.substring(ie,de);ce.length&&(te+=Q(ce,ie,ne++)),te+=ae[0],ie=de+ae[0].length}const le=X.substring(ie);return le.length&&(te+=Q(le,ie,ne)),te}(G,(X,Q,te)=>{const ie=X.toLocaleLowerCase(Y);return Z(ie,{charOffset:Q,wordIndex:te,blockText:G})?ie:ie.replace(new RegExp("(?:^|[^\\p{L}\\d'])\\p{L}","gu"),ne=>ne.toLocaleUpperCase(Y))})}(K,N,V))};for(const[K,G]of Object.entries(W))t.commands.add(K,G),G.on("execute",()=>{this._announceCaseChangeOperation(K)});this.listenTo(t.editing.view.document,"selectionChange",()=>{this._currentCommandIndex=0}),t.keystrokes.set("shift+f3",(K,G)=>{const Z=y(this.editor.locale),Y=Z[this._currentCommandIndex%Z.length].commandName;t.execute(Y),this._currentCommandIndex++,G()})}_announceCaseChangeOperation(t){const{ui:V,locale:N}=this.editor,W=y(N).find(K=>K.commandName===t).label.toLowerCase();V.ariaLiveAnnouncer.announce(c$2(N,"Changed case to %0",W))}};function y(H){return[{label:c$2(H,"UPPERCASE"),commandName:"changeCaseUpper"},{label:c$2(H,"lowercase"),commandName:"changeCaseLower"},{label:c$2(H,"Title Case"),commandName:"changeCaseTitle"}]}class n extends Plugin{static get pluginName(){return"CaseChangeUI"}init(){const B=this.editor;this._registerComponents(),B.accessibility.addKeystrokeInfos({keystrokes:[{label:c$2(B.locale,"Change text case"),keystroke:"Shift+f3",mayRequireFn:!0}]})}afterInit(){(function(B){function t(N,W,K){const G={};G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},G[V([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],G[V([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],G[V([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],G[V([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],G[V([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],G[V([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],G[V([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],G[V([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],G[V([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],G[V([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Z=new Uint8Array(16);for(let ce=15;ce>=0;--ce)Z[ce]=K%256,K=parseInt(K/256);let Y=null,X=16;const Q=new Uint8Array(W),te=[],ie=[];de();for(let ce=0;ce<N[V([108,101,110,103,116,104])];ce++)X===16&&(Y=ae(Z),X=0,le(Z)),N[ce]^=Y[X++];return N;function ne(ce){const we=[];for(let be=0;be<ce[V([108,101,110,103,116,104])];be+=4)we[V([112,117,115,104])](ce[be]<<24|ce[be+1]<<16|ce[be+2]<<8|ce[be+3]);return we}function le(ce){for(let we=15;we>=0;we--){if(ce[we]!==255){ce[we]++;break}ce[we]=0}}function ae(ce){const we=te[V([108,101,110,103,116,104])]-1,be=[0,0,0,0];let ge=ne(ce);for(let me=0;me<4;me++)ge[me]^=te[0][me];for(let me=1;me<we;me++){for(let pe=0;pe<4;pe++)be[pe]=G[V([84,49])][ge[pe]>>24&255]^G[V([84,50])][ge[(pe+1)%4]>>16&255]^G[V([84,51])][ge[(pe+2)%4]>>8&255]^G[V([84,52])][255&ge[(pe+3)%4]]^te[me][pe];ge=be[V([115,108,105,99,101])]()}const Ce=new Uint8Array(16);let he;for(let me=0;me<4;me++)he=te[we][me],Ce[4*me]=255&(G[V([83])][ge[me]>>24&255]^he>>24),Ce[4*me+1]=255&(G[V([83])][ge[(me+1)%4]>>16&255]^he>>16),Ce[4*me+2]=255&(G[V([83])][ge[(me+2)%4]>>8&255]^he>>8),Ce[4*me+3]=255&(G[V([83])][255&ge[(me+3)%4]]^he);return Ce}function de(){const ce=G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Q[V([108,101,110,103,116,104])]];for(let _e=0;_e<=ce;_e++)te[V([112,117,115,104])]([0,0,0,0]),ie[V([112,117,115,104])]([0,0,0,0]);const we=4*(ce+1),be=Q[V([108,101,110,103,116,104])]/4,ge=ne(Q);let Ce;for(let _e=0;_e<be;_e++)Ce=_e>>2,te[Ce][_e%4]=ge[_e],ie[ce-Ce][_e%4]=ge[_e];let he,me=0,pe=be;for(;pe<we;){he=ge[be-1],ge[0]^=G[V([83])][he>>16&255]<<24^G[V([83])][he>>8&255]<<16^G[V([83])][255&he]<<8^G[V([83])][he>>24&255]^G[V([114,99,111,110])][me]<<24,me+=1;for(let Ae=1;Ae<be/2;Ae++)ge[Ae]^=ge[Ae-1];he=ge[be/2-1],ge[be/2]^=G[V([83])][255&he]^G[V([83])][he>>8&255]<<8^G[V([83])][he>>16&255]<<16^G[V([83])][he>>24&255]<<24;for(let Ae=be/2+1;Ae<be;Ae++)ge[Ae]^=ge[Ae-1];let _e,ye,Re=0;for(;Re<be&&pe<we;)_e=pe>>2,ye=pe%4,te[_e][ye]=ge[Re],ie[ce-_e][ye]=ge[Re++],pe++}for(let _e=1;_e<ce;_e++)for(let ye=0;ye<4;ye++)he=ie[_e][ye],ie[_e][ye]=G[V([85,49])][he>>24&255]^G[V([85,50])][he>>16&255]^G[V([85,51])][he>>8&255]^G[V([85,52])][255&he]}}function V(N){return N.map(W=>String.fromCharCode(W)).join("")}(N=>{function W(){const oe=[{[V([105,100])]:1,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,111,109,109,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([99,104,101,99,107,65,108,115,111])]:[{[V([105,100])]:2,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,114,97,99,107,32,67,104,97,110,103,101,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}}],[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:3,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:4,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[V([112,108,117,103,105,110,78,97,109,101])]:V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:5,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:6,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[V([112,108,117,103,105,110,78,97,109,101])]:V([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:7,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([83,108,97,115,104,32,67,111,109,109,97,110,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:8,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:9,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,101,109,112,108,97,116,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,101,109,112,108,97,116,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12,14]}},{[V([105,100])]:10,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:11,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([65,73,32,65,115,115,105,115,116,97,110,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([65,73,65,115,115,105,115,116,97,110,116,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([97,105,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:12,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[V([105,100])]:13,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,97,115,101,32,67,104,97,110,103,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,97,115,101,67,104,97,110,103,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:14,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,114,117,112,97,108,32,112,97,99,107]),[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[V([105,100])]:15,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:16,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,101,114,103,101,32,70,105,101,108,100,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,101,114,103,101,70,105,101,108,100,115,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}}];return xe(oe),oe;function se(fe){return 1<<fe-1}function xe(fe){fe[V([102,111,114,69,97,99,104])](ve=>{ve[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=se(ve[V([105,100])]),K(ve)&&ve[V([99,104,101,99,107,65,108,115,111])]&&xe(ve[V([99,104,101,99,107,65,108,115,111])])})}}function K(oe){return V([112,108,117,103,105,110,78,97,109,101])in oe}const G=[1,85,78,115,198,255,50,112,83,87,161],Z=[127,34,6,211,167,86,146,199,132,160,18];function Y(oe){const se=[29,221,175,90,231,133,239,240,75,180];return X(oe,new Uint8Array([...G,...se,...Z]))}function X(oe,se){const xe=Q(oe),fe=Array[V([102,114,111,109])](Je(xe)),ve=fe[V([112,111,112])](),Ie=fe[V([112,111,112])]();return Ye(t(fe,se,Ie+256*ve))}function Q(oe){const se=atob(oe),[xe,fe]=se[V([115,112,108,105,116])](V([45]));try{if(atob(fe))return atob(xe)}catch{}return se}function te(oe){try{const se=Y(oe),xe=JSON[V([112,97,114,115,101])](se),fe=parseInt(xe[V([49])]),ve=xe[V([50])]||"",Ie=parseInt(xe[V([51])]),Ne=parseInt(xe[V([52])])||0,De=parseInt(xe[V([53])])||0;return{[V([112,114,111,100,117,99,116,78,97,109,101])]:ve,[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:Ne,[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:fe,[V([105,115,84,114,105,97,108])]:Ie,[V([105,115,73,110,116,101,114,110,97,108])]:De}}catch{return null}}const ie=W(),ne={[V([99,104,101,99,107,76,105,99,101,110,115,101])]:Ce,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:he,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:me},le=N[V([99,111,110,115,116,114,117,99,116,111,114])][V([112,108,117,103,105,110,78,97,109,101])],ae=V([99,111,110,116,101,120,116])in N?N.context:N.editor,de=V([52,48,52,56,50,48,48,52]),ce=V([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),we=ae.config.get(V([108,105,99,101,110,115,101,75,101,121])),be=ie[V([102,105,108,116,101,114])](K)[V([102,105,110,100])](oe=>oe[V([112,108,117,103,105,110,78,97,109,101])]===le);function ge(oe,se){ne[se[V([104,97,110,100,108,101,114])]](oe,se),se[V([99,104,101,99,107,65,108,115,111])]&&se[V([99,104,101,99,107,65,108,115,111])][V([102,105,108,116,101,114])](xe=>Te(ae,xe[V([112,108,117,103,105,110,78,97,109,101])]))[V([102,111,114,69,97,99,104])](xe=>ge(oe,xe))}function Ce(oe,se){_e(pe(oe,se),se)}function he(oe,se){function xe(fe,ve){try{if(Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&fe){const Ie=ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[V([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Ie)/2>fe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}return pe(fe,ve)}catch{return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}_e(xe(oe,se),se)}function me(oe,se){const xe=Z[0]*G[1],fe=Z[0]*G[2],ve=Z[2]*G[2];Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&(window[Re()]=ve);function Ie(ue,Ee){try{return Xe()?ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):pe(ue,Ee)}catch{return ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function Ne(ue,Ee){if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))ze();else if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])){const Ve=De();Ve&&Le(Ve,Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const Oe=Qe();window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Le(V([116,105,109,101]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},Oe);const $e=ke(ae,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[V([95,114,101,118,105,115,105,111,110,115])];$e[V([108,101,110,103,116,104])]>=7?Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):$e.on(V([97,100,100]),()=>{$e[V([108,101,110,103,116,104])]>=7&&Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function De(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))){if(window[ue]===xe)return V([116,105,109,101]);if(window[ue]===fe)return V([114,101,118,105,115,105,111,110,115])}return!1}function Xe(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))&&window[ue]===ve)return!0;return!1}function Le(ue,Ee){ze(),ye(Ee+V([84,114,105,97,108,76,105,109,105,116,58])+ue),window[Re()]=ue===V([116,105,109,101])?xe:fe}function Qe(){let ue=Z[6]*G[8]*G[6];return Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ue/=10),ue}function ze(){const ue=ae;function Ee(){Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,112,100,97,116,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([115,97,118,101,82,101,118,105,115,105,111,110])]=Se,ue[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,ue[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,ue[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([95,103,101,116,68,105,102,102])]=Se)}ue[V([115,116,97,116,101])]==V([114,101,97,100,121])?Ee():ue[V([111,110,99,101])](V([114,101,97,100,121]),()=>{if(Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Ee(),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Me=ke(ue,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),Ve=Me.getRevision(0),Oe=Me.getEarlierVisibleRevision(Ve[V([105,100])]);ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])](Ve[V([105,100])],Oe?Oe[V([105,100])]:null,1).then(()=>Ee())}})}Ne(Ie(oe,se),se)}function pe(oe,se){try{return Ze(se)?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):oe&&Ke(oe[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],se)?oe[V([105,115,73,110,116,101,114,110,97,108])]&&!window[V([111,112,101,110])][V([99,108,111,115,101,100])]||parseInt(de)/2>oe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])):oe[V([105,115,84,114,105,97,108])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}catch{return ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function _e(oe,se){if(ae instanceof Context){const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Ae(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Ae(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Z[6]*G[8]*G[6]),xe[V([101,100,105,116,111,114,115])][V([111,110])](V([97,100,100]),(fe,ve)=>{oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Be(ve)})}else{const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Be(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&xe[V([111,110])](V([114,101,97,100,121]),()=>{let fe=0;xe[V([109,111,100,101,108])][V([111,110])](V([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(ve,Ie)=>{Ie[0][V([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&fe++,fe===504&&(Be(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),ve[V([111,102,102])]())},{priority:V([104,105,103,104,101,115,116])})})}}function ye(oe){const se=Re();return ae[se]=oe,oe}function Re(){const oe=String(window[V([112,101,114,102,111,114,109,97,110,99,101])][V([110,111,119])]())[V([114,101,112,108,97,99,101])](V([46]),"");let se="";for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe+=2){let fe=parseInt(oe[V([115,117,98,115,116,114,105,110,103])](xe,xe+2));fe>=ce[V([108,101,110,103,116,104])]&&(fe-=ce[V([108,101,110,103,116,104])]),se+=ce[fe]}return se}function Ae(oe){for(const se of oe[V([101,100,105,116,111,114,115])])Be(se);ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=Se}function Be(oe){function se(){oe[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,oe[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,oe[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))}oe[V([115,116,97,116,101])]==V([114,101,97,100,121])?se():oe[V([111,110,99,101])](V([114,101,97,100,121]),()=>se())}function Se(){return null}function Ke(oe,se){const xe=!!(oe&se[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),fe=je(oe,se);return xe||fe}function je(oe,se){const xe=(se[V([111,112,116,105,111,110,115])]||{})[V([102,103,105])]||null;return!!xe&&ie[V([102,105,108,116,101,114])](fe=>xe[V([105,110,99,108,117,100,101,115])](fe[V([105,100])]))[V([102,105,108,116,101,114])](fe=>!qe(fe))[V([115,111,109,101])](fe=>!!(oe&fe[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function qe(oe){const se={[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:Ge};return!!oe.forbiddenHandler&&se[oe.forbiddenHandler]()}function Ge(){return!window[V([68,114,117,112,97,108])]||!Te(ae,V([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function Ze(oe){if(!Te(ae,oe[V([112,108,117,103,105,110,78,97,109,101])]))return!0;const se=oe[V([111,112,116,105,111,110,115])]||{},xe=se[V([97,105,119,115,103,105,99])]||!1,fe=se[V([97,105,116,99,100,103,105,108])]||!1,ve=se[V([97,105,114,118,105,105,108])]||!1;return Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&xe||Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[V([114,101,115,117,108,116])]==V([101,110,100])&&fe?!0:!(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||ke(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[V([114,101,115,117,108,116])]!=V([101,110,100])||!ve)}function Te(oe,se){return oe[V([112,108,117,103,105,110,115])][V([104,97,115])](se)}function ke(oe,se){return oe[V([112,108,117,103,105,110,115])][V([103,101,116])](se)}function Ye(oe){let se="";for(const xe of oe)se+=String[V([102,114,111,109,67,104,97,114,67,111,100,101])](xe);return se}function Je(oe){const se=new Uint8Array(oe[V([108,101,110,103,116,104])]);for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe++)se[xe]=oe[V([99,104,97,114,67,111,100,101,65,116])](xe);return se}be&&ge(te(we),be)})(B)})(this)}_registerComponents(){const B=this.editor,{itemDefinitions:t,commands:V}=this._getListItemDefinitionsAndCommands();B.ui.componentFactory.add("caseChange",()=>this._createDropdownView(t,V)),B.ui.componentFactory.add("menuBar:caseChange",()=>this._createMenuBarMenuView(t,V))}_createMenuBarMenuView(B,t){const V=this.editor,N=V.locale,W=new MenuBarMenuView(N),K=new MenuBarMenuListView(N);K.set({ariaLabel:c$2(N,"Case change"),role:"menu"}),this._setButtonProperties(W.buttonView),W.bind("isEnabled").toMany(t,"isEnabled",(...G)=>G.some(Z=>Z));for(const G of B){const Z=new MenuBarMenuListItemView(N,W),Y=new MenuBarMenuListItemButtonView(N);Y.delegate("execute").to(W),Y.bind(...Object.keys(G.model)).to(G.model),Y.on("execute",()=>{V.execute(G.model.commandName),V.editing.view.focus()}),Z.children.add(Y),K.items.add(Z)}return W.panelView.children.add(K),W}_createDropdownView(B,t){const V=this.editor,N=createDropdown(V.locale);return this._setButtonProperties(N.buttonView),N.buttonView.set({tooltip:!0}),N.extendTemplate({attributes:{class:["ck-case-change-dropdown"]}}),addListToDropdown(N,B,{ariaLabel:c$2(V.locale,"Case change"),role:"menu"}),N.bind("isEnabled").toMany(t,"isEnabled",(...W)=>W.some(K=>K)),this.listenTo(N,"execute",W=>{V.execute(W.source.commandName),V.editing.view.focus()}),N}_setButtonProperties(B){const t=this.editor;B.set({label:c$2(t.locale,"Case change"),icon:a$5.caseChange,keystroke:"Shift+F3"})}_getListItemDefinitionsAndCommands(){const B=new Collection,t=[];for(const V of y(this.editor.locale)){const N=this.editor.commands.get(V.commandName),W=new Model({commandName:V.commandName,label:V.label,role:"menuitemradio",withText:!0});W.bind("isEnabled").to(N,"isEnabled"),B.add({type:"button",model:W}),t.push(N)}return{itemDefinitions:B,commands:t}}}let a$4=class extends Plugin{constructor(t){super(t);ee(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get requires(){return[s$2,n]}static get pluginName(){return"CaseChange"}init(){const t=this.editor;this.licenseKey=t.config.get("licenseKey");const V=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let N;for(const W in V){const K=W,G=V[K];if(G==="caseChangeLicenseKeyTrial"||G==="caseChangeLicenseKeyInvalid"||G==="caseChangeLicenseKeyValid"||G==="caseChangeLicenseKeyTrialLimit:operations"){delete V[K],N=G;break}}if(N==="caseChangeLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("case-change-invalid-license-key",null);if(N==="caseChangeLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 case change plugin with limited usage. Make sure you will not use it in the production environment."),N==="caseChangeLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("case-change-trial-license-key-reached-limit-changes",null);N==="caseChangeLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}};function a$3(){const H=[],B=[];for(const t of Array.from(document.styleSheets))if(t.ownerNode.hasAttribute("data-cke"))for(const V of Array.from(t.cssRules))V.cssText.indexOf(".ck-content")!==-1?H.push(V.cssText):V.cssText.indexOf(":root")!==-1&&B.push(V.cssText);return H.length||console.warn("The editor stylesheet could not be found in the document. Check your webpack config – style-loader should use data-cke=true attribute for the editor stylesheet."),[...B,...H].join(" ").trim()}function d$3(H,B){const t=H.t;switch(B){case"Export to PDF":return t("Export to PDF");case"An error occurred while generating the PDF.":return t("An error occurred while generating the PDF.");case"PDF export started":return t("PDF export started");case"PDF export failed":return t("PDF export failed");case"PDF export successful":return t("PDF export successful");case"Exporting PDF document":return t("Exporting PDF document");default:return B}}let o$3=class extends Command{constructor(B){super(B),this.set("isBusy",!1),this.affectsData=!1}refresh(){this.isEnabled=!this.isBusy,this.value=this.isBusy?"pending":void 0}execute(B={}){const t=this.editor,V=B.converterUrl||"https://pdf-converter.cke-cs.com/v1/convert/",N=B.dataCallback||(G=>G.data.get()),W=t.plugins.get("ExportPdf"),K=B.token||W._token;return this.isBusy=!0,this.refresh(),function(G){if(!G)return new Promise(Y=>Y(""));const Z=[];for(const Y of G)Y!=="EDITOR_STYLES"?Z.push(window.fetch(Y).then(X=>X.text())):Z.push(a$3());return Promise.all(Z).then(Y=>Y.join(" ").trim())}(B.stylesheets||["EDITOR_STYLES"]).then(async G=>{if(t.ui.ariaLiveAnnouncer.announce(d$3(t.locale,"PDF export started")),t.plugins.has("MergeFields")){B.converterOptions||(B.converterOptions={});const X=t.plugins.get("MergeFieldsEditing"),Q=X.previewMode,{prefix:te,suffix:ie}=t.config.get("mergeFields"),ne={prefix:te,suffix:ie,data:{}};if(Q==="$labels")for(const le of X.getMergeFieldsIds())ne.data[le]=te+X.getLabel(le)+ie;else{const le=Q==="$defaultValues"?X.getDefaultValues():X.getDataSetValues(Q,!0);for(const ae of Object.entries(le)){const[de,ce]=ae;ne.data[de]=ce!==null?ce:X.getLabel(de)}}B.converterOptions.merge_fields=ne}const Z={html:`<html>
						<head>
							<title>CKEditor 5 PDF document</title>
							<meta charset="utf-8">
						</head>
						<body>
							<div class="ck-content" dir="`+t.locale.contentLanguageDirection+`">
								`+await N(t)+`
							</div>
						</body>
					</html>`,css:G,options:B.converterOptions},Y={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/pdf",...K?{Authorization:K.value}:null,"x-cs-app-id":B.appID||"cke5"},body:JSON.stringify(Z)};return window.fetch(V,Y).then(X=>{if(X.status!==200)throw X;return X.blob()}).then(X=>{t.ui.ariaLiveAnnouncer.announce(d$3(t.locale,"PDF export successful"));const Q=typeof B.fileName=="function"?B.fileName():B.fileName;this._downloadFile(X,Q||"document.pdf")})}).catch(G=>{const Z=t.plugins.get("Notification");throw t.ui.ariaLiveAnnouncer.announce(d$3(t.locale,"PDF export failed"),{politeness:"assertive"}),Z.showWarning(d$3(t.locale,"An error occurred while generating the PDF.")),G}).finally(()=>{this.isBusy=!1,this.refresh()})}_downloadFile(B,t){const V=document.createElement("a");V.href=window.URL.createObjectURL(B),V.download=t,V.click(),V.remove()}},i$5=class extends Plugin{static get pluginName(){return"ExportPdfUI"}init(){const B=this.editor;B.ui.componentFactory.add("exportPdf",()=>{const t=this._createButton(ButtonView),V=B.commands.get("exportPdf");return t.set({tooltip:!0}),t.bind("isOn").to(V,"isBusy"),t}),B.ui.componentFactory.add("menuBar:exportPdf",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(B){const t=this.editor,V=t.config.get("exportPdf")||{},N=t.commands.get("exportPdf"),W=new B(t.locale),K=new SpinnerView;return W.children.add(K),K.bind("isVisible").to(N,"isBusy"),W.iconView.bind("isVisible").to(N,"isBusy",G=>!G),W.set({icon:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M19 4.5 14 0H3v6.5h1.5v-5h8v5h5V11H19V4.5ZM14 2l3.3 3H14V2Z"/><path d="m12.452 18.5 1.25 1.5H3v-3h1.5v1.5h7.952Z"/><path d="M19.826 16.843a.75.75 0 1 0-1.152-.96L17.5 17.29V13H16v4.29l-1.174-1.408a.75.75 0 1 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Z"/><path d="M1.63 14.24V12.3h.88c.66 0 1.14-.15 1.46-.45.32-.3.48-.71.48-1.24 0-.52-.15-.91-.44-1.2C3.7 9.15 3.28 9 2.69 9H0v5.24h1.63Zm.4-3h-.4v-1.17h.46c.3 0 .5.05.62.17.1.11.16.25.16.42 0 .16-.06.3-.19.41-.13.11-.34.16-.66.16l.01.01Zm5.7 3c.28 0 .6-.05.96-.14.26-.07.5-.21.73-.42.22-.2.4-.47.53-.77.12-.31.19-.75.19-1.3 0-.37-.04-.7-.13-1.02a2.3 2.3 0 0 0-.42-.84c-.19-.24-.43-.43-.72-.56C8.57 9.06 8.2 9 7.72 9h-2.4v5.24H7.73Zm-.4-1.19h-.4v-2.86h.4c.43 0 .73.1.91.3.18.2.27.59.27 1.14 0 .42-.04.73-.12.91a.76.76 0 0 1-.34.4c-.14.07-.38.11-.72.11Zm5.3 1.2V12.1h2.02v-1.06h-2.03v-.91H15V9h-4v5.24h1.62l.01.01Z"/></svg>
`}),W.bind("isEnabled").to(N,"isEnabled"),W.bind("label").to(N,"isBusy",G=>d$3(t.locale,G?"Exporting PDF document":"Export to PDF")),this.listenTo(W,"execute",()=>{t.execute("exportPdf",V),t.editing.view.focus()}),W}},s$1=class extends Plugin{constructor(){super(...arguments);ee(this,"_token")}static get pluginName(){return"ExportPdf"}static get requires(){return["CloudServices",Notification,i$5]}init(){const t=this.editor,V=t.config.get("exportPdf")||{};t.commands.add("exportPdf",new o$3(t));const N=t.plugins.get("CloudServices");V.tokenUrl===!1?this._token=null:V.tokenUrl?N.registerTokenUrl(V.tokenUrl).then(W=>{this._token=W}):this._token=N.token}};function f(){const H=[],B=[];for(const t of Array.from(document.styleSheets))if(t.ownerNode.hasAttribute("data-cke"))for(const V of Array.from(t.cssRules))V.cssText.indexOf(".ck-content")!==-1?H.push(V.cssText):V.cssText.indexOf(":root")!==-1&&B.push(V.cssText);return H.length||console.warn("The editor stylesheet could not be found in the document. Check your webpack config – style-loader should use data-cke=true attribute for the editor stylesheet."),[...B,...H].join(" ").trim()}function a$2(H,B={}){const t=H.plugins.has("Users"),V=H.plugins.has("CommentsRepository"),N=H.plugins.has("TrackChanges"),W=B;if(t&&V){const K=function(G){const Z={};if(!G.length)return Z;for(const Y of G)Y.comments.map(X=>{Z[Y.id]===void 0&&(Z[Y.id]=[]),Z[Y.id].push({author:X.author.name,content:X.content,created:X.createdAt,is_resolved:Y.isResolved})});return Z}(H.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,skipEmpty:!0}));Object.keys(K).length&&(W.comments=K)}if(t&&N){const K=H.plugins.get("TrackChanges"),G=H.plugins.get("Users"),Z=function(Y,X){const Q={};if(!Y.length||!X.length)return Q;for(const{id:te,createdAt:ie,authorId:ne,attributes:le}of Y){const ae=le&&le["@external"],de=ae?ae.authorName:X.get(ne).name;Q[te]={author:de,created:ie}}return Q}(K.getSuggestions({toJSON:!0}),G.users);Object.keys(Z).length&&(W.suggestions=Z)}return(W.suggestions||W.comments)&&(W.timezone=new Intl.DateTimeFormat().resolvedOptions().timeZone),W}function m$4(H,B={}){const t=H.plugins.has("Users"),V=H.plugins.has("CommentsRepository"),N=H.plugins.has("TrackChanges"),W=H.plugins.has("MergeFields"),K=H.locale.contentLanguage,G=B,Z={};if(G.document=G.document||{},G.document.language=G.document.language||K,t&&V){const Y=function(X){const Q=[];if(!X.length)return Q;for(const te of X){const ie=te.comments.map(ne=>({author:ne.author.name,content:ne.content,created_at:ne.createdAt}));Q.push({thread_id:te.id,is_resolved:te.isResolved,comments:ie})}return Q}(H.plugins.get("CommentsRepository").getCommentThreads({skipNotAttached:!0,skipEmpty:!0}));Y.length&&(Z.comment_threads=Y)}if(t&&N){const Y=H.plugins.get("TrackChanges"),X=H.plugins.get("Users"),Q=function(te,ie){return!te.length||!ie.length?[]:te.map(({id:ne,createdAt:le,authorId:ae,attributes:de})=>{const ce=de&&de["@external"];return{id:ne,author:ce?ce.authorName:ie.get(ae).name,created_at:le}})}(Y.getSuggestions({toJSON:!0}),X.users);Q.length&&(Z.suggestions=Q)}if(W){const Y=H.plugins.get("MergeFieldsEditing"),X=Y.previewMode,{prefix:Q,suffix:te}=H.config.get("mergeFields");if(G.merge_fields={prefix:Q,suffix:te},X!=="$labels"){G.merge_fields.data={};const ie=X==="$defaultValues"?Y.getDefaultValues():Y.getDataSetValues(X,!0);for(const ne of Object.entries(ie)){const[le,ae]=ne;G.merge_fields.data[le]=ae!==null?ae:Y.getLabel(le)}}}return(Z.comment_threads||Z.suggestions)&&(G.timezone=new Intl.DateTimeFormat().resolvedOptions().timeZone,G.collaboration_features=Z),G}function p$1(H,B){const t=H.t;switch(B){case"Export to Word":return t("Export to Word");case"An error occurred while generating the Word file.":return t("An error occurred while generating the Word file.");case"Word document export started":return t("Word document export started");case"Word document export failed":return t("Word document export failed");case"Word document export successful":return t("Word document export successful");case"Exporting Word document":return t("Exporting Word document");default:return B}}const h$2=["orientation","margin_top","margin_right","margin_bottom","margin_left","format","header","footer","comments","suggestions"];let e$2=class extends Command{constructor(B){super(B),this.set("isBusy",!1),this.affectsData=!1}refresh(){this.isEnabled=!this.isBusy,this.value=this.isBusy?"pending":void 0}execute(B={}){const t=this.editor,V=B.version||2,N=V===1,W=B.converterUrl||(N?"https://docx-converter.cke-cs.com/v1/convert":"https://docx-converter.cke-cs.com/v2/convert/html-docx"),K=B.converterOptions||{},G=t.plugins.get("ExportWord"),Z=B.token||G._token,Y=K.auto_pagination===!0,X=B.dataCallback||(Q=>Q.data.get({pagination:Y}));return V===2&&function(Q){for(const te of h$2)if(Q[te]!==void 0)return!0;return!1}(K)&&logWarning("export-word-v1-api-is-deprecated"),this.isBusy=!0,this.refresh(),function(Q){if(!Q)return new Promise(ie=>ie(""));const te=[];for(const ie of Q)ie!=="EDITOR_STYLES"?te.push(window.fetch(ie).then(ne=>ne.text())):te.push(f());return Promise.all(te).then(ie=>ie.join(" ").trim())}(B.stylesheets||["EDITOR_STYLES"]).then(async Q=>{t.ui.ariaLiveAnnouncer.announce(p$1(t.locale,"Word document export started"));const te=await X(t),ie={html:'<div class="ck-content" dir="'+t.locale.contentLanguageDirection+'">'+te+"</div>",css:Q,[N?"options":"config"]:{...K,...N?a$2(t,K):m$4(t,K)}},ne={method:"POST",headers:{"Content-Type":"application/json",Accept:"application/docx",...Z?{Authorization:Z.value}:null},body:JSON.stringify(ie)};return window.fetch(W,ne).then(le=>{if(le.status!==200)throw le;return le.blob()}).then(le=>{t.ui.ariaLiveAnnouncer.announce(p$1(t.locale,"Word document export successful"));const ae=typeof B.fileName=="function"?B.fileName():B.fileName;this._downloadFile(le,ae||"document.docx")})}).catch(Q=>{const te=t.plugins.get("Notification");throw t.ui.ariaLiveAnnouncer.announce(p$1(t.locale,"Word document export failed"),{politeness:"assertive"}),te.showWarning(p$1(t.locale,"An error occurred while generating the Word file.")),Q}).finally(()=>{this.isBusy=!1,this.refresh()})}_downloadFile(B,t){const V=document.createElement("a");V.href=window.URL.createObjectURL(B),V.download=t,V.click(),V.remove()}},i$4=class extends Plugin{static get pluginName(){return"ExportWordUI"}init(){const B=this.editor;B.ui.componentFactory.add("exportWord",()=>{const t=B.commands.get("exportWord"),V=this._createButton(ButtonView);return V.set({tooltip:!0}),V.bind("isOn").to(t,"isBusy"),V}),B.ui.componentFactory.add("menuBar:exportWord",()=>this._createButton(MenuBarMenuListItemButtonView))}_createButton(B){const t=this.editor,V=t.config.get("exportWord")||{},N=t.commands.get("exportWord"),W=new B(t.locale),K=new SpinnerView;return W.children.add(K),K.bind("isVisible").to(N,"isBusy"),W.iconView.bind("isVisible").to(N,"isBusy",G=>!G),W.set({icon:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.826 16.843a.75.75 0 0 0-1.152-.96L15.5 17.29V12H14v5.29l-1.174-1.408a.75.75 0 0 0-1.152.96l2.346 2.816a.95.95 0 0 0 1.46 0l2.346-2.815Z"/><path d="m14 0 5 4.5v9.741a2.737 2.737 0 0 0-1.5-.617V6.5h-5v-5h-8v3H3V0h11Zm0 2v3h3.3L14 2Z"/><path d="M3 17.5h6.746c.1.22.23.429.391.623l.731.877H3v-1.5Z"/><path d="M8.5 6a1.5 1.5 0 0 1 1.493 1.356L10 7.5v7a1.5 1.5 0 0 1-1.356 1.493L8.5 16h-7a1.5 1.5 0 0 1-1.493-1.356L0 14.5v-7a1.5 1.5 0 0 1 1.356-1.493L1.5 6h7ZM7.483 8.795l-.042.088-.986 2.534-.947-2.528-.043-.092a.601.601 0 0 0-1.042.008l-.042.093-.883 2.465-.937-2.475-.042-.089a.6.6 0 0 0-1.107.42l.027.093 1.514 4 .044.092a.6.6 0 0 0 1.041-.01l.041-.092.88-2.458.925 2.467.046.096a.6.6 0 0 0 1.032 0l.043-.09 1.554-4 .028-.093a.6.6 0 0 0-1.104-.43v.001Z"/></svg>
`}),W.bind("isEnabled").to(N,"isEnabled"),W.bind("label").to(N,"isBusy",G=>p$1(t.locale,G?"Exporting Word document":"Export to Word")),this.listenTo(W,"execute",()=>{t.execute("exportWord",V),t.editing.view.focus()}),W}};class s extends Plugin{constructor(){super(...arguments);ee(this,"_token")}static get pluginName(){return"ExportWord"}static get requires(){return["CloudServices",Notification,i$4]}init(){const t=this.editor,V=t.config.get("exportWord")||{};t.commands.add("exportWord",new e$2(t));const N=t.plugins.get("CloudServices");V.tokenUrl===!1?this._token=null:V.tokenUrl?N.registerTokenUrl(V.tokenUrl).then(W=>{this._token=W}):this._token=N.token}}const c$1="copyFormat",e$1="pasteFormat",A="ck-format-painter-active";let r$3=class extends Command{constructor(B){super(B),this.value=void 0,this.on("change:isEnabled",(t,V,N)=>{N||this.reset()}),this.on("change:value",()=>B.commands.get(e$1).refresh())}execute(){this.value=this._getFormattingAttributes()}reset(){this.value=void 0}_getFormattingAttributes(){const B=this.editor.model,t=B.document.selection;return Object.fromEntries(Array.from(t.getAttributes()).filter(([V])=>B.schema.getAttributeProperties(V).isFormatting))}},l$1=class extends Command{constructor(B){super(B),this._removeFormatCommand=new _(B)}execute(B={}){const t=this.editor.model,V=t.document.selection,N=Array.from(V.getRanges()),W=V.isCollapsed?[this._createRangeOnEntireWord(t,V)]:N;t.change(K=>{K.setSelection(W),this._removeFormatCommand.execute();for(const G in B)for(const Z of t.schema.getValidRanges(W,G))K.setAttribute(G,B[G],Z);K.setSelection(N)})}_createRangeOnEntireWord(B,t){const V=B.createSelection(t);B.modifySelection(V,{unit:"word",direction:"backward"});const N=V.getFirstPosition();B.modifySelection(V,{unit:"word",direction:"forward"});const W=V.getLastPosition();return B.createRange(N,W)}};class _ extends Command{execute(){const B=this.editor.model,t=B.schema;B.change(V=>{for(const N of this._getFormattingItems(B.document.selection,t))if(N.is("selection"))for(const W of this._getFormattingAttributes(N,t))V.removeSelectionAttribute(W);else{const W=V.createRangeOn(N);for(const K of this._getFormattingAttributes(N,t))V.removeAttribute(K,W)}})}*_getFormattingItems(B,t){const V=N=>!!first(this._getFormattingAttributes(N,t));for(const N of B.getRanges())for(const W of N.getItems())!t.isBlock(W)&&V(W)&&(yield W);for(const N of B.getSelectedBlocks())V(N)&&(yield N);V(B)&&(yield B)}*_getFormattingAttributes(B,t){for(const[V]of B.getAttributes()){const N=t.getAttributeProperties(V);N&&N.isFormatting&&(yield V)}}}let o$2=class extends Plugin{constructor(t){super(t);ee(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"FormatPainterEditing"}init(){const t=this.editor;t.commands.add(c$1,new r$3(t)),t.commands.add(e$1,new l$1(t)),this.licenseKey=t.config.get("licenseKey");const V=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let N;for(const W in V){const K=W,G=V[K];if(G==="formatPainterLicenseKeyTrial"||G==="formatPainterLicenseKeyInvalid"||G==="formatPainterLicenseKeyValid"||G==="formatPainterLicenseKeyTrialLimit:operations"){delete V[K],N=G;break}}if(N==="formatPainterLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("format-painter-invalid-license-key",null);if(N==="formatPainterLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 format painter plugin with limited usage. Make sure you will not use it in the production environment."),N==="formatPainterLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("format-painter-trial-license-key-reached-limit-changes",null);N==="formatPainterLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}};function C$1(H,B){const t=H.t;switch(B){case"Paint formatting":return t("Paint formatting");case"Copy text formatting":return t("Copy text formatting");case"Paste text formatting":return t("Paste text formatting");case"Continuous painting":return t("Continuous painting");case"Keeps the painter on after setting the formatting.":return t("Keeps the painter on after setting the formatting.");case"Formatting copied.":return t("Formatting copied.");case"Pasted formatting.":return t("Pasted formatting.");default:return B}}let a$1=class extends DomEmitterMixin(Plugin){static get pluginName(){return"FormatPainterUI"}init(){const B=this.editor;B.editing.view.addObserver(ClickObserver),B.accessibility.addKeystrokeInfos({keystrokes:[{label:C$1(B.locale,"Copy text formatting"),keystroke:"Ctrl+Alt+C"},{label:C$1(B.locale,"Paste text formatting"),keystroke:"Ctrl+Alt+V"}]}),B.ui.componentFactory.add("formatPainter",t=>{const V=createDropdown(t,SplitButtonView),N=B.commands.get(c$1);V.buttonView.set({label:C$1(B.locale,"Paint formatting"),icon:a$5.paintRoller,keystroke:"Ctrl+Alt+C",tooltip:!0}),V.class="ck-format-painter-dropdown",N&&(V.bind("isEnabled").to(N,"isEnabled"),this.listenTo(N,"change:isEnabled",(G,Z,Y)=>{Y||this._finishPainting()}),V.buttonView.bind("isOn").to(N,"value",G=>!!G),this.listenTo(B,"destroy",()=>this._toggleSpecialCursor(!1)),this.listenTo(N,"change:value",(G,Z,Y)=>{this._toggleSpecialCursor(!!Y)}));const W=new Model({withText:!0,label:C$1(B.locale,"Continuous painting"),tooltip:C$1(B.locale,"Keeps the painter on after setting the formatting."),isOn:!1,role:"menuitemcheckbox"});addListToDropdown(V,new Collection([{type:"switchbutton",model:W}]),{role:"menu"});const K=()=>{this._copyFormatting(),this.listenTo(global$1.window.document,"mouseup",()=>{this._pasteFormatting(),W.isOn||this._finishPainting()})};return this.listenTo(V,"execute",()=>{W.isOn=!W.isOn}),this.listenTo(V.buttonView,"execute",()=>{B.editing.view.focus(),V.buttonView.isOn?this._finishPainting():K()}),B.keystrokes.set("Ctrl+Alt+C",(G,Z)=>{K(),W.isOn=!0,Z()},{priority:"high"}),B.keystrokes.set("Ctrl+Alt+V",(G,Z)=>{V.buttonView.isOn&&(this._pasteFormatting(),W.isOn||this._finishPainting(),Z())},{priority:"high"}),B.keystrokes.set("Esc",(G,Z)=>{V.buttonView.isOn&&(W.isOn=!1,this._finishPainting(),Z())}),V})}afterInit(){(function(B){function t(N,W,K){const G={};G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},G[V([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],G[V([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],G[V([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],G[V([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],G[V([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],G[V([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],G[V([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],G[V([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],G[V([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],G[V([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Z=new Uint8Array(16);for(let ce=15;ce>=0;--ce)Z[ce]=K%256,K=parseInt(K/256);let Y=null,X=16;const Q=new Uint8Array(W),te=[],ie=[];de();for(let ce=0;ce<N[V([108,101,110,103,116,104])];ce++)X===16&&(Y=ae(Z),X=0,le(Z)),N[ce]^=Y[X++];return N;function ne(ce){const we=[];for(let be=0;be<ce[V([108,101,110,103,116,104])];be+=4)we[V([112,117,115,104])](ce[be]<<24|ce[be+1]<<16|ce[be+2]<<8|ce[be+3]);return we}function le(ce){for(let we=15;we>=0;we--){if(ce[we]!==255){ce[we]++;break}ce[we]=0}}function ae(ce){const we=te[V([108,101,110,103,116,104])]-1,be=[0,0,0,0];let ge=ne(ce);for(let me=0;me<4;me++)ge[me]^=te[0][me];for(let me=1;me<we;me++){for(let pe=0;pe<4;pe++)be[pe]=G[V([84,49])][ge[pe]>>24&255]^G[V([84,50])][ge[(pe+1)%4]>>16&255]^G[V([84,51])][ge[(pe+2)%4]>>8&255]^G[V([84,52])][255&ge[(pe+3)%4]]^te[me][pe];ge=be[V([115,108,105,99,101])]()}const Ce=new Uint8Array(16);let he;for(let me=0;me<4;me++)he=te[we][me],Ce[4*me]=255&(G[V([83])][ge[me]>>24&255]^he>>24),Ce[4*me+1]=255&(G[V([83])][ge[(me+1)%4]>>16&255]^he>>16),Ce[4*me+2]=255&(G[V([83])][ge[(me+2)%4]>>8&255]^he>>8),Ce[4*me+3]=255&(G[V([83])][255&ge[(me+3)%4]]^he);return Ce}function de(){const ce=G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Q[V([108,101,110,103,116,104])]];for(let _e=0;_e<=ce;_e++)te[V([112,117,115,104])]([0,0,0,0]),ie[V([112,117,115,104])]([0,0,0,0]);const we=4*(ce+1),be=Q[V([108,101,110,103,116,104])]/4,ge=ne(Q);let Ce;for(let _e=0;_e<be;_e++)Ce=_e>>2,te[Ce][_e%4]=ge[_e],ie[ce-Ce][_e%4]=ge[_e];let he,me=0,pe=be;for(;pe<we;){he=ge[be-1],ge[0]^=G[V([83])][he>>16&255]<<24^G[V([83])][he>>8&255]<<16^G[V([83])][255&he]<<8^G[V([83])][he>>24&255]^G[V([114,99,111,110])][me]<<24,me+=1;for(let Ae=1;Ae<be/2;Ae++)ge[Ae]^=ge[Ae-1];he=ge[be/2-1],ge[be/2]^=G[V([83])][255&he]^G[V([83])][he>>8&255]<<8^G[V([83])][he>>16&255]<<16^G[V([83])][he>>24&255]<<24;for(let Ae=be/2+1;Ae<be;Ae++)ge[Ae]^=ge[Ae-1];let _e,ye,Re=0;for(;Re<be&&pe<we;)_e=pe>>2,ye=pe%4,te[_e][ye]=ge[Re],ie[ce-_e][ye]=ge[Re++],pe++}for(let _e=1;_e<ce;_e++)for(let ye=0;ye<4;ye++)he=ie[_e][ye],ie[_e][ye]=G[V([85,49])][he>>24&255]^G[V([85,50])][he>>16&255]^G[V([85,51])][he>>8&255]^G[V([85,52])][255&he]}}function V(N){return N.map(W=>String.fromCharCode(W)).join("")}(N=>{function W(){const oe=[{[V([105,100])]:1,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,111,109,109,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([99,104,101,99,107,65,108,115,111])]:[{[V([105,100])]:2,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,114,97,99,107,32,67,104,97,110,103,101,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}}],[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:3,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:4,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[V([112,108,117,103,105,110,78,97,109,101])]:V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:5,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:6,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[V([112,108,117,103,105,110,78,97,109,101])]:V([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:7,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([83,108,97,115,104,32,67,111,109,109,97,110,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:8,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:9,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,101,109,112,108,97,116,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,101,109,112,108,97,116,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12,14]}},{[V([105,100])]:10,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:11,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([65,73,32,65,115,115,105,115,116,97,110,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([65,73,65,115,115,105,115,116,97,110,116,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([97,105,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:12,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[V([105,100])]:13,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,97,115,101,32,67,104,97,110,103,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,97,115,101,67,104,97,110,103,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:14,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,114,117,112,97,108,32,112,97,99,107]),[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[V([105,100])]:15,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:16,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,101,114,103,101,32,70,105,101,108,100,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,101,114,103,101,70,105,101,108,100,115,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}}];return xe(oe),oe;function se(fe){return 1<<fe-1}function xe(fe){fe[V([102,111,114,69,97,99,104])](ve=>{ve[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=se(ve[V([105,100])]),K(ve)&&ve[V([99,104,101,99,107,65,108,115,111])]&&xe(ve[V([99,104,101,99,107,65,108,115,111])])})}}function K(oe){return V([112,108,117,103,105,110,78,97,109,101])in oe}const G=[1,85,78,115,198,255,50,112,83,87,161],Z=[127,34,6,211,167,86,146,199,132,160,18];function Y(oe){const se=[29,221,175,90,231,133,239,240,75,180];return X(oe,new Uint8Array([...G,...se,...Z]))}function X(oe,se){const xe=Q(oe),fe=Array[V([102,114,111,109])](Je(xe)),ve=fe[V([112,111,112])](),Ie=fe[V([112,111,112])]();return Ye(t(fe,se,Ie+256*ve))}function Q(oe){const se=atob(oe),[xe,fe]=se[V([115,112,108,105,116])](V([45]));try{if(atob(fe))return atob(xe)}catch{}return se}function te(oe){try{const se=Y(oe),xe=JSON[V([112,97,114,115,101])](se),fe=parseInt(xe[V([49])]),ve=xe[V([50])]||"",Ie=parseInt(xe[V([51])]),Ne=parseInt(xe[V([52])])||0,De=parseInt(xe[V([53])])||0;return{[V([112,114,111,100,117,99,116,78,97,109,101])]:ve,[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:Ne,[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:fe,[V([105,115,84,114,105,97,108])]:Ie,[V([105,115,73,110,116,101,114,110,97,108])]:De}}catch{return null}}const ie=W(),ne={[V([99,104,101,99,107,76,105,99,101,110,115,101])]:Ce,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:he,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:me},le=N[V([99,111,110,115,116,114,117,99,116,111,114])][V([112,108,117,103,105,110,78,97,109,101])],ae=V([99,111,110,116,101,120,116])in N?N.context:N.editor,de=V([52,48,52,56,50,48,48,52]),ce=V([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),we=ae.config.get(V([108,105,99,101,110,115,101,75,101,121])),be=ie[V([102,105,108,116,101,114])](K)[V([102,105,110,100])](oe=>oe[V([112,108,117,103,105,110,78,97,109,101])]===le);function ge(oe,se){ne[se[V([104,97,110,100,108,101,114])]](oe,se),se[V([99,104,101,99,107,65,108,115,111])]&&se[V([99,104,101,99,107,65,108,115,111])][V([102,105,108,116,101,114])](xe=>Te(ae,xe[V([112,108,117,103,105,110,78,97,109,101])]))[V([102,111,114,69,97,99,104])](xe=>ge(oe,xe))}function Ce(oe,se){_e(pe(oe,se),se)}function he(oe,se){function xe(fe,ve){try{if(Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&fe){const Ie=ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[V([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Ie)/2>fe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}return pe(fe,ve)}catch{return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}_e(xe(oe,se),se)}function me(oe,se){const xe=Z[0]*G[1],fe=Z[0]*G[2],ve=Z[2]*G[2];Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&(window[Re()]=ve);function Ie(ue,Ee){try{return Xe()?ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):pe(ue,Ee)}catch{return ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function Ne(ue,Ee){if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))ze();else if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])){const Ve=De();Ve&&Le(Ve,Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const Oe=Qe();window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Le(V([116,105,109,101]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},Oe);const $e=ke(ae,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[V([95,114,101,118,105,115,105,111,110,115])];$e[V([108,101,110,103,116,104])]>=7?Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):$e.on(V([97,100,100]),()=>{$e[V([108,101,110,103,116,104])]>=7&&Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function De(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))){if(window[ue]===xe)return V([116,105,109,101]);if(window[ue]===fe)return V([114,101,118,105,115,105,111,110,115])}return!1}function Xe(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))&&window[ue]===ve)return!0;return!1}function Le(ue,Ee){ze(),ye(Ee+V([84,114,105,97,108,76,105,109,105,116,58])+ue),window[Re()]=ue===V([116,105,109,101])?xe:fe}function Qe(){let ue=Z[6]*G[8]*G[6];return Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ue/=10),ue}function ze(){const ue=ae;function Ee(){Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,112,100,97,116,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([115,97,118,101,82,101,118,105,115,105,111,110])]=Se,ue[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,ue[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,ue[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([95,103,101,116,68,105,102,102])]=Se)}ue[V([115,116,97,116,101])]==V([114,101,97,100,121])?Ee():ue[V([111,110,99,101])](V([114,101,97,100,121]),()=>{if(Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Ee(),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Me=ke(ue,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),Ve=Me.getRevision(0),Oe=Me.getEarlierVisibleRevision(Ve[V([105,100])]);ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])](Ve[V([105,100])],Oe?Oe[V([105,100])]:null,1).then(()=>Ee())}})}Ne(Ie(oe,se),se)}function pe(oe,se){try{return Ze(se)?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):oe&&Ke(oe[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],se)?oe[V([105,115,73,110,116,101,114,110,97,108])]&&!window[V([111,112,101,110])][V([99,108,111,115,101,100])]||parseInt(de)/2>oe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])):oe[V([105,115,84,114,105,97,108])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}catch{return ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function _e(oe,se){if(ae instanceof Context){const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Ae(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Ae(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Z[6]*G[8]*G[6]),xe[V([101,100,105,116,111,114,115])][V([111,110])](V([97,100,100]),(fe,ve)=>{oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Be(ve)})}else{const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Be(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&xe[V([111,110])](V([114,101,97,100,121]),()=>{let fe=0;xe[V([109,111,100,101,108])][V([111,110])](V([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(ve,Ie)=>{Ie[0][V([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&fe++,fe===504&&(Be(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),ve[V([111,102,102])]())},{priority:V([104,105,103,104,101,115,116])})})}}function ye(oe){const se=Re();return ae[se]=oe,oe}function Re(){const oe=String(window[V([112,101,114,102,111,114,109,97,110,99,101])][V([110,111,119])]())[V([114,101,112,108,97,99,101])](V([46]),"");let se="";for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe+=2){let fe=parseInt(oe[V([115,117,98,115,116,114,105,110,103])](xe,xe+2));fe>=ce[V([108,101,110,103,116,104])]&&(fe-=ce[V([108,101,110,103,116,104])]),se+=ce[fe]}return se}function Ae(oe){for(const se of oe[V([101,100,105,116,111,114,115])])Be(se);ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=Se}function Be(oe){function se(){oe[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,oe[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,oe[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))}oe[V([115,116,97,116,101])]==V([114,101,97,100,121])?se():oe[V([111,110,99,101])](V([114,101,97,100,121]),()=>se())}function Se(){return null}function Ke(oe,se){const xe=!!(oe&se[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),fe=je(oe,se);return xe||fe}function je(oe,se){const xe=(se[V([111,112,116,105,111,110,115])]||{})[V([102,103,105])]||null;return!!xe&&ie[V([102,105,108,116,101,114])](fe=>xe[V([105,110,99,108,117,100,101,115])](fe[V([105,100])]))[V([102,105,108,116,101,114])](fe=>!qe(fe))[V([115,111,109,101])](fe=>!!(oe&fe[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function qe(oe){const se={[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:Ge};return!!oe.forbiddenHandler&&se[oe.forbiddenHandler]()}function Ge(){return!window[V([68,114,117,112,97,108])]||!Te(ae,V([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function Ze(oe){if(!Te(ae,oe[V([112,108,117,103,105,110,78,97,109,101])]))return!0;const se=oe[V([111,112,116,105,111,110,115])]||{},xe=se[V([97,105,119,115,103,105,99])]||!1,fe=se[V([97,105,116,99,100,103,105,108])]||!1,ve=se[V([97,105,114,118,105,105,108])]||!1;return Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&xe||Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[V([114,101,115,117,108,116])]==V([101,110,100])&&fe?!0:!(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||ke(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[V([114,101,115,117,108,116])]!=V([101,110,100])||!ve)}function Te(oe,se){return oe[V([112,108,117,103,105,110,115])][V([104,97,115])](se)}function ke(oe,se){return oe[V([112,108,117,103,105,110,115])][V([103,101,116])](se)}function Ye(oe){let se="";for(const xe of oe)se+=String[V([102,114,111,109,67,104,97,114,67,111,100,101])](xe);return se}function Je(oe){const se=new Uint8Array(oe[V([108,101,110,103,116,104])]);for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe++)se[xe]=oe[V([99,104,97,114,67,111,100,101,65,116])](xe);return se}be&&ge(te(we),be)})(B)})(this)}_toggleSpecialCursor(B){this.editor.editing.view.change(t=>{for(const V of this.editor.editing.view.document.roots)B?t.addClass(A,V):t.removeClass(A,V)})}_copyFormatting(){const{editor:B}=this;B.execute(c$1),B.ui.ariaLiveAnnouncer.announce(C$1(B.locale,"Formatting copied."))}_pasteFormatting(){const{editor:B}=this,t=B.commands.get(c$1).value;B.execute(e$1,t),B.ui.ariaLiveAnnouncer.announce(C$1(B.locale,"Pasted formatting."))}_finishPainting(){this.editor.commands.get(c$1).reset(),this.stopListening(global$1.window.document,"mouseup")}},m$3=class extends Plugin{static get requires(){return[o$2,a$1]}static get pluginName(){return"FormatPainter"}};function p(H,B){const t=H.t;switch(B){case"Import from Word":return t("Import from Word");case"An error occurred while importing the Word file.":return t("An error occurred while importing the Word file.");case"Importing Word document":return t("Importing Word document");default:return B}}let o$1=class extends Plugin{static get pluginName(){return"ImportWordUI"}init(){const B=this.editor;B.ui.componentFactory.add("importWord",()=>{const t=this._createButton(FileDialogButtonView),V=B.commands.get("importWord");return t.bind("isOn").to(V,"isBusy"),t.tooltip=!0,t}),B.ui.componentFactory.add("menuBar:importWord",()=>this._createButton(MenuBarMenuListItemFileDialogButtonView))}_createButton(B){const t=this.editor,V=t.commands.get("importWord"),N=new B(t.locale),W=new SpinnerView;return N.set({acceptedType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template"}),N.set({icon:`<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14 0 5 4.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0 2v3h3.3L14 2Z"/><path d="M10.74 18a2.76 2.76 0 0 1-.469-.5H3V19h9.25v-.374A2.737 2.737 0 0 1 10.74 18Z"/><path d="M8.5 6a1.5 1.5 0 0 1 1.493 1.356L10 7.5v7a1.5 1.5 0 0 1-1.356 1.493L8.5 16h-7a1.5 1.5 0 0 1-1.493-1.356L0 14.5v-7a1.5 1.5 0 0 1 1.356-1.493L1.5 6h7ZM7.483 8.795l-.042.088-.986 2.534-.947-2.528-.043-.092a.601.601 0 0 0-1.042.008l-.042.093-.883 2.465-.937-2.475-.042-.089a.6.6 0 0 0-1.107.42l.027.093 1.514 4 .044.092a.6.6 0 0 0 1.041-.01l.041-.092.88-2.458.925 2.467.046.096a.602.602 0 0 0 1.032 0l.043-.09 1.554-4 .028-.093a.6.6 0 0 0-1.104-.43v.001ZM11.674 15.407a.75.75 0 1 0 1.152.96L14 14.96V20h1.5v-5.04l1.174 1.408a.75.75 0 1 0 1.152-.96l-2.346-2.816a.95.95 0 0 0-1.46 0l-2.346 2.815Z"/></svg>
`}),N.bind("isEnabled").to(V),N.bind("label").to(V,"isBusy",K=>p(t.locale,K?"Importing Word document":"Import from Word")),W.bind("isVisible").to(V,"isBusy"),N.iconView.bind("isVisible").to(V,"isBusy",K=>!K),N.children.add(W),N.on("done",(K,G)=>{t.execute("importWord",G[0],{}),t.editing.view.focus()}),N}},d$2=class extends Command{constructor(t){super(t);ee(this,"_importMarker");ee(this,"_undoStepBatch");ee(this,"_abortController");this.set("isBusy",!1),this._importMarker=null,this._undoStepBatch=null,this._abortController=null,this.on("dataInsert",(V,N)=>{const W=new DataTransfer;W.setData("text/html",N.html);const K=this._importMarker.getRange();this.editor.model.enqueueChange(this._undoStepBatch,G=>{this._importMarker.stopListening(),G.setSelection(K),t.editing.view.document.fire("clipboardInput",{dataTransfer:W})})},{priority:"low"})}refresh(){this.isEnabled=this._checkEnabled()}execute(t,V={}){if(this.isBusy)return Promise.resolve();const N=this.editor.config.get("importWord");if(this.editor.plugins.has("MergeFields")){const{prefix:K,suffix:G}=this.editor.config.get("mergeFields");V.merge_fields={prefix:K,suffix:G}}const W={url:N.converterUrl,file:t,serviceConfig:{...V,formatting:N.formatting,timezone:new Intl.DateTimeFormat().resolvedOptions().timeZone}};return this._prepareForImport(),this._sendImportRequest(W).then(this._handleImportResponse.bind(this)).catch(this._handleImportFailure.bind(this)).finally(this._cleanUpAfterImport.bind(this))}_checkEnabled(){if(this.isBusy)return!1;const t=this.editor.model,V=t.schema,N=t.document.selection,W=first(N.getSelectedBlocks());return!!W&&V.checkChild(W.parent,"paragraph")}_prepareForImport(){const t=this.editor,V=t.model,N=V.document.selection;this._abortController=new AbortController,this._undoStepBatch=t.model.createBatch({isUndoable:!0}),V.enqueueChange(this._undoStepBatch,W=>{N.isCollapsed||V.deleteContent(N,{leaveUnmerged:!0});const K=N.getFirstPosition(),G=first(N.getSelectedBlocks());let Z;Z=G.is("element","paragraph")&&G.isEmpty?K:K.isAtStart?V.createPositionBefore(G):K.isAtEnd?V.createPositionAfter(G):W.split(K).position,this._importMarker=W.addMarker("importWord:"+uid(),{usingOperation:!1,affectsData:!1,range:new Range(Z)}),this._importMarker.on("change:range",()=>{this._importMarker.getRange().root.rootName==="$graveyard"&&this._abortController.abort()})}),this.isBusy=!0,this.refresh()}_cleanUpAfterImport(){const t=this.editor.model;t.markers.has(this._importMarker)&&t.enqueueChange(this._undoStepBatch,V=>{V.removeMarker(this._importMarker)}),this._importMarker=null,this._undoStepBatch=null,this._abortController=null,this.isBusy=!1,this.refresh()}_sendImportRequest({url:t,file:V,serviceConfig:N}){const W=this.editor.plugins.get("ImportWordEditing").getToken(),K=new FormData;K.set("config",JSON.stringify(N)),K.set("file",V);const G={method:"POST",headers:{},body:K,signal:this._abortController.signal};return W&&(G.headers.Authorization=W.value),fetch(t,G)}_handleImportResponse(t){return t.ok?t.json().then(V=>{this.editor.model.markers.has(this._importMarker)&&this._importMarker.getRange().root.rootName!=="$graveyard"&&this.fire("dataInsert",V)}):Promise.reject()}_handleImportFailure(){if(this._abortController.signal.aborted)return void logWarning("import-word-plugin-import-cancelled");const t=this.editor,V=p(t.locale,"An error occurred while importing the Word file.");t.plugins.get("Notification").showWarning(V),logError("import-word-plugin-conversion-failed")}};class e extends Plugin{constructor(t){super(t);ee(this,"_token");this._token=null}static get pluginName(){return"ImportWordEditing"}static get requires(){return[Notification,ClipboardPipeline,"CloudServices"]}async init(){const t=this.editor;t.config.define("importWord",{converterUrl:"https://docx-converter.cke-cs.com/v2/convert/docx-html",tokenUrl:(t.config.get("cloudServices")||{}).tokenUrl,formatting:{resets:"none",defaults:"none",styles:"inline"}}),t.commands.add("importWord",new d$2(t));const{tokenUrl:V}=t.config.get("importWord");if(V){const{tokenUrl:N}=t.config.get("cloudServices")||{};this._token=V===N?t.plugins.get("CloudServices").token:await t.plugins.get("CloudServices").registerTokenUrl(V)}}getToken(){return this._token}}let i$3=class extends Plugin{static get pluginName(){return"ImportWord"}static get requires(){return[e,o$1]}},r$2=class extends Command{refresh(){const B=this.editor.model,t=B.schema.checkChild(B.document.selection.focus,"mergeField");this.isEnabled=t}execute(B){if(!B||typeof B!="string")return;const t=this.editor.model;t.change(V=>{t.deleteContent(t.document.selection);const N=V.createElement("mergeField",{id:B});for(const[W,K]of t.document.selection.getAttributes())t.schema.checkAttribute(N,W)&&V.setAttribute(W,K,N);t.insertContent(N,t.document.selection,0,{setSelection:"after"})})}},i$2=class extends Command{refresh(){const B=this.editor.model,t=B.document.selection;this.isEnabled=function(V,N){let K=findOptimalInsertionRange(V,N).start.parent;return K.isEmpty&&!N.schema.isLimit(K)&&(K=K.parent),N.schema.checkChild(K,"mergeFieldBlock")}(t,B)}execute(B,t){if(!B||typeof B!="string")return;const V=this.editor.model;V.change(N=>{const W=N.createElement("mergeFieldBlock",{id:B});V.insertObject(W,V.document.selection,null,{setSelection:"on",findOptimalPosition:t===!1?void 0:"auto"})})}};class w extends Command{constructor(B){super(B);const t=this.editor.plugins.get("MergeFieldsEditing");this.bind("value").to(t,"previewMode"),this.affectsData=!1}refresh(){this.isEnabled=!0}execute(B){this.editor.plugins.get("MergeFieldsEditing").previewMode=B}}let m$2=class extends Plugin{static get pluginName(){return"MergeFieldsEditing"}constructor(B){super(B),this.flattenedMergeFieldDefinitions=[],B.config.define("mergeFields.previewModes",["$labels","$defaultValues","$dataSets"]),B.config.define("mergeFields.dataSets",[]),B.config.define("mergeFields.definitions",[]),B.config.define("mergeFields.prefix","{{"),B.config.define("mergeFields.suffix","}}"),B.config.define("mergeFields.previewHtmlValues",!1),B.config.define("mergeFields.sanitizeHtml",W=>(logWarning("merge-fields-provide-sanitize-function"),{html:W,hasChanged:!1})),this._mergeFieldPrefix=B.config.get("mergeFields.prefix"),this._mergeFieldSuffix=B.config.get("mergeFields.suffix"),this._shouldPreviewHtmlValues=B.config.get("mergeFields.previewHtmlValues"),this.flattenedMergeFieldDefinitions=this._getFlattenedMergeFieldDefinitions(),this._validateConfig();const t="\\"+this._mergeFieldPrefix.split("").join("\\"),V="\\"+this._mergeFieldSuffix.split("").join("\\");this._mergeFieldRegExp=new RegExp("("+t+"[^"+(t+V)+" ]+"+V+")","g"),this.availablePreviewModes=this._getAvailablePreviewModes();const N=B.config.get("mergeFields.initialPreviewMode")||this.availablePreviewModes[0];this._validatePreviewMode(N),this.set("previewMode",N),this._mergeFieldElements=new Set,this._licenseKeyCheckInterval=null}init(){const B=this.editor;B.commands.add("insertMergeField",new r$2(B)),B.commands.add("insertMergeFieldBlock",new i$2(B)),B.commands.add("previewMergeFields",new w(B)),this._defineSchema(),this._defineConverters(),this.on("change:previewMode",(V,N,W)=>{this._validatePreviewMode(W),this._refreshMergeFields()}),this.listenTo(B.model.document,"change:data",()=>{this._trackAddedMergeFields()}),B.editing.mapper.on("viewToModelPosition",viewToModelPositionOutsideModelElement(B.model,V=>V.hasClass("ck-merge-field"))),B.editing.mapper.on("viewToModelPosition",viewToModelPositionOutsideModelElement(B.model,V=>V.hasClass("ck-merge-field-block"))),this._registerConversionPostFixer(),B.editing.view.domConverter.registerInlineObjectMatcher({name:"span",classes:["ck-merge-field"]}),this.licenseKey=B.config.get("licenseKey");const t=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let V;for(const N in t){const W=N,K=t[W];if(K==="mergeFieldsLicenseKeyTrial"||K==="mergeFieldsLicenseKeyInvalid"||K==="mergeFieldsLicenseKeyValid"||K==="mergeFieldsLicenseKeyTrialLimit:operations"){delete t[W],V=K;break}}if(V==="mergeFieldsLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("merge-fields-invalid-license-key",null);if(V==="mergeFieldsLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 format painter plugin with limited usage. Make sure you will not use it in the production environment."),V==="mergeFieldsLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("merge-fields-trial-license-key-reached-limit-changes",null);V==="mergeFieldsLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}getDefaultValues(){const B={},t=this.getMergeFieldsIds();for(const V of t)B[V]=this.getMergeFieldDefaultValue(V);return B}getDataSetValues(B,t=!1){const V={},N=this.getMergeFieldsIds();for(const W of N){let K=this.getMergeFieldValue(W,B);K===null&&t&&(K=this.getMergeFieldDefaultValue(W)),V[W]=K}return V}getLabel(B){const t=this.getDefinition(B);return t&&t.label?t.label:B}getMergeFieldDefaultValue(B){const t=this.getDefinition(B);if(!t||t.defaultValue===void 0)return null;const V=typeof t.defaultValue=="function"?t.defaultValue(this.editor):t.defaultValue;return String(V)}getMergeFieldValue(B,t){const V=this.editor.config.get("mergeFields.dataSets").find(K=>K.id===t);if(!V)throw new CKEditorError("merge-fields-data-set-not-found",null);const N=V.values[B];if(N===void 0)return null;const W=typeof N=="function"?N(this.editor):N;return String(W)}getMergeFieldType(B){const t=this.getDefinition(B);return t&&t.type?t.type:"text"}getDocumentMergeFieldsIds(){const B=new Set;for(const t of this._mergeFieldElements)t.root.rootName!=="$graveyard"&&B.add(t.getAttribute("id"));return Array.from(B)}getMergeFieldsIds(){const B=this.flattenedMergeFieldDefinitions.map(V=>V.id),t=this.getDocumentMergeFieldsIds();return Array.from(new Set([...B,...t]))}getDefinition(B){return this.flattenedMergeFieldDefinitions.find(t=>t.id===B)||null}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}_getFlattenedMergeFieldDefinitions(){const B=new Set,t=this.editor;return t.config.get("mergeFields.definitions").reduce((V,N)=>{if("groupId"in N){if(B.has(N.groupId))throw new CKEditorError("merge-fields-duplicate-group-id",t,{duplicateId:N.groupId});B.add(N.groupId)}return"groupId"in N?(function(W,K){for(const G of K.definitions)W=W.concat(G);return W}).bind(t)(V,N):V.concat(N)},new Array)}_validateConfig(){const B=/^['"`!#%:;=@{}~$()*+/?[\\\]^|]+$/;if(!B.test(this._mergeFieldPrefix)||!B.test(this._mergeFieldSuffix))throw new CKEditorError("merge-fields-invalid-prefix-or-suffix",this,{prefix:this._mergeFieldPrefix,suffix:this._mergeFieldSuffix});if(this._mergeFieldPrefix.length>8||this._mergeFieldSuffix.length>8)throw new CKEditorError("merge-fields-prefix-or-suffix-too-long",this,{prefix:this._mergeFieldPrefix,suffix:this._mergeFieldSuffix,limit:8});const t=/^[a-zA-Z0-9_.-]+$/,V=new Set;if(this.flattenedMergeFieldDefinitions.map(Z=>{if(!t.test(Z.id))throw new CKEditorError("merge-fields-invalid-id",this,{incorrectId:Z.id});if(V.has(Z.id))throw new CKEditorError("merge-fields-duplicate-merge-field-id",this,{duplicateId:Z.id});V.add(Z.id)}),this._mergeFieldPrefix===this._mergeFieldSuffix)throw new CKEditorError("merge-fields-prefix-and-suffix-must-differ",this);const N=this.editor.config.get("mergeFields.previewModes"),W=["$labels","$defaultValues","$dataSets"];if(!N.length||!N.every(Z=>W.includes(Z)))throw new CKEditorError("merge-fields-invalid-preview-modes-configuration",this,{invalidConfig:N});const K=new Set,G=this.editor.config.get("mergeFields.dataSets");for(const Z of G){if(K.has(Z.id))throw new CKEditorError("merge-fields-duplicate-data-set-id",this,{duplicateId:Z.id});K.add(Z.id)}}_getAvailablePreviewModes(){const B=this.editor.config.get("mergeFields.previewModes"),t=[];if(B.includes("$labels")&&t.push("$labels"),B.includes("$defaultValues")&&t.push("$defaultValues"),B.includes("$dataSets")){const V=this.editor.config.get("mergeFields.dataSets");t.push(...V.map(N=>N.id))}return t}_defineSchema(){const B=this.editor.model.schema;B.register("mergeField",{inheritAllFrom:"$inlineObject",allowAttributes:["id"],allowWhere:"$text"}),B.register("mergeFieldBlock",{inheritAllFrom:"$blockObject",allowAttributes:["id"]})}_defineConverters(){const B=this.editor.conversion;B.for("upcast").add(t=>{t.on("text",(V,N,W)=>{const{consumable:K,writer:G,schema:Z}=W,{viewItem:Y}=N;if(!K.test(Y))return;const X=Y.data.split(this._mergeFieldRegExp).filter(te=>te);if(X.length===1&&!X[0].match(this._mergeFieldRegExp))return;let Q=!0;for(const te of X){if(!te.match(this._mergeFieldRegExp)){Q=!1;break}const ie=te.slice(this._mergeFieldPrefix.length,te.length-this._mergeFieldSuffix.length);if(this.getMergeFieldType(ie)==="text"){Q=!1;break}}if(Q){K.consume(Y);for(const te of X){const ie=te.slice(this._mergeFieldPrefix.length,te.length-this._mergeFieldSuffix.length),ne=N.modelCursor,le=G.createElement("mergeFieldBlock",{id:ie});G.insert(le,ne),N.modelCursor=ne.getShiftedBy(1),N.modelRange=G.createRange(N.modelRange?N.modelRange.start:ne,N.modelCursor)}}else{if(!Z.checkChild(N.modelCursor,"$text")){if(!isParagraphable(N.modelCursor,"$text",Z))return;N.modelCursor=wrapInParagraph(N.modelCursor,G)}K.consume(Y);for(const te of X){const ie=N.modelCursor;let ne;if(te.match(this._mergeFieldRegExp)){const le=te.slice(this._mergeFieldPrefix.length,te.length-this._mergeFieldSuffix.length);ne=G.createElement("mergeField",{id:le})}else ne=G.createText(te);G.insert(ne,ie),N.modelCursor=ie.getShiftedBy(ne.offsetSize),N.modelRange=G.createRange(N.modelRange?N.modelRange.start:ie,N.modelCursor)}}})}),B.for("editingDowncast").elementToElement({model:"mergeField",view:(t,{writer:V})=>this._createMergeFieldWidget(t,V,"text")}),B.for("dataDowncast").elementToElement({model:"mergeField",view:(t,{writer:V,options:N})=>this._createTextualMergeField(t,V,N.mergeFieldsData)}),B.for("editingDowncast").elementToElement({model:"mergeFieldBlock",view:(t,{writer:V})=>this._createMergeFieldWidget(t,V,"block")}),B.for("dataDowncast").elementToElement({model:"mergeFieldBlock",view:(t,{writer:V,options:N})=>this._createTextualMergeField(t,V,N.mergeFieldsData)})}_createMergeFieldWidget(B,t,V){const{label:N,classes:W,status:K,height:G}=this._prepareViewElementData(B),Z=this._mergeFieldPrefix,Y=this._mergeFieldSuffix,X=this.editor.config.get("mergeFields.sanitizeHtml"),Q=V==="text"?"span":"div";let te;if(this.previewMode==="$labels")te=t.createContainerElement(Q,{class:W},[t.createUIElement("span",{class:"ck-merge-field__affix"},function(ie){const ne=this.toDomElement(ie);return ne.innerHTML=Z,ne}),t.createContainerElement("span",{class:"ck-merge-field__content"},t.createText(String(N))),t.createUIElement("span",{class:"ck-merge-field__affix"},function(ie){const ne=this.toDomElement(ie);return ne.innerHTML=Y,ne})]);else if(K){const ie=this._shouldPreviewHtmlValues?t.createRawElement("span",{},function(ne,le){le.setContentOf(ne,X(N).html)}):t.createText(N);if(te=t.createContainerElement(Q,{class:W},[ie]),V==="text"||["WARNING_MISSING_DEFAULT_VALUE","WARNING_MISSING_DATA"].includes(K)){const ne=t.createUIElement("span",{class:"ck-merge-field__icon"},function(le){const ae=this.toDomElement(le),de=new IconView;return de.set({content:`<svg width="12" height="12" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M12 6C12 9.31371 9.31371 12 6 12C2.68629 12 0 9.31371 0 6C0 2.68629 2.68629 0 6 0C9.31371 0 12 2.68629 12 6ZM5.27988 2.40003H6.71988V6.72003H5.27988V2.40003ZM6.72009 8.16003H5.28009V9.60003H6.72009V8.16003Z" fill="#DB3700"/>
</svg>
`}),de.render(),ae.appendChild(de.element),ae});t.insert(t.createPositionAt(te,"end"),ne)}t.setCustomProperty("mergeFieldStatus",K,te)}else{const ie=this._shouldPreviewHtmlValues?t.createRawElement(Q,{},function(ne,le){le.setContentOf(ne,X(N).html)}):t.createText(N);te=t.createContainerElement(Q,{class:W},ie)}if(V==="block"){const ie=t.createContainerElement("div",{class:"ck-merge-field-block"},[te]);if((this.previewMode==="$labels"||K&&["WARNING_MISSING_DEFAULT_VALUE","WARNING_MISSING_DATA"].includes(K))&&t.setAttribute("style","height: "+G+"px",ie),te.hasClass("ck-merge-field_with-value"))t.addClass("ck-merge-field-block_with-value",ie);else if(te.hasClass("ck-merge-field_with-warning")){for(const ne of te.getClassNames())if(ne!=="ck-merge-field"){const le=ne.replace("ck-merge-field","ck-merge-field-block");t.addClass(le,ie)}t.setAttribute("data-merge-field-block-label",this.getLabel(B.getAttribute("id")),ie),t.setCustomProperty("mergeFieldStatus",K,ie)}return t.setCustomProperty("mergeFieldBlock",!0,ie),toWidget(ie,t,{hasSelectionHandle:!0})}return t.setCustomProperty("mergeField",!0,te),toWidget(te,t)}_prepareViewElementData(B){const t=this.getDefinition(B.getAttribute("id"));if(!t)return this.previewMode==="$labels"?{label:B.getAttribute("id"),classes:"ck-merge-field"}:{label:B.getAttribute("id"),classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_missing-definition",status:"WARNING_MISSING_DATA"};const V=this.getLabel(t.id),N=this.getMergeFieldType(t.id),W=this.getMergeFieldDefaultValue(B.getAttribute("id")),K=N!=="text"?t.height||120:void 0;if(this.previewMode==="$labels")return{label:V,height:K,classes:"ck-merge-field"};if(this.previewMode==="$defaultValues")return W?{label:W,height:K,classes:"ck-merge-field ck-merge-field_with-value"}:{label:V,height:K,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_no-default",status:"WARNING_MISSING_DEFAULT_VALUE"};const G=this.getMergeFieldValue(t.id,this.previewMode);return G?{label:G,height:K,classes:"ck-merge-field ck-merge-field_with-value"}:W?{label:W,height:K,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_default-value-used",status:"WARNING_MISSING_DATA_USED_DEFAULT_VALUE"}:{label:V,height:K,classes:"ck-merge-field ck-merge-field_with-warning ck-merge-field_with-warning_missing-data",status:"WARNING_MISSING_DATA"}}_createTextualMergeField(B,t,V){const N=B.getAttribute("id"),W=V&&V[N]?V[N]:this._mergeFieldPrefix+N+this._mergeFieldSuffix;let K;if(V)K=t.createRawElement("span",{},function(G,Z){Z.setContentOf(G,String(W))});else{K=t.createContainerElement("span");const G=t.createText(W);t.insert(t.createPositionAt(K,"end"),G)}return t.setCustomProperty("dataPipeline:transparentRendering",!0,K),K}_refreshMergeFields(){this._mergeFieldElements.forEach(B=>{B.root.rootName!=="$graveyard"&&this.editor.editing.reconvertItem(B)})}_validatePreviewMode(B){if(!this.availablePreviewModes.includes(B))throw new CKEditorError("merge-fields-invalid-preview-mode-set",this,{availablePreviewModes:this.availablePreviewModes,previewMode:B})}_trackAddedMergeFields(){for(const B of this.editor.model.document.differ.getChanges({includeChangesInGraveyard:!0})){if(B.type!=="insert"||B.name==="$text")continue;if(B.name==="mergeField"||B.name==="mergeFieldBlock"){this._mergeFieldElements.add(B.position.nodeAfter);continue}const t=this.editor.model.createRangeIn(B.position.nodeAfter);for(const V of t.getItems())V.is("element","mergeField")&&this._mergeFieldElements.add(V)}}_registerConversionPostFixer(){const B=this.editor;B.model.document.registerPostFixer(t=>{if(!t.batch.isLocal)return!1;const V=[],N=new Set,W=this._mergeFieldRegExp;let K=!1;for(const Y of B.model.document.differ.getChanges())if(Y.type==="insert"||Y.type==="remove"){let X=Y.name=="$text"?Y.position.parent:Y.position.nodeAfter;if(!X)continue;X.is("$text")&&(X=X.parent),G(X)}for(const Y of V.reverse()){const{match:X,item:Q}=Y,te=t.createPositionAt(Q,X.index),ie=te.getShiftedBy(X[0].length),ne=t.createRange(te,ie),le=X[0],ae=le.slice(this._mergeFieldPrefix.length,le.length-this._mergeFieldSuffix.length),de=Z(ne);if(de.set("id",ae),this.getMergeFieldType(ae)==="block"){const ce=t.createElement("mergeFieldBlock",{id:ae});t.remove(ne),B.model.insertObject(ce,null,null,{setSelection:"on",findOptimalPosition:void 0})}else{const ce=t.createElement("mergeField",de);B.model.schema.checkChild(ne.start,"mergeField")?B.model.insertObject(ce,ne):t.remove(ne)}K=!0}return K;function G(Y){let X="",Q=0;if(!N.has(Y))for(const te of Y.getChildren()){const ie=te.nextSibling;if(te.is("$text")&&(X===""&&te.startOffset&&(Q=te.startOffset),X+=te.data),!ie||ie.is("element")){for(const ne of X.matchAll(W))ne.index=ne.index+Q,V.push({match:ne,item:Y});N.add(Y),X=""}te.is("element")&&G(te)}}function Z(Y){const X=Y.getItems(),Q=X.next().value,te=new Map(Q.getAttributes());for(const ie of X)for(const[ne,le]of te)ie.getAttribute(ne)!==le&&te.delete(ne);return te}})}};class T extends ListView{filter(B){return filterGroupAndItemNames(B,this.items)}}class U extends View{constructor(B){super(B),this.set("text","");const t=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-merge-fields-form"]},children:[{tag:"div",attributes:{class:["ck","ck-merge-fields-form__status"]},children:[{text:t.to("text")}]}]})}}function $(H,B){const t=H.t;switch(B){case"Search merge field":return t("Search merge field");case"No merge fields found":return t("No merge fields found");case"No merge fields available":return t("No merge fields available");case"Insert merge field":return t("Insert merge field");case"Merge field":return t("Merge field");case"Merge fields preview":return t("Merge fields preview");case"Labels":return t("Labels");case"Default values":return t("Default values");case"WARNING_MISSING_DATA_USED_DEFAULT_VALUE":return t({string:"Default value is used.",id:"WARNING_MISSING_DATA_USED_DEFAULT_VALUE"});case"WARNING_MISSING_DEFAULT_VALUE":return t({string:"Default value not available.",id:"WARNING_MISSING_DEFAULT_VALUE"});case"WARNING_MISSING_DATA":return t({string:"Value not available.",id:"WARNING_MISSING_DATA"});default:return B}}var q=`<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<circle cx="10.0001" cy="9.79993" r="1.5"/>
<path d="M13.2496 2.75005C13.2497 2.00005 13.2498 2.00005 13.2498 2.00005L13.2511 2.00005L13.2534 2.00006L13.2606 2.00009L13.2848 2.0003C13.3052 2.00053 13.3337 2.00098 13.3688 2.00185C13.4386 2.0036 13.536 2.00707 13.6475 2.01402C13.8589 2.02722 14.1651 2.05536 14.4328 2.12276C14.8296 2.22267 15.1705 2.40399 15.4402 2.67392C15.7077 2.94161 15.8688 3.26001 15.9644 3.5803C16.1459 4.18776 16.1145 4.89393 16.0724 5.49256C16.0626 5.6324 16.052 5.76849 16.0416 5.90131C16.0036 6.38849 15.969 6.83163 15.9895 7.25369C16.0151 7.78147 16.1252 8.13279 16.3222 8.3656C16.5447 8.6286 16.8158 8.79405 17.0411 8.89436C17.1523 8.94386 17.2471 8.97509 17.3103 8.99319C17.3417 9.00219 17.3647 9.00776 17.3773 9.01062L17.3868 9.01269L17.9996 9.12173V9.75005H15.5976C15.4541 9.63123 15.3117 9.49364 15.1771 9.33451C14.669 8.73405 14.5235 7.99036 14.4913 7.32643C14.4657 6.79933 14.5105 6.23163 14.5497 5.73429C14.5592 5.61404 14.5683 5.49785 14.5761 5.3874C14.6198 4.76596 14.62 4.32043 14.5272 4.00956C14.4857 3.87069 14.4332 3.78828 14.3791 3.73414C14.3272 3.68223 14.2386 3.6207 14.0665 3.57736C13.9372 3.5448 13.7433 3.52293 13.554 3.51111C13.4651 3.50556 13.3869 3.50277 13.3313 3.50139C13.3037 3.5007 13.282 3.50036 13.2678 3.5002L13.2524 3.50007L13.2493 3.50005L12.4996 3.5L12.4997 2L13.2498 2.00005L13.2496 2.75005Z"/>
<path d="M13.2496 16.7501C13.2497 17.5001 13.2498 17.5001 13.2498 17.5001L13.2511 17.5001L13.2534 17.5001L13.2606 17.5L13.2848 17.4998C13.3052 17.4996 13.3337 17.4991 13.3688 17.4983C13.4386 17.4965 13.536 17.493 13.6475 17.4861C13.8589 17.4729 14.1651 17.4448 14.4328 17.3774C14.8296 17.2774 15.1705 17.0961 15.4402 16.8262C15.7077 16.5585 15.8688 16.2401 15.9644 15.9198C16.1459 15.3124 16.1145 14.6062 16.0724 14.0076C16.0626 13.8677 16.052 13.7316 16.0416 13.5988C16.0036 13.1116 15.969 12.6685 15.9895 12.2464C16.0151 11.7186 16.1252 11.3673 16.3222 11.1345C16.5447 10.8715 16.8158 10.7061 17.0411 10.6058C17.1523 10.5563 17.2471 10.525 17.3103 10.5069C17.3417 10.4979 17.3647 10.4924 17.3773 10.4895L17.3868 10.4874L17.9996 10.3784V9.75005H15.5976C15.4541 9.86887 15.3117 10.0065 15.1771 10.1656C14.669 10.7661 14.5235 11.5098 14.4913 12.1737C14.4657 12.7008 14.5105 13.2685 14.5497 13.7658C14.5592 13.8861 14.5683 14.0023 14.5761 14.1127C14.6198 14.7341 14.62 15.1797 14.5272 15.4906C14.4857 15.6294 14.4332 15.7118 14.3791 15.766C14.3272 15.8179 14.2386 15.8794 14.0665 15.9228C13.9372 15.9553 13.7433 15.9772 13.554 15.989C13.4651 15.9945 13.3869 15.9973 13.3313 15.9987C13.3037 15.9994 13.282 15.9998 13.2678 15.9999L13.2524 16L13.2493 16.0001L12.4996 16.0001L12.4997 17.5001L13.2498 17.5001L13.2496 16.7501Z"/>
<path d="M6.75 2.75005C6.74995 2.00005 6.74982 2.00005 6.74982 2.00005L6.74853 2.00005L6.74622 2.00006L6.73903 2.00009L6.71478 2.0003C6.69446 2.00053 6.66594 2.00098 6.63087 2.00185C6.56099 2.0036 6.46364 2.00707 6.35217 2.01402C6.14071 2.02722 5.83458 2.05536 5.56688 2.12276C5.17006 2.22267 4.82913 2.40399 4.55943 2.67392C4.29196 2.94161 4.13085 3.26001 4.03519 3.5803C3.85377 4.18776 3.88516 4.89393 3.92723 5.49256C3.93706 5.6324 3.94768 5.76849 3.95804 5.90131C3.99605 6.38849 4.03062 6.83163 4.01013 7.25369C3.98451 7.78147 3.87445 8.13279 3.67746 8.3656C3.45492 8.6286 3.18386 8.79405 2.95851 8.89436C2.84732 8.94386 2.75258 8.97509 2.68931 8.99319C2.65789 9.00219 2.63488 9.00776 2.62229 9.01062L2.61279 9.01269L2 9.12173V9.75005H4.40205C4.54555 9.63123 4.6879 9.49364 4.82254 9.33451C5.33063 8.73405 5.47613 7.99036 5.50837 7.32643C5.53396 6.79933 5.48918 6.23163 5.44995 5.73429C5.44047 5.61404 5.4313 5.49785 5.42354 5.3874C5.37987 4.76596 5.37961 4.32043 5.47246 4.00956C5.51394 3.87069 5.56644 3.78828 5.62053 3.73414C5.6724 3.68223 5.76099 3.6207 5.93312 3.57736C6.06245 3.5448 6.25632 3.52293 6.4456 3.51111C6.5345 3.50556 6.61271 3.50277 6.6683 3.50139C6.69595 3.5007 6.71765 3.50036 6.73185 3.5002L6.74724 3.50007L6.75029 3.50005L7.50005 3.5L7.49995 2L6.74982 2.00005L6.75 2.75005Z"/>
<path d="M6.75 16.7501C6.74995 17.5001 6.74982 17.5001 6.74982 17.5001L6.74853 17.5001L6.74622 17.5001L6.73903 17.5L6.71478 17.4998C6.69446 17.4996 6.66594 17.4991 6.63087 17.4983C6.56099 17.4965 6.46364 17.493 6.35217 17.4861C6.14071 17.4729 5.83458 17.4448 5.56688 17.3774C5.17006 17.2774 4.82913 17.0961 4.55943 16.8262C4.29196 16.5585 4.13085 16.2401 4.03519 15.9198C3.85377 15.3124 3.88516 14.6062 3.92723 14.0076C3.93706 13.8677 3.94768 13.7316 3.95804 13.5988C3.99605 13.1116 4.03062 12.6685 4.01013 12.2464C3.98451 11.7186 3.87445 11.3673 3.67746 11.1345C3.45492 10.8715 3.18386 10.7061 2.95851 10.6058C2.84732 10.5563 2.75258 10.525 2.68931 10.5069C2.65789 10.4979 2.63488 10.4924 2.62229 10.4895L2.61279 10.4874L2 10.3784V9.75005H4.40205C4.54555 9.86887 4.6879 10.0065 4.82254 10.1656C5.33063 10.7661 5.47613 11.5098 5.50837 12.1737C5.53396 12.7008 5.48918 13.2685 5.44995 13.7658C5.44047 13.8861 5.4313 14.0023 5.42354 14.1127C5.37987 14.7341 5.37961 15.1797 5.47246 15.4906C5.51394 15.6294 5.56644 15.7118 5.62053 15.766C5.6724 15.8179 5.76099 15.8794 5.93312 15.9228C6.06245 15.9553 6.25632 15.9772 6.4456 15.989C6.5345 15.9945 6.61271 15.9973 6.6683 15.9987C6.69595 15.9994 6.71765 15.9998 6.73185 15.9999L6.74724 16L6.75029 16.0001L7.50005 16.0001L7.49995 17.5001L6.74982 17.5001L6.75 16.7501Z"/>
</svg>
`,D=`<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
<circle cx="9.00037" cy="9.79993" r="1.5"/>
<path d="M5.75024 2.75005C5.75019 2.00005 5.75006 2.00005 5.75006 2.00005L5.74877 2.00005L5.74647 2.00006L5.73927 2.00009L5.71503 2.0003C5.6947 2.00053 5.66619 2.00098 5.63111 2.00185C5.56123 2.0036 5.46388 2.00707 5.35241 2.01402C5.14095 2.02722 4.83482 2.05536 4.56712 2.12276C4.1703 2.22267 3.82938 2.40399 3.55967 2.67392C3.29221 2.94161 3.1311 3.26001 3.03544 3.5803C2.85401 4.18776 2.8854 4.89393 2.92747 5.49256C2.9373 5.6324 2.94792 5.76849 2.95828 5.90131C2.99629 6.38849 3.03087 6.83163 3.01038 7.25369C2.98475 7.78147 2.87469 8.13279 2.6777 8.3656C2.45517 8.6286 2.1841 8.79405 1.95875 8.89436C1.84756 8.94386 1.75282 8.97509 1.68956 8.99319C1.65813 9.00219 1.63513 9.00776 1.62253 9.01062L1.61304 9.01269L1.00024 9.12173V9.75005H3.4023C3.54579 9.63123 3.68814 9.49364 3.82278 9.33451C4.33087 8.73405 4.47638 7.99036 4.50861 7.32643C4.5342 6.79933 4.48942 6.23163 4.4502 5.73429C4.44071 5.61404 4.43155 5.49785 4.42378 5.3874C4.38011 4.76596 4.37986 4.32043 4.4727 4.00956C4.51418 3.87069 4.56668 3.78828 4.62078 3.73414C4.67264 3.68223 4.76124 3.6207 4.93336 3.57736C5.06269 3.5448 5.25656 3.52293 5.44585 3.51111C5.53475 3.50556 5.61296 3.50277 5.66854 3.50139C5.6962 3.5007 5.71789 3.50036 5.73209 3.5002L5.74748 3.50007L5.75054 3.50005L6.5003 3.5L6.50019 2L5.75006 2.00005L5.75024 2.75005Z"/>
<path d="M5.75024 16.7501C5.75019 17.5001 5.75006 17.5001 5.75006 17.5001L5.74877 17.5001L5.74647 17.5001L5.73927 17.5L5.71503 17.4998C5.6947 17.4996 5.66619 17.4991 5.63111 17.4983C5.56123 17.4965 5.46388 17.493 5.35241 17.4861C5.14095 17.4729 4.83482 17.4448 4.56712 17.3774C4.1703 17.2774 3.82938 17.0961 3.55967 16.8262C3.29221 16.5585 3.1311 16.2401 3.03544 15.9198C2.85401 15.3124 2.8854 14.6062 2.92747 14.0076C2.9373 13.8677 2.94792 13.7316 2.95828 13.5988C2.99629 13.1116 3.03087 12.6685 3.01038 12.2464C2.98475 11.7186 2.87469 11.3673 2.6777 11.1345C2.45517 10.8715 2.1841 10.7061 1.95875 10.6058C1.84756 10.5563 1.75282 10.525 1.68956 10.5069C1.65813 10.4979 1.63513 10.4924 1.62253 10.4895L1.61304 10.4874L1.00024 10.3784V9.75005H3.4023C3.54579 9.86887 3.68814 10.0065 3.82278 10.1656C4.33087 10.7661 4.47638 11.5098 4.50861 12.1737C4.5342 12.7008 4.48942 13.2685 4.4502 13.7658C4.44071 13.8861 4.43155 14.0023 4.42378 14.1127C4.38011 14.7341 4.37986 15.1797 4.4727 15.4906C4.51418 15.6294 4.56668 15.7118 4.62078 15.766C4.67264 15.8179 4.76124 15.8794 4.93336 15.9228C5.06269 15.9553 5.25656 15.9772 5.44585 15.989C5.53475 15.9945 5.61296 15.9973 5.66854 15.9987C5.6962 15.9994 5.71789 15.9998 5.73209 15.9999L5.74748 16L5.75054 16.0001L6.5003 16.0001L6.50019 17.5001L5.75006 17.5001L5.75024 16.7501Z"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M12.2514 2.00005L12.2501 2.00005L11.5 2L11.4999 3.5L12.2496 3.50005L12.2527 3.50007L12.2681 3.5002C12.2823 3.50036 12.304 3.5007 12.3316 3.50139C12.3872 3.50277 12.4654 3.50556 12.5543 3.51111C12.7436 3.52293 12.9375 3.5448 13.0668 3.57736C13.2389 3.6207 13.3275 3.68223 13.3794 3.73414C13.4335 3.78828 13.486 3.87069 13.5275 4.00956C13.6203 4.32043 13.6201 4.76596 13.5764 5.3874C13.5686 5.49785 13.5595 5.61404 13.55 5.73429C13.5108 6.23163 13.466 6.79933 13.4916 7.32643C13.5238 7.99036 13.6693 8.73405 14.1774 9.33451C14.312 9.49364 14.4544 9.63123 14.5979 9.75005C14.4544 9.86887 14.312 10.0065 14.1774 10.1656C13.7121 10.7154 13.5509 11.3854 13.5023 12.0042C13.6011 12.0012 13.7003 11.9997 13.7999 11.9997C14.208 11.9997 14.6093 12.0247 15.0018 12.0729C15.0416 11.6402 15.1479 11.3408 15.3225 11.1345C15.545 10.8715 15.8161 10.7061 16.0414 10.6058C16.1526 10.5563 16.2474 10.525 16.3106 10.5069C16.342 10.4979 16.365 10.4924 16.3776 10.4895L16.3871 10.4874L16.9999 10.3784V9.75005V9.12173L16.3871 9.01269L16.3776 9.01062C16.365 9.00776 16.342 9.00219 16.3106 8.99319C16.2474 8.97509 16.1526 8.94386 16.0414 8.89436C15.8161 8.79405 15.545 8.6286 15.3225 8.3656C15.1255 8.13279 15.0154 7.78147 14.9898 7.25369C14.9693 6.83163 15.0039 6.38849 15.0419 5.90131C15.0523 5.76849 15.0629 5.6324 15.0727 5.49256C15.1148 4.89393 15.1462 4.18776 14.9647 3.5803C14.8691 3.26001 14.708 2.94161 14.4405 2.67392C14.1708 2.40399 13.8299 2.22267 13.433 2.12276C13.1654 2.05536 12.8592 2.02722 12.6478 2.01402C12.5363 2.00707 12.4389 2.0036 12.3691 2.00185C12.334 2.00098 12.3055 2.00053 12.2851 2.0003L12.2609 2.00009L12.2537 2.00006L12.2514 2.00005Z"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M9.00335 17.2062L9.00308 17.2065C8.7234 17.5118 8.24919 17.5327 7.94372 17.2532C7.63816 16.9735 7.61716 16.4991 7.89681 16.1935L8.45008 16.6999C7.89681 16.1935 7.89697 16.1934 7.89713 16.1932L7.89751 16.1928L7.89844 16.1918L7.90098 16.189L7.90879 16.1806L7.93517 16.1526C7.95746 16.1292 7.98914 16.0963 8.02971 16.0555C8.11079 15.9738 8.22768 15.8597 8.37644 15.724C8.6732 15.4532 9.10079 15.0927 9.62744 14.7314C10.6647 14.0198 12.1659 13.2499 13.8501 13.2499C15.5343 13.2499 17.0355 14.0198 18.0727 14.7314C18.5994 15.0927 19.027 15.4532 19.3237 15.724C19.4725 15.8597 19.5894 15.9738 19.6705 16.0555C19.711 16.0963 19.7427 16.1292 19.765 16.1526L19.7914 16.1806L19.7992 16.189L19.8017 16.1918L19.8027 16.1928L19.803 16.1932C19.8032 16.1934 19.8034 16.1935 19.2501 16.6999L19.8034 16.1935C20.083 16.4991 20.062 16.9735 19.7565 17.2532C19.4511 17.5326 18.9772 17.5118 18.6975 17.207L18.6971 17.2065L18.6968 17.2062L18.6945 17.2037L18.6783 17.1865C18.6629 17.1704 18.6386 17.1452 18.6059 17.1123C18.5404 17.0463 18.4414 16.9494 18.3127 16.8321C18.0546 16.5966 17.6814 16.282 17.2242 15.9683C16.9805 15.8012 16.7185 15.6381 16.4421 15.4883C16.7016 15.9322 16.8502 16.4487 16.8502 16.9999C16.8502 18.6567 15.5071 19.9999 13.8502 19.9999C12.1934 19.9999 10.8502 18.6567 10.8502 16.9999C10.8502 16.4486 10.9989 15.932 11.2584 15.4881C10.9819 15.6379 10.7198 15.8011 10.476 15.9683C10.0188 16.282 9.64555 16.5966 9.38746 16.8321C9.25879 16.9494 9.15975 17.0463 9.09425 17.1123C9.06153 17.1452 9.03726 17.1704 9.02192 17.1865L9.00572 17.2037L9.00335 17.2062Z"/>
<circle cx="14.8253" cy="16.1749" r="1.125" fill="white"/>
</svg>
`;let d$1=class extends Plugin{static get requires(){return["Mention",m$2,ContextualBalloon,Widget]}static get pluginName(){return"MergeFieldsUI"}constructor(B){super(B),this._balloonPanelView=null,this._removeMenuBarButtonIfUnnecessary(),this._setupMentionConfiguration()}init(){const B=this.editor;B.ui.componentFactory.add("insertMergeField",N=>{const W=function(K){const G=createDropdown(K);return G.set({class:"ck-insert-merge-field-dropdown",isEnabled:!0}),G.buttonView.set({label:$(K,"Insert merge field"),icon:q,tooltip:!0}),G}(N);return W.bind("isEnabled").toMany([B.commands.get("insertMergeField"),B.commands.get("insertMergeFieldBlock")],"isEnabled",(...K)=>K.some(G=>G)),W.once("change:isOpen",()=>{const K={insertInline:B.commands.get("insertMergeField"),insertBlock:B.commands.get("insertMergeFieldBlock")},G=function(Y,X,Q){const te=new T(Y),ie=[],ne=[];for(const le of X)if("groupId"in le){const ae=C(Y,le.groupLabel||le.groupId,le.definitions,Q);ae.delegate("execute").to(te),ne.push(ae)}else ie.push(le);if(ie.length){const le=C(Y,"Other",ie,Q);le.delegate("execute").to(te),ne.push(le)}return te.items.addMany(ne),te}(N,B.config.get("mergeFields.definitions"),K);G.delegate("execute").to(W),W.on("execute",(Y,X)=>{const Q=B.plugins.get("MergeFieldsEditing").getMergeFieldType(X);B.execute(Q==="text"?"insertMergeField":"insertMergeFieldBlock",X),B.editing.view.focus()});const Z=function(Y,X){return new SearchTextView(Y,{filteredView:X,queryView:{label:$(Y,"Search merge field")},class:"ck-merge-fields-search",infoView:{text:{notFound:{primary:$(Y,"No merge fields found")},noSearchableItems:{primary:$(Y,"No merge fields available")}}}})}(N,G);W.panelView.children.add(Z),W.on("change:isOpen",(Y,X,Q)=>{Q&&Z.reset()})}),W}),B.ui.componentFactory.add("menuBar:insertMergeField",N=>{const W=new MenuBarMenuView(N);W.buttonView.set({label:$(N,"Merge field"),icon:q}),W.bind("isEnabled").toMany([B.commands.get("insertMergeField"),B.commands.get("insertMergeFieldBlock")],"isEnabled",(...Y)=>Y.some(X=>X));const K=[],G=new MenuBarMenuListView(N),Z={insertInline:B.commands.get("insertMergeField"),insertBlock:B.commands.get("insertMergeFieldBlock")};for(const Y of B.config.get("mergeFields.definitions"))if("groupId"in Y){const X=new MenuBarMenuListItemView(N,W),Q=P(N,Y,Z);X.children.add(Q),Q.delegate("execute").to(W),G.items.add(X)}else K.push(Y);if(K.length)if(G.items.length===0)for(const Y of K){const X=R(N,Y,W,B.plugins.get("MergeFieldsEditing").getMergeFieldType(Y.id)==="text"?B.commands.get("insertMergeField"):B.commands.get("insertMergeFieldBlock"));G.items.add(X)}else{const Y=new MenuBarMenuListItemView(N,W),X=P(N,{groupId:"Other",definitions:K},Z);Y.children.add(X),X.delegate("execute").to(W),G.items.add(Y)}return W.panelView.children.add(G),W.on("execute",(Y,X)=>{const Q=B.plugins.get("MergeFieldsEditing").getMergeFieldType(X);B.execute(Q==="text"?"insertMergeField":"insertMergeFieldBlock",X),B.editing.view.focus()}),W});const t=B.config.get("mergeFields.previewModes"),V=[];if(t.includes("$labels")&&V.push({type:"button",model:new Model({withText:!0,isToggleable:!0,label:$(this.editor.locale,"Labels"),commandValue:"$labels"})}),t.includes("$defaultValues")&&V.push({type:"button",model:new Model({withText:!0,isToggleable:!0,label:$(this.editor.locale,"Default values"),commandValue:"$defaultValues"})}),t.includes("$dataSets")){const N=B.config.get("mergeFields.dataSets");if(N.length)for(const W of N)V.push({type:"button",model:new Model({withText:!0,isToggleable:!0,label:W.label||W.id,commandValue:W.id})})}B.ui.componentFactory.add("previewMergeFields",N=>{const W=B.commands.get("previewMergeFields"),K=new Collection;for(const Y of cloneDeep(V))Y.model.bind("isOn").to(W,"value",X=>X===Y.model.commandValue),K.add(Y);const G=createDropdown(N),Z=$(N,"Merge fields preview");return G.bind("isEnabled").to(W),addListToDropdown(G,K,{ariaLabel:Z,role:"menu"}),G.set({class:"ck-merge-fields-preview-dropdown"}),G.buttonView.set({label:Z,ariaLabel:Z,ariaLabelledBy:void 0,isOn:!1,icon:D,tooltip:!0}),this.listenTo(G,"execute",Y=>{const{commandValue:X}=Y.source;B.execute("previewMergeFields",X),B.editing.view.focus()}),G}),B.ui.componentFactory.add("menuBar:previewMergeFields",N=>{const W=new MenuBarMenuView(N),K=B.commands.get("previewMergeFields");W.buttonView.set({label:$(N,"Merge fields preview"),icon:D}),W.bind("isEnabled").to(K);const G=new MenuBarMenuListView(N);G.set({ariaLabel:$(N,"Merge fields preview")});for(const Z of cloneDeep(V)){const Y=new MenuBarMenuListItemView(N,W),X=new MenuBarMenuListItemButtonView(N);Z.model.bind("isOn").to(K,"value",Q=>Q===Z.model.commandValue),X.isToggleable=!0,X.bind(...Object.keys(Z.model)).to(Z.model),X.delegate("execute").to(W),X.on("execute",Q=>{const{commandValue:te}=Q.source;B.execute("previewMergeFields",te),B.editing.view.focus()}),Y.children.add(X),G.items.add(Y)}return W.panelView.children.add(G),W}),this._balloon=B.plugins.get(ContextualBalloon),this.listenTo(B.ui,"update",()=>{this._updateBalloonVisibility()},{priority:"low"}),this.listenTo(B.ui.focusTracker,"change:isFocused",(N,W,K)=>{this._balloon.visibleView&&this._balloon.visibleView===this._balloonPanelView&&(K?this._updateBalloonVisibility():this._hideBalloon())},{priority:"low"}),this.editor.once("ready",this._overrideMentionExecuteListener.bind(this))}_updateBalloonVisibility(){const B=this.editor.editing.view.document.selection.getSelectedElement(),t=!(!B||!B.getCustomProperty("mergeFieldStatus"));if(this._balloon.visibleView&&this._balloon.visibleView===this._balloonPanelView)if(t){const V=B.getCustomProperty("mergeFieldStatus");this._balloonPanelView.text=$(this.editor.locale,V),this._balloon.updatePosition(this._getBalloonPositionData())}else this._hideBalloon();else if(t){const V=B.getCustomProperty("mergeFieldStatus");this._showBalloon($(this.editor.locale,V))}}_showBalloon(B){this._balloonPanelView||(this._balloonPanelView=new U(this.editor.locale),this._balloonPanelView.text=B),this._balloon.hasView(this._balloonPanelView)||this._balloon.add({stackId:"mergeFieldsBalloon",view:this._balloonPanelView,position:this._getBalloonPositionData()})}_getBalloonPositionData(){const B=this.editor.editing.view;return{target:()=>{const t=B.document.selection.getFirstRange(),V=B.domConverter.mapViewToDom(t.getContainedElement());return V?Array.from(V.getClientRects())[0]:B.domConverter.viewRangeToDom(t)}}}_hideBalloon(){this._balloon.remove(this._balloonPanelView)}afterInit(){(function(B){function t(N,W,K){const G={};G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},G[V([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],G[V([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],G[V([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],G[V([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],G[V([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],G[V([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],G[V([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],G[V([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],G[V([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],G[V([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Z=new Uint8Array(16);for(let ce=15;ce>=0;--ce)Z[ce]=K%256,K=parseInt(K/256);let Y=null,X=16;const Q=new Uint8Array(W),te=[],ie=[];de();for(let ce=0;ce<N[V([108,101,110,103,116,104])];ce++)X===16&&(Y=ae(Z),X=0,le(Z)),N[ce]^=Y[X++];return N;function ne(ce){const we=[];for(let be=0;be<ce[V([108,101,110,103,116,104])];be+=4)we[V([112,117,115,104])](ce[be]<<24|ce[be+1]<<16|ce[be+2]<<8|ce[be+3]);return we}function le(ce){for(let we=15;we>=0;we--){if(ce[we]!==255){ce[we]++;break}ce[we]=0}}function ae(ce){const we=te[V([108,101,110,103,116,104])]-1,be=[0,0,0,0];let ge=ne(ce);for(let me=0;me<4;me++)ge[me]^=te[0][me];for(let me=1;me<we;me++){for(let pe=0;pe<4;pe++)be[pe]=G[V([84,49])][ge[pe]>>24&255]^G[V([84,50])][ge[(pe+1)%4]>>16&255]^G[V([84,51])][ge[(pe+2)%4]>>8&255]^G[V([84,52])][255&ge[(pe+3)%4]]^te[me][pe];ge=be[V([115,108,105,99,101])]()}const Ce=new Uint8Array(16);let he;for(let me=0;me<4;me++)he=te[we][me],Ce[4*me]=255&(G[V([83])][ge[me]>>24&255]^he>>24),Ce[4*me+1]=255&(G[V([83])][ge[(me+1)%4]>>16&255]^he>>16),Ce[4*me+2]=255&(G[V([83])][ge[(me+2)%4]>>8&255]^he>>8),Ce[4*me+3]=255&(G[V([83])][255&ge[(me+3)%4]]^he);return Ce}function de(){const ce=G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Q[V([108,101,110,103,116,104])]];for(let _e=0;_e<=ce;_e++)te[V([112,117,115,104])]([0,0,0,0]),ie[V([112,117,115,104])]([0,0,0,0]);const we=4*(ce+1),be=Q[V([108,101,110,103,116,104])]/4,ge=ne(Q);let Ce;for(let _e=0;_e<be;_e++)Ce=_e>>2,te[Ce][_e%4]=ge[_e],ie[ce-Ce][_e%4]=ge[_e];let he,me=0,pe=be;for(;pe<we;){he=ge[be-1],ge[0]^=G[V([83])][he>>16&255]<<24^G[V([83])][he>>8&255]<<16^G[V([83])][255&he]<<8^G[V([83])][he>>24&255]^G[V([114,99,111,110])][me]<<24,me+=1;for(let Ae=1;Ae<be/2;Ae++)ge[Ae]^=ge[Ae-1];he=ge[be/2-1],ge[be/2]^=G[V([83])][255&he]^G[V([83])][he>>8&255]<<8^G[V([83])][he>>16&255]<<16^G[V([83])][he>>24&255]<<24;for(let Ae=be/2+1;Ae<be;Ae++)ge[Ae]^=ge[Ae-1];let _e,ye,Re=0;for(;Re<be&&pe<we;)_e=pe>>2,ye=pe%4,te[_e][ye]=ge[Re],ie[ce-_e][ye]=ge[Re++],pe++}for(let _e=1;_e<ce;_e++)for(let ye=0;ye<4;ye++)he=ie[_e][ye],ie[_e][ye]=G[V([85,49])][he>>24&255]^G[V([85,50])][he>>16&255]^G[V([85,51])][he>>8&255]^G[V([85,52])][255&he]}}function V(N){return N.map(W=>String.fromCharCode(W)).join("")}(N=>{function W(){const oe=[{[V([105,100])]:1,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,111,109,109,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([99,104,101,99,107,65,108,115,111])]:[{[V([105,100])]:2,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,114,97,99,107,32,67,104,97,110,103,101,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}}],[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:3,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:4,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[V([112,108,117,103,105,110,78,97,109,101])]:V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:5,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:6,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[V([112,108,117,103,105,110,78,97,109,101])]:V([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:7,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([83,108,97,115,104,32,67,111,109,109,97,110,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:8,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:9,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,101,109,112,108,97,116,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,101,109,112,108,97,116,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12,14]}},{[V([105,100])]:10,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:11,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([65,73,32,65,115,115,105,115,116,97,110,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([65,73,65,115,115,105,115,116,97,110,116,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([97,105,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:12,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[V([105,100])]:13,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,97,115,101,32,67,104,97,110,103,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,97,115,101,67,104,97,110,103,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:14,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,114,117,112,97,108,32,112,97,99,107]),[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[V([105,100])]:15,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:16,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,101,114,103,101,32,70,105,101,108,100,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,101,114,103,101,70,105,101,108,100,115,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}}];return xe(oe),oe;function se(fe){return 1<<fe-1}function xe(fe){fe[V([102,111,114,69,97,99,104])](ve=>{ve[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=se(ve[V([105,100])]),K(ve)&&ve[V([99,104,101,99,107,65,108,115,111])]&&xe(ve[V([99,104,101,99,107,65,108,115,111])])})}}function K(oe){return V([112,108,117,103,105,110,78,97,109,101])in oe}const G=[1,85,78,115,198,255,50,112,83,87,161],Z=[127,34,6,211,167,86,146,199,132,160,18];function Y(oe){const se=[29,221,175,90,231,133,239,240,75,180];return X(oe,new Uint8Array([...G,...se,...Z]))}function X(oe,se){const xe=Q(oe),fe=Array[V([102,114,111,109])](Je(xe)),ve=fe[V([112,111,112])](),Ie=fe[V([112,111,112])]();return Ye(t(fe,se,Ie+256*ve))}function Q(oe){const se=atob(oe),[xe,fe]=se[V([115,112,108,105,116])](V([45]));try{if(atob(fe))return atob(xe)}catch{}return se}function te(oe){try{const se=Y(oe),xe=JSON[V([112,97,114,115,101])](se),fe=parseInt(xe[V([49])]),ve=xe[V([50])]||"",Ie=parseInt(xe[V([51])]),Ne=parseInt(xe[V([52])])||0,De=parseInt(xe[V([53])])||0;return{[V([112,114,111,100,117,99,116,78,97,109,101])]:ve,[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:Ne,[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:fe,[V([105,115,84,114,105,97,108])]:Ie,[V([105,115,73,110,116,101,114,110,97,108])]:De}}catch{return null}}const ie=W(),ne={[V([99,104,101,99,107,76,105,99,101,110,115,101])]:Ce,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:he,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:me},le=N[V([99,111,110,115,116,114,117,99,116,111,114])][V([112,108,117,103,105,110,78,97,109,101])],ae=V([99,111,110,116,101,120,116])in N?N.context:N.editor,de=V([52,48,52,56,50,48,48,52]),ce=V([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),we=ae.config.get(V([108,105,99,101,110,115,101,75,101,121])),be=ie[V([102,105,108,116,101,114])](K)[V([102,105,110,100])](oe=>oe[V([112,108,117,103,105,110,78,97,109,101])]===le);function ge(oe,se){ne[se[V([104,97,110,100,108,101,114])]](oe,se),se[V([99,104,101,99,107,65,108,115,111])]&&se[V([99,104,101,99,107,65,108,115,111])][V([102,105,108,116,101,114])](xe=>Te(ae,xe[V([112,108,117,103,105,110,78,97,109,101])]))[V([102,111,114,69,97,99,104])](xe=>ge(oe,xe))}function Ce(oe,se){_e(pe(oe,se),se)}function he(oe,se){function xe(fe,ve){try{if(Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&fe){const Ie=ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[V([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Ie)/2>fe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}return pe(fe,ve)}catch{return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}_e(xe(oe,se),se)}function me(oe,se){const xe=Z[0]*G[1],fe=Z[0]*G[2],ve=Z[2]*G[2];Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&(window[Re()]=ve);function Ie(ue,Ee){try{return Xe()?ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):pe(ue,Ee)}catch{return ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function Ne(ue,Ee){if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))ze();else if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])){const Ve=De();Ve&&Le(Ve,Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const Oe=Qe();window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Le(V([116,105,109,101]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},Oe);const $e=ke(ae,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[V([95,114,101,118,105,115,105,111,110,115])];$e[V([108,101,110,103,116,104])]>=7?Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):$e.on(V([97,100,100]),()=>{$e[V([108,101,110,103,116,104])]>=7&&Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function De(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))){if(window[ue]===xe)return V([116,105,109,101]);if(window[ue]===fe)return V([114,101,118,105,115,105,111,110,115])}return!1}function Xe(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))&&window[ue]===ve)return!0;return!1}function Le(ue,Ee){ze(),ye(Ee+V([84,114,105,97,108,76,105,109,105,116,58])+ue),window[Re()]=ue===V([116,105,109,101])?xe:fe}function Qe(){let ue=Z[6]*G[8]*G[6];return Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ue/=10),ue}function ze(){const ue=ae;function Ee(){Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,112,100,97,116,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([115,97,118,101,82,101,118,105,115,105,111,110])]=Se,ue[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,ue[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,ue[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([95,103,101,116,68,105,102,102])]=Se)}ue[V([115,116,97,116,101])]==V([114,101,97,100,121])?Ee():ue[V([111,110,99,101])](V([114,101,97,100,121]),()=>{if(Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Ee(),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Me=ke(ue,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),Ve=Me.getRevision(0),Oe=Me.getEarlierVisibleRevision(Ve[V([105,100])]);ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])](Ve[V([105,100])],Oe?Oe[V([105,100])]:null,1).then(()=>Ee())}})}Ne(Ie(oe,se),se)}function pe(oe,se){try{return Ze(se)?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):oe&&Ke(oe[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],se)?oe[V([105,115,73,110,116,101,114,110,97,108])]&&!window[V([111,112,101,110])][V([99,108,111,115,101,100])]||parseInt(de)/2>oe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])):oe[V([105,115,84,114,105,97,108])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}catch{return ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function _e(oe,se){if(ae instanceof Context){const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Ae(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Ae(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Z[6]*G[8]*G[6]),xe[V([101,100,105,116,111,114,115])][V([111,110])](V([97,100,100]),(fe,ve)=>{oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Be(ve)})}else{const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Be(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&xe[V([111,110])](V([114,101,97,100,121]),()=>{let fe=0;xe[V([109,111,100,101,108])][V([111,110])](V([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(ve,Ie)=>{Ie[0][V([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&fe++,fe===504&&(Be(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),ve[V([111,102,102])]())},{priority:V([104,105,103,104,101,115,116])})})}}function ye(oe){const se=Re();return ae[se]=oe,oe}function Re(){const oe=String(window[V([112,101,114,102,111,114,109,97,110,99,101])][V([110,111,119])]())[V([114,101,112,108,97,99,101])](V([46]),"");let se="";for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe+=2){let fe=parseInt(oe[V([115,117,98,115,116,114,105,110,103])](xe,xe+2));fe>=ce[V([108,101,110,103,116,104])]&&(fe-=ce[V([108,101,110,103,116,104])]),se+=ce[fe]}return se}function Ae(oe){for(const se of oe[V([101,100,105,116,111,114,115])])Be(se);ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=Se}function Be(oe){function se(){oe[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,oe[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,oe[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))}oe[V([115,116,97,116,101])]==V([114,101,97,100,121])?se():oe[V([111,110,99,101])](V([114,101,97,100,121]),()=>se())}function Se(){return null}function Ke(oe,se){const xe=!!(oe&se[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),fe=je(oe,se);return xe||fe}function je(oe,se){const xe=(se[V([111,112,116,105,111,110,115])]||{})[V([102,103,105])]||null;return!!xe&&ie[V([102,105,108,116,101,114])](fe=>xe[V([105,110,99,108,117,100,101,115])](fe[V([105,100])]))[V([102,105,108,116,101,114])](fe=>!qe(fe))[V([115,111,109,101])](fe=>!!(oe&fe[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function qe(oe){const se={[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:Ge};return!!oe.forbiddenHandler&&se[oe.forbiddenHandler]()}function Ge(){return!window[V([68,114,117,112,97,108])]||!Te(ae,V([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function Ze(oe){if(!Te(ae,oe[V([112,108,117,103,105,110,78,97,109,101])]))return!0;const se=oe[V([111,112,116,105,111,110,115])]||{},xe=se[V([97,105,119,115,103,105,99])]||!1,fe=se[V([97,105,116,99,100,103,105,108])]||!1,ve=se[V([97,105,114,118,105,105,108])]||!1;return Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&xe||Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[V([114,101,115,117,108,116])]==V([101,110,100])&&fe?!0:!(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||ke(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[V([114,101,115,117,108,116])]!=V([101,110,100])||!ve)}function Te(oe,se){return oe[V([112,108,117,103,105,110,115])][V([104,97,115])](se)}function ke(oe,se){return oe[V([112,108,117,103,105,110,115])][V([103,101,116])](se)}function Ye(oe){let se="";for(const xe of oe)se+=String[V([102,114,111,109,67,104,97,114,67,111,100,101])](xe);return se}function Je(oe){const se=new Uint8Array(oe[V([108,101,110,103,116,104])]);for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe++)se[xe]=oe[V([99,104,97,114,67,111,100,101,65,116])](xe);return se}be&&ge(te(we),be)})(B)})(this)}_removeMenuBarButtonIfUnnecessary(){const B=this.editor.config;if(B.get("mergeFields.previewModes")){const V=B.get("mergeFields.previewModes");V.length===1&&(V.includes("$dataSets")?B.get("mergeFields.dataSets").length===1&&t():t())}function t(){const V=B.get("menuBar.removeItems");V?(V.push("menuBar:previewMergeFields"),B.set("menuBar.removeItems",V)):B.set("menuBar.removeItems",["menuBar:previewMergeFields"])}}_setupMentionConfiguration(){const B=this.editor,t=B.config.get("mention.feeds"),V=B.config.get("mergeFields.prefix");t.push({marker:V.charAt(0),dropdownLimit:10,feed:N=>{if(N.slice(0,V.length-1)!==V.slice(1))return[];const W=N&&N.toLowerCase().slice(V.length-1);return B.plugins.get("MergeFieldsEditing").flattenedMergeFieldDefinitions.filter(K=>{const G=B.commands.get("insertMergeField").isEnabled,Z=B.commands.get("insertMergeFieldBlock").isEnabled,Y=B.plugins.get("MergeFieldsEditing").getMergeFieldType(K.id);return Y==="text"&&!G||Y==="block"&&!Z?!1:B.plugins.get("MergeFieldsEditing").getLabel(K.id).toLowerCase().includes(W)})},itemRenderer:N=>{const W=document.createElement("button");return W.innerHTML=""+(N.label||N.id),W}}),B.config.set("mention.feeds",t)}_overrideMentionExecuteListener(){const B=this.editor;B.commands.get("mention").on("execute",(t,V)=>{const N=V[0];N.marker===B.config.get("mergeFields.prefix").charAt(0)&&B.model.change(W=>{W.remove(N.range),B.plugins.get("MergeFieldsEditing").getMergeFieldType(N.mention.id)==="text"?B.execute("insertMergeField",N.mention.id):B.execute("insertMergeFieldBlock",N.mention.id,!1),t.stop()})},{priority:"high"})}};function C(H,B,t,V){const N=new ListItemGroupView(H,new LabelWithHighlightView);N.label=B;for(const W of t){const K=J(H,W,W.type==="block"?V.insertBlock:V.insertInline);K.delegate("execute").to(N),N.items.add(K)}return N}function J(H,B,t){const V=new ListItemView(H),N=new ButtonLabelWithHighlightView,W=new ButtonView(H,N);return V.children.add(W),W.set({label:B.label||B.id,withText:!0}),W.bind("isEnabled").to(t),W.on("execute",()=>{V.fire("execute",B.id)}),V}function P(H,B,t){const V=new MenuBarMenuView(H),N=new MenuBarMenuListView(H);for(const W of B.definitions){const K=R(H,W,V,W.type==="block"?t.insertBlock:t.insertInline);N.items.add(K)}return V.set({class:"ck-menu-bar__merge-fields-submenu"}),V.buttonView.set({label:B.groupLabel||B.groupId}),V.panelView.children.add(N),V}function R(H,B,t,V){const N=new MenuBarMenuListItemView(H,t),W=new MenuBarMenuListItemButtonView(H);return W.set({label:B.label||B.id}),N.delegate("execute").to(t),N.children.add(W),W.bind("isEnabled").to(V),W.on("execute",()=>{N.fire("execute",B.id)}),N}let g$2=class extends Plugin{static get requires(){return[m$2,d$1]}static get pluginName(){return"MergeFields"}};const m$1=/<meta\s*name="?generator"?\s*content="?microsoft\s*excel\s*\d+"?\/?>/i;function k(H){return m$1.test(H)}const S=/^(?<tagName>(?!\.)[\w-]+)?(\.(?<className>[\w-]+))?$/i;function b$1(H,B){const t=new Map;for(const[V,N]of B){if(!V.tagName&&!V.className)continue;const W=!V.tagName||H.name===V.tagName,K=!V.className||H.hasClass(V.className);W&&K&&t.set(V,N)}return t}function h$1(H){const B={};for(let t=0;t<H.length;t++){const V=H[t],N=H.getPropertyValue(V);N!=="initial"&&(B[V]=N)}return B}function O(H){const B=H.split(",").map(V=>V.trim()),t=[];for(const V of B){const N=S.exec(V);N&&t.push(N.groups)}return t}function g$1(H){const B={};for(const t of H)Object.assign(B,t);return B}class u extends MSWordNormalizer{execute(B){const{body:t,styles:V}=B._parsedData,N=new UpcastWriter(t.document),W=N.createRangeIn(t),K=function(Z){const Y={};for(const X of Z)for(const Q of X.cssRules)if(Q instanceof CSSStyleRule){const te=h$1(Q.style);Y[Q.selectorText]=Object.assign({},Y[Q.selectorText]||{},te)}return Y}(V),G=function(Z){const Y=new Map;for(const X in Z){const Q=O(X),te=Z[X];for(const ie of Q)Y.set(ie,te)}return Y}(K);for(const Z of W){if(Z.type!=="elementStart")continue;const Y=b$1(Z.item,G);if(Y.size){const X=g$1(Array.from(Y.values()));for(const Q in X){const te=Z.item;te.hasStyle(Q)||N.setStyle(Q,X[Q],te)}}}B.content=t}isActive(B){return super.isActive(B)||k(B)}}let r$1=class extends Plugin{static get pluginName(){return"PasteFromOfficeEnhancedInliner"}static get requires(){return["PasteFromOffice"]}init(){const B=this.editor,t=B.plugins.get("ClipboardPipeline"),V=B.editing.view.document,N=new u(V);t.on("inputTransformation",(W,K)=>{const G=K.dataTransfer.getData("text/html");N.isActive(G)&&(K._parsedData||(K._parsedData=parseHtml(G,V.stylesProcessor)),N.execute(K))},{priority:priorities.get("high")+11})}afterInit(){(function(B){function t(N,W,K){const G={};G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},G[V([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],G[V([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],G[V([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],G[V([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],G[V([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],G[V([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],G[V([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],G[V([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],G[V([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],G[V([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Z=new Uint8Array(16);for(let ce=15;ce>=0;--ce)Z[ce]=K%256,K=parseInt(K/256);let Y=null,X=16;const Q=new Uint8Array(W),te=[],ie=[];de();for(let ce=0;ce<N[V([108,101,110,103,116,104])];ce++)X===16&&(Y=ae(Z),X=0,le(Z)),N[ce]^=Y[X++];return N;function ne(ce){const we=[];for(let be=0;be<ce[V([108,101,110,103,116,104])];be+=4)we[V([112,117,115,104])](ce[be]<<24|ce[be+1]<<16|ce[be+2]<<8|ce[be+3]);return we}function le(ce){for(let we=15;we>=0;we--){if(ce[we]!==255){ce[we]++;break}ce[we]=0}}function ae(ce){const we=te[V([108,101,110,103,116,104])]-1,be=[0,0,0,0];let ge=ne(ce);for(let me=0;me<4;me++)ge[me]^=te[0][me];for(let me=1;me<we;me++){for(let pe=0;pe<4;pe++)be[pe]=G[V([84,49])][ge[pe]>>24&255]^G[V([84,50])][ge[(pe+1)%4]>>16&255]^G[V([84,51])][ge[(pe+2)%4]>>8&255]^G[V([84,52])][255&ge[(pe+3)%4]]^te[me][pe];ge=be[V([115,108,105,99,101])]()}const Ce=new Uint8Array(16);let he;for(let me=0;me<4;me++)he=te[we][me],Ce[4*me]=255&(G[V([83])][ge[me]>>24&255]^he>>24),Ce[4*me+1]=255&(G[V([83])][ge[(me+1)%4]>>16&255]^he>>16),Ce[4*me+2]=255&(G[V([83])][ge[(me+2)%4]>>8&255]^he>>8),Ce[4*me+3]=255&(G[V([83])][255&ge[(me+3)%4]]^he);return Ce}function de(){const ce=G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Q[V([108,101,110,103,116,104])]];for(let _e=0;_e<=ce;_e++)te[V([112,117,115,104])]([0,0,0,0]),ie[V([112,117,115,104])]([0,0,0,0]);const we=4*(ce+1),be=Q[V([108,101,110,103,116,104])]/4,ge=ne(Q);let Ce;for(let _e=0;_e<be;_e++)Ce=_e>>2,te[Ce][_e%4]=ge[_e],ie[ce-Ce][_e%4]=ge[_e];let he,me=0,pe=be;for(;pe<we;){he=ge[be-1],ge[0]^=G[V([83])][he>>16&255]<<24^G[V([83])][he>>8&255]<<16^G[V([83])][255&he]<<8^G[V([83])][he>>24&255]^G[V([114,99,111,110])][me]<<24,me+=1;for(let Ae=1;Ae<be/2;Ae++)ge[Ae]^=ge[Ae-1];he=ge[be/2-1],ge[be/2]^=G[V([83])][255&he]^G[V([83])][he>>8&255]<<8^G[V([83])][he>>16&255]<<16^G[V([83])][he>>24&255]<<24;for(let Ae=be/2+1;Ae<be;Ae++)ge[Ae]^=ge[Ae-1];let _e,ye,Re=0;for(;Re<be&&pe<we;)_e=pe>>2,ye=pe%4,te[_e][ye]=ge[Re],ie[ce-_e][ye]=ge[Re++],pe++}for(let _e=1;_e<ce;_e++)for(let ye=0;ye<4;ye++)he=ie[_e][ye],ie[_e][ye]=G[V([85,49])][he>>24&255]^G[V([85,50])][he>>16&255]^G[V([85,51])][he>>8&255]^G[V([85,52])][255&he]}}function V(N){return N.map(W=>String.fromCharCode(W)).join("")}(N=>{function W(){const oe=[{[V([105,100])]:1,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,111,109,109,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([99,104,101,99,107,65,108,115,111])]:[{[V([105,100])]:2,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,114,97,99,107,32,67,104,97,110,103,101,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}}],[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:3,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:4,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[V([112,108,117,103,105,110,78,97,109,101])]:V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:5,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:6,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[V([112,108,117,103,105,110,78,97,109,101])]:V([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:7,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([83,108,97,115,104,32,67,111,109,109,97,110,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:8,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:9,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,101,109,112,108,97,116,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,101,109,112,108,97,116,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12,14]}},{[V([105,100])]:10,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:11,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([65,73,32,65,115,115,105,115,116,97,110,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([65,73,65,115,115,105,115,116,97,110,116,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([97,105,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:12,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[V([105,100])]:13,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,97,115,101,32,67,104,97,110,103,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,97,115,101,67,104,97,110,103,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:14,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,114,117,112,97,108,32,112,97,99,107]),[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[V([105,100])]:15,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:16,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,101,114,103,101,32,70,105,101,108,100,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,101,114,103,101,70,105,101,108,100,115,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}}];return xe(oe),oe;function se(fe){return 1<<fe-1}function xe(fe){fe[V([102,111,114,69,97,99,104])](ve=>{ve[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=se(ve[V([105,100])]),K(ve)&&ve[V([99,104,101,99,107,65,108,115,111])]&&xe(ve[V([99,104,101,99,107,65,108,115,111])])})}}function K(oe){return V([112,108,117,103,105,110,78,97,109,101])in oe}const G=[1,85,78,115,198,255,50,112,83,87,161],Z=[127,34,6,211,167,86,146,199,132,160,18];function Y(oe){const se=[29,221,175,90,231,133,239,240,75,180];return X(oe,new Uint8Array([...G,...se,...Z]))}function X(oe,se){const xe=Q(oe),fe=Array[V([102,114,111,109])](Je(xe)),ve=fe[V([112,111,112])](),Ie=fe[V([112,111,112])]();return Ye(t(fe,se,Ie+256*ve))}function Q(oe){const se=atob(oe),[xe,fe]=se[V([115,112,108,105,116])](V([45]));try{if(atob(fe))return atob(xe)}catch{}return se}function te(oe){try{const se=Y(oe),xe=JSON[V([112,97,114,115,101])](se),fe=parseInt(xe[V([49])]),ve=xe[V([50])]||"",Ie=parseInt(xe[V([51])]),Ne=parseInt(xe[V([52])])||0,De=parseInt(xe[V([53])])||0;return{[V([112,114,111,100,117,99,116,78,97,109,101])]:ve,[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:Ne,[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:fe,[V([105,115,84,114,105,97,108])]:Ie,[V([105,115,73,110,116,101,114,110,97,108])]:De}}catch{return null}}const ie=W(),ne={[V([99,104,101,99,107,76,105,99,101,110,115,101])]:Ce,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:he,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:me},le=N[V([99,111,110,115,116,114,117,99,116,111,114])][V([112,108,117,103,105,110,78,97,109,101])],ae=V([99,111,110,116,101,120,116])in N?N.context:N.editor,de=V([52,48,52,56,50,48,48,52]),ce=V([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),we=ae.config.get(V([108,105,99,101,110,115,101,75,101,121])),be=ie[V([102,105,108,116,101,114])](K)[V([102,105,110,100])](oe=>oe[V([112,108,117,103,105,110,78,97,109,101])]===le);function ge(oe,se){ne[se[V([104,97,110,100,108,101,114])]](oe,se),se[V([99,104,101,99,107,65,108,115,111])]&&se[V([99,104,101,99,107,65,108,115,111])][V([102,105,108,116,101,114])](xe=>Te(ae,xe[V([112,108,117,103,105,110,78,97,109,101])]))[V([102,111,114,69,97,99,104])](xe=>ge(oe,xe))}function Ce(oe,se){_e(pe(oe,se),se)}function he(oe,se){function xe(fe,ve){try{if(Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&fe){const Ie=ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[V([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Ie)/2>fe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}return pe(fe,ve)}catch{return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}_e(xe(oe,se),se)}function me(oe,se){const xe=Z[0]*G[1],fe=Z[0]*G[2],ve=Z[2]*G[2];Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&(window[Re()]=ve);function Ie(ue,Ee){try{return Xe()?ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):pe(ue,Ee)}catch{return ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function Ne(ue,Ee){if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))ze();else if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])){const Ve=De();Ve&&Le(Ve,Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const Oe=Qe();window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Le(V([116,105,109,101]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},Oe);const $e=ke(ae,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[V([95,114,101,118,105,115,105,111,110,115])];$e[V([108,101,110,103,116,104])]>=7?Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):$e.on(V([97,100,100]),()=>{$e[V([108,101,110,103,116,104])]>=7&&Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function De(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))){if(window[ue]===xe)return V([116,105,109,101]);if(window[ue]===fe)return V([114,101,118,105,115,105,111,110,115])}return!1}function Xe(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))&&window[ue]===ve)return!0;return!1}function Le(ue,Ee){ze(),ye(Ee+V([84,114,105,97,108,76,105,109,105,116,58])+ue),window[Re()]=ue===V([116,105,109,101])?xe:fe}function Qe(){let ue=Z[6]*G[8]*G[6];return Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ue/=10),ue}function ze(){const ue=ae;function Ee(){Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,112,100,97,116,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([115,97,118,101,82,101,118,105,115,105,111,110])]=Se,ue[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,ue[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,ue[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([95,103,101,116,68,105,102,102])]=Se)}ue[V([115,116,97,116,101])]==V([114,101,97,100,121])?Ee():ue[V([111,110,99,101])](V([114,101,97,100,121]),()=>{if(Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Ee(),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Me=ke(ue,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),Ve=Me.getRevision(0),Oe=Me.getEarlierVisibleRevision(Ve[V([105,100])]);ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])](Ve[V([105,100])],Oe?Oe[V([105,100])]:null,1).then(()=>Ee())}})}Ne(Ie(oe,se),se)}function pe(oe,se){try{return Ze(se)?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):oe&&Ke(oe[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],se)?oe[V([105,115,73,110,116,101,114,110,97,108])]&&!window[V([111,112,101,110])][V([99,108,111,115,101,100])]||parseInt(de)/2>oe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])):oe[V([105,115,84,114,105,97,108])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}catch{return ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function _e(oe,se){if(ae instanceof Context){const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Ae(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Ae(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Z[6]*G[8]*G[6]),xe[V([101,100,105,116,111,114,115])][V([111,110])](V([97,100,100]),(fe,ve)=>{oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Be(ve)})}else{const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Be(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&xe[V([111,110])](V([114,101,97,100,121]),()=>{let fe=0;xe[V([109,111,100,101,108])][V([111,110])](V([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(ve,Ie)=>{Ie[0][V([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&fe++,fe===504&&(Be(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),ve[V([111,102,102])]())},{priority:V([104,105,103,104,101,115,116])})})}}function ye(oe){const se=Re();return ae[se]=oe,oe}function Re(){const oe=String(window[V([112,101,114,102,111,114,109,97,110,99,101])][V([110,111,119])]())[V([114,101,112,108,97,99,101])](V([46]),"");let se="";for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe+=2){let fe=parseInt(oe[V([115,117,98,115,116,114,105,110,103])](xe,xe+2));fe>=ce[V([108,101,110,103,116,104])]&&(fe-=ce[V([108,101,110,103,116,104])]),se+=ce[fe]}return se}function Ae(oe){for(const se of oe[V([101,100,105,116,111,114,115])])Be(se);ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=Se}function Be(oe){function se(){oe[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,oe[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,oe[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))}oe[V([115,116,97,116,101])]==V([114,101,97,100,121])?se():oe[V([111,110,99,101])](V([114,101,97,100,121]),()=>se())}function Se(){return null}function Ke(oe,se){const xe=!!(oe&se[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),fe=je(oe,se);return xe||fe}function je(oe,se){const xe=(se[V([111,112,116,105,111,110,115])]||{})[V([102,103,105])]||null;return!!xe&&ie[V([102,105,108,116,101,114])](fe=>xe[V([105,110,99,108,117,100,101,115])](fe[V([105,100])]))[V([102,105,108,116,101,114])](fe=>!qe(fe))[V([115,111,109,101])](fe=>!!(oe&fe[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function qe(oe){const se={[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:Ge};return!!oe.forbiddenHandler&&se[oe.forbiddenHandler]()}function Ge(){return!window[V([68,114,117,112,97,108])]||!Te(ae,V([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function Ze(oe){if(!Te(ae,oe[V([112,108,117,103,105,110,78,97,109,101])]))return!0;const se=oe[V([111,112,116,105,111,110,115])]||{},xe=se[V([97,105,119,115,103,105,99])]||!1,fe=se[V([97,105,116,99,100,103,105,108])]||!1,ve=se[V([97,105,114,118,105,105,108])]||!1;return Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&xe||Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[V([114,101,115,117,108,116])]==V([101,110,100])&&fe?!0:!(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||ke(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[V([114,101,115,117,108,116])]!=V([101,110,100])||!ve)}function Te(oe,se){return oe[V([112,108,117,103,105,110,115])][V([104,97,115])](se)}function ke(oe,se){return oe[V([112,108,117,103,105,110,115])][V([103,101,116])](se)}function Ye(oe){let se="";for(const xe of oe)se+=String[V([102,114,111,109,67,104,97,114,67,111,100,101])](xe);return se}function Je(oe){const se=new Uint8Array(oe[V([108,101,110,103,116,104])]);for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe++)se[xe]=oe[V([99,104,97,114,67,111,100,101,65,116])](xe);return se}be&&ge(te(we),be)})(B)})(this)}};const I$1=["color","font-family","font-size","text-decoration","text-decoration-line","font-weight","font-style","vertical-align"],v$1=["color","font-family","font-size"],E={"font-style":[["italic","i"]],"font-weight":[["medium","strong"],["bold","strong"],["bolder","strong"],[H=>Number(H)>=600,"strong"]],"text-decoration":[["underline","u"],["line-through","s"]],"text-decoration-line":[["underline","u"],["line-through","s"]],"vertical-align":[["sub","sub"],["super","sup"]]};function F$1(H){return I$1.includes(H)}function x(H,B,t){const{spanStyles:V,stylesToBeHtmlElements:N}=function(W,K){const G={},Z={};return K.forEach(Y=>{const X=W.getStyle(Y);if(X){if(function(Q){return v$1.includes(Q)}(Y))G[Y]=X;else if(function(Q){return Q in E}(Y)){const Q=X.split(" ");E[Y].forEach(([te,ie])=>{for(const ne of Q)(typeof te=="function"&&te(ne)||te===ne)&&(Z[Y]=[...Z[Y]||[],[te,ie]])})}}}),{spanStyles:G,stylesToBeHtmlElements:Z}}(H,t);(function(W,K,G){for(const Z in G)G[Z].forEach(([,Y])=>{const X=K.createElement(Y,[],W.getChildren());K.insertChild(0,X,W)}),K.removeStyle(Z,W)})(H,B,N),function(W,K,G){if(!Object.keys(G).length)return;const Z=K.createElement("span",[],W.getChildren());K.setStyle(G,Z),K.insertChild(0,Z,W),K.removeStyle(Object.keys(G),W)}(H,B,V)}class l extends MSWordNormalizer{execute(B){const{body:t}=B._parsedData,V=new UpcastWriter(t.document),N=V.createRangeIn(t),W=new Document$1(V.document.stylesProcessor),K=[...new DomConverter(W).blockElements,"font"],G=N.getItems();for(const Y of G)Y.is("element")&&K.includes(Y.name)&&x(Y,V,(Z=Y,Array.from(Z.getStyleNames()).filter(F$1)));var Z;B.content=t}isActive(B){return super.isActive(B)||k(B)}}class o extends Plugin{constructor(t){super(t);ee(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"PasteFromOfficeEnhancedPropagator"}static get requires(){return["PasteFromOffice"]}init(){const t=this.editor,V=t.plugins.get("ClipboardPipeline"),N=t.editing.view.document,W=new l(N);V.on("inputTransformation",(G,Z)=>{const Y=Z.dataTransfer.getData("text/html");W.isActive(Y)&&(Z._parsedData||(Z._parsedData=parseHtml(Y,N.stylesProcessor)),W.execute(Z))},{priority:priorities.get("high")+10}),this.licenseKey=t.config.get("licenseKey");const K=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let G;for(const Z in K){const Y=Z,X=K[Y];if(X==="pasteFromOfficeEnhancedLicenseKeyTrial"||X==="pasteFromOfficeEnhancedLicenseKeyInvalid"||X==="pasteFromOfficeEnhancedLicenseKeyValid"||X==="pasteFromOfficeEnhancedLicenseKeyTrialLimit:operations"){delete K[Y],G=X;break}}if(G==="pasteFromOfficeEnhancedLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("paste-from-office-enhanced-invalid-license-key",null);if(G==="pasteFromOfficeEnhancedLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 Paste from Office Enhanced plugin with limited usage. Make sure you will not use it in the production environment."),G==="pasteFromOfficeEnhancedLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("paste-from-office-enhanced-trial-license-key-reached-limit-changes",null);G==="pasteFromOfficeEnhancedLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class a extends Plugin{static get pluginName(){return"PasteFromOfficeEnhanced"}static get requires(){return["PasteFromOffice",r$1,o]}}var indexMinimal={},minimal={},aspromise=asPromise;function asPromise(H,B){for(var t=new Array(arguments.length-1),V=0,N=2,W=!0;N<arguments.length;)t[V++]=arguments[N++];return new Promise(function(G,Z){t[V]=function(X){if(W)if(W=!1,X)Z(X);else{for(var Q=new Array(arguments.length-1),te=0;te<Q.length;)Q[te++]=arguments[te];G.apply(null,Q)}};try{H.apply(B||null,t)}catch(Y){W&&(W=!1,Z(Y))}})}var base64$1={};(function(H){var B=H;B.length=function(G){var Z=G.length;if(!Z)return 0;for(var Y=0;--Z%4>1&&G.charAt(Z)==="=";)++Y;return Math.ceil(G.length*3)/4-Y};for(var t=new Array(64),V=new Array(123),N=0;N<64;)V[t[N]=N<26?N+65:N<52?N+71:N<62?N-4:N-59|43]=N++;B.encode=function(G,Z,Y){for(var X=null,Q=[],te=0,ie=0,ne;Z<Y;){var le=G[Z++];switch(ie){case 0:Q[te++]=t[le>>2],ne=(le&3)<<4,ie=1;break;case 1:Q[te++]=t[ne|le>>4],ne=(le&15)<<2,ie=2;break;case 2:Q[te++]=t[ne|le>>6],Q[te++]=t[le&63],ie=0;break}te>8191&&((X||(X=[])).push(String.fromCharCode.apply(String,Q)),te=0)}return ie&&(Q[te++]=t[ne],Q[te++]=61,ie===1&&(Q[te++]=61)),X?(te&&X.push(String.fromCharCode.apply(String,Q.slice(0,te))),X.join("")):String.fromCharCode.apply(String,Q.slice(0,te))};var W="invalid encoding";B.decode=function(G,Z,Y){for(var X=Y,Q=0,te,ie=0;ie<G.length;){var ne=G.charCodeAt(ie++);if(ne===61&&Q>1)break;if((ne=V[ne])===void 0)throw Error(W);switch(Q){case 0:te=ne,Q=1;break;case 1:Z[Y++]=te<<2|(ne&48)>>4,te=ne,Q=2;break;case 2:Z[Y++]=(te&15)<<4|(ne&60)>>2,te=ne,Q=3;break;case 3:Z[Y++]=(te&3)<<6|ne,Q=0;break}}if(Q===1)throw Error(W);return Y-X},B.test=function(G){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(G)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(B,t,V){return(this._listeners[B]||(this._listeners[B]=[])).push({fn:t,ctx:V||this}),this};EventEmitter.prototype.off=function(B,t){if(B===void 0)this._listeners={};else if(t===void 0)this._listeners[B]=[];else for(var V=this._listeners[B],N=0;N<V.length;)V[N].fn===t?V.splice(N,1):++N;return this};EventEmitter.prototype.emit=function(B){var t=this._listeners[B];if(t){for(var V=[],N=1;N<arguments.length;)V.push(arguments[N++]);for(N=0;N<t.length;)t[N].fn.apply(t[N++].ctx,V)}return this};var float=factory(factory);function factory(H){return typeof Float32Array<"u"?function(){var B=new Float32Array([-0]),t=new Uint8Array(B.buffer),V=t[3]===128;function N(Z,Y,X){B[0]=Z,Y[X]=t[0],Y[X+1]=t[1],Y[X+2]=t[2],Y[X+3]=t[3]}function W(Z,Y,X){B[0]=Z,Y[X]=t[3],Y[X+1]=t[2],Y[X+2]=t[1],Y[X+3]=t[0]}H.writeFloatLE=V?N:W,H.writeFloatBE=V?W:N;function K(Z,Y){return t[0]=Z[Y],t[1]=Z[Y+1],t[2]=Z[Y+2],t[3]=Z[Y+3],B[0]}function G(Z,Y){return t[3]=Z[Y],t[2]=Z[Y+1],t[1]=Z[Y+2],t[0]=Z[Y+3],B[0]}H.readFloatLE=V?K:G,H.readFloatBE=V?G:K}():function(){function B(V,N,W,K){var G=N<0?1:0;if(G&&(N=-N),N===0)V(1/N>0?0:2147483648,W,K);else if(isNaN(N))V(2143289344,W,K);else if(N>34028234663852886e22)V((G<<31|2139095040)>>>0,W,K);else if(N<11754943508222875e-54)V((G<<31|Math.round(N/1401298464324817e-60))>>>0,W,K);else{var Z=Math.floor(Math.log(N)/Math.LN2),Y=Math.round(N*Math.pow(2,-Z)*8388608)&8388607;V((G<<31|Z+127<<23|Y)>>>0,W,K)}}H.writeFloatLE=B.bind(null,writeUintLE),H.writeFloatBE=B.bind(null,writeUintBE);function t(V,N,W){var K=V(N,W),G=(K>>31)*2+1,Z=K>>>23&255,Y=K&8388607;return Z===255?Y?NaN:G*(1/0):Z===0?G*1401298464324817e-60*Y:G*Math.pow(2,Z-150)*(Y+8388608)}H.readFloatLE=t.bind(null,readUintLE),H.readFloatBE=t.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var B=new Float64Array([-0]),t=new Uint8Array(B.buffer),V=t[7]===128;function N(Z,Y,X){B[0]=Z,Y[X]=t[0],Y[X+1]=t[1],Y[X+2]=t[2],Y[X+3]=t[3],Y[X+4]=t[4],Y[X+5]=t[5],Y[X+6]=t[6],Y[X+7]=t[7]}function W(Z,Y,X){B[0]=Z,Y[X]=t[7],Y[X+1]=t[6],Y[X+2]=t[5],Y[X+3]=t[4],Y[X+4]=t[3],Y[X+5]=t[2],Y[X+6]=t[1],Y[X+7]=t[0]}H.writeDoubleLE=V?N:W,H.writeDoubleBE=V?W:N;function K(Z,Y){return t[0]=Z[Y],t[1]=Z[Y+1],t[2]=Z[Y+2],t[3]=Z[Y+3],t[4]=Z[Y+4],t[5]=Z[Y+5],t[6]=Z[Y+6],t[7]=Z[Y+7],B[0]}function G(Z,Y){return t[7]=Z[Y],t[6]=Z[Y+1],t[5]=Z[Y+2],t[4]=Z[Y+3],t[3]=Z[Y+4],t[2]=Z[Y+5],t[1]=Z[Y+6],t[0]=Z[Y+7],B[0]}H.readDoubleLE=V?K:G,H.readDoubleBE=V?G:K}():function(){function B(V,N,W,K,G,Z){var Y=K<0?1:0;if(Y&&(K=-K),K===0)V(0,G,Z+N),V(1/K>0?0:2147483648,G,Z+W);else if(isNaN(K))V(0,G,Z+N),V(2146959360,G,Z+W);else if(K>17976931348623157e292)V(0,G,Z+N),V((Y<<31|2146435072)>>>0,G,Z+W);else{var X;if(K<22250738585072014e-324)X=K/5e-324,V(X>>>0,G,Z+N),V((Y<<31|X/4294967296)>>>0,G,Z+W);else{var Q=Math.floor(Math.log(K)/Math.LN2);Q===1024&&(Q=1023),X=K*Math.pow(2,-Q),V(X*4503599627370496>>>0,G,Z+N),V((Y<<31|Q+1023<<20|X*1048576&1048575)>>>0,G,Z+W)}}}H.writeDoubleLE=B.bind(null,writeUintLE,0,4),H.writeDoubleBE=B.bind(null,writeUintBE,4,0);function t(V,N,W,K,G){var Z=V(K,G+N),Y=V(K,G+W),X=(Y>>31)*2+1,Q=Y>>>20&2047,te=4294967296*(Y&1048575)+Z;return Q===2047?te?NaN:X*(1/0):Q===0?X*5e-324*te:X*Math.pow(2,Q-1075)*(te+4503599627370496)}H.readDoubleLE=t.bind(null,readUintLE,0,4),H.readDoubleBE=t.bind(null,readUintBE,4,0)}(),H}function writeUintLE(H,B,t){B[t]=H&255,B[t+1]=H>>>8&255,B[t+2]=H>>>16&255,B[t+3]=H>>>24}function writeUintBE(H,B,t){B[t]=H>>>24,B[t+1]=H>>>16&255,B[t+2]=H>>>8&255,B[t+3]=H&255}function readUintLE(H,B){return(H[B]|H[B+1]<<8|H[B+2]<<16|H[B+3]<<24)>>>0}function readUintBE(H,B){return(H[B]<<24|H[B+1]<<16|H[B+2]<<8|H[B+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(H){}return null}var utf8$2={};(function(H){var B=H;B.length=function(V){for(var N=0,W=0,K=0;K<V.length;++K)W=V.charCodeAt(K),W<128?N+=1:W<2048?N+=2:(W&64512)===55296&&(V.charCodeAt(K+1)&64512)===56320?(++K,N+=4):N+=3;return N},B.read=function(V,N,W){var K=W-N;if(K<1)return"";for(var G=null,Z=[],Y=0,X;N<W;)X=V[N++],X<128?Z[Y++]=X:X>191&&X<224?Z[Y++]=(X&31)<<6|V[N++]&63:X>239&&X<365?(X=((X&7)<<18|(V[N++]&63)<<12|(V[N++]&63)<<6|V[N++]&63)-65536,Z[Y++]=55296+(X>>10),Z[Y++]=56320+(X&1023)):Z[Y++]=(X&15)<<12|(V[N++]&63)<<6|V[N++]&63,Y>8191&&((G||(G=[])).push(String.fromCharCode.apply(String,Z)),Y=0);return G?(Y&&G.push(String.fromCharCode.apply(String,Z.slice(0,Y))),G.join("")):String.fromCharCode.apply(String,Z.slice(0,Y))},B.write=function(V,N,W){for(var K=W,G,Z,Y=0;Y<V.length;++Y)G=V.charCodeAt(Y),G<128?N[W++]=G:G<2048?(N[W++]=G>>6|192,N[W++]=G&63|128):(G&64512)===55296&&((Z=V.charCodeAt(Y+1))&64512)===56320?(G=65536+((G&1023)<<10)+(Z&1023),++Y,N[W++]=G>>18|240,N[W++]=G>>12&63|128,N[W++]=G>>6&63|128,N[W++]=G&63|128):(N[W++]=G>>12|224,N[W++]=G>>6&63|128,N[W++]=G&63|128);return W-K}})(utf8$2);var pool_1=pool;function pool(H,B,t){var V=t||8192,N=V>>>1,W=null,K=V;return function(Z){if(Z<1||Z>N)return H(Z);K+Z>V&&(W=H(V),K=0);var Y=B.call(W,K,K+=Z);return K&7&&(K=(K|7)+1),Y}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=B;var H=requireMinimal();function B(W,K){this.lo=W>>>0,this.hi=K>>>0}var t=B.zero=new B(0,0);t.toNumber=function(){return 0},t.zzEncode=t.zzDecode=function(){return this},t.length=function(){return 1};var V=B.zeroHash="\0\0\0\0\0\0\0\0";B.fromNumber=function(K){if(K===0)return t;var G=K<0;G&&(K=-K);var Z=K>>>0,Y=(K-Z)/4294967296>>>0;return G&&(Y=~Y>>>0,Z=~Z>>>0,++Z>4294967295&&(Z=0,++Y>4294967295&&(Y=0))),new B(Z,Y)},B.from=function(K){if(typeof K=="number")return B.fromNumber(K);if(H.isString(K))if(H.Long)K=H.Long.fromString(K);else return B.fromNumber(parseInt(K,10));return K.low||K.high?new B(K.low>>>0,K.high>>>0):t},B.prototype.toNumber=function(K){if(!K&&this.hi>>>31){var G=~this.lo+1>>>0,Z=~this.hi>>>0;return G||(Z=Z+1>>>0),-(G+Z*4294967296)}return this.lo+this.hi*4294967296},B.prototype.toLong=function(K){return H.Long?new H.Long(this.lo|0,this.hi|0,!!K):{low:this.lo|0,high:this.hi|0,unsigned:!!K}};var N=String.prototype.charCodeAt;return B.fromHash=function(K){return K===V?t:new B((N.call(K,0)|N.call(K,1)<<8|N.call(K,2)<<16|N.call(K,3)<<24)>>>0,(N.call(K,4)|N.call(K,5)<<8|N.call(K,6)<<16|N.call(K,7)<<24)>>>0)},B.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},B.prototype.zzEncode=function(){var K=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^K)>>>0,this.lo=(this.lo<<1^K)>>>0,this},B.prototype.zzDecode=function(){var K=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^K)>>>0,this.hi=(this.hi>>>1^K)>>>0,this},B.prototype.length=function(){var K=this.lo,G=(this.lo>>>28|this.hi<<4)>>>0,Z=this.hi>>>24;return Z===0?G===0?K<16384?K<128?1:2:K<2097152?3:4:G<16384?G<128?5:6:G<2097152?7:8:Z<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(H){var B=H;B.asPromise=aspromise,B.base64=base64$1,B.EventEmitter=eventemitter,B.float=float,B.inquire=inquire_1,B.utf8=utf8$2,B.pool=pool_1,B.LongBits=requireLongbits(),B.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),B.global=B.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,B.emptyArray=Object.freeze?Object.freeze([]):[],B.emptyObject=Object.freeze?Object.freeze({}):{},B.isInteger=Number.isInteger||function(W){return typeof W=="number"&&isFinite(W)&&Math.floor(W)===W},B.isString=function(W){return typeof W=="string"||W instanceof String},B.isObject=function(W){return W&&typeof W=="object"},B.isset=B.isSet=function(W,K){var G=W[K];return G!=null&&W.hasOwnProperty(K)?typeof G!="object"||(Array.isArray(G)?G.length:Object.keys(G).length)>0:!1},B.Buffer=function(){try{var N=B.inquire("buffer").Buffer;return N.prototype.utf8Write?N:null}catch{return null}}(),B._Buffer_from=null,B._Buffer_allocUnsafe=null,B.newBuffer=function(W){return typeof W=="number"?B.Buffer?B._Buffer_allocUnsafe(W):new B.Array(W):B.Buffer?B._Buffer_from(W):typeof Uint8Array>"u"?W:new Uint8Array(W)},B.Array=typeof Uint8Array<"u"?Uint8Array:Array,B.Long=B.global.dcodeIO&&B.global.dcodeIO.Long||B.global.Long||B.inquire("long"),B.key2Re=/^true|false|0|1$/,B.key32Re=/^-?(?:0|[1-9][0-9]*)$/,B.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,B.longToHash=function(W){return W?B.LongBits.from(W).toHash():B.LongBits.zeroHash},B.longFromHash=function(W,K){var G=B.LongBits.fromHash(W);return B.Long?B.Long.fromBits(G.lo,G.hi,K):G.toNumber(!!K)};function t(N,W,K){for(var G=Object.keys(W),Z=0;Z<G.length;++Z)(N[G[Z]]===void 0||!K)&&(N[G[Z]]=W[G[Z]]);return N}B.merge=t,B.lcFirst=function(W){return W.charAt(0).toLowerCase()+W.substring(1)};function V(N){function W(K,G){if(!(this instanceof W))return new W(K,G);Object.defineProperty(this,"message",{get:function(){return K}}),Error.captureStackTrace?Error.captureStackTrace(this,W):Object.defineProperty(this,"stack",{value:new Error().stack||""}),G&&t(this,G)}return W.prototype=Object.create(Error.prototype,{constructor:{value:W,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return N},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),W}B.newError=V,B.ProtocolError=V("ProtocolError"),B.oneOfGetter=function(W){for(var K={},G=0;G<W.length;++G)K[W[G]]=1;return function(){for(var Z=Object.keys(this),Y=Z.length-1;Y>-1;--Y)if(K[Z[Y]]===1&&this[Z[Y]]!==void 0&&this[Z[Y]]!==null)return Z[Y]}},B.oneOfSetter=function(W){return function(K){for(var G=0;G<W.length;++G)W[G]!==K&&delete this[W[G]]}},B.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},B._configure=function(){var N=B.Buffer;if(!N){B._Buffer_from=B._Buffer_allocUnsafe=null;return}B._Buffer_from=N.from!==Uint8Array.from&&N.from||function(K,G){return new N(K,G)},B._Buffer_allocUnsafe=N.allocUnsafe||function(K){return new N(K)}}}(minimal)),minimal}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(H,B,t){this.fn=H,this.len=B,this.next=void 0,this.val=t}function noop(){}function State(H){this.head=H.head,this.tail=H.tail,this.len=H.len,this.next=H.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function H(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function H(B){return new util$4.Array(B)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function H(B,t,V){return this.tail=this.tail.next=new Op(B,t,V),this.len+=t,this};function writeByte(H,B,t){B[t]=H&255}function writeVarint32(H,B,t){for(;H>127;)B[t++]=H&127|128,H>>>=7;B[t]=H}function VarintOp(H,B){this.len=H,this.next=void 0,this.val=B}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function H(B){return this.len+=(this.tail=this.tail.next=new VarintOp((B=B>>>0)<128?1:B<16384?2:B<2097152?3:B<268435456?4:5,B)).len,this};Writer$1.prototype.int32=function H(B){return B<0?this._push(writeVarint64,10,LongBits$1.fromNumber(B)):this.uint32(B)};Writer$1.prototype.sint32=function H(B){return this.uint32((B<<1^B>>31)>>>0)};function writeVarint64(H,B,t){for(;H.hi;)B[t++]=H.lo&127|128,H.lo=(H.lo>>>7|H.hi<<25)>>>0,H.hi>>>=7;for(;H.lo>127;)B[t++]=H.lo&127|128,H.lo=H.lo>>>7;B[t++]=H.lo}Writer$1.prototype.uint64=function H(B){var t=LongBits$1.from(B);return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function H(B){var t=LongBits$1.from(B).zzEncode();return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.bool=function H(B){return this._push(writeByte,1,B?1:0)};function writeFixed32(H,B,t){B[t]=H&255,B[t+1]=H>>>8&255,B[t+2]=H>>>16&255,B[t+3]=H>>>24}Writer$1.prototype.fixed32=function H(B){return this._push(writeFixed32,4,B>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function H(B){var t=LongBits$1.from(B);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function H(B){return this._push(util$4.float.writeFloatLE,4,B)};Writer$1.prototype.double=function H(B){return this._push(util$4.float.writeDoubleLE,8,B)};var writeBytes=util$4.Array.prototype.set?function H(B,t,V){t.set(B,V)}:function H(B,t,V){for(var N=0;N<B.length;++N)t[V+N]=B[N]};Writer$1.prototype.bytes=function H(B){var t=B.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(B)){var V=Writer$1.alloc(t=base64.length(B));base64.decode(B,V,0),B=V}return this.uint32(t)._push(writeBytes,t,B)};Writer$1.prototype.string=function H(B){var t=utf8$1.length(B);return t?this.uint32(t)._push(utf8$1.write,t,B):this._push(writeByte,1,0)};Writer$1.prototype.fork=function H(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function H(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function H(){var B=this.head,t=this.tail,V=this.len;return this.reset().uint32(V),V&&(this.tail.next=B.next,this.tail=t,this.len+=V),this};Writer$1.prototype.finish=function H(){for(var B=this.head.next,t=this.constructor.alloc(this.len),V=0;B;)B.fn(B.val,t,V),V+=B.len,B=B.next;return t};Writer$1._configure=function(H){BufferWriter$1=H,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(B,t,V){t.set(B,V)}:function(B,t,V){if(B.copy)B.copy(t,V,0,B.length);else for(var N=0;N<B.length;)t[V++]=B[N++]}};BufferWriter.prototype.bytes=function H(B){util$3.isString(B)&&(B=util$3._Buffer_from(B,"base64"));var t=B.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,B),this};function writeStringBuffer(H,B,t){H.length<40?util$3.utf8.write(H,B,t):B.utf8Write?B.utf8Write(H,t):B.write(H,t)}BufferWriter.prototype.string=function H(B){var t=util$3.Buffer.byteLength(B);return this.uint32(t),t&&this._push(writeStringBuffer,t,B),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(H,B){return RangeError("index out of range: "+H.pos+" + "+(B||1)+" > "+H.len)}function Reader$1(H){this.buf=H,this.pos=0,this.len=H.length}var create_array=typeof Uint8Array<"u"?function H(B){if(B instanceof Uint8Array||Array.isArray(B))return new Reader$1(B);throw Error("illegal buffer")}:function H(B){if(Array.isArray(B))return new Reader$1(B);throw Error("illegal buffer")},create=function H(){return util$2.Buffer?function(t){return(Reader$1.create=function(N){return util$2.Buffer.isBuffer(N)?new BufferReader$1(N):create_array(N)})(t)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function H(){var B=4294967295;return function(){if(B=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(B=(B|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(B=(B|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(B=(B|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(B=(B|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return B;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return B}}();Reader$1.prototype.int32=function H(){return this.uint32()|0};Reader$1.prototype.sint32=function H(){var B=this.uint32();return B>>>1^-(B&1)|0};function readLongVarint(){var H=new LongBits(0,0),B=0;if(this.len-this.pos>4){for(;B<4;++B)if(H.lo=(H.lo|(this.buf[this.pos]&127)<<B*7)>>>0,this.buf[this.pos++]<128)return H;if(H.lo=(H.lo|(this.buf[this.pos]&127)<<28)>>>0,H.hi=(H.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return H;B=0}else{for(;B<3;++B){if(this.pos>=this.len)throw indexOutOfRange(this);if(H.lo=(H.lo|(this.buf[this.pos]&127)<<B*7)>>>0,this.buf[this.pos++]<128)return H}return H.lo=(H.lo|(this.buf[this.pos++]&127)<<B*7)>>>0,H}if(this.len-this.pos>4){for(;B<5;++B)if(H.hi=(H.hi|(this.buf[this.pos]&127)<<B*7+3)>>>0,this.buf[this.pos++]<128)return H}else for(;B<5;++B){if(this.pos>=this.len)throw indexOutOfRange(this);if(H.hi=(H.hi|(this.buf[this.pos]&127)<<B*7+3)>>>0,this.buf[this.pos++]<128)return H}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function H(){return this.uint32()!==0};function readFixed32_end(H,B){return(H[B-4]|H[B-3]<<8|H[B-2]<<16|H[B-1]<<24)>>>0}Reader$1.prototype.fixed32=function H(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function H(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function H(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var B=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,B};Reader$1.prototype.double=function H(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var B=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,B};Reader$1.prototype.bytes=function H(){var B=this.uint32(),t=this.pos,V=this.pos+B;if(V>this.len)throw indexOutOfRange(this,B);if(this.pos+=B,Array.isArray(this.buf))return this.buf.slice(t,V);if(t===V){var N=util$2.Buffer;return N?N.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,V)};Reader$1.prototype.string=function H(){var B=this.bytes();return utf8.read(B,0,B.length)};Reader$1.prototype.skip=function H(B){if(typeof B=="number"){if(this.pos+B>this.len)throw indexOutOfRange(this,B);this.pos+=B}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(H){switch(H){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(H=this.uint32()&7)!==4;)this.skipType(H);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+H+" at offset "+this.pos)}return this};Reader$1._configure=function(H){BufferReader$1=H,Reader$1.create=create(),BufferReader$1._configure();var B=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[B](!1)},uint64:function(){return readLongVarint.call(this)[B](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[B](!1)},fixed64:function(){return readFixed64.call(this)[B](!0)},sfixed64:function(){return readFixed64.call(this)[B](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(H){Reader.call(this,H)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function H(){var B=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+B,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+B,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(H,B,t){if(typeof H!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=H,this.requestDelimited=!!B,this.responseDelimited=!!t}Service.prototype.rpcCall=function H(B,t,V,N,W){if(!N)throw TypeError("request must be specified");var K=this;if(!W)return util.asPromise(H,K,B,t,V,N);if(!K.rpcImpl){setTimeout(function(){W(Error("already ended"))},0);return}try{return K.rpcImpl(B,t[K.requestDelimited?"encodeDelimited":"encode"](N).finish(),function(Z,Y){if(Z)return K.emit("error",Z,B),W(Z);if(Y===null){K.end(!0);return}if(!(Y instanceof V))try{Y=V[K.responseDelimited?"decodeDelimited":"decode"](Y)}catch(X){return K.emit("error",X,B),W(X)}return K.emit("data",Y,B),W(null,Y)})}catch(G){K.emit("error",G,B),setTimeout(function(){W(G)},0);return}};Service.prototype.end=function H(B){return this.rpcImpl&&(B||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(H){var B=H;B.Service=service})(rpc);var roots={};(function(H){var B=H;B.build="minimal",B.Writer=writer,B.BufferWriter=writer_buffer,B.Reader=reader,B.BufferReader=reader_buffer,B.util=requireMinimal(),B.rpc=rpc,B.roots=roots,B.configure=t;function t(){B.util._configure(),B.Writer._configure(B.BufferWriter),B.Reader._configure(B.BufferReader)}t()})(indexMinimal);const PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0";PACKET_TYPES.close="1";PACKET_TYPES.ping="2";PACKET_TYPES.pong="3";PACKET_TYPES.message="4";PACKET_TYPES.upgrade="5";PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(H=>{PACKET_TYPES_REVERSE[PACKET_TYPES[H]]=H});const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",withNativeArrayBuffer$2=typeof ArrayBuffer=="function",isView$1=H=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(H):H&&H.buffer instanceof ArrayBuffer,encodePacket=({type:H,data:B},t,V)=>withNativeBlob$1&&B instanceof Blob?t?V(B):encodeBlobAsBase64(B,V):withNativeArrayBuffer$2&&(B instanceof ArrayBuffer||isView$1(B))?t?V(B):encodeBlobAsBase64(new Blob([B]),V):V(PACKET_TYPES[H]+(B||"")),encodeBlobAsBase64=(H,B)=>{const t=new FileReader;return t.onload=function(){const V=t.result.split(",")[1];B("b"+(V||""))},t.readAsDataURL(H)};function toArray(H){return H instanceof Uint8Array?H:H instanceof ArrayBuffer?new Uint8Array(H):new Uint8Array(H.buffer,H.byteOffset,H.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(H,B){if(withNativeBlob$1&&H.data instanceof Blob)return H.data.arrayBuffer().then(toArray).then(B);if(withNativeArrayBuffer$2&&(H.data instanceof ArrayBuffer||isView$1(H.data)))return B(toArray(H.data));encodePacket(H,!1,t=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),B(TEXT_ENCODER.encode(t))})}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let H=0;H<chars.length;H++)lookup$1[chars.charCodeAt(H)]=H;const decode$2=H=>{let B=H.length*.75,t=H.length,V,N=0,W,K,G,Z;H[H.length-1]==="="&&(B--,H[H.length-2]==="="&&B--);const Y=new ArrayBuffer(B),X=new Uint8Array(Y);for(V=0;V<t;V+=4)W=lookup$1[H.charCodeAt(V)],K=lookup$1[H.charCodeAt(V+1)],G=lookup$1[H.charCodeAt(V+2)],Z=lookup$1[H.charCodeAt(V+3)],X[N++]=W<<2|K>>4,X[N++]=(K&15)<<4|G>>2,X[N++]=(G&3)<<6|Z&63;return Y},withNativeArrayBuffer$1=typeof ArrayBuffer=="function",decodePacket=(H,B)=>{if(typeof H!="string")return{type:"message",data:mapBinary(H,B)};const t=H.charAt(0);return t==="b"?{type:"message",data:decodeBase64Packet(H.substring(1),B)}:PACKET_TYPES_REVERSE[t]?H.length>1?{type:PACKET_TYPES_REVERSE[t],data:H.substring(1)}:{type:PACKET_TYPES_REVERSE[t]}:ERROR_PACKET},decodeBase64Packet=(H,B)=>{if(withNativeArrayBuffer$1){const t=decode$2(H);return mapBinary(t,B)}else return{base64:!0,data:H}},mapBinary=(H,B)=>{switch(B){case"blob":return H instanceof Blob?H:new Blob([H]);case"arraybuffer":default:return H instanceof ArrayBuffer?H:H.buffer}},SEPARATOR="",encodePayload=(H,B)=>{const t=H.length,V=new Array(t);let N=0;H.forEach((W,K)=>{encodePacket(W,!1,G=>{V[K]=G,++N===t&&B(V.join(SEPARATOR))})})},decodePayload=(H,B)=>{const t=H.split(SEPARATOR),V=[];for(let N=0;N<t.length;N++){const W=decodePacket(t[N],B);if(V.push(W),W.type==="error")break}return V};function createPacketEncoderStream(){return new TransformStream({transform(H,B){encodePacketToBinary(H,t=>{const V=t.length;let N;if(V<126)N=new Uint8Array(1),new DataView(N.buffer).setUint8(0,V);else if(V<65536){N=new Uint8Array(3);const W=new DataView(N.buffer);W.setUint8(0,126),W.setUint16(1,V)}else{N=new Uint8Array(9);const W=new DataView(N.buffer);W.setUint8(0,127),W.setBigUint64(1,BigInt(V))}H.data&&typeof H.data!="string"&&(N[0]|=128),B.enqueue(N),B.enqueue(t)})}})}let TEXT_DECODER;function totalLength(H){return H.reduce((B,t)=>B+t.length,0)}function concatChunks(H,B){if(H[0].length===B)return H.shift();const t=new Uint8Array(B);let V=0;for(let N=0;N<B;N++)t[N]=H[0][V++],V===H[0].length&&(H.shift(),V=0);return H.length&&V<H[0].length&&(H[0]=H[0].slice(V)),t}function createPacketDecoderStream(H,B){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const t=[];let V=0,N=-1,W=!1;return new TransformStream({transform(K,G){for(t.push(K);;){if(V===0){if(totalLength(t)<1)break;const Z=concatChunks(t,1);W=(Z[0]&128)===128,N=Z[0]&127,N<126?V=3:N===126?V=1:V=2}else if(V===1){if(totalLength(t)<2)break;const Z=concatChunks(t,2);N=new DataView(Z.buffer,Z.byteOffset,Z.length).getUint16(0),V=3}else if(V===2){if(totalLength(t)<8)break;const Z=concatChunks(t,8),Y=new DataView(Z.buffer,Z.byteOffset,Z.length),X=Y.getUint32(0);if(X>Math.pow(2,21)-1){G.enqueue(ERROR_PACKET);break}N=X*Math.pow(2,32)+Y.getUint32(4),V=3}else{if(totalLength(t)<N)break;const Z=concatChunks(t,N);G.enqueue(decodePacket(W?Z:TEXT_DECODER.decode(Z),B)),V=0}if(N===0||N>H){G.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(H){if(H)return mixin(H)}function mixin(H){for(var B in Emitter.prototype)H[B]=Emitter.prototype[B];return H}Emitter.prototype.on=Emitter.prototype.addEventListener=function(H,B){return this._callbacks=this._callbacks||{},(this._callbacks["$"+H]=this._callbacks["$"+H]||[]).push(B),this};Emitter.prototype.once=function(H,B){function t(){this.off(H,t),B.apply(this,arguments)}return t.fn=B,this.on(H,t),this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(H,B){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+H];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+H],this;for(var V,N=0;N<t.length;N++)if(V=t[N],V===B||V.fn===B){t.splice(N,1);break}return t.length===0&&delete this._callbacks["$"+H],this};Emitter.prototype.emit=function(H){this._callbacks=this._callbacks||{};for(var B=new Array(arguments.length-1),t=this._callbacks["$"+H],V=1;V<arguments.length;V++)B[V-1]=arguments[V];if(t){t=t.slice(0);for(var V=0,N=t.length;V<N;++V)t[V].apply(this,B)}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(H){return this._callbacks=this._callbacks||{},this._callbacks["$"+H]||[]};Emitter.prototype.hasListeners=function(H){return!!this.listeners(H).length};const globalThisShim=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function pick(H,...B){return B.reduce((t,V)=>(H.hasOwnProperty(V)&&(t[V]=H[V]),t),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(H,B){B.useNativeTimers?(H.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),H.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(H.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),H.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(H){return typeof H=="string"?utf8Length(H):Math.ceil((H.byteLength||H.size)*BASE64_OVERHEAD)}function utf8Length(H){let B=0,t=0;for(let V=0,N=H.length;V<N;V++)B=H.charCodeAt(V),B<128?t+=1:B<2048?t+=2:B<55296||B>=57344?t+=3:(V++,t+=4);return t}function encode$2(H){let B="";for(let t in H)H.hasOwnProperty(t)&&(B.length&&(B+="&"),B+=encodeURIComponent(t)+"="+encodeURIComponent(H[t]));return B}function decode$1(H){let B={},t=H.split("&");for(let V=0,N=t.length;V<N;V++){let W=t[V].split("=");B[decodeURIComponent(W[0])]=decodeURIComponent(W[1])}return B}class TransportError extends Error{constructor(B,t,V){super(B),this.description=t,this.context=V,this.type="TransportError"}}class Transport extends Emitter{constructor(B){super(),this.writable=!1,installTimerFunctions(this,B),this.opts=B,this.query=B.query,this.socket=B.socket}onError(B,t,V){return super.emitReserved("error",new TransportError(B,t,V)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(B){this.readyState==="open"&&this.write(B)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(B){const t=decodePacket(B,this.socket.binaryType);this.onPacket(t)}onPacket(B){super.emitReserved("packet",B)}onClose(B){this.readyState="closed",super.emitReserved("close",B)}pause(B){}createUri(B,t={}){return B+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const B=this.opts.hostname;return B.indexOf(":")===-1?B:"["+B+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(B){const t=encode$2(B);return t.length?"?"+t:""}}const alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={};let seed=0,i$1=0,prev;function encode$1(H){let B="";do B=alphabet[H%length]+B,H=Math.floor(H/length);while(H>0);return B}function yeast(){const H=encode$1(+new Date);return H!==prev?(seed=0,prev=H):H+"."+encode$1(seed++)}for(;i$1<length;i$1++)map[alphabet[i$1]]=i$1;let value=!1;try{value=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch(H){}const hasCORS=value;function XHR(H){const B=H.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!B||hasCORS))return new XMLHttpRequest}catch{}if(!B)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function createCookieJar(){}function empty(){}const hasXHR2=function(){return new XHR({xdomain:!1}).responseType!=null}();class Polling extends Transport{constructor(B){if(super(B),this.polling=!1,typeof location<"u"){const V=location.protocol==="https:";let N=location.port;N||(N=V?"443":"80"),this.xd=typeof location<"u"&&B.hostname!==location.hostname||N!==B.port}const t=B&&B.forceBase64;this.supportsBinary=hasXHR2&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(B){this.readyState="pausing";const t=()=>{this.readyState="paused",B()};if(this.polling||!this.writable){let V=0;this.polling&&(V++,this.once("pollComplete",function(){--V||t()})),this.writable||(V++,this.once("drain",function(){--V||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(B){const t=V=>{if(this.readyState==="opening"&&V.type==="open"&&this.onOpen(),V.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(V)};decodePayload(B,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const B=()=>{this.write([{type:"close"}])};this.readyState==="open"?B():this.once("open",B)}write(B){this.writable=!1,encodePayload(B,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const B=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=yeast()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(B,t)}request(B={}){return Object.assign(B,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request(this.uri(),B)}doWrite(B,t){const V=this.request({method:"POST",data:B});V.on("success",t),V.on("error",(N,W)=>{this.onError("xhr post error",N,W)})}doPoll(){const B=this.request();B.on("data",this.onData.bind(this)),B.on("error",(t,V)=>{this.onError("xhr poll error",t,V)}),this.pollXhr=B}}class Request extends Emitter{constructor(B,t){super(),installTimerFunctions(this,t),this.opts=t,this.method=t.method||"GET",this.uri=B,this.data=t.data!==void 0?t.data:null,this.create()}create(){var B;const t=pick(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const V=this.xhr=new XHR(t);try{V.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){V.setDisableHeaderCheck&&V.setDisableHeaderCheck(!0);for(let N in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(N)&&V.setRequestHeader(N,this.opts.extraHeaders[N])}}catch{}if(this.method==="POST")try{V.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{V.setRequestHeader("Accept","*/*")}catch{}(B=this.opts.cookieJar)===null||B===void 0||B.addCookies(V),"withCredentials"in V&&(V.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(V.timeout=this.opts.requestTimeout),V.onreadystatechange=()=>{var N;V.readyState===3&&((N=this.opts.cookieJar)===null||N===void 0||N.parseCookies(V)),V.readyState===4&&(V.status===200||V.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof V.status=="number"?V.status:0)},0))},V.send(this.data)}catch(N){this.setTimeoutFn(()=>{this.onError(N)},0);return}typeof document<"u"&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}onError(B){this.emitReserved("error",B,this.xhr),this.cleanup(!0)}cleanup(B){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=empty,B)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Request.requests[this.index],this.xhr=null}}onLoad(){const B=this.xhr.responseText;B!==null&&(this.emitReserved("data",B),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Request.requestsCount=0;Request.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",unloadHandler);else if(typeof addEventListener=="function"){const H="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(H,unloadHandler,!1)}}function unloadHandler(){for(let H in Request.requests)Request.requests.hasOwnProperty(H)&&Request.requests[H].abort()}const nextTick=typeof Promise=="function"&&typeof Promise.resolve=="function"?B=>Promise.resolve().then(B):(B,t)=>t(B,0),WebSocket=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class WS extends Transport{constructor(B){super(B),this.supportsBinary=!B.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const B=this.uri(),t=this.opts.protocols,V=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(V.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?t?new WebSocket(B,t):new WebSocket(B):new WebSocket(B,t,V)}catch(N){return this.emitReserved("error",N)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=B=>this.onClose({description:"websocket connection closed",context:B}),this.ws.onmessage=B=>this.onData(B.data),this.ws.onerror=B=>this.onError("websocket error",B)}write(B){this.writable=!1;for(let t=0;t<B.length;t++){const V=B[t],N=t===B.length-1;encodePacket(V,this.supportsBinary,W=>{const K={};try{usingBrowserWebSocket&&this.ws.send(W)}catch{}N&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const B=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=yeast()),this.supportsBinary||(t.b64=1),this.createUri(B,t)}check(){return!!WebSocket}}class WT extends Transport{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(B=>{this.onError("webtransport error",B)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(B=>{const t=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),V=B.readable.pipeThrough(t).getReader(),N=createPacketEncoderStream();N.readable.pipeTo(B.writable),this.writer=N.writable.getWriter();const W=()=>{V.read().then(({done:G,value:Z})=>{G||(this.onPacket(Z),W())}).catch(G=>{})};W();const K={type:"open"};this.query.sid&&(K.data=`{"sid":"${this.query.sid}"}`),this.writer.write(K).then(()=>this.onOpen())})}))}write(B){this.writable=!1;for(let t=0;t<B.length;t++){const V=B[t],N=t===B.length-1;this.writer.write(V).then(()=>{N&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var B;(B=this.transport)===null||B===void 0||B.close()}}const transports={websocket:WS,webtransport:WT,polling:Polling},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(H){if(H.length>2e3)throw"URI too long";const B=H,t=H.indexOf("["),V=H.indexOf("]");t!=-1&&V!=-1&&(H=H.substring(0,t)+H.substring(t,V).replace(/:/g,";")+H.substring(V,H.length));let N=re.exec(H||""),W={},K=14;for(;K--;)W[parts[K]]=N[K]||"";return t!=-1&&V!=-1&&(W.source=B,W.host=W.host.substring(1,W.host.length-1).replace(/;/g,":"),W.authority=W.authority.replace("[","").replace("]","").replace(/;/g,":"),W.ipv6uri=!0),W.pathNames=pathNames(W,W.path),W.queryKey=queryKey(W,W.query),W}function pathNames(H,B){const t=/\/{2,9}/g,V=B.replace(t,"/").split("/");return(B.slice(0,1)=="/"||B.length===0)&&V.splice(0,1),B.slice(-1)=="/"&&V.splice(V.length-1,1),V}function queryKey(H,B){const t={};return B.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(V,N,W){N&&(t[N]=W)}),t}let Socket$1=class it extends Emitter{constructor(B,t={}){super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],B&&typeof B=="object"&&(t=B,B=null),B?(B=parse(B),t.hostname=B.host,t.secure=B.protocol==="https"||B.protocol==="wss",t.port=B.port,B.query&&(t.query=B.query)):t.host&&(t.hostname=parse(t.host).host),installTimerFunctions(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=decode$1(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(B){const t=Object.assign({},this.opts.query);t.EIO=protocol$1,t.transport=B,this.id&&(t.sid=this.id);const V=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[B]);return new transports[B](V)}open(){let B;if(this.opts.rememberUpgrade&&it.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)B="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else B=this.transports[0];this.readyState="opening";try{B=this.createTransport(B)}catch{this.transports.shift(),this.open();return}B.open(),this.setTransport(B)}setTransport(B){this.transport&&this.transport.removeAllListeners(),this.transport=B,B.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(B){let t=this.createTransport(B),V=!1;it.priorWebsocketSuccess=!1;const N=()=>{V||(t.send([{type:"ping",data:"probe"}]),t.once("packet",Q=>{if(!V)if(Q.type==="pong"&&Q.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;it.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{V||this.readyState!=="closed"&&(X(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const te=new Error("probe error");te.transport=t.name,this.emitReserved("upgradeError",te)}}))};function W(){V||(V=!0,X(),t.close(),t=null)}const K=Q=>{const te=new Error("probe error: "+Q);te.transport=t.name,W(),this.emitReserved("upgradeError",te)};function G(){K("transport closed")}function Z(){K("socket closed")}function Y(Q){t&&Q.name!==t.name&&W()}const X=()=>{t.removeListener("open",N),t.removeListener("error",K),t.removeListener("close",G),this.off("close",Z),this.off("upgrading",Y)};t.once("open",N),t.once("error",K),t.once("close",G),this.once("close",Z),this.once("upgrading",Y),this.upgrades.indexOf("webtransport")!==-1&&B!=="webtransport"?this.setTimeoutFn(()=>{V||t.open()},200):t.open()}onOpen(){if(this.readyState="open",it.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let B=0;const t=this.upgrades.length;for(;B<t;B++)this.probe(this.upgrades[B])}}onPacket(B){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",B),this.emitReserved("heartbeat"),this.resetPingTimeout(),B.type){case"open":this.onHandshake(JSON.parse(B.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=B.data,this.onError(t);break;case"message":this.emitReserved("data",B.data),this.emitReserved("message",B.data);break}}onHandshake(B){this.emitReserved("handshake",B),this.id=B.sid,this.transport.query.sid=B.sid,this.upgrades=this.filterUpgrades(B.upgrades),this.pingInterval=B.pingInterval,this.pingTimeout=B.pingTimeout,this.maxPayload=B.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const B=this.getWritablePackets();this.transport.send(B),this.prevBufferLen=B.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let V=0;V<this.writeBuffer.length;V++){const N=this.writeBuffer[V].data;if(N&&(t+=byteLength(N)),V>0&&t>this.maxPayload)return this.writeBuffer.slice(0,V);t+=2}return this.writeBuffer}write(B,t,V){return this.sendPacket("message",B,t,V),this}send(B,t,V){return this.sendPacket("message",B,t,V),this}sendPacket(B,t,V,N){if(typeof t=="function"&&(N=t,t=void 0),typeof V=="function"&&(N=V,V=null),this.readyState==="closing"||this.readyState==="closed")return;V=V||{},V.compress=V.compress!==!1;const W={type:B,data:t,options:V};this.emitReserved("packetCreate",W),this.writeBuffer.push(W),N&&this.once("flush",N),this.flush()}close(){const B=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),B()},V=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?V():B()}):this.upgrading?V():B()),this}onError(B){it.priorWebsocketSuccess=!1,this.emitReserved("error",B),this.onClose("transport error",B)}onClose(B,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",B,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(B){const t=[];let V=0;const N=B.length;for(;V<N;V++)~this.transports.indexOf(B[V])&&t.push(B[V]);return t}};Socket$1.protocol=protocol$1;function url(H,B="",t){let V=H;t=t||typeof location<"u"&&location,H==null&&(H=t.protocol+"//"+t.host),typeof H=="string"&&(H.charAt(0)==="/"&&(H.charAt(1)==="/"?H=t.protocol+H:H=t.host+H),/^(https?|wss?):\/\//.test(H)||(typeof t<"u"?H=t.protocol+"//"+H:H="https://"+H),V=parse(H)),V.port||(/^(http|ws)$/.test(V.protocol)?V.port="80":/^(http|ws)s$/.test(V.protocol)&&(V.port="443")),V.path=V.path||"/";const W=V.host.indexOf(":")!==-1?"["+V.host+"]":V.host;return V.id=V.protocol+"://"+W+":"+V.port+B,V.href=V.protocol+"://"+W+(t&&t.port===V.port?"":":"+V.port),V}const withNativeArrayBuffer=typeof ArrayBuffer=="function",isView=H=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(H):H.buffer instanceof ArrayBuffer,toString$1=Object.prototype.toString,withNativeBlob=typeof Blob=="function"||typeof Blob<"u"&&toString$1.call(Blob)==="[object BlobConstructor]",withNativeFile=typeof File=="function"||typeof File<"u"&&toString$1.call(File)==="[object FileConstructor]";function isBinary(H){return withNativeArrayBuffer&&(H instanceof ArrayBuffer||isView(H))||withNativeBlob&&H instanceof Blob||withNativeFile&&H instanceof File}function hasBinary(H,B){if(!H||typeof H!="object")return!1;if(Array.isArray(H)){for(let t=0,V=H.length;t<V;t++)if(hasBinary(H[t]))return!0;return!1}if(isBinary(H))return!0;if(H.toJSON&&typeof H.toJSON=="function"&&arguments.length===1)return hasBinary(H.toJSON(),!0);for(const t in H)if(Object.prototype.hasOwnProperty.call(H,t)&&hasBinary(H[t]))return!0;return!1}function deconstructPacket(H){const B=[],t=H.data,V=H;return V.data=_deconstructPacket(t,B),V.attachments=B.length,{packet:V,buffers:B}}function _deconstructPacket(H,B){if(!H)return H;if(isBinary(H)){const t={_placeholder:!0,num:B.length};return B.push(H),t}else if(Array.isArray(H)){const t=new Array(H.length);for(let V=0;V<H.length;V++)t[V]=_deconstructPacket(H[V],B);return t}else if(typeof H=="object"&&!(H instanceof Date)){const t={};for(const V in H)Object.prototype.hasOwnProperty.call(H,V)&&(t[V]=_deconstructPacket(H[V],B));return t}return H}function reconstructPacket(H,B){return H.data=_reconstructPacket(H.data,B),delete H.attachments,H}function _reconstructPacket(H,B){if(!H)return H;if(H&&H._placeholder===!0){if(typeof H.num=="number"&&H.num>=0&&H.num<B.length)return B[H.num];throw new Error("illegal attachments")}else if(Array.isArray(H))for(let t=0;t<H.length;t++)H[t]=_reconstructPacket(H[t],B);else if(typeof H=="object")for(const t in H)Object.prototype.hasOwnProperty.call(H,t)&&(H[t]=_reconstructPacket(H[t],B));return H}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;(function(H){H[H.CONNECT=0]="CONNECT",H[H.DISCONNECT=1]="DISCONNECT",H[H.EVENT=2]="EVENT",H[H.ACK=3]="ACK",H[H.CONNECT_ERROR=4]="CONNECT_ERROR",H[H.BINARY_EVENT=5]="BINARY_EVENT",H[H.BINARY_ACK=6]="BINARY_ACK"})(PacketType||(PacketType={}));let Encoder$1=class{constructor(B){this.replacer=B}encode(B){return(B.type===PacketType.EVENT||B.type===PacketType.ACK)&&hasBinary(B)?this.encodeAsBinary({type:B.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:B.nsp,data:B.data,id:B.id}):[this.encodeAsString(B)]}encodeAsString(B){let t=""+B.type;return(B.type===PacketType.BINARY_EVENT||B.type===PacketType.BINARY_ACK)&&(t+=B.attachments+"-"),B.nsp&&B.nsp!=="/"&&(t+=B.nsp+","),B.id!=null&&(t+=B.id),B.data!=null&&(t+=JSON.stringify(B.data,this.replacer)),t}encodeAsBinary(B){const t=deconstructPacket(B),V=this.encodeAsString(t.packet),N=t.buffers;return N.unshift(V),N}};function isObject(H){return Object.prototype.toString.call(H)==="[object Object]"}let Decoder$1=class ut extends Emitter{constructor(B){super(),this.reviver=B}add(B){let t;if(typeof B=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(B);const V=t.type===PacketType.BINARY_EVENT;V||t.type===PacketType.BINARY_ACK?(t.type=V?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(isBinary(B)||B.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(B),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+B)}decodeString(B){let t=0;const V={type:Number(B.charAt(0))};if(PacketType[V.type]===void 0)throw new Error("unknown packet type "+V.type);if(V.type===PacketType.BINARY_EVENT||V.type===PacketType.BINARY_ACK){const W=t+1;for(;B.charAt(++t)!=="-"&&t!=B.length;);const K=B.substring(W,t);if(K!=Number(K)||B.charAt(t)!=="-")throw new Error("Illegal attachments");V.attachments=Number(K)}if(B.charAt(t+1)==="/"){const W=t+1;for(;++t&&!(B.charAt(t)===","||t===B.length););V.nsp=B.substring(W,t)}else V.nsp="/";const N=B.charAt(t+1);if(N!==""&&Number(N)==N){const W=t+1;for(;++t;){const K=B.charAt(t);if(K==null||Number(K)!=K){--t;break}if(t===B.length)break}V.id=Number(B.substring(W,t+1))}if(B.charAt(++t)){const W=this.tryParse(B.substr(t));if(ut.isPayloadValid(V.type,W))V.data=W;else throw new Error("invalid payload")}return V}tryParse(B){try{return JSON.parse(B,this.reviver)}catch{return!1}}static isPayloadValid(B,t){switch(B){case PacketType.CONNECT:return isObject(t);case PacketType.DISCONNECT:return t===void 0;case PacketType.CONNECT_ERROR:return typeof t=="string"||isObject(t);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&RESERVED_EVENTS$1.indexOf(t[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}};class BinaryReconstructor{constructor(B){this.packet=B,this.buffers=[],this.reconPack=B}takeBinaryData(B){if(this.buffers.push(B),this.buffers.length===this.reconPack.attachments){const t=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const parser=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Decoder$1,Encoder:Encoder$1,get PacketType(){return PacketType},protocol},Symbol.toStringTag,{value:"Module"}));function on(H,B,t){return H.on(B,t),function(){H.off(B,t)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(B,t,V){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=B,this.nsp=t,V&&V.auth&&(this.auth=V.auth),this._opts=Object.assign({},V),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const B=this.io;this.subs=[on(B,"open",this.onopen.bind(this)),on(B,"packet",this.onpacket.bind(this)),on(B,"error",this.onerror.bind(this)),on(B,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...B){return B.unshift("message"),this.emit.apply(this,B),this}emit(B,...t){if(RESERVED_EVENTS.hasOwnProperty(B))throw new Error('"'+B.toString()+'" is a reserved event name');if(t.unshift(B),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const V={type:PacketType.EVENT,data:t};if(V.options={},V.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const K=this.ids++,G=t.pop();this._registerAckCallback(K,G),V.id=K}const N=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!N||!this.connected)||(this.connected?(this.notifyOutgoingListeners(V),this.packet(V)):this.sendBuffer.push(V)),this.flags={},this}_registerAckCallback(B,t){var V;const N=(V=this.flags.timeout)!==null&&V!==void 0?V:this._opts.ackTimeout;if(N===void 0){this.acks[B]=t;return}const W=this.io.setTimeoutFn(()=>{delete this.acks[B];for(let K=0;K<this.sendBuffer.length;K++)this.sendBuffer[K].id===B&&this.sendBuffer.splice(K,1);t.call(this,new Error("operation has timed out"))},N);this.acks[B]=(...K)=>{this.io.clearTimeoutFn(W),t.apply(this,[null,...K])}}emitWithAck(B,...t){const V=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((N,W)=>{t.push((K,G)=>V?K?W(K):N(G):N(K)),this.emit(B,...t)})}_addToQueue(B){let t;typeof B[B.length-1]=="function"&&(t=B.pop());const V={id:this._queueSeq++,tryCount:0,pending:!1,args:B,flags:Object.assign({fromQueue:!0},this.flags)};B.push((N,...W)=>V!==this._queue[0]?void 0:(N!==null?V.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(N)):(this._queue.shift(),t&&t(null,...W)),V.pending=!1,this._drainQueue())),this._queue.push(V),this._drainQueue()}_drainQueue(B=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!B||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(B){B.nsp=this.nsp,this.io._packet(B)}onopen(){typeof this.auth=="function"?this.auth(B=>{this._sendConnectPacket(B)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(B){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},B):B})}onerror(B){this.connected||this.emitReserved("connect_error",B)}onclose(B,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",B,t)}onpacket(B){if(B.nsp===this.nsp)switch(B.type){case PacketType.CONNECT:B.data&&B.data.sid?this.onconnect(B.data.sid,B.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(B);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(B);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const V=new Error(B.data.message);V.data=B.data.data,this.emitReserved("connect_error",V);break}}onevent(B){const t=B.data||[];B.id!=null&&t.push(this.ack(B.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(B){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const V of t)V.apply(this,B)}super.emit.apply(this,B),this._pid&&B.length&&typeof B[B.length-1]=="string"&&(this._lastOffset=B[B.length-1])}ack(B){const t=this;let V=!1;return function(...N){V||(V=!0,t.packet({type:PacketType.ACK,id:B,data:N}))}}onack(B){const t=this.acks[B.id];typeof t=="function"&&(t.apply(this,B.data),delete this.acks[B.id])}onconnect(B,t){this.id=B,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(B=>this.emitEvent(B)),this.receiveBuffer=[],this.sendBuffer.forEach(B=>{this.notifyOutgoingListeners(B),this.packet(B)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(B=>B()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(B){return this.flags.compress=B,this}get volatile(){return this.flags.volatile=!0,this}timeout(B){return this.flags.timeout=B,this}onAny(B){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(B),this}prependAny(B){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(B),this}offAny(B){if(!this._anyListeners)return this;if(B){const t=this._anyListeners;for(let V=0;V<t.length;V++)if(B===t[V])return t.splice(V,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(B){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(B),this}prependAnyOutgoing(B){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(B),this}offAnyOutgoing(B){if(!this._anyOutgoingListeners)return this;if(B){const t=this._anyOutgoingListeners;for(let V=0;V<t.length;V++)if(B===t[V])return t.splice(V,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(B){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const V of t)V.apply(this,B.data)}}}function Backoff(H){H=H||{},this.ms=H.min||100,this.max=H.max||1e4,this.factor=H.factor||2,this.jitter=H.jitter>0&&H.jitter<=1?H.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var H=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var B=Math.random(),t=Math.floor(B*this.jitter*H);H=Math.floor(B*10)&1?H+t:H-t}return Math.min(H,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(H){this.ms=H};Backoff.prototype.setMax=function(H){this.max=H};Backoff.prototype.setJitter=function(H){this.jitter=H};class Manager extends Emitter{constructor(B,t){var V;super(),this.nsps={},this.subs=[],B&&typeof B=="object"&&(t=B,B=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,installTimerFunctions(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((V=t.randomizationFactor)!==null&&V!==void 0?V:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=B;const N=t.parser||parser;this.encoder=new N.Encoder,this.decoder=new N.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(B){return arguments.length?(this._reconnection=!!B,this):this._reconnection}reconnectionAttempts(B){return B===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=B,this)}reconnectionDelay(B){var t;return B===void 0?this._reconnectionDelay:(this._reconnectionDelay=B,(t=this.backoff)===null||t===void 0||t.setMin(B),this)}randomizationFactor(B){var t;return B===void 0?this._randomizationFactor:(this._randomizationFactor=B,(t=this.backoff)===null||t===void 0||t.setJitter(B),this)}reconnectionDelayMax(B){var t;return B===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=B,(t=this.backoff)===null||t===void 0||t.setMax(B),this)}timeout(B){return arguments.length?(this._timeout=B,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(B){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const t=this.engine,V=this;this._readyState="opening",this.skipReconnect=!1;const N=on(t,"open",function(){V.onopen(),B&&B()}),W=G=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",G),B?B(G):this.maybeReconnectOnOpen()},K=on(t,"error",W);if(this._timeout!==!1){const G=this._timeout,Z=this.setTimeoutFn(()=>{N(),W(new Error("timeout")),t.close()},G);this.opts.autoUnref&&Z.unref(),this.subs.push(()=>{this.clearTimeoutFn(Z)})}return this.subs.push(N),this.subs.push(K),this}connect(B){return this.open(B)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const B=this.engine;this.subs.push(on(B,"ping",this.onping.bind(this)),on(B,"data",this.ondata.bind(this)),on(B,"error",this.onerror.bind(this)),on(B,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(B){try{this.decoder.add(B)}catch(t){this.onclose("parse error",t)}}ondecoded(B){nextTick(()=>{this.emitReserved("packet",B)},this.setTimeoutFn)}onerror(B){this.emitReserved("error",B)}socket(B,t){let V=this.nsps[B];return V?this._autoConnect&&!V.active&&V.connect():(V=new Socket(this,B,t),this.nsps[B]=V),V}_destroy(B){const t=Object.keys(this.nsps);for(const V of t)if(this.nsps[V].active)return;this._close()}_packet(B){const t=this.encoder.encode(B);for(let V=0;V<t.length;V++)this.engine.write(t[V],B.options)}cleanup(){this.subs.forEach(B=>B()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(B,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",B,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const B=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const V=this.setTimeoutFn(()=>{B.skipReconnect||(this.emitReserved("reconnect_attempt",B.backoff.attempts),!B.skipReconnect&&B.open(N=>{N?(B._reconnecting=!1,B.reconnect(),this.emitReserved("reconnect_error",N)):B.onreconnect()}))},t);this.opts.autoUnref&&V.unref(),this.subs.push(()=>{this.clearTimeoutFn(V)})}}onreconnect(){const B=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",B)}}const cache={};function lookup(H,B){typeof H=="object"&&(B=H,H=void 0),B=B||{};const t=url(H,B.path||"/socket.io"),V=t.source,N=t.id,W=t.path,K=cache[N]&&W in cache[N].nsps,G=B.forceNew||B["force new connection"]||B.multiplex===!1||K;let Z;return G?Z=new Manager(V,B):(cache[N]||(cache[N]=new Manager(V,B)),Z=cache[N]),t.query&&!B.query&&(B.query=t.queryKey),Z.socket(t.path,B)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});var requiresPort=function H(B,t){if(t=t.split(":")[0],B=+B,!B)return!1;switch(t){case"http":case"ws":return B!==80;case"https":case"wss":return B!==443;case"ftp":return B!==21;case"gopher":return B!==70;case"file":return!1}return B!==0},querystringify$1={},has=Object.prototype.hasOwnProperty,undef;function decode(H){try{return decodeURIComponent(H.replace(/\+/g," "))}catch{return null}}function encode(H){try{return encodeURIComponent(H)}catch{return null}}function querystring(H){for(var B=/([^=?#&]+)=?([^&]*)/g,t={},V;V=B.exec(H);){var N=decode(V[1]),W=decode(V[2]);N===null||W===null||N in t||(t[N]=W)}return t}function querystringify(H,B){B=B||"";var t=[],V,N;typeof B!="string"&&(B="?");for(N in H)if(has.call(H,N)){if(V=H[N],!V&&(V===null||V===undef||isNaN(V))&&(V=""),N=encode(N),V=encode(V),N===null||V===null)continue;t.push(N+"="+V)}return t.length?B+t.join("&"):""}querystringify$1.stringify=querystringify;querystringify$1.parse=querystring;var required=requiresPort,qs=querystringify$1,controlOrWhitespace=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,CRHTLF=/[\n\r\t]/g,slashes=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,port=/:\d+$/,protocolre=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,windowsDriveLetter=/^[a-zA-Z]:/;function trimLeft(H){return(H||"").toString().replace(controlOrWhitespace,"")}var rules=[["#","hash"],["?","query"],function H(B,t){return isSpecial(t.protocol)?B.replace(/\\/g,"/"):B},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ignore={hash:1,query:1};function lolcation(H){var B;typeof window<"u"?B=window:typeof commonjsGlobal<"u"?B=commonjsGlobal:typeof self<"u"?B=self:B={};var t=B.location||{};H=H||t;var V={},N=typeof H,W;if(H.protocol==="blob:")V=new Url(unescape(H.pathname),{});else if(N==="string"){V=new Url(H,{});for(W in ignore)delete V[W]}else if(N==="object"){for(W in H)W in ignore||(V[W]=H[W]);V.slashes===void 0&&(V.slashes=slashes.test(H.href))}return V}function isSpecial(H){return H==="file:"||H==="ftp:"||H==="http:"||H==="https:"||H==="ws:"||H==="wss:"}function extractProtocol(H,B){H=trimLeft(H),H=H.replace(CRHTLF,""),B=B||{};var t=protocolre.exec(H),V=t[1]?t[1].toLowerCase():"",N=!!t[2],W=!!t[3],K=0,G;return N?W?(G=t[2]+t[3]+t[4],K=t[2].length+t[3].length):(G=t[2]+t[4],K=t[2].length):W?(G=t[3]+t[4],K=t[3].length):G=t[4],V==="file:"?K>=2&&(G=G.slice(2)):isSpecial(V)?G=t[4]:V?N&&(G=G.slice(2)):K>=2&&isSpecial(B.protocol)&&(G=t[4]),{protocol:V,slashes:N||isSpecial(V),slashesCount:K,rest:G}}function resolve(H,B){if(H==="")return B;for(var t=(B||"/").split("/").slice(0,-1).concat(H.split("/")),V=t.length,N=t[V-1],W=!1,K=0;V--;)t[V]==="."?t.splice(V,1):t[V]===".."?(t.splice(V,1),K++):K&&(V===0&&(W=!0),t.splice(V,1),K--);return W&&t.unshift(""),(N==="."||N==="..")&&t.push(""),t.join("/")}function Url(H,B,t){if(H=trimLeft(H),H=H.replace(CRHTLF,""),!(this instanceof Url))return new Url(H,B,t);var V,N,W,K,G,Z,Y=rules.slice(),X=typeof B,Q=this,te=0;for(X!=="object"&&X!=="string"&&(t=B,B=null),t&&typeof t!="function"&&(t=qs.parse),B=lolcation(B),N=extractProtocol(H||"",B),V=!N.protocol&&!N.slashes,Q.slashes=N.slashes||V&&B.slashes,Q.protocol=N.protocol||B.protocol||"",H=N.rest,(N.protocol==="file:"&&(N.slashesCount!==2||windowsDriveLetter.test(H))||!N.slashes&&(N.protocol||N.slashesCount<2||!isSpecial(Q.protocol)))&&(Y[3]=[/(.*)/,"pathname"]);te<Y.length;te++){if(K=Y[te],typeof K=="function"){H=K(H,Q);continue}W=K[0],Z=K[1],W!==W?Q[Z]=H:typeof W=="string"?(G=W==="@"?H.lastIndexOf(W):H.indexOf(W),~G&&(typeof K[2]=="number"?(Q[Z]=H.slice(0,G),H=H.slice(G+K[2])):(Q[Z]=H.slice(G),H=H.slice(0,G)))):(G=W.exec(H))&&(Q[Z]=G[1],H=H.slice(0,G.index)),Q[Z]=Q[Z]||V&&K[3]&&B[Z]||"",K[4]&&(Q[Z]=Q[Z].toLowerCase())}t&&(Q.query=t(Q.query)),V&&B.slashes&&Q.pathname.charAt(0)!=="/"&&(Q.pathname!==""||B.pathname!=="")&&(Q.pathname=resolve(Q.pathname,B.pathname)),Q.pathname.charAt(0)!=="/"&&isSpecial(Q.protocol)&&(Q.pathname="/"+Q.pathname),required(Q.port,Q.protocol)||(Q.host=Q.hostname,Q.port=""),Q.username=Q.password="",Q.auth&&(G=Q.auth.indexOf(":"),~G?(Q.username=Q.auth.slice(0,G),Q.username=encodeURIComponent(decodeURIComponent(Q.username)),Q.password=Q.auth.slice(G+1),Q.password=encodeURIComponent(decodeURIComponent(Q.password))):Q.username=encodeURIComponent(decodeURIComponent(Q.auth)),Q.auth=Q.password?Q.username+":"+Q.password:Q.username),Q.origin=Q.protocol!=="file:"&&isSpecial(Q.protocol)&&Q.host?Q.protocol+"//"+Q.host:"null",Q.href=Q.toString()}function set(H,B,t){var V=this;switch(H){case"query":typeof B=="string"&&B.length&&(B=(t||qs.parse)(B)),V[H]=B;break;case"port":V[H]=B,required(B,V.protocol)?B&&(V.host=V.hostname+":"+B):(V.host=V.hostname,V[H]="");break;case"hostname":V[H]=B,V.port&&(B+=":"+V.port),V.host=B;break;case"host":V[H]=B,port.test(B)?(B=B.split(":"),V.port=B.pop(),V.hostname=B.join(":")):(V.hostname=B,V.port="");break;case"protocol":V.protocol=B.toLowerCase(),V.slashes=!t;break;case"pathname":case"hash":if(B){var N=H==="pathname"?"/":"#";V[H]=B.charAt(0)!==N?N+B:B}else V[H]=B;break;case"username":case"password":V[H]=encodeURIComponent(B);break;case"auth":var W=B.indexOf(":");~W?(V.username=B.slice(0,W),V.username=encodeURIComponent(decodeURIComponent(V.username)),V.password=B.slice(W+1),V.password=encodeURIComponent(decodeURIComponent(V.password))):V.username=encodeURIComponent(decodeURIComponent(B))}for(var K=0;K<rules.length;K++){var G=rules[K];G[4]&&(V[G[1]]=V[G[1]].toLowerCase())}return V.auth=V.password?V.username+":"+V.password:V.username,V.origin=V.protocol!=="file:"&&isSpecial(V.protocol)&&V.host?V.protocol+"//"+V.host:"null",V.href=V.toString(),V}function toString(H){(!H||typeof H!="function")&&(H=qs.stringify);var B,t=this,V=t.host,N=t.protocol;N&&N.charAt(N.length-1)!==":"&&(N+=":");var W=N+(t.protocol&&t.slashes||isSpecial(t.protocol)?"//":"");return t.username?(W+=t.username,t.password&&(W+=":"+t.password),W+="@"):t.password?(W+=":"+t.password,W+="@"):t.protocol!=="file:"&&isSpecial(t.protocol)&&!V&&t.pathname!=="/"&&(W+="@"),(V[V.length-1]===":"||port.test(t.hostname)&&!t.port)&&(V+=":"),W+=V+t.pathname,B=typeof t.query=="object"?H(t.query):t.query,B&&(W+=B.charAt(0)!=="?"?"?"+B:B),t.hash&&(W+=t.hash),W}Url.prototype={set,toString};Url.extractProtocol=extractProtocol;Url.location=lolcation;Url.trimLeft=trimLeft;Url.qs=qs;class c extends Command{execute(B){const{model:t}=this.editor;let V;switch(typeof B){case"string":V=B;break;case"function":V=B()}typeof V=="string"&&t.change(()=>{const N=this.editor.data.htmlProcessor.toView(V),W=this.editor.data.toModel(N);t.insertContent(W)})}}class r extends Plugin{constructor(t){super(t);ee(this,"_licenseKeyCheckInterval");this._licenseKeyCheckInterval=null}static get pluginName(){return"TemplateEditing"}init(){const{editor:t}=this;t.commands.add("insertTemplate",new c(t)),this.licenseKey=t.config.get("licenseKey");const V=this.editor;this._licenseKeyCheckInterval=setInterval(()=>{let N;for(const W in V){const K=W,G=V[K];if(G==="templateLicenseKeyTrial"||G==="templateLicenseKeyInvalid"||G==="templateLicenseKeyValid"||G==="templateLicenseKeyTrialLimit:operations"){delete V[K],N=G;break}}if(N==="templateLicenseKeyInvalid")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("template-invalid-license-key",null);if(N==="templateLicenseKeyTrial"&&console.info("You are using the trial version of CKEditor 5 template plugin with limited usage. Make sure you will not use it in the production environment."),N==="templateLicenseKeyTrialLimit:operations")throw clearInterval(this._licenseKeyCheckInterval),new CKEditorError("template-trial-license-key-reached-limit-changes",null);N==="templateLicenseKeyValid"&&clearInterval(this._licenseKeyCheckInterval)},1e3)}destroy(){this._licenseKeyCheckInterval&&clearInterval(this._licenseKeyCheckInterval)}}class d extends ListView{filter(B){if(!B)return this._resetFiltering();const t=new Map,V=this.items.map(N=>{const W=N.buttonView.isMatching(B);return N.isVisible=!!W,N.buttonView.highlightText(W?B:null),W&&t.set(N,W),N}).sort(F).sort(function(N){return function(W,K){const G=N.get(W),Z=N.get(K);return G&&!Z?-1:Z&&!G?1:G||Z?G.title&&!Z.title?-1:!G.title&&Z.title?1:0:0}}(t));return this.items.clear(),this.items.addMany(V),{resultsCount:t.size,totalItemsCount:this.items.length}}_resetFiltering(){const B=this.items.map(t=>t).sort(F);return B.forEach(t=>{t.isVisible=!0,t.buttonView.highlightText(null)}),this.items.clear(),this.items.addMany(B),{resultsCount:B.length,totalItemsCount:B.length}}}function F(H,B){return H.originalIndex-B.originalIndex}class b extends ListItemView{constructor(t,V){super(t);ee(this,"originalIndex");ee(this,"buttonView");this.originalIndex=V,this.buttonView=null}}var g=`<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 45 45">
  <path fill="#F0F0F0" d="M2 0h41s2 0 2 2v41s0 2 -2 2h-41s-2 0 -2 -2v-41s0 -2 2 -2" />
  <path fill="#D5D5D5" d="M11 10h10s1 0 1 1v24s0 1 -1 1h-10s-1 0 -1 -1v-24s0 -1 1 -1" />
  <path fill="#D5D5D5" d="M25 10h10s1 0 1 1v10s0 1 -1 1h-10s-1 0 -1 -1v-10s0 -1 1 -1" />
  <path fill="#D5D5D5" d="M25 24h10s1 0 1 1v10s0 1 -1 1h-10s-1 0 -1 -1v-10s0 -1 1 -1" />
</svg>
`;class h extends ButtonView{constructor(t,V){super(t);ee(this,"templateDefinition");ee(this,"textPartView");this.templateDefinition=V,this.textPartView=null;const{icon:N=g}=V;this.set({withText:!0,class:"ck-template-button",role:"option",icon:N}),this.iconView.isColorInherited=!1}render(){super.render(),this.textPartView=new v(this.locale,this.templateDefinition,this.labelView.element.id),this.children.remove(this.labelView),this.children.add(this.textPartView)}destroy(){super.destroy(),this.labelView.destroy()}isMatching(t){const{title:V,description:N}=this.templateDefinition,W=!!V.match(t),K=!(!N||!N.match(t));return W||K?{title:W,description:K}:null}highlightText(t){this.textPartView.highlightText(t)}}class v extends View{constructor(B,t,V){super(B),this.title=t.title,this.description=t.description,this.titleView=new HighlightedTextView,this.titleView.text=this.title,this.titleView.extendTemplate({tag:"span",attributes:{class:["ck-button__label"],id:V}});const N=[this.titleView];this.description&&(this.descriptionView=new HighlightedTextView,this.descriptionView.text=this.description,this.descriptionView.extendTemplate({tag:"p",attributes:{class:["ck-template-form__description"]}}),N.push(this.descriptionView)),this.setTemplate({tag:"div",attributes:{class:["ck","ck-template-form__text-part"]},children:N})}highlightText(B){this.titleView.highlightText(B),this.description&&this.descriptionView.highlightText(B)}}function I(H,B,...t){const V=H.t;switch(B){case'No templates were found matching "%0".':return V('No templates were found matching "%0".',...t);case"Please try a different phrase or check the spelling.":return V("Please try a different phrase or check the spelling.");case"No templates available.":return V("No templates available.");case"%0 templates found":return V("%0 templates found",...t);case"Search template":return V("Search template");case"Template":return V("Template");case"Insert template":return V("Insert template");default:return B}}class i extends Plugin{static get pluginName(){return"TemplateUI"}init(){const{editor:B}=this,t=B.config.get("template.definitions")||[];B.ui.componentFactory.add("insertTemplate",V=>{const N=createDropdown(V),W=this._createTemplateListView(V,t),K=new SearchTextView(V,{filteredView:W,queryView:{label:I(V,"Search template")},class:"ck-template-form",infoView:{text:{notFound:{primary:Z=>I(V,'No templates were found matching "%0".',Z),secondary:I(V,"Please try a different phrase or check the spelling.")},noSearchableItems:{primary:I(V,"No templates available.")}}}}),G=B.commands.get("insertTemplate");return K.on("search",(Z,Y)=>{Y.query&&Y.query.length&&B.ui.ariaLiveAnnouncer.announce(I(V,"%0 templates found",Y.resultsCount))}),N.bind("isEnabled").to(G),N.panelView.children.add(K),N.buttonView.set({label:I(V,"Insert template"),icon:a$5.template,tooltip:!0}),N.on("change:isOpen",(Z,Y,X)=>{X||K.reset()}),N}),B.ui.componentFactory.add("menuBar:insertTemplate",V=>{const N=B.commands.get("insertTemplate"),W=new MenuBarMenuView(V);W.buttonView.set({label:I(V,"Template"),icon:a$5.template});const K=new MenuBarMenuListView(V);if(!t||!t.length){const G=new MenuBarMenuListItemView(V,W),Z=new MenuBarMenuListItemButtonView(V);Z.set({label:I(V,"No templates available.")}),Z.delegate("execute").to(W),Z.on("execute",()=>{B.editing.view.focus()}),G.children.add(Z),K.items.add(G)}for(const G of t){const Z=new MenuBarMenuListItemView(V,W),Y=new MenuBarMenuListItemButtonView(V);Y.set({class:"ck-template-button",label:G.title,icon:G.icon||g}),Y.delegate("execute").to(W),Y.on("execute",()=>{B.execute("insertTemplate",G.data),B.editing.view.focus()}),Z.children.add(Y),K.items.add(Z)}return W.panelView.children.add(K),W.bind("isEnabled").to(N,"isEnabled"),W})}afterInit(){(function(B){function t(N,W,K){const G={};G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])]={16:10,24:12,32:14},G[V([114,99,111,110])]=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],G[V([83])]=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],G[V([84,49])]=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],G[V([84,50])]=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],G[V([84,51])]=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],G[V([84,52])]=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],G[V([85,49])]=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],G[V([85,50])]=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],G[V([85,51])]=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],G[V([85,52])]=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];const Z=new Uint8Array(16);for(let ce=15;ce>=0;--ce)Z[ce]=K%256,K=parseInt(K/256);let Y=null,X=16;const Q=new Uint8Array(W),te=[],ie=[];de();for(let ce=0;ce<N[V([108,101,110,103,116,104])];ce++)X===16&&(Y=ae(Z),X=0,le(Z)),N[ce]^=Y[X++];return N;function ne(ce){const we=[];for(let be=0;be<ce[V([108,101,110,103,116,104])];be+=4)we[V([112,117,115,104])](ce[be]<<24|ce[be+1]<<16|ce[be+2]<<8|ce[be+3]);return we}function le(ce){for(let we=15;we>=0;we--){if(ce[we]!==255){ce[we]++;break}ce[we]=0}}function ae(ce){const we=te[V([108,101,110,103,116,104])]-1,be=[0,0,0,0];let ge=ne(ce);for(let me=0;me<4;me++)ge[me]^=te[0][me];for(let me=1;me<we;me++){for(let pe=0;pe<4;pe++)be[pe]=G[V([84,49])][ge[pe]>>24&255]^G[V([84,50])][ge[(pe+1)%4]>>16&255]^G[V([84,51])][ge[(pe+2)%4]>>8&255]^G[V([84,52])][255&ge[(pe+3)%4]]^te[me][pe];ge=be[V([115,108,105,99,101])]()}const Ce=new Uint8Array(16);let he;for(let me=0;me<4;me++)he=te[we][me],Ce[4*me]=255&(G[V([83])][ge[me]>>24&255]^he>>24),Ce[4*me+1]=255&(G[V([83])][ge[(me+1)%4]>>16&255]^he>>16),Ce[4*me+2]=255&(G[V([83])][ge[(me+2)%4]>>8&255]^he>>8),Ce[4*me+3]=255&(G[V([83])][255&ge[(me+3)%4]]^he);return Ce}function de(){const ce=G[V([110,117,109,98,101,114,79,102,82,111,117,110,100,115])][Q[V([108,101,110,103,116,104])]];for(let _e=0;_e<=ce;_e++)te[V([112,117,115,104])]([0,0,0,0]),ie[V([112,117,115,104])]([0,0,0,0]);const we=4*(ce+1),be=Q[V([108,101,110,103,116,104])]/4,ge=ne(Q);let Ce;for(let _e=0;_e<be;_e++)Ce=_e>>2,te[Ce][_e%4]=ge[_e],ie[ce-Ce][_e%4]=ge[_e];let he,me=0,pe=be;for(;pe<we;){he=ge[be-1],ge[0]^=G[V([83])][he>>16&255]<<24^G[V([83])][he>>8&255]<<16^G[V([83])][255&he]<<8^G[V([83])][he>>24&255]^G[V([114,99,111,110])][me]<<24,me+=1;for(let Ae=1;Ae<be/2;Ae++)ge[Ae]^=ge[Ae-1];he=ge[be/2-1],ge[be/2]^=G[V([83])][255&he]^G[V([83])][he>>8&255]<<8^G[V([83])][he>>16&255]<<16^G[V([83])][he>>24&255]<<24;for(let Ae=be/2+1;Ae<be;Ae++)ge[Ae]^=ge[Ae-1];let _e,ye,Re=0;for(;Re<be&&pe<we;)_e=pe>>2,ye=pe%4,te[_e][ye]=ge[Re],ie[ce-_e][ye]=ge[Re++],pe++}for(let _e=1;_e<ce;_e++)for(let ye=0;ye<4;ye++)he=ie[_e][ye],ie[_e][ye]=G[V([85,49])][he>>24&255]^G[V([85,50])][he>>16&255]^G[V([85,51])][he>>8&255]^G[V([85,52])][255&he]}}function V(N){return N.map(W=>String.fromCharCode(W)).join("")}(N=>{function W(){const oe=[{[V([105,100])]:1,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,111,109,109,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([99,104,101,99,107,65,108,115,111])]:[{[V([105,100])]:2,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,114,97,99,107,32,67,104,97,110,103,101,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}}],[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:3,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,103,105,110,97,116,105,111,110,76,111,111,107,117,112]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,103,105,110,97,116,105,111,110,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:4,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([82,101,118,105,115,105,111,110,32,72,105,115,116,111,114,121]),[V([112,108,117,103,105,110,78,97,109,101])]:V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([108,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121]),[V([111,112,116,105,111,110,115])]:{[V([97,105,119,115,103,105,99])]:!0,[V([97,105,116,99,100,103,105,108])]:!0,[V([97,105,114,118,105,105,108])]:!0}},{[V([105,100])]:5,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,111,99,117,109,101,110,116,32,79,117,116,108,105,110,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([68,111,99,117,109,101,110,116,79,117,116,108,105,110,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([100,111,99,117,109,101,110,116,79,117,116,108,105,110,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:6,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([70,111,114,109,97,116,32,80,97,105,110,116,101,114]),[V([112,108,117,103,105,110,78,97,109,101])]:V([70,111,114,109,97,116,80,97,105,110,116,101,114,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([102,111,114,109,97,116,80,97,105,110,116,101,114,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:7,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([83,108,97,115,104,32,67,111,109,109,97,110,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([83,108,97,115,104,67,111,109,109,97,110,100,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([115,108,97,115,104,67,111,109,109,97,110,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:8,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,97,98,108,101,32,111,102,32,67,111,110,116,101,110,116,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,97,98,108,101,79,102,67,111,110,116,101,110,116,115,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,97,98,108,101,79,102,67,111,110,116,101,110,116,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:9,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([84,101,109,112,108,97,116,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([84,101,109,112,108,97,116,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([116,101,109,112,108,97,116,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12,14]}},{[V([105,100])]:10,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,97,115,116,101,32,102,114,111,109,32,79,102,102,105,99,101,32,69,110,104,97,110,99,101,100]),[V([112,108,117,103,105,110,78,97,109,101])]:V([80,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,73,110,108,105,110,101,114]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([112,97,115,116,101,70,114,111,109,79,102,102,105,99,101,69,110,104,97,110,99,101,100,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:11,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([65,73,32,65,115,115,105,115,116,97,110,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([65,73,65,115,115,105,115,116,97,110,116,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([97,105,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:12,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([80,114,111,100,117,99,116,105,118,105,116,121,32,112,97,99,107])},{[V([105,100])]:13,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([67,97,115,101,32,67,104,97,110,103,101]),[V([112,108,117,103,105,110,78,97,109,101])]:V([67,97,115,101,67,104,97,110,103,101,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([99,97,115,101,67,104,97,110,103,101,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}},{[V([105,100])]:14,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([68,114,117,112,97,108,32,112,97,99,107]),[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114])]:V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])},{[V([105,100])]:15,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,117,108,116,105,32,76,101,118,101,108,32,76,105,115,116]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,117,108,116,105,76,101,118,101,108,76,105,115,116,69,100,105,116,105,110,103]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,117,108,116,105,76,101,118,101,108,76,105,115,116,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101])},{[V([105,100])]:16,[V([102,101,97,116,117,114,101,78,97,109,101])]:V([77,101,114,103,101,32,70,105,101,108,100,115]),[V([112,108,117,103,105,110,78,97,109,101])]:V([77,101,114,103,101,70,105,101,108,100,115,85,73]),[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]:V([109,101,114,103,101,70,105,101,108,100,115,76,105,99,101,110,115,101,75,101,121]),[V([104,97,110,100,108,101,114])]:V([99,104,101,99,107,76,105,99,101,110,115,101]),[V([111,112,116,105,111,110,115])]:{[V([102,103,105])]:[12]}}];return xe(oe),oe;function se(fe){return 1<<fe-1}function xe(fe){fe[V([102,111,114,69,97,99,104])](ve=>{ve[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]=se(ve[V([105,100])]),K(ve)&&ve[V([99,104,101,99,107,65,108,115,111])]&&xe(ve[V([99,104,101,99,107,65,108,115,111])])})}}function K(oe){return V([112,108,117,103,105,110,78,97,109,101])in oe}const G=[1,85,78,115,198,255,50,112,83,87,161],Z=[127,34,6,211,167,86,146,199,132,160,18];function Y(oe){const se=[29,221,175,90,231,133,239,240,75,180];return X(oe,new Uint8Array([...G,...se,...Z]))}function X(oe,se){const xe=Q(oe),fe=Array[V([102,114,111,109])](Je(xe)),ve=fe[V([112,111,112])](),Ie=fe[V([112,111,112])]();return Ye(t(fe,se,Ie+256*ve))}function Q(oe){const se=atob(oe),[xe,fe]=se[V([115,112,108,105,116])](V([45]));try{if(atob(fe))return atob(xe)}catch{}return se}function te(oe){try{const se=Y(oe),xe=JSON[V([112,97,114,115,101])](se),fe=parseInt(xe[V([49])]),ve=xe[V([50])]||"",Ie=parseInt(xe[V([51])]),Ne=parseInt(xe[V([52])])||0,De=parseInt(xe[V([53])])||0;return{[V([112,114,111,100,117,99,116,78,97,109,101])]:ve,[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])]:Ne,[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]:fe,[V([105,115,84,114,105,97,108])]:Ie,[V([105,115,73,110,116,101,114,110,97,108])]:De}}catch{return null}}const ie=W(),ne={[V([99,104,101,99,107,76,105,99,101,110,115,101])]:Ce,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,84,114,97,99,107,67,104,97,110,103,101,115])]:he,[V([99,104,101,99,107,76,105,99,101,110,115,101,70,111,114,82,101,118,105,115,105,111,110,72,105,115,116,111,114,121])]:me},le=N[V([99,111,110,115,116,114,117,99,116,111,114])][V([112,108,117,103,105,110,78,97,109,101])],ae=V([99,111,110,116,101,120,116])in N?N.context:N.editor,de=V([52,48,52,56,50,48,48,52]),ce=V([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57]),we=ae.config.get(V([108,105,99,101,110,115,101,75,101,121])),be=ie[V([102,105,108,116,101,114])](K)[V([102,105,110,100])](oe=>oe[V([112,108,117,103,105,110,78,97,109,101])]===le);function ge(oe,se){ne[se[V([104,97,110,100,108,101,114])]](oe,se),se[V([99,104,101,99,107,65,108,115,111])]&&se[V([99,104,101,99,107,65,108,115,111])][V([102,105,108,116,101,114])](xe=>Te(ae,xe[V([112,108,117,103,105,110,78,97,109,101])]))[V([102,111,114,69,97,99,104])](xe=>ge(oe,xe))}function Ce(oe,se){_e(pe(oe,se),se)}function he(oe,se){function xe(fe,ve){try{if(Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))&&fe){const Ie=ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,69,100,105,116,105,110,103]))[V([95,101,120,101,99,117,116,101,83,117,103,103,101,115,116,105,111,110])];if(parseInt(Ie)/2>fe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])])return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}return pe(fe,ve)}catch{return ye(ve[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}_e(xe(oe,se),se)}function me(oe,se){const xe=Z[0]*G[1],fe=Z[0]*G[2],ve=Z[2]*G[2];Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&(window[Re()]=ve);function Ie(ue,Ee){try{return Xe()?ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):pe(ue,Ee)}catch{return ye(Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function Ne(ue,Ee){if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))ze();else if(ue==Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])){const Ve=De();Ve&&Le(Ve,Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]);const Oe=Qe();window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Le(V([116,105,109,101]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])},Oe);const $e=ke(ae,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121]))[V([95,114,101,118,105,115,105,111,110,115])];$e[V([108,101,110,103,116,104])]>=7?Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]):$e.on(V([97,100,100]),()=>{$e[V([108,101,110,103,116,104])]>=7&&Le(V([114,101,118,105,115,105,111,110,115]),Ee[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])])})}}function De(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))){if(window[ue]===xe)return V([116,105,109,101]);if(window[ue]===fe)return V([114,101,118,105,115,105,111,110,115])}return!1}function Xe(){if(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114])))return!1;for(const ue in window)if(Number.isNaN(Number(ue))&&window[ue]===ve)return!0;return!1}function Le(ue,Ee){ze(),ye(Ee+V([84,114,105,97,108,76,105,109,105,116,58])+ue),window[Re()]=ue===V([116,105,109,101])?xe:fe}function Qe(){let ue=Z[6]*G[8]*G[6];return Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ue/=10),ue}function ze(){const ue=ae;function Ee(){Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([117,112,100,97,116,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))[V([115,97,118,101,82,101,118,105,115,105,111,110])]=Se,ue[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,ue[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,ue[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))&&(ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([117,110,98,105,110,100])](V([105,115,69,110,97,98,108,101,100])),ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([105,115,69,110,97,98,108,101,100])]=!1,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])]=Se,ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([95,103,101,116,68,105,102,102])]=Se)}ue[V([115,116,97,116,101])]==V([114,101,97,100,121])?Ee():ue[V([111,110,99,101])](V([114,101,97,100,121]),()=>{if(Te(ue,V([82,101,118,105,115,105,111,110,84,114,97,99,107,101,114]))&&Ee(),Te(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))){const Me=ke(ue,V([82,101,118,105,115,105,111,110,115,82,101,112,111,115,105,116,111,114,121])),Ve=Me.getRevision(0),Oe=Me.getEarlierVisibleRevision(Ve[V([105,100])]);ke(ue,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114]))[V([99,111,109,112,97,114,101])](Ve[V([105,100])],Oe?Oe[V([105,100])]:null,1).then(()=>Ee())}})}Ne(Ie(oe,se),se)}function pe(oe,se){try{return Ze(se)?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):oe&&Ke(oe[V([97,108,108,111,119,101,100,80,108,117,103,105,110,115])],se)?oe[V([105,115,73,110,116,101,114,110,97,108])]&&!window[V([111,112,101,110])][V([99,108,111,115,101,100])]||parseInt(de)/2>oe[V([101,120,112,105,114,97,116,105,111,110,68,97,116,101])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])):oe[V([105,115,84,114,105,97,108])]?ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([86,97,108,105,100])):ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}catch{return ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100]))}}function _e(oe,se){if(ae instanceof Context){const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Ae(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&window[V([115,101,116,84,105,109,101,111,117,116])](()=>{Ae(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101]))},Z[6]*G[8]*G[6]),xe[V([101,100,105,116,111,114,115])][V([111,110])](V([97,100,100]),(fe,ve)=>{oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,116,105,109,101])&&oe!=se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])||Be(ve)})}else{const xe=ae;oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([73,110,118,97,108,105,100])?Be(xe):oe==se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108])&&xe[V([111,110])](V([114,101,97,100,121]),()=>{let fe=0;xe[V([109,111,100,101,108])][V([111,110])](V([97,112,112,108,121,79,112,101,114,97,116,105,111,110]),(ve,Ie)=>{Ie[0][V([105,115,68,111,99,117,109,101,110,116,79,112,101,114,97,116,105,111,110])]&&fe++,fe===504&&(Be(xe),ye(se[V([108,105,99,101,110,115,101,83,116,97,116,117,115,80,114,101,102,105,120])]+V([84,114,105,97,108,76,105,109,105,116,58,111,112,101,114,97,116,105,111,110,115])),ve[V([111,102,102])]())},{priority:V([104,105,103,104,101,115,116])})})}}function ye(oe){const se=Re();return ae[se]=oe,oe}function Re(){const oe=String(window[V([112,101,114,102,111,114,109,97,110,99,101])][V([110,111,119])]())[V([114,101,112,108,97,99,101])](V([46]),"");let se="";for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe+=2){let fe=parseInt(oe[V([115,117,98,115,116,114,105,110,103])](xe,xe+2));fe>=ce[V([108,101,110,103,116,104])]&&(fe-=ce[V([108,101,110,103,116,104])]),se+=ce[fe]}return se}function Ae(oe){for(const se of oe[V([101,100,105,116,111,114,115])])Be(se);ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])](!0),ke(oe,V([67,111,109,109,101,110,116,115,82,101,112,111,115,105,116,111,114,121]))[V([115,119,105,116,99,104,82,101,97,100,79,110,108,121])]=Se}function Be(oe){function se(){oe[V([109,111,100,101,108])][V([99,104,97,110,103,101])]=Se,oe[V([109,111,100,101,108])][V([101,110,113,117,101,117,101,67,104,97,110,103,101])]=Se,oe[V([101,110,97,98,108,101,82,101,97,100,79,110,108,121,77,111,100,101])](V([109,111,100,101,108]))}oe[V([115,116,97,116,101])]==V([114,101,97,100,121])?se():oe[V([111,110,99,101])](V([114,101,97,100,121]),()=>se())}function Se(){return null}function Ke(oe,se){const xe=!!(oe&se[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]),fe=je(oe,se);return xe||fe}function je(oe,se){const xe=(se[V([111,112,116,105,111,110,115])]||{})[V([102,103,105])]||null;return!!xe&&ie[V([102,105,108,116,101,114])](fe=>xe[V([105,110,99,108,117,100,101,115])](fe[V([105,100])]))[V([102,105,108,116,101,114])](fe=>!qe(fe))[V([115,111,109,101])](fe=>!!(oe&fe[V([112,101,114,109,105,115,115,105,111,110,77,97,115,107])]))}function qe(oe){const se={[V([102,111,114,98,105,100,100,101,110,72,97,110,100,108,101,114,70,111,114,68,114,117,112,97,108])]:Ge};return!!oe.forbiddenHandler&&se[oe.forbiddenHandler]()}function Ge(){return!window[V([68,114,117,112,97,108])]||!Te(ae,V([100,114,117,112,97,108,80,111,119,101,114,101,100,66,121]))}function Ze(oe){if(!Te(ae,oe[V([112,108,117,103,105,110,78,97,109,101])]))return!0;const se=oe[V([111,112,116,105,111,110,115])]||{},xe=se[V([97,105,119,115,103,105,99])]||!1,fe=se[V([97,105,116,99,100,103,105,108])]||!1,ve=se[V([97,105,114,118,105,105,108])]||!1;return Te(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))&&ke(ae,V([87,101,98,83,111,99,107,101,116,71,97,116,101,119,97,121]))[V([115,116,97,116,101])]==V([99,111,110,110,101,99,116,101,100])&&xe||Te(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))&&ke(ae,V([84,114,97,99,107,67,104,97,110,103,101,115,68,97,116,97,71,101,116,116,101,114]))[V([114,101,115,117,108,116])]==V([101,110,100])&&fe?!0:!(!Te(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))||ke(ae,V([82,101,118,105,115,105,111,110,86,105,101,119,101,114,73,110,116,101,103,114,97,116,105,111,110]))[V([114,101,115,117,108,116])]!=V([101,110,100])||!ve)}function Te(oe,se){return oe[V([112,108,117,103,105,110,115])][V([104,97,115])](se)}function ke(oe,se){return oe[V([112,108,117,103,105,110,115])][V([103,101,116])](se)}function Ye(oe){let se="";for(const xe of oe)se+=String[V([102,114,111,109,67,104,97,114,67,111,100,101])](xe);return se}function Je(oe){const se=new Uint8Array(oe[V([108,101,110,103,116,104])]);for(let xe=0;xe<oe[V([108,101,110,103,116,104])];xe++)se[xe]=oe[V([99,104,97,114,67,111,100,101,65,116])](xe);return se}be&&ge(te(we),be)})(B)})(this)}_createTemplateListView(B,t){const{editor:V}=this,N=new d(B);return N.extendTemplate({attributes:{role:"listbox",class:["ck-template-list"]}}),N.items.addMany(t.map((W,K)=>{const G=new b(B,K),Z=new h(B,W);return G.buttonView=Z,G.children.add(Z),G.buttonView.on("execute",Y=>{V.execute("insertTemplate",Y.source.templateDefinition.data),V.editing.view.focus()}),G})),N}}class m extends Plugin{static get requires(){return[r,i]}static get pluginName(){return"Template"}}const Pe=["tableCellBorderWidth","tableCellBorderColor","tableCellBorderStyle","tableCellHorizontalAlignment","tableCellVerticalAlignment","tableCellBackgroundColor","tableCellPadding"];Object.fromEntries(Pe.map(H=>[H,null]));const LICENSE_KEY="M2lIdU03dmsrbmVVSENaZEk2eEM4R0ZnSHJuOW1hTnNIOHFpc2xWQm0xdUt4aE84SVdncVFMWHhSY1RPVEE9PS1NakF5TkRFd01Eaz0=",CKBOX_TOKEN_URL="https://118112.cke-cs.com/token/dev/fSX2GpBuNRpQYRt5P7waJox65jXUTEfSgrsX",mergedata={definitions:[{id:"textVariable",label:"textVariable",SampleValue1:"John"},{id:"numberVariable",label:"numberVariable",SampleValue1:"$75,000"},{id:"dateVariable",label:"dateVariable",SampleValue1:"July/05/2025"}]},editorConfig={toolbar:{items:["undo","redo","|","insertMergeField","previewMergeFields","|","sourceEditing","importWord","exportWord","exportPdf","formatPainter","caseChange","|","heading","|","fontSize","fontFamily","fontColor","|","bold","italic","underline","strikethrough","subscript","superscript","removeFormat","|","specialCharacters","horizontalLine","pageBreak","link","insertImage","insertImageViaUrl","ckbox","insertTable","insertTemplate","blockQuote","|","alignment","|","bulletedList","numberedList"],shouldNotGroupWhenFull:!0},plugins:[AccessibilityHelp,Alignment,AutoImage,AutoLink,Autosave,BlockQuote,BlockToolbar,Bold,a$4,CKBox,CKBoxImageEdit,CloudServices,Essentials,s$1,s,FontColor,FontFamily,FontSize,m$3,GeneralHtmlSupport,Heading,HorizontalLine,ImageBlock,ImageCaption,ImageInsert,ImageInsertViaUrl,ImageResize,ImageStyle,ImageTextAlternative,ImageToolbar,ImageUpload,i$3,Italic,Link,LinkImage,List,ListProperties,Mention,g$2,PageBreak,Paragraph,PasteFromOffice,a,PictureEditing,RemoveFormat,SelectAll,SourceEditing,SpecialCharacters,Strikethrough,Subscript,Superscript,Table,TableCaption,TableCellProperties,TableColumnResize,TableProperties,TableToolbar,m,Underline,Undo,BalloonToolbar],balloonToolbar:["fontSize","fontColor","|","bold","italic","link","|","insertMergeField","previewMergeFields","|","exportWord"],blockToolbar:["fontSize","fontColor","|","bold","italic","|","link","insertImage","insertTable","|","bulletedList","numberedList"],ckbox:{tokenUrl:CKBOX_TOKEN_URL},exportPdf:{stylesheets:["./style.css","https://cdn.ckeditor.com/ckeditor5/43.2.0/ckeditor5.css","https://cdn.ckeditor.com/ckeditor5-premium-features/43.2.0/ckeditor5-premium-features.css"],fileName:"export-pdf-demo.pdf",converterOptions:{format:"Tabloid",margin_top:"20mm",margin_bottom:"20mm",margin_right:"24mm",margin_left:"24mm",page_orientation:"portrait"}},exportWord:{stylesheets:["./style.css","https://cdn.ckeditor.com/ckeditor5/43.2.0/ckeditor5.css","https://cdn.ckeditor.com/ckeditor5-premium-features/43.2.0/ckeditor5-premium-features.css"],fileName:"export-word-demo.docx",converterOptions:{document:{orientation:"portrait",size:"Tabloid",margins:{top:"20mm",bottom:"20mm",right:"24mm",left:"24mm"}}}},fontFamily:{supportAllValues:!0},fontSize:{options:[10,12,14,"default",18,20,22],supportAllValues:!0},heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h1",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h2",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Heading 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Heading 4",class:"ck-heading_heading4"},{model:"heading5",view:"h5",title:"Heading 5",class:"ck-heading_heading5"},{model:"heading6",view:"h6",title:"Heading 6",class:"ck-heading_heading6"}]},htmlSupport:{allow:[{name:/^.*$/,styles:!0,attributes:!0,classes:!0}]},image:{toolbar:["toggleImageCaption","imageTextAlternative","|","imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight","|","resizeImage","|","ckboxImageEdit"],styles:{options:["alignBlockLeft","block","alignBlockRight"]}},initialData:`<h2>Welcome to HRT Text Editor 🎉</h2>
<p>
Feel free to edit text and paste from word to get html code.
</p>
`,licenseKey:LICENSE_KEY,link:{addTargetToExternalLinks:!0,defaultProtocol:"https://",decorators:{toggleDownloadable:{mode:"manual",label:"Downloadable",attributes:{download:"file"}}}},list:{properties:{styles:!0,startIndex:!0,reversed:!0}},mention:{feeds:[{marker:"@",feed:[]}]},menuBar:{isVisible:!0},mergeFields:mergedata,placeholder:"Type or paste your content here!",table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableProperties","tableCellProperties"]},template:{definitions:[{title:"Section",description:"This is a snippet of a section.",icon:`<svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g id="icons/article-image-right">
        <rect id="icon-bg" width="45" height="45" rx="2" fill="#A5E7EB"/>
        <g id="page" filter="url(#filter0_d_1_507)">
            <path d="M9 41H36V12L28 5H9V41Z" fill="white"/>
            <path d="M35.25 12.3403V40.25H9.75V5.75H27.7182L35.25 12.3403Z" stroke="#333333" stroke-width="1.5"/>
        </g>
        <g id="image">
            <path id="Rectangle 22" d="M21.5 23C21.5 22.1716 22.1716 21.5 23 21.5H31C31.8284 21.5 32.5 22.1716 32.5 23V29C32.5 29.8284 31.8284 30.5 31 30.5H23C22.1716 30.5 21.5 29.8284 21.5 29V23Z" fill="#B6E3FC" stroke="#333333"/>
            <path id="Vector 1" d="M24.1184 27.8255C23.9404 27.7499 23.7347 27.7838 23.5904 27.9125L21.6673 29.6268C21.5124 29.7648 21.4589 29.9842 21.5328 30.178C21.6066 30.3719 21.7925 30.5 22 30.5H32C32.2761 30.5 32.5 30.2761 32.5 30V27.7143C32.5 27.5717 32.4391 27.4359 32.3327 27.3411L30.4096 25.6268C30.2125 25.451 29.9127 25.4589 29.7251 25.6448L26.5019 28.8372L24.1184 27.8255Z" fill="#44D500" stroke="#333333" stroke-linejoin="round"/>
            <circle id="Ellipse 1" cx="26" cy="25" r="1.5" fill="#FFD12D" stroke="#333333"/>
        </g>
        <rect id="Rectangle 23" x="13" y="13" width="12" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 24" x="13" y="17" width="19" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 25" x="13" y="21" width="6" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 26" x="13" y="25" width="6" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 27" x="13" y="29" width="6" height="2" rx="1" fill="#B4B4B4"/>
        <rect id="Rectangle 28" x="13" y="33" width="16" height="2" rx="1" fill="#B4B4B4"/>
    </g>
    <defs>
        <filter id="filter0_d_1_507" x="9" y="5" width="28" height="37" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix"/>
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
            <feOffset dx="1" dy="1"/>
            <feComposite in2="hardAlpha" operator="out"/>
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.29 0"/>
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1_507"/>
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1_507" result="shape"/>
        </filter>
    </defs>
</svg>
`,data:'<div><h3>Probation Period</h3><p>This is some text that might appear in a section.</p><p>This is a second paragraph with some <b>bold</b> </>text.</p><p>This is a <a target="_blank" rel="noopener noreferrer" href="https://google.com">link</a>.</p></div>'}]}};configUpdateAlert(editorConfig);ClassicEditor.create(document.querySelector("#editor"),editorConfig);function configUpdateAlert(H){var V;if(configUpdateAlert.configUpdateAlertShown)return;const B=(N,W)=>!(N===W||N===void 0),t=[];configUpdateAlert.configUpdateAlertShown=!0,B(H.licenseKey,"<YOUR_LICENSE_KEY>")||t.push("LICENSE_KEY"),B((V=H.ckbox)==null?void 0:V.tokenUrl,"<YOUR_CKBOX_TOKEN_URL>")||t.push("CKBOX_TOKEN_URL"),t.length&&window.alert(["Please update the following values in your editor config","in order to receive full access to the Premium Features:","",...t.map(N=>` - ${N}`)].join(`
`))}});export default gt();
